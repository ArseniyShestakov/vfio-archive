<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 110) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=110" title="Page 110" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=109" title="Page 109" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=111" title="Page 111" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=109">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=108">108</a> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <strong>110</strong> <a href="viewtopic.php?id=162768&amp;p=111">111</a> <a href="viewtopic.php?id=162768&amp;p=112">112</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=111">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1456820" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2726</span> <a href="viewtopic.php?pid=1456820#p1456820">2014-09-15 08:23:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85065">guiper</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-12</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:guiperpt@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>During a rainy weekend, played with getting OSX (Maverick) up and running with VGA Passthrough under KVM. I own a MacBook so in my case it should be legal, in case any moderator doesn&#039;t not agree feel free to delete this post.</p><p>Machine<br />Arch with 3.17 kernel and patches linked a couple of posts above<br />MB: Asrock Z77 Extreme 4-M<br />CPU Some&#160; Intel I5 with VT-d enabled<br />AMD HD6450 being passthrough<br />qemu-git installed</p><p>Mavericks.iso I made on my Macbook Pro. Will not help here.<br />bios-mac.bin and chameleon_svn2360_boot you can find here <a href="http://blog.ostanin.org/2014/02/11/playing-with-mac-os-x-on-kvm/" rel="nofollow">http://blog.ostanin.org/2014/02/11/play … -x-on-kvm/</a></p><p>Installed OSX without using any passthrough, just using VNC, then for booting normally:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -m 4096 -cpu core2duo -machine q35 \ -smp 4,sockets=1,cores=4,threads=1 \ -vga none -boot menu=on \ -device isa-applesmc,osk=&quot;GOOGLEIT!&quot; \ -kernel /home/guilherme/OSX/chameleon_svn2360_boot \ -smbios type=2 \ -bios /home/guilherme/OSX/bios-mac.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=00:1d.0,bus=root.1,addr=00.1 \ -device vfio-pci,host=00:1b.0,bus=root.1,addr=00.2 \ -device vfio-pci,host=00:1a.0,bus=root.1,addr=00.3 \ -drive file=/dev/samsung128/macosx,id=MacHDD,format=raw -device ide-hd,bus=ide.2,drive=MacHDD \ -device ide-drive,bus=ide.0,drive=MacDVD \ -drive id=MacDVD,if=none,snapshot=on,file=./Mavericks.iso -netdev user,id=hub0port0 \ -device e1000-82545em,netdev=hub0port0,id=eth0,mac=52:54:00:8e:3a:fc \ -nographic</code></pre></div><p>USB devices don&#039;t work in Chameleon boot selector, using VNC I created a Org.chameleon.Boot.plist file in /Extra settings the boot device timeout for 5 seconds, so it boots automatically the MacHDD device (hd0,2 in my case).</p><p>Current Status:<br />USB is flaky upon boot, disconnecting and reconnecting the devices get them to work fine. <br />Sleep / Resume works fine!!! <br />Couldn&#039;t get Audio to work but didn&#039;t test it enough. Tried to play with loading KEXTs but no success.<br />Graphics on the AMD 6450 work perfectly out of the box without any issues and acceleration is fine<br />Performance seems perfectly fine and on par with my MacBook pros, but didn&#039;t test too much.</p><p>Finally part of the experience using OSX is due to the nice mouse / gestures experience. Unless you have a proper mighty mouse an Apple keyboard maybe it doesn&#039;t worth it. For me, since I can fix Audio for the moment I&#039;m back on Windows 8.1</p> <p class="postedit"><em>Last edited by guiper (2014-09-15 08:23:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456820">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456866" class="blockpost roweven"> <h2><span><span class="conr">#2727</span> <a href="viewtopic.php?pid=1456866#p1456866">2014-09-15 11:11:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>@aw:<br />is there any way to track any kernel patches related to vga passthrough to know what (for people living far from kernel contribution realms)? some kind of newsgroup or any kind of filter on some website?<br />i mean, you mostly post about it on&#160; your blog, but just in case you &quot;miss&quot; something</p></div></blockquote></div><p><a href="http://vfio.blogspot.de/" rel="nofollow">http://vfio.blogspot.de/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456866">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456899" class="blockpost rowodd"> <h2><span><span class="conr">#2728</span> <a href="viewtopic.php?pid=1456899#p1456899">2014-09-15 13:03:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks sinny, much appreciated</p><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>@aw:<br />is there any way to track any kernel patches related to vga passthrough to know what (for people living far from kernel contribution realms)? some kind of newsgroup or any kind of filter on some website?<br />i mean, you mostly post about it on&#160; your blog, but just in case you &quot;miss&quot; something</p></div></blockquote></div><p>The short answer is no, it&#039;s unfortunately an involved process to track things going upstream.&#160; You can follow along on mailing lists or by watching project commits, but it&#039;s an involved process, which is why distributions offering commercial support hire so many people.&#160; I&#039;ll try to continue to note relevant updates on the blog as I become aware of them.</p><p>It seems like we&#039;ve reached a point where everything we expect to go upstream is there, now we&#039;re just waiting for releases of these versions.&#160; The only outstanding patches are the i915 vga arbiter patch and the acs override patch.&#160; Am I forgetting anything?&#160; Neither of these are expected to go upstream.&#160; OVMF negates the need for the i915 patch and the acs problem needs to be solved by creating quirks for specific devices.&#160; I think for the application here it is generally required to separate processor-based root ports.&#160; Unfortunately Intel has declined to provide a guarantee of isolation of those ports on client processors (i5/i7) but does provide native acs on xeon.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456899">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456933" class="blockpost roweven"> <h2><span><span class="conr">#2729</span> <a href="viewtopic.php?pid=1456933#p1456933">2014-09-15 15:30:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve been able to boot my Windows8 Guest up using the native libvirt OVMF support and can ping it, just unable to check if the VGA passthrough with my AMD R9 290 is working as I&#039;m doing it remotely.</p><p>I have also managed to boot it up using a q35 machine type with the new OVMF from SVN, Windows8 is pinging again can&#039;t check VGA passthrough but will do later.</p><p>My command line entry for qemu looks like so:</p><div class="codebox"><pre><code>/usr/local/qemu-xen-4-4-git-290814/bin/qemu-system-x86_64 -name windows8 -S -machine pc-q35-2.2,accel=kvm,usb=off -cpu host,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff,kvm=off -drive file=/usr/share/ovmf/x64/ovmf_x64.bin,if=pflash,format=raw,unit=0 -m 5168 -realtime mlock=off -smp 2,sockets=2,cores=1,threads=1 -uuid 7b222825-fc7d-4a66-a72c-4875063752d2 -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/windows8.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -boot strict=on -device i82801b11-bridge,id=pci.1,bus=pcie.0,addr=0x1e -device pci-bridge,chassis_nr=2,id=pci.2,bus=pci.1,addr=0x1 -device ich9-usb-ehci1,id=usb,bus=pci.2,addr=0x1.0x7 -drive file=/dev/mapper/vg1-ovmfwinv1data,if=none,id=drive-virtio-disk1,format=raw -device virtio-blk-pci,scsi=off,bus=pci.2,addr=0x7,drive=drive-virtio-disk1,id=virtio-disk1,bootindex=1 -drive file=/dev/mapper/vg1-winv1data,if=none,id=drive-virtio-disk2,format=raw,cache=none -device virtio-blk-pci,scsi=off,bus=pci.2,addr=0x3,drive=drive-virtio-disk2,id=virtio-disk2 -drive file=/home/xen/iso/windows/en-gb_windows_8_1_enterprise_x64_dvd_2971910.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0 -drive file=/root/virtio-win-0.1-74.iso,if=none,id=drive-ide0-2-0,readonly=on,format=raw -device ide-cd,bus=ide.2,unit=0,drive=drive-ide0-2-0,id=ide0-2-0 -netdev tap,fd=22,id=hostnet0,vhost=on,vhostfd=23 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:12:34:56,bus=pci.2,addr=0x2,rombar=0 -device usb-host,hostbus=1,hostaddr=4,id=hostdev0 -device usb-host,hostbus=1,hostaddr=5,id=hostdev1 -device vfio-pci,host=01:00.0,id=hostdev2,bus=pci.2,multifunction=on,addr=0x8 -device vfio-pci,host=01:00.1,id=hostdev3,bus=pci.2,addr=0x9 -msg timestamp=on</code></pre></div><p>My XML looks like so:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;windows8&lt;/name&gt; &lt;uuid&gt;7b222825-fc7d-4a66-a72c-4875063752d2&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;5291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;5291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt; &lt;cputune&gt; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;2&#039;/&gt; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;3&#039;/&gt; &lt;/cputune&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;q35&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039;&gt;/usr/share/ovmf/x64/ovmf_x64.bin&lt;/loader&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;/&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;destroy&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/local/qemu-xen-4-4-git-290814/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; /&gt; &lt;source dev=&#039;/dev/mapper/vg1-ovmfwinv1data&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;source dev=&#039;/dev/mapper/vg1-winv1data&#039;/&gt; &lt;target dev=&#039;vdc&#039; bus=&#039;virtio&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/xen/iso/windows/en-gb_windows_8_1_enterprise_x64_dvd_2971910.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/root/virtio-win-0.1-74.iso&#039;/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;2&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:12:34:56&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;target dev=&#039;tap4&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;alias name=&#039;windows-nic-0&#039;/&gt; &lt;rom bar=&#039;off&#039;/&gt; &lt;/interface&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x01&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;/&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;/&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52e&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x045e&#039;/&gt; &lt;product id=&#039;0x0719&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039; /&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;none&#039;/&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456933">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457270" class="blockpost rowodd"> <h2><span><span class="conr">#2730</span> <a href="viewtopic.php?pid=1457270#p1457270">2014-09-16 14:20:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I saw this i915 vgaarb patch may be in the 3.17 RC3 kernel. Is it true?</p></div></blockquote></div><p>No, the <em>other</em> VGA arbiter patch is in 3.17, the i915 patch is not currently scheduled for any upstream kernel and is a blocking issue for using an unmodified kernel for users with IGD.&#160; Those reporting success with an unmodified kernel probably don&#039;t have IGD or are not following the directions and using their GPU as a secondary card for the VM.&#160; Please see the articles at the URL below, especially the FAQ for more info.</p></div></blockquote></div><p>I can report that without IGD (disabled in bios) and with 2 discrete video cards instead, i was able to passthrough with an unmodified kernel starting with kernel 3.13. On machines with X79 and Z97 chipsets. Quite easy, mostly doing it like this:<br />-better investigation of how mobo sets up iommu groups to find out which slot(s) allows for the wanted config passthrough (this is to find the slot configs which work without patch). <br />-using /etc/modules-load.d/... conf file to load the kernel modules ( kvm \ kvm_intel \ vfio \ vfio_pci \ vfio_iommu_type1)<br />-using /etc/modprobe.d/... conf file to set modules options, like options kvm ignore_msrs=1 and options vfio_iommu_type1 allow_unsafe_interrupts=1<br />I think the above folders and methos can be safely used to load modules and hence avoid the need to compile entire kernel just for switches on those modules. I am not aware of any disadvantage using this method of module loading, maybe somebody else knows some disadvantage? If anyone else wants to try, both conf files are to be edited with one module or one option per each text line, e.g. separated by new lines, not just by spaces. Maybe not all modules really need to be there, but having them wont hurt.</p><p>Currently using 3.17-rc last, but in spite of all the patches going on, with this config i have not noticed any improvements since 3.13, which (very subjectively here) seems to work best for me. Only on Z97 machine i guess due to its bios, the 3.17-rc1 vanished an dmesg err like &quot;could not find upstream pcie&quot;, although things were working either way. My personal conclusion, for desktop use, i would rather buy a 20-30 eur cheap video card for host, and disable the intel graphics entirely, and find the 2 slot combination it works without patches. The laptop users might not be so lucky, but for desktop i find this approach to be ideal atm. Just to avoid dealing with intel graphics crap. </p><p>I cant shake the feeling that igd holding its teeth to vga has smth to do with mei along with its vpro backdoor. Either this smells bad or i do (or both). This even more underlined when a logical disable mechanism no longer works and more when the &quot;maintainer is not willing to accept a driver mode switch option&quot;. Why on earth would not want to accept a driver mode switch, srsly what could be wrong with that, can anybody elaborate. I sincerely dont understand. But i think these back each other, meaning then perhaps the disabling mechanism no longer working is probably &quot;working as intended&quot;. Anyway me personally, the last thing i want is stuff i am not allowed to disable. Even just as a matter of principle, but i suspect this might be more than just principles.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457396" class="blockpost roweven"> <h2><span><span class="conr">#2731</span> <a href="viewtopic.php?pid=1457396#p1457396">2014-09-16 19:29:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>I don&#039;t really know what is OVMF, but reading something on the web I understood it has something to do with UEFI.<br />Consider that I&#039;m not using UEFI on the host, nor no the guest.</p></div></blockquote></div><p>Look down, hint, hint</p></div></blockquote></div><p>Ok, I have compiled OVMF and now I have a &quot;OVMF.fd&quot; file. I guess I have to pass that file as &quot;-bios&quot;, right?</p><br /><p>Moreover I tested the GTX 650 rom with <a href="https://github.com/awilliam/rom-parser" rel="nofollow">your program</a>, here is the output:</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 0, vendor revision: 1 Error, ran off the end</code></pre></div><br /><p>PS: just wondering how much important OVMF test is...I mean: is it a needed dependency for vga passthrough?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457396">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457405" class="blockpost rowodd"> <h2><span><span class="conr">#2732</span> <a href="viewtopic.php?pid=1457405#p1457405">2014-09-16 20:03:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>I don&#039;t really know what is OVMF, but reading something on the web I understood it has something to do with UEFI.<br />Consider that I&#039;m not using UEFI on the host, nor no the guest.</p></div></blockquote></div><p>Look down, hint, hint</p></div></blockquote></div><p>Ok, I have compiled OVMF and now I have a &quot;OVMF.fd&quot; file. I guess I have to pass that file as &quot;-bios&quot;, right?</p><br /><p>Moreover I tested the GTX 650 rom with <a href="https://github.com/awilliam/rom-parser" rel="nofollow">your program</a>, here is the output:</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 0, vendor revision: 1 Error, ran off the end</code></pre></div><br /><p>PS: just wondering how much important OVMF test is...I mean: is it a needed dependency for vga passthrough?</p></div></blockquote></div><p>Oh dear, you&#039;ve gone to all this trouble to compile OVMF but haven&#039;t read this <a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">post</a> to determine why you&#039;d want it and how to use it?&#160; Have I missed something in describing the motivation and requirements there?&#160; OVMF isn&#039;t a &quot;test&quot;, it&#039;s an alternative to VGA.&#160; Since you&#039;re not getting any output from the monitor, it seems like you have an issue with VGA routing.&#160; Avoiding VGA by using OVMF is one method of dealing with this.</p><p>Regarding the parse error, how recently did you grab that copy of rom-parser?&#160; I fixed a similar issue in the code on the 4th.&#160; Otherwise please send me a copy of the ROM binary so I can fix the code for it.&#160; Since you already have the edk2 tree, there&#039;s also a parser there you can use, details in the comments <a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">here</a>.</p><p>For the -bios option; you shouldn&#039;t ever need a -bios option.&#160; The default bios that comes with QEMU is fine for seabios use and for OVMF you&#039;d add an option like:</p><p>-drive if=pflash,format=raw,readonly,file=/path/to/OVMF.fd</p><p>Your previous posts indicate that you&#039;re using Windows 7, so please pay particular attention to the guest operating support for UEFI.&#160; You&#039;d need to upgrade your guest to Windows 8 for OVMF.</p><p>If that&#039;s not any option, we&#039;ll need to go back to debugging your VGA routing issue and &#039;dmesg | grep -i vga&#039; might shed some light on what&#039;s wrong.&#160; Please also pastebin the entire dmesg log from the host.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457405">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457411" class="blockpost roweven"> <h2><span><span class="conr">#2733</span> <a href="viewtopic.php?pid=1457411#p1457411">2014-09-16 20:18:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I saw this i915 vgaarb patch may be in the 3.17 RC3 kernel. Is it true?</p></div></blockquote></div><p>No, the <em>other</em> VGA arbiter patch is in 3.17, the i915 patch is not currently scheduled for any upstream kernel and is a blocking issue for using an unmodified kernel for users with IGD.&#160; Those reporting success with an unmodified kernel probably don&#039;t have IGD or are not following the directions and using their GPU as a secondary card for the VM.&#160; Please see the articles at the URL below, especially the FAQ for more info.</p></div></blockquote></div><p>I can report that without IGD (disabled in bios) and with 2 discrete video cards instead, i was able to passthrough with an unmodified kernel starting with kernel 3.13. On machines with X79 and Z97 chipsets. Quite easy, mostly doing it like this:<br />-better investigation of how mobo sets up iommu groups to find out which slot(s) allows for the wanted config passthrough (this is to find the slot configs which work without patch). <br />-using /etc/modules-load.d/... conf file to load the kernel modules ( kvm \ kvm_intel \ vfio \ vfio_pci \ vfio_iommu_type1)<br />-using /etc/modprobe.d/... conf file to set modules options, like options kvm ignore_msrs=1 and options vfio_iommu_type1 allow_unsafe_interrupts=1</p></div></blockquote></div><p>You should not need vfio_iommu_type1 allow_unsafe_interrupts=1 on either of these systems unless interrupt remapping is disabled in the BIOS.</p><div class="quotebox"><blockquote><div><p>I think the above folders and methos can be safely used to load modules and hence avoid the need to compile entire kernel just for switches on those modules. I am not aware of any disadvantage using this method of module loading, maybe somebody else knows some disadvantage? If anyone else wants to try, both conf files are to be edited with one module or one option per each text line, e.g. separated by new lines, not just by spaces. Maybe not all modules really need to be there, but having them wont hurt.</p><p>Currently using 3.17-rc last, but in spite of all the patches going on, with this config i have not noticed any improvements since 3.13, which (very subjectively here) seems to work best for me. Only on Z97 machine i guess due to its bios, the 3.17-rc1 vanished an dmesg err like &quot;could not find upstream pcie&quot;, although things were working either way. My personal conclusion, for desktop use, i would rather buy a 20-30 eur cheap video card for host, and disable the intel graphics entirely, and find the 2 slot combination it works without patches. The laptop users might not be so lucky, but for desktop i find this approach to be ideal atm. Just to avoid dealing with intel graphics crap. </p><p>I cant shake the feeling that igd holding its teeth to vga has smth to do with mei along with its vpro backdoor. Either this smells bad or i do (or both). This even more underlined when a logical disable mechanism no longer works and more when the &quot;maintainer is not willing to accept a driver mode switch option&quot;. Why on earth would not want to accept a driver mode switch, srsly what could be wrong with that, can anybody elaborate. I sincerely dont understand. But i think these back each other, meaning then perhaps the disabling mechanism no longer working is probably &quot;working as intended&quot;. Anyway me personally, the last thing i want is stuff i am not allowed to disable. Even just as a matter of principle, but i suspect this might be more than just principles.</p></div></blockquote></div><p>The desire to reduce options and make things work out of the box for all users is a good one by the i915 maintainer.&#160; Even users in this thread who patch the kernel themselves and add the necessary options are often surprised and complain at the loss of DRI support on the host.&#160; Unfortunately it doesn&#039;t seem like we have many options that both work for everyone and maintain compatibility with the current versions of Xorg.&#160; This is why I continue to push people towards OVMF as an alternative (but please read the posts I&#039;m pointing Ansa89 to before you leap without understanding the motivation and restrictions).&#160; If your intended guest OS supports UEFI and so does your hardware, you can use OVMF, forget about VGA routing, and you also don&#039;t need to go buy another VGA card just for the host.&#160; Everything is already upstream to make this work, even if there aren&#039;t yet released package versions, there will be sooner than we&#039;ll have an i915 VGA arbiter solution.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457469" class="blockpost rowodd"> <h2><span><span class="conr">#2734</span> <a href="viewtopic.php?pid=1457469#p1457469">2014-09-16 23:51:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Same identical problem.</p><p>My hardware</p><p>Motherboard: B75Pro3<br />Cpu:I5-3470S(host&#160; gpu)<br />Secondary gpu: radeon r9 270.</p><p>I&#039;ve gota Proxmox(Debian)&#160; with kernel 3.14 with ACS and I915 arbiter patch. Included also vfio and vfio-vga in kernel.</p><p>Iommu is enabled I can passthrough devices like dvb pci express cards to other vm(ubuntu) but not secondary gpu with windows...</p><p>Can install using standard adapter, install drivers and infinite atikmpag.sys 0x16 bsod.</p><p>Tried detaching gpu, disabling card + install driver and also not passing audio to no avail.</p><p>I&#039;ve got signal on my secondary monitor and windows logo is on screen.</p><p>Then bsod.</p><p>Tried several catalyst version from 13.4 to 14.7 RC3...</p><p>GRUB: <br />GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1002:6811,1002:aab0&#160; i915.enable_hd_vgaarb=1”</p><br /><br /><p>Any idea?</p><p>Another question:<br />I&#039;m running this machine headless accessing via web or ssh.<br />Windows VM would be a Steam in Home streaming server...</p><p> Is it possible to disable in bios intel cpu and passing ati card to vm(pci stubbing card) as primary passthrough?<br />So I would be free to not use the i915 patch and, reading other posts, maybe results are better than mixing IGPU and discrete card...<br />P.S. I&#039;m also curious about What means &quot;regular installations&quot;?</p><p>Thanks in advance...</p><br /><div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ Arakatak,</p><p>try to go to device manager under windows, navigate to display adapter, click on it, now disable it ( Don&#039;t un install ), after displaying the adapter, windows should blink, now install the ATI drivers.</p><p>This problem comes from regular installations, not KVM/QEMU</p></div></blockquote></div><p>It didn&#039;t help. Why do you think it&#039;s not qemu/kvm? What means &quot;regular installations&quot;? Is it a Windows 8.1 Setup? If so, i also experimented with Windows 7.</p><p>At first Win7 showed some light on possible problems. I installed Catalyst drivers and on next reboot received BSOD (code 0x00000116 on first boot and 0x0000050 on sequential reboots). I followed the advice in <a href="https://bbs.archlinux.org/viewtopic.php?pid=1407618#p1407618" rel="nofollow">this post</a> and removed 01:00.1 audio device from passthrough, then reinstalled the drivers. Although tray icon device detach still worked wrong (resulting in still picture from the last moment before VGA detach), graphics device have functioned well with ATi driver.</p><p>Unfortunately, i wasn&#039;t able to make a fully functional fresh install of Win7 VM without audio 01:00.1 device passthrough. The problems were the same as i mentioned earlier (black screen after driver setup and reboot, but no &quot;No Signal&quot; error).</p><p>For the reference i provide my start scripts:</p><div class="codebox"><pre class="vscroll"><code>cat qemu-win7-setup qemu-win7 #!/bin/bash QEMU_AUDIO_DRV=alsa QEMU_ALSA_DAC_SIZE_IN_USEC=0 QEMU_ALSA_DAC_PERIOD_SIZE=256 QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_DEV=&quot;hw:1,0&quot; QEMU_ALSA_ADC_DEV=&quot;hw:1,0&quot; qemu-system-x86_64 -enable-kvm \ -M q35 \ -m 8G \ -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/System/Windows7Guest,id=disk,format=raw,discard=on -device scsi-hd,drive=disk \ -drive file=&quot;/mnt/data/win.iso&quot;,id=isocd -device scsi-cd,drive=isocd \ -drive file=/mnt/data/virtio-win-0.1-81.iso,id=virtiocd -device ide-cd,bus=ide.1,drive=virtiocd \ -boot once=d \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,id=extvga \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:046d:c328 \ -usbdevice host:046d:c247 #!/bin/bash QEMU_AUDIO_DRV=alsa QEMU_ALSA_DAC_SIZE_IN_USEC=0 QEMU_ALSA_DAC_PERIOD_SIZE=256 QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_DEV=&quot;hw:1,0&quot; QEMU_ALSA_ADC_DEV=&quot;hw:1,0&quot; qemu-system-x86_64 -enable-kvm \ -M q35 \ -m 8G \ -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/System/Windows7Guest,id=disk,format=raw,discard=on -device scsi-hd,drive=disk \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,id=extvga \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:046d:c328 \ -usbdevice host:046d:c247</code></pre></div><p>I welcome discussions on these problems, as it may help solve them.</p><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@EDIT:@</p><p>Q: I hate running sudo every time I want to boot a VM, is it not possible to assign the right groups to the Hardware access?</p></div></blockquote></div><p>Every additional layer of API complicates troubleshooting. Why should i use libvirt when i didn&#039;t even have minimalistic, but functional VM with 100% VGA passthrough support? As for complexity, i need proper documentation on VGA passthrough with libvirt (and possibly OVMF VGA passthrough, as my VGA functions well on native UEFI). So far i found neither.</p></div></blockquote></div> <p class="postedit"><em>Last edited by evilsephiroth (2014-09-16 23:57:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457469">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457485" class="blockpost roweven"> <h2><span><span class="conr">#2735</span> <a href="viewtopic.php?pid=1457485#p1457485">2014-09-17 01:36:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>P.S. I&#039;m also curious about What means &quot;regular installations&quot;?</p></div></blockquote></div><p>I think it means trying to move a bare metal installation to a VM rather than doing a fresh install in the VM.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457485">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457497" class="blockpost rowodd"> <h2><span><span class="conr">#2736</span> <a href="viewtopic.php?pid=1457497#p1457497">2014-09-17 03:16:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Speaking of R9 290, I haven&#039;t heard anything new about the inability to reset the device.&#160; Has any progress been made on that?</p><p>If it would help, I can try out various kernel patches.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457497">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457509" class="blockpost roweven"> <h2><span><span class="conr">#2737</span> <a href="viewtopic.php?pid=1457509#p1457509">2014-09-17 06:16:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Any hint to diagnose my problem?<br />My system seems compliant...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457513" class="blockpost rowodd"> <h2><span><span class="conr">#2738</span> <a href="viewtopic.php?pid=1457513#p1457513">2014-09-17 06:33:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>speaking of ovmf, i wonder if there is some kind of list of uefi-compliant gpus, or some kind of way to know if some distinct gpu would work or now</p><p>gigabyte&#039;s hd 6450 does NOT support uefi, palit gt 430 is pending for test (i doubt it will support it though)</p><p>so i&#039;ll probably have to go &quot;buy new cheap(-est) one(-s)&quot; route - would not be that great to blind-pick anything</p> <p class="postedit"><em>Last edited by sinny (2014-09-17 07:48:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457513">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457515" class="blockpost roweven"> <h2><span><span class="conr">#2739</span> <a href="viewtopic.php?pid=1457515#p1457515">2014-09-17 06:40:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>speaking of ovmf, i wonder if there is some kind of uefi-compliant gpus, or some kind of way to know if some distinct gpu would work or now</p><p>gigabyte&#039;s hd 6450 does NOT support uefi, palit gt 430 is pending for test (i doubt it will support it though)</p><p>so i&#039;ll probably have to go &quot;buy new cheap(-est) one(-s)&quot; route - would not be that great to blind-pick anything</p></div></blockquote></div><p>Just to be clear...</p><p>OVMF is a replacement for VGA, right?</p><p>can it be a problem solver in case of ATI bsod?</p><p>My guess would be no because they&#039;re related mainly to passtrough itself and not to vga routing...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457515">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457524" class="blockpost rowodd"> <h2><span><span class="conr">#2740</span> <a href="viewtopic.php?pid=1457524#p1457524">2014-09-17 07:59:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>...</p></div></blockquote></div><p>Just to be clear...</p><p>OVMF is a replacement for VGA, right?</p><p>can it be a problem solver in case of ATI bsod?</p><p>My guess would be no because they&#039;re related mainly to passtrough itself and not to vga routing...</p></div></blockquote></div><p>that was NOT written in response to you, in case you care</p><p>and on your problem:<br />based on what you write, you did not even try to read all the stuff that was written in OP post and on THIS page (not to mention doing some &quot;research&quot; in the thread or web on your own)<br />r9 270/r9 270x was reported as working at least few times in the sheet, so i&#039;d bet 95% that you are doing something wrong (probably because of lack of understanding of what you are doing at all)</p><p>please do not waste people&#039;s time on something trivial - first waste your own time instead: read, explore, play around with parameters or start from scratch, repeat until it works or you spent like TONS of time with no result (and read TONS of info)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457524">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457525" class="blockpost roweven"> <h2><span><span class="conr">#2741</span> <a href="viewtopic.php?pid=1457525#p1457525">2014-09-17 08:17:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>...</p></div></blockquote></div><p>Just to be clear...</p><p>OVMF is a replacement for VGA, right?</p><p>can it be a problem solver in case of ATI bsod?</p><p>My guess would be no because they&#039;re related mainly to passtrough itself and not to vga routing...</p></div></blockquote></div><p>that was NOT written in response to you, in case you care</p><p>and on your problem:<br />based on what you write, you did not even try to read all the stuff that was written in OP post and on THIS page (not to mention doing some &quot;research&quot; in the thread or web on your own)<br />r9 270/r9 270x was reported as working at least few times in the sheet, so i&#039;d bet 95% that you are doing something wrong (probably because of lack of understanding of what you are doing at all)</p><p>please do not waste people&#039;s time on something trivial - first waste your own time instead: read, explore, play around with parameters or start from scratch, repeat until it works or you spent like TONS of time with no result (and read TONS of info)</p></div></blockquote></div><br /><p>Well, this is awkyard...</p><p>I&#039;ve used Xen and kvm with various gpus with success. Only this gpu is causing me problems... </p><p>I did read all pages and search other users having my problems... It&#039;s been 4 weeks since I start experimenting with the system.</p><p>Applied all the solution in threads with no avail...</p><p>Based on first page, kernel 3.16 is a requirement but I wanted to achieve same thing with 13.4... Patching has been done also modifying patches from patchwork to adapt to my kernel...</p><p>Read throughly also your blog pages and my system conforms to your description... </p><p>I&#039;ve also helped kantras at the time I was using xen 4.3&#160; on AUR... So I think that I have a minimum understanding of what It&#039;s happening...</p><p>P.S. Links are broken on your post...</p><p>Why are you assuming I did not read all infos and done research? Is something not clear from my forum post?</p> <p class="postedit"><em>Last edited by evilsephiroth (2014-09-17 08:28:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457525">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457530" class="blockpost rowodd"> <h2><span><span class="conr">#2742</span> <a href="viewtopic.php?pid=1457530#p1457530">2014-09-17 08:44:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>...<br />Why are you assuming I did not read all infos and done research? Is something not clear from my forum post?</p></div></blockquote></div><p>and that&#039;s why:<br /> - first part of the reason:</p><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>Just to be clear...<br />OVMF is a replacement for VGA, right?</p></div></blockquote></div><p> - second part of the reason(may be found on previous page; yes, i lied about it being on THIS page):</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><a href="http://vfio.blogspot.ru/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">http://vfio.blogspot.ru/2014/08/primary … t-vga.html</a></p></div></blockquote></div><p>i might be wrong here, but from my point of view, after reading (yes, reading - not just skimming through) the blog post, there may be many questions, but not the one you asked.</p><p>you may check others&#039; reports here (there is even r9 270x on 3.14 kernels): <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457530">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457536" class="blockpost roweven"> <h2><span><span class="conr">#2743</span> <a href="viewtopic.php?pid=1457536#p1457536">2014-09-17 09:01:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>...<br />Why are you assuming I did not read all infos and done research? Is something not clear from my forum post?</p></div></blockquote></div><p>and that&#039;s why:<br /> - first part of the reason:</p><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>Just to be clear...<br />OVMF is a replacement for VGA, right?</p></div></blockquote></div><p> - second part of the reason(may be found on previous page; yes, i lied about it being on THIS page):</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><a href="http://vfio.blogspot.ru/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">http://vfio.blogspot.ru/2014/08/primary … t-vga.html</a></p></div></blockquote></div><p>i might be wrong here, but from my point of view, after reading (yes, reading - not just skimming through) the blog post, there may be many questions, but not the one you asked.</p><p>you may check others&#039; reports here (there is even r9 270x on 3.14 kernels): <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a></p></div></blockquote></div><br /><p>Checking right now the google docs...</p><p>relating to OVMF, I was confirming this information&#160; from aw &quot;&#160; OVMF isn&#039;t a &quot;test&quot;, it&#039;s an alternative to VGA.&#160; Since you&#039;re not getting any output from the monitor, it seems like you have an issue with VGA routing.&quot;</p><p>Nevertheless, will check the google doc and report results... I would love to use proxmox and using a more recent kernel but I don&#039;t know if It&#039;s a feasible way to do this....</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457536">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457568" class="blockpost rowodd"> <h2><span><span class="conr">#2744</span> <a href="viewtopic.php?pid=1457568#p1457568">2014-09-17 11:31:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You should not need vfio_iommu_type1 allow_unsafe_interrupts=1 on either of these systems unless interrupt remapping is disabled in the BIOS.</p></div></blockquote></div><p>Dunno why, but i need it just for X79. Without it does not work, and i get the warning as per last line:</p><div class="codebox"><pre><code>dmesg | grep -E -i &#039;dmar|rmr|iommu|drh|remap&#039; [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=6d0f0340-4faa-4691-b3b6-c26d936404f2 rw radeon.dpm=1 intel_iommu=on pci-stub.ids=10de:1184,10de:0e0a,8086:1d2d,8086:1d3a [ 0.000000] ACPI: DMAR 0x00000000CB7DF000 0000E8 (v01 INTEL DX79TO 0000028A MSFT 0100000D) [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=6d0f0340-4faa-4691-b3b6-c26d936404f2 rw radeon.dpm=1 intel_iommu=on pci-stub.ids=10de:1184,10de:0e0a,8086:1d2d,8086:1d3a [ 0.000000] Intel-IOMMU: enabled [ 0.024733] dmar: Host address width 40 [ 0.024734] dmar: DRHD base: 0x000000fe901000 flags: 0x0 [ 0.024739] dmar: IOMMU 0: reg_base_addr fe901000 ver 1:0 cap d2008c10ef0462 ecap f0207a [ 0.024740] dmar: DRHD base: 0x000000fe900000 flags: 0x1 [ 0.024743] dmar: IOMMU 1: reg_base_addr fe900000 ver 1:0 cap d2078c106f0462 ecap f020fe [ 0.024744] dmar: RMRR base: 0x000000c8dda000 end: 0x000000c8ddafff [ 0.024745] dmar: RMRR base: 0x000000c8ddc000 end: 0x000000c8ddcfff [ 0.378367] DMAR: No ATSR found [ 0.378402] IOMMU 0 0xfe901000: using Queued invalidation [ 0.378405] IOMMU 1 0xfe900000: using Queued invalidation [ 0.378407] IOMMU: Setting RMRR: [ 0.378417] IOMMU: Setting identity map for device 0000:00:1d.0 [0xc8ddc000 - 0xc8ddcfff] [ 0.378441] IOMMU: Setting identity map for device 0000:00:1a.0 [0xc8dda000 - 0xc8ddafff] [ 0.378455] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.378463] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 27.591182] vfio_iommu_type1_attach_group: No interrupt remapping support. Use the module param &quot;allow_unsafe_interrupts&quot; to enable VFIO IOMMU support on this platform</code></pre></div><p>I also get lots of errors but somehow i am used to them:</p><div class="codebox"><pre><code>dmesg | grep -E -i &#039;fail|error|warn|panic| bug|backtrace&#039; [ 0.000000] ACPI BIOS Warning (bug): 32/64X length mismatch in FADT/Pm1aEventBlock: 32/16 (20140724/tbfadt-618) [ 0.000000] ACPI BIOS Warning (bug): 32/64X length mismatch in FADT/PmTimerBlock: 32/24 (20140724/tbfadt-618) [ 0.000000] ACPI BIOS Warning (bug): Invalid length for FADT/Pm1aEventBlock: 16, using default 32 (20140724/tbfadt-699) [ 0.000000] ACPI BIOS Warning (bug): Invalid length for FADT/PmTimerBlock: 24, using default 32 (20140724/tbfadt-699) [ 0.095166] tsc: Marking TSC unstable due to check_tsc_sync_source failed [ 0.217170] PCI: Using host bridge windows from ACPI; if necessary, use &quot;pci=nocrs&quot; and report a bug [ 0.384545] ioapic: probe of 0000:00:05.4 failed with error -22 [ 2.077427] ACPI Warning: SystemIO range 0x0000000000004000-0x000000000000401f conflicts with OpRegion 0x0000000000004000-0x000000000000400f (\_SB_.PCI0.SMBS.SMBI) (20140724/utaddress-258) [ 2.988725] radeon 0000:03:00.0: registered panic notifier</code></pre></div><p>The fadt ones started to appear since 3.14. The ioapic which fails to be recognized is &quot;00:05.4 PIC: Intel Corporation Xeon E5/Core i7 I/O APIC (rev 07) \ Subsystem: Intel Corporation Device 4953&quot;. The path to use pci=nocrs or alternatives was not leading anywhere. The radeon panic notifier is weird coz the xorg log has really no (ee) and only few not related (ww). I think the video card (R7 240) should of been recognized as r600 but its seen as r300. <br />Maybe i am doing something wrong. In general i used to blame this board, coz i had lots of issues with this particular board and its badly broken bios(es). I tried other bioses but from previous one back i had that bug which was loading the cpu and made it hit 90 degrees at idle, not even booted, just inside bios sensors screen could watch temp increasing like crazy with apparently no reason - so since then i keep blaming mei and related &quot;features&quot; for almost anything. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457649" class="blockpost roweven"> <h2><span><span class="conr">#2745</span> <a href="viewtopic.php?pid=1457649#p1457649">2014-09-17 14:35:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>speaking of ovmf, i wonder if there is some kind of list of uefi-compliant gpus, or some kind of way to know if some distinct gpu would work or now</p><p>gigabyte&#039;s hd 6450 does NOT support uefi, palit gt 430 is pending for test (i doubt it will support it though)</p><p>so i&#039;ll probably have to go &quot;buy new cheap(-est) one(-s)&quot; route - would not be that great to blind-pick anything</p></div></blockquote></div><p>I would hope that a card advertised with Windows 8 support would include a UEFI ROM.&#160; If it claims to support secure boot, then it must support UEFI.&#160; Otherwise there&#039;s quite a selection of ROMs that can be tested prior to purchase in the techpowerup database <a href="http://www.techpowerup.com/vgabios/" rel="nofollow">http://www.techpowerup.com/vgabios/</a>.&#160; It&#039;s also possible that another vendor may ship a UEFI BIOS compatible with your card that can be loaded into QEMU via the romfile option.&#160; I also found that EVGA didn&#039;t ship a UEFI ROM for my GTX660, but will send one via support ticket.&#160; Neither of your cards are very new though, so you may indeed be out of luck with them.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457649">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457654" class="blockpost rowodd"> <h2><span><span class="conr">#2746</span> <a href="viewtopic.php?pid=1457654#p1457654">2014-09-17 14:43:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You should not need vfio_iommu_type1 allow_unsafe_interrupts=1 on either of these systems unless interrupt remapping is disabled in the BIOS.</p></div></blockquote></div><p>Dunno why, but i need it just for X79. Without it does not work, and i get the warning as per last line:</p><div class="codebox"><pre><code>[ 0.024739] dmar: IOMMU 0: reg_base_addr fe901000 ver 1:0 cap d2008c10ef0462 ecap f0207a [ 0.024743] dmar: IOMMU 1: reg_base_addr fe900000 ver 1:0 cap d2078c106f0462 ecap f020fe ... [ 27.591182] vfio_iommu_type1_attach_group: No interrupt remapping support. Use the module param &quot;allow_unsafe_interrupts&quot; to enable VFIO IOMMU support on this platform</code></pre></div></div></blockquote></div><p>I suspect it&#039;s either disabled in the BIOS or your kernel doesn&#039;t support interrupt remapping.&#160; The VT-d Extended Capability register (ecap) defines but 3 to indicate interrupt remapping support.&#160; It&#039;s set on both the IOMMUs in your system according to the log, so the hardware is capable of interrupt remapping.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457654">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457660" class="blockpost roweven"> <h2><span><span class="conr">#2747</span> <a href="viewtopic.php?pid=1457660#p1457660">2014-09-17 15:10:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>speaking of ovmf, i wonder if there is some kind of uefi-compliant gpus, or some kind of way to know if some distinct gpu would work or now</p><p>gigabyte&#039;s hd 6450 does NOT support uefi, palit gt 430 is pending for test (i doubt it will support it though)</p><p>so i&#039;ll probably have to go &quot;buy new cheap(-est) one(-s)&quot; route - would not be that great to blind-pick anything</p></div></blockquote></div><p>Just to be clear...</p><p>OVMF is a replacement for VGA, right?</p><p>can it be a problem solver in case of ATI bsod?</p><p>My guess would be no because they&#039;re related mainly to passtrough itself and not to vga routing...</p></div></blockquote></div><p>OVMF is a replacement for VGA, the idea is to avoid legacy VGA access and thus all the arbitration issues that go along with it by using a legacy-free BIOS implementation.</p><p>It likely does not solve the ATI BSOD.</p><p>Have you tried switching to a 440FX machine type, with either VGA or OVMF?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457660">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457664" class="blockpost rowodd"> <h2><span><span class="conr">#2748</span> <a href="viewtopic.php?pid=1457664#p1457664">2014-09-17 15:24:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85070">Arakatak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-12</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85070">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>Same identical problem.</p></div></blockquote></div><p>I don&#039;t think our problems are identical in nature. I suggest you should try to pass VGA without audio, then boot Windows VM in safe mode, uninstall ALL ATi drivers (better to revert the system using restore points, Catalyst creates one on installation). After that install only VGA driver without CCC and other AMD bloatware. Report if it works <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1455955#p1455955" rel="nofollow">My problem</a> usually results in black screen, not in BSOD. Unfortunately, i still can&#039;t fix it.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>P.S. I&#039;m also curious about What means &quot;regular installations&quot;?</p></div></blockquote></div><p>I think it means trying to move a bare metal installation to a VM rather than doing a fresh install in the VM.</p></div></blockquote></div><p>You&#039;ve lead me to the idea a problem may be in VGA/system in general. The manufacturer claims the videocard is Win8 compatible. I can&#039;t test it though. My HDD is fully mapped as lvm. Still, i think doing a fresh install in VM is the best decision.</p><p><strong>Are there any users who were able to do a successful AMD R7 260x setup with Catalyst drivers?</strong> The <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a> contains some mentions about this GPU. How can i find that people?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457664">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457696" class="blockpost roweven"> <h2><span><span class="conr">#2749</span> <a href="viewtopic.php?pid=1457696#p1457696">2014-09-17 16:40:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Did you install the i915 arbiter patch?</p><p>Because before patching kernel, I was having Windows logo ==&gt; black screen ==&gt; reboot...</p><p>Then after patch, I could see seabios + bsod...</p><p>I don&#039;t know if it&#039;s related but...</p><p>Currently, I&#039;m redoing installation so to will try to pass only video without radeon audio...</p><p>Will make you know</p><br /><br /><br /><div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>Same identical problem.</p></div></blockquote></div><p>I don&#039;t think our problems are identical in nature. I suggest you should try to pass VGA without audio, then boot Windows VM in safe mode, uninstall ALL ATi drivers (better to revert the system using restore points, Catalyst creates one on installation). After that install only VGA driver without CCC and other AMD bloatware. Report if it works <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1455955#p1455955" rel="nofollow">My problem</a> usually results in black screen, not in BSOD. Unfortunately, i still can&#039;t fix it.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>P.S. I&#039;m also curious about What means &quot;regular installations&quot;?</p></div></blockquote></div><p>I think it means trying to move a bare metal installation to a VM rather than doing a fresh install in the VM.</p></div></blockquote></div><p>You&#039;ve lead me to the idea a problem may be in VGA/system in general. The manufacturer claims the videocard is Win8 compatible. I can&#039;t test it though. My HDD is fully mapped as lvm. Still, i think doing a fresh install in VM is the best decision.</p><p><strong>Are there any users who were able to do a successful AMD R7 260x setup with Catalyst drivers?</strong> The <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a> contains some mentions about this GPU. How can i find that people?</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457696">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457699" class="blockpost rowodd"> <h2><span><span class="conr">#2750</span> <a href="viewtopic.php?pid=1457699#p1457699">2014-09-17 16:48:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>Same identical problem.</p></div></blockquote></div><p>I don&#039;t think our problems are identical in nature. I suggest you should try to pass VGA without audio, then boot Windows VM in safe mode, uninstall ALL ATi drivers (better to revert the system using restore points, Catalyst creates one on installation). After that install only VGA driver without CCC and other AMD bloatware. Report if it works <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1455955#p1455955" rel="nofollow">My problem</a> usually results in black screen, not in BSOD. Unfortunately, i still can&#039;t fix it.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>P.S. I&#039;m also curious about What means &quot;regular installations&quot;?</p></div></blockquote></div><p>I think it means trying to move a bare metal installation to a VM rather than doing a fresh install in the VM.</p></div></blockquote></div><p>You&#039;ve lead me to the idea a problem may be in VGA/system in general. The manufacturer claims the videocard is Win8 compatible. I can&#039;t test it though. My HDD is fully mapped as lvm. Still, i think doing a fresh install in VM is the best decision.</p><p><strong>Are there any users who were able to do a successful AMD R7 260x setup with Catalyst drivers?</strong> The <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a> contains some mentions about this GPU. How can i find that people?</p></div></blockquote></div><p>Try to pass only gpu without hd audio (but assign both to vfio-pci).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457699">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=109">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=108">108</a> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <strong>110</strong> <a href="viewtopic.php?id=162768&amp;p=111">111</a> <a href="viewtopic.php?id=162768&amp;p=112">112</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=111">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
