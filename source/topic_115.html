<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 115) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=115" title="Page 115" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=114" title="Page 114" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=116" title="Page 116" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=114">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=113">113</a> <a href="viewtopic.php?id=162768&amp;p=114">114</a> <strong>115</strong> <a href="viewtopic.php?id=162768&amp;p=116">116</a> <a href="viewtopic.php?id=162768&amp;p=117">117</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=116">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1461833" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2851</span> <a href="viewtopic.php?pid=1461833#p1461833">2014-09-30 21:39:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can someone help me write a script to launch 3 guests (I have those 3 qemu scripts already) each with its own GPU+USB on Fedora20 after fully booting? I know it has to be in rc.local, but I want the guests to be each in its own screen. This &quot;server&quot; is going to serve as a multiseat PC &quot;plugnplay&quot;..</p><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461833">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461837" class="blockpost roweven"> <h2><span><span class="conr">#2852</span> <a href="viewtopic.php?pid=1461837#p1461837">2014-09-30 22:07:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Can someone help me write a script to launch 3 guests (I have those 3 qemu scripts already) each with its own GPU+USB on Fedora20 after fully booting? I know it has to be in rc.local, but I want the guests to be each in its own screen. This &quot;server&quot; is going to serve as a multiseat PC &quot;plugnplay&quot;..</p><p>Thanks!</p></div></blockquote></div><p>Use libvirtd for this.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461837">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461838" class="blockpost rowodd"> <h2><span><span class="conr">#2853</span> <a href="viewtopic.php?pid=1461838#p1461838">2014-09-30 22:10:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Can someone help me write a script to launch 3 guests (I have those 3 qemu scripts already) each with its own GPU+USB on Fedora20 after fully booting? I know it has to be in rc.local, but I want the guests to be each in its own screen. This &quot;server&quot; is going to serve as a multiseat PC &quot;plugnplay&quot;..</p><p>Thanks!</p></div></blockquote></div><p>Use libvirtd for this.</p></div></blockquote></div><p>Im kind of against libvirt because I have a perfect working guests with qemu and converting qemu cli to libvirtd is a pain...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461838">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461840" class="blockpost roweven"> <h2><span><span class="conr">#2854</span> <a href="viewtopic.php?pid=1461840#p1461840">2014-09-30 22:15:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Can someone help me write a script to launch 3 guests (I have those 3 qemu scripts already) each with its own GPU+USB on Fedora20 after fully booting? I know it has to be in rc.local, but I want the guests to be each in its own screen. This &quot;server&quot; is going to serve as a multiseat PC &quot;plugnplay&quot;..</p><p>Thanks!</p></div></blockquote></div><p>Use libvirtd for this.</p></div></blockquote></div><p>Im kind of against libvirt because I have a perfect working guests with qemu and converting qemu cli to libvirtd is a pain...</p></div></blockquote></div><p>Guess you better learn how to script then... <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461840">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461841" class="blockpost rowodd"> <h2><span><span class="conr">#2855</span> <a href="viewtopic.php?pid=1461841#p1461841">2014-09-30 22:16:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can you then post a perfect working xml so I can then try to change and abuse to my liking?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461841">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461845" class="blockpost roweven"> <h2><span><span class="conr">#2856</span> <a href="viewtopic.php?pid=1461845#p1461845">2014-09-30 22:44:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Can you then post a perfect working xml so I can then try to change and abuse to my liking?</p></div></blockquote></div><p><a href="http://pastie.org/private/oeqpunieatd3gu1ziyptw" rel="nofollow">http://pastie.org/private/oeqpunieatd3gu1ziyptw</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461845">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461851" class="blockpost rowodd"> <h2><span><span class="conr">#2857</span> <a href="viewtopic.php?pid=1461851#p1461851">2014-09-30 23:01:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Booting Windows 8.1 Enterprise using (EFI/BOOT/BOOTX64.EFI) returns me to the UEFI shell , what am I missing ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461851">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461856" class="blockpost roweven"> <h2><span><span class="conr">#2858</span> <a href="viewtopic.php?pid=1461856#p1461856">2014-09-30 23:16:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>et38 wrote:</cite><blockquote><div><div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>But just saying this, if you want something specifially for passthrough and looking to buy, then simply why not get what the guy which does vfio have, like the 990FX which i think that is what aw has (?) not sure lol, but that paired with an 8 core cpu could be quite a performant option. But that is just a thought, nothing more. Mentioning coz that would be my choice right now, and most likely next time i will do exactly that.</p></div></blockquote></div><p>I&#039;ve been thinking (a lot) of an 8-core Amd system, but the power consumption difference (vs. Intel 4c+HT) is just annoying. I&#039;m just trying to see if there are any preferredly (Gigabyte/Asus/Z97/H97) motherboards offering relatively painless vga passthrough experience. Guests would probably be Steam OS / other dev distros.</p></div></blockquote></div><p>Very arguable subject, amd vs intel, and all sides fanboys and marketing. But on short i think somewhere may be a confusion between the power rating and the actual power consumtion. When the cpu says its 130W or 220W, that is a power rating, take it as that, a rating only, but with a twist. The actual losses are not resistive like a light bulb, the losses are dubbed &quot;switching&quot; losses which means it depends on how you get it ticking, its cpu governor or generally how much work the cpu does, or what its the idle freq. So take a look and check intel&#039;s frequencies to be sort of lower than amd, then so is the rating, coz again by far they are switching looses and intel wont run freq high enough to need higher rating. Other than that all the billion gates are now pretty much the same on waffer, complementary pair, nothing new and nothing more to say about it. Just that it will take a change in technology to get any further in frequency, so for the time being the cpus evolution has to go in more cores and/or more features exactly because the frequency did hit its practical limit for the current gate technology. Remember how generations of cpus used to evolve from 33Mhz and up, they cant do that any more they are on the roof already. And as much as they go higher frequencies their thermal losses increase and become impossible to deal with. Generally i think intels stays further away from that frequency roof / hill while amd goes a bit closer. Probably some sort of product or marketing policy. I am not taking sides, so imho its all the same thing except the evolution in nr of cores and features, which both are sort of a waste if the user does not actually use them.</p><p>And those ratings to start with, on the other hand depend on many things, thermal junction from die to sink, thermal junction from sink to ambient etc. So its more like a thermal power rating, sort of speaking points at what level it will be and how much will dissipate before running into thermal protection mode. More or less like any single semiconductor datasheet, you can try check out how to interpret a power mosfet datasheet. When choosing a power mosfet every engineer will/should go with highest rating, with the mosfet that would conduct the most amps before it runs in termal shutdown. But when we talk about billions of those, in complementary pairs, the consumers are gonna panic and choose the lowest rating. They will choose the lowest wattage cpu but they will also choose the highest wattage stereo. And all that while the cpu is able to scale down, and the other things can not. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461856">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461863" class="blockpost rowodd"> <h2><span><span class="conr">#2859</span> <a href="viewtopic.php?pid=1461863#p1461863">2014-10-01 00:02:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>But just saying this, if you want something specifially for passthrough and looking to buy, then simply why not get what the guy which does vfio have, like the 990FX which i think that is what aw has (?)</p></div></blockquote></div><p>Thanks partially to my employer, I have several systems, 990FX is one of them.&#160; It&#039;s my token AMD-Vi system though.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461863">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461882" class="blockpost roweven"> <h2><span><span class="conr">#2860</span> <a href="viewtopic.php?pid=1461882#p1461882">2014-10-01 02:57:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for sharing. </p><p>While at it, let me thank you for ... errr ... everything else <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461882">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461930" class="blockpost rowodd"> <h2><span><span class="conr">#2861</span> <a href="viewtopic.php?pid=1461930#p1461930">2014-10-01 07:15:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Errors when rebooting VM :</p><div class="codebox"><pre class="vscroll"><code>[ 6061.771873] irq 28: nobody cared (try booting with the &quot;irqpoll&quot; option) [ 6061.771911] CPU: 0 PID: 0 Comm: swapper/0 Tainted: P O 3.16.3-1-ARCH #1 [ 6061.771913] Hardware name: ASUS All Series/X99-DELUXE, BIOS 0904 09/22/2014 [ 6061.771915] 0000000000000000 b4596cd08d99296e ffff88085fc03be8 ffffffff8152b3bc [ 6061.771920] ffff88007ce16200 ffff88085fc03c10 ffffffff810d02a2 ffff88007ce16200 [ 6061.771924] 0000000000000000 000000000000001c ffff88085fc03c48 ffffffff810d0657 [ 6061.771928] Call Trace: [ 6061.771930] &lt;IRQ&gt; [&lt;ffffffff8152b3bc&gt;] dump_stack+0x4d/0x6f [ 6061.771947] [&lt;ffffffff810d02a2&gt;] __report_bad_irq+0x32/0xd0 [ 6061.771952] [&lt;ffffffff810d0657&gt;] note_interrupt+0x257/0x2a0 [ 6061.771957] [&lt;ffffffff810cdbae&gt;] handle_irq_event_percpu+0xae/0x1f0 [ 6061.771961] [&lt;ffffffff810cdd2d&gt;] handle_irq_event+0x3d/0x60 [ 6061.771966] [&lt;ffffffff810d1281&gt;] handle_fasteoi_irq+0x81/0x170 [ 6061.771974] [&lt;ffffffff8101717e&gt;] handle_irq+0x1e/0x40 [ 6061.771978] [&lt;ffffffff81533bed&gt;] do_IRQ+0x4d/0xe0 [ 6061.771983] [&lt;ffffffff81531bad&gt;] common_interrupt+0x6d/0x6d [ 6061.771989] [&lt;ffffffff810da64e&gt;] ? ktime_get+0x1e/0x100 [ 6061.771996] [&lt;ffffffff813e79b1&gt;] intel_pstate_timer_func+0x71/0x420 [ 6061.771999] [&lt;ffffffff813e7952&gt;] ? intel_pstate_timer_func+0x12/0x420 [ 6061.772003] [&lt;ffffffff813e7940&gt;] ? intel_pstate_set_pstate+0x110/0x110 [ 6061.772010] [&lt;ffffffff8107b7f6&gt;] call_timer_fn+0x36/0x160 [ 6061.772013] [&lt;ffffffff813e7940&gt;] ? intel_pstate_set_pstate+0x110/0x110 [ 6061.772017] [&lt;ffffffff8107c224&gt;] run_timer_softirq+0x274/0x320 [ 6061.772024] [&lt;ffffffff810736c2&gt;] __do_softirq+0xf2/0x2e0 [ 6061.772029] [&lt;ffffffff81073a06&gt;] irq_exit+0x86/0xb0 [ 6061.772033] [&lt;ffffffff81533cc4&gt;] smp_apic_timer_interrupt+0x44/0x50 [ 6061.772037] [&lt;ffffffff81531f4d&gt;] apic_timer_interrupt+0x6d/0x80 [ 6061.772039] &lt;EOI&gt; [&lt;ffffffff813e88bc&gt;] ? cpuidle_enter_state+0x4c/0xc0 [ 6061.772046] [&lt;ffffffff813e8a17&gt;] cpuidle_enter+0x17/0x20 [ 6061.772050] [&lt;ffffffff810b710f&gt;] cpu_startup_entry+0x32f/0x520 [ 6061.772056] [&lt;ffffffff815216c4&gt;] rest_init+0x84/0x90 [ 6061.772060] [&lt;ffffffff818f5fc9&gt;] start_kernel+0x45e/0x47f [ 6061.772064] [&lt;ffffffff818f5120&gt;] ? early_idt_handlers+0x120/0x120 [ 6061.772068] [&lt;ffffffff818f54d7&gt;] x86_64_start_reservations+0x2a/0x2c [ 6061.772071] [&lt;ffffffff818f5626&gt;] x86_64_start_kernel+0x14d/0x170 [ 6061.772073] handlers: [ 6061.772098] [&lt;ffffffffa07693e0&gt;] vfio_intx_handler [vfio_pci] [ 6061.772129] Disabling IRQ #28</code></pre></div><p>This results in vertical tears in the screen .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461930">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1461934" class="blockpost roweven"> <h2><span><span class="conr">#2862</span> <a href="viewtopic.php?pid=1461934#p1461934">2014-10-01 07:36:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85490">et38</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-29</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>Probably some sort of product or marketing policy. I am not taking sides, so imho its all the same thing except the evolution in nr of cores and features, which both are sort of a waste if the user does not actually use them.</p></div></blockquote></div><p>I see your point and I&#039;m not yet entirely immune to marketing. This system should be retired/repurposed at around 2020. Since there is little data to go around, one has to rely on online reviews. It&#039;s not possible to verify them, however, the ones I found describe &gt;50% difference in system power consumption under load roughly at the same performance level. With insufficient data, I&#039;m unable to say what that equates to, but I&#039;m under the impression that lower thermal load will reduce noise and probability of failure.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1461934">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462010" class="blockpost rowodd"> <h2><span><span class="conr">#2863</span> <a href="viewtopic.php?pid=1462010#p1462010">2014-10-01 15:06:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><p>I get a compat_monitor0 screen similar to <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=70" rel="nofollow">Slabity</a>. However, I am using an intel IGP for the host, and an AMD 6990M for the Windows 7 guest.</p><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0</code></pre></div><p>I&#039;m using the OP&#039;s linux-mainline package, and have also used the acs_override=downstream option with the same result.</p><p>Same result when running vga-clear vga-set.</p><p>dmesg | grep vgaarb</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 [ 0.504315] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none [ 0.504320] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none [ 0.504322] vgaarb: loaded [ 0.504323] vgaarb: bridge control possible 0000:01:00.0 [ 0.504324] vgaarb: no bridge control possible 0000:00:02.0 [ 1.723418] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io+mem</code></pre></div><p>Any advice would be appreciated.</p></div></blockquote></div><p>I solved this problem using pci-assign. The VM now starts windows, but freezes at the windows logo.</p><p>Any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462010">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462015" class="blockpost roweven"> <h2><span><span class="conr">#2864</span> <a href="viewtopic.php?pid=1462015#p1462015">2014-10-01 15:22:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><p>I get a compat_monitor0 screen similar to <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=70" rel="nofollow">Slabity</a>. However, I am using an intel IGP for the host, and an AMD 6990M for the Windows 7 guest.</p><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0</code></pre></div><p>I&#039;m using the OP&#039;s linux-mainline package, and have also used the acs_override=downstream option with the same result.</p><p>Same result when running vga-clear vga-set.</p><p>dmesg | grep vgaarb</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 [ 0.504315] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none [ 0.504320] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none [ 0.504322] vgaarb: loaded [ 0.504323] vgaarb: bridge control possible 0000:01:00.0 [ 0.504324] vgaarb: no bridge control possible 0000:00:02.0 [ 1.723418] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io+mem</code></pre></div><p>Any advice would be appreciated.</p></div></blockquote></div><p>I solved this problem using pci-assign. The VM now starts windows, but freezes at the windows logo.</p><p>Any ideas?</p></div></blockquote></div><p>I had a similar issue , Alex solved it by adding &quot;sp_off&quot; to bootloader arguments after the &quot;intel_iommu=on&quot;</p><p>So it becomes : &quot;intel_iommu=on,sp_off&quot; .</p><p>That solved it for me .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462015">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462047" class="blockpost rowodd"> <h2><span><span class="conr">#2865</span> <a href="viewtopic.php?pid=1462047#p1462047">2014-10-01 17:31:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>et38 wrote:</cite><blockquote><div><div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>Probably some sort of product or marketing policy. I am not taking sides, so imho its all the same thing except the evolution in nr of cores and features, which both are sort of a waste if the user does not actually use them.</p></div></blockquote></div><p>I see your point and I&#039;m not yet entirely immune to marketing. This system should be retired/repurposed at around 2020. Since there is little data to go around, one has to rely on online reviews. It&#039;s not possible to verify them, however, the ones I found describe &gt;50% difference in system power consumption under load roughly at the same performance level. With insufficient data, I&#039;m unable to say what that equates to, but I&#039;m under the impression that lower thermal load will reduce noise and probability of failure.</p></div></blockquote></div><p>That &gt;50%, thats quite a strangely high number, imo its way off. You can also find quite <a href="http://www.youtube.com/watch?v=fBeeGHozSY0" rel="nofollow"> different numbers </a> and all kinds of numbers out there will just be used to back up some guy&#039;s opinion, thats all. No point to comment on numbers. But other than that, as i said the switching losses depend on frequency, and both of the digital gates have exact same technology, so if you actually could compare both cpus running at exact same frequency, then ought to give the same consumption. But in reality they are made to run at different frequencies both at idle and at load. And that gives the perception of being more different than they actually are. Just as a note, same frequency does not equate same load, because same load will still be ran at different frequency by each. Dunno what would be the deal with thermal dissipation vs noise and failures. Thermal dissipation goes hand in hand with frequency, which in turn goes hand in hand with cycles and performance. About noise, there is really no noise in digital realm, thats why static discipline was invented for. About failures, there are both same thing inside, silicon tech that is quite rugged, and i dont see why one would be more sensitive than the other. </p><p>Imho its just like comparing two t-shirts, if you want to get into the details there are some minor differences and can focus a comparison on that area, but in the big picture lets not forget both are t-shirts, so are ~99% same thing. They even use the same &quot;sewing machines&quot; industrial tools to make it and same raw materials suppliers, workforce even may jump between, and same technology which again hit its own limits years back. Therefore the efficiency differences can not be all that dramatical.</p><p>And marketing does give some interesting colors. Some time ago when cpus were evolving in frequency terms, yes everybody was looking just at that. One would upgrade an 800Mhz cpu to 1,6Ghz cpu, coz clearly that was better, everybody knew that. Now the argument goes the other way, we go with 3.2Ghz instead of 4.5Ghz, coz 3.2 its more efficient and saves electricity. I quite like this focus on efficiency, i think its great issue. But what consumes 3/4 of the energy bill in every household is the ... fridge. Even much more if there is air conditioning or heating. Coz the hardest thing to do in physics is create and maintain differences of temperatures because that has to fight law of entropy continiously, every single second. And the integral of that ofc gets huge. But is the fridge isolation a consummer concern -no. When buying the air conditioning, ppls will also look to get most watts/btu. Also high wattage in the stereo, the huget flat tv, home cinema, surround sound, etc. Did ppls commenting on cpu efficiency, what did they do for this concercn, di already replaced all light bublbs in their house with leds -probably not. Did they hermetically isolate the house with 20cm foam -probably not. So the concern with reducing power consumption is great thing, all regards towards that. But, among all the things that would reduce the power bill, the cpu is really the last on the list. The cpu itself is the most scalable and most inteligent power consumer in the house, so why pick on it. Ppls who seriously want to improve the power bill, would have to do all the other things first, and then get some fotovoltaic panels and that kind of things. Other than that is nonsense to me tbh.</p><p>I will rest coz there is no point, sort of speaking yes that dead horse was beaten too much already <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> and not the point of this thread, sry everyone for the side-track of it, now getting back main course.</p> <p class="postedit"><em>Last edited by noobman (2014-10-01 17:33:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462047">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462065" class="blockpost roweven"> <h2><span><span class="conr">#2866</span> <a href="viewtopic.php?pid=1462065#p1462065">2014-10-01 18:18:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>I had a similar issue , Alex solved it by adding &quot;sp_off&quot; to bootloader arguments after the &quot;intel_iommu=on&quot;</p><p>So it becomes : &quot;intel_iommu=on,sp_off&quot; .</p><p>That solved it for me .</p></div></blockquote></div><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on,sp_off vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0</code></pre></div><p>pci-assign: still freezes at windows logo.</p><p>vfio: device manager shows generic VGA card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462065">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462067" class="blockpost rowodd"> <h2><span><span class="conr">#2867</span> <a href="viewtopic.php?pid=1462067#p1462067">2014-10-01 18:28:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>I had a similar issue , Alex solved it by adding &quot;sp_off&quot; to bootloader arguments after the &quot;intel_iommu=on&quot;</p><p>So it becomes : &quot;intel_iommu=on,sp_off&quot; .</p><p>That solved it for me .</p></div></blockquote></div><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=e7fe3792-3cba-cf01-605e-37923cbacf01 rw quiet i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6720,1002:aa88 intel_iommu=on,sp_off vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0</code></pre></div><p>pci-assign: still freezes at windows logo.</p><p>vfio: device manager shows generic VGA card.</p></div></blockquote></div><p>I have no idea what you&#039;re trying to do.&#160; The logo freezes on what?&#160; The emulated display?&#160; That&#039;s supposed to happen if you&#039;re attempting to assign the GPU as a secondary display.&#160; My only advice for pci-assign is don&#039;t use it.&#160; If you&#039;d like some help with vfio-pci, please share with us how you&#039;re starting the guest to start with.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462067">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462084" class="blockpost roweven"> <h2><span><span class="conr">#2868</span> <a href="viewtopic.php?pid=1462084#p1462084">2014-10-01 19:30:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I have no idea what you&#039;re trying to do.&#160; The logo freezes on what?&#160; The emulated display?&#160; That&#039;s supposed to happen if you&#039;re attempting to assign the GPU as a secondary display.&#160; My only advice for pci-assign is don&#039;t use it.&#160; If you&#039;d like some help with vfio-pci, please share with us how you&#039;re starting the guest to start with.</p></div></blockquote></div><p>cat runwin-vfio</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vnc :0 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device piix4-ide,bus=pcie.0,id=piix4-ide \ -drive file=/dev/md0,id=disk,format=raw -device ide-hd,bus=piix4-ide.0,drive=disk</code></pre></div><p>Windows loads, but my card does not appear in device manager.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462084">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462086" class="blockpost rowodd"> <h2><span><span class="conr">#2869</span> <a href="viewtopic.php?pid=1462086#p1462086">2014-10-01 19:34:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I have no idea what you&#039;re trying to do.&#160; The logo freezes on what?&#160; The emulated display?&#160; That&#039;s supposed to happen if you&#039;re attempting to assign the GPU as a secondary display.&#160; My only advice for pci-assign is don&#039;t use it.&#160; If you&#039;d like some help with vfio-pci, please share with us how you&#039;re starting the guest to start with.</p></div></blockquote></div><p>cat runwin-vfio</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vnc :0 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device piix4-ide,bus=pcie.0,id=piix4-ide \ -drive file=/dev/md0,id=disk,format=raw -device ide-hd,bus=piix4-ide.0,drive=disk</code></pre></div><p>Windows loads, but my card does not appear in device manager.</p></div></blockquote></div><p>Ugh, maybe go back to the 1st post and work on the start command.&#160; You&#039;re not specifying -vga none, so you have an emulated VGA device, the assigned device will be secondary.&#160; I wouldn&#039;t recommend that model unless you have a Quadro card (even Quadro doesn&#039;t work in this mode on Q35).&#160; That also basically negates the x-vga=on option.&#160; You&#039;re also trying to attach a piix4 (440FX) IDE device to a Q35 chipset.&#160; There&#039;s just too many problems in that commandline to even deal with.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462086">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462100" class="blockpost roweven"> <h2><span><span class="conr">#2870</span> <a href="viewtopic.php?pid=1462100#p1462100">2014-10-01 20:06:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Ugh, maybe go back to the 1st post and work on the start command.&#160; You&#039;re not specifying -vga none, so you have an emulated VGA device, the assigned device will be secondary.&#160; I wouldn&#039;t recommend that model unless you have a Quadro card (even Quadro doesn&#039;t work in this mode on Q35).&#160; That also basically negates the x-vga=on option.&#160; You&#039;re also trying to attach a piix4 (440FX) IDE device to a Q35 chipset.&#160; There&#039;s just too many problems in that commandline to even deal with.</p></div></blockquote></div><p><a href="https://www.youtube.com/watch?v=Qi1LdFkRzIs" rel="nofollow">This</a> is what I&#039;m trying to achieve. </p><p>-vga none results in compat_monitor0 terminal, which is why I was using pci-assign. (I <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=113" rel="nofollow">posted</a> this before but nobody responded so I tried using pci-assign)</p><p>The piix4 lines are from the OP, so that&#039;s not really my fault for using them. (Should I get rid of them even though the VM boots just fine with vfio?)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462100">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462107" class="blockpost rowodd"> <h2><span><span class="conr">#2871</span> <a href="viewtopic.php?pid=1462107#p1462107">2014-10-01 20:23:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Ugh, maybe go back to the 1st post and work on the start command.&#160; You&#039;re not specifying -vga none, so you have an emulated VGA device, the assigned device will be secondary.&#160; I wouldn&#039;t recommend that model unless you have a Quadro card (even Quadro doesn&#039;t work in this mode on Q35).&#160; That also basically negates the x-vga=on option.&#160; You&#039;re also trying to attach a piix4 (440FX) IDE device to a Q35 chipset.&#160; There&#039;s just too many problems in that commandline to even deal with.</p></div></blockquote></div><p><a href="https://www.youtube.com/watch?v=Qi1LdFkRzIs" rel="nofollow">This</a> is what I&#039;m trying to achieve.</p></div></blockquote></div><p>Please notice that in that demonstration, the desktop window is a tigervnc client and you can see from the icon on the guest desktop that it&#039;s running TightVNC and is connected, so there&#039;s some degree of trickery here that makes it look like the VM is running in a desktop window, but it&#039;s actually no different than if you did a VNC connection to a remote system.&#160; They also have a spice display, so presumably they do also have an emulated graphics device.&#160; Reports like this come through every so often that someone got things to work as a secondary device w/o using VGA assignment, maybe even using pci-assign.&#160; It depends on the guest driver working in that configuration.&#160; If it doesn&#039;t, you&#039;re SOL on that path.</p><div class="quotebox"><blockquote><div><p>-vga none results in compat_monitor0 terminal, which is why I was using pci-assign. (I <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=113" rel="nofollow">posted</a> this before but nobody responded so I tried using pci-assign)</p></div></blockquote></div><p>I didn&#039;t respond because I don&#039;t know what a &quot;compat_monitor0 terminal&quot; even means.&#160; If it means you got a console window, use the -nographic option to make it go away.</p><div class="quotebox"><blockquote><div><p>The piix4 lines are from the OP, so that&#039;s not really my fault for using them. (Should I get rid of them even though the VM boots just fine with vfio?)</p></div></blockquote></div><p>Seems odd to me, but whatever.&#160; I&#039;m encouraging people just trying to run windows to forget about Q35 and just use the default 440FX model.&#160; It seems like you&#039;re also working with a mobile AMD GPU.&#160; Hybrid, dual GPU laptops are wired in strange ways, so if you&#039;re expecting that you can plug a monitor into one of the outputs and get the discrete graphics output, there&#039;s a good chance it won&#039;t work.&#160; You might be able to install everything, setup the Catalyst driver and VNC server in the guest with and emulated VGA, then add the Radeon, remove the emulated VGA, and hope you can blind boot the guest and connect.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462107">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462153" class="blockpost roweven"> <h2><span><span class="conr">#2872</span> <a href="viewtopic.php?pid=1462153#p1462153">2014-10-01 23:56:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I didn&#039;t respond because I don&#039;t know what a &quot;compat_monitor0 terminal&quot; even means.&#160; If it means you got a console window, use the -nographic option to make it go away.</p><p>Seems odd to me, but whatever.&#160; I&#039;m encouraging people just trying to run windows to forget about Q35 and just use the default 440FX model.&#160; It seems like you&#039;re also working with a mobile AMD GPU.&#160; Hybrid, dual GPU laptops are wired in strange ways, so if you&#039;re expecting that you can plug a monitor into one of the outputs and get the discrete graphics output, there&#039;s a good chance it won&#039;t work.&#160; You might be able to install everything, setup the Catalyst driver and VNC server in the guest with and emulated VGA, then add the Radeon, remove the emulated VGA, and hope you can blind boot the guest and connect.</p></div></blockquote></div><p>Running with -vga none -nographic -vnc :0 gets rid of the terminal.:) The vnc window now says &quot;This VM has no graphics display device.&quot;</p><p>Does this change anything? Should I try the vnc in guest solution? Would that solution even work if there is no graphics display device?</p><p>Also when I plug in HDMI, arch mirrors my desktop automatically. (even with no X server running)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462153">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462154" class="blockpost rowodd"> <h2><span><span class="conr">#2873</span> <a href="viewtopic.php?pid=1462154#p1462154">2014-10-02 00:24:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I didn&#039;t respond because I don&#039;t know what a &quot;compat_monitor0 terminal&quot; even means.&#160; If it means you got a console window, use the -nographic option to make it go away.</p><p>Seems odd to me, but whatever.&#160; I&#039;m encouraging people just trying to run windows to forget about Q35 and just use the default 440FX model.&#160; It seems like you&#039;re also working with a mobile AMD GPU.&#160; Hybrid, dual GPU laptops are wired in strange ways, so if you&#039;re expecting that you can plug a monitor into one of the outputs and get the discrete graphics output, there&#039;s a good chance it won&#039;t work.&#160; You might be able to install everything, setup the Catalyst driver and VNC server in the guest with and emulated VGA, then add the Radeon, remove the emulated VGA, and hope you can blind boot the guest and connect.</p></div></blockquote></div><p>Running with -vga none -nographic -vnc :0 gets rid of the terminal.:) The vnc window now says &quot;This VM has no graphics display device.&quot;</p><p>Does this change anything? Should I try the vnc in guest solution? Would that solution even work if there is no graphics display device?</p></div></blockquote></div><p>Have you installed a guest, installed a VNC server, installed Catalyst drivers, and have the VM working so that you can connect to that VNC server from the host?</p><div class="quotebox"><blockquote><div><p>Also when I plug in HDMI, arch mirrors my desktop automatically. (even with no X server running)</p></div></blockquote></div><p>See comments about mobile/hybrid graphics.&#160; That&#039;s a good hint that the discrete graphics isn&#039;t directly connected to the HDMI port.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462154">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462207" class="blockpost roweven"> <h2><span><span class="conr">#2874</span> <a href="viewtopic.php?pid=1462207#p1462207">2014-10-02 08:27:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Errors when rebooting VM :</p><div class="codebox"><pre><code>crashlog</code></pre></div><p>This results in vertical tears in the screen .</p></div></blockquote></div><p>&gt;Hardware name: ASUS All Series/X99-DELUXE<br />Is it that fresh DDR4-based motherboard, requesting fresh CPUs like intel i7-5XXX? Don&#039;t they have some APICv2 or something?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462207">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462280" class="blockpost rowodd"> <h2><span><span class="conr">#2875</span> <a href="viewtopic.php?pid=1462280#p1462280">2014-10-02 14:15:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Errors when rebooting VM :</p><div class="codebox"><pre><code>crashlog</code></pre></div><p>This results in vertical tears in the screen .</p></div></blockquote></div><p>&gt;Hardware name: ASUS All Series/X99-DELUXE<br />Is it that fresh DDR4-based motherboard, requesting fresh CPUs like intel i7-5XXX? Don&#039;t they have some APICv2 or something?</p></div></blockquote></div><p>Yes , it is . I use i7-5930k with it . It&#039;s giving a headache .</p><p>My previous Z77 board worked flawlessly , I thought X99 would be the same if not easier to setup .</p><p>Now , every time I reboot a VM with GPU passed-through to it , it ceashes the whole host . I tried the solution Alex suggested and it worked for a couple reboots , but then it returned to crashing the host .</p><p>Any help would be appreciated folks !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462280">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=114">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=113">113</a> <a href="viewtopic.php?id=162768&amp;p=114">114</a> <strong>115</strong> <a href="viewtopic.php?id=162768&amp;p=116">116</a> <a href="viewtopic.php?id=162768&amp;p=117">117</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=116">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
