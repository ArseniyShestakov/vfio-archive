<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 197) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=197" title="Page 197" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=196" title="Page 196" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=198" title="Page 198" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=196">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <strong>197</strong> <a href="viewtopic.php?id=162768&amp;p=198">198</a> <a href="viewtopic.php?id=162768&amp;p=199">199</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=198">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1522762" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4901</span> <a href="viewtopic.php?pid=1522762#p1522762">2015-04-24 13:05:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zir_blazer wrote:</cite><blockquote><div><p>That is my point. What I try to say is that is intentional that on consumer Chipsets you get a single group with the PCI Controller Ports and everything else below it. On C226 I got it working out of the box since its a Workstation/Server Chipset, I didn&#039;t had to apply patchs or anything to see nearly everything in its own group.</p></div></blockquote></div><p>I&#039;m sorry to blow your theory, but you got it to work on C226 because quirks are already in place for your PCH root ports and you apparently don&#039;t have or aren&#039;t using multiple processor-based root ports.&#160; There&#039;s no difference between the consumer 8-series chipsets and the &quot;workstation&quot; version with respect to isolation.</p><div class="quotebox"><blockquote><div><p>It seems that what you&#039;re applying quircks to, is to force to enable it anyways (Similar to Intel only allowing you to use the Unlocked Multiplier of their K Series Processors on Z Chipset Motherboards, while some manufacturers discovered ways to bypass that to overclock in cheaper Chipsets: <a href="http://www.xbitlabs.com/news/mainboards/display/20130627185823_Asrock_Confirms_Non_Z_CPU_Multiplier_Overclocking_Feature_on_Mainstream_Mainboards.html" rel="nofollow">http://www.xbitlabs.com/news/mainboards … oards.html</a> ). Since you were unaware that Intel sells VT-d support as an extra feature in some Chipsets at the first place, its probable that these quircks are related to that.<br />What I&#039;m missing is having a lot of IOMMU Groups examples on different platforms. I know how mine in a C226 looks. I know the guy with the Z97 that I posted (Which I think he mentioned to not be using the ACS Override patch), and recall a few more consumer platforms with that same arrangement on other Desktop 8-Series. It is not in-depth enough to confirm this, but I&#039;m inclined to believe than that is what VT-d support on the Chipset means for Intel. It seems that the IOMMU isolation capabilities are exclusive for the Chipset PCIe Controller instead of a global one.</p></div></blockquote></div><p>Trust me, I know IOMMU groups.&#160; You don&#039;t need to apply the ACS patch because a) there&#039;s already a kernel-based workaround in place for PCH root ports and b) you&#039;re not using the processor based root ports in a way that exposes the lack of isolation.&#160; You have not discovered some secret decoder for device isolation in ark.&#160; Don&#039;t believe me, run &#039;dmesg | grep &quot;Intel PCH root port ACS workaround enabled&quot;&#039; &lt;-- that&#039;s why your IOMMU groups look the way they do.&#160; You&#039;re welcome.</p><div class="quotebox"><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>along with workstation and server class chipsets like X79 and X99.</p></div></blockquote></div><p>These are high end Desktop. Workstation and Server class are their same-silicon and more expensive C counterparts, C202, C204 and C206 for Sandy Bridge-E/Ivy Bridge-E, and C216 for Haswell-E.</p></div></blockquote></div><p>No, if anything it&#039;s the other way, the C series are just rebranded desktop chipsets, the X series actually add more high-end features and are different silicon.</p><div class="quotebox"><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>If i recall correctly, IOMMU feature was present and was even working on athlon 64 x2 series of CPUs, that was, like, eight years ago. That sparkles my curiosity to try using vfio on these platforms and see how it works. (sadly, my local hardware mess-market was closed some time ago due to fire safety concerns)</p></div></blockquote></div><p>AMD-Vi was first supported on Desktop Chipsets with the 890FX, that was during the Phenom II era. 990FX supports it too. However, Bulldozer and derivated processors also incorporate their own IOMMU, so you don&#039;t need Chipset (Similar to Intel).</p></div></blockquote></div><p>This we can agree on, I think.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1522762">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1522858" class="blockpost roweven"> <h2><span><span class="conr">#4902</span> <a href="viewtopic.php?pid=1522858#p1522858">2015-04-24 16:25:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>False, while AMD did manage to get ACS on root ports, we still have ACS quirks for other AMD devices.</p></div></blockquote></div><p>Did you mean <a href="https://bugzilla.kernel.org/show_bug.cgi?id=81841" rel="nofollow">this</a>?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You certainly won&#039;t find it on Athlon 64 hardware with AMD-Vi.</p></div></blockquote></div><p>What about K10.5(Kuma) athlons, which have their microarch &quot;backported&quot; from phenoms II? Except they were AM2+ socket-based, so their chipsets were only 7XX, which, i believe, do not support IOMMU?</p><br /><p>Well, now it makes sense. FX-line is semi-dead(Hail Opteron-X, it is an APU), and all APUs have Unified North Bridge and will only differ by FCH, which isn&#039;t so important in IOMMU working, right?</p><p>So if intel would make their new chipsets as rare as AMD does, there wouldn&#039;t be such a great difference in quirks per <span class="bbs">second</span>time.</p><br /><p>P.S.<br />Why do I remember quirks.c file having only seven lines?..</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1522858">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1522861" class="blockpost rowodd"> <h2><span><span class="conr">#4903</span> <a href="viewtopic.php?pid=1522861#p1522861">2015-04-24 16:48:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90340">paperinick</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-14</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90340">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paperinick wrote:</cite><blockquote><div><p>Hello all, I have the follow setup:<br />1. intel motherboard with Xeon CPU (E3)<br />2. NVidia Quadro 2000 (no UEFI support)</p><p>With the IGD as primary, I tried applying the patches on a Ubuntu server installation though an older kernel (3.13) as explained here: <a href="http://ubuntuforums.org/showthread.php?t=2266916" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2266916</a> . Everything works fine until I assign an additional PCI device to the VM. In which case the host just completely hangs after the VM shutdown. If I don&#039;t assign extra PCI devices to the machine, it works fine, reboots as expected, etc.<br />I added an AMD/ATI graphic card and set it as primary display. I disabled the NVIDIA display and when I launch the VM everything works fine, but the VM doesn&#039;t survive a reboot. It seems that at the first reboot the NVidia doesn&#039;t properly reset.</p><p>Any hint on what to investigate?<br />Thanks!</p></div></blockquote></div><p>I did a lots of experiments with the patches and an extra VGA. So the issues boils down to this and maybe a bug (in Qemu?) :<br />if the VM starts, the GPU gets in a &quot;weird&quot; internal state. If I kill the VM before Windows starts the NVidia driver, the VM won&#039;t boot anymore until the host is reset. What is worst is that any attempt to reboot the guest VM will cause the host to apparently freeze (I don&#039;t know if it&#039;s just the graphic, I will try to ssh to the host in the frozen state). If Windows start the NVidia driver the GPU is properly put into a &quot;bootable&quot; state and all is nice and fine. <br />Later I will try to see what happens by using virsh to boot and shutdown the VM.<br />Has anybody experienced anything similar?<br />Thanks (more details to follow).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1522861">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1522870" class="blockpost roweven"> <h2><span><span class="conr">#4904</span> <a href="viewtopic.php?pid=1522870#p1522870">2015-04-24 17:13:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>False, while AMD did manage to get ACS on root ports, we still have ACS quirks for other AMD devices.</p></div></blockquote></div><p>Did you mean <a href="https://bugzilla.kernel.org/show_bug.cgi?id=81841" rel="nofollow">this</a>?</p></div></blockquote></div><p>Yeah, that added to a set of quirks that were already there for devices attached to the AMD southbridge</p><div class="quotebox"><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You certainly won&#039;t find it on Athlon 64 hardware with AMD-Vi.</p></div></blockquote></div><p>What about K10.5(Kuma) athlons, which have their microarch &quot;backported&quot; from phenoms II? Except they were AM2+ socket-based, so their chipsets were only 7XX, which, i believe, do not support IOMMU?</p></div></blockquote></div><p>I&#039;d guess not.</p><div class="quotebox"><blockquote><div><p>Well, now it makes sense. FX-line is semi-dead(Hail Opteron-X, it is an APU), and all APUs have Unified North Bridge and will only differ by FCH, which isn&#039;t so important in IOMMU working, right?</p></div></blockquote></div><p>Yeah, they look a lot more similar to an Intel processor+PCH model.&#160; Isolation is not required for the IOMMU itself, but we require isolation to make device assignment safe.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1522870">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1522873" class="blockpost rowodd"> <h2><span><span class="conr">#4905</span> <a href="viewtopic.php?pid=1522873#p1522873">2015-04-24 17:16:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paperinick wrote:</cite><blockquote><div><div class="quotebox"><cite>paperinick wrote:</cite><blockquote><div><p>Hello all, I have the follow setup:<br />1. intel motherboard with Xeon CPU (E3)<br />2. NVidia Quadro 2000 (no UEFI support)</p><p>With the IGD as primary, I tried applying the patches on a Ubuntu server installation though an older kernel (3.13) as explained here: <a href="http://ubuntuforums.org/showthread.php?t=2266916" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2266916</a> . Everything works fine until I assign an additional PCI device to the VM. In which case the host just completely hangs after the VM shutdown. If I don&#039;t assign extra PCI devices to the machine, it works fine, reboots as expected, etc.<br />I added an AMD/ATI graphic card and set it as primary display. I disabled the NVIDIA display and when I launch the VM everything works fine, but the VM doesn&#039;t survive a reboot. It seems that at the first reboot the NVidia doesn&#039;t properly reset.</p><p>Any hint on what to investigate?<br />Thanks!</p></div></blockquote></div><p>I did a lots of experiments with the patches and an extra VGA. So the issues boils down to this and maybe a bug (in Qemu?) :<br />if the VM starts, the GPU gets in a &quot;weird&quot; internal state. If I kill the VM before Windows starts the NVidia driver, the VM won&#039;t boot anymore until the host is reset. What is worst is that any attempt to reboot the guest VM will cause the host to apparently freeze (I don&#039;t know if it&#039;s just the graphic, I will try to ssh to the host in the frozen state). If Windows start the NVidia driver the GPU is properly put into a &quot;bootable&quot; state and all is nice and fine. <br />Later I will try to see what happens by using virsh to boot and shutdown the VM.<br />Has anybody experienced anything similar?<br />Thanks (more details to follow).</p></div></blockquote></div><p>You have a Quadro 2000, just assigned it as a secondary device and be done with it.&#160; <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-device-GPU.html" rel="nofollow">https://access.redhat.com/documentation … e-GPU.html</a></p><p>If it doesn&#039;t work, update kernel and/or QEMU.&#160; Note that only K-series Quadros are actually supported, but Fermi are likely to work.&#160; Quadro cards do not work well when configured as the primary display for a VM.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1522873">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523059" class="blockpost roweven"> <h2><span><span class="conr">#4906</span> <a href="viewtopic.php?pid=1523059#p1523059">2015-04-25 10:30:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77641">zir_blazer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 35</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>There&#039;s no difference between the consumer 8-series chipsets and the &quot;workstation&quot; version with respect to isolation.</p></div></blockquote></div><p>There MUST be a difference somewhere. Both ASUS and Supermicro previously did some comments about that. In the case of ASUS, their excuse to never bother making proper DMAR Tables for Intel Motherboards was that non-Q/C Chipsets didn&#039;t &quot;fully supported VT-d&quot;, which they stated numerous times quite adamantly. Examples here:</p><br /><p><a href="http://rog.asus.com/forum/showthread.php?48550-VT-d-support-on-M7G&amp;s=b62e2e277431dd09c0f4958f637b895f&amp;p=412844&amp;viewfull=1#post412844" rel="nofollow">http://rog.asus.com/forum/showthread.ph … post412844</a></p><div class="quotebox"><cite>Raja@ASUS wrote:</cite><blockquote><div><p>Thats because the chipset does not officially support it either. Some of the tests will pass so some motherboard vendors will claim to have support, BUT if you search you&#039;ll find the same vendors have issues with certain Vt-d features also. We don&#039;t want to play that game.</p><p>For an ablsoute guarantee of Vt-d one needs to purchase a Q series chipset.</p></div></blockquote></div><br /><p><a href="http://www.overclock.net/t/1488891/asus-z97-motherboards-official-support-thread/100_100#post_22328891" rel="nofollow">http://www.overclock.net/t/1488891/asus … t_22328891</a></p><div class="quotebox"><cite>Raja@ASUS wrote:</cite><blockquote><div><p>Just how Intel have done it for a few generations now. I have seen no documentation (yet) that suggests that VT-d IO is supported on the Z series of chipsets. Z87 was the same. Q series only. If that has changed its news to me (but not impossible).</p><p><a href="http://ark.intel.com/products/82012" rel="nofollow">http://ark.intel.com/products/82012</a> Does not show any Vt-d support there yet does it?</p><p>Some of the other vendors have claimed Vt-D for a few generations, but all 50 Vt-d tests did not pass on their boards. We won&#039;t claim support when that happens. Other vendors have more lax rules.</p></div></blockquote></div><br /><p><a href="http://www.overclock.net/t/1488891/asus-z97-motherboards-official-support-thread/100_100#post_22329055" rel="nofollow">http://www.overclock.net/t/1488891/asus … t_22329055</a></p><div class="quotebox"><cite>Raja@ASUS wrote:</cite><blockquote><div><p>The Vt-D support was not full directed IO and all tests will not validate on the Z series chipsets in the past. SO take that for what you will.</p><p>Nothing has chanhed as far as I am aware.</p><br /><p>I end up having to go in this same circle with users on every gen. The CPU supporting and Intel fully enabling it on the chipset are two different things.</p><p>And yes any user finding it works partially inthe usage scenario is lucky, as all tests will not validate - so its a crapshoot. For us the risk in claiming partial support outweighs being honest about it.</p></div></blockquote></div><p>I&#039;m missing one more Post from him where he said that non-Q Chipsets &quot;fails a battery of 25 of 50 tests&quot; or something like that.</p><br /><p>When I asked about VT-d support in a Z87 Motherboard to Supermicro mail support, they replied this:</p><div class="quotebox"><blockquote><div><p>Since Z87 chipset does not support VT-d,&#160; onboard LAN will not support it either because it is connected to PCH PCIe port.&#160; One workaround is to use a VT-d enabled PCIe device and plug it into CPU based PCIe-port on board.&#160; Along with a VT-d enabled CPU the above workaround should work per Intel.</p></div></blockquote></div><br /><p>Also, I just checked the 8-Series Chipset Datasheet, here: <a href="http://www.intel.com/content/dam/www/public/us/en/documents/datasheets/8-series-chipset-pch-datasheet.pdf" rel="nofollow">http://www.intel.com/content/dam/www/pu … asheet.pdf</a></p><p>It mentions this about VT-d support in Chipsets (Page 253):</p><div class="quotebox"><blockquote><div><p>5.29.2 Intel® VT-d Features Supported<br />• The following devices and functions support FLR in the PCH:<br />— High Definition Audio (Device 27: Function 0)<br />— SATA Host Controller 1 (Device 31: Function 2)<br />— SATA Host Controller 2 (Device 31: Function 5)<br />— USB2 (EHCI) Host Controller 1 (Device 29: Function 0)<br />— USB2 (EHCI) Host Controller 2 (Device 26: Function 0)<br />— GbE Lan Host Controller (Device 25: Function 0)<br />• Interrupt virtualization support for IOxAPIC<br />• Virtualization support for HPETs</p></div></blockquote></div><p>However, VT-d itself does not appear on the feature matrix at Page 52. It mentions this instead:</p><div class="quotebox"><blockquote><div><p>2. Table above shows feature differences between the PCH SKUs. If a feature is not listed in the table it is <br />considered a Base feature that is included in all SKUs.</p></div></blockquote></div><p>...But that contradicts previous statements.<br />It may be possible that the IOMMU Groups isolation is unrelated to Q/C Chipsets, however, they are NOT the same. There is a difference somewhere. If you have good contacts with Intel, it may be useful if you get a definite answer about this so you can stop a collection of 3 year old claims.</p><br /><br /><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>No, if anything it&#039;s the other way, the C series are just rebranded desktop chipsets, the X series actually add more high-end features and are different silicon.</p></div></blockquote></div><p>You have two C-Series Chipsets per generation, the ones based on the consumer platform (LGA 1155/1150), like my C226 for Haswell, which you can say that are rebranded consumer Chipsets with a slighty different feature set, and the one for LGA 2011/2011-R3, which is identical silicon to its X counterpart (C612 and X99 for Haswell-E, C602/604/606 and X79 for Sandy Bridge-E/Ivy Bridge-E). However, in that case, the X79/X99 is the most crippled of the two, since they disable the enterprise level features: <a href="http://ark.intel.com/compare/81761,81759" rel="nofollow">http://ark.intel.com/compare/81761,81759</a><br />Besides, you will not find a Dual Socket X99 Motherboards, that&#039;s C612s segment, asserting its highendness.</p><br /><p>Also, here is another example in a Datasheet: <a href="http://www.intel.com/content/dam/www/public/us/en/documents/datasheets/c600-series-chipset-datasheet.pdf" rel="nofollow">http://www.intel.com/content/dam/www/pu … asheet.pdf</a></p><p>On Page 49 and 50 you see mentions to VT-d and X79 NOT supporting it, reinforcing that it was supposed to be a Server feature. Moreover, some of the C6xx had an integrated SAS Controller, which X79 did not. A Motherboard manufacturer even managed to hack their way to include it in a X79 based product: <a href="http://www.legitreviews.com/ecs-enables-intel-x79-sas-ports-on-x79r-ax-motherboard_1833" rel="nofollow">http://www.legitreviews.com/ecs-enables … board_1833</a></p><p>Yes, I know that you can get VT-d working anyways. But there is a missing piece in the puzzle.</p> <p class="postedit"><em>Last edited by zir_blazer (2015-04-25 12:12:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523059">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523124" class="blockpost rowodd"> <h2><span><span class="conr">#4907</span> <a href="viewtopic.php?pid=1523124#p1523124">2015-04-25 15:10:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Googling around revealed that AER Errors are quite common when using Nvidia on X99 .</p><p>Also it is reported that using this kernel parameter makes the error go away :</p><div class="codebox"><pre><code>pci=nommconf</code></pre></div><p>Does this option affect the working of VFIO &amp; GPU passthrough ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523124">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523126" class="blockpost roweven"> <h2><span><span class="conr">#4908</span> <a href="viewtopic.php?pid=1523126#p1523126">2015-04-25 15:26:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@aw :</p><p>Googling around revealed that AER Errors are quite common when using Nvidia on X99 .</p><p>Also it is reported that using this kernel parameter makes the error go away :</p><div class="codebox"><pre><code>pci=nommconf</code></pre></div><p>Does this option affect the working of VFIO &amp; GPU passthrough ?</p></div></blockquote></div><p>mmconf is the mechanism to get to PCI extended configuration space.&#160; AER is an extended capability, so disabling access to it disables AER.&#160; nommconf is a rather large hammer though, why not just disable AER with pci=noaer?&#160; nommconf won&#039;t prevent VFIO, but ACS is also an extended capability, so you may find more isolation issues using it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523126">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523138" class="blockpost rowodd"> <h2><span><span class="conr">#4909</span> <a href="viewtopic.php?pid=1523138#p1523138">2015-04-25 16:03:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yup . In fact , pci=nommconf results in Code 43 .</p><p>Will try pci=noaer now <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>EDIT : There are a couple of PCI-E options in BIOS that I enabled now . Hopefully they would make the issue go away . If not I will try pci=noaer .</p><p>EDIT 2 : When I launch both of my GT610 VM and GTX770 VM , I notice that GTX770 got ecap hiding message in dmesg :</p><div class="codebox"><pre><code>vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900</code></pre></div><p>but there is nothing similar for the GT610 . Could this be a cause for the reset issues I&#039;m having with GT610 ?</p> <p class="postedit"><em>Last edited by Denso (2015-04-25 16:15:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523138">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523184" class="blockpost roweven"> <h2><span><span class="conr">#4910</span> <a href="viewtopic.php?pid=1523184#p1523184">2015-04-25 19:21:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>EDIT 2 : When I launch both of my GT610 VM and GTX770 VM , I notice that GTX770 got ecap hiding message in dmesg :</p><div class="codebox"><pre><code>vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900</code></pre></div><p>but there is nothing similar for the GT610 . Could this be a cause for the reset issues I&#039;m having with GT610 ?</p></div></blockquote></div><p>That&#039;s just an informational message.&#160; If you don&#039;t see the same on the GT610, it&#039;s because the card doesn&#039;t have that capability.&#160; I can&#039;t imagine how it would contribute to the reset problem.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523184">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523188" class="blockpost rowodd"> <h2><span><span class="conr">#4911</span> <a href="viewtopic.php?pid=1523188#p1523188">2015-04-25 19:38:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks !</p><p>It seems that getting rid of it and get a 900 series GPU is the next move&#160; <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523188">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523319" class="blockpost roweven"> <h2><span><span class="conr">#4912</span> <a href="viewtopic.php?pid=1523319#p1523319">2015-04-26 08:37:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90649">scarface_the_fox</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-26</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90649">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone</p><p>i have been for the past 4 days trying to install windows 7 using the method in the op&#039;s post and have the vga-passthru working and also passthru the sata controller sofar i have the vga passthru working as it is supposed to but with the sata controller everytime the vm resets the controller is no longer detected and the vm hangs just saying SeaBIOS (version 1.7.5-20140531_171129-lamiak) and i have to restart the entire pc any ideas</p><p>i have totally run out of ideas myself i have made sure that the sata controllers in bios are AHCI and that i even turned hotswap off.</p><p>the init script i use is as follows:<br />#!/bin/bash</p><p>configfile=/etc/vfio-pci1.cfg</p><p>vfiobind() {<br />&#160; &#160; dev=&quot;$1&quot;<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id</p><p>} </p><p>modprobe vfio-pci</p><p>cat $configfile | while read line;do<br />&#160; &#160; &#160; &#160; echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; vfiobind $line<br />done</p><p>sudo qemu-system-x86_64 -vga none -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \<br />-boot menu=on \<br />-smp 4,sockets=1,cores=1,threads=1 \<br />-usb -usbdevice host:046d:c313 \<br />-device vfio-pci,host=02:00.0,bus=pcie.0,x-vga=on \<br />-device vfio-pci,host=02:00.1 \<br />-device vfio-pci,host=0a:00.0 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive id=windcd,format=raw,media=cdrom,file=/home/cassandra/Downloads/en_windo$<br />-drive id=virtio,format=raw,media=cdrom,file=/home/cassandra/Downloads/virtio-w$<br />-net nic,model=virtio -net user \<br />-vga none \<br />-boot menu=on<br />exit 0</p><p>the pc specs are :<br />MOTHERBOARD : Asus sabertooth x79<br />Processor&#160; &#160; &#160; &#160; &#160; &#160;: Intel Core-I7-3820 @ 3.60 (VT-d enabled)<br />ram&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;: 16gb ddr3 <br />HOST gfx&#160; &#160; &#160; &#160; &#160; &#160; : Nvidia geforce 7950<br />guest GFX&#160; &#160; &#160; &#160; &#160; &#160;: Nvidia geforce GTX 660<br />guest sata&#160; &#160; &#160; &#160; &#160; &#160;: Asmedia ASM1062 Serial ATA controller<br />guest HDD&#160; &#160; &#160; &#160; &#160; : hitachi 120gb sata (connected to eSATA)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523319">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523329" class="blockpost rowodd"> <h2><span><span class="conr">#4913</span> <a href="viewtopic.php?pid=1523329#p1523329">2015-04-26 09:30:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>scarface_the_fox wrote:</cite><blockquote><div><p>Hello everyone</p><p>i have been for the past 4 days trying to install windows 7 using the method in the op&#039;s post and have the vga-passthru working and also passthru the sata controller sofar i have the vga passthru working as it is supposed to but with the sata controller everytime the vm resets the controller is no longer detected and the vm hangs just saying SeaBIOS (version 1.7.5-20140531_171129-lamiak) and i have to restart the entire pc any ideas</p><p>i have totally run out of ideas myself i have made sure that the sata controllers in bios are AHCI and that i even turned hotswap off.</p><p>the init script i use is as follows:<br />#!/bin/bash</p><p>configfile=/etc/vfio-pci1.cfg</p><p>vfiobind() {<br />&#160; &#160; dev=&quot;$1&quot;<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id</p><p>} </p><p>modprobe vfio-pci</p><p>cat $configfile | while read line;do<br />&#160; &#160; &#160; &#160; echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; vfiobind $line<br />done</p><p>sudo qemu-system-x86_64 -vga none -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \<br />-boot menu=on \<br />-smp 4,sockets=1,cores=1,threads=1 \<br />-usb -usbdevice host:046d:c313 \<br />-device vfio-pci,host=02:00.0,bus=pcie.0,x-vga=on \<br />-device vfio-pci,host=02:00.1 \<br />-device vfio-pci,host=0a:00.0 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive id=windcd,format=raw,media=cdrom,file=/home/cassandra/Downloads/en_windo$<br />-drive id=virtio,format=raw,media=cdrom,file=/home/cassandra/Downloads/virtio-w$<br />-net nic,model=virtio -net user \<br />-vga none \<br />-boot menu=on<br />exit 0</p><p>the pc specs are :<br />MOTHERBOARD : Asus sabertooth x79<br />Processor&#160; &#160; &#160; &#160; &#160; &#160;: Intel Core-I7-3820 @ 3.60 (VT-d enabled)<br />ram&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;: 16gb ddr3 <br />HOST gfx&#160; &#160; &#160; &#160; &#160; &#160; : Nvidia geforce 7950<br />guest GFX&#160; &#160; &#160; &#160; &#160; &#160;: Nvidia geforce GTX 660<br />guest sata&#160; &#160; &#160; &#160; &#160; &#160;: Asmedia ASM1062 Serial ATA controller<br />guest HDD&#160; &#160; &#160; &#160; &#160; : hitachi 120gb sata (connected to eSATA)</p></div></blockquote></div><p>Use virtio-blk or virtio-scsi instead of passingthrough the controller. It&#039;s working just fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523329">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523401" class="blockpost roweven"> <h2><span><span class="conr">#4914</span> <a href="viewtopic.php?pid=1523401#p1523401">2015-04-26 13:39:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90654">han5</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-26</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90654">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m almost there, I guess, but now Windows doesn&#039;t seem to play along. Windows is starting to boot, though, but shortly after the startup screen (the one looking like this: <a href="http://upload.wikimedia.org/wikipedia/commons/9/97/Windows_8_booting.png" rel="nofollow">http://upload.wikimedia.org/wikipedia/c … ooting.png</a> ) appears, the VM (or at least video output) freezes (i.e. the dots stop spinning and nothing else is happening - no bluescreen).</p><p>Did anyone else had similar issues and could point me in the right direction?</p><p>-------- details --------</p><p>Windows installation was straight forward. After installing virtio drivers the hdd was found, the installer created partitions and copied files. I later mounted the data partition to check it&#039;s contents and it superficially looked like a common windows installation.</p><p>Once the installer was done, it rebooted. Then, according to the message in the following startup screen, it did some further &quot;setting up devices&quot;. At the end of that process, it seemed like the VM hang already but after a few seconds it rebooted again. And now it hangs for real...</p><p>I&#039;m running Ubuntu 15.04 3.16.0-36-generic on host and Windows 8.1 professional in the VM. When setting everything up I laregly followed <a href="http://ubuntuforums.org/showthread.php?t=2266916" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2266916</a>, supplemented with info from this thread.</p><p>The VM is launched with:<br />qemu-system-x86_64 \<br />-enable-kvm \<br />-M q35 \<br />-m 6G \<br />-mem-path /dev/hugepages \<br />-cpu host,kvm=off \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-vga none \<br />-usb -usbdevice host:046d:c52b \<br />-bios /home/user/vm/OVMF-pure-efi.fd \<br />-device virtio-scsi-pci,id=scsi0 \<br />-drive file=/dev/sdc,id=disk,format=raw,if=none -device scsi-hd,bus=scsi0.0,drive=disk \<br />-drive file=/home/user/iso/de_windows_8_1_x64_dvd_xxxxxxx.iso,id=isowindows,if=none -device scsi-cd,bus=scsi0.0,drive=isowindows \<br />-drive file=/home/user/iso/virtio-win-0.1-100.iso,id=isovirtio,if=none -device ide-cd,bus=ide.1,drive=isovirtio \<br />-device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1 \<br />-boot order=cd,menu=on \<br />-k de</p><p>Hardware:<br />Xeon E5-2630v3<br />X99 board<br />ATI R5 230 (host)<br />nvidia GTX960 (passed through)<br />SSD solely for VM (sdc)<br />USB mouse/keyboard combo passed to VM</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523401">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523490" class="blockpost rowodd"> <h2><span><span class="conr">#4915</span> <a href="viewtopic.php?pid=1523490#p1523490">2015-04-26 20:06:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><strong>AMD Bonaire and Hawaii users with reset issues</strong>, please try this QEMU patch (against v2.3.0-rc4): <a href="http://fpaste.org/214053/" rel="nofollow">http://fpaste.org/214053/</a>&#160; Report back your GPU device ID and whether resets are resolved.&#160; As noted in the patch, I expect the ultimate resolution will be a device specific reset in the kernel, this is just a prototype of that.&#160; If you do not have an AMD GPU affected by reset problems (ie. one guest boot per host boot), please don&#039;t bother with this patch.</p></div></blockquote></div><p>Do you think that could help with reset of AMD W7100 ?</p></div></blockquote></div><p>Dunno, try it.&#160; That&#039;s a Tonga GPU, who knows, maybe the bug extends further than Bonaire/Hawaii.</p></div></blockquote></div><p>is it independent from <a href="http://article.gmane.org/gmane.linux.kernel.pci/40663" rel="nofollow">http://article.gmane.org/gmane.linux.kernel.pci/40663</a> , or should I patch my kernel 3.18.12 as well? Or perhaps try with kernel 4.0?</p> <p class="postedit"><em>Last edited by Bronek (2015-04-26 20:06:45)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523490">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523491" class="blockpost roweven"> <h2><span><span class="conr">#4916</span> <a href="viewtopic.php?pid=1523491#p1523491">2015-04-26 20:09:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>is it independent from <a href="http://article.gmane.org/gmane.linux.kernel.pci/40663" rel="nofollow">http://article.gmane.org/gmane.linux.kernel.pci/40663</a> , or should I patch my kernel 3.18.12 as well? Or perhaps try with kernel 4.0?</p></div></blockquote></div><p>Not at all, it should be independent of kernel version.&#160; I&#039;ve also decided that the reset is not reliable enough for the kernel, so this is the patch proposed for QEMU: <a href="https://lists.gnu.org/archive/html/qemu-devel/2015-04/msg03128.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 03128.html</a></p><p>EDIT: Note that this version only enables the reset for specific device IDs.&#160; If you&#039;re looking to try it on something else, you&#039;ll need to add the ID for your hardware to the list.</p> <p class="postedit"><em>Last edited by aw (2015-04-26 20:11:30)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523491">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523502" class="blockpost rowodd"> <h2><span><span class="conr">#4917</span> <a href="viewtopic.php?pid=1523502#p1523502">2015-04-26 21:04:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90664">carterghill</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-26</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:carterghill@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m currently trying to get this working on Ubuntu 14.10 on kernel 3.19 and am having a lot of issues. When I try to boot it with qemu, a see a small black window pop up with: </p><div class="quotebox"><blockquote><div><p>compat_monitor0 console<br />QEMU 2.2.1 monitor - type &#039;help&#039; for more information<br />(qemu)</p></div></blockquote></div><p>and no output from the second monitor (my tv). I have also tried using Virtual Machine Manager, which, after passing through my GTX 760, gives me a virtual window on my main monitor. I installed windows 8.1 on it and saw that I had a code 43 on my GTX 760. I tried installing drivers for it on the guest machine (a few different releases back to 335.23) and none of them solved the issue.</p><p>Here&#039;s my execution script:</p><div class="quotebox"><blockquote><div><p>#!/bin/bash</p><p>configfile=/etc/vfio-pci1.cfg</p><p>vfiobind() {<br />&#160; &#160; dev=&quot;$1&quot;<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id<br />&#160; &#160;<br />}</p><p>modprobe vfio-pci</p><p>cat $configfile | while read line;do<br />&#160; &#160; echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue<br />&#160; &#160; &#160; &#160; vfiobind $line<br />done</p><p>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \<br />-smp 4,sockets=1,cores=1,threads=1 \<br />-bios /usr/share/seabios/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/home/carter/Downloads/EVGA.GTX760.4096.130607.rom \<br />-device vfio-pci,host=07:00.1,bus=root.1,addr=00.1 \<br />-drive file=/home/carter/windows8.img,cache=writeback,if=none,id=drive0,aio=native \<br />-device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/home/carter/Windows_8.1_Pro_X64_Activated.iso,id=iso_install,if=none \<br />-device scsi-cd,drive=iso_install \<br />-boot menu=on</p><p>exit 0</p></div></blockquote></div><p>My output of dmesg | grep pci-stub:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.514450] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 0.514462] pci-stub 0000:07:00.1: claimed by stub<br />[&#160; &#160; 0.514469] pci-stub: add 10DE:1187 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 0.514474] pci-stub 0000:07:00.0: claimed by stub</p></div></blockquote></div><p>The contents of /etc/modules:</p><div class="quotebox"><blockquote><div><p># /etc/modules: kernel modules to load at boot time.<br />#<br /># This file contains the names of kernel modules that should be loaded<br /># at boot time, one per line. Lines beginning with &quot;#&quot; are ignored.<br /># Parameters can be specified after the module name.<br />pci_stub<br />vfio<br />vfio_iommu_type1<br />vfio_pci<br />kvm<br />kvm_intel</p></div></blockquote></div><p>The contents of /etc/default/grub:</p><div class="quotebox"><blockquote><div><p># If you change this file, run &#039;update-grub&#039; afterwards to update<br /># /boot/grub/grub.cfg.<br /># For full documentation of the options in this file, see:<br />#&#160; &#160;info -f grub -n &#039;Simple configuration&#039;</p><p>GRUB_DEFAULT=&quot;0&quot;<br />#GRUB_HIDDEN_TIMEOUT=&quot;0&quot;<br />GRUB_HIDDEN_TIMEOUT_QUIET=&quot;true&quot;<br />GRUB_TIMEOUT=&quot;10&quot;<br />GRUB_DISTRIBUTOR=&quot;`lsb_release -i -s 2&gt; /dev/null || echo Debian`&quot;<br />GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pcie_acs_override=downstream i915.enable_hd_vgaarb=1&quot;<br />GRUB_CMDLINE_LINUX=&quot;&quot;</p><p># Uncomment to enable BadRAM filtering, modify to suit your needs<br /># This works with Linux (no patch required) and with any kernel that obtains<br /># the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)<br />#GRUB_BADRAM=&quot;0x01234567,0xfefefefe,0x89abcdef,0xefefefef&quot;</p><p># Uncomment to disable graphical terminal (grub-pc only)<br />#GRUB_TERMINAL=&quot;console&quot;</p><p># The resolution used on graphical terminal<br /># note that you can use only modes which your graphic card supports via VBE<br /># you can see them in real GRUB with the command `vbeinfo&#039;<br />#GRUB_GFXMODE=&quot;640x480&quot;</p><p># Uncomment if you don&#039;t want GRUB to pass &quot;root=UUID=xxx&quot; parameter to Linux<br />#GRUB_DISABLE_LINUX_UUID=&quot;true&quot;</p><p># Uncomment to disable generation of recovery mode menu entries<br />#GRUB_DISABLE_RECOVERY=&quot;true&quot;</p><p># Uncomment to get a beep at grub start<br />#GRUB_INIT_TUNE=&quot;480 440 1&quot;</p></div></blockquote></div><p> I have tried the ACS and i915 patches, neither of which helped. However, I&#039;m not entirely sure I did it right because I haven&#039;t found a clear quide on how to apply them. I tried it the way done in <a href="http://ubuntuforums.org/showthread.php?t=2262280" rel="nofollow">this guide</a>.</p><p>My specs are:<br />Gigabyte H77 motherboard (with vt-d turned on)<br />NVIDIA GTX 560 for the host<br />EVGA GTX 760 for the guest<br />Intel i5 Quad Core </p><p>Would anybody care to help me out? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523505" class="blockpost roweven"> <h2><span><span class="conr">#4918</span> <a href="viewtopic.php?pid=1523505#p1523505">2015-04-26 21:07:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anybody actually had success following the Ubuntu guide?&#160; Seems like a flood of people following whatever misinformation it contains and landing here.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523505">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523507" class="blockpost rowodd"> <h2><span><span class="conr">#4919</span> <a href="viewtopic.php?pid=1523507#p1523507">2015-04-26 21:17:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>m5a97 pro<br />fx-8320<br />hd 6850<br />8 gb</p><p>qemu-2.2.1<br />seabios-1.8.1</p><p>windows works, no problem to launch some games or benchmarks, but...<br />a lot of hangs during startup (looks like 1 in 10 it can successfully, other times - just logo, or black screen after it), nothing in dmesg or /var/log that could be helpful. If I look in virt-manager it shows CPU usage as a straight line from the moment of hang.</p><p>Could the change of the motherboard helps me? What about sabertooth 990fx r2.0? Or better try Intel?</p><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039;&gt;<br />&#160; &lt;name&gt;windows&lt;/name&gt;<br />&#160; &lt;uuid&gt;80831171-02e1-4c05-be41-011401d13184&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt;<br />&#160; &lt;memoryBacking&gt;<br />&#160; &#160; &lt;hugepages/&gt;<br />&#160; &lt;/memoryBacking&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &#160; &lt;bootmenu enable=&#039;yes&#039;/&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt;<br />&#160; &#160; &lt;model fallback=&#039;allow&#039;&gt;Opteron_G5&lt;/model&gt;<br />&#160; &#160; &lt;vendor&gt;AMD&lt;/vendor&gt;<br />&#160; &#160; &lt;topology sockets=&#039;1&#039; cores=&#039;6&#039; threads=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;perfctr_core&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;skinit&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;tce&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;mmxext&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;topoext&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;fxsr_opt&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;bmi1&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;cr8legacy&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;ibs&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;wdt&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;extapic&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;osvw&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;nodeid_msr&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;perfctr_nb&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;cmp_legacy&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;lwp&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;require&#039; name=&#039;invtsc&#039;/&gt;<br />&#160; &lt;/cpu&gt;<br />&#160; &lt;clock offset=&#039;localtime&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/bin/qemu-wrapper&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; cache=&#039;directsync&#039; io=&#039;threads&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/var/lib/libvirt/images/vm1.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; cache=&#039;directsync&#039; io=&#039;threads&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/driveD.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/Downloads/en_windows_10_pro_10061_x64_dvd.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;3&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/virtio-win-0.1-100.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;4&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;interface type=&#039;network&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:c3:bc:db&#039;/&gt;<br />&#160; &#160; &#160; &lt;source network=&#039;network&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;sound model=&#039;ac97&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x09da&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x0260&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x09da&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0xf643&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&lt;/domain&gt;</p></div></blockquote></div> <p class="postedit"><em>Last edited by walkindude (2015-04-26 21:31:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523507">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523544" class="blockpost roweven"> <h2><span><span class="conr">#4920</span> <a href="viewtopic.php?pid=1523544#p1523544">2015-04-27 01:47:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@carterghill</p><p>rombar=0,romfile=/home/carter/Downloads/EVGA.GTX760.4096.130607.rom</p><p>Do not pass Go, do not collect $200.&#160; This is a bogus combination of arguments that causes QEMU to load the ROM into a legacy ROM space, disassociating it from the device.&#160; I&#039;d remove both arguments and only add back romfile if you need it.</p><p>You don&#039;t need the i915 patch since you don&#039;t have Intel host graphics, which means you also don&#039;t need this:&#160; i915.enable_hd_vgaarb=1</p><p>Chances are you also don&#039;t need this: vfio_iommu_type1.allow_unsafe_interrupts=1</p><p>Personally, given your guest and hardware combination, I&#039;d use a standard 440FX machine, OVMF guest firmware, and you should be able to manage it with libvirt.</p><p>You might even be able to move one of your cards to a PCH root port (probably listed as a PCIe 2.0 port) and avoid needing the ACS override patch.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523544">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523545" class="blockpost rowodd"> <h2><span><span class="conr">#4921</span> <a href="viewtopic.php?pid=1523545#p1523545">2015-04-27 01:57:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@han5</p><p>Try installing TightVNC server in the guest so you can get to the desktop w/o the display and determine if the guest is running or really hung.&#160; You also shouldn&#039;t need x-vga=on since you&#039;re using OVMF (and you&#039;re multifunction=on option isn&#039;t really doing anything since you&#039;re not specifying the addr= to put a secondary function on the device).</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523545">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523547" class="blockpost roweven"> <h2><span><span class="conr">#4922</span> <a href="viewtopic.php?pid=1523547#p1523547">2015-04-27 02:06:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@walkindude</p><p>It looks like you&#039;re running an 8G guest on an 8G host.&#160; Device assignment VMs cannot be overcommitted.&#160; See if you still have problems reducing the VM to 6G or 7G.&#160; The host could be swapping like crazy and timing glitches resulting from that could cause the problems you&#039;re seeing.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523547">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523568" class="blockpost rowodd"> <h2><span><span class="conr">#4923</span> <a href="viewtopic.php?pid=1523568#p1523568">2015-04-27 04:39:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />sorry to be not clear mysefl:<br />Host: 16G<br />Guest: 8G</p><p>Also in /etc/sysctl.d/99-sysctl.conf:</p><p>vm.nr_hugepages = 4400<br />hugepage size: 2048 kB</p><p>Tried to set it to 5500 for example.<br />After boot:</p><p>/proc/meminfo</p><div class="quotebox"><blockquote><div><p>HugePages_Total: 5500<br />HugePages_Free: 1404<br />HugePages_Rsvd: 0<br />HugePages_Surp: 0</p></div></blockquote></div><p>This remained the same after reboots. For now refreshed windows boots as expected, but for how long.</p> <p class="postedit"><em>Last edited by walkindude (2015-04-27 05:18:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523600" class="blockpost roweven"> <h2><span><span class="conr">#4924</span> <a href="viewtopic.php?pid=1523600#p1523600">2015-04-27 08:30:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>is it independent from <a href="http://article.gmane.org/gmane.linux.kernel.pci/40663" rel="nofollow">http://article.gmane.org/gmane.linux.kernel.pci/40663</a> , or should I patch my kernel 3.18.12 as well? Or perhaps try with kernel 4.0?</p></div></blockquote></div><p>Not at all, it should be independent of kernel version.&#160; I&#039;ve also decided that the reset is not reliable enough for the kernel, so this is the patch proposed for QEMU: <a href="https://lists.gnu.org/archive/html/qemu-devel/2015-04/msg03128.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 03128.html</a></p><p>EDIT: Note that this version only enables the reset for specific device IDs.&#160; If you&#039;re looking to try it on something else, you&#039;ll need to add the ID for your hardware to the list.</p></div></blockquote></div><p>Thanks for heads up, I found this:</p><div class="codebox"><pre><code>+ switch (vendor) { + case 0x1002: + switch (device) {</code></pre></div><p>I will amend if necessary for W7100 (don&#039;t remember its device code ATM) and will let you know if it worked. FWIW, <a href="http://article.gmane.org/gmane.linux.kernel.pci/40663" rel="nofollow">http://article.gmane.org/gmane.linux.kernel.pci/40663</a> patched on kernel 3.18.11 (with qemu 2.2.1) have not fixed my problems with W7100 reset, so I&#039;m keen to try something else.</p><p>I wouldn&#039;t have this problem if only R9 290X fitted in single PCIe slot (and one bracket, too)</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523600">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523620" class="blockpost rowodd"> <h2><span><span class="conr">#4925</span> <a href="viewtopic.php?pid=1523620#p1523620">2015-04-27 10:52:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>nope, just turned on my PC, and on the first VM boot got black screen<br />but</p><div class="quotebox"><blockquote><div><p>HugePages_Total: 5500<br />HugePages_Free: 1404<br />HugePages_Rsvd: 0<br />HugePages_Surp: 0</p></div></blockquote></div><p>free -m</p><div class="quotebox"><blockquote><div><p>total: 15977<br />used: 11962<br />free 2550<br />shared: 86<br />buff/cache: 1466<br />available: 3608</p></div></blockquote></div><p>Could it be errors in DSDT? Some time ago I&#039;ve tried to do <a href="https://wiki.archlinux.org/index.php/DSDT" rel="nofollow">https://wiki.archlinux.org/index.php/DSDT</a>, out of scientific interest <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Had fixed errors and warnings, but then during my first tries on passthrough, didn&#039;t get after seabios - black screen. Then I tried to do without it. System boots for some time, like 4-8 times, and then shit happens. Didn&#039;t install to much: just Visual Studio, Qt, Steam...</p><p>Also in dmesg (not always see that, maybe it&#039;s a culprit):</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 5.173608] kvm: Nested Virtualization enabled<br />[&#160; &#160; 5.173615] kvm: Nested Paging enabled &lt;- tried with and without, nothing seems changed<br />[&#160; &#160;83.226853] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; &#160;92.263251] kvm [3109]: vcpu3 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; &#160;92.263255] kvm [3109]: vcpu4 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; &#160;92.263256] kvm [3109]: vcpu0 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; &#160;92.263259] kvm [3109]: vcpu5 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; &#160;92.263260] kvm [3109]: vcpu1 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; &#160;92.263262] kvm [3109]: vcpu4 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; &#160;92.263296] kvm [3109]: vcpu3 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; 451.669332] kvm [3109]: vcpu3 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; 451.669335] kvm [3109]: vcpu4 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; 451.669337] kvm [3109]: vcpu0 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; 451.669341] kvm [3109]: vcpu2 unimplemented perfctr wrmsr: 0xc0010004 data 0xffffffffffffd8f0<br />[&#160; 451.669345] kvm [3109]: vcpu5 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; 451.669347] kvm [3109]: vcpu4 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; 451.669349] kvm [3109]: vcpu0 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; 451.669352] kvm [3109]: vcpu2 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076<br />[&#160; 451.669361] kvm [3109]: vcpu3 unimplemented perfctr wrmsr: 0xc0010000 data 0x530076</p></div></blockquote></div> <p class="postedit"><em>Last edited by walkindude (2015-04-27 12:43:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523620">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=196">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <strong>197</strong> <a href="viewtopic.php?id=162768&amp;p=198">198</a> <a href="viewtopic.php?id=162768&amp;p=199">199</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=198">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
