<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 202) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=202" title="Page 202" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=201" title="Page 201" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=203" title="Page 203" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=201">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <strong>202</strong> <a href="viewtopic.php?id=162768&amp;p=203">203</a> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=203">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1526599" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5026</span> <a href="viewtopic.php?pid=1526599#p1526599">2015-05-06 22:42:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52587">Fira</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-24</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52587">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, after lots of testing and much annoying of the EDK2 developpers, i realized that my DreamSpark Win8.1 and Win7 ISO are in UDF Format - which is currently not supported by EDK2/OVMF. I&#039;m still not sure to understand why in 200 pages, there&#039;s been only one other occurence of the problem reported, I can only assume the majority of the Win8 ISOs are in fact no UDF...</p><p>After trying to convert the image to FAT32 and ISO9660 i got bootable images on the EFI side, only to get hit by a crash on the Windows Bootloader.<br />I just realized I could work around this whole mess by making ... a bootable USB key and ... passing it through to the VM... Yeah.<br />Leaving this here in case the experiment goes wrong. I&#039;ll report on wether it worked or not if I&#039;m still alive by then.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526599">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526600" class="blockpost roweven"> <h2><span><span class="conr">#5027</span> <a href="viewtopic.php?pid=1526600#p1526600">2015-05-06 22:46:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I recently switched to i3 for everyday use, and I noticed my virtual machine has no sound anymore.<br />Pulseaudio seems to be running, I can correctly change volumes and outputs with pavucontrol, and every other applications plays&#160; sound normally.</p><p>However when I switch to a full-on DE, Mate in my case, I do have sound in the vm. I&#039;m not sure what&#039;s up here.</p><p>My launch script:</p><div class="codebox"><pre><code>QEMU_AUDIO_DRV=all qemu-system-x86_64 -L . -enable-kvm -m 8096 -cpu host,kvm=off -smp 6,sockets=1,cores=6,threads=1 -vga none \ -device vfio-pci,host=02:00.0,x-vga=on -device vfio-pci,host=02:00.1 -device vfio-pci,host=00:19.0 -device vfio-pci,host=04:00.0 \ -device virtio-scsi-pci,id=scsi1 -drive file=/dev/sdb,id=ssddisk,format=raw,if=none -device scsi-hd,drive=ssddisk \ -device virtio-scsi-pci,id=scsi2 -drive file=/dev/sdd,id=hdddisk,format=raw,if=none -device scsi-hd,drive=hdddisk \ -usb -usbdevice host:0738:2215 -usbdevice host:0738:a215 -usbdevice host:13d3:3404 -usbdevice host:2516:0011 -usbdevice host:1532:0033 \ -usbdevice host:054c:0268 -soundhw hda</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526600">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526603" class="blockpost rowodd"> <h2><span><span class="conr">#5028</span> <a href="viewtopic.php?pid=1526603#p1526603">2015-05-06 22:58:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p>I&#039;m still not sure to understand why in 200 pages, there&#039;s been only one other occurence of the problem reported, I can only assume the majority of the Win8 ISOs are in fact no UDF...</p></div></blockquote></div><p>...because this thread isn&#039;t related to &quot;installing windowns into QEMU virtual machine&quot;?</p><p>And why do i have the habit of tearing apart windowns&#039; install media and actually understanding how it&#039;s supposed to boot?..<br />You can tear that darn install media into two partitions on two separate disks, and it&#039;ll still work, if you put enough duct tape everywhere. Actually, that&#039;s how it works when using the USB thumb drive method.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526603">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526607" class="blockpost roweven"> <h2><span><span class="conr">#5029</span> <a href="viewtopic.php?pid=1526607#p1526607">2015-05-06 23:30:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52587">Fira</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-24</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52587">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p>I&#039;m still not sure to understand why in 200 pages, there&#039;s been only one other occurence of the problem reported, I can only assume the majority of the Win8 ISOs are in fact no UDF...</p></div></blockquote></div><p>...because this thread isn&#039;t related to &quot;installing windowns into QEMU virtual machine&quot;?</p></div></blockquote></div><p>I&#039;m not sure what your problem is or why you&#039;re even saying this.&#160; <br />Am just reporting that there are potential, although uncommon, issues with Windows 7/8 installation on OVMF due to unusual ISOs, which is pretty much a requirement for effective VGA passthrough ?</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And why do i have the habit of tearing apart windowns&#039; install media and actually understanding how it&#039;s supposed to boot?..</p></div></blockquote></div><p>I&#039;m terribly sorry, i thought this was a Community Forum, I clearly didn&#039;t realize this was your personal mailbox.</p><p>Edit: If anyone even cares about the whole UDF mess, <br /> - Microsoft&#039;s USB Creator won&#039;t take the ISO because it&#039;s non-standard<br /> - LiLi USB Creator is not UDF aware and just prints out a README<br /> - Rufus seems to actually do the job, up to the moment you try to boot it and it doesn&#039;t work</p> <p class="postedit"><em>Last edited by Fira (2015-05-06 23:39:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526607">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526619" class="blockpost rowodd"> <h2><span><span class="conr">#5030</span> <a href="viewtopic.php?pid=1526619#p1526619">2015-05-07 02:06:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p>Edit: If anyone even cares about the whole UDF mess, <br /> - Microsoft&#039;s USB Creator won&#039;t take the ISO because it&#039;s non-standard<br /> - LiLi USB Creator is not UDF aware and just prints out a README<br /> - Rufus seems to actually do the job, up to the moment you try to boot it and it doesn&#039;t work</p></div></blockquote></div><p>Where did you even get this image? DreamSpark you say?.. Isn&#039;t that Microsoft&#039;s Live File System images, intended for something like live, bootable images? I mean, technically you can add files to the burned disc, that would be somewhat useful for a live system or some weird updates of the install media.<br />Can you just extract all the files from that image, and make ESP(containing /BOOT/BOOTX64.EFI or how was that file should be named) and data partition manually? That should be somewhat simpler to do than dealing with various usb creating software.</p><p><span class="bbs">If you have dreamspark access, why you didn&#039;t go straight to <a href="https://msdn.microsoft.com/en-us/subscriptions/downloads/hh442898.aspx" rel="nofollow">MSDN</a>? MSDN is known to supply normal, ISO9660 images.</span> God damn microsoft, subscription is paid-only.</p><p>UPD:Looking at the images, there&#039;s Server2012R2 with ISO9660 <span class="bbu">and</span> UDF1.02 available on dreamspark. That looks weird.<br />Seems like the only way around is to tear them up manually.</p><div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p>Windows 7/8 installation on OVMF due to unusual ISOs, which is pretty much a requirement for effective VGA passthrough</p></div></blockquote></div><p>Why, you could always install linux into your VM, it&#039;d just be another usecase of this tech. For example, i need to provide a <span class="bbu">remote</span> workplace for some 3D-guy working in blender and i don&#039;t like buying citrix xenapp or vsphere or whatever... ... darn, i should definitely try doing that to see the bandwidth issues.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-07 10:25:36)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526619">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526686" class="blockpost roweven"> <h2><span><span class="conr">#5031</span> <a href="viewtopic.php?pid=1526686#p1526686">2015-05-07 11:06:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>I&#039;ve seen some people here have GT610 with EFI support. Can anybody share the rom? My card comes only with VGA and I can&#039;t contact the vendor&#039;s support to get a newer rom from them.</p></div></blockquote></div><p>Using <a href="https://github.com/envytools/envytools" rel="nofollow">envytools&#039; nvagetbios -s prom</a>, here&#039;s my GT610&#039;s <a href="http://rghost.net/8BmRpc4r5" rel="nofollow">VBIOS.</a> It&#039;s a <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16814125427" rel="nofollow">Gigabyte Gigabyte(sic!) GT610</a>.<br />After 90 days the file will be automagically deleted, sorry about that.</p></div></blockquote></div><p>Thanks a bunch! It works with my <a href="https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/" rel="nofollow">https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/</a> So, yet another working win7 efi setup.</p><p>A pity rebooting doesn&#039;t work (I think I have the same problem as you). Perhaps it&#039;s somehow related to the VBIOS. Anybody else mind sharing their VBIOS for gt610?</p><p>P.S. Wish QXL wouldn&#039;t stop working when a passed card is active. It works in win 8.1! I get two screens one on a physical card and one on a qxl card. Why win 7 can&#039;t do it? :x</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526686">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526780" class="blockpost rowodd"> <h2><span><span class="conr">#5032</span> <a href="viewtopic.php?pid=1526780#p1526780">2015-05-07 16:55:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75548">Schlunze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-03</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ts_reload@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>ist it only possible to passthrough whole iommu groups?<br />VGA passthrough works like charm for two months now. <br />Recently i´ve experimenting to get dual boot to work with a native installed Win7 on /dev/sdg.<br />So i have to passthrough ASM1602 SATA controller. <br />The problem is sde and sdf shoud be accessible on host.</p><div class="codebox"><pre><code>ls -l /sys/block/ | grep sd. lrwxrwxrwx 1 root root 0 7. Mai 16:53 sda -&gt; ../devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda lrwxrwxrwx 1 root root 0 7. Mai 16:53 sdb -&gt; ../devices/pci0000:00/0000:00:1f.2/ata2/host1/target1:0:0/1:0:0:0/block/sdb lrwxrwxrwx 1 root root 0 7. Mai 16:53 sdc -&gt; ../devices/pci0000:00/0000:00:1f.2/ata3/host2/target2:0:0/2:0:0:0/block/sdc lrwxrwxrwx 1 root root 0 7. Mai 16:53 sdd -&gt; ../devices/pci0000:00/0000:00:1f.2/ata4/host3/target3:0:0/3:0:0:0/block/sdd lrwxrwxrwx 1 root root 0 7. Mai 16:53 sde -&gt; ../devices/pci0000:00/0000:00:1c.3/0000:04:00.0/0000:05:03.0/0000:07:00.0/ata7/host6/target6:0:0/6:0:0:0/block/sde lrwxrwxrwx 1 root root 0 7. Mai 16:53 sdf -&gt; ../devices/pci0000:00/0000:00:1c.3/0000:04:00.0/0000:05:03.0/0000:07:00.0/ata8/host7/target7:0:0/7:0:0:0/block/sdf lrwxrwxrwx 1 root root 0 7. Mai 16:53 sdg -&gt; ../devices/pci0000:00/0000:00:1c.3/0000:04:00.0/0000:05:07.0/0000:09:00.0/ata9/host8/target8:0:0/8:0:0:0/block/sdg lrwxrwxrwx 1 root root 0 7. Mai 17:43 sdh -&gt; ../devices/pci0000:00/0000:00:14.0/usb1/1-5/1-5:1.0/host10/target10:0:0/10:0:0:0/block/sdh</code></pre></div><p>This is the big Z97 group</p><div class="codebox"><pre><code>### Group 9 ### 00:1c.0 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 1 (rev d0) 00:1c.2 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 3 (rev d0) 00:1c.3 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 4 (rev d0) 00:1c.6 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 7 (rev d0) 03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 11) 04:00.0 PCI bridge: ASMedia Technology Inc. Device 1184 05:01.0 PCI bridge: ASMedia Technology Inc. Device 1184 05:03.0 PCI bridge: ASMedia Technology Inc. Device 1184 05:05.0 PCI bridge: ASMedia Technology Inc. Device 1184 05:07.0 PCI bridge: ASMedia Technology Inc. Device 1184 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) 09:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) 0a:00.0 USB controller: ASMedia Technology Inc. ASM1042A USB 3.0 Host Controller</code></pre></div><p>Is it somehow possible to passthrough only 09:00.0? </p><p>Thank you in advance</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526780">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526784" class="blockpost roweven"> <h2><span><span class="conr">#5033</span> <a href="viewtopic.php?pid=1526784#p1526784">2015-05-07 17:01:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>9-series PCH root port quirks will probably go in for kernel 4.2</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526784">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526797" class="blockpost rowodd"> <h2><span><span class="conr">#5034</span> <a href="viewtopic.php?pid=1526797#p1526797">2015-05-07 17:50:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>I&#039;ve seen some people here have GT610 with EFI support. Can anybody share the rom? My card comes only with VGA and I can&#039;t contact the vendor&#039;s support to get a newer rom from them.</p></div></blockquote></div><p>Using <a href="https://github.com/envytools/envytools" rel="nofollow">envytools&#039; nvagetbios -s prom</a>, here&#039;s my GT610&#039;s <a href="http://rghost.net/8BmRpc4r5" rel="nofollow">VBIOS.</a> It&#039;s a <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16814125427" rel="nofollow">Gigabyte Gigabyte(sic!) GT610</a>.<br />After 90 days the file will be automagically deleted, sorry about that.</p></div></blockquote></div><p>Thanks a bunch! It works with my <a href="https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/" rel="nofollow">https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/</a> So, yet another working win7 efi setup.</p><p>A pity rebooting doesn&#039;t work (I think I have the same problem as you). Perhaps it&#039;s somehow related to the VBIOS. Anybody else mind sharing their VBIOS for gt610?</p><p>P.S. Wish QXL wouldn&#039;t stop working when a passed card is active. It works in win 8.1! I get two screens one on a physical card and one on a qxl card. Why win 7 can&#039;t do it? :x</p></div></blockquote></div><p>Rebooting doesn&#039;t work?.. Haven&#039;t heard about it. My Radeon-based VM system reboots just fine.<br />Anyway, i can conclude that Asus can not into UEFI properly.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526797">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526829" class="blockpost roweven"> <h2><span><span class="conr">#5035</span> <a href="viewtopic.php?pid=1526829#p1526829">2015-05-07 19:11:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Using <a href="https://github.com/envytools/envytools" rel="nofollow">envytools&#039; nvagetbios -s prom</a>, here&#039;s my GT610&#039;s <a href="http://rghost.net/8BmRpc4r5" rel="nofollow">VBIOS.</a> It&#039;s a <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16814125427" rel="nofollow">Gigabyte Gigabyte(sic!) GT610</a>.<br />After 90 days the file will be automagically deleted, sorry about that.</p></div></blockquote></div><p>Thanks a bunch! It works with my <a href="https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/" rel="nofollow">https://www.asus.com/us/Graphics_Cards/GT610SL1GD3L/</a> So, yet another working win7 efi setup.</p><p>A pity rebooting doesn&#039;t work (I think I have the same problem as you). Perhaps it&#039;s somehow related to the VBIOS. Anybody else mind sharing their VBIOS for gt610?</p><p>P.S. Wish QXL wouldn&#039;t stop working when a passed card is active. It works in win 8.1! I get two screens one on a physical card and one on a qxl card. Why win 7 can&#039;t do it? :x</p></div></blockquote></div><p>Rebooting doesn&#039;t work?.. Haven&#039;t heard about it.</p></div></blockquote></div><p>I recall somebody in this topic said their GT610 didn&#039;t survive reboots. I thought it was you, but it seems like I was wrong. </p><div class="quotebox"><blockquote><div><p>My Radeon-based VM system reboots just fine.</p></div></blockquote></div><p>My Radeon-based VM reboots fine as well.</p><div class="quotebox"><blockquote><div><p>Anyway, i can conclude that Asus can not into UEFI properly.</p></div></blockquote></div><p>But I used your Gigabyte UEFI. <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> Anyway, ASUS does have a windows-only utility to update vbios; I just can&#039;t use it since I have no bare-metal Windows installs.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1526841" class="blockpost rowodd"> <h2><span><span class="conr">#5036</span> <a href="viewtopic.php?pid=1526841#p1526841">2015-05-07 19:33:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>So I recently switched to i3 for everyday use, and I noticed my virtual machine has no sound anymore.<br />Pulseaudio seems to be running, I can correctly change volumes and outputs with pavucontrol, and every other applications plays&#160; sound normally.</p><p>However when I switch to a full-on DE, Mate in my case, I do have sound in the vm. I&#039;m not sure what&#039;s up here.</p><p>My launch script:</p><div class="codebox"><pre><code>QEMU_AUDIO_DRV=all qemu-system-x86_64 -L . -enable-kvm -m 8096 -cpu host,kvm=off -smp 6,sockets=1,cores=6,threads=1 -vga none \ -device vfio-pci,host=02:00.0,x-vga=on -device vfio-pci,host=02:00.1 -device vfio-pci,host=00:19.0 -device vfio-pci,host=04:00.0 \ -device virtio-scsi-pci,id=scsi1 -drive file=/dev/sdb,id=ssddisk,format=raw,if=none -device scsi-hd,drive=ssddisk \ -device virtio-scsi-pci,id=scsi2 -drive file=/dev/sdd,id=hdddisk,format=raw,if=none -device scsi-hd,drive=hdddisk \ -usb -usbdevice host:0738:2215 -usbdevice host:0738:a215 -usbdevice host:13d3:3404 -usbdevice host:2516:0011 -usbdevice host:1532:0033 \ -usbdevice host:054c:0268 -soundhw hda</code></pre></div></div></blockquote></div><p>Shouldn&#039;t &quot;QEMU_AUDIO_DRV=alsa&quot; set it to alsa? Even that doesn&#039;t seem to work while, again, in Mate it works.<br />i3 shouldn&#039;t be messing with my sound right?</p> <p class="postedit"><em>Last edited by PureTryOut (2015-05-07 21:58:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1526841">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527021" class="blockpost roweven"> <h2><span><span class="conr">#5037</span> <a href="viewtopic.php?pid=1527021#p1527021">2015-05-08 15:14:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90902">wulfspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-05</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90902">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi again,</p><p>OVMF works. Started the ovmf with the qemu command and ovmf and TianoCore appears. But after I added ovmf to my libvirt xml I get &quot;Permission denied&quot;. My OVMF is self compiled</p><p>XML config:</p><div class="codebox"><pre><code>... &lt;os&gt; .... &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/opt/ovmf/OVMF_CODE.fd&lt;/loader&gt; &lt;nvram template=&#039;/opt/ovmf/OVMF_VARS.fd&#039;&gt;/var/lib/libvirt/qemu/nvram/win8.1_VARS.fd&lt;/nvram&gt; .... &lt;/os&gt; ...</code></pre></div><p>Error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -drive file=/var/lib/libvirt/qemu/nvram/win8.1_VARS.fd,if=pflash,format=raw,unit=1: Could not open &#039;/var/lib/libvirt/qemu/nvram/win8.1_VARS.fd&#039;: Permission denied</code></pre></div><p>ls -lah:</p><div class="codebox"><pre><code>drwxr-x--- 7 libvirt-qemu kvm 4,0K Mai 8 17:11 .. -rwxr-x--- 1 root root 128K Mai 6 11:29 win8.1_VARS.fd</code></pre></div> <p class="postedit"><em>Last edited by wulfspider (2015-05-08 15:17:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527021">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527026" class="blockpost rowodd"> <h2><span><span class="conr">#5038</span> <a href="viewtopic.php?pid=1527026#p1527026">2015-05-08 15:23:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Remove /var/lib/libvirt/qemu/nvram/win8.1_VARS.fd, which will leave:</p><div class="codebox"><pre><code>&lt;nvram template=&#039;/opt/ovmf/OVMF_VARS.fd&#039;&gt;&lt;/nvram&gt;</code></pre></div><p>When you start the VM, it will generate a new nvram file.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527026">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527028" class="blockpost roweven"> <h2><span><span class="conr">#5039</span> <a href="viewtopic.php?pid=1527028#p1527028">2015-05-08 15:27:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90902">wulfspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-05</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90902">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hm, I removed the template parameter but nothing has changed.</p><p>I also changed the permissions of this file from root:root to libvirt-qemu:kvm, but after I executed virsh start win8.1 the permissions are resetted to root:root</p> <p class="postedit"><em>Last edited by wulfspider (2015-05-08 15:28:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527028">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527045" class="blockpost rowodd"> <h2><span><span class="conr">#5040</span> <a href="viewtopic.php?pid=1527045#p1527045">2015-05-08 16:44:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75548">Schlunze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-03</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ts_reload@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>i just need a way to get win7 running from another disk currently &quot;sdg&quot;, configured by vmm or xml. I´m not sure if there is a need for me to passthrough SATA controller at all.</p><p>Or pass through the other SATA controller from Intel?</p><div class="codebox"><pre><code>### Group 11 ### 00:1f.0 ISA bridge: Intel Corporation 9 Series Chipset Family Z97 LPC Controller 00:1f.2 SATA controller: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode] 00:1f.3 SMBus: Intel Corporation 9 Series Chipset Family SMBus Controller</code></pre></div><p>and plug the disks </p><div class="codebox"><pre><code>lrwxrwxrwx 1 root root 0 8. Mai 17:30 sda -&gt; ../devices/pci0000:00/0000:00:1f.2/ata1/host0/target0:0:0/0:0:0:0/block/sda lrwxrwxrwx 1 root root 0 8. Mai 17:30 sdb -&gt; ../devices/pci0000:00/0000:00:1f.2/ata2/host1/target1:0:0/1:0:0:0/block/sdb lrwxrwxrwx 1 root root 0 8. Mai 17:30 sdc -&gt; ../devices/pci0000:00/0000:00:1f.2/ata3/host2/target2:0:0/2:0:0:0/block/sdc lrwxrwxrwx 1 root root 0 8. Mai 17:30 sdd -&gt; ../devices/pci0000:00/0000:00:1f.2/ata4/host3/target3:0:0/3:0:0:0/block/sdd</code></pre></div><p>on the ASM1062 witch failed yesterday.</p><p>There are just too many disks to wire. <br />Just need the easiest solution, because Group 9 passthrough isn´t working. VirtIO disks worked perfectly for me in the past. </p><p>Anyone?</p> <p class="postedit"><em>Last edited by Schlunze (2015-05-08 16:49:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527045">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527057" class="blockpost roweven"> <h2><span><span class="conr">#5041</span> <a href="viewtopic.php?pid=1527057#p1527057">2015-05-08 17:14:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Shouldn&#039;t &quot;QEMU_AUDIO_DRV=alsa&quot; set it to alsa? Even that doesn&#039;t seem to work while, again, in Mate it works.<br />i3 shouldn&#039;t be messing with my sound right?</p></div></blockquote></div><p>Well I found out why I had no sound with Pulseaudio, still not sure why it works fine in Mate though.<br />Pulseaudio is running as the current user, but i&#039;m launching Qemu with sudo rights.</p><p>I&#039;m launching Qemu with sudo because I boot directly from hard disk (to get full ssd speeds), to open these I need sudo rights. I guess I could chown the disks to my user every time but I rather not do that.<br />Also, even when chowning it to my user, and then launching Qemu without root, it complains about not being able to open /dev/vfio/16 because it&#039;s missing permissions.</p><p>I thought switching to OVMF might help (do note, i&#039;m a noob in all of this), but of course it didn&#039;t.</p><p>So how can I run Qemu as root, while still using Pulseaudio?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527057">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527131" class="blockpost rowodd"> <h2><span><span class="conr">#5042</span> <a href="viewtopic.php?pid=1527131#p1527131">2015-05-09 00:57:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>I recall somebody in this topic said their GT610 didn&#039;t survive reboots. I thought it was you, but it seems like I was wrong.</p></div></blockquote></div><p>It is me <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Been trying with this cursed card for more than a month , and nothing would fix it .</p><p>The issue is when you reboot the VM , it succeeds , you can see OVMF screen and Windows loading logo then an infinite black screen . Hopefully , I&#039;ll get another newer card soon . </p><p>Can anyone suggest a newer architecture SINGLE-SLOT card from NVIDIA ? Couldn&#039;t find anything other than a GTX 750 .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527131">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527200" class="blockpost roweven"> <h2><span><span class="conr">#5043</span> <a href="viewtopic.php?pid=1527200#p1527200">2015-05-09 10:47:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>The issue is when you reboot the VM , it succeeds , you can see OVMF screen and Windows loading logo then an infinite black screen .</p></div></blockquote></div><p>Yep, I have the same problem. And even the host hangs when the VM reboots.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527200">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527223" class="blockpost rowodd"> <h2><span><span class="conr">#5044</span> <a href="viewtopic.php?pid=1527223#p1527223">2015-05-09 12:23:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>The issue is when you reboot the VM , it succeeds , you can see OVMF screen and Windows loading logo then an infinite black screen .</p></div></blockquote></div><p>Idk if this will be of any help but similar thing happens when emulated vga is used as primary and physical vga is used as secondary. windows logo would be seen on emulated vga window and then it goes black as windows switches to more powerful physical vga. maybe something similar is happening there?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527223">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527246" class="blockpost roweven"> <h2><span><span class="conr">#5045</span> <a href="viewtopic.php?pid=1527246#p1527246">2015-05-09 14:03:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90902">wulfspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-05</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90902">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can somebody tell me if my hardware supports VT-d? Or how can I check this? I don&#039;t get working the pass through and I am slowly dispairing.</p><p>Motherboard: Asus P8Z77-V Pro<br />Processor: i7-3770</p><p>I know that my processor and the Z77 chipset support VT-d, but don&#039;t know if it really works or if Asus disabled this function in my model. Under the CPU section in my bios I enabled &quot;Intel Virtualisation technology&quot;. Is this the same? Another Option like &quot;VT-d&quot; is not available.</p> <p class="postedit"><em>Last edited by wulfspider (2015-05-09 14:13:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527246">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527295" class="blockpost rowodd"> <h2><span><span class="conr">#5046</span> <a href="viewtopic.php?pid=1527295#p1527295">2015-05-09 17:37:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>wulfspider wrote:</cite><blockquote><div><p>Can somebody tell me if my hardware supports VT-d? Or how can I check this? I don&#039;t get working the pass through and I am slowly dispairing.</p><p>Motherboard: Asus P8Z77-V Pro<br />Processor: i7-3770</p><p>I know that my processor and the Z77 chipset support VT-d, but don&#039;t know if it really works or if Asus disabled this function in my model. Under the CPU section in my bios I enabled &quot;Intel Virtualisation technology&quot;. Is this the same? Another Option like &quot;VT-d&quot; is not available.</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>/proc/cpuinfo flags #</p><p>/proc/cpuinfo will tell you if the processor supports virtualization and if it is enabled (but it could not show up in flags because it is disabled — more on this below).</p><p>The flags to look out for are:</p><p>&#160; &#160; vmx — Intel VT-x, basic virtualization<br />&#160; &#160; svm — AMD SVM, basic virtualization<br />&#160; &#160; ept — Extended Page Tables, an Intel feature to make emulation of guest page tables faster.<br />&#160; &#160; vpid — VPID, an Intel feature to make expensive TLB flushes unnecessary when context switching between guests.<br />&#160; &#160; npt — AMD Nested Page Tables, similar to EPT.<br />&#160; &#160; tpr_shadow and flexpriority — Intel feature that reduces calls into the hypervisor when accessing the Task Priority Register, which helps when running certain types of SMP guests.<br />&#160; &#160; vnmi — Intel Virtual NMI feature which helps with certain sorts of interrupt events in guests.</p></div></blockquote></div><p>from <a href="http://virt-tools.org/learning/check-hardware-virt/" rel="nofollow">http://virt-tools.org/learning/check-hardware-virt/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527295">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527303" class="blockpost roweven"> <h2><span><span class="conr">#5047</span> <a href="viewtopic.php?pid=1527303#p1527303">2015-05-09 18:10:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85250">stokbaek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-20</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:stokbaek@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I desided to give this a go since I had to reinstall pc anyways.</p><p>I managed to get myself stuck and hope some of you guys would be able to help out of my problem. My issue is when I start the vm does a QUEMU window open but I never get any signal on the screen that is in the GFX card that is linked to it.<br />If I add the following line to the vmcreate script am I able to VNC into the VM. It can see the gfx card and installed the drivers for it, but still aint able to get its screen working even after I have installed the video driver to it.</p><div class="codebox"><pre><code>-vnc :0 -vga vmware</code></pre></div><p>This PC is running Linux Mint 17.1<br />kernel:</p><div class="codebox"><pre><code>3.13.0-37-generic</code></pre></div><p>PC Setup:</p><div class="codebox"><pre><code> description: Motherboard product: B75M-D3H vendor: Gigabyte Technology Co., Ltd. physical id: 0 version: x.x serial: To be filled by O.E.M. slot: To be filled by O.E.M. description: CPU product: Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz vendor: Intel Corp. physical id: 43 bus info: cpu@0 version: Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz slot: Intel(R) Core(TM) i5-3570 CPU @ 3.40GHz size: 3801MHz capacity: 3801MHz width: 64 bits clock: 100MHz</code></pre></div><br /><p>/etc/modules:</p><div class="codebox"><pre><code>lp rtc pci_stub vfio vfio_iommu_type1 vfio_pci kvm kvm_intel</code></pre></div><p>/etc/default/grub:</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1&quot;</code></pre></div><p>lspci -nn | grep NVIDIA:</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 760] [10de:1187] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1)</code></pre></div><p>iniramfs/modules:</p><div class="codebox"><pre><code>pci_stub ids=10DE:0E0A,10DE:1187</code></pre></div><p>dmesg | grep pci-stub:</p><div class="codebox"><pre><code>[ 2.737698] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.737712] pci-stub 0000:01:00.1: claimed by stub [ 2.737718] pci-stub: add 10DE:1187 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.737721] pci-stub 0000:01:00.0: claimed by stub</code></pre></div><p>/etc/vfio-pci1.cfg:</p><div class="codebox"><pre><code>0000:01:00.0 0000:01:00.1</code></pre></div><p>/usr/vm1:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash configfile=/etc/vfio-pci1.cfg vfiobind() { dev=&quot;$1&quot; vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id } modprobe vfio-pci cat $configfile | while read line;do echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue vfiobind $line done sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host \ -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -drive file=/media/christoffers/Games/vm_machines/windows8.1.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -drive file=/home/christoffers/Downloads/windows8.1.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -boot menu=on exit 0</code></pre></div><p>kvm-ok:</p><div class="codebox"><pre><code>INFO: /dev/kvm exists KVM acceleration can be used</code></pre></div><p>Please do tell if I need to supply more information</p> <p class="postedit"><em>Last edited by stokbaek (2015-05-09 19:58:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527303">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527349" class="blockpost rowodd"> <h2><span><span class="conr">#5048</span> <a href="viewtopic.php?pid=1527349#p1527349">2015-05-09 21:30:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>Idk if this will be of any help but similar thing happens when emulated vga is used as primary and physical vga is used as secondary. windows logo would be seen on emulated vga window and then it goes black as windows switches to more powerful physical vga. maybe something similar is happening there?</p></div></blockquote></div><p>That&#039;s not the case , I am passing through the GT610 as the primary and only GPU to the VM (-vga none) .</p><p>Maybe it will work if I passed it as a secondary one <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> Let&#039;s try and see !</p><p>EDIT : Nope . Gonna replace it with an ASUS GTX 750 soon .</p> <p class="postedit"><em>Last edited by Denso (2015-05-09 22:56:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527349">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527368" class="blockpost roweven"> <h2><span><span class="conr">#5049</span> <a href="viewtopic.php?pid=1527368#p1527368">2015-05-10 00:11:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>EDIT : Nope . Gonna replace it with an ASUS GTX 750 soon .</p></div></blockquote></div><p>There was a passively-cooled version of GTX750, and maybe even 750Ti from Zotac. Sorry for my obsession, none of my GPUs are actively cooled..</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527376" class="blockpost rowodd"> <h2><span><span class="conr">#5050</span> <a href="viewtopic.php?pid=1527376#p1527376">2015-05-10 00:44:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90178">Omar007</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-09</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90178">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve been moving from QEMU bash scripts to libvirt/virt-manager and have had no problems with the main setup in either yet.</p><p>Since the basic setup worked without issues for me, I tried to create some more exotic configurations and use cases. What I&#039;ve found during the process:<br />- The latest nVidia host drivers (349.16-2) can not be used if you want to passthrough a GPU (at least not without modifications and I don&#039;t know how to do that).<br />- The &#039;intel_iommu=on&#039; kernel parameter may prevent the system from booting into X if you are using *.conf files for X (though maybe this depends on hardware).<br />- If X is running when you unbind or rebind a GPU, it&#039;ll freeze your whole system.<br />- Stubbing or binding to vfio-pci is not needed when using libvirt/virt-manager (it binds the GPU when you start the VM and unbinds/rebinds to host after it shuts down)<br />- SLI is currently not possible on either chipset (at least I did not manage to get this working. I&#039;ll be happy to hear if someone did!).<br />- Standard sound configuration of libvirt doesn&#039;t work if the VM is started without an active X session (the sound won&#039;t play over the host speakers).<br />- Onboard audio unbinding and rebinding works perfectly and can be done during active X sessions as well.<br />- When emulating an audio device it is not possible to define how much channels it should have?? (ie. 2.1, 5.1 or 7.1 instead of the default stereo)<br />- Windows 8.1 will not boot with the Q35 chipset (it freezes during boot at the logo).<br />- No working QXL/Spice drivers available for Windows 8.1 yet so you get a wonderful 800x600 resolution!<br />- The OVMF version on extra stops the VM from rebooting (it just shows a white _ in the top left). The ovmf-svn package on the AUR works fine and rebooting works.</p><br /><p>Used hardware<br />MoBo: ASUS X99-A<br />GPU: GeForce GTX 970 (x2)<br />CPU: Intel i7 5930K<br />UEFI boot mode only (CSM/Legacy support disabled)</p><p>Software:<br />- kernel 4.0.1-1 (latest on core)<br />- qemu 2.2.1-4 (latest on extra)<br />- ovmf-svn 17281-1 (aur)<br />- libvirt 1.2.15-1 (latest on community)<br />- virt-manager 1.2.0-1 (latest on community)</p> <p class="postedit"><em>Last edited by Omar007 (2015-05-10 01:02:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527376">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=201">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <strong>202</strong> <a href="viewtopic.php?id=162768&amp;p=203">203</a> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=203">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
