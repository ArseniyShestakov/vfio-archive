<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 168) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=168" title="Page 168" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=167" title="Page 167" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=169" title="Page 169" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=167">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <strong>168</strong> <a href="viewtopic.php?id=162768&amp;p=169">169</a> <a href="viewtopic.php?id=162768&amp;p=170">170</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=169">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1502194" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4176</span> <a href="viewtopic.php?pid=1502194#p1502194">2015-02-12 09:03:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>Hi, aw:</p><p>I just change the kernel version to 3.18.6 from kernel.org. It now work for me.&#160; qemu version is still 2.0.</p><p>I compare the result of the command &quot;lspci -vvv -k -s 04:00.0&quot; between linux-3.12.5 and linux-3.18.6, there are just a little different.<br />If it can give you some idea.</p></div></blockquote></div><p>There&#039;s really not much question about what the problem is/was, the kvm-vfio device didn&#039;t go in until 3.13.&#160; That&#039;s the code that toggles whether kvm emulates or ignores operations that invalidate the cache when devices are allowed to perform operations that can bypass it, for example NoSnoop.&#160; That was an early cause of Code 43 errors.&#160; The NoSnoop patch you were using was an early, and fairly broken, attempt to fix that.&#160; The new code is far more reliable, as you can see.</p></div></blockquote></div><br /><p>OK, thanks for reply. I will use the version 3.18.6.</p></div></blockquote></div><br /><p>Hi, aw:<br />I have another question that usb device(mouse and keyboard) cannot passthrough</p><p>I direct run:&#160; <br />qemu-system-x86_64 -usb -usbdevice host:17ef:6018</p><p>the error is :<br />qemu: could not add USB device &#039;host:17ef:6018&#039;</p><p>there is no error in /var/log/message</p><br /><p>the secondary question is :<br />I can successful passthrough AMD FirePro R5000, and it worked well. but if I passthrough the r5000 onece, the integrated graphics on host had no responce and the display of screen is messed. </p><p>but the Nvidia GRID K2 in same host is OK. </p><p>every test the host just plug one card.</p> <p class="postedit"><em>Last edited by erganzi (2015-02-12 09:12:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502194">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502346" class="blockpost roweven"> <h2><span><span class="conr">#4177</span> <a href="viewtopic.php?pid=1502346#p1502346">2015-02-12 20:41:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It seems that Q35 is working just fine with ovmf-svn compiled 4 hours ago . Gaming at 3840 x 2160 resolution is excellent inside the VM .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502346">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502475" class="blockpost rowodd"> <h2><span><span class="conr">#4178</span> <a href="viewtopic.php?pid=1502475#p1502475">2015-02-13 03:08:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there anyone who can help me (preferred life-session on IRC) with configuration this on:<br /><span class="bbu">Motherboard: GA-Z97X-Gaming 5<br />CPU: i5-4690K<br />Host: Intel HD4600 (Arch)<br />Quest: Gigabyte GTX 970 (Windows)</span></p><p>I spend on this too many hours, still can&#039;t figure out why it&#039;s not working (<a href="https://bbs.archlinux.org/viewtopic.php?pid=1502131#p1502131" rel="nofollow">old post</a>), still new, can&#039;t handle all things on arch. After getting this working, I&#039;ll create post for others...</p> <p class="postedit"><em>Last edited by Len (2015-02-13 03:09:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502475">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502480" class="blockpost roweven"> <h2><span><span class="conr">#4179</span> <a href="viewtopic.php?pid=1502480#p1502480">2015-02-13 03:31:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>There&#039;s really not much question about what the problem is/was, the kvm-vfio device didn&#039;t go in until 3.13.&#160; That&#039;s the code that toggles whether kvm emulates or ignores operations that invalidate the cache when devices are allowed to perform operations that can bypass it, for example NoSnoop.&#160; That was an early cause of Code 43 errors.&#160; The NoSnoop patch you were using was an early, and fairly broken, attempt to fix that.&#160; The new code is far more reliable, as you can see.</p></div></blockquote></div><br /><p>OK, thanks for reply. I will use the version 3.18.6.</p></div></blockquote></div><br /><p>Hi, aw:<br />I have another question that usb device(mouse and keyboard) cannot passthrough</p><p>I direct run:&#160; <br />qemu-system-x86_64 -usb -usbdevice host:17ef:6018</p><p>the error is :<br />qemu: could not add USB device &#039;host:17ef:6018&#039;</p><p>there is no error in /var/log/message</p><br /><p>the secondary question is :<br />I can successful passthrough AMD FirePro R5000, and it worked well. but if I passthrough the r5000 onece, the integrated graphics on host had no responce and the display of screen is messed. </p><p>but the Nvidia GRID K2 in same host is OK. </p><p>every test the host just plug one card.</p></div></blockquote></div><p>sorry, the usb device can not passthrough is my fault.<br />the libusb library is too old, when I recompiled the new one. <br />it can passthrough well.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502480">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502502" class="blockpost rowodd"> <h2><span><span class="conr">#4180</span> <a href="viewtopic.php?pid=1502502#p1502502">2015-02-13 04:19:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>Is there anyone who can help me (preferred life-session on IRC) with configuration this on:<br /><span class="bbu">Motherboard: GA-Z97X-Gaming 5<br />CPU: i5-4690K<br />Host: Intel HD4600 (Arch)<br />Quest: Gigabyte GTX 970 (Windows)</span></p><p>I spend on this too many hours, still can&#039;t figure out why it&#039;s not working (<a href="https://bbs.archlinux.org/viewtopic.php?pid=1502131#p1502131" rel="nofollow">old post</a>), still new, can&#039;t handle all things on arch. After getting this working, I&#039;ll create post for others...</p></div></blockquote></div><p>You&#039;re missing the i915 vga arbiter patch, if you&#039;re using arch and the kernel i provided make sure you&#039;re actually booting it and not arch&#039;s one, alternatively you could use OVMF and skip that problem completely</p> <p class="postedit"><em>Last edited by nbhs (2015-02-13 04:21:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502548" class="blockpost roweven"> <h2><span><span class="conr">#4181</span> <a href="viewtopic.php?pid=1502548#p1502548">2015-02-13 09:12:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=8908">SchaduwBlink</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2007-01-07</span></dd> <dd><span>Posts: 59</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=8908">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>It seems that Q35 is working just fine with ovmf-svn compiled 4 hours ago . Gaming at 3840 x 2160 resolution is excellent inside the VM .</p></div></blockquote></div><p> Where did you get the latest ovmf? It&#039;s no longer on Jenkins repo for some reason. Or did you compile it by yourself and if so, could you direct me on how to do that and make it split vars?</p><p>Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502548">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502555" class="blockpost rowodd"> <h2><span><span class="conr">#4182</span> <a href="viewtopic.php?pid=1502555#p1502555">2015-02-13 10:08:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SchaduwBlink wrote:</cite><blockquote><div><p>Where did you get the latest ovmf? It&#039;s no longer on Jenkins repo for some reason. Or did you compile it by yourself and if so, could you direct me on how to do that and make it split vars?</p><p>Thanks.</p></div></blockquote></div><p>There is a package in AUR if you&#039;re using Arch :</p><div class="codebox"><pre><code>yaourt -S ovmf-svn</code></pre></div><p>You must have &quot;yaourt&quot; to use the above command .</p><p>This will pull the latest code , compile it and then ask you for a confirmation to install it .</p><p>It will be installed into :</p><div class="codebox"><pre><code>/usr/share/ovmf/x64/ovmf_code_x64.bin</code></pre></div><p>This is the main binary</p><p>AND :</p><div class="codebox"><pre><code>/usr/share/ovmf/x64/ovmf_vars_x64.bin</code></pre></div><p>This is the vars file .</p><p>Good luck !</p> <p class="postedit"><em>Last edited by Denso (2015-02-13 10:28:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502555">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502574" class="blockpost roweven"> <h2><span><span class="conr">#4183</span> <a href="viewtopic.php?pid=1502574#p1502574">2015-02-13 12:39:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=8908">SchaduwBlink</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2007-01-07</span></dd> <dd><span>Posts: 59</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=8908">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>SchaduwBlink wrote:</cite><blockquote><div><p>Where did you get the latest ovmf? It&#039;s no longer on Jenkins repo for some reason. Or did you compile it by yourself and if so, could you direct me on how to do that and make it split vars?</p><p>Thanks.</p></div></blockquote></div><p>There is a package in AUR if you&#039;re using Arch :</p><div class="codebox"><pre><code>yaourt -S ovmf-svn</code></pre></div><p>You must have &quot;yaourt&quot; to use the above command .</p><p>This will pull the latest code , compile it and then ask you for a confirmation to install it .</p><p>It will be installed into :</p><div class="codebox"><pre><code>/usr/share/ovmf/x64/ovmf_code_x64.bin</code></pre></div><p>This is the main binary</p><p>AND :</p><div class="codebox"><pre><code>/usr/share/ovmf/x64/ovmf_vars_x64.bin</code></pre></div><p>This is the vars file .</p><p>Good luck !</p></div></blockquote></div><p>Cheers for that. Forgot to look there. I&#039;ve always been pulling the pre-compiled one from Jenkins RPM Repo and extracting it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502574">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502603" class="blockpost rowodd"> <h2><span><span class="conr">#4184</span> <a href="viewtopic.php?pid=1502603#p1502603">2015-02-13 14:30:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SchaduwBlink wrote:</cite><blockquote><div><p>Cheers for that. Forgot to look there. I&#039;ve always been pulling the pre-compiled one from Jenkins RPM Repo and extracting it.</p></div></blockquote></div><p>AUR is the main reason why I&#039;m using Arch .</p><p>Best of luck to you on your virtualization journey !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502603">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502772" class="blockpost roweven"> <h2><span><span class="conr">#4185</span> <a href="viewtopic.php?pid=1502772#p1502772">2015-02-14 03:02:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88640">Tim_J</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gessert wrote:</cite><blockquote><div><p>When I run the vm now, the screen turns off. I still do not have graphics output. Please advise.</p></div></blockquote></div><p>It seems that you have the exact same problem that I do, which I posted a few pages ago. My system behaves the same as yours. In my case, I have one GT 210 and two GTX 580s. When the VM is launched and the screen turns off, it uses maximum CPU on a single core but never starts.</p><p>I&#039;ve tried all sorts of things: unplugging the primary monitor at boot, putting GRUB in text-only mode, changing the boot TTY, quiet mode, and all manner of boot options to both GRUB and the kernel. So far, nothing has helped. It seems that the only recourse for us is to reassign the primary adapter (unsupported in both of our cases) or physically move cards around. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Since this requires a system drain and cutting new tubes in my case, I&#039;m postponing this for a while to see if anybody can come up with any ideas.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502772">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502781" class="blockpost rowodd"> <h2><span><span class="conr">#4186</span> <a href="viewtopic.php?pid=1502781#p1502781">2015-02-14 03:55:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>Is there anyone who can help me (preferred life-session on IRC) with configuration this on:<br /><span class="bbu">Motherboard: GA-Z97X-Gaming 5<br />CPU: i5-4690K<br />Host: Intel HD4600 (Arch)<br />Quest: Gigabyte GTX 970 (Windows)</span></p><p>I spend on this too many hours, still can&#039;t figure out why it&#039;s not working (<a href="https://bbs.archlinux.org/viewtopic.php?pid=1502131#p1502131" rel="nofollow">old post</a>), still new, can&#039;t handle all things on arch. After getting this working, I&#039;ll create post for others...</p></div></blockquote></div><p>You&#039;re missing the i915 vga arbiter patch, if you&#039;re using arch and the kernel i provided make sure you&#039;re actually booting it and not arch&#039;s one, alternatively you could use OVMF and skip that problem completely</p></div></blockquote></div><p>Thank you for OVMF hint, it&#039;s now displaying to my second graphic card!<br />But I still can&#039;t get it to work on normal user, </p><div class="codebox"><pre><code>vfio: error opening /dev/vfio/1: Permission denied.</code></pre></div><p>I&#039;m in libvirt and kvm groups, this isn&#039;t helping, don&#039;t know why...</p><div class="codebox"><pre><code>&gt;libvirt/qemu.conf user = &quot;root&quot; group =&quot;kvm&quot; clear_emultaor_capabilities = 0</code></pre></div><div class="codebox"><pre><code>&gt;libvirt/libvirtd.conf unix_sock_group = &quot;libvirt&quot; unix_sock_rw_perms = &quot;0770&quot;</code></pre></div><p>Also is there needed other way to mount raw disk for VM?<br />right now in config I&#039;m using</p><div class="codebox"><pre><code>-drive file=/dev/sdc,id=disk,format=raw,if=none -device ide-hd,drive=disk</code></pre></div><p>But OVMF bios is not finding my disk, also can&#039;t find working way to support AHCI.</p><p>Thanks for help</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502782" class="blockpost roweven"> <h2><span><span class="conr">#4187</span> <a href="viewtopic.php?pid=1502782#p1502782">2015-02-14 04:03:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, I&#039;d given up on running Windows on a VM, thanks to that Sea Islands bus reset bug.&#160; <br />I just had an interesting thought:</p><p>For me, the biggest annoyance about the bus-reset failure is not just the inability to reboot the guest.<br />What&#039;s worse is that, if I don&#039;t stop it in time, the failed boot will make Windows try to automatically fix things.<br />The automatic fixing has sometimes even undone the very Windows Updates that triggered the reboot.</p><p>Is it possible to force Qemu (via libvirt) to shut down the guest instead of restarting it, when the guest requests a reboot?<br />Even better, is it possible to make that &quot;restart&quot; (but not shutdown) automatically trigger a host suspend, or a host reboot?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502782">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502786" class="blockpost rowodd"> <h2><span><span class="conr">#4188</span> <a href="viewtopic.php?pid=1502786#p1502786">2015-02-14 05:35:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><p>Is it possible to force Qemu (via libvirt) to shut down the guest instead of restarting it, when the guest requests a reboot?<br />Even better, is it possible to make that &quot;restart&quot; (but not shutdown) automatically trigger a host suspend, or a host reboot?</p></div></blockquote></div><p>Assuming you&#039;re using libvirt, I think </p><div class="codebox"><pre><code>&lt;on_reboot&gt;destroy&lt;/on_reboot&gt;</code></pre></div><p>might be what you&#039;re after.</p><p>I believe -no-reboot is the Qemu command line option, although I will admit, I haven&#039;t tried this.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502786">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502837" class="blockpost roweven"> <h2><span><span class="conr">#4189</span> <a href="viewtopic.php?pid=1502837#p1502837">2015-02-14 13:09:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88702">gessert</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-09</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88702">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tim_J wrote:</cite><blockquote><div><div class="quotebox"><cite>gessert wrote:</cite><blockquote><div><p>When I run the vm now, the screen turns off. I still do not have graphics output. Please advise.</p></div></blockquote></div><p>It seems that you have the exact same problem that I do, which I posted a few pages ago. My system behaves the same as yours. In my case, I have one GT 210 and two GTX 580s. When the VM is launched and the screen turns off, it uses maximum CPU on a single core but never starts.</p><p>I&#039;ve tried all sorts of things: unplugging the primary monitor at boot, putting GRUB in text-only mode, changing the boot TTY, quiet mode, and all manner of boot options to both GRUB and the kernel. So far, nothing has helped. It seems that the only recourse for us is to reassign the primary adapter (unsupported in both of our cases) or physically move cards around. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Since this requires a system drain and cutting new tubes in my case, I&#039;m postponing this for a while to see if anybody can come up with any ideas.</p></div></blockquote></div><p>Yes, I noticed we had basically the same problem. I have tried a similar approach. I&#039;m currently sending my grub and terminal booting messages through my serial port into nirvana.</p><p>/etc/default/grub</p><div class="codebox"><pre><code>GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian` GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 console=ttyS0,38400n8 nofb&quot; GRUB_TERMINAL=serial GRUB_SERIAL_COMMAND=&quot;serial --speed=38400 --unit=0 --word=8 --parity=no&quot; GRUB_CMDLINE_LINUX=&quot;&quot;</code></pre></div><p>run via &quot;update-grub&quot;</p><p>When booting, I do not see a grub, or any boot-messages anymore. The system seems to just magically boot into X *grin*. This is an ugly &quot;solution&quot;, but untill we figure out something proper it&#039;s going to work.</p><p><strong>Anyway this didn&#039;t solve the issue yet.</strong> There is one more thing running on the primary card, which I&#039;m currently looking into changing or disabling. When I switch the runlevel - CTRL + ATL + F1 and so on - the primary graphicsadapter is being used. I&#039;m currently trying to figure out how to configure the gettys. </p><p>And I&#039;m in way over my head. Any help would be vastly appreciated.</p><p>/proc/iomem (excerpt)</p><div class="codebox"><pre><code>90000000-fbffbfff : PCI Bus 0000:00 a0000000-b1ffffff : PCI Bus 0000:04 a0000000-afffffff : 0000:04:00.0 b0000000-b1ffffff : 0000:04:00.0 b1000000-b12fffff : BOOTFB</code></pre></div> <p class="postedit"><em>Last edited by gessert (2015-02-14 13:14:45)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502837">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502843" class="blockpost rowodd"> <h2><span><span class="conr">#4190</span> <a href="viewtopic.php?pid=1502843#p1502843">2015-02-14 13:41:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys,<br />Since my GTX 660 is successfully running as a Quadro K4000 for some time now, I want to check if it actually yields any performance improvements. Specifically I want to compare the following configurations:<br />Native Windows 8.1 with GTX 660<br />Virtual Windows 8.1 with GTX 660 (without hyperv extensions)<br />Virtual Windows 8.1 with Quadro K4000 (with hyperv extensions)<br />running on my Intel DH87RL Board with Core i7-4771 and latest nvidia game-ready drivers. My libvirt configuration is: <a href="https://gist.github.com/flyser/2c52d9b1dfca1f19e2f9" rel="nofollow">https://gist.github.com/flyser/2c52d9b1dfca1f19e2f9</a></p><p>Which benchmarks would you recommend for such a comparison? Anything you would like to see tested?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502843">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502848" class="blockpost roweven"> <h2><span><span class="conr">#4191</span> <a href="viewtopic.php?pid=1502848#p1502848">2015-02-14 14:09:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can u see if u can enable HW OVERLAY in nvidia control panel 3d settings with quadro driver? (i am to lazy to bloat my windows install <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502848">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502863" class="blockpost rowodd"> <h2><span><span class="conr">#4192</span> <a href="viewtopic.php?pid=1502863#p1502863">2015-02-14 15:22:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Can u see if u can enable HW OVERLAY in nvidia control panel 3d settings with quadro driver? (i am to lazy to bloat my windows install <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />)</p></div></blockquote></div><p>I doubt that would work, since I am using the nvidia game ready driver and not the quadro specific one.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502863">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502880" class="blockpost roweven"> <h2><span><span class="conr">#4193</span> <a href="viewtopic.php?pid=1502880#p1502880">2015-02-14 16:09:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88829">tuxGaming</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-14</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:drannel-h@web.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I searced for a long time but did not find an answer to my problem:</p><p>i am starting with this:<br />sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 2,sockets=1,cores=2,threads=1 -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -drive file=/dev/vg0/windows1-clone,id=osdisk,format=raw,if=none -device ide-hd,bus=ide.0,drive=osdisk -drive file=/home/tuxgaming/images/Windows7x64pro.iso,id=isocd,if=none -device ide-cd,bus=ide.1,drive=isocd -drive file=/home/tuxgaming/images/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.2,drive=virtiocd -boot menu=on</p><p>And i am getting:<br />This device cannot find enough free resources that it can use. If you want to use this device, you will need to disable one of the other devices on this system. (Code 12)<br />I think it has a confict with the Standard VGA.<br />adding -vga none results in a black screen &quot;QEMU 2.1.2 monitor -type &#039;help&#039; for more information (qemu)&quot; and a blinking cursor. The monitor attacht to the NVIDIA 660ti stays black.</p><p><a href="http://de.tinypic.com/view.php?pic=2lbmb5s&amp;s=8#.VN9yIXWc3MU" rel="nofollow">http://de.tinypic.com/view.php?pic=2lbm … N9yIXWc3MU</a></p><p>Thank you for helping out</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502880">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1502925" class="blockpost rowodd"> <h2><span><span class="conr">#4194</span> <a href="viewtopic.php?pid=1502925#p1502925">2015-02-14 17:58:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88702">gessert</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-09</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88702">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tuxGaming wrote:</cite><blockquote><div><p>I searced for a long time but did not find an answer to my problem:</p><p>i am starting with this:<br />sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 2,sockets=1,cores=2,threads=1 -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -drive file=/dev/vg0/windows1-clone,id=osdisk,format=raw,if=none -device ide-hd,bus=ide.0,drive=osdisk -drive file=/home/tuxgaming/images/Windows7x64pro.iso,id=isocd,if=none -device ide-cd,bus=ide.1,drive=isocd -drive file=/home/tuxgaming/images/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.2,drive=virtiocd -boot menu=on</p><p>And i am getting:<br />This device cannot find enough free resources that it can use. If you want to use this device, you will need to disable one of the other devices on this system. (Code 12)<br />I think it has a confict with the Standard VGA.<br />adding -vga none results in a black screen &quot;QEMU 2.1.2 monitor -type &#039;help&#039; for more information (qemu)&quot; and a blinking cursor. The monitor attacht to the NVIDIA 660ti stays black.</p><p><a href="http://de.tinypic.com/view.php?pic=2lbmb5s&amp;s=8#.VN9yIXWc3MU" rel="nofollow">http://de.tinypic.com/view.php?pic=2lbm … N9yIXWc3MU</a></p><p>Thank you for helping out</p></div></blockquote></div><p>Iirc the problem stems from the &quot;ioh3420&quot; device. It limits your options. I remember getting rid of it by not using q35. Remove the addresses from the devices as they use the &quot;ioh3420&quot; device. </p><p>It should probably look something like this:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 1024 -cpu host -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/seabios/bios.bin -vga none \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -drive file=/dev/vg0/windows1-clone,format=raw,media=disk \ -drive file=/home/tuxgaming/images/Windows7x64pro.iso,media=cdrom \ -drive file=/home/tuxgaming/images/virtio-win-0.1-100.iso,media=cdrom \ -boot menu=on</code></pre></div><p>I&#039;m not sure if you need the seabios option. Give it a try.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1502925">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503139" class="blockpost roweven"> <h2><span><span class="conr">#4195</span> <a href="viewtopic.php?pid=1503139#p1503139">2015-02-15 13:36:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Firstly, I do apologize if these issues have been addressed previously, this thread is massive to read through. I am currently in the process of attempting to utilize PCI/VGA passthrough to a VM guest, but have some concerns and issues I am already encountering. Currently using 3.19 kernel, and the hardware I am using includes:</p><p>Intel Core-i7 4790K cpu<br />Gigabyte Z97X-UD5H motherboard (Z97 &quot;wildcat&quot; pch chipset)<br />Nvidia GeForce GTX 650 + HDMI audio PCIe device (host gpu)<br />AMD Radeon HD7870 + HDMI audio PCIe device (pass to guest)<br />Intel Lan on motherboard (use for host)<br />Qualcomm Lan on motherboard (pass to guest instead of using virtio)</p><br /><p>However, I guess as to be expected for Core-i7 cpus, the PCIe root ports for the x16/x8 slots are provided by the processor itself (as can be seen in Gigabyte&#039;s diagram as well):<br /><span class="postimg"><img src="http://i.imgur.com/hM97txY.png" alt="hM97txY.png" /></span></p><p>As a result, I believe any PCIe cards installed in these slots, including the two GPUs I am attempting to use, will appear in the same IOMMU group, and this setup becomes impossible. I think my only options are then to:<br />1) Use integrated Intel HD4600 graphics for host instead of PCIe card (and hope they are in separate IOMMU groups?)<br />2) Use potentially unsafe ACS patch to &#039;force&#039; isolation</p><p>Does this seem correct? Are there other alternatives at this point in time? I really don&#039;t want to deal with patches with each kernel update, and I definitely would like to be able to use the dedicated GPU I specifically got for this.</p><p>The Qualcomm ethernet device is also in the same IOMMU group as a Marvell SATA controller (not the main Z97 chipset SATA controller), some other device (PCIe &lt;--&gt; PCI bridge possibly IIRC), as well as some other PCIe root ports (probably the x1 slots, and of course the ethernet/SATA devices themselves). Interestingly, based on the diagram, the Intel ethernet device appears in its own group and not in the Marvell SATA/bridge/qualcomm IOMMU group. Everything else appears to be in their own IOMMU groups. I&#039;m not sure if this is an expected result based on the Gigabyte diagram and the PCH ACS quirks in more recent kernels.</p><p>Also, is it possible that the ACS quirks implemented for the PCH chipset would some time in the future also be done for processors themselves? Such that the particular use case I am encountering will become possible without any kernel patches or resorting to restricting all processor provided PCIe slots to the VM and none for host? As I understand it (please do correct me if wrong), even though the chipset itself does not expose/support any ACS capabilities, the implemented quirks do some of its own checks to reveal at least some information, such as isolation, that ACS would have provided? Then, can these checks also be done for processor provided root ports?</p><p>Thanks for any information!</p> <p class="postedit"><em>Last edited by mutiny (2015-02-15 13:55:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503139">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503367" class="blockpost rowodd"> <h2><span><span class="conr">#4196</span> <a href="viewtopic.php?pid=1503367#p1503367">2015-02-16 05:58:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88867">rantoie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-16</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rantoie@riseup.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I&#039;m trying to get things to work with my GeForce 8800, but I keep getting the dreaded Code 43 in Windows. I must be missing something obvious, but I&#039;ve been combing this thread all day trying various things.</p><p>My setup:</p><p>Intel(R) Xeon(R) CPU E3-1241 v3 @ 3.50GHz<br />05:00.0 VGA compatible controller: NVIDIA Corporation G92 [GeForce 8800 GT] (rev a2)<br />MB: ASRock H97m Pro 4</p><div class="codebox"><pre><code># dmesg | grep -e DMAR -e IOMMU [ 0.000000] ACPI: DMAR 0x00000000BE62B7F8 000080 (v01 INTEL BDW 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.023011] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap d2008c20660462 ecap f010da [ 0.025279] IOAPIC id 8 under DRHD base 0xfed90000 IOMMU 0 [ 0.591229] DMAR: No ATSR found [ 0.591290] IOMMU 0 0xfed90000: using Queued invalidation [ 0.591341] IOMMU: Setting RMRR: [ 0.591395] IOMMU: Setting identity map for device 0000:00:14.0 [0xbeea2000 - 0xbeeb0fff] [ 0.591472] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbeea2000 - 0xbeeb0fff] [ 0.591544] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbeea2000 - 0xbeeb0fff] [ 0.591611] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.591666] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 0.623526] AMD IOMMUv2 driver by Joerg Roedel &lt;joerg.roedel@amd.com&gt; [ 0.623605] AMD IOMMUv2 functionality not available on this system</code></pre></div><p>I notice that the IOMMUv2 functionality is not available, in fact there is also this odd thing in the dmesg:</p><div class="codebox"><pre class="vscroll"><code>[ 0.605969] DMAR: No ATSR found [ 0.606030] IOMMU 0 0xfed90000: using Queued invalidation [ 0.606082] IOMMU: Setting RMRR: [ 0.606139] IOMMU: Setting identity map for device 0000:00:14.0 [0xbeea2000 - 0xbeeb0fff] [ 0.606216] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbeea2000 - 0xbeeb0fff] [ 0.606287] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbeea2000 - 0xbeeb0fff] [ 0.606355] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.606410] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 0.606476] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O [ 0.606591] ------------[ cut here ]------------ [ 0.606643] WARNING: CPU: 2 PID: 1 at /build/linux-y7bjb0/linux-3.16.7-ckt4/drivers/pci/search.c:131 pci_find_upstream_pcie_bridge+0x73/0x80() [ 0.606702] Modules linked in: [ 0.606793] CPU: 2 PID: 1 Comm: swapper/0 Not tainted 3.16.0-4-amd64 #1 Debian 3.16.7-ckt4-3 [ 0.606850] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./H97M Pro4, BIOS P1.20 07/29/2014 [ 0.606908] 0000000000000009 ffffffff815096a7 0000000000000000 ffffffff810676f7 [ 0.607130] ffff88042c9bd098 ffff88042c9bd000 ffff88042c9bd098 0000000000000000 [ 0.607352] 0000000000000000 ffffffff812e4103 ffffffff813f382b 0003000000000000 [ 0.607573] Call Trace: [ 0.607623] [&lt;ffffffff815096a7&gt;] ? dump_stack+0x41/0x51 [ 0.607674] [&lt;ffffffff810676f7&gt;] ? warn_slowpath_common+0x77/0x90 [ 0.607725] [&lt;ffffffff812e4103&gt;] ? pci_find_upstream_pcie_bridge+0x73/0x80 [ 0.607777] [&lt;ffffffff813f382b&gt;] ? intel_iommu_add_device+0x3b/0x210 [ 0.607828] [&lt;ffffffff813e8900&gt;] ? bus_set_iommu+0x50/0x50 [ 0.607879] [&lt;ffffffff813e8925&gt;] ? add_iommu_group+0x25/0x50 [ 0.607931] [&lt;ffffffff8139fa5b&gt;] ? bus_for_each_dev+0x5b/0x90 [ 0.607981] [&lt;ffffffff813e88f3&gt;] ? bus_set_iommu+0x43/0x50 [ 0.608033] [&lt;ffffffff8194a7e3&gt;] ? intel_iommu_init+0x53f/0x586 [ 0.608084] [&lt;ffffffff8190aade&gt;] ? memblock_find_dma_reserve+0x157/0x157 [ 0.608135] [&lt;ffffffff8190aaec&gt;] ? pci_iommu_init+0xe/0x37 [ 0.608186] [&lt;ffffffff8100213c&gt;] ? do_one_initcall+0xcc/0x200 [ 0.608238] [&lt;ffffffff81085fb8&gt;] ? parse_args+0x238/0x470 [ 0.608289] [&lt;ffffffff819021db&gt;] ? kernel_init_freeable+0x15f/0x1e1 [ 0.608339] [&lt;ffffffff8190195e&gt;] ? initcall_blacklist+0xb2/0xb2 [ 0.608391] [&lt;ffffffff814fcc10&gt;] ? rest_init+0x80/0x80 [ 0.608441] [&lt;ffffffff814fcc1a&gt;] ? kernel_init+0xa/0xf0 [ 0.608492] [&lt;ffffffff8150f6bc&gt;] ? ret_from_fork+0x7c/0xb0 [ 0.608542] [&lt;ffffffff814fcc10&gt;] ? rest_init+0x80/0x80 [ 0.608595] ---[ end trace f1670364591019ce ]---</code></pre></div><p>See below for the full dmesg.</p><div class="codebox"><pre><code>05:00.0 0300: 10de:0611 (rev a2) (prog-if 00 [VGA controller]) Subsystem: 10de:054f Flags: bus master, fast devsel, latency 0, IRQ 16 Memory at ee000000 (32-bit, non-prefetchable) [size=16M] Memory at c0000000 (64-bit, prefetchable) [size=256M] Memory at ec000000 (64-bit, non-prefetchable) [size=32M] I/O ports at d000 [size=128] [virtual] Expansion ROM at ef000000 [disabled] [size=128K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: vfio-pci</code></pre></div><p>BOOT_IMAGE=/vmlinuz-3.16.0-4-amd64 root=UUID=0fabcc0e-9578-4e2e-8967-fd22994e8189 ro intel_iommu=on pcie_acs_override=downstream</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;win72&lt;/name&gt; &lt;uuid&gt;969e8881-64d6-4381-a1d6-699a41cf1be4&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;3&#039; threads=&#039;2&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/kvm&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/windows.qcow2&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:df:34:1a&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x05&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>/etc/modprobe.d/nouveau.conf has:<br />blacklist nouveau</p><p>/etc/modprobe.d/kvm.conf has:<br />options kvm ignore_msrs=1<br />options vfio_iommu_type1 allow_unsafe_interrupts=1</p> <p class="postedit"><em>Last edited by rantoie (2015-02-16 06:19:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503367">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503374" class="blockpost roweven"> <h2><span><span class="conr">#4197</span> <a href="viewtopic.php?pid=1503374#p1503374">2015-02-16 06:52:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Everything looks good except </p><p> &lt;video&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/video&gt;</p><p>You don&#039;t need virtual gpu, it could cause error 43 cause your 8800gt becomes secondary adapter and that is unsupported with geforce cards.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503374">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503390" class="blockpost rowodd"> <h2><span><span class="conr">#4198</span> <a href="viewtopic.php?pid=1503390#p1503390">2015-02-16 08:46:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84538">mauorrizze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-22</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84538">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>And if you are using a driver newer than 340.52 I think</p><div class="codebox"><pre><code>&lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;</code></pre></div><p>should be set to no.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503390">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503433" class="blockpost roweven"> <h2><span><span class="conr">#4199</span> <a href="viewtopic.php?pid=1503433#p1503433">2015-02-16 11:35:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83627">JohnyPea</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-17</span></dd> <dd><span>Posts: 17</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>just to chime in. I haven&#039;t been able to find where I got the DEVID patch but there were changes in the latest qemu source and I have modified the patch so it can be applied. So for anyone who is interested in virtual &quot;Quadrification&quot;:</p><p><a href="http://pastebin.com/APTu6r4f" rel="nofollow">http://pastebin.com/APTu6r4f</a></p><p>usage as previously mentioned:<br />Target virtual card (K4000)<br />Device Id:&#160; &#160; &#160;10DE 11FA<br />Subsystem Id: 10DE 097C</p><div class="codebox"><pre><code>vfio-pci,host=06:00.0,x-vga=on,x-vid=0x10DE,x-did=0x11FA,x-ss-vid=0x10DE,x-ss-did=0x097C,romfile=/whereever/NVIDIA.QuadroK4000.3072.120813.rom</code></pre></div><p>It has some problems with my 660TI 3GB, probably because there isn&#039;t a quadro card with exact same hardware configuration. But generally works as K4000 - same RAM config and also as K5000 - same chip.</p><br /><p>Regarding some problems with direct host pulseaudio connection I havent found the exact cause of this, but active QXL graphics diver in guest drasticaly reduces performance and causes sound crackling in widows guest (8.1). The device can be assigned to guest so you can see the boot process, but has to be disabled in windows or not installed at all (not activating the display is not enough). Hope some of this helps.</p> <p class="postedit"><em>Last edited by JohnyPea (2015-02-16 12:14:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503433">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1503489" class="blockpost rowodd"> <h2><span><span class="conr">#4200</span> <a href="viewtopic.php?pid=1503489#p1503489">2015-02-16 14:39:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88867">rantoie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-16</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rantoie@riseup.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Everything looks good except </p><p> &lt;video&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/video&gt;</p><p>You don&#039;t need virtual gpu, it could cause error 43 cause your 8800gt becomes secondary adapter and that is unsupported with geforce cards.</p></div></blockquote></div><p>Ok, I tried to remove that with virsh edit, and then saved the xml, it comes back automatically as:</p><div class="codebox"><pre><code> &lt;video&gt; &lt;model type=&#039;cirrus&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt;</code></pre></div><p>Reading the libvirt documentation: &quot;For backwards compatibility, if no video is set but there is a graphics in domain xml, then libvirt will add a default video according to the guest type. &quot;</p><p>So I tried to remove the graphics section, and the video block. This time it didn&#039;t add it back, but when I start the guest, the video is now blank <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p><div class="quotebox"><cite>mauorrizze wrote:</cite><blockquote><div><p>And if you are using a driver newer than 340.52 I think</p><div class="codebox"><pre><code>&lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;</code></pre></div><p>should be set to no.</p></div></blockquote></div><p>Thanks, I&#039;ve set that to &#039;no&#039;.</p> <p class="postedit"><em>Last edited by rantoie (2015-02-16 14:50:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1503489">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=167">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <strong>168</strong> <a href="viewtopic.php?id=162768&amp;p=169">169</a> <a href="viewtopic.php?id=162768&amp;p=170">170</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=169">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
