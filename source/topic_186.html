<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 186) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=186" title="Page 186" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=185" title="Page 185" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=187" title="Page 187" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=185">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=184">184</a> <a href="viewtopic.php?id=162768&amp;p=185">185</a> <strong>186</strong> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=187">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1514370" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4626</span> <a href="viewtopic.php?pid=1514370#p1514370">2015-03-26 16:17:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p><a href="https://www.kernel.org/doc/Documentation/sysrq.txt" rel="nofollow">https://www.kernel.org/doc/Documentation/sysrq.txt</a></p><p>I&#039;ve not tried this yet, but I plan to.</p></div></blockquote></div><p>I had sysrq enabled all time but does nothing at crash time</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514370">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514375" class="blockpost roweven"> <h2><span><span class="conr">#4627</span> <a href="viewtopic.php?pid=1514375#p1514375">2015-03-26 16:25:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I get this errors </p><div class="codebox"><pre><code>vfio-pci 0000:0a:00.0: Device is ineligible for IOMMU domain attach due to platform RMRR requirement. Contact your platform vendor. [ 1561.682642] vfio-pci 0000:0a:00.0: Device is ineligible for IOMMU domain attach due to platform RMRR requirement. Contact your platform vendor. [ 1561.728758] xenbr1: port 2(vnet0) entered disabled state</code></pre></div><div class="codebox"><pre><code>0a:00.0 0104: 103c:323b (rev 01) Subsystem: 103c:3352 Physical Slot: 2 Flags: fast devsel, IRQ 53 Memory at fbe00000 (64-bit, non-prefetchable) [size=1M] Memory at fbdf0000 (64-bit, non-prefetchable) [size=1K] I/O ports at 5000 [size=256] [virtual] Expansion ROM at fbd00000 [disabled] [size=512K] Capabilities: [80] Power Management version 3 Capabilities: [90] MSI: Enable- Count=1/32 Maskable+ 64bit+ Capabilities: [b0] MSI-X: Enable- Count=64 Masked- Capabilities: [c0] Express Endpoint, MSI 00 Capabilities: [100] Advanced Error Reporting Capabilities: [300] #19 Kernel driver in use: vfio-pci Kernel modules: hpsa</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514375">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514384" class="blockpost rowodd"> <h2><span><span class="conr">#4628</span> <a href="viewtopic.php?pid=1514384#p1514384">2015-03-26 16:56:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I get this errors </p><div class="codebox"><pre><code>vfio-pci 0000:0a:00.0: Device is ineligible for IOMMU domain attach due to platform RMRR requirement. Contact your platform vendor. [ 1561.682642] vfio-pci 0000:0a:00.0: Device is ineligible for IOMMU domain attach due to platform RMRR requirement. Contact your platform vendor. [ 1561.728758] xenbr1: port 2(vnet0) entered disabled state</code></pre></div></div></blockquote></div><p>Yep, that&#039;s the problem we&#039;re talking about.&#160; Since this is a Smart Array controller, you&#039;re basically out of luck as I don&#039;t think HP is going to be able to provide you with a firmware update that disables RMRRs.&#160; The problem is that the raid controller and the platform management controller communicate via back-channel DMA defined by RMRRs.&#160; That carves out a region or IOVA space for the device that&#039;s incompatible with PCI device assignment.&#160; We can neither ignore it nor support it and its existence implies a lack of isolation between the raid controller and the management controller.</p><p>The other question is why do you want to do this?&#160; Block devices are generally not as latency sensitive as network devices and direct assignment has diminishing returns.&#160; A virtio block devices is likely to provide nearly native performance for the guest.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514384">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514427" class="blockpost roweven"> <h2><span><span class="conr">#4629</span> <a href="viewtopic.php?pid=1514427#p1514427">2015-03-26 19:19:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89826">chinaski</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-26</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>First thanks for this great guide.</p><p>I&#039;m testing&#160; (in Fedora 21) with a Tyan S7025 board and a GT610 card, and usb passthrough works once the install process begin, but the keyboard and mouse don&#039;t work before, so if I press F12 nothing happens and also can not select an option in the grub menu....How can I solve this?</p><p>Thank you</p> <p class="postedit"><em>Last edited by chinaski (2015-03-26 19:20:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514427">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514434" class="blockpost rowodd"> <h2><span><span class="conr">#4630</span> <a href="viewtopic.php?pid=1514434#p1514434">2015-03-26 19:58:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chinaski wrote:</cite><blockquote><div><p>Hello,</p><p>First thanks for this great guide.</p><p>I&#039;m testing&#160; (in Fedora 21) with a Tyan S7025 board and a GT610 card, and usb passthrough works once the install process begin, but the keyboard and mouse don&#039;t work before, so if I press F12 nothing happens and also can not select an option in the grub menu....How can I solve this?</p><p>Thank you</p></div></blockquote></div><p>If you&#039;re doing just qemu commandline, i suggest you adding -device qxl just for input purposes. Also, there&#039;s a way to set up VNC connection. Maybe spice too, but i don&#039;t know for sure.<br />If you&#039;re doing libvirt way - you should have either spice or VNC graphics doing your input.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514434">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514632" class="blockpost roweven"> <h2><span><span class="conr">#4631</span> <a href="viewtopic.php?pid=1514632#p1514632">2015-03-27 14:58:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89826">chinaski</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-26</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>chinaski wrote:</cite><blockquote><div><p>Hello,</p><p>First thanks for this great guide.</p><p>I&#039;m testing&#160; (in Fedora 21) with a Tyan S7025 board and a GT610 card, and usb passthrough works once the install process begin, but the keyboard and mouse don&#039;t work before, so if I press F12 nothing happens and also can not select an option in the grub menu....How can I solve this?</p><p>Thank you</p></div></blockquote></div><p>If you&#039;re doing just qemu commandline, i suggest you adding -device qxl just for input purposes. Also, there&#039;s a way to set up VNC connection. Maybe spice too, but i don&#039;t know for sure.<br />If you&#039;re doing libvirt way - you should have either spice or VNC graphics doing your input.</p></div></blockquote></div><br /><p>Thank you,</p><p>I&#039;m using qemu commandline and tried adding a pci card with two usb3.0 ports. I could make it work and select f12 in bootmenu but only once, at second reboot of the host I got this now:</p><p>[&#160; 161.148722] dmar: DRHD: handling fault status reg 2<br />[&#160; 161.148731] dmar: DMAR:[DMA Read] Request device [0c:00.0] fault addr ee000 <br />DMAR:[fault reason 06] PTE Read access is not set</p><p>0c:00.0 is the usb card</p><p>Strange, but only worked once Im using the vm (windows or linux). I have also tried change the card from pci slot with same result.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514632">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514659" class="blockpost rowodd"> <h2><span><span class="conr">#4632</span> <a href="viewtopic.php?pid=1514659#p1514659">2015-03-27 17:54:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p>First, just for installing &amp; then booting a Win7 or Windows 2008 R2 guest, please refer to the following sections in the whitepaper:</p><ul><li><div class="codebox"><pre><code>Supported guest operating systems | Notes about Windows Server 2008 R2</code></pre></div></li><li><div class="codebox"><pre><code>Compatibility Support Module (CSM)</code></pre></div><p> -- strictly as background material only, you do <strong>not</strong> need to do anything with this</p></li><li><div class="codebox"><pre><code>Select features | Video driver</code></pre></div></li></ul><p>Windows 2008 R2 is a UEFI system &quot;in general&quot;, it&#039;s just its stock (default) video driver that has this inconvenient dependency on Int10h. So, OVMF (the &quot;pure&quot; build, no CSM) fakes an Int10h handler for just this OS, which is pretty raw, but enough for the user to install the guest, and then to update / install &quot;real&quot; video drivers that do not have this Int10h dependency (and then other resolutions and S3 etc become available.)</p><p>In short,</p><ol class="decimal"><li><p>You should create a virtual machine with two video adapters. The first should be QXL, the second should be your passthru GPU. Use the &quot;pure UEFI&quot; build of OVMF from Gerd&#039;s package.</p></li><li><p>QXL will allow you to install Win7 / Win2008R2 in 1024x768x32.</p></li><li><p>Update the guest&#039;s video driver for the QXL card from the stock windows driver (which OVMF fools, with regard to Int10h, see the material above) to the real QXL XDDM driver. Look at <a href="http://www.spice-space.org/download.html" rel="nofollow">http://www.spice-space.org/download.html</a> , under Guest | Windows binaries.</p></li><li><p>Install the driver for your secondary (passthru) GPU.</p></li><li><p>Potentially mark the secondary (passthru) GPU as primary desktop provider.</p></li></ol><p>Admittedly, I did not test the &quot;GPU passthru&quot; part with Windows 2008 R2 (only with Windows Server 2012 R2), but the OS installation I definitely tested, and I don&#039;t see any reason why GPU passthrough (and the dual display) should not work.</p><p>Finally, an unrelated, but nonetheless important point -- I recommend that everyone use libvirt. It supports OVMF very nicely. Please refer to the following section in the whitepaper: </p><div class="codebox"><pre><code>Installation of OVMF guests with virt-manager and virt-install</code></pre></div><p>.</p></div></blockquote></div><p>Hi and thanks for posting!</p><p>This may be an unrelated issue, but when I use -device qxl-vga my entire screen, other workspaces and even my console gets mangled by the color monster (16 colors maybe?). Using i3-wm.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514725" class="blockpost roweven"> <h2><span><span class="conr">#4633</span> <a href="viewtopic.php?pid=1514725#p1514725">2015-03-27 22:41:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ohh this is bad, long story short:</p><p>I had to build a serial cable from scratch because the motherboard serial conector was not the same pinout as the cable I bough (cable fault), install linux on a Pentium 3 box and configure to dump the console from serial</p><p>There is the log:</p><div class="codebox"><pre class="vscroll"><code>[ 2987.618210] PANIC: double fault, error_code: 0x0 [ 2987.619023] CPU: 10 PID: 2591 Comm: qemu-system-x86 Tainted: P O 4.0.0-1-mainline #12 [ 2987.619023] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./X99 Extreme6, BIOS L1.74 02/02/2015 [ 2987.619023] task: ffff8804813b14c0 ti: ffff88048107c000 task.ti: ffff88048107c000 [ 2987.619023] RIP: 0010:[&lt;ffffffff8158460d&gt;] [&lt;ffffffff8158460d&gt;] page_fault+0xd/0x30 [ 2987.619023] RSP: 0018:00007f3bd1ff8f88 EFLAGS: 00010016 [ 2987.619023] RAX: 000000000000b940 RBX: 0000000000000000 RCX: ffffffff81583277 [ 2987.619023] RDX: 000000000000b940 RSI: 0000000000000000 RDI: 00007f3bd1ff90c8 [ 2987.619023] RBP: 00007f3bd1ff9088 R08: 00007f3beeccb380 R09: 0000000000000000 [ 2987.619023] R10: 0000000000000000 R11: 0000000000000246 R12: 000000000000b940 [ 2987.619023] R13: 00007f3bd1ff90c8 R14: 0000000000000000 R15: 00007f3bee80a1c0 [ 2987.619023] FS: 00007f3bd1ffb700(0000) GS:ffff88049fd40000(0000) knlGS:0000000000000000 [ 2987.619023] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [ 2987.619023] CR2: 00007f3bd1ff8f78 CR3: 00000004813d4000 CR4: 00000000001427e0 [ 2987.619023] Stack: [ 2987.619023] BUG: unable to handle kernel paging request at 00007f3bd1ff8f88 [ 2987.619023] IP: [&lt;ffffffff81018a73&gt;] show_stack_log_lvl+0xf3/0x1b0 [ 2987.619023] PGD 48a3c7067 PUD 489c50067 PMD 48b961067 PTE 0 [ 2987.619023] Oops: 0000 [#1] PREEMPT SMP [ 2987.619023] Modules linked in: tun mousedev hid_logitech_hidpp hid_logitech_dj arc4 ecb md4 md5 hmac nls_utf8 cifs dns_resolver ebtable_filter ebtables ip6table_filter ip6_tables iptable_filter ip_tables x_tables bridge stp llc cfg80211 gspca_zc3xx gspca_main videodev rfkill media coretemp hwmon snd_hda_codec_hdmi intel_rapl snd_hda_codec_realtek iosf_mbi x86_pkg_temp_thermal snd_hda_codec_generic intel_powerclamp nls_iso8859_1 nls_cp437 kvm_intel vfat nvidia(PO) snd_usb_audio kvm snd_hda_intel snd_hda_controller fuse iTCO_wdt crct10dif_pclmul mxm_wmi iTCO_vendor_support fat crc32_pclmul snd_hda_codec snd_usbmidi_lib crc32c_intel ghash_clmulni_intel e1000e snd_rawmidi aesni_intel snd_hwdep snd_seq_device evdev drm aes_x86_64 mei_me snd_pcm lrw gf128mul snd_timer mac_hid r8169 glue_helper snd sb_edac ablk_helper i2c_i801 mii cryptd ptp tpm_tis pcspkr serio_raw edac_core mei i2c_core lpc_ich soundcore shpchp tpm pps_core wmi processor button sch_fq_codel nfs lockd grace sunrpc fscache ext4 crc16 mbcache jbd2 hid_generic sr_mod cdrom uas usb_storage sd_mod usbhid hid atkbd libps2 ahci libahci libata scsi_mod xhci_pci xhci_hcd usbcore usb_common i8042 serio [ 2987.619023] CPU: 10 PID: 2591 Comm: qemu-system-x86 Tainted: P O 4.0.0-1-mainline #12 [ 2987.619023] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./X99 Extreme6, BIOS L1.74 02/02/2015 [ 2987.619023] task: ffff8804813b14c0 ti: ffff88048107c000 task.ti: ffff88048107c000 [ 2987.619023] RIP: 0010:[&lt;ffffffff81018a73&gt;] [&lt;ffffffff81018a73&gt;] show_stack_log_lvl+0xf3/0x1b0 [ 2987.619023] RSP: 0018:ffff88049fd44e38 EFLAGS: 00010046 [ 2987.619023] RAX: 000000000000000c RBX: 0000000000000000 RCX: ffff88049fd43fc0 [ 2987.619023] RDX: 00007f3bd1ff8f88 RSI: ffffffff817f02bc RDI: ffffffff817ff1c0 [ 2987.619023] RBP: ffff88049fd44e98 R08: ffff88049fd3ffc0 R09: 00000000000008a7 [ 2987.619023] R10: 0000000000000000 R11: 00000000000008a7 R12: ffff88049fd44f58 [ 2987.619023] R13: 0000000000000000 R14: ffffffff817c9406 R15: 0000000000000000 [ 2987.619023] FS: 00007f3bd1ffb700(0000) GS:ffff88049fd40000(0000) knlGS:0000000000000000 [ 2987.619023] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [ 2987.619023] CR2: 00007f3bd1ff8f88 CR3: 00000004813d4000 CR4: 00000000001427e0 [ 2987.619023] Stack: [ 2987.619023] ffff88049fd44e98 ffffffff8157c000 0000000000000008 ffff88049fd44ea8 [ 2987.619023] ffff88049fd44e68 00007f3bd1ff8f88 ffff88048107c000 ffff88049fd44f58 [ 2987.619023] 00007f3bd1ff8f88 0000000000000040 0000000000000000 00007f3bee80a1c0 [ 2987.619023] Call Trace: [ 2987.619023] &lt;#DF&gt; [ 2987.619023] [&lt;ffffffff8157c000&gt;] ? printk+0x55/0x6b [ 2987.619023] [&lt;ffffffff81018bba&gt;] show_regs+0x8a/0x250 [ 2987.619023] [&lt;ffffffff81059007&gt;] df_debug+0x27/0x40 [ 2987.619023] [&lt;ffffffff810170b7&gt;] do_double_fault+0x87/0x100 [ 2987.619023] [&lt;ffffffff81584048&gt;] double_fault+0x28/0x30 [ 2987.619023] [&lt;ffffffff81583277&gt;] ? native_iret+0x7/0x7 [ 2987.619023] [&lt;ffffffff8158460d&gt;] ? page_fault+0xd/0x30 [ 2987.619023] &lt;&lt;EOE&gt;&gt; [ 2987.619023] &lt;UNK&gt; Code: 90 06 00 00 48 89 55 c8 eb 88 66 0f 1f 44 00 00 e8 24 84 2b 00 eb af 48 39 ca 0f 84 90 00 00 00 45 85 ff 74 06 41 f6 c7 03 74 5a &lt;48&gt; 8b 32 48 8d 42 08 4c 89 45 b0 41 83 c7 01 48 89 45 c0 48 c7 [ 2987.619023] RIP [&lt;ffffffff81018a73&gt;] show_stack_log_lvl+0xf3/0x1b0 [ 2987.619023] RSP &lt;ffff88049fd44e38&gt; [ 2987.619023] CR2: 00007f3bd1ff8f88</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514971" class="blockpost rowodd"> <h2><span><span class="conr">#4634</span> <a href="viewtopic.php?pid=1514971#p1514971">2015-03-28 19:49:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>How did you get Win7 to even load with more than 1 CPU with EFI boot?</p></div></blockquote></div><p>I&#039;ll just follow up on this part -- the rest of your comment has been addressed already, but this is indeed a different issue.</p><p>If you want Win7 + OVMF + multiple VCPUs, then you have to turn off HYPER-V features. References:</p><ul><li><p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1185253" rel="nofollow">https://bugzilla.redhat.com/show_bug.cgi?id=1185253</a></p></li><li><p><a href="https://git.fedorahosted.org/cgit/virt-manager.git/commit/?id=cbba1c4d" rel="nofollow">https://git.fedorahosted.org/cgit/virt- … d=cbba1c4d</a></p></li></ul> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514971">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1514983" class="blockpost roweven"> <h2><span><span class="conr">#4635</span> <a href="viewtopic.php?pid=1514983#p1514983">2015-03-28 20:24:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p>After that you&#039;ll probably want something more than just 1 resolution, 1024x768x32. Normally that &quot;more&quot; means the QXL XDDM driver, but in this case, the passthru GPU and its drivers are just as fine, for &quot;more&quot;.</p></div></blockquote></div><p>HA! I&#039;ve tried setting up windows 8 on a hardware UEFI platform, and i burst out laughing when..</p></div></blockquote></div><p>(I understand that you connected the above two just for comical effect, but lest we confuse others, let&#039;s point out that the quote from me relates to Windows 7 / Windows Server 2008 R2. The QXL XDDM driver which I referenced is also for Windows 7 / Windows Server 2008 R2 exclusively. (Windows 8 has a revisited driver model called WDDM, hence the QXL guest driver for Windows 8 is called &quot;QXL WDDM&quot;.) So, beyond the ironic association between the above two, ie. the limited graphics resolution, there&#039;s no actual technical connection. Anyway, I digress...)</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>1.It boots into 1024x768x32.<br />2.I try to download drivers(or, at least, a browser), starting Internet exploder..<br />3.<strong>And it says &quot;Screen resolution is too small, internet will not be exploded for today&quot;</strong><br />4.No drivers - no resolution change.<br />5.No resolution change - no drivers.</p><p>So you&#039;ve <span class="bbu">got</span> to have some CD with drivers when you try installing windows 8 or some other UEFI-compatible windowns. Or you can&#039;t download drivers.</p></div></blockquote></div><p>I understand that this Windows 8 installation targeted a hardware UEFI platform, but the moral you&#039;ve drawn from the experience doesn&#039;t equally apply to Windows 8 on OVMF (and it also may not apply to other hardware UEFI platforms). Namely, if you can convince your firmware to switch to a higher GOP resolution before it boots Windows 8, then Windows 8 will &quot;inherit&quot; that higher resolution, and it will just use the linear framebuffer like that. It won&#039;t be accelerated or anything, but a high resolution may certainly be available.</p><p>And OVMF happens to support this. Just use QXL, give it enough video RAM (the default video RAM size should be fine for most users), and then go to Device Manager | OVMF Platform Configuration in the firmware. Select your preferred resolution, and reboot. (You can reboot for example under Boot Maintenance Manager | Reset System.) On next boot, the setup TUI resolution won&#039;t change, but the OVMF splash screen and the guest OS&#039;s inherited resolution should reflect your preference. Then you can start Internet Explorer, and type the magical first URL into its URL bar. (Which is getfirefox.com, obviously :))</p><p>This is documented in the whitepaper under: (a) &quot;Notes about Windows Server 2012 and Windows 8&quot;, and (b) &quot;Platform Driver&quot;.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1514983">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515001" class="blockpost rowodd"> <h2><span><span class="conr">#4636</span> <a href="viewtopic.php?pid=1515001#p1515001">2015-03-28 20:53:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I am running into issue where efi-e1000.rom is not found. Ho to tell libvirt proper location ? I have the files in /usr/share/qemu</p></div></blockquote></div><p>The efi-e1000.rom file should come from the qemu installation (qemu bundles some iPXE binaries), and should reside under a path that qemu automatically finds.</p><p>That said, you won&#039;t have much luck netbooting VMs with iPXE oproms under OVMF at the moment. Please see the following messages / threads:</p><ul><li><p><a href="http://thread.gmane.org/gmane.network.ipxe.devel/3799" rel="nofollow">http://thread.gmane.org/gmane.network.ipxe.devel/3799</a></p></li><li><p><a href="http://thread.gmane.org/gmane.network.ipxe.devel/3815" rel="nofollow">http://thread.gmane.org/gmane.network.ipxe.devel/3815</a></p></li><li><p><a href="http://thread.gmane.org/gmane.network.ipxe.devel/3854" rel="nofollow">http://thread.gmane.org/gmane.network.ipxe.devel/3854</a></p></li></ul><p>My personal opinion is that you should</p><ul><li><p>either apply those two patches to iPXE and rebuild the oproms (hard),</p></li><li><p>or set the NIC model of your VM to virtio-net, and disable the external oprom for the NIC (easy).</p></li></ul><p>You can disable oprom loading in QEMU with</p><div class="codebox"><pre><code>-device virtio-net-pci,netdev=...,romfile=</code></pre></div><p>(yes, the equal sign is the last character of the option). The same can be done in the libvirt domain XML with</p><div class="codebox"><pre><code> &lt;interface type=&#039;network&#039;&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;rom file=&#039;&#039;/&gt; &lt;/interface&gt;</code></pre></div><p>This will cause QEMU not to load the iPXE oprom into the virtio-net NIC, which in turn will allow OVMF&#039;s builtin virtio-net driver to bind the NIC. (This is documented in OvmfPkg/README.) Then PXE boot should &quot;just work&quot;, assuming you have an otherwise correct PXE / DHCP setup on the guest&#039;s network.</p><p>(If you&#039;re interested, please refer to <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1181980" rel="nofollow">bug 1181980</a> in the RH bugzilla, and its <a href="https://bugzilla.redhat.com/buglist.cgi?bug_id=1181934,1181938,1183464,1183904" rel="nofollow">duplicates</a>.)</p><p>This method does necessitate installing the virtio-net driver in the guest OS as well, but <a href="http://alt.fedoraproject.org/pub/alt/virtio-win/latest/" rel="nofollow">that shouldn&#039;t be a problem</a>.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515001">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515165" class="blockpost roweven"> <h2><span><span class="conr">#4637</span> <a href="viewtopic.php?pid=1515165#p1515165">2015-03-29 12:09:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi Forum,<br />This is my first posting and before I get to the purpose of itself I sadly have to start with an excuse <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />I&#039;ve tried for the last ~30 hours to get this configuration working and I failed terrible ... Even thogh I&#039;ve read and kept reading, I&#039;m at a point where all is messed up in my head. The questions I&#039;m asking are probably most, if not all answered in this monster of a thread, but where is the function to search through it? Either I&#039;m blind, or I have a reason to feel as stupid as I do right now <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>My Hardware in use:<br />Asus Sabertooth Z87<br />Intel I7 4770K<br />Intel HD4600 IGM (For the Arch host)<br />Nvidia GTX 970 (For the Windows guest)<br />16GB RAM<br />Intel PRO/1000 PT (82571EB) Dualport</p><p>Yesterday I failed at the vfio point with some Error -22 stating the recource could not be found, but I&#039;m not even sure anymore what I actually need ... and thats why I&#039;m here:</p><p>Even though I think my Hardware is sufficient. Are the components able to run this configuration?<br />What patches, modules and settings vor qemu do I really need on my system with the stated HW?<br />Do I have to install both vfio and ovmf?</p><p>Those are prob. dumb questions, I know. I&#039;m desperate!</p><p>Best regards,<br />Beer Belly</p><p>P.S. I almost forgot the most Important Part: Thank you for creating this Guide and all your contributed time!</p><p>P.P.S. After going outside for a smoke to clear my head a little I think I&#039;ve found the wall I&#039;m banging my head against ... the i74770K only supports VT-x, not VT-d?!<br />Pls correct me if I&#039;m wrong...</p> <p class="postedit"><em>Last edited by bierbauch (2015-03-29 12:47:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515165">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515172" class="blockpost rowodd"> <h2><span><span class="conr">#4638</span> <a href="viewtopic.php?pid=1515172#p1515172">2015-03-29 12:44:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Pls delete this Posting!</p> <p class="postedit"><em>Last edited by bierbauch (2015-03-29 12:45:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515172">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515187" class="blockpost roweven"> <h2><span><span class="conr">#4639</span> <a href="viewtopic.php?pid=1515187#p1515187">2015-03-29 14:03:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>P.P.S. After going outside for a smoke to clear my head a little I think I&#039;ve found the wall I&#039;m banging my head against ... the i74770K only supports VT-x, not VT-d?!<br />Pls correct me if I&#039;m wrong...</p></div></blockquote></div><p>Correct, your CPU isn&#039;t going to work, no VT-d - <a href="http://ark.intel.com/products/75123/Intel-Core-i7-4770K-Processor-8M-Cache-up-to-3_90-GHz" rel="nofollow">http://ark.intel.com/products/75123/Int … o-3_90-GHz</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515187">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515190" class="blockpost rowodd"> <h2><span><span class="conr">#4640</span> <a href="viewtopic.php?pid=1515190#p1515190">2015-03-29 14:23:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thx for the verification mate,<br />Just checked my &quot;closet&quot; and only found a E3 1220L which is most likely nothing i want to use in this scenario :&#039;(.<br />I guess I&#039;ll buy myself a 4790k then ...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515190">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515228" class="blockpost roweven"> <h2><span><span class="conr">#4641</span> <a href="viewtopic.php?pid=1515228#p1515228">2015-03-29 16:34:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi again,</p><p>currently I&#039;m trying to create a windows 7 UEFI VM. Unfortunately the installation process seems to hang at the very beginning when the screen only shows &quot;Starting Windows&quot;.<br />I think the installation image should be okay, since I successfully used it for a seabios windows 7 vm.</p><p>Can someone can give me some hint, what could go wrong?</p><p>My quemu script looks as follows (no q35! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> ):</p><div class="codebox"><pre><code>taskset 0x0000003F \ qemu-system-x86_64 \ -name win7uefi \ -enable-kvm \ -cpu host,kvm=off \ -smp 6,sockets=1,cores=3,threads=2 \ -m 4096 \ -mem-path /dev/hugepages \ -mem-prealloc \ -balloon none \ -k de \ -drive if=pflash,format=raw,readonly,file=ovmf/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=ovmf/ovmf_vars_x64.bin \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=vmdata/win7uefi.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=vmdata/de_win_7_prosp1_x64.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=vmdata/virtio_drv.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -spice port=5930,disable-ticketing \ -device virtio-serial-pci \ -device virtserialport,chardev=spicechannel0,name=com.redhat.spice.0 \ -chardev spicevmc,id=spicechannel0,name=vdagent \ -rtc base=utc</code></pre></div><p>Thanks in advance!</p> <p class="postedit"><em>Last edited by apex8 (2015-03-29 16:50:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515228">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515233" class="blockpost rowodd"> <h2><span><span class="conr">#4642</span> <a href="viewtopic.php?pid=1515233#p1515233">2015-03-29 16:51:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="codebox"><pre><code>-device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \</code></pre></div><p>Thanks in advance!</p></div></blockquote></div><p>Read back a few pages (181 i think), you need to first install the OS on the normal vga qxl without the gpu being used. then install the qxl driver, then poweroff and add the gpu with vfio-pci.<br />PS I didnt need -vga none, that actually breaks my screen. I just dont use a -vga setting at all.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515233">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515238" class="blockpost roweven"> <h2><span><span class="conr">#4643</span> <a href="viewtopic.php?pid=1515238#p1515238">2015-03-29 17:16:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks Naruni, I can process the installation now. Maybe this hint about QXL is worth to added on the first post?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515248" class="blockpost rowodd"> <h2><span><span class="conr">#4644</span> <a href="viewtopic.php?pid=1515248#p1515248">2015-03-29 17:48:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89622">Draizer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, </p><p>I finally got everything to work, however I&#039;m running into a small issue : for some reason, the screen resolution is somewhat borked on my VM. While it&#039;s still in the BIOS, it&#039;s &quot;true&quot; 1920x1080, takes up my whole screen, as it should. However, once it boots onto Windows 8, for some reason, the screen shrinks (I end up with black bars on all 4 sides of the VM screen, I guess around an inch wide). Under W8 the resolution is marked as 1920x1080. Drivers are installed for my card as well.</p><p>I&#039;ve looked it up but found nothing on this, did anyone else here run into that particular issue?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515248">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515249" class="blockpost roweven"> <h2><span><span class="conr">#4645</span> <a href="viewtopic.php?pid=1515249#p1515249">2015-03-29 17:48:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Thanks Naruni, I can process the installation now. Maybe this hint about QXL is worth to added on the first post?</p></div></blockquote></div><p>It&#039;s documented in the OVMF whitepaper linked on the OP</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515249">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515257" class="blockpost rowodd"> <h2><span><span class="conr">#4646</span> <a href="viewtopic.php?pid=1515257#p1515257">2015-03-29 18:48:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Draizer wrote:</cite><blockquote><div><p>Hello, </p><p>I finally got everything to work, however I&#039;m running into a small issue : for some reason, the screen resolution is somewhat borked on my VM. While it&#039;s still in the BIOS, it&#039;s &quot;true&quot; 1920x1080, takes up my whole screen, as it should. However, once it boots onto Windows 8, for some reason, the screen shrinks (I end up with black bars on all 4 sides of the VM screen, I guess around an inch wide). Under W8 the resolution is marked as 1920x1080. Drivers are installed for my card as well.</p><p>I&#039;ve looked it up but found nothing on this, did anyone else here run into that particular issue?</p></div></blockquote></div><p>I&#039;ve seen this... on a hardware platform with win7 and win8 both. That hardware platform didn&#039;t even support UEFI at all!<br />I was using AMD HD7750 GPU on 27&quot; fullhd screen, it was 1920x1080 and it was pixel-perfect, BUT there were black stripes all around.<br />Try bothering the driver&#039;s configuration panel and screen&#039;s menu. I seriously have no idea why this happens.<br />Maybe the screen has some weird PPI?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515257">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515261" class="blockpost roweven"> <h2><span><span class="conr">#4647</span> <a href="viewtopic.php?pid=1515261#p1515261">2015-03-29 19:07:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>P.P.S. After going outside for a smoke to clear my head a little I think I&#039;ve found the wall I&#039;m banging my head against ... the i74770K only supports VT-x, not VT-d?!<br />Pls correct me if I&#039;m wrong...</p></div></blockquote></div><p>Correct, your CPU isn&#039;t going to work, no VT-d - <a href="http://ark.intel.com/products/75123/Intel-Core-i7-4770K-Processor-8M-Cache-up-to-3_90-GHz" rel="nofollow">http://ark.intel.com/products/75123/Int … o-3_90-GHz</a></p></div></blockquote></div><p>You know what&#039;s hilarious?<br />4770&#160; &#160;supports vt-d.<br />4770S supports vt-d<br />4770HD supports vt-d<br />4770R supports vt-d<br />4770T supports vt-d<br />Same thing with 3770 series, only 3770K doesn&#039;t support vt-d.<br />Moreover, there&#039;s Xeons with vt-d based on 4770 series.</p><p>Unlocked multiplier? More like disabled VT-d.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515261">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515331" class="blockpost rowodd"> <h2><span><span class="conr">#4648</span> <a href="viewtopic.php?pid=1515331#p1515331">2015-03-29 23:42:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Haswell-E has overclock and VT-D support, for example the 5820K Im using</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515331">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515365" class="blockpost roweven"> <h2><span><span class="conr">#4649</span> <a href="viewtopic.php?pid=1515365#p1515365">2015-03-30 02:46:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Here&#039;s an interesting thing.&#160; I ran the ovmf script from page 1 with the edk2.git ovmf from lersek&#039;s initial post p180-1? for win7 + Uefi + ovmf.&#160; Turns out that it works with 440fx ( with qxl and removing the hyper-v stuff) but hangs with a black screen with q35.&#160; I&#039;ve had a working q35 and 440fx using the seabios/x-vga non uefi setup. I&#039;m passing a quadro k2000. The other weird thing is that although I put -smp 6, the 440fx/ovmf/Uefi version reports only two processors. I&#039;d rather use q35 because some usb devices only work with q35 and not with 440fx, eg thumb drives.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515365">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515366" class="blockpost rowodd"> <h2><span><span class="conr">#4650</span> <a href="viewtopic.php?pid=1515366#p1515366">2015-03-30 02:50:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>Here&#039;s an interesting thing.&#160; I ran the ovmf script from page 1 with the edk2.git ovmf from lersek&#039;s initial post p180-1? for win7 + Uefi + ovmf.&#160; Turns out that it works with 440fx ( with qxl and removing the hyper-v stuff) but hangs with a black screen with q35.&#160; I&#039;ve had a working q35 and 440fx using the seabios/x-vga non uefi setup. I&#039;m passing a quadro k2000. The other weird thing is that although I put -smp 6, the 440fx/ovmf/Uefi version reports only two processors. I&#039;d rather use q35 because some usb devices only work with q35 and not with 440fx, eg thumb drives.</p></div></blockquote></div><p>Try using -device nec-usb-xhci for usb</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515366">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=185">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=184">184</a> <a href="viewtopic.php?id=162768&amp;p=185">185</a> <strong>186</strong> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=187">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
