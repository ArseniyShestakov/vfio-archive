<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 41) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=41" title="Page 41" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=40" title="Page 40" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=42" title="Page 42" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=40">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=39">39</a> <a href="viewtopic.php?id=162768&amp;p=40">40</a> <strong>41</strong> <a href="viewtopic.php?id=162768&amp;p=42">42</a> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=42">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1369612" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1001</span> <a href="viewtopic.php?pid=1369612#p1369612">2014-01-11 05:31:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, on the mailing list, Andrew helped me track down my &quot;genirq&quot; issue.&#160; Somehow, I had set &quot;nointxmask&quot; on vfio-pci.&#160; However, the behavior I&#039;m getting is still somewhat odd.</p><p>Intel video is host, but is in UEFI boot mode.&#160; Therefore, I&#039;d expect it to not need the legacy VGA registers...<br />I&#039;m booted into a kernel WITH the Intel VGA Abiter patches, though.</p><p>Radeon is handed to the guest, as secondary video (precautions against VGA arbitration issues).<br />With pci-assign, the radeon needs to be manually ejected before guest session, and upon doing so, the GPU fan kicks into ultra-high-speed mode.<br />With radeon handed to VM via vfio, but still as secondary device (no x-vga), the VM shows garbage on the Radeon, and then reboots.</p><p>Ideally, I&#039;d like to get a video card with native UEFI boot mode support -- with a proper EFI GOP video card, Windows 8 supposedly doesn&#039;t need the legacy VGA registers at all.<br />Right now, that a moot point, since the VM won&#039;t even TRY to boot if I try to use OVMF.fd as the firmware.&#160; I don&#039;t even get the TianoCore logo, even with all VFIO usage removed!</p><p>EDIT: Okay, redid it without libvirt involved at all.<br />Q35 system, primary is cirrus, BIOS image not loaded: VIDEO_TR_FAILURE (atikmpag.sys)<br />Q35 system, primary is QXL, BIOS image not loaded: Radeon driver won&#039;t load due to unspecified resource conflict.<br />Q35 system, primary is cirrus or QXL, BIOS image loaded: THREAD_STUCK_IN_DEVICE_DRIVER<br />Q35 system, x-vga=on: some reboots with no output, some boots with THREAD_STUCK_IN_DEVICE_DRIVER.<br />piix4 system: tutorial doesn&#039;t say where I should attach things.</p><p>EDIT again: Okay, this time I tried removing ALL forwarded devices.&#160; Still, black screen!<br />EDIT yet again: While I bang my head against this for a while longer (or perhaps just call it a night), I guess I&#039;ll leave a few coherent questions.</p><p>The biggest question: is my assumption that using EFI boot in the guest will make VGA arbitration unnnecessary, likely to be true?&#160; Also, what can I do to get Qemu to actually START in EFI mode?</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-01-11 06:23:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1369641" class="blockpost roweven"> <h2><span><span class="conr">#1002</span> <a href="viewtopic.php?pid=1369641#p1369641">2014-01-11 09:02:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77762">firewing1</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-17</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77762">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I forget where I read this but I remember seeing that booting from UEFI causes some issues with VFIO for now. I could try without it and if it works, see if A.W. can help point you in the right direction. He posts here from time to time or you may have better luck on the qemu mailing lists.<br />Edit: <a href="http://listarc.com/showthread.php?4758356-conf%3A+formatter%2Fparser%2FRNG%2Fdocs+for+hostdev+%3Cdriver+name%3D%27kvm%7Cvfio%27%2F%3E" rel="nofollow">this</a> seems to prove me wrong about UEFI+VFIO, so maybe the issue was UEFI + VBIOS / x-vga=on...</p> <p class="postedit"><em>Last edited by firewing1 (2014-01-11 09:05:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369641">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1369736" class="blockpost rowodd"> <h2><span><span class="conr">#1003</span> <a href="viewtopic.php?pid=1369736#p1369736">2014-01-11 16:49:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The vfio passthrough isn&#039;t even a factor in OVMF not working.&#160; Compare these two command lines:<br /> qemu-system-x86_64 -M q35 -m 5120 -boot menu=on -monitor stdio -debugcon file:/dev/stderr -global isa-debugcon.iobase=0x402 -bios /usr/share/seabios/bios.bin<br /> qemu-system-x86_64 -M q35 -m 5120 -boot menu=on -monitor stdio -debugcon file:/dev/stderr -global isa-debugcon.iobase=0x402 -bios /usr/share/ovmf/OVMF.fd</p><p>The former goes on to PXE boot; the latter just hangs, before even printing any of the isa-debugcon info!</p><p>EDIT: Okay, well, at least the following tries to start:<br />qemu-system-x86_64 -M pc -m 5120 -boot menu=on -monitor stdio -debugcon file:/dev/stderr -global isa-debugcon.iobase=0x402 -bios /usr/share/ovmf/OVMF.fd<br />However, if I add enable-kvm, it again hangs instead of booting.</p><p>Are there any general guidelines about where you&#039;re supposed to attach the GPU on the i440fx virtual machine?</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-01-11 17:22:29)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369736">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1369755" class="blockpost roweven"> <h2><span><span class="conr">#1004</span> <a href="viewtopic.php?pid=1369755#p1369755">2014-01-11 17:36:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Okay, it looks like UEFI is a dead-end -- it&#039;s only in a minimally-usable state.<br />The better option is to keep using Cirrus as primary, but I&#039;d really like to get it working with vfio for the Radeon, instead of pci-attach.&#160; Right now, attempting to do so results in a guest display full of checkerboarded static, and then a guest reboot.</p><p>EDIT: Interesting: I can get a somewhat more correct pc-q35 system using this config file: <a href="https://github.com/qemu/qemu/blob/master/docs/q35-chipset.cfg" rel="nofollow">https://github.com/qemu/qemu/blob/maste … hipset.cfg</a></p><p>Then the semantics of attaching devices is somewhat different:<br />-readconfig q35-chipset.cfg \<br />-device vfio-pci,host=01:00.0,bus=ich9-pcie-port-1,romfile=/usr/share/qemu/hd5750_vbios.bin,x-vga=on<br />-device vfio-pci,host=09:00.0,bus=ich9-pcie-port-2 \<br />-device vfio-pci,host=0c:00.0,bus=ich9-pcie-port-3 \<br />-device vfio-pci,host=07:04.0,bus=ich9-pci-bridge \</p><p>The last device is actually a PCI device, not a PCIe device, by the way.</p><p>With the above config, I can boot an Ubuntu VM, and get garbled colors on the host, but working 3D acceleration on an Ubuntu LiveCD.&#160; It still BSODs in Windows, though.</p><p>EDIT: Adding some version info:</p><p>seabios: (version rel-1.7.3-117-g31b8b4e-20131206_080705-nilsson.home.kraxel.org)<br />QEMU emulator version 1.7.0 (Debian 1.7.0+dfsg-2ubuntu5), Copyright (c) 2003-2008 Fabrice Bellard</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-01-11 18:36:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369755">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1369772" class="blockpost rowodd"> <h2><span><span class="conr">#1005</span> <a href="viewtopic.php?pid=1369772#p1369772">2014-01-11 18:45:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77762">firewing1</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-17</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77762">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><p>With the above config, I can boot an Ubuntu VM, and get garbled colors on the host, but working 3D acceleration on an Ubuntu LiveCD.&#160; It still BSODs in Windows, though.</p></div></blockquote></div><p>Your hardware is very similar to my setup - the garbled colors and BSOD I was able to fix using the Haswell i915 arbitration patches. If you haven&#039;t applied those already, try rebuilding the kernel with them.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369772">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1369781" class="blockpost roweven"> <h2><span><span class="conr">#1006</span> <a href="viewtopic.php?pid=1369781#p1369781">2014-01-11 19:07:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Interesting... I realized I had somehow trampled on git qemu, and hence reinstalled git qemu.&#160; </p><p>After a bit more mucking around, I finally got the damn thing to start -- even WITHOUT the VGA arbiter patches!</p><p>Here&#039;s my complete config now:</p><p>qemu-system-x86_64 \<br />-enable-kvm \<br />-M q35 \<br />-m 5120 \<br />-cpu host \<br />-boot order=dc \<br />-monitor stdio \<br />-debugcon file:/dev/stderr -global isa-debugcon.iobase=0x402 \<br />-smp 8,sockets=1,cores=4,threads=2 \<br />-bios /usr/share/qemu/bios.bin \<br />-readconfig <a href="https://raw.github.com/qemu/qemu/master/docs/q35-chipset.cfg" rel="nofollow">q35-chipset.cfg</a> \<br />-device vfio-pci,host=01:00.0,bus=ich9-pcie-port-1,rombar=0 \<br />-device vfio-pci,host=09:00.0,bus=ich9-pcie-port-3 \<br />-device vfio-pci,host=0c:00.0,bus=ich9-pcie-port-4 \<br />-device vmware-svga,bus=ich9-pci-bridge \<br />-device vfio-pci,host=07:04.0,bus=ich9-pci-bridge \<br />-drive id=dvd -device ide-cd,drive=dvd,bus=ide.0 \<br />-drive file=/var/lib/libvirt/images/Windows.img,id=hdd,format=raw -device ide-hd,drive=hdd,bus=ide.1 \<br />-device usb-tablet \<br />-net none</p><p>I&#039;m not exactly sure WHAT it&#039;s using for VGA bios now (particularly considering where I stashed the vmware VGA controller), but hey, as long as it boots, it&#039;s great.</p><p>EDIT: Note that &quot;-net none&quot; is acceptable for me, because I&#039;m forwarding 0c:00.0, which is a real NIC.</p><p>EDIT: Also note: the host is, again, in EFI boot mode.&#160; With my hacked-up config above, I have no idea if that&#039;s part of why it works.</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-01-11 19:29:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1369781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370027" class="blockpost rowodd"> <h2><span><span class="conr">#1007</span> <a href="viewtopic.php?pid=1370027#p1370027">2014-01-12 14:38:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76566">cryptonymous</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-05</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><strong> AUDIO EMULATION:</strong> </p><p>To hear the sound from the vm on your host speakers you&#039;ll need to add this lines:</p><div class="codebox"><pre><code>-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 </code></pre></div><p>You might need to start qemu like this (using pulseaudio, to use a different driver change QEMU_AUDIO_DRV= variable):</p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64...</code></pre></div></div></blockquote></div><p>With QEMU_PA_SAMPLES=128 the sound is horribly distorted here. Without this parameter it works fine though. @Op: What is the background of this setting?</p></div></blockquote></div><p>Trial and error, im using alsa now instead of pulse now though</p></div></blockquote></div><p>What QEMU_AUDIO_* and QEMU_ALSA_* parameters do you use? Is there something non-default in your .asoundrc? I was unable to pick up the right parameters to use with QEMU_AUDIO_DRV=alsa and Windows 7. Sound is horribly chopped and distorted each time I run the Windows 7 VM (sound works fine in a Linux VM with default parameters). Specifying usb-audio or ich9-intel-hda as emulated sound card doesn&#039;t really make any difference. Sound card used on the host system is HDA Intel (ALC1150).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370027">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370090" class="blockpost roweven"> <h2><span><span class="conr">#1008</span> <a href="viewtopic.php?pid=1370090#p1370090">2014-01-12 18:58:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>cryptonymous wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>With QEMU_PA_SAMPLES=128 the sound is horribly distorted here. Without this parameter it works fine though. @Op: What is the background of this setting?</p></div></blockquote></div><p>Trial and error, im using alsa now instead of pulse now though</p></div></blockquote></div><p>What QEMU_AUDIO_* and QEMU_ALSA_* parameters do you use? Is there something non-default in your .asoundrc? I was unable to pick up the right parameters to use with QEMU_AUDIO_DRV=alsa and Windows 7. Sound is horribly chopped and distorted each time I run the Windows 7 VM (sound works fine in a Linux VM with default parameters). Specifying usb-audio or ich9-intel-hda as emulated sound card doesn&#039;t really make any difference. Sound card used on the host system is HDA Intel (ALC1150).</p></div></blockquote></div><p>Using win 8.1</p><div class="codebox"><pre><code>QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170 QEMU_AUDIO_DRV=alsa qemu-system-x86_64...</code></pre></div><p>But like i said, it was just trial and error, and no its just stock arch settings on a gnome3 desktop</p> <p class="postedit"><em>Last edited by nbhs (2014-01-12 19:00:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370090">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370135" class="blockpost rowodd"> <h2><span><span class="conr">#1009</span> <a href="viewtopic.php?pid=1370135#p1370135">2014-01-12 20:46:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72586">dogblue</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-23</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dogblue@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>beardedchimp wrote:</cite><blockquote><div><p>Games that don&#039;t work:<br />CS:GO<br />Shogun 2<br />Tomb Raider (the new one)<br />Civ 5<br />A load of others but can&#039;t remember which</p></div></blockquote></div><p>I have also had problems with Shogun 2. The demo (downloaded from steam) ran fine, but after I bought it it would crash to desktop from the loading/legal screen. I assumed it was just poorly written and unrelated to running in a VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370135">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370238" class="blockpost roweven"> <h2><span><span class="conr">#1010</span> <a href="viewtopic.php?pid=1370238#p1370238">2014-01-13 05:41:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78314">MacCoaster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-06</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Works fine for me with a Radeon HD7770, after trying many different configurations. Have a R9 280X on the way.</p><p>Specs:</p><div class="quotebox"><blockquote><div><p>ASUS P9D-WS motherboard<br />Intel Xeon E3-1275 v3<br />32 GB RAM<br />LSI SAS9211-8I<br />XFX Radeon HD7770</p></div></blockquote></div><p>I had to plug in the LSI card on the last x16 slot which forced it in x4 mode, just so I could get the GPU in its isolated IOMMU group.</p><p>I compiled 3.13-rc6 using the PKGBUILD from <a href="https://aur.archlinux.org/packages/linux-mainline/" rel="nofollow">https://aur.archlinux.org/packages/linux-mainline/</a>, putting in the Intel IGP arbitration patch and the memory leak patch posted earlier, with all the CONFIG_VFIO stuff built in the kernel.</p><p>Installed libvirt, et al., save for QEMU and seabios using pacman. Pulled from QEMU git recursively and compiled, installed into /usr/local.</p><p>I added these arguments to the kernel command line:</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1 intel_iommu=on pci-stub.ids=xxxx:yyyy,aaaa:bbbb kvm_intel.emulate_invalid_guest_state=0 nohz=off</code></pre></div><p>Replacing xxxx:yyyy and aaaa:bbbb with their appropriate respective PCI ids for the GPUs.</p><p><strong>/etc/libvirt/qemu.conf:</strong></p><div class="codebox"><pre><code>user = &quot;root&quot; group = &quot;kvm&quot; cgroup_device_acl = [ &quot;/dev/null&quot;, &quot;/dev/full&quot;, &quot;/dev/zero&quot;, &quot;/dev/random&quot;, &quot;/dev/urandom&quot;, &quot;/dev/ptmx&quot;, &quot;/dev/kvm&quot;, &quot;/dev/kqemu&quot;, &quot;/dev/rtc&quot;,&quot;/dev/hpet&quot;, &quot;/dev/vfio/vfio&quot;, &quot;/dev/vfio/1&quot; ] clear_emulator_capabilities = 0</code></pre></div><p>For some reason, </p><div class="codebox"><pre><code>clear_emulator_capabilities = 1</code></pre></div><p> would not work. Is this really a big deal? qemu.conf has a scary-sounding warning: </p><div class="codebox"><pre><code># Warning: Disabling this option means that a compromised guest can # exploit the privileges and possibly do damage to the host.</code></pre></div><p>And in my libvirt XML specification I use, the relevant parts:</p><div class="codebox"><pre><code>&lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-1.7&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;/cpu&gt; ... &lt;seclabel type=&#039;none&#039;/&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;qemu:arg value=&#039;-bios&#039;/&gt; &lt;qemu:arg value=&#039;/usr/local/share/qemu/bios.bin&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=pcie.0&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>Installed Windows 8.1 with VFIO drivers at install time. Installed Radeon drivers. Everything seems to work fine.</p><p>Now I need to figure out how to pin CPUs and stuff like that.</p><p>Does anyone know if VM guest suspend/pause works with GPU passthrough or not?</p> <p class="postedit"><em>Last edited by MacCoaster (2014-01-13 05:49:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370249" class="blockpost rowodd"> <h2><span><span class="conr">#1011</span> <a href="viewtopic.php?pid=1370249#p1370249">2014-01-13 07:16:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73114">noctavian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-11</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73114">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><p>EDIT: Also note: the host is, again, in EFI boot mode.&#160; With my hacked-up config above, I have no idea if that&#039;s part of why it works.</p></div></blockquote></div><p>When I tried to do VGA passthrough with pci-assign last summer, I had a problem, IOMMU and DMAR weren&#039;t enabled properly unless I was booting in (U)EFI mode, I think it was something related to secure boot or a buggy (U)EFI. I updated to the latest (U)EFI for my motherboard, then (re)installed Arch in (U)EFI boot mode and then IOMMU and DMAR were beeing enabled and VGA passthrough worked.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">VGA-Passthrough configs</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370249">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1370716" class="blockpost roweven"> <h2><span><span class="conr">#1012</span> <a href="viewtopic.php?pid=1370716#p1370716">2014-01-14 12:51:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76479">Norcoen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Norway</span></dd> <dd><span>Registered: 2013-11-02</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:frankmoll@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MacCoaster wrote:</cite><blockquote><div><p>Does anyone know if VM guest suspend/pause works with GPU passthrough or not?</p></div></blockquote></div><p>pause/resume vm works fine for me with 7850 OC</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1370716">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1371063" class="blockpost rowodd"> <h2><span><span class="conr">#1013</span> <a href="viewtopic.php?pid=1371063#p1371063">2014-01-15 04:14:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, just for comparison, I tried an NVIDIA GeForce 260 (borrowed); with my same config above that works with the Radeon, it definitely does NOT work with the nvidia card (even with the Code 43 NoSnoop patch).</p><p>If I go to device manager (audio navigation using Narrator), I can try to disable and re-enable the GeForce, and I get Qemu (on the host) aborting:</p><div class="codebox"><pre><code>qemu-system-x86_64: hw/pci/pci.c:232: pcibus_reset: Assertion `bus-&gt;irq_count[i] == 0&#039; failed.</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1371063">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1371158" class="blockpost roweven"> <h2><span><span class="conr">#1014</span> <a href="viewtopic.php?pid=1371158#p1371158">2014-01-15 12:50:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have a problem getting the patch for the nvidia driver to work. My setup has the kernel + qemu + seabios from OP. But i cant figure out how to get a patched nvidia proprietary driver for the host.</p><p>I tried building the driver using ABS, changing the version in the PKGBUILD to 319.23 and applying the andy123 patch from OP. But i couldn&#039;t get past some xorg dependency issue to install it.</p><p>In addition i tried changing the version numbers in the patch file and PKGBUILD applying it to the current version 331.38, but i could not load the module.</p><p>What am i doing wrong here?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1371158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1371420" class="blockpost rowodd"> <h2><span><span class="conr">#1015</span> <a href="viewtopic.php?pid=1371420#p1371420">2014-01-16 06:24:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Been studying this fine thread for quite a bit, great work, appreciate it!</p><p>Now I have things up and running, specs:</p><p>ASUS Rampage IV Extreme<br />intel 4930K<br />beta BIOS 9502 (only bios currently for this mb that supports vt-d for ivy-E)<br />host using AMD 7970 and radeon drivers<br />Windows 7 guest in VM using NVIDIA K2000 passed through<br />host is Slackware 14.1 but with kernel 3.12.1 downloaded from kernel.org with iommu config options compiled in kernel<br />qemu 1.7.50 from git per original post on this thread, with seabios as well</p><p>Things pretty much worked exactly according to instructions.&#160; I have no sound on the guest, but haven&#039;t given up yet, suspect it&#039;s a qemu compile problem. Had the catalyst driver installed with Slackware&#039;s default kernel but for some reason it didn&#039;t play nice with kernel 3.12.1.&#160; Couldn&#039;t run X.&#160; &#160;It&#039;s a work in progress.</p> <p class="postedit"><em>Last edited by mostlyharmless (2014-01-16 06:32:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1371420">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1371808" class="blockpost roweven"> <h2><span><span class="conr">#1016</span> <a href="viewtopic.php?pid=1371808#p1371808">2014-01-17 09:12:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>A quick update. My attempt to run VGA_Passthrough is what i would call a success with the odd hickup here and there.</p><p>Info: <br />Motherboard - Gigabyte 990XA-UD3 (ps dont buy this motherboard, it is not good imo)<br />CPU - AMD 8350fx 8 core (6 cores reserved for guest, 2 for host)<br />RAM - 8GB (4gb reserved for guest)<br />Host VGA - Nvidia GTX 570<br />Guest VGA - Nvidia GTX 580<br />120Gb ssd for host<br />120Gb ssd for guest<br />Host is Arch linux with kernel+qemu+seabios from OP<br />Guest is Win7 64bit</p><p>I have only gotten as far as to getting the guest up and running on the passed through card, havent tested any games or 3d intensive apps yet. It seems to work good in guest, i get a windows experience rating of 7,3 and aero looks smooth and good. I will report back with more info on performance etc after i get some more testing done.</p><p>What i havent gotten working:<br />Nvidia driver for the host. I am having problems getting the driver patched using OP patch from andy123, this is not a vga passthrough/kvm/qemu problem but probably due to user error on my part.<br />Sound is not tested yet.<br />I can only run the vm one time each reboot, it is kinda annoying but i really cant find a way to debug and fix this. If someone have any tips i can try pls let me know.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1371808">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372069" class="blockpost rowodd"> <h2><span><span class="conr">#1017</span> <a href="viewtopic.php?pid=1372069#p1372069">2014-01-18 03:21:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78672">Lauri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-18</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78672">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for this great thread. With all the information here I was able to get VGA passthrough working.</p><p>My setup is:<br />Debian testing host<br />Kernel 3.12.8 with i915 and acs override patches<br />QEMU-git with nosnoop patch<br />Windows 7 guest</p><p>Motherboard: Asus Z87-K<br />CPU: Intel i7-4770<br />GPU host: Intel HD4600<br />GPU guest: GeForce GTX560</p><p>I&#039;ve only used this for gaming and so far every game I&#039;ve tried has worked. Only problem I have with this is if I shutdown the VM I have to reboot the host to get VGA passthrough working again.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372069">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372151" class="blockpost roweven"> <h2><span><span class="conr">#1018</span> <a href="viewtopic.php?pid=1372151#p1372151">2014-01-18 12:12:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>when i try to compile your qemu-git i get:</p><div class="codebox"><pre><code>cp: cannot stat ‘/home/user/Downloads/qemu-git/src/qemu-git-2.0.r30392.g1cf892c/libcacard.pc’: No such file or directory ==&gt; ERROR: A failure occurred in package_libcacard-git(). Aborting...</code></pre></div><p>Why would i run into problems if i compile from AUR? (not that i can, qemu requires spice, spice requires libcacard and libcacard conflicts with qemu breaking the package) <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>Why can&#039;t we use the qemu package in the official repos?</p><p>Finally, how do i apply the patch for using the nvidia proprietary drivers on the host? i can see a patch, but i ahve no idea what file to patch or how to get my hands on it (i thought they were closed source these drivers...(</p> <p class="postedit"><em>Last edited by rabcor (2014-01-18 13:53:48)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372151">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372181" class="blockpost rowodd"> <h2><span><span class="conr">#1019</span> <a href="viewtopic.php?pid=1372181#p1372181">2014-01-18 14:35:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p> […]<br />Finally, how do i apply the patch for using the nvidia proprietary drivers on the host? i can see a patch, but i ahve no idea what file to patch or how to get my hands on it (i thought they were closed source these drivers...(</p></div></blockquote></div><p>Since mbirkis also had a problem with this, <a href="https://gist.github.com/ajs124/8491428" rel="nofollow">here</a> is my modified PKGBUILD for current nvidia-dkms.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372181">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372196" class="blockpost roweven"> <h2><span><span class="conr">#1020</span> <a href="viewtopic.php?pid=1372196#p1372196">2014-01-18 15:09:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks, i tried that and it didn&#039;t work for me it seems, i.e. if i run the mainline kernel i can&#039;t start X (on host), but if i run the stock arch kernel it runs X. Do i need to run a special command or something to make the card work?</p> <p class="postedit"><em>Last edited by rabcor (2014-01-18 15:09:38)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372196">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372198" class="blockpost rowodd"> <h2><span><span class="conr">#1021</span> <a href="viewtopic.php?pid=1372198#p1372198">2014-01-18 15:12:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="https://wiki.archlinux.org/index.php/Dkms" rel="nofollow">Dkms</a> needs to be set up and working, but besides that… maybe you don&#039;t have the headers installed for the mainline kernel?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372198">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372278" class="blockpost roweven"> <h2><span><span class="conr">#1022</span> <a href="viewtopic.php?pid=1372278#p1372278">2014-01-18 18:24:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, is there any way to get suspend/resume of the host to not crash the guest?&#160; I suspended my host, and now the guest refuses to boot -- I&#039;ll hear my Xonar sound card click (indicating that the driver has loaded), but then the guest reboots, over and over.<br />I tried switching back to the Cirrus as VGA, and the damn thing still gives THREAD_STUCK_IN_DEVICE_DRIVER, and tries to reboot.&#160; However, instead of rebooting, Qemu crashes:</p><div class="codebox"><pre><code>pcibus_reset: Assertion `bus-&gt;irq_count[i] == 0&#039; failed.</code></pre></div><p>gdb backtrace:</p><div class="codebox"><pre class="vscroll"><code>#0 0x00007f72de10af77 in __GI_raise (sig=sig@entry=6) at ../nptl/sysdeps/unix/sysv/linux/raise.c:56 resultvar = 0 pid = 27419 selftid = 27419 #1 0x00007f72de10e5e8 in __GI_abort () at abort.c:90 save_stage = 2 act = {__sigaction_handler = {sa_handler = 0x7fffabffe532, sa_sigaction = 0x7fffabffe532}, sa_mask = {__val = {140131329995524, 140131448300662, 232, 140127602999296, 140131328612305, 140131480475824, 140736079064797, 124136728992, 4, 140736079056528, 0, 0, 0, 140131329994867, 140131442405376, 140131330010968}}, sa_flags = -449665849, sa_restorer = 0x7f72e532aff6 &lt;__PRETTY_FUNCTION__.24793&gt;} sigs = {__val = {32, 0 &lt;repeats 15 times&gt;}} #2 0x00007f72de103d43 in __assert_fail_base (fmt=0x7f72de25af58 &quot;%s%s%s:%u: %s%sAssertion `%s&#039; failed.\n%n&quot;, assertion=assertion@entry=0x7f72e532a4c7 &quot;bus-&gt;irq_count[i] == 0&quot;, file=file@entry=0x7f72e532a476 &quot;hw/pci/pci.c&quot;, line=line@entry=232, function=function@entry=0x7f72e532aff6 &lt;__PRETTY_FUNCTION__.24793&gt; &quot;pcibus_reset&quot;) at assert.c:92 str = 0x7f72e7346790 &quot;&quot; total = 4096 #3 0x00007f72de103df2 in __GI___assert_fail (assertion=0x7f72e532a4c7 &quot;bus-&gt;irq_count[i] == 0&quot;, file=0x7f72e532a476 &quot;hw/pci/pci.c&quot;, line=232, function=0x7f72e532aff6 &lt;__PRETTY_FUNCTION__.24793&gt; &quot;pcibus_reset&quot;) at assert.c:101 No locals. #4 0x00007f72e507e487 in pcibus_reset (qbus=0x7f72e704a440) at hw/pci/pci.c:232 bus = 0x7f72e704a440 i = 3 __PRETTY_FUNCTION__ = &quot;pcibus_reset&quot; #5 0x00007f72e4ff80c3 in qbus_reset_one (bus=0x7f72e704a440, opaque=0x0) at hw/core/qdev.c:236 bc = 0x7f72e7054d40 __func__ = &quot;qbus_reset_one&quot; #6 0x00007f72e4ff8698 in qbus_walk_children (bus=0x7f72e704a440, pre_devfn=0x0, pre_busfn=0x0, post_devfn=0x7f72e4ff800d &lt;qdev_reset_one&gt;, post_busfn=0x7f72e4ff8053 &lt;qbus_reset_one&gt;, opaque=0x0) at hw/core/qdev.c:365 kid = 0x0 err = 0 #7 0x00007f72e4ff8756 in qdev_walk_children (dev=0x7f72e70603c0, pre_devfn=0x0, pre_busfn=0x0, post_devfn=0x7f72e4ff800d &lt;qdev_reset_one&gt;, post_busfn=0x7f72e4ff8053 &lt;qbus_reset_one&gt;, opaque=0x0) at hw/core/qdev.c:390 bus = 0x7f72e704a440 err = 0 #8 0x00007f72e4ff865c in qbus_walk_children (bus=0x7f72e70356d0, pre_devfn=0x0, pre_busfn=0x0, post_devfn=0x7f72e4ff800d &lt;qdev_reset_one&gt;, post_busfn=0x7f72e4ff8053 &lt;qbus_reset_one&gt;, opaque=0x0) at hw/core/qdev.c:356 kid = 0x7f72e7055fa0 err = 0 #9 0x00007f72e4ff8183 in qbus_reset_all (bus=0x7f72e70356d0) at hw/core/qdev.c:248 No locals. #10 0x00007f72e4ff81c8 in qbus_reset_all_fn (opaque=0x7f72e70356d0) at hw/core/qdev.c:254 bus = 0x7f72e70356d0 #11 0x00007f72e51a0aa4 in qemu_devices_reset () at vl.c:1839 re = 0x7f72e730eed0 nre = 0x7f72e735b2e0 #12 0x00007f72e51a0b10 in qemu_system_reset (report=true) at vl.c:1848 No locals. #13 0x00007f72e51a1029 in main_loop_should_exit () at vl.c:1981 r = RUN_STATE_DEBUG #14 0x00007f72e51a1139 in main_loop () at vl.c:2021 nonblocking = false last_io = 1 #15 0x00007f72e51a8715 in main (argc=54, argv=0x7fffabffd6e8, envp=0x7fffabffd8a0) at vl.c:4382 i = 64 snapshot = 0 linux_boot = 0 icount_option = 0x0 initrd_filename = 0x0 kernel_filename = 0x0 kernel_cmdline = 0x7f72e534d0e6 &quot;&quot; boot_order = 0x7f72e7010300 &quot;dc&quot; ds = 0x7f72e70e8810 cyls = 0 heads = 0 secs = 0 translation = 0 hda_opts = 0x0 opts = 0x7f72e7010250 ---Type &lt;return&gt; to continue, or q &lt;return&gt; to quit--- machine_opts = 0x7f72e7010180 olist = 0x7f72e573abc0 &lt;qemu_machine_opts&gt; optind = 54 optarg = 0x7fffabffe891 &quot;base=localtime&quot; loadvm = 0x0 machine = 0x7f72e5746da0 &lt;pc_q35_machine_v2_0&gt; cpu_model = 0x7fffabffe565 &quot;host&quot; vga_model = 0x7fffabffe628 &quot;cirrus&quot; qtest_chrdev = 0x0 qtest_log = 0x0 pid_file = 0x0 incoming = 0x0 show_vnc_port = 0 defconfig = true userconfig = true log_mask = 0x0 log_file = 0x0 mem_trace = {malloc = 0x7f72e51a47f8 &lt;malloc_and_trace&gt;, realloc = 0x7f72e51a4850 &lt;realloc_and_trace&gt;, free = 0x7f72e51a48bd &lt;free_and_trace&gt;, calloc = 0x0, try_malloc = 0x0, try_realloc = 0x0} trace_events = 0x0 trace_file = 0x0 args = {machine = 0x7f72e5746da0 &lt;pc_q35_machine_v2_0&gt;, ram_size = 5368709120, boot_order = 0x7f72e7010300 &quot;dc&quot;, kernel_filename = 0x0, kernel_cmdline = 0x7f72e534d0e6 &quot;&quot;, initrd_filename = 0x0, cpu_model = 0x7fffabffe565 &quot;host&quot;}</code></pre></div><br /><p>EDIT: Okay, I managed to get the thing to hang instead of BSODing.&#160; <a href="http://msdn.microsoft.com/en-us/library/ff569918%28v=vs.85%29.aspx" rel="nofollow">http://msdn.microsoft.com/en-us/library … 85%29.aspx</a><br />What can I do to debug this, now?</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-01-18 19:01:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372278">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372280" class="blockpost rowodd"> <h2><span><span class="conr">#1023</span> <a href="viewtopic.php?pid=1372280#p1372280">2014-01-18 18:33:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p><a href="https://wiki.archlinux.org/index.php/Dkms" rel="nofollow">Dkms</a> needs to be set up and working, but besides that… maybe you don&#039;t have the headers installed for the mainline kernel?</p></div></blockquote></div><p>dkms nvidia drivers require dkms as a dependency, so naturally i have that.</p><p>linux-mainline headers should be a part of the linux-mainline package (according to AUR)</p> <p class="postedit"><em>Last edited by rabcor (2014-01-18 18:34:00)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372280">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372287" class="blockpost roweven"> <h2><span><span class="conr">#1024</span> <a href="viewtopic.php?pid=1372287#p1372287">2014-01-18 18:54:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p><a href="https://wiki.archlinux.org/index.php/Dkms" rel="nofollow">Dkms</a> needs to be set up and working, but besides that… maybe you don&#039;t have the headers installed for the mainline kernel?</p></div></blockquote></div><p>dkms nvidia drivers require dkms as a dependency, so naturally i have that.</p><p>linux-mainline headers should be a part of the linux-mainline package (according to AUR)</p></div></blockquote></div><p>Sure, it installs the dkms package, but did you enable the service, start it and build the module?</p><p>I&#039;m building the kernel from the stable git repository and using the pkgbuild from [core] with makepkg -R atm.</p><p>Moreover what do you mean by &quot;X doesn&#039;t start&quot;? Can you post xinit output, or output from your display manager, anything?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372287">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372297" class="blockpost rowodd"> <h2><span><span class="conr">#1025</span> <a href="viewtopic.php?pid=1372297#p1372297">2014-01-18 19:23:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>oh hey it works, i just had to bind the other GPU to vfio first. Otherwise it gave me a: &quot;NVIDIA: Failed to load the NVIDIA kernel module. No Devices Detected&quot;</p><p>Also, if i bound my 01:00.0&#160; (Primary GPU, i.e. the one that&#039;s loaded in the first PCI-E slot on my motherboard) X would give the same error, but if i load 02:00.0 instead (the other card) X loaded the primary card.</p><p>Weird, i don&#039;t get it but well, it works. The rest (i guess) is to got a VM (and blasted QEMU which wont build!) up and running, first time using Qemu though, i&#039;m bound to run into problems, but this is like the 3rd time i tried to follow this guide <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /> first time i have any kind of success with this too (yeah i&#039;m such a noob, sorry)</p><p>I bet it might be a pain to use my gaming keyboard though.</p><p>I have 2 questions though that bothered me a whole lot.</p><p>1. How can i update my linux-mainline kernel to the latest version without breaking the patches or the custom settings?<br />2. Is there nay way to passthrough a PCI or USB device (not GPU, i&#039;m thinking soundcard this time), loading the windows drivers for it and then emulating it back to the host (Rather than the usual of emulating hardware to guest)</p><p>Update: </p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>warning: cannot resolve &quot;libcacard-git&quot;, a dependency of &quot;qemu-git&quot;<br />:: The following package cannot be upgraded due to unresolvable dependencies:<br />&#160; &#160; &#160; qemu-git</p><p>Aur does not provide libcacard-git</p></div></blockquote></div><p>The qemu-git PKGBUILD builds 2 packages, qemu-git and libcacard-git, it should be built on the same folder as qemu-git, so you should install it first then qemu</p></div></blockquote></div><p>However, when i try to build qemu git i get</p><div class="codebox"><pre><code>cp: cannot stat ‘/home/xandis/Downloads/qemu-git/src/qemu-git-2.0.r30392.g1cf892c/.libs/libcacard.so*’: No such file or directory ==&gt; ERROR: A failure occurred in package_libcacard-git(). Aborting...</code></pre></div><p>What do i do? If i uninstall libcacard i need to uninstall spice too, and qemu-git wont compile without spice.</p><p>Update 2:</p><p>I managed to install the AUR version of qemu, but when i run the command to test the VM i get this</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 6,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Update 3:</p><p>And i seem to have messed something up and X doesn&#039;t start anymore on the linux mainline D:</p><p>That&#039;s not fair, i followed the guide to the letter, but i can&#039;t even start X. on my host, and vfio-bind always seems to fail (considering i always get that no iommu_group error) should i just give up?</p> <p class="postedit"><em>Last edited by rabcor (2014-01-18 23:14:56)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372297">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=40">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=39">39</a> <a href="viewtopic.php?id=162768&amp;p=40">40</a> <strong>41</strong> <a href="viewtopic.php?id=162768&amp;p=42">42</a> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=42">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
