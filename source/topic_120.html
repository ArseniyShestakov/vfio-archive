<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 120) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=120" title="Page 120" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=119" title="Page 119" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=121" title="Page 121" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=119">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=118">118</a> <a href="viewtopic.php?id=162768&amp;p=119">119</a> <strong>120</strong> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=121">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1466226" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2976</span> <a href="viewtopic.php?pid=1466226#p1466226">2014-10-15 18:46:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>so no one passing through intel gpu?</p></div></blockquote></div><p>You need KvmGT (which isn&#039;t released for wide public yet) or XenGT.</p></div></blockquote></div><p>So they intentionally excluded igpus for passthrough...</p><p>Now it is clear...</p><p>I think will rely on another pci-ex gpu...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466226">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466228" class="blockpost roweven"> <h2><span><span class="conr">#2977</span> <a href="viewtopic.php?pid=1466228#p1466228">2014-10-15 18:53:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>so no one passing through intel gpu?</p></div></blockquote></div><p>You need KvmGT (which isn&#039;t released for wide public yet) or XenGT.</p></div></blockquote></div><p><a href="http://sched.co/1B1c3ia" rel="nofollow">http://sched.co/1B1c3ia</a></p><p>Heh. Heh-heh. Cutting-edge technology.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466228">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466247" class="blockpost rowodd"> <h2><span><span class="conr">#2978</span> <a href="viewtopic.php?pid=1466247#p1466247">2014-10-15 20:20:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>That&#039;s what the acs override patch is for</p></div></blockquote></div><p>Yes that is what I understand as well... I have installed your version of the kernel (3.17 + acs override patch + i915 vga arbiter fixes), but it still gives me the same error.</p></div></blockquote></div><p>Don&#039;t know if anybody else can help me...</p><p>When running the test, I get the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>In the same iommu_group are the following:</p><div class="codebox"><pre><code>00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:01.1 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller [8086:0c05] (rev 06) 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:13c0] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation Device [10de:0fbb] (rev a1)</code></pre></div><p>Of course I can&#039;t just bind my main card that is running on the host (the GTX 770) to vfio: it just crashes my system and I have to force restart by pressing the power button.</p><p>As I said, i&#039;m running the kernel provided in the first post, so the acs patch is enabled.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466247">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466256" class="blockpost roweven"> <h2><span><span class="conr">#2979</span> <a href="viewtopic.php?pid=1466256#p1466256">2014-10-15 20:54:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>That&#039;s what the acs override patch is for</p></div></blockquote></div><p>Yes that is what I understand as well... I have installed your version of the kernel (3.17 + acs override patch + i915 vga arbiter fixes), but it still gives me the same error.</p></div></blockquote></div><p>Don&#039;t know if anybody else can help me...</p><p>When running the test, I get the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>In the same iommu_group are the following:</p><div class="codebox"><pre><code>00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:01.1 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller [8086:0c05] (rev 06) 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation Device [10de:13c0] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation Device [10de:0fbb] (rev a1)</code></pre></div><p>Of course I can&#039;t just bind my main card that is running on the host (the GTX 770) to vfio: it just crashes my system and I have to force restart by pressing the power button.</p><p>As I said, i&#039;m running the kernel provided in the first post, so the acs patch is enabled.</p></div></blockquote></div><p>You need to enable it with a kernel parameter, you can see it mentioned on almost every page on this thread</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466256">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466268" class="blockpost rowodd"> <h2><span><span class="conr">#2980</span> <a href="viewtopic.php?pid=1466268#p1466268">2014-10-15 21:25:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m sorry I am a newb and I feel like a newb...</p><p>Searching for a few pages the only thing I could find was <a href="http://vfio.blogspot.nl/2014/08/iommu-groups-inside-and-out.html" rel="nofollow">this</a> article explaining iommu groups, and the kernel parameter &quot;acs_override=downstream&quot;, which did nothing.<br />I&#039;m sorry if I am irritating you with these dumb questions, but I really want to fix this.</p><p>Could you give me the right parameter I have to use?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466268">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466283" class="blockpost roweven"> <h2><span><span class="conr">#2981</span> <a href="viewtopic.php?pid=1466283#p1466283">2014-10-15 22:14:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>I&#039;m sorry I am a newb and I feel like a newb...</p><p>Searching for a few pages the only thing I could find was <a href="http://vfio.blogspot.nl/2014/08/iommu-groups-inside-and-out.html" rel="nofollow">this</a> article explaining iommu groups, and the kernel parameter &quot;acs_override=downstream&quot;, which did nothing.<br />I&#039;m sorry if I am irritating you with these dumb questions, but I really want to fix this.</p><p>Could you give me the right parameter I have to use?</p></div></blockquote></div><p>i believe the correct parameter is &quot;pcie_acs_override=downstream&quot;</p><div class="codebox"><pre><code> pcie_acs_override = [PCIE] Override missing PCIe ACS support for: downstream All downstream ports - full ACS capabilties multifunction All multifunction devices - multifunction ACS subset id:nnnn:nnnn Specfic device - full ACS capabilities Specified as vid:did (vendor/device ID) in hex</code></pre></div> <p class="postedit"><em>Last edited by nbhs (2014-10-15 22:26:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466283">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466309" class="blockpost rowodd"> <h2><span><span class="conr">#2982</span> <a href="viewtopic.php?pid=1466309#p1466309">2014-10-16 00:34:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>To everyone who is interested in running OVMF :</p><p>You need a seperate OVMF.bin file for each VM you are running .</p><p>Took me 2 hours to realize that every VM modifies the &quot;/usr/share/ovmf/x64/ovmf_x64.bin&quot; in a way that makes it incompatible with other VMs .</p><p>So I took 3 copies of ovmf_x64.bin file and named it after each VM I had :</p><p>ovmf_main.bin<br />ovmf_gaming.bin<br />ovmf_winsrv.bin</p><p>and pointed each VM to its corresponding OVMF file . and they all worked .</p><p>If you&#039;re using a split OVMF package , you need a seperate copy of ovmf_vars_x64.bin for each VM , while the ovmf_code_x64.bin can be used for multiple VMs safely .</p><p>If you&#039;re indeed using the split package use :</p><div class="codebox"><pre><code>-drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/A_COPY_OF_ovmf_vars_x64.bin_FOR_THIS_SPECIFIC_VM.bin \</code></pre></div><p>and you should be good to go .</p> <p class="postedit"><em>Last edited by Denso (2014-10-16 01:21:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466309">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466518" class="blockpost roweven"> <h2><span><span class="conr">#2983</span> <a href="viewtopic.php?pid=1466518#p1466518">2014-10-16 15:17:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>i believe the correct parameter is &quot;pcie_acs_override=downstream&quot;</p><div class="codebox"><pre><code> pcie_acs_override = [PCIE] Override missing PCIe ACS support for: downstream All downstream ports - full ACS capabilties multifunction All multifunction devices - multifunction ACS subset id:nnnn:nnnn Specfic device - full ACS capabilities Specified as vid:did (vendor/device ID) in hex</code></pre></div></div></blockquote></div><p>Thanks! That worked perfectly, and I can now succesfully run the test.</p><p>Now up to the next newb question/problem (sorry <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" />):<br />At this moment I have a dualboot configuration:</p><div class="codebox"><pre><code>lsblk -f NAME FSTYPE LABEL UUID MOUNTPOINT sda ├─sda1 ext4 a0e2f143-41fc-4a4f-905d-6a12ac5b0237 / ├─sda2 ntfs System Reserved 8E4242894242764D │ └─md0 │ ├─md0p1 ntfs System Reserved 8E4242894242764D │ └─md0p2 ntfs 7AC4495FC4491EAF └─sda3 ntfs 7AC4495FC4491EAF └─md0 ├─md0p1 ntfs System Reserved 8E4242894242764D └─md0p2 ntfs 7AC4495FC4491EAF sdb ├─sdb1 ext4 Home 34e2c056-db9e-45a1-879d-90bd5840929f /home ├─sdb2 ext4 ExtraLinux 5b069a30-2bf2-4bc5-991b-1f3a54c03a69 /games2 └─sdb3 swap Swap 137477b2-bc03-4029-b579-a9120ed058ee [SWAP] sdc ├─sdc1 ntfs Games Windows 4DAA5B4E7792ADD1 └─sdc3 ntfs Data Windows 472386C540D36DE7 loop0 └─md0 ├─md0p1 ntfs System Reserved 8E4242894242764D └─md0p2 ntfs 7AC4495FC4491EAF</code></pre></div><p>sda1 is my Linux root, sda2 is the Windows Recovery and sda3 is the Windows partition.<br />I would like to virtualize the physical installation, so I benefit of the SSD read and write speeds.</p><p>As you can see I succesfully setup NRAID, which I can mount and browse files on.<br />Now I want to add this RAID and the whole sdc disk to the VM but i&#039;m having some problems.</p><p>I use the following command:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 \ -cdrom &quot;/home/bart/Documents/ISO&#039;s/32 &amp; 64-bit Windows 7 Ultimate - Service Packet 1 - Multilanguage.iso&quot; -boot order=d \ -drive file=/dev/md0,id=diskboot,format=raw -device ide-hd,bus=ahci.0,drive=diskboot \ -drive file=/dev/sdc,id=diskdata,format=raw -device ide-hd,bus=ahci.1,drive=diskdata</code></pre></div><p>Now I guess I just don&#039;t understand really well what &quot;bus&quot; and &quot;ahci&quot; means, but it&#039;s giving me the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device ide-hd,bus=ahci.0,drive=diskboot: Bus &#039;ahci.0&#039; not found</code></pre></div><p>If I try to run without &quot;bus=ahci.0&quot; (and only 1 disk otherwise it says bus supports only 1 unit), it just gives me the qemu command line in which I have no clue what to do.</p><p>I&#039;m really sorry for bothering you with all these newbie (and probably simple) questions, but i&#039;m almost there and it would be a shame if I drop it now.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466518">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466520" class="blockpost rowodd"> <h2><span><span class="conr">#2984</span> <a href="viewtopic.php?pid=1466520#p1466520">2014-10-16 15:24:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>i believe the correct parameter is &quot;pcie_acs_override=downstream&quot;</p><div class="codebox"><pre><code> pcie_acs_override = [PCIE] Override missing PCIe ACS support for: downstream All downstream ports - full ACS capabilties multifunction All multifunction devices - multifunction ACS subset id:nnnn:nnnn Specfic device - full ACS capabilities Specified as vid:did (vendor/device ID) in hex</code></pre></div></div></blockquote></div><p>Thanks! That worked perfectly, and I can now succesfully run the test.</p><p>Now up to the next newb question/problem (sorry <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" />):<br />At this moment I have a dualboot configuration:</p><div class="codebox"><pre><code>lsblk -f NAME FSTYPE LABEL UUID MOUNTPOINT sda ├─sda1 ext4 a0e2f143-41fc-4a4f-905d-6a12ac5b0237 / ├─sda2 ntfs System Reserved 8E4242894242764D │ └─md0 │ ├─md0p1 ntfs System Reserved 8E4242894242764D │ └─md0p2 ntfs 7AC4495FC4491EAF └─sda3 ntfs 7AC4495FC4491EAF └─md0 ├─md0p1 ntfs System Reserved 8E4242894242764D └─md0p2 ntfs 7AC4495FC4491EAF sdb ├─sdb1 ext4 Home 34e2c056-db9e-45a1-879d-90bd5840929f /home ├─sdb2 ext4 ExtraLinux 5b069a30-2bf2-4bc5-991b-1f3a54c03a69 /games2 └─sdb3 swap Swap 137477b2-bc03-4029-b579-a9120ed058ee [SWAP] sdc ├─sdc1 ntfs Games Windows 4DAA5B4E7792ADD1 └─sdc3 ntfs Data Windows 472386C540D36DE7 loop0 └─md0 ├─md0p1 ntfs System Reserved 8E4242894242764D └─md0p2 ntfs 7AC4495FC4491EAF</code></pre></div><p>sda1 is my Linux root, sda2 is the Windows Recovery and sda3 is the Windows partition.<br />I would like to virtualize the physical installation, so I benefit of the SSD read and write speeds.</p><p>As you can see I succesfully setup NRAID, which I can mount and browse files on.<br />Now I want to add this RAID and the whole sdc disk to the VM but i&#039;m having some problems.</p><p>I use the following command:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 \ -cdrom &quot;/home/bart/Documents/ISO&#039;s/32 &amp; 64-bit Windows 7 Ultimate - Service Packet 1 - Multilanguage.iso&quot; -boot order=d \ -drive file=/dev/md0,id=diskboot,format=raw -device ide-hd,bus=ahci.0,drive=diskboot \ -drive file=/dev/sdc,id=diskdata,format=raw -device ide-hd,bus=ahci.1,drive=diskdata</code></pre></div><p>Now I guess I just don&#039;t understand really well what &quot;bus&quot; and &quot;ahci&quot; means, but it&#039;s giving me the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device ide-hd,bus=ahci.0,drive=diskboot: Bus &#039;ahci.0&#039; not found</code></pre></div><p>If I try to run without &quot;bus=ahci.0&quot; (and only 1 disk otherwise it says bus supports only 1 unit), it just gives me the qemu command line in which I have no clue what to do.</p><p>I&#039;m really sorry for bothering you with all these newbie (and probably simple) questions, but i&#039;m almost there and it would be a shame if I drop it now.</p></div></blockquote></div><p>I dont know where you got ahci.0 from, the correct bus using the default q35 ahci controller is ide.*</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466520">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466525" class="blockpost roweven"> <h2><span><span class="conr">#2985</span> <a href="viewtopic.php?pid=1466525#p1466525">2014-10-16 15:56:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76566">cryptonymous</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-05</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>cryptonymous wrote:</cite><blockquote><div><p>Can anyone who have tried using OVMF confirm that initial OVMF bootup messages and EFI shell are shown on a monitor connected to a passed-through video card? I can seem to get even this basic thing to work with OVMF.</p><p>Command line I&#039;ve tried:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -machine pc-i440fx-2.1,accel=kvm,usb=off -device vfio-pci,host=01:00.0,bus=pci.0,addr=7,multifunction=on,romfile=/home/user/NV280MS1-EFI.rom -device vfio-pci,host=01:00.1,bus=pci.0,addr=7.1 -drive if=pflash,format=raw,readonly,file=/tmp/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd -vga none -nographic</code></pre></div><p>All messages, including EFI shell, are shown on QEMU&#039;s curses console. Nothing is shown on a passed-though video card. Does it mean EFI ROM that performs video card initialization doesn&#039;t run properly? If I type `pci&#039; command in EFI shell, I see that correct VID/PID pair is listed for the video card, thus it is clearly detected.</p></div></blockquote></div><p>To answer my own question since no one bothered: yes, OVMF messages are shown both on QEMU&#039;s curses console and a physical monitor once the video card is correctly initialized. Also `drivers&#039; EFI shell command should list proper driver being loaded, e.g.:</p><div class="codebox"><pre><code> T D Y C I P F A DRV VERSION E G G #D #C DRIVER NAME IMAGE PATH === ======== = = = === === =================================== ========== 89 0001000B B N N 2 5 NVIDIA GPU UEFI Driver (80.07.35.00 PciRoot(0x0)/Pci(0x3,0x0)/Offset(0xFC00,0x1F9FF)</code></pre></div><p>Will try to install EFI-compatible OS next.</p><div class="quotebox"><cite>cryptonymous wrote:</cite><blockquote><div><p>The ROM file I use (NV280MS1-EFI.rom) does have a EFI part:</p><div class="codebox"><pre><code>Valid ROM signature found @400h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 0, vendor revision: 1 Valid ROM signature found @10000h, PCIR offset 1ch PCIR: type 3, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 3, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div><p>Video card in question is a NVidia GTX 650 (MSI N650 PE 1GD5/OC). Initially it came with hybrid (EFI/Legacy) BIOS flashed, later update was just Legacy. I&#039;m trying to use original ROM I&#039;ve fortunately backed up before reflashing.</p></div></blockquote></div><p>It took me a while to discover that video BIOS images read and written by nvflash.exe tool can&#039;t be directly passed to QEMU&#039;s vfio-pci device `romfile=&#039; option. The part starting with `NVGI&#039; signature up to the first `0x55 0xaa&#039; signature has to be skipped (that was 0x400 bytes in my case). Strange that QEMU didn&#039;t complain about invalid ROM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466525">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466528" class="blockpost rowodd"> <h2><span><span class="conr">#2986</span> <a href="viewtopic.php?pid=1466528#p1466528">2014-10-16 16:07:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I dont know where you got ahci.0 from, the correct bus using the default q35 ahci controller is ide.*</p></div></blockquote></div><p>Ooh well I got it from your post in the &quot;Using a physical disk or partition&quot; section <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Well it seems to work? Gives no errors but only shows me a console.</p><p>I&#039;ve tried &quot;boot order=d&quot; (got it from the Arch Wiki) and &quot;boot menu=on&quot;, none made any difference.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466528">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466794" class="blockpost roweven"> <h2><span><span class="conr">#2987</span> <a href="viewtopic.php?pid=1466794#p1466794">2014-10-17 09:37:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I dont know where you got ahci.0 from, the correct bus using the default q35 ahci controller is ide.*</p></div></blockquote></div><p>Ooh well I got it from your post in the &quot;Using a physical disk or partition&quot; section <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Well it seems to work? Gives no errors but only shows me a console.</p><p>I&#039;ve tried &quot;boot order=d&quot; (got it from the Arch Wiki) and &quot;boot menu=on&quot;, none made any difference.</p></div></blockquote></div><p>First: I guess you should have windows&#039; loader(NTLDR before Vista, BCD or what was it after?..) somewhere on disk. Usually it gets into MBR. You could also chainload it via GRUB. There may be major differencies if using GPT.</p><p>Second: I think you could benifit from use of virtio, either blk or scsi. But...</p><p>Third: You&#039;ll need to migrate your windows installation correctly. Windows won&#039;t boot with bsod 7B(if i remember correctly) when you change the disk controller to something else not present @ system installation. If you would like to use qemu&#039;s AHCI - windows should have drivers for it, you&#039;ll just need to activate them. If you wish to use virtio(it does improve my disk performance somewhat, but my image resides in a file on my HDD) - you must pass down virtio cd iso via most compatible interface and install drivers manually.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466794">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466845" class="blockpost rowodd"> <h2><span><span class="conr">#2988</span> <a href="viewtopic.php?pid=1466845#p1466845">2014-10-17 12:24:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, so restart from the base...<br />I&#039;m getting some problems setting up a VM (using OVMF) with Windows 8.1 and a GeForce GTX 650 passed through.</p><p>Software setup:<br />- Debian 7 (headless pc, managed through ssh)<br />- kernel 3.16.6 + ACS patch + i915 arbitrer patch + VGA arbitrer patch<br />- boot parameters &quot;i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:0fc6,10de:0e1b&quot;<br />- qemu 2.1.2<br />- seabios 1.7.5<br />- OVMF latest-git</p><p>Hardware setup:<br />- MSI ZH77A-G43<br />- Intel i5-3470<br />- IGD as primary VGA (for host)<br />- nVidia GeForce GTX 650 as secondary VGA (for guest)</p><p>Steps I followed:<br />- enabled VT-d in motherboard<br />- installed Windows 8.1 through VNC using &quot;-vga std&quot; (keeping GTX 650 as secondary graphics card in guest)<br />- installed tightVNC inside Windows 8.1<br />- installed nVidia graphics driver (version 340.52)<br />- booted Windows 8.1 with &quot;-vga none&quot;<br />- cannot connect to VNC server inside Windows 8.1 (without any error from qemu)</p><br /><p>Script used to start VM:</p><div class="codebox"><pre><code># Bind VGA DEVICES=&quot;0000:01:00.0 0000:01:00.1&quot; for dev in $DEVICES ; do vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done # Start QEMU with UEFI (OVMF) qemu-system-x86_64 -enable-kvm -m 4096 -cpu host,hv_time,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -vga none -rtc base=localtime \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -drive file=/dev/sdc,id=disk,format=raw,if=none -device ide-hd,bus=ide.0,drive=disk \ -drive file=/root/Windows8.1.iso,id=isocd,format=raw,if=none -device ide-cd,bus=ide.1,drive=isocd \ -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/OVMF.fd \ -drive if=pflash,format=raw,file=/root/OVMF_vars.fd \ -k it -boot order=dc,menu=on \ -netdev tap,ifname=qemu0,id=qemu_tap -device e1000,netdev=qemu_tap,mac=00:16:3E:12:34:56 \ -usb -usbdevice tablet</code></pre></div><br /><p>Output after launching qemu:</p><div class="codebox"><pre><code>vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><br /><p>Some dmesg messages about vga:</p><div class="codebox"><pre><code># dmesg | grep -i vga Command line: BOOT_IMAGE=/boot/vmlinuz-3.16.6 root=UUID=a4837900-ca63-43d4-bc2c-cf3f37cff7c6 ro i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:0fc6,10de:0e1b quiet Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.16.6 root=UUID=a4837900-ca63-43d4-bc2c-cf3f37cff7c6 ro i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:0fc6,10de:0e1b quiet Console: colour VGA+ 80x25 vgaarb: setting as boot device: PCI:0000:00:02.0 vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none vgaarb: loaded vgaarb: bridge control possible 0000:01:00.0 vgaarb: no bridge control possible 0000:00:02.0 [drm] Replacing VGA console driver vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io+mem</code></pre></div><br /><p>Output from <a href="https://github.com/awilliam/rom-parser" rel="nofollow">rom-parser</a>:</p><div class="codebox"><pre><code>$ ./rom-parser gtx650.rom Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 0, vendor revision: 1 Valid ROM signature found @f000h, PCIR offset 1ch PCIR: type 3, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 3, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div><br /><p>I&#039;m quite sure the VM is booting because I can arping its ip, but I can&#039;t connect to its VNC server (as I said above, I installed tightVNC into Windows).<br />I will also try connecting a physical monitor to the GTX 650 ASAP (hoping to see some graphical output).</p><p>Any help/though is appreciated, thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466845">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466907" class="blockpost roweven"> <h2><span><span class="conr">#2989</span> <a href="viewtopic.php?pid=1466907#p1466907">2014-10-17 15:29:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>Ok, so restart from the base...<br />I&#039;m getting some problems setting up a VM (using OVMF) with Windows 8.1 and a GeForce GTX 650 passed through.</p><p>Script used to start VM:</p><div class="codebox"><pre><code># Start QEMU with UEFI (OVMF) qemu-system-x86_64 -enable-kvm -m 4096 -cpu host,hv_time,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -vga none -rtc base=localtime \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -drive file=/dev/sdc,id=disk,format=raw,if=none -device ide-hd,bus=ide.0,drive=disk \ -drive file=/root/Windows8.1.iso,id=isocd,format=raw,if=none -device ide-cd,bus=ide.1,drive=isocd \ -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/OVMF.fd \ -drive if=pflash,format=raw,file=/root/OVMF_vars.fd \ -k it -boot order=dc,menu=on \ -netdev tap,ifname=qemu0,id=qemu_tap -device e1000,netdev=qemu_tap,mac=00:16:3E:12:34:56 \ -usb -usbdevice tablet</code></pre></div></div></blockquote></div><p>Your launching code seems ok , but I don&#039;t think you need &quot;x-vga=on&quot; with OVMF . I&#039;m running this VM without it . I don&#039;t know if it&#039;s related to your issue , but try to remove x-vga=on option and see if it works .</p><p>EDIT :</p><p>Also , try to configure tightVNC to accept connections without passwords , it&#039;s easier .</p> <p class="postedit"><em>Last edited by Denso (2014-10-17 15:33:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466907">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466911" class="blockpost rowodd"> <h2><span><span class="conr">#2990</span> <a href="viewtopic.php?pid=1466911#p1466911">2014-10-17 15:36:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I get this message, when I try to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 3 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I use the standard kernel (3.16.4-1-ARCH) with neither acs override patch nor i915 vga arbiter fixes patch. Can this be the issue? I do not want to compile the kernel myself, unless realy needed.</p><div class="codebox"><pre><code>zgrep CONFIG_VFIO_PCI_VGA /proc/config.gz CONFIG_VFIO_PCI_VGA=y</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466911">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466913" class="blockpost roweven"> <h2><span><span class="conr">#2991</span> <a href="viewtopic.php?pid=1466913#p1466913">2014-10-17 15:40:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>I get this message, when I try to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 3 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I use the standard kernel (3.16.4-1-ARCH) with neither acs override patch nor i915 vga arbiter fixes patch. Can this be the issue? I do not want to compile the kernel myself, unless realy needed.</p><div class="codebox"><pre><code>zgrep CONFIG_VFIO_PCI_VGA /proc/config.gz CONFIG_VFIO_PCI_VGA=y</code></pre></div></div></blockquote></div><p>Check if IOMMU is supported by your CPU/Motherboard , and that it is probably supported/enabled in BIOS . Also make sure you added intel_iommu=on&#160; OR&#160; amd_iommu=on&#160; to your boot parameters .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466913">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466920" class="blockpost rowodd"> <h2><span><span class="conr">#2992</span> <a href="viewtopic.php?pid=1466920#p1466920">2014-10-17 15:46:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>- qemu 2.1.2</p></div></blockquote></div><p>Could you please try out the latest git master instead of 2.1.2 (My qemu gives &quot;2.1.50&quot; on &quot;-version&quot;)? May not help, but I have never tried this method with any of the official releases.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>- OVMF latest-git</p></div></blockquote></div><p>Their git repo is just a mirror of the actual development subversion trunk, so it may lag behind.<br />If the git repo does lack behind, you might want to try the latest svn trunk.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>- kernel 3.16.6 + ACS patch + i915 arbitrer patch + VGA arbitrer patch<br />- boot parameters &quot;i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:0fc6,10de:0e1b&quot;</p></div></blockquote></div><p>This may not be the solution, but it should reduce complexity:<br />First, you should not need these patches when going the UEFI way with OVMF, so please try to use a vanilla 3.16.6 kernel. I&#039;ve used both unpatched 3.16.3 and 3.17.1 with OVMF successfully (unpatched meaning without these three patches, they did have Gentoo-specific patches).</p><p>Second, the boot paramater &quot;i915.enable_hd_vgaarb=1&quot; should also not be necessary when going the UEFI way with OVMF, I only have &quot;intel_iommu=on&quot; and &quot;pci-stub.ids=[GPU and GPU AUDIO]&quot;.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="codebox"><pre><code> -drive file=/dev/sdc,id=disk,format=raw,if=none -device ide-hd,bus=ide.0,drive=disk \ -drive file=/root/Windows8.1.iso,id=isocd,format=raw,if=none -device ide-cd,bus=ide.1,drive=isocd \</code></pre></div></div></blockquote></div><p>Try to use SCSI instead of IDE for these two drives </p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="codebox"><pre><code> -boot order=dc,menu=on \</code></pre></div></div></blockquote></div><p>Try to remove this. OVMF is a UEFI firmware, so IIRC it should store the UEFI boot options in your VM&#039;s individual copy of the OVMF_vars.fd template file.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>Output from <a href="https://github.com/awilliam/rom-parser" rel="nofollow">rom-parser</a>:</p><div class="codebox"><pre><code>$ ./rom-parser gtx650.rom Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 0, vendor revision: 1 Valid ROM signature found @f000h, PCIR offset 1ch PCIR: type 3, vendor: 10de, device: 0fc6, class: 030000 PCIR: revision 3, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div></div></blockquote></div><p>Please forgive the potentially stupid question, but how did you get this rom file? After I flashed my GTX 660 TI with the Asus tool to a hybrid firmware (which worked and I can use the card perfectly fine) the</p><div class="codebox"><pre><code># echo 1 &gt; /sys/bus/pci/devices/0000:01:00.0/rom # cat /sys/bus/pci/devices/0000:01:00.0/rom</code></pre></div><p>just returns the following for me:</p><div class="codebox"><pre><code>cat: rom: Input/output error</code></pre></div><p>So I assumed that this way doesn&#039;t work with slightly older NVIDIA cards. Or does this still work for you?</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>I&#039;m quite sure the VM is booting because I can arping its ip,</p></div></blockquote></div><p>What does the serial console show? Your VM might hang at the EFI shell (with the emulated network card already initialised and connected to th TAP device). To see the serial console open the popup windows that starts when you execute the qemu command, and navigate to the menu item &quot;View -&gt; serial0&quot;. if this shows a bunch of slightly garbled yellow text on black, your VM might hang at the EFI shell.</p><p>Also, if none of the above helps you, I would like to know what the monitor your wrote you intent to connect to the graphics card shows from the moment you boot the machine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466920">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466931" class="blockpost roweven"> <h2><span><span class="conr">#2993</span> <a href="viewtopic.php?pid=1466931#p1466931">2014-10-17 16:01:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Your launching code seems ok , but I don&#039;t think you need &quot;x-vga=on&quot; with OVMF .</p></div></blockquote></div><p>You&#039;re both right and wrong about that if I understand <a href="http://vfio.blogspot.de/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">this</a> correctly (third to last paragraph).</p><p>You need the <em>quirks this option enables</em> if you have an NVIDIA card like him (and me) <strong>regardless of whether you&#039;re using OVMF or not</strong>, <em>but</em> if your QEMU has <a href="https://github.com/awilliam/qemu-vfio/commit/fe08275db9b88ecf3a30c7540b894c25aec150c2" rel="nofollow">this</a> commit, then you don&#039;t need to specify the option explicitly, because the commit ensures that the quirks are automatically enabled for NVIDIA cards. I haven&#039;t checked, but it might be that this commit is not in qemu 2.1.2 (in which case he needs to specify it).</p> <p class="postedit"><em>Last edited by Calrama (2014-10-17 16:02:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466931">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466933" class="blockpost rowodd"> <h2><span><span class="conr">#2994</span> <a href="viewtopic.php?pid=1466933#p1466933">2014-10-17 16:04:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Your launching code seems ok , but I don&#039;t think you need &quot;x-vga=on&quot; with OVMF .</p></div></blockquote></div><p>You&#039;re both right and wrong about that if I understand <a href="http://vfio.blogspot.de/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">this</a> correctly (third to last paragraph).</p><p>You need the <em>quirks this option enables</em> if you have an NVIDIA card like him (and me) <strong>regardless of whether you&#039;re using OVMF or not</strong>, <em>but</em> if your QEMU has <a href="https://github.com/awilliam/qemu-vfio/commit/fe08275db9b88ecf3a30c7540b894c25aec150c2" rel="nofollow">this</a> commit, then you don&#039;t need to specify the option explicitly, because the commit ensures that the quirks are automatically enabled for NVIDIA cards. I haven&#039;t checked, but it might be that this commit is not in qemu 2.1.2 (in which case he needs to specify it).</p></div></blockquote></div><p>That&#039;s right, this is why anyone trying to do nvidia+ovmf should be using qemu.git until QEMU 2.2.&#160; I haven&#039;t used, and don&#039;t plan to try, x-vga=on with ovmf.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466933">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466939" class="blockpost roweven"> <h2><span><span class="conr">#2995</span> <a href="viewtopic.php?pid=1466939#p1466939">2014-10-17 16:22:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>According to that commit , those quirks needed are activated regardless of x-vga=on , so anyone using a recent compiled qemu-git should be fine without it when using OVMF .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466939">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466940" class="blockpost rowodd"> <h2><span><span class="conr">#2996</span> <a href="viewtopic.php?pid=1466940#p1466940">2014-10-17 16:23:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>According to that commit , those quirks needed are activated regardless of x-vga=on , so anyone using a recent compiled qemu-git should be fine without it when using OVMF .</p></div></blockquote></div><p>Yes, but he&#039;s using qemu 2.1.2, not qemu-git, which is why I wrote</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>I haven&#039;t checked, but it might be that this commit is not in qemu 2.1.2 (in which case he needs to specify it).</p></div></blockquote></div><p> at the end (and also one of the reasons I wrote in my reply to him, that he should try qemu-git instead).</p> <p class="postedit"><em>Last edited by Calrama (2014-10-17 16:27:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466940">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466949" class="blockpost roweven"> <h2><span><span class="conr">#2997</span> <a href="viewtopic.php?pid=1466949#p1466949">2014-10-17 16:40:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Check if IOMMU is supported by your CPU/Motherboard , and that it is probably supported/enabled in BIOS . Also make sure you added intel_iommu=on&#160; OR&#160; amd_iommu=on&#160; to your boot parameters .</p></div></blockquote></div><p>Thank you for your quick reply.<br />I have a Phenom2 x4 and a ASUS M4A89GTD PRO.<br />This mainboard has a AMD 890GX chipset.</p><p>If I believe this list: <a href="https://en.wikipedia.org/wiki/AMD_800_chipset_series#890GX" rel="nofollow">https://en.wikipedia.org/wiki/AMD_800_c … ries#890GX</a><br />My Chipset does not support IOMMU</p><p>Sad. Thanks for your help <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><br /><p>Edit: Is there no other way expect buying a new mainboard?</p> <p class="postedit"><em>Last edited by Rommy (2014-10-17 16:55:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466949">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466952" class="blockpost rowodd"> <h2><span><span class="conr">#2998</span> <a href="viewtopic.php?pid=1466952#p1466952">2014-10-17 16:48:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Your launching code seems ok , but I don&#039;t think you need &quot;x-vga=on&quot; with OVMF . I&#039;m running this VM without it . I don&#039;t know if it&#039;s related to your issue , but try to remove x-vga=on option and see if it works .</p><p>EDIT :</p><p>Also , try to configure tightVNC to accept connections without passwords , it&#039;s easier .</p></div></blockquote></div><p>Tried both, but nothing changed.</p><br /><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Could you please try out the latest git master instead of 2.1.2 (My qemu gives &quot;2.1.50&quot; on &quot;-version&quot;)?</p></div></blockquote></div><p>I would like to stay on &quot;-stable&quot;, so next test will be with 2.1.3 or 2.2.0.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Their git repo is just a mirror of the actual development subversion trunk, so it may lag behind.<br />If the git repo does lack behind, you might want to try the latest svn trunk.</p></div></blockquote></div><p>I think it&#039;s not a real problem to be a couple of commit behind head.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>This may not be the solution, but it should reduce complexity:<br />First, you should not need these patches when going the UEFI way with OVMF, so please try to use a vanilla 3.16.6 kernel. I&#039;ve used both unpatched 3.16.3 and 3.17.1 with OVMF successfully (unpatched meaning without these three patches, they did have Gentoo-specific patches).</p><p>Second, the boot paramater &quot;i915.enable_hd_vgaarb=1&quot; should also not be necessary when going the UEFI way with OVMF</p></div></blockquote></div><p>If you say it&#039;s not a problem to have them enabled, I will leave them untouched (just in case I need to switch back to Windows 7).<br />Maybe I will try to remove &quot;i915.enable_hd_vgaarb=1&quot; option.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Try to use SCSI instead of IDE</p></div></blockquote></div><p>I tried installing with SCSI, but can&#039;t get drives recognized, so switched back to IDE.<br />Is it a big problem, or simply performance related?</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>how did you get this rom file?</p></div></blockquote></div><p>I got the file with the method you described:</p><div class="codebox"><pre><code># echo 1 &gt; /sys/bus/pci/devices/0000:01:00.0/rom # cat /sys/bus/pci/devices/0000:01:00.0/rom &gt; /tmp/file.rom # echo 0 &gt; /sys/bus/pci/devices/0000:01:00.0/rom</code></pre></div><p>Important thing is to NOT set the card as primary graphic output.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>What does the serial console show?</p></div></blockquote></div><p>It prompts a &quot;(qemu)&quot; terminal.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Also, if none of the above helps you, I would like to know what the monitor your wrote you intent to connect to the graphics card shows from the moment you boot the machine.</p></div></blockquote></div><p>I&#039;ll keep you informed.</p><br /><p>Thanks for all the help.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466952">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1466979" class="blockpost roweven"> <h2><span><span class="conr">#2999</span> <a href="viewtopic.php?pid=1466979#p1466979">2014-10-17 18:05:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Could you please try out the latest git master instead of 2.1.2 (My qemu gives &quot;2.1.50&quot; on &quot;-version&quot;)?</p></div></blockquote></div><p>I would like to stay on &quot;-stable&quot;, so next test will be with 2.1.3 or 2.2.0.</p></div></blockquote></div><p>Please try out qemu-git. The only people I know of who got OVMF to work used qemu-git. There should be no need to leave your debian stable, simply do the following as your normal user:</p><div class="codebox"><pre><code>mkdir -p ~/qemu-git/root cd ~/qemu-git/ git clone git://git.qemu-project.org/qemu.git src cd src ./configure --prefix=~/qemu-git/root --enable-gtk --enable-sdl --enable-kvm --audio-drv-list=alsa,pa make make install</code></pre></div><p>Now <em>~/qemu-git/root/bin/qemu-system-x86_64 -version</em> should return &quot;2.1.50&quot; and you can simply use ~/qemu-git/root/bin/qemu-system-x86_64 instead of qemu-system-x86_64 for starting your VM.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Their git repo is just a mirror of the actual development subversion trunk, so it may lag behind.<br />If the git repo does lack behind, you might want to try the latest svn trunk.</p></div></blockquote></div><p>I think it&#039;s not a real problem to be a couple of commit behind head.</p></div></blockquote></div><p>If it&#039;s only a few commits over the last few days, sure. If it lags behind enough, that the latest git commit is older than last saturday, I cannot make any guess about it, because that&#039;s the earliest svn trunk I tried. You might want to check.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>This may not be the solution, but it should reduce complexity:<br />First, you should not need these patches when going the UEFI way with OVMF, so please try to use a vanilla 3.16.6 kernel. I&#039;ve used both unpatched 3.16.3 and 3.17.1 with OVMF successfully (unpatched meaning without these three patches, they did have Gentoo-specific patches).</p><p>Second, the boot paramater &quot;i915.enable_hd_vgaarb=1&quot; should also not be necessary when going the UEFI way with OVMF</p></div></blockquote></div><p>If you say it&#039;s not a problem to have them enabled, I will leave them untouched (just in case I need to switch back to Windows 7).</p></div></blockquote></div><p>You could always have two kernels, one patched, one unpatched. And just because it didn&#039;t change anything for <em>me</em> doesn&#039;t necessarily mean the same for you. There are enough differences in our setups that it might be worth a try.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Try to use SCSI instead of IDE</p></div></blockquote></div><p>I tried installing with SCSI, but can&#039;t get drives recognized, so switched back to IDE.<br />Is it a big problem, or simply performance related?</p></div></blockquote></div><p>Mostly perfomance, but I had some trouble with OVMF not recognising non-scsi devices, so I have everything on scsi now.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>how did you get this rom file?</p></div></blockquote></div><p>I got the file with the method you described:</p><div class="codebox"><pre><code># echo 1 &gt; /sys/bus/pci/devices/0000:01:00.0/rom # cat /sys/bus/pci/devices/0000:01:00.0/rom &gt; /tmp/file.rom # echo 0 &gt; /sys/bus/pci/devices/0000:01:00.0/rom</code></pre></div><p>Important thing is to NOT set the card as primary graphic output.</p></div></blockquote></div><p>Okay, thanks.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>What does the serial console show?</p></div></blockquote></div><p>It prompts a &quot;(qemu)&quot; terminal.</p></div></blockquote></div><p>Sorry if this sound condescending, but are you sure you&#039;re on the serial console and not the compat monitor? That&#039;s what the compat monitor should be showing, not the serial console.<br />You should have three views to choose from (if your qemu is compiled with GTK and SDL at least):<br />View -&gt; compatmonitor0<br />View -&gt; serial0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;---- This is the one<br />View -&gt; parallel0</p> <p class="postedit"><em>Last edited by Calrama (2014-10-17 18:09:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1466979">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467210" class="blockpost rowodd"> <h2><span><span class="conr">#3000</span> <a href="viewtopic.php?pid=1467210#p1467210">2014-10-18 11:27:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Please try out qemu-git. The only people I know of who got OVMF to work used qemu-git. There should be no need to leave your debian stable, simply do the following as your normal user:</p><div class="codebox"><pre><code>mkdir -p ~/qemu-git/root cd ~/qemu-git/ git clone git://git.qemu-project.org/qemu.git src cd src ./configure --prefix=~/qemu-git/root --enable-gtk --enable-sdl --enable-kvm --audio-drv-list=alsa,pa make make install</code></pre></div><p>Now <em>~/qemu-git/root/bin/qemu-system-x86_64 -version</em> should return &quot;2.1.50&quot; and you can simply use ~/qemu-git/root/bin/qemu-system-x86_64 instead of qemu-system-x86_64 for starting your VM.</p></div></blockquote></div><p>Ok, I will give it a try.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>If it&#039;s only a few commits over the last few days, sure. If it lags behind enough, that the latest git commit is older than last saturday, I cannot make any guess about it, because that&#039;s the earliest svn trunk I tried. You might want to check.</p></div></blockquote></div><p>Checked and git seems not too behind svn (latest commit is &quot;<a href="https://github.com/tianocore/edk2/commit/edb5073413d7b5e60cb69ffd3cb1ccb99decbf6a" rel="nofollow">ArmVirtualizationPkg: FdtPL011SerialPortLib: support UEFI_APPLICATION</a>&quot; which should be even with svn-r16219).</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>You could always have two kernels, one patched, one unpatched. And just because it didn&#039;t change anything for <em>me</em> doesn&#039;t necessarily mean the same for you. There are enough differences in our setups that it might be worth a try.</p></div></blockquote></div><p>Ok.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Mostly perfomance, but I had some trouble with OVMF not recognising non-scsi devices, so I have everything on scsi now.</p></div></blockquote></div><p>That&#039;s strange: I had the opposite problem.<br />If I want to use SCSI, will I also need &quot;-device virtio-scsi-pci,id=scsi&quot; option?</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Sorry if this sound condescending, but are you sure you&#039;re on the serial console and not the compat monitor? That&#039;s what the compat monitor should be showing, not the serial console.<br />You should have three views to choose from (if your qemu is compiled with GTK and SDL at least):<br />View -&gt; compatmonitor0<br />View -&gt; serial0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;---- This is the one<br />View -&gt; parallel0</p></div></blockquote></div><p>My qemu is compiled without SDL nor GTK.<br />The explanation of this is that qemu reside on a headless pc (Xorg not installed at all) and all the work is done through ssh.</p><p>EDIT: just found <a href="http://en.wikibooks.org/wiki/QEMU/Monitor" rel="nofollow">this</a>, so I can say I&#039;m accessing the qemu monitor console (hope it can be useful).</p><br /><p>Again thanks for all these info.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467210">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=119">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=118">118</a> <a href="viewtopic.php?id=162768&amp;p=119">119</a> <strong>120</strong> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=121">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
