<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 87) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=87" title="Page 87" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=86" title="Page 86" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=88" title="Page 88" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=86">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <a href="viewtopic.php?id=162768&amp;p=86">86</a> <strong>87</strong> <a href="viewtopic.php?id=162768&amp;p=88">88</a> <a href="viewtopic.php?id=162768&amp;p=89">89</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=88">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1427505" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2151</span> <a href="viewtopic.php?pid=1427505#p1427505">2014-06-18 23:03:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jajacomp wrote:</cite><blockquote><div><p>I have problem with screen size on monitor. If i set resolution 1080 - then image don&#039;t fill all screen, just 80%. How fix if? Thank!</p></div></blockquote></div><p>This isn&#039;t really specific to this thread, but anyways… It&#039;s called overscan and there is an option in the AMD Catalyst Control Center to disable it.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427505">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427527" class="blockpost roweven"> <h2><span><span class="conr">#2152</span> <a href="viewtopic.php?pid=1427527#p1427527">2014-06-18 23:47:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jajacomp wrote:</cite><blockquote><div><p>I have problem with screen size on monitor. If i set resolution 1080 - then image don&#039;t fill all screen, just 80%. How fix if? Thank!</p></div></blockquote></div><p>The answer is less than a page away...</p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1426184#p1426184" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 4#p1426184</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427527">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427719" class="blockpost rowodd"> <h2><span><span class="conr">#2153</span> <a href="viewtopic.php?pid=1427719#p1427719">2014-06-19 14:42:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey I ran into some problems with my ACS Override patch (on the official gentoo/arch kernels) turns out the patch <a href="https://bbs.archlinux.org/viewtopic.php?id=182976" rel="nofollow">breaks vdpau</a> (hardware decoding) for me and all applications that use or rely on it.</p><p>I tried to install the linux-mainline kernel from the OP, but now I cannot start X, here is my <a href="http://pastebin.com/bj96FGUP" rel="nofollow">xorg.log</a>. What did I do wrong?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427719">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427729" class="blockpost roweven"> <h2><span><span class="conr">#2154</span> <a href="viewtopic.php?pid=1427729#p1427729">2014-06-19 15:01:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Hey I ran into some problems with my ACS Override patch (on the official gentoo/arch kernels) turns out the patch <a href="https://bbs.archlinux.org/viewtopic.php?id=182976" rel="nofollow">breaks vdpau</a> (hardware decoding) for me and all applications that use or rely on it.</p></div></blockquote></div><p>This seems very unlikely to me, but if it were to break something it would probably be an indicator that the hardware in fact does not have isolation between downstream ports and the kernel is correct in grouping them together.&#160; Is the issue with a VM running?&#160; vdpau in the VM?</p><div class="quotebox"><blockquote><div><p>I tried to install the linux-mainline kernel from the OP, but now I cannot start X, here is my <a href="http://pastebin.com/bj96FGUP" rel="nofollow">xorg.log</a>. What did I do wrong?</p></div></blockquote></div><p>It just seems to be telling us to go look at dmesg</p><div class="codebox"><pre><code>[ 114.334] (EE) NVIDIA: Failed to initialize the NVIDIA kernel module. Please see the [ 114.334] (EE) NVIDIA: system&#039;s kernel log for additional error messages and [ 114.334] (EE) NVIDIA: consult the NVIDIA README for details.</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427729">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427730" class="blockpost rowodd"> <h2><span><span class="conr">#2155</span> <a href="viewtopic.php?pid=1427730#p1427730">2014-06-19 15:03:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah I just found out through a bit of coincidence it was not the ACS Override patch that broke my hwdec (I updated the post)</p><p>It is the intel_iommu=on(CONFIG_INTEL_IOMMU_DEFAULT_ON=y) setting that causes my issue.</p><p>The problem is with VDPAU on the host, not the VM (vm not even running) it also doesn&#039;t matter if devices are bound to vfio-pci.</p><p>And the following commands find nothing. (They do on the official kernel though)</p><div class="codebox"><pre><code>$dmesg | grep nvidia $dmesg | grep NVIDIA</code></pre></div><p>The only thing I&#039;ve tried to solve the problem with the linux-mainline kernel is to re-compile the nvidia drivers.It had no effect.As for the issue with Intel DMA Remapping by default, maybe that should be reported to somewhere?</p> <p class="postedit"><em>Last edited by rabcor (2014-06-19 15:38:43)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427730">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427737" class="blockpost roweven"> <h2><span><span class="conr">#2156</span> <a href="viewtopic.php?pid=1427737#p1427737">2014-06-19 15:22:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Aight my mainboard died today &lt;3<br />I won&#039;t ever buy MSI products again.. tzz..</p><p>But I came up with another question, has anyone got crossfire working with passthrough?<br />Thinking about buying another HD 6950 and run both with crossfire, would this be possible?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427737">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427791" class="blockpost rowodd"> <h2><span><span class="conr">#2157</span> <a href="viewtopic.php?pid=1427791#p1427791">2014-06-19 18:27:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=55043">Kaurin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/55043.jpg?m=1327103448" width="80" height="80" alt="" /></dd> <dd><span>From: Ireland</span></dd> <dd><span>Registered: 2011-12-11</span></dd> <dd><span>Posts: 66</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=55043">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I&#039;ve come on board with this and really want to make it work.</p><p>I was hitting <a href="https://bugzilla.kernel.org/show_bug.cgi?id=44881" rel="nofollow">This bug</a>, and with help of aw, was able to fix it (Still waiting confirmation from aw).</p><p>Here is my setup:</p><p>Mobo: Gigabyte Q87M-D2H, BIOS F7 01/17/2014 (latest bios)<br />CPU: Intel Core i7 4770<br />Ram: 32GB @ 1600Mhz<br />GPU: <a href="http://www.techpowerup.com/vgabios/148828/gigabyte-gtx770-4096-130729.html" rel="nofollow">Gigabyte Nvidia GTX 770, 4GB slightly overclocked by Gigabyte</a><br />OS: Arch</p><p>My primary display is set to the Intel integrated graphics, and I&#039;m running a bare Arch + qemu, so no graphical environment.</p><p>If I run Linux with a graphical environment, It&#039;s going to be a virt, with spice probably, and then use that via Windows, which is also a virt :&gt;</p><p>Edit:<br />Grub:</p><div class="codebox"><pre><code>linux /vmlinuz-3.15.0-rc6-ARCH-dirty root=/dev/mapper/sys-root ro intel_iommu=on vfio_iommu_type1</code></pre></div><br /><p>Before even trying GPU passthrough, this was the command line I used to install/test Windows7:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on</code></pre></div><p>Win7 works like this, using spice (via ssh tunnel), and everything is dandy.</p><p>I&#039;ve tried testing the GPU passtrhough (as per OP), like so:</p><p>Bind the GPU to vfio-pci:</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><p>This is from journalctl -b0 -ocat</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1 VFIO - User Level meta-driver version: 0.3 vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900</code></pre></div><p>Try to boot:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Running this yields no errors, and I could hear the GPU fans spin down, and back up. However, the display does not turn on (no-signal state).</p><p>Then, I tried this:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 </code></pre></div><p>Basically the same command for win7 + GPU test. I logged in via spice, and noticed that I have a &quot;Standard VGA Graphics Adapter&quot; in Device Manager, but the device cannot start (Code 10). Hardware IDs look good: 10DE-1184</p><p>The &quot;High Definition Audio Device&quot; with the nvidia HWID seems to work (Can&#039;t really test it because I don&#039;t have HDMI cables / devices)</p><p>Can anyone suggest what to try next in order to get GPU-passtrhough to work?</p><p>Before anyone asks, the monitor is connected to the DVI port of the nvidia card since before I began testing GPU passthrough <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Update: After a Windows Update/Reboot, the Nvidia GPU is shown as &quot;NVIDIA GeForce GTX 770&quot;, and is now code 12 and still not working. (Cannot start b/c resources).</p><p>I have not mentioned this before, but I&#039;ve tried doing the GPU passthrough on XEN last week, and hit the same thing there (device name OK + code 12). After seeing that gpu passthrough with nvidia is something I might not be able to do, i turned to KVM where I see people running virts + nvidia successfully.</p> <p class="postedit"><em>Last edited by Kaurin (2014-06-19 19:44:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427791">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427834" class="blockpost roweven"> <h2><span><span class="conr">#2158</span> <a href="viewtopic.php?pid=1427834#p1427834">2014-06-19 19:43:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all.</p><p>I&#039;m new here, but I&#039;ve been reading the thread for a couple of months since I got the urge to build a server for streaming Steam from a workstation that recently came into my possession. Finally got all the parts together, and didn&#039;t have much luck with Arch since I&#039;m not really familiar with it, so I&#039;m now running Ubuntu Server 14.04.</p><p>Here&#039;s my config:<br />CPUs: 2x Xeon E5-2680<br />Memory: 64 GB ECC RAM @ 1600MHz<br />Mobo: Asus Z9PA-D8<br />GPU (Guest 1): MSI GTX770 4GB<br />GPU (Guest 2): Asus GTX560Ti 2GB</p><p>It&#039;s been going fairly well so far. Besides figuring out how to make an upstart equivalent of the systemd service, I haven&#039;t had any major issues setting up, to this point. I&#039;ve been using virtual machine manager from my laptop, and configured a guest image I&#039;m happy with. However, when I try to start the VM with the graphics card added, I get this error:</p><div class="codebox"><pre><code>Error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 9663676416: Operation not permitted Traceback (most recent call last): File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 96, in cb_wrapper callback(asyncjob, *args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 117, in tmpcb callback(*args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1162, in startup self._backend.create() File &quot;/usr/lib/python2.7/dist-packages/libvirt.py&quot;, line 866, in create if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self) libvirtError: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 9663676416: Operation not permitted</code></pre></div><p>Any ideas on what I&#039;m doing wrong?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427834">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427835" class="blockpost rowodd"> <h2><span><span class="conr">#2159</span> <a href="viewtopic.php?pid=1427835#p1427835">2014-06-19 19:44:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Kaurin wrote:</cite><blockquote><div><p>Hi all,</p><p>I&#039;ve come on board with this and really want to make it work.</p><p>I was hitting <a href="https://bugzilla.kernel.org/show_bug.cgi?id=44881" rel="nofollow">This bug</a>, and with help of aw, was able to fix it (Still waiting confirmation from aw).</p><p>Here is my setup:</p><p>Mobo: Gigabyte Q87M-D2H, BIOS F7 01/17/2014 (latest bios)<br />CPU: Intel Core i7 4770<br />Ram: 32GB @ 1600Mhz<br />GPU: <a href="http://www.techpowerup.com/vgabios/148828/gigabyte-gtx770-4096-130729.html" rel="nofollow">Gigabyte Nvidia GTX 770, 4GB slightly overclocked by Gigabyte</a><br />OS: Arch</p><p>My primary display is set to the Intel integrated graphics, and I&#039;m running a bare Arch + qemu, so no graphical environment.</p><p>If I run Linux with a graphical environment, It&#039;s going to be a virt, with spice probably, and then use that via Windows, which is also a virt :&gt;</p><p>Edit:<br />Grub:</p><div class="codebox"><pre><code>linux /vmlinuz-3.15.0-rc6-ARCH-dirty root=/dev/mapper/sys-root ro intel_iommu=on vfio_iommu_type1</code></pre></div><br /><p>Before even trying GPU passthrough, this was the command line I used to install/test Windows7:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on</code></pre></div><p>Win7 works like this, using spice (via ssh tunnel), and everything is dandy.</p><p>I&#039;ve tried testing the GPU passtrhough (as per OP), like so:</p><p>Bind the GPU to vfio-pci:</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><p>This is from journalctl -b0 -ocat</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1 VFIO - User Level meta-driver version: 0.3 vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900</code></pre></div><p>Try to boot:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Running this yields no errors, and I could hear the GPU fans spin down, and back up. However, the display does not turn on (no-signal state).</p><p>Then, I tried this:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 </code></pre></div><p>Basically the same command for win7 + GPU test. I logged in via spice, and noticed that I have a &quot;Standard VGA Graphics Adapter&quot; in Device Manager, but the device cannot start (Code 10). Hardware IDs look good: 10DE-1184</p><p>The &quot;High Definition Audio Device&quot; with the nvidia HWID seems to work (Can&#039;t really test it because I don&#039;t have HDMI cables / devices)</p><p>Can anyone suggest what to try next in order to get GPU-passtrhough to work?</p><p>Before anyone asks, the monitor is connected to the DVI port of the nvidia card since before I began testing GPU passthrough :)</p></div></blockquote></div><p>do you expect anyone to guess all the tech details needed to even try helping you? this is simply rude, seriously...</p><p>anyway, my guess is missing vga arbiter patch in kernel</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427835">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427836" class="blockpost roweven"> <h2><span><span class="conr">#2160</span> <a href="viewtopic.php?pid=1427836#p1427836">2014-06-19 19:54:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=55043">Kaurin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/55043.jpg?m=1327103448" width="80" height="80" alt="" /></dd> <dd><span>From: Ireland</span></dd> <dd><span>Registered: 2011-12-11</span></dd> <dd><span>Posts: 66</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=55043">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I&#039;m very sorry if it came off that way. It was definitely not my intention. <br />I will try to browse the thread again to see what I was missing.</p><p>I will look into the vga arbiter patch. Thank you!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427836">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427868" class="blockpost rowodd"> <h2><span><span class="conr">#2161</span> <a href="viewtopic.php?pid=1427868#p1427868">2014-06-19 21:07:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82901">rakataka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82901">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Kaurin wrote:</cite><blockquote><div><p>Hi all,</p><p>I&#039;ve come on board with this and really want to make it work.</p><p>I was hitting <a href="https://bugzilla.kernel.org/show_bug.cgi?id=44881" rel="nofollow">This bug</a>, and with help of aw, was able to fix it (Still waiting confirmation from aw).</p><p>Here is my setup:</p><p>Mobo: Gigabyte Q87M-D2H, BIOS F7 01/17/2014 (latest bios)<br />CPU: Intel Core i7 4770<br />Ram: 32GB @ 1600Mhz<br />GPU: <a href="http://www.techpowerup.com/vgabios/148828/gigabyte-gtx770-4096-130729.html" rel="nofollow">Gigabyte Nvidia GTX 770, 4GB slightly overclocked by Gigabyte</a><br />OS: Arch</p><p>My primary display is set to the Intel integrated graphics, and I&#039;m running a bare Arch + qemu, so no graphical environment.</p><p>If I run Linux with a graphical environment, It&#039;s going to be a virt, with spice probably, and then use that via Windows, which is also a virt :&gt;</p><p>Edit:<br />Grub:</p><div class="codebox"><pre><code>linux /vmlinuz-3.15.0-rc6-ARCH-dirty root=/dev/mapper/sys-root ro intel_iommu=on vfio_iommu_type1</code></pre></div><br /><p>Before even trying GPU passthrough, this was the command line I used to install/test Windows7:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on</code></pre></div><p>Win7 works like this, using spice (via ssh tunnel), and everything is dandy.</p><p>I&#039;ve tried testing the GPU passtrhough (as per OP), like so:</p><p>Bind the GPU to vfio-pci:</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><p>This is from journalctl -b0 -ocat</p><div class="codebox"><pre><code>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1 VFIO - User Level meta-driver version: 0.3 vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900</code></pre></div><p>Try to boot:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Running this yields no errors, and I could hear the GPU fans spin down, and back up. However, the display does not turn on (no-signal state).</p><p>Then, I tried this:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win7 \ -enable-kvm \ -M q35 \ -net bridge,br=br0 \ -net nic,macaddr=52:54:04:fa:8d:ee,model=virtio \ -nographic \ -spice addr=127.0.0.1,port=5900,disable-ticketing \ -vga qxl \ -cpu host \ -smp cores=2,threads=2 \ -m 8G \ -soundhw hda \ -balloon none \ -rtc base=localtime,clock=vm \ -drive file=/dev/sdb,index=0,if=virtio,discard=on \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 </code></pre></div><p>Basically the same command for win7 + GPU test. I logged in via spice, and noticed that I have a &quot;Standard VGA Graphics Adapter&quot; in Device Manager, but the device cannot start (Code 10). Hardware IDs look good: 10DE-1184</p><p>The &quot;High Definition Audio Device&quot; with the nvidia HWID seems to work (Can&#039;t really test it because I don&#039;t have HDMI cables / devices)</p><p>Can anyone suggest what to try next in order to get GPU-passtrhough to work?</p><p>Before anyone asks, the monitor is connected to the DVI port of the nvidia card since before I began testing GPU passthrough <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Update: After a Windows Update/Reboot, the Nvidia GPU is shown as &quot;NVIDIA GeForce GTX 770&quot;, and is now code 12 and still not working. (Cannot start b/c resources).</p><p>I have not mentioned this before, but I&#039;ve tried doing the GPU passthrough on XEN last week, and hit the same thing there (device name OK + code 12). After seeing that gpu passthrough with nvidia is something I might not be able to do, i turned to KVM where I see people running virts + nvidia successfully.</p></div></blockquote></div><p>As it happens, we have an almost identical PC (I have the same motherboard, CPU, GFX card MSI GTX770 but with 2GB VRAM instead of 4, 32 GB RAM).<br />I may have been using kvm passthrough for a little bit longer than you. I updated today to linux-mainline 3.15.0 from 3.14.xx (can&#039;t remember exact xx). VGA passthrough worked fine on 3.14 with the following kernel line:</p><div class="codebox"><pre><code>linux /boot/vmlinuz-linux-mainline root=/dev/sda1 rw modprobe.blacklist=nouveau,wmi,mxm_wmi,ttm nouveau.modeset=0 intel_iommu=on intel_iommu=igfx_off pcie_acs_override=downstream kvm.ignore_msrs=1 vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 nohz=off </code></pre></div><p>I should note that I have not used the patch you refer to in <a href="https://bugzilla.kernel.org/show_bug.cgi?id=44881" rel="nofollow">&quot;This bug&quot;</a>, so I get the related error in my boot log.<br />I am now (with the new kernel version 3.15.0) also getting a blank screen (I have a dedicated monitor connected to the HDMI output of my GTX770 card and I do not have the binary NVIDIA drivers install on the linux host) whereas it worked fine before with Windows 8.1 Pro 64bit and a number of games.<br />I have two things to note:</p><ol class="decimal"><li><p>I have noticed a new error when running quemu with passthough which I was not getting with the 3.14.xx kernel:</p><div class="codebox"><pre><code>VFIO - User Level meta-driver version: 0.3 Jun 19 22:59:05 laptop kernel: vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Jun 19 22:59:05 laptop kernel: vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Jun 19 22:59:09 laptop kernel: [drm:intel_uncore_check_errors] *ERROR* Unclaimed register before interrupt Jun 19 23:00:00 laptop kernel: [drm:hsw_unclaimed_reg_clear] *ERROR* Unknown unclaimed register before writing to 4510c</code></pre></div><p>I have read in previous thread posts that this is indicative of not having the i935 arbiter patch compiled but I used the package in the 1st post of this thread and just did </p><div class="codebox"><pre><code>makepkg; pacman -U *.pkg.tar.xz</code></pre></div><p> with no changes to the config.</p></li><li><p>If you take a look at my kernel line (which I have carried over from 3.14.xx) I have used a </p><div class="codebox"><pre><code>intel_iommu=on intel_iommu=igfx_off</code></pre></div><p> instead of plain </p><div class="codebox"><pre><code>intel_iommu=on</code></pre></div><p> The extra </p><div class="codebox"><pre><code>intel_iommu=igfx_off</code></pre></div><p> made the difference between being able to do VGA passthough on 3.14.xx and failing with an error I cannot remember.</p></li></ol><p>I wonder whether it is possible that something has been changed with respect to intel_iommu in 3.15.<br />If I find anything new I will update.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427868">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427884" class="blockpost roweven"> <h2><span><span class="conr">#2162</span> <a href="viewtopic.php?pid=1427884#p1427884">2014-06-19 21:34:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Seriously people, if you have Intel graphics in your system, you need the i915 kernel patch.&#160; If you have radeon host graphics, you need the other vga arbiter patch.&#160; If you can&#039;t assign the devices you want because of iommu grouping, you need the ACS override patch.&#160; If nothing happens on the display connected to the assigned GPU when you start the VM, you&#039;re probably missing the i915 or vga arbiter patches.&#160; If you get screen corruption on the host, you&#039;re definitely missing them.&#160; If you get weird intel error messages like above, you&#039;re definitely missing the i915 patch.</p><p>EDIT: If you think you have the i915 or ACS override patch, but it&#039;s not working, then you&#039;re not using the right kernel commandline options to enable them.</p> <p class="postedit"><em>Last edited by aw (2014-06-19 21:36:04)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427884">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427888" class="blockpost rowodd"> <h2><span><span class="conr">#2163</span> <a href="viewtopic.php?pid=1427888#p1427888">2014-06-19 21:49:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82901">rakataka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82901">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Seriously people, if you have Intel graphics in your system, you need the i915 kernel patch.&#160; If you have radeon host graphics, you need the other vga arbiter patch.&#160; If you can&#039;t assign the devices you want because of iommu grouping, you need the ACS override patch.&#160; If nothing happens on the display connected to the assigned GPU when you start the VM, you&#039;re probably missing the i915 or vga arbiter patches.&#160; If you get screen corruption on the host, you&#039;re definitely missing them.&#160; If you get weird intel error messages like above, you&#039;re definitely missing the i915 patch.</p><p>EDIT: If you think you have the i915 or ACS override patch, but it&#039;s not working, then you&#039;re not using the right kernel commandline options to enable them.</p></div></blockquote></div><p>You are right, in my case (getting a blank screen but having used the correct kernel: 3.15.0 mainline from 1st post), I just need to add </p><div class="codebox"><pre><code>i915.enable_hd_vgaarb=1</code></pre></div><p> to my kernel command line an it worked fine.</p><p>As you can attest, this is neither horribly complex, but it&#039;s not simple either with multiple special cases. Also, I normally read change logs (I&#039;m a developer myself) but I did not see one in a reasonably prominent place where I would be informed that I need to add an extra kernel parameter after upgrading to 3.15. </p><p>Please do not think that I take all your free work for granted, I am certainly very thankful for it and I try to do the extra work myself in order not to burden those doing the actual work. However, sometimes, one may miss some crucial information due to the lack of dedicated documentation, and searching on a forum is not always helpful (again, not saying that *you* should provide docs, just saying that mistakes may happen due to a lack of them).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427888">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427895" class="blockpost roweven"> <h2><span><span class="conr">#2164</span> <a href="viewtopic.php?pid=1427895#p1427895">2014-06-19 21:58:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rakataka wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Seriously people, if you have Intel graphics in your system, you need the i915 kernel patch.&#160; If you have radeon host graphics, you need the other vga arbiter patch.&#160; If you can&#039;t assign the devices you want because of iommu grouping, you need the ACS override patch.&#160; If nothing happens on the display connected to the assigned GPU when you start the VM, you&#039;re probably missing the i915 or vga arbiter patches.&#160; If you get screen corruption on the host, you&#039;re definitely missing them.&#160; If you get weird intel error messages like above, you&#039;re definitely missing the i915 patch.</p><p>EDIT: If you think you have the i915 or ACS override patch, but it&#039;s not working, then you&#039;re not using the right kernel commandline options to enable them.</p></div></blockquote></div><p>You are right, in my case (getting a blank screen but having used the correct kernel: 3.15.0 mainline from 1st post), I just need to add </p><div class="codebox"><pre><code>i915.enable_hd_vgaarb=1</code></pre></div><p> to my kernel command line an it worked fine.</p><p>As you can attest, this is neither horribly complex, but it&#039;s not simple either with multiple special cases. Also, I normally read change logs (I&#039;m a developer myself) but I did not see one in a reasonably prominent place where I would be informed that I need to add an extra kernel parameter after upgrading to 3.15. </p><p>Please do not think that I take all your free work for granted, I am certainly very thankful for it and I try to do the extra work myself in order not to burden those doing the actual work. However, sometimes, one may miss some crucial information due to the lack of dedicated documentation, and searching on a forum is not always helpful (again, not saying that *you* should provide docs, just saying that mistakes may happen due to a lack of them).</p></div></blockquote></div><p>Understood, for some reason the patches in the first post always get the changelog stripped out, the upstream patches do include a proper description:</p><p><a href="https://lkml.org/lkml/2013/5/30/513" rel="nofollow">ACS override</a><br /><a href="https://lkml.org/lkml/2014/5/9/517" rel="nofollow">i915 VGA arbiter</a><br /><a href="https://lkml.org/lkml/2014/5/25/94" rel="nofollow">VGA arbiter</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427895">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427900" class="blockpost rowodd"> <h2><span><span class="conr">#2165</span> <a href="viewtopic.php?pid=1427900#p1427900">2014-06-19 22:08:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82901">rakataka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82901">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeap, in my case (i915 VGA arbiter) I hope that if I had seen:</p><div class="codebox"><pre><code>+module_param_named(enable_hd_vgaarb, i915.enable_hd_vgaarb, bool, 0444); +MODULE_PARM_DESC(enable_hd_vgaarb, + &quot;Enable support for VGA arbitration on Intel HD IGD. (default: false)&quot;);</code></pre></div><p>I would have taken the hint that a new parameter was available and I would have checked what&#039;s needed.</p><p>Thanks for the relevant links.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427963" class="blockpost roweven"> <h2><span><span class="conr">#2166</span> <a href="viewtopic.php?pid=1427963#p1427963">2014-06-20 03:38:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80333">ahl</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-16</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I have been hit with a possible regression bug. A while ago I reported this:</p><div class="codebox"><pre><code>System 2: AMD FX 8350 + Asus Sabretooth 990FX R2.0 (BIOS 2104) - OK - passthrough of the integrated audio device also tested to work with Win 7</code></pre></div><p>But now, passing through the integrated audio device no longer works properly. When playing audio in guest I only get some horrible noise and, at the same time, lots of these messages appear on host:</p><div class="codebox"><pre><code>AMD-Vi: Event logged [IO_PAGE_FAULT device=00:14.2 domain=0x0025 address=0xffffffffffffffc0 flags=0x0010]</code></pre></div><p>These are some of the most obvious changes since working setup:<br />ASUS BIOS 2104 -&gt; <strong>2501</strong><br />Changed the host gpu card from HD3870 -&gt; <strong>HD5450</strong>&#160; (Can&#039;t test 3870 right now)<br />Guest card is still HD6670.<br />Linux 3.14.0-rc8(approx.) -&gt; <strong>3.14.8-gentoo</strong><br />Qemu 1.7.0 -&gt; <strong>2.0.0-r1</strong>&#160; &#160;(Already tried downgrading, It didn&#039;t help)</p><p>lsgroup output has also changed. I could have sworn first 4 of these were in the same group and I had to bind them all. <span class="bbs"><strong>Now they are separate</strong></span> (<strong>Edit</strong>: Perhaps it was some other system after all):</p><div class="codebox"><pre><code>### Group 11 ### 00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 42) ### Group 12 ### 00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40) ### Group 13 ### 00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40) ### Group 14 ### 00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40) ### Group 15 ### 00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller</code></pre></div><p>Any idea what could introduce such a problem?</p><p><strong>UPDATE</strong></p><p>After some very thorough testing, I found an explanation but no solution. It may be a <strong>BIOS problem</strong>. Changing the kernel did nothing.</p><p>BIOS SABERTOOTH-990FX-R20-ASUS-2501.CAP (8a19662ee80ff8b75122260baf3de1b760eeb1e6)<br />BIOS SABERTOOTH-990FX-R20-ASUS-2301.CAP (a593fe9cef0a5b9c5e6eff3ea3f7c5a49bd7743e)<br />- Problem as described above</p><p>BIOS SABERTOOTH-990FX-R20-ASUS-<strong>2104</strong>.CAP (66bd1583c73ae28ca003b5fd58edc3b998eaf215)<br />- When playing the sound samples in Win 7, sometimes they play correctly, sometimes they sound very distorted and sometimes they don&#039;t play at all<br />- No error messages appear on host</p><p>For my sanity, I&#039;m just going to assume that the latest bioses are actually working correctly. If it does not work properly it better throw some errors rather than being half-broken. Perhaps it never fully worked -- I can&#039;t be absolutely sure anymore.</p> <p class="postedit"><em>Last edited by ahl (2014-06-20 16:44:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427963">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1427996" class="blockpost rowodd"> <h2><span><span class="conr">#2167</span> <a href="viewtopic.php?pid=1427996#p1427996">2014-06-20 08:23:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Understood, for some reason the patches in the first post always get the changelog stripped out, the upstream patches do include a proper description:</p><p><a href="https://lkml.org/lkml/2013/5/30/513" rel="nofollow">ACS override</a><br /><a href="https://lkml.org/lkml/2014/5/9/517" rel="nofollow">i915 VGA arbiter</a><br /><a href="https://lkml.org/lkml/2014/5/25/94" rel="nofollow">VGA arbiter</a></p></div></blockquote></div><p>Thanks for the links. I understand why ACS override was rejected and there is a discussion under i915 arbiter patch (leading nowhere, because the only opponent cannot be bothered to write alternative solution, as he openly admits), but what happened to the last one? There is no discussion following your post, but it is not present in current <a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/drivers/gpu/vga/vgaarb.c" rel="nofollow">http://git.kernel.org/cgit/linux/kernel … a/vgaarb.c</a> either.</p><p>Does that mean that VGA pass-through users cannot rely on upstream kernel if they want to use (otherwise well-functioning, but poorly supported by kernel) hardware such as Intel IGP or AMD Radeons ? <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Given that nVidia seem to be going out of their way to prevent use of consumer cards in such configuration (&quot;Error 43&quot;), this is very discouraging ...</p> <p class="postedit"><em>Last edited by Bronek (2014-06-20 11:49:01)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1427996">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428122" class="blockpost roweven"> <h2><span><span class="conr">#2168</span> <a href="viewtopic.php?pid=1428122#p1428122">2014-06-20 17:22:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>can someone pls help ...</p><br /><p>I am hitting strange bug with HDMI sound...</p><p>It starts to lag on higher cpu usage and stays distorted only with 660 and 770 cards... 560 works fine...<br />did vm reinstall, driver reinstall, slots change, acs parameters... i got no clue what is wrong...</p><br /><p>i7 2600<br />gigabyte g1 sniper3<br />debian </p><p>thx</p><p>dmesg:</p><div class="codebox"><pre class="vscroll"><code> 0.551184] ------------[ cut here ]------------ [ 0.551190] WARNING: CPU: 0 PID: 1 at drivers/pci/search.c:46 pci_find_upstream_pcie_bridge+0x6b/0x80() [ 0.551191] Modules linked in: [ 0.551193] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.15.0-rc7-awilliam+ #1 [ 0.551194] Hardware name: Gigabyte Technology Co., Ltd. To be filled by O.E.M./G1.Sniper 3, BIOS F7 08/23/2012 [ 0.551196] 0000000000000009 ffffffff814c0182 0000000000000000 ffffffff8105ccc2 [ 0.551198] ffff88044a0dc098 ffff88044a0dc000 ffff88044a0dc098 0000000000000000 [ 0.551200] 0000000000000000 ffffffff812ac7eb ffffffff813b3496 0009880400000000 [ 0.551202] Call Trace: [ 0.551207] [&lt;ffffffff814c0182&gt;] ? dump_stack+0x41/0x51 [ 0.551210] [&lt;ffffffff8105ccc2&gt;] ? warn_slowpath_common+0x72/0x90 [ 0.551212] [&lt;ffffffff812ac7eb&gt;] ? pci_find_upstream_pcie_bridge+0x6b/0x80 [ 0.551215] [&lt;ffffffff813b3496&gt;] ? intel_iommu_add_device+0x36/0x210 [ 0.551218] [&lt;ffffffff813a8a50&gt;] ? bus_set_iommu+0x50/0x50 [ 0.551220] [&lt;ffffffff813a8a70&gt;] ? add_iommu_group+0x20/0x50 [ 0.551222] [&lt;ffffffff8135e683&gt;] ? bus_for_each_dev+0x53/0x90 [ 0.551224] [&lt;ffffffff813a8a3e&gt;] ? bus_set_iommu+0x3e/0x50 [ 0.551227] [&lt;ffffffff81913bf9&gt;] ? intel_iommu_init+0x53f/0x586 [ 0.551231] [&lt;ffffffff818d743e&gt;] ? memblock_find_dma_reserve+0x131/0x131 [ 0.551233] [&lt;ffffffff818d744c&gt;] ? pci_iommu_init+0xe/0x37 [ 0.551235] [&lt;ffffffff81002152&gt;] ? do_one_initcall+0xf2/0x140 [ 0.551238] [&lt;ffffffff8107aa1a&gt;] ? parse_args+0x1fa/0x330 [ 0.551240] [&lt;ffffffff818cf060&gt;] ? kernel_init_freeable+0x15f/0x1e1 [ 0.551242] [&lt;ffffffff818ce8ac&gt;] ? do_early_param+0x81/0x81 [ 0.551245] [&lt;ffffffff814b24c0&gt;] ? rest_init+0x70/0x70 [ 0.551247] [&lt;ffffffff814b24c5&gt;] ? kernel_init+0x5/0xf0 [ 0.551249] [&lt;ffffffff814cd78c&gt;] ? ret_from_fork+0x7c/0xb0 [ 0.551251] [&lt;ffffffff814b24c0&gt;] ? rest_init+0x70/0x70 [ 0.551254] ---[ end trace bf54b21f328db5e9 ]--- [ 2404.025436] kvm [3767]: vcpu0 unhandled rdmsr: 0x1a2 [ 2404.025505] kvm [3767]: vcpu1 unhandled rdmsr: 0x1a2 [ 2404.025566] kvm [3767]: vcpu2 unhandled rdmsr: 0x1a2 [ 2404.025623] kvm [3767]: vcpu3 unhandled rdmsr: 0x1a2</code></pre></div><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.15.0-rc7-awilliam+ root=UUID=dee8e431-f41a-4ba9-89d0-dc053e70ab5e ro elevator=deadline quiet intel_iommu=on pcie_acs_override=id:8086:0101 transparent_hugepage=always</code></pre></div><div class="codebox"><pre class="vscroll"><code>lspci -nn 00:00.0 Host bridge [0600]: Intel Corporation 2nd Generation Core Processor Family DRAM Controller [8086:0100] (rev 09) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200/2nd Generation Core Processor Family PCI Express Root Port [8086:0101] (rev 09) 00:02.0 VGA compatible controller [0300]: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller [8086:0102] (rev 09) 00:14.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:1e31] (rev 04) 00:16.0 Communication controller [0780]: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 [8086:1e3a] (rev 04) 00:19.0 Ethernet controller [0200]: Intel Corporation 82579V Gigabit Network Connection [8086:1503] (rev 04) 00:1a.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:1e2d] (rev 04) 00:1c.0 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 [8086:1e10] (rev c4) 00:1c.1 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 2 [8086:1e12] (rev c4) 00:1c.5 PCI bridge [0604]: Intel Corporation 82801 PCI Bridge [8086:244e] (rev c4) 00:1c.6 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 7 [8086:1e1c] (rev c4) 00:1c.7 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 8 [8086:1e1e] (rev c4) 00:1d.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:1e26] (rev 04) 00:1f.0 ISA bridge [0601]: Intel Corporation Z77 Express Chipset LPC Controller [8086:1e44] (rev 04) 00:1f.2 SATA controller [0106]: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] [8086:1e02] (rev 04) 00:1f.3 SMBus [0c05]: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller [8086:1e22] (rev 04) 01:00.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8747 48-Lane, 5-Port PCI Express Gen 3 (8.0 GT/s) Switch [10b5:8747] (rev ba) 02:08.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8747 48-Lane, 5-Port PCI Express Gen 3 (8.0 GT/s) Switch [10b5:8747] (rev ba) 02:09.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8747 48-Lane, 5-Port PCI Express Gen 3 (8.0 GT/s) Switch [10b5:8747] (rev ba) 02:10.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8747 48-Lane, 5-Port PCI Express Gen 3 (8.0 GT/s) Switch [10b5:8747] (rev ba) 02:11.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8747 48-Lane, 5-Port PCI Express Gen 3 (8.0 GT/s) Switch [10b5:8747] (rev ba) 03:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1) 03:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 04:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1) 04:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1) 05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK106 [GeForce GTX 660] [10de:11c0] (rev a1) 05:00.1 Audio device [0403]: NVIDIA Corporation GK106 HDMI Audio Controller [10de:0e0b] (rev a1) 06:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1) 06:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1) 08:00.0 SATA controller [0106]: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller [1b4b:9172] (rev 11) 09:00.0 PCI bridge [0604]: Intel Corporation 82801 PCI Bridge [8086:244e] (rev 41) 0c:00.0 SATA controller [0106]: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller [1b4b:9172] (rev 11)</code></pre></div><br /><p>qemu</p><div class="codebox"><pre class="vscroll"><code> &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;/os&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;rtm&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;invpcid&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;lahf_lm&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;erms&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;bmi2&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;smep&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;avx2&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;hle&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;bmi1&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;fsgsbase&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;movbe&#039;/&gt; &lt;feature policy=&#039;force&#039; name=&#039;fma&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;utc&#039;&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.1,bus=root.1,addr=00.1,multifunction=on&#039;/&gt; &lt;qemu:env name=&#039;DISPLAY&#039; value=&#039;:0&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>i tried to remove hvtime and other cpu options but it starts to lag sometimes after 1min sometimes after 10mins...</p><p>others cards on DVI without sound are working normal at same time...</p><p>i tried almost everything i could find... but (&quot;alien&quot;,lagging) hdmi sounds are here allways.. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>i think its something with that nvidia pci bridge PLX, but i don&#039;t know what to do...</p> <p class="postedit"><em>Last edited by slis (2014-06-20 18:16:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428122">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428220" class="blockpost rowodd"> <h2><span><span class="conr">#2169</span> <a href="viewtopic.php?pid=1428220#p1428220">2014-06-20 20:47:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I keep getting this error</p><div class="codebox"><pre><code>error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 7390363648: Operation not permitted</code></pre></div><p>Through virt-manager.<br />I don&#039;t know how to debug this, but here is my specs :<br />uname -r :</p><div class="codebox"><pre><code>3.15.1-custom</code></pre></div><p>lspci -k :</p><div class="codebox"><pre><code>... 01:00.0 VGA compatible controller: NVIDIA Corporation G86 [GeForce 8500 GT] (rev a1) Subsystem: XFX Pine Group Inc. Device 230b 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] RV770 [Radeon HD 4870] Subsystem: PC Partner Limited / Sapphire Technology Device 0851 Kernel driver in use: pci-stub 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 4850 512MB GDDR3 PCI-E Dual Slot Fansink Kernel driver in use: pci-stub ... </code></pre></div><p>I&#039;m trying to pass the AMD card &quot;02:00.0&quot;.</p><p>cat /proc/cmdline </p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30</code></pre></div><p>dmesg | grep pci-stub</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 4.172224] pci-stub: add 1002:9440 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172229] pci-stub 0000:02:00.0: claimed by stub [ 4.172230] pci-stub: add 1002:AA30 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172233] pci-stub 0000:02:00.1: claimed by stub [ 25.757900] pci-stub 0000:02:00.0: claimed by stub [ 46.332286] pci-stub 0000:02:00.0: claimed by stub [ 46.332539] pci-stub 0000:02:00.1: claimed by stub [ 792.054112] pci-stub 0000:02:00.0: claimed by stub [ 792.054287] pci-stub 0000:02:00.1: claimed by stub [ 794.473400] pci-stub 0000:02:00.0: claimed by stub [ 794.473583] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><p>I did apply the following patches :&#160; acs override patch + i915 vga arbiter fixes, I&#039;m using Ubuntu 14.01 LTS.</p><p>One more Question, what it is meant by &quot;Systemd service&quot; ? I can&#039;t figure out what the equivalent in Debian based distros.</p> <p class="postedit"><em>Last edited by abdullah (2014-06-20 20:50:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428220">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428237" class="blockpost roweven"> <h2><span><span class="conr">#2170</span> <a href="viewtopic.php?pid=1428237#p1428237">2014-06-20 21:26:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>Hello,</p><p>I keep getting this error</p><div class="codebox"><pre><code>error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 7390363648: Operation not permitted</code></pre></div><p>Through virt-manager.<br />I don&#039;t know how to debug this, but here is my specs :<br />uname -r :</p><div class="codebox"><pre><code>3.15.1-custom</code></pre></div><p>lspci -k :</p><div class="codebox"><pre><code>... 01:00.0 VGA compatible controller: NVIDIA Corporation G86 [GeForce 8500 GT] (rev a1) Subsystem: XFX Pine Group Inc. Device 230b 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] RV770 [Radeon HD 4870] Subsystem: PC Partner Limited / Sapphire Technology Device 0851 Kernel driver in use: pci-stub 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 4850 512MB GDDR3 PCI-E Dual Slot Fansink Kernel driver in use: pci-stub ... </code></pre></div><p>I&#039;m trying to pass the AMD card &quot;02:00.0&quot;.</p><p>cat /proc/cmdline </p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30</code></pre></div><p>dmesg | grep pci-stub</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 4.172224] pci-stub: add 1002:9440 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172229] pci-stub 0000:02:00.0: claimed by stub [ 4.172230] pci-stub: add 1002:AA30 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172233] pci-stub 0000:02:00.1: claimed by stub [ 25.757900] pci-stub 0000:02:00.0: claimed by stub [ 46.332286] pci-stub 0000:02:00.0: claimed by stub [ 46.332539] pci-stub 0000:02:00.1: claimed by stub [ 792.054112] pci-stub 0000:02:00.0: claimed by stub [ 792.054287] pci-stub 0000:02:00.1: claimed by stub [ 794.473400] pci-stub 0000:02:00.0: claimed by stub [ 794.473583] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><p>I did apply the following patches :&#160; acs override patch + i915 vga arbiter fixes, I&#039;m using Ubuntu 14.01 LTS.</p><p>One more Question, what it is meant by &quot;Systemd service&quot; ? I can&#039;t figure out what the equivalent in Debian based distros.</p></div></blockquote></div><p>I don&#039;t use an Intel CPU/GPU on my setup, but since you don&#039;t use the kernel parameter, please read <a href="https://bbs.archlinux.org/viewtopic.php?pid=1426139#p1426139" rel="nofollow">this post</a>.</p><p>The equivalent to a systemd service is an upstart service or an initscript. </p><p>And since you&#039;re using libvirt, where is you vm&#039;s xml file?</p><p>Oh, and what do you use the nvidia card for? And which driver do you use it with?</p><p>Are the HD4xxx series even supported with this setup?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428237">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428256" class="blockpost rowodd"> <h2><span><span class="conr">#2171</span> <a href="viewtopic.php?pid=1428256#p1428256">2014-06-20 22:28:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>Hello,</p><p>I keep getting this error</p><div class="codebox"><pre><code>error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 7390363648: Operation not permitted</code></pre></div><p>Through virt-manager.<br />I don&#039;t know how to debug this, but here is my specs :<br />uname -r :</p><div class="codebox"><pre><code>3.15.1-custom</code></pre></div><p>lspci -k :</p><div class="codebox"><pre><code>... 01:00.0 VGA compatible controller: NVIDIA Corporation G86 [GeForce 8500 GT] (rev a1) Subsystem: XFX Pine Group Inc. Device 230b 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] RV770 [Radeon HD 4870] Subsystem: PC Partner Limited / Sapphire Technology Device 0851 Kernel driver in use: pci-stub 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 4850 512MB GDDR3 PCI-E Dual Slot Fansink Kernel driver in use: pci-stub ... </code></pre></div><p>I&#039;m trying to pass the AMD card &quot;02:00.0&quot;.</p><p>cat /proc/cmdline </p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30</code></pre></div><p>dmesg | grep pci-stub</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.15.1-custom root=UUID=850616ae-85d0-4248-a5f6-91cc6aae6b7d ro quiet kvm.ignore_msrs=1 nomodeset intel_iommu=on pci-stub.ids=1002:9440,1002:aa30 [ 4.172224] pci-stub: add 1002:9440 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172229] pci-stub 0000:02:00.0: claimed by stub [ 4.172230] pci-stub: add 1002:AA30 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 4.172233] pci-stub 0000:02:00.1: claimed by stub [ 25.757900] pci-stub 0000:02:00.0: claimed by stub [ 46.332286] pci-stub 0000:02:00.0: claimed by stub [ 46.332539] pci-stub 0000:02:00.1: claimed by stub [ 792.054112] pci-stub 0000:02:00.0: claimed by stub [ 792.054287] pci-stub 0000:02:00.1: claimed by stub [ 794.473400] pci-stub 0000:02:00.0: claimed by stub [ 794.473583] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><p>I did apply the following patches :&#160; acs override patch + i915 vga arbiter fixes, I&#039;m using Ubuntu 14.01 LTS.</p><p>One more Question, what it is meant by &quot;Systemd service&quot; ? I can&#039;t figure out what the equivalent in Debian based distros.</p></div></blockquote></div><p>I don&#039;t use an Intel CPU/GPU on my setup, but since you don&#039;t use the kernel parameter, please read <a href="https://bbs.archlinux.org/viewtopic.php?pid=1426139#p1426139" rel="nofollow">this post</a>.</p><p>The equivalent to a systemd service is an upstart service or an initscript. </p><p>And since you&#039;re using libvirt, where is you vm&#039;s xml file?</p><p>Oh, and what do you use the nvidia card for? And which driver do you use it with?</p><p>Are the HD4xxx series even supported with this setup?</p></div></blockquote></div><p>The nvidia card is used as the host card (nouva), until I changed it right before posting this, so, no the parameter got nothing to do with this, I&#039;m trying to pass the secondary card.<br />is this how you debug the VM&#039;s ? where I even can find the VM&#039;s xml?</p><p>I will pass the nvidia card right after I successfully pass the ATI card, or I may get a new one.<br />I don&#039;t know what kind of support you are referring to, but it is working right ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428256">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428288" class="blockpost roweven"> <h2><span><span class="conr">#2172</span> <a href="viewtopic.php?pid=1428288#p1428288">2014-06-21 01:01:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I think I&#039;m having the <a href="https://bbs.archlinux.org/viewtopic.php?pid=1427834#p1427834" rel="nofollow">same issue</a>, also using virt-manager. Here&#039;s the xml file from one of my VMs. </p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;Head1&lt;/name&gt; &lt;uuid&gt;2f16058f-e2e3-a4a5-5b74-4a5e32623bf8&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;8&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-trusty&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;SandyBridge&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dca&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pcid&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdpe1gb&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/Win8Steam.qcow2&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:2e:35:17&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039;/&gt; &lt;video&gt; &lt;model type=&#039;vga&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>You should find the xml files in <em>/etc/libvirt/qemu/</em> abdullah.</p> <p class="postedit"><em>Last edited by MCMjolnir (2014-06-21 01:30:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428288">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428362" class="blockpost rowodd"> <h2><span><span class="conr">#2173</span> <a href="viewtopic.php?pid=1428362#p1428362">2014-06-21 08:38:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>Hello,</p><p>I keep getting this error</p><div class="codebox"><pre><code>error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 7390363648: Operation not permitted</code></pre></div><p>...</p></div></blockquote></div><p>wild guess:</p><div class="codebox"><pre><code>[root@sinny ~]# grep root /etc/libvirt/qemu.conf user = &quot;root&quot; group = &quot;root&quot; [root@sinny ~]# </code></pre></div><p>i think i&#039;ve seen this somewhere already, but can&#039;t remember where</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428362">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428363" class="blockpost roweven"> <h2><span><span class="conr">#2174</span> <a href="viewtopic.php?pid=1428363#p1428363">2014-06-21 08:40:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MCMjolnir wrote:</cite><blockquote><div><p>Hi all.</p><p>I&#039;m new here, but I&#039;ve been reading the thread for a couple of months since I got the urge to build a server for streaming Steam from a workstation that recently came into my possession. Finally got all the parts together, and didn&#039;t have much luck with Arch since I&#039;m not really familiar with it, so I&#039;m now running Ubuntu Server 14.04.</p><p>Here&#039;s my config:<br />CPUs: 2x Xeon E5-2680<br />Memory: 64 GB ECC RAM @ 1600MHz<br />Mobo: Asus Z9PA-D8<br />GPU (Guest 1): MSI GTX770 4GB<br />GPU (Guest 2): Asus GTX560Ti 2GB</p><p>It&#039;s been going fairly well so far. Besides figuring out how to make an upstart equivalent of the systemd service, I haven&#039;t had any major issues setting up, to this point. I&#039;ve been using virtual machine manager from my laptop, and configured a guest image I&#039;m happy with. However, when I try to start the VM with the graphics card added, I get this error:</p><div class="codebox"><pre><code>Error starting domain: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 9663676416: Operation not permitted Traceback (most recent call last): File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 96, in cb_wrapper callback(asyncjob, *args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 117, in tmpcb callback(*args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1162, in startup self._backend.create() File &quot;/usr/lib/python2.7/dist-packages/libvirt.py&quot;, line 866, in create if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self) libvirtError: internal error: Process exited prior to exec: libvirt: error : cannot limit locked memory to 9663676416: Operation not permitted</code></pre></div><p>Any ideas on what I&#039;m doing wrong?</p></div></blockquote></div><p>This looks like an apparmor error, please read here: <a href="http://wiki.apparmor.net/index.php/Libvirt" rel="nofollow">http://wiki.apparmor.net/index.php/Libvirt</a>.</p><p>Basically, you can disable apparmor security for the Windows guest, by editing the the file /etc/apparmor.d/libvirt/libvirt-&lt;uuid&gt;.files and setting security profile to none or something like this. Probably need to restart the libvirt service too.</p><p>Now using virt-manager, and going on the General tab of the Windows machine, you can check that the security profile is no active anymore. By the way you find the &quot;uuid&quot; in virt-manager too.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428363">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1428411" class="blockpost rowodd"> <h2><span><span class="conr">#2175</span> <a href="viewtopic.php?pid=1428411#p1428411">2014-06-21 11:48:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OK, I tried setting <em>security_driver = &quot;none&quot;</em> in <em>/etc/libvirt/qemu.conf</em> as per the link but it didn&#039;t seem to do anything. So instead I ran </p><div class="codebox"><pre><code>sudo /etc/init.d/apparmor stop sudo update-rc.d -f apparmor remove</code></pre></div><p> rebooted the host, and now the guest boots! (although this may be a bit heavy handed).</p><p>However, I&#039;m now facing an issue in the guest where the card is showing up in device manager but it&#039;s giving me a code 43. I see this issue has been resolved already, but I&#039;m not sure how I implement it (I&#039;m still very much a fledgling linux user).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1428411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=86">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <a href="viewtopic.php?id=162768&amp;p=86">86</a> <strong>87</strong> <a href="viewtopic.php?id=162768&amp;p=88">88</a> <a href="viewtopic.php?id=162768&amp;p=89">89</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=88">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
