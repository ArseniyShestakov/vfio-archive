<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 157) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=157" title="Page 157" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=156" title="Page 156" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=158" title="Page 158" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=156">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <a href="viewtopic.php?id=162768&amp;p=156">156</a> <strong>157</strong> <a href="viewtopic.php?id=162768&amp;p=158">158</a> <a href="viewtopic.php?id=162768&amp;p=159">159</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=158">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1493958" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3901</span> <a href="viewtopic.php?pid=1493958#p1493958">2015-01-17 17:55:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>How exactly are you guys using your keyboard and mouse in the guest? I saw a youtube video of someone using synergy so that seems like a good option, but other than plugging in a separate keyboard and passing it through as well I&#039;m at a loss as to how I&#039;m supposed to share the keyboard and mouse without them potentially getting stuck in the guest.</p></div></blockquote></div><p>Don&#039;t know if will help but in my case, if I know that I will not use Linux when I&#039;m running the Guest (Windows), I pass the USB for my Logitech keyboard and mouse and works like a charm. As soon as I turn off the Windows VM then I recover my keyboard and mouse on Linux.</p><p>In case that I need to go to my Linux host, then I have ssh and in the worst case, Teamviewer and both works fine from the Windows setup.</p><p>Sometimes I&#039;m on Linux and my wife is connecting to the Windows machine from the iPad too watch movies / play simple games and then I&#039;m running same script but without passing the USB for keyboard and mouse so I have full control on Linux and she is connecting with Teamviewer to the Windows computer.</p><p>Working with Photoshop I connect from the Linux computer using rdesktop that works pretty cool.</p><p>By the way, I know some people uses synergy but I tried myself and didn&#039;t get as good results as passing the USB directly (0 delay <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p><p>Hope it helps for you.</p><p>Best regards,</p><br /><br /><p>TheArcher</p> <p class="postedit"><em>Last edited by thearcherblog (2015-01-17 17:56:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493958">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493981" class="blockpost roweven"> <h2><span><span class="conr">#3902</span> <a href="viewtopic.php?pid=1493981#p1493981">2015-01-17 18:47:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>Update: We have video! Using the 970 as the passthrough and OVMF I was able to get output to the screen. However, I&#039;m unable to get the VM to boot from the windows iso. When trying it I see &quot;Boot failed. EFI DVD/CDROM 1&quot;, it tries to pxe boot, then it kicks over to the UEFI Interactive shell v2.1.</p></div></blockquote></div><p>Use this to assign the ISO to the VM :</p><div class="codebox"><pre><code>-device virtio-scsi-pci,id=scsi \ -drive file=/VMs/win8.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \</code></pre></div><p>Good luck !</p></div></blockquote></div><p>I managed to boot an arch cd using that. Thanks. Just need to figure out why my windows 8 iso is refusing to boot. </p><p>Thanks Myranti and archer for your usb help. For now I&#039;m using </p><p>&quot;-vga none -device secondary-vga&quot;</p><p>This just gives me a black box that will capture input until I ctrl+alt. So it&#039;s a good temp solution for now. Will explore both options to find a suitable method once I&#039;ve got everything stable.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493981">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494049" class="blockpost rowodd"> <h2><span><span class="conr">#3903</span> <a href="viewtopic.php?pid=1494049#p1494049">2015-01-17 23:50:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Okay, so i got everything working (i forgot kvm=off in the cpu parameter last).</p><p>The only problem now seems to be that i can&#039;t reboot the VM. vfio complains that the bios is corrupted. I&#039;m guessing that&#039;s because the windows VM shuts the GFX card off. What can i do about this?</p><p>To reiterate: It&#039;s a GTX 460</p><br /><br /><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>How exactly are you guys using your keyboard and mouse in the guest? I saw a youtube video of someone using synergy so that seems like a good option, but other than plugging in a separate keyboard and passing it through as well I&#039;m at a loss as to how I&#039;m supposed to share the keyboard and mouse without them potentially getting stuck in the guest.</p></div></blockquote></div><p>Don&#039;t know if will help but in my case, if I know that I will not use Linux when I&#039;m running the Guest (Windows), I pass the USB for my Logitech keyboard and mouse and works like a charm. As soon as I turn off the Windows VM then I recover my keyboard and mouse on Linux.</p><p>In case that I need to go to my Linux host, then I have ssh and in the worst case, Teamviewer and both works fine from the Windows setup.</p><p>Sometimes I&#039;m on Linux and my wife is connecting to the Windows machine from the iPad too watch movies / play simple games and then I&#039;m running same script but without passing the USB for keyboard and mouse so I have full control on Linux and she is connecting with Teamviewer to the Windows computer.</p><p>Working with Photoshop I connect from the Linux computer using rdesktop that works pretty cool.</p><p>By the way, I know some people uses synergy but I tried myself and didn&#039;t get as good results as passing the USB directly (0 delay <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p><p>Hope it helps for you.</p><p>Best regards,</p><p>TheArcher</p></div></blockquote></div><p>I&#039;m using synergy, and it&#039;s working well. I&#039;m using a bridged connection with netctl, and connecting with the hostnames. No noticeable delay anywhere in the system. It&#039;s great because it allows me to have one monitor windows and the other linux (I disable one monitor on linux with xrandr in my VM startup script).</p> <p class="postedit"><em>Last edited by DelusionalLogic (2015-01-17 23:54:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494049">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494094" class="blockpost roweven"> <h2><span><span class="conr">#3904</span> <a href="viewtopic.php?pid=1494094#p1494094">2015-01-18 07:07:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Good news everyone! I&#039;m up and running. I wasn&#039;t able to get the windows 8 iso to load. I managed to get the windows 10 preview to load and that works just fine. I tried a few windows 8 isos so no idea what that was about. Anyway, I used a gtx 970 FTW with a i7 4970k. Nvidia drivers worked without a hitch, gpu shows up just fine in dev manager, and I have no problem rebooting the machine. I ended up using OVMF as the older method wasn&#039;t cutting it for me. I also used the kernel OP provided although I&#039;m not exactly sure how much of the patches were needed. </p><p>Here&#039;s some code</p><p>/etc/default/grub</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;pcie_acs_override=downstream i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:13c2,10de:0fbb&quot;</code></pre></div><p>and my script to start the vm</p><div class="codebox"><pre><code>#!/bin/bash qemu-system-x86_64 -enable-kvm -m 8192 -cpu host,kvm=off -smp 4,cores=4,threads=1 \ -pflash /usr/share/ovmf/x64/ovmf_x64.bin \ -vga none \ -device vfio-pci,host=06:00.0,multifunction=on \ -device vfio-pci,host=06:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/tully/VMs/win10.iso,id=isocd,format=raw,if=none -device scsi-cd,drive=isocd \ -drive file=/dev/sdb,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/home/tully/VMs/virt.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -boot menu=on</code></pre></div><p>I&#039;m writing directly to a 300GB velociraptor that I had lying around. I&#039;m not exactly sure the % hit I took from using kvm but it&#039;s negligible. Insurgency was at 180fps maxed out and league was locked at 60fps and never dipped down once. I&#039;ll try out some more demanding games in a few days when I can but for now it looks to be performing wonderfully. Synergy doesn&#039;t exactly do well with certain games, but it does well in others. I&#039;ll just need to find out the quirks and work around them. Thanks everyone for helping me get this up and running.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494094">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494289" class="blockpost rowodd"> <h2><span><span class="conr">#3905</span> <a href="viewtopic.php?pid=1494289#p1494289">2015-01-18 20:53:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>Good news everyone! I&#039;m up and running. I wasn&#039;t able to get the windows 8 iso to load. I managed to get the windows 10 preview to load and that works just fine. I tried a few windows 8 isos so no idea what that was about. Anyway, I used a gtx 970 FTW with a i7 4970k. Nvidia drivers worked without a hitch, gpu shows up just fine in dev manager, and I have no problem rebooting the machine. I ended up using OVMF as the older method wasn&#039;t cutting it for me. I also used the kernel OP provided although I&#039;m not exactly sure how much of the patches were needed. </p><p>Here&#039;s some code</p><p>/etc/default/grub</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;pcie_acs_override=downstream i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:13c2,10de:0fbb&quot;</code></pre></div><p>and my script to start the vm</p><div class="codebox"><pre><code>#!/bin/bash qemu-system-x86_64 -enable-kvm -m 8192 -cpu host,kvm=off -smp 4,cores=4,threads=1 \ -pflash /usr/share/ovmf/x64/ovmf_x64.bin \ -vga none \ -device vfio-pci,host=06:00.0,multifunction=on \ -device vfio-pci,host=06:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/tully/VMs/win10.iso,id=isocd,format=raw,if=none -device scsi-cd,drive=isocd \ -drive file=/dev/sdb,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/home/tully/VMs/virt.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -boot menu=on</code></pre></div><p>I&#039;m writing directly to a 300GB velociraptor that I had lying around. I&#039;m not exactly sure the % hit I took from using kvm but it&#039;s negligible. Insurgency was at 180fps maxed out and league was locked at 60fps and never dipped down once. I&#039;ll try out some more demanding games in a few days when I can but for now it looks to be performing wonderfully. Synergy doesn&#039;t exactly do well with certain games, but it does well in others. I&#039;ll just need to find out the quirks and work around them. Thanks everyone for helping me get this up and running.</p></div></blockquote></div><br /><p>Firstly, How did you get past the interactive shell? Even with a parameter-list that looks functionally identical to yours i can&#039;t get it past the PXE boot.</p><p>Secondly. What i was doing (I&#039;m trying OVMF now) was passing the usb keyboard/mouse through, but then running a synergy server ON THE VM, with a client on the host. so the vm sees them as native input devices, and the linux host sees them as synergy virtual stuff.</p><p>EDIT: Figured it out. If you want to fix it you need to get a windows8 iso that support UEFI (most iso&#039;s seem to have that stripped).</p> <p class="postedit"><em>Last edited by DelusionalLogic (2015-01-18 23:06:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494317" class="blockpost roweven"> <h2><span><span class="conr">#3906</span> <a href="viewtopic.php?pid=1494317#p1494317">2015-01-18 22:01:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87484">kainet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-22</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:bart47@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just switched from gtx 670 to gtx 770 and everything works fine. Even more stable now. With gtx 670 sound sometimes become very laggy and only way to get back to normal sound is restart. I suppose this is because i do not set vga bios explicitly for gtx 670.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494317">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494474" class="blockpost rowodd"> <h2><span><span class="conr">#3907</span> <a href="viewtopic.php?pid=1494474#p1494474">2015-01-19 11:40:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kainet wrote:</cite><blockquote><div><p>Just switched from gtx 670 to gtx 770 and everything works fine. Even more stable now. With gtx 670 sound sometimes become very laggy and only way to get back to normal sound is restart. I suppose this is because i do not set vga bios explicitly for gtx 670.</p></div></blockquote></div><p>Technically 770 is 680 with overclocked memory, so there shouldn&#039;t be major differences between those cards.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494474">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494488" class="blockpost roweven"> <h2><span><span class="conr">#3908</span> <a href="viewtopic.php?pid=1494488#p1494488">2015-01-19 12:53:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kainet wrote:</cite><blockquote><div><p>Just switched from gtx 670 to gtx 770 and everything works fine. Even more stable now. With gtx 670 sound sometimes become very laggy and only way to get back to normal sound is restart. I suppose this is because i do not set vga bios explicitly for gtx 670.</p></div></blockquote></div><p>I have had same problems on 660ti, 680 and 770... (560ti works as i remember), after some time (random 1-60mins) sound would go crazy, like it&#039;s lagging (slowed down) or something... I couldn&#039;t get rid of it (changed mbo and cpu=same reslut), so i bought usb sound card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494488">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494502" class="blockpost rowodd"> <h2><span><span class="conr">#3909</span> <a href="viewtopic.php?pid=1494502#p1494502">2015-01-19 13:44:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87484">kainet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-22</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:bart47@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>kainet wrote:</cite><blockquote><div><p>Just switched from gtx 670 to gtx 770 and everything works fine. Even more stable now. With gtx 670 sound sometimes become very laggy and only way to get back to normal sound is restart. I suppose this is because i do not set vga bios explicitly for gtx 670.</p></div></blockquote></div><p>I have had same problems on 660ti, 680 and 770... (560ti works as i remember), after some time (random 1-60mins) sound would go crazy, like it&#039;s lagging (slowed down) or something... I couldn&#039;t get rid of it (changed mbo and cpu=same reslut), so i bought usb sound card.</p></div></blockquote></div><p>With 670 i solved this by such a way. For me sound goes crazy before 10 min after start. If that did not happened then i have normal sound till i shut down VM. Otherwise i shutdown (restart in VM not helps) VM and start it again, usually it takes 2-5 restarts to achieve stable sound <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> With 770 sound seems is normal but i start vm only few times.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494531" class="blockpost roweven"> <h2><span><span class="conr">#3910</span> <a href="viewtopic.php?pid=1494531#p1494531">2015-01-19 15:43:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I wish i could suspend the graphics card when it&#039;s not in use without keeping the vm on at all times.</p><p>I&#039;ve been unbinding the vfio-pci driver when i stop the vm, which does make sysfs report the device as suspended. The problem is that the graphics card still has the fan on at full power, because it&#039;s recieving juice. Can i somehow properly suspend the device?</p><p>EDIT: I can&#039;t seem to get libvirt to boot the VM correctly either. Is there any catch to running the VM with libvirt compared to qemu?</p> <p class="postedit"><em>Last edited by DelusionalLogic (2015-01-19 19:05:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494531">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494579" class="blockpost rowodd"> <h2><span><span class="conr">#3911</span> <a href="viewtopic.php?pid=1494579#p1494579">2015-01-19 18:42:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I got updated to the lates kernel and Qemu and my Linux guest could not boot wuth vga=none:</p><p>journalctl -f:</p><div class="codebox"><pre><code>Jan 19 21:35:37 localhost sudo[20006]: : TTY=pts/2 ; PWD=/home/ ; USER=root ; COMMAND=./vfio-bind 0000:01:00.0 0000:01:00.1 Jan 19 21:35:37 localhost sudo[20022]: : TTY=pts/2 ; PWD=/home/ ; USER=root ; COMMAND=/usr/bin/losetup /dev/loop1 bootL.mgr Jan 19 21:35:37 localhost sudo[20025]: : TTY=pts/2 ; PWD=/home/ ; USER=root ; COMMAND=/usr/bin/mdadm --build /dev/md1 --level=linear --force --raid-devices=2 /dev/loop1 /dev/sda2 Jan 19 21:35:37 localhost sudo[20028]: : TTY=pts/2 ; PWD=/home/ ; USER=root ; COMMAND=/usr/bin/qemu-system-x86_64 -M q35 -m 6148 -enable-kvm -cpu host -boot c -vga none -display none -monitor telnet:10.10.10.92:4441,server,nowait -smp 4,sockets=1,cores=2,threads=2 -device ahci,bus=pcie.0,id=ahci -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,x-vga=on,addr=0.0,multifunction=on,bus=root.1 -device vfio-pci,host=01:00.1,bus=pcie.0 -drive file=/dev/md1,id=dataDiskL,format=raw,if=none -device ide-hd,drive=dataDiskL -net nic,macaddr=52:54:00:12:34:56 -net bridge,br=br0 Jan 19 21:35:37 localhost kernel: device tap0 entered promiscuous mode Jan 19 21:35:37 localhost kernel: br0: port 2(tap0) entered forwarding state Jan 19 21:35:37 localhost kernel: br0: port 2(tap0) entered forwarding state Jan 19 21:35:37 localhost kernel: vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Jan 19 21:35:38 localhost ntpd[1076]: bind(31) AF_INET6 fe80::fc43:e2ff:fefd:e905%92%92#123 flags 0x11 failed: Cannot assign requested address Jan 19 21:35:38 localhost ntpd[1076]: unable to create socket on tap0 (88) for fe80::fc43:e2ff:fefd:e905%92#123 Jan 19 21:35:38 localhost ntpd[1076]: failed to init interface for address fe80::fc43:e2ff:fefd:e905%92 Jan 19 21:35:40 localhost ntpd[1076]: new interface(s) found: waking up resolver Jan 19 21:35:52 localhost kernel: br0: port 2(tap0) entered forwarding state</code></pre></div><p>dmesg:</p><div class="codebox"><pre><code>[2087126.096421] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [2087140.619697] br0: port 2(tap0) entered forwarding state [2087205.484345] br0: port 2(tap0) entered disabled state [2087205.484415] device tap0 left promiscuous mode [2087205.484432] br0: port 2(tap0) entered disabled state [2087307.712013] device tap0 entered promiscuous mode [2087307.712105] br0: port 2(tap0) entered forwarding state [2087307.712113] br0: port 2(tap0) entered forwarding state [2087308.213505] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [2087322.757144] br0: port 2(tap0) entered forwarding state</code></pre></div><br /><p>Execution:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -M q35 -m 6148 -enable-kvm -cpu host -boot c -vga none -display none -monitor telnet:10.10.10.92:4441,server,nowait \ -smp 4,sockets=1,cores=2,threads=2 \ -device ahci,bus=pcie.0,id=ahci \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,x-vga=on,addr=0.0,multifunction=on,bus=root.1 \ -device vfio-pci,host=01:00.1,bus=pcie.0 \ -drive file=/dev/md1,id=dataDiskL,format=raw,if=none -device ide-hd,drive=dataDiskL \ -net nic,macaddr=52:54:00:12:34:56 -net bridge,br=br0</code></pre></div><p>running without vga=none:</p><p>dmesg:</p><div class="codebox"><pre><code>[2087884.573891] kvm: zapping shadow pages for mmio generation wraparound [2087893.724076] kvm [24007]: vcpu0 unhandled rdmsr: 0x1c9 [2087893.724565] kvm [24007]: vcpu0 unhandled rdmsr: 0x1a6 [2087893.725027] kvm [24007]: vcpu0 unhandled rdmsr: 0x1a7 [2087893.725463] kvm [24007]: vcpu0 unhandled rdmsr: 0x3f6 [2087894.981414] kvm [24007]: vcpu0 unhandled rdmsr: 0x606 [2087895.836766] br0: port 2(tap0) entered forwarding state [2087896.384502] kvm [24007]: vcpu0 unhandled rdmsr: 0x611 [2087896.384932] kvm [24007]: vcpu0 unhandled rdmsr: 0x639 [2087896.385350] kvm [24007]: vcpu0 unhandled rdmsr: 0x641 [2087896.385764] kvm [24007]: vcpu0 unhandled rdmsr: 0x619 [2087896.397773] vfio-pci 0000:01:00.1: irq 30 for MSI/MSI-X [2087896.405814] kvm [24007]: vcpu0 unhandled rdmsr: 0x611 [2087904.772580] vfio-pci 0000:01:00.0: irq 33 for MSI/MSI-X</code></pre></div> <p class="postedit"><em>Last edited by myweb (2015-01-19 18:47:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494579">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494580" class="blockpost roweven"> <h2><span><span class="conr">#3912</span> <a href="viewtopic.php?pid=1494580#p1494580">2015-01-19 18:47:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hello,</p><p>I got updated to the lates kernel and Qemu and my Linux guest could not boot wuth vga=none:</p></div></blockquote></div><p>This is a useless bug report, nothing in the provided logs indicates an error, you don&#039;t provide version of either component or details how the guest fails to boot.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494580">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494581" class="blockpost rowodd"> <h2><span><span class="conr">#3913</span> <a href="viewtopic.php?pid=1494581#p1494581">2015-01-19 18:50:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hello,</p><p>I got updated to the lates kernel and Qemu and my Linux guest could not boot wuth vga=none:</p></div></blockquote></div><p>This is a useless bug report, nothing in the provided logs indicates an error, you don&#039;t provide version of either component or details how the guest fails to boot.</p></div></blockquote></div><p>Yes, I do not see the reason in logs, monitor is without signal and Guest is not available via network.<br />Could you please specify which log I should take a look?</p><p>Without vga=none - guest booted.</p><div class="codebox"><pre><code>qemu-system-x86_64 --version QEMU emulator version 2.2.0, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><p>uname -a</p><div class="codebox"><pre><code>Linux localhost 3.18.0-1-mainline #1 SMP PREEMPT Wed Dec 10 19:09:20 FET 2014 x86_64 GNU/Linux</code></pre></div><p>qemu 2.2.0-1<br />seabios 1.7.5-2</p> <p class="postedit"><em>Last edited by myweb (2015-01-19 18:52:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494583" class="blockpost roweven"> <h2><span><span class="conr">#3914</span> <a href="viewtopic.php?pid=1494583#p1494583">2015-01-19 18:51:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I fixed the sound problem by switching the hdmi audio of my gtx 660 to use MSI.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494583">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494589" class="blockpost rowodd"> <h2><span><span class="conr">#3915</span> <a href="viewtopic.php?pid=1494589#p1494589">2015-01-19 19:01:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hello,</p><p>I got updated to the lates kernel and Qemu and my Linux guest could not boot wuth vga=none:</p></div></blockquote></div><p>This is a useless bug report, nothing in the provided logs indicates an error, you don&#039;t provide version of either component or details how the guest fails to boot.</p></div></blockquote></div><p>Yes, I do not see the reason in logs, monitor is without signal and Guest is not available via network.<br />Could you please specify which log I should take a look?</p><p>Without vga=none - guest booted.</p><div class="codebox"><pre><code>qemu-system-x86_64 --version QEMU emulator version 2.2.0, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><p>uname -a</p><div class="codebox"><pre><code>Linux localhost 3.18.0-1-mainline #1 SMP PREEMPT Wed Dec 10 19:09:20 FET 2014 x86_64 GNU/Linux</code></pre></div><p>qemu 2.2.0-1<br />seabios 1.7.5-2</p></div></blockquote></div><p>Without vga=none I am able to boot and use my Nvidia GT64 card with legacy 403 driver. But with new 346.45 I got: </p><p>nvidia-smi -q</p><div class="codebox"><pre><code>Unable to determine the device handle for GPU 0000:01:00.0: Unknown Error</code></pre></div><p>dmesg</p><div class="codebox"><pre><code>[ 11.797417] nvidia 0000:01:00.0: irq 28 for MSI/MSI-X [ 11.799246] NVRM: RmInitAdapter failed! (0x23:0x56:606) [ 11.799251] NVRM: rm_init_adapter failed for device bearing minor number 0 [ 11.799381] NVRM: nvidia_frontend_open: minor 0, module-&gt;open() failed, error -5</code></pre></div><p>Xorg</p><div class="codebox"><pre><code>[ 11.283] (**) NVIDIA(0): ConnectedMonitor string: &quot;DFP-1&quot; [ 11.285] (EE) NVIDIA(GPU-0): The NVIDIA GPU at PCI:1:0:0 is not supported by the 346.35 [ 11.285] (EE) NVIDIA(GPU-0): NVIDIA driver. [ 11.285] (EE) NVIDIA(GPU-0): Failed to initialize the NVIDIA graphics device! [ 11.285] (EE) NVIDIA(0): Failing initialization of X screen 0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494593" class="blockpost roweven"> <h2><span><span class="conr">#3916</span> <a href="viewtopic.php?pid=1494593#p1494593">2015-01-19 19:11:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87484">kainet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-22</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:bart47@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>I fixed the sound problem by switching the hdmi audio of my gtx 660 to use MSI.</p></div></blockquote></div><p>Could you please explain this. Not fully understand you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494593">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494595" class="blockpost rowodd"> <h2><span><span class="conr">#3917</span> <a href="viewtopic.php?pid=1494595#p1494595">2015-01-19 19:13:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hello,</p><p>I got updated to the lates kernel and Qemu and my Linux guest could not boot wuth vga=none:</p></div></blockquote></div><p>This is a useless bug report, nothing in the provided logs indicates an error, you don&#039;t provide version of either component or details how the guest fails to boot.</p></div></blockquote></div><p>Yes, I do not see the reason in logs, monitor is without signal and Guest is not available via network.<br />Could you please specify which log I should take a look?</p><p>Without vga=none - guest booted.</p><div class="codebox"><pre><code>qemu-system-x86_64 --version QEMU emulator version 2.2.0, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><p>uname -a</p><div class="codebox"><pre><code>Linux localhost 3.18.0-1-mainline #1 SMP PREEMPT Wed Dec 10 19:09:20 FET 2014 x86_64 GNU/Linux</code></pre></div><p>qemu 2.2.0-1<br />seabios 1.7.5-2</p></div></blockquote></div><p>Sounds like a VGA arbitration problem... if only we knew your hardware config and had some idea what the last version was that worked, someone might be able to help.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494595">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494612" class="blockpost roweven"> <h2><span><span class="conr">#3918</span> <a href="viewtopic.php?pid=1494612#p1494612">2015-01-19 20:14:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to get libvirt to boot my vm. I have it working in pure Qemu from the commandline. I&#039;m using OVMF with a 660ti.</p><p>For some reason when i boot through libvirt the nvidia driver fails (in the same way that it did before i started using OVMF, exception code 0x40000015). It doesn&#039;t crash, the GPU just doesn&#039;t seem to be passed through properly. I have no idea what&#039;s causing it, although i suspect it&#039;s not booting OVMF/EFI.</p><p>Here&#039;s my current config:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;OVMF-Gaming&lt;/name&gt; &lt;uuid&gt;523502ec-9ff4-46de-9935-6582c468dc25&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8392704&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8392704&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039;&gt;/var/lib/libvirt/images/ovmf_x64.bin&lt;/loader&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdb&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;scsi&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039; model=&#039;virtio-scsi&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:f1:a0:4b&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;sound model=&#039;ac97&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494615" class="blockpost rowodd"> <h2><span><span class="conr">#3919</span> <a href="viewtopic.php?pid=1494615#p1494615">2015-01-19 20:18:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>&#160; &#160; &lt;hyperv&gt;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;vapic state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt;<br />&#160; &#160; &lt;/hyperv&gt;</p><p>&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;</p></div></blockquote></div><p>The above lines need to be removed for nvidia</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494615">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494623" class="blockpost roweven"> <h2><span><span class="conr">#3920</span> <a href="viewtopic.php?pid=1494623#p1494623">2015-01-19 20:28:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sounds like a VGA arbitration problem... if only we knew your hardware config and had some idea what the last version was that worked, someone might be able to help.</p></div></blockquote></div><p>The last working kernel for me was 3.15<br />qemu-git-2.0.r32368.ge2da502-1-x86_64.pkg.tar.xz</p><p>My configuration:<br />i5-3470<br />AsRock Z77 pro4<br />Nvidia GT640 (01:00.0) - Arch Linux - vga=none does not work<br />ATI HD 7750 (02:00.0) - Windows 8 guest - vga=none works</p><p>Curent kernel command line:</p><div class="codebox"><pre><code>Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=b1f615cd-86ea-4c6a-ba12-b6e0e4b2f3a4 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:0fc1,10de:0e1b,1002:683f,1002:aab0 i915.enable_hd_vgaarb=1 quiet systemd.unit=multi-user.target</code></pre></div> <p class="postedit"><em>Last edited by myweb (2015-01-19 20:30:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494623">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494625" class="blockpost rowodd"> <h2><span><span class="conr">#3921</span> <a href="viewtopic.php?pid=1494625#p1494625">2015-01-19 20:31:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sounds like a VGA arbitration problem... if only we knew your hardware config and had some idea what the last version was that worked, someone might be able to help.</p></div></blockquote></div><p>The last working kernel for me was 3.15<br />qemu-git-2.0.r32368.ge2da502-1-x86_64.pkg.tar.xz</p><p>My configuration:<br />i5-3470<br />AsRock Z77 pro4<br />Nvidia GT640 (01:00.0) - Arch Linux - vga=none does not work<br />ATI HD 7750 (02:00.0) - Windows 8 guest - vga=none works</p></div></blockquote></div><p>Are you using the i5 Intel graphics for the host?&#160; Did you apply the i915 patch to your kernel?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494625">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494627" class="blockpost roweven"> <h2><span><span class="conr">#3922</span> <a href="viewtopic.php?pid=1494627#p1494627">2015-01-19 20:35:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Are you using the i5 Intel graphics for the host?&#160; Did you apply the i915 patch to your kernel?</p></div></blockquote></div><p>Yes, I am using i5 Intel graphics for the host.<br />i915_317.patch patch was used in linux-mainline-3.18.0.tar.gz (3.18.0 + acs override patch + i915 vga arbiter fixes)</p><p>I added the following kernel option:i915.enable_hd_vgaarb=1 and now I see in logs:</p><div class="codebox"><pre><code>Jan 19 23:40:56 localhost kernel: device tap1 entered promiscuous mode Jan 19 23:40:56 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:40:56 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:40:57 localhost ntpd[1641]: bind(32) AF_INET6 fe80::fc1e:56ff:fe2b:fdb2%13%13#123 flags 0x11 failed: Cannot assign requested address Jan 19 23:40:57 localhost ntpd[1641]: unable to create socket on tap1 (17) for fe80::fc1e:56ff:fe2b:fdb2%13#123 Jan 19 23:40:57 localhost ntpd[1641]: failed to init interface for address fe80::fc1e:56ff:fe2b:fdb2%13 Jan 19 23:40:57 localhost kernel: vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Jan 19 23:40:59 localhost ntpd[1641]: Listen normally on 18 tap1 [fe80::fc1e:56ff:fe2b:fdb2%13]:123 Jan 19 23:40:59 localhost ntpd[1641]: new interface(s) found: waking up resolver Jan 19 23:41:01 localhost kernel: kvm: zapping shadow pages for mmio generation wraparound Jan 19 23:41:11 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:41:13 localhost kernel: kvm_get_msr_common: 3 callbacks suppressed Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1c9 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1a6 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1a7 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x3f6 Jan 19 23:41:14 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x606 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x611 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x639 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x641 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x619 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x611 Jan 19 23:41:16 localhost kernel: vfio-pci 0000:01:00.1: irq 33 for MSI/MSI-X</code></pre></div><p>But display is still black and guest does not boot</p> <p class="postedit"><em>Last edited by myweb (2015-01-19 20:45:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494633" class="blockpost rowodd"> <h2><span><span class="conr">#3923</span> <a href="viewtopic.php?pid=1494633#p1494633">2015-01-19 20:49:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>&#160; &#160; &lt;hyperv&gt;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;vapic state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt;<br />&#160; &#160; &lt;/hyperv&gt;</p><p>&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;</p></div></blockquote></div><p>The above lines need to be removed for nvidia</p></div></blockquote></div><p>Fantastic! it&#039;s working perfectly now. Thank you.</p><p>Screw you asus, linux wasn&#039;t the problem, your shoddy IOMMU table was. If anyone still cares (after so long), the Asus P6T deluxe V2 board has a broken IOMMU bios. The fix is as easy as dumping the table, decompiling it then changing a single hex char and recompiling. Inserting it into the initramfs was a breeze since the relevant compile flag is already enabled on arch-mainline.</p><p>The functionality that enables this (boot time overriding of ACPI tables) is <a href="https://www.kernel.org/doc/Documentation/acpi/initrd_table_override.txt" rel="nofollow">https://www.kernel.org/doc/Documentatio … erride.txt</a><br />The only problem with it is that i have to run my injection script every time i run mkinitcpio, but that&#039;s a small price to pay.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494633">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494636" class="blockpost roweven"> <h2><span><span class="conr">#3924</span> <a href="viewtopic.php?pid=1494636#p1494636">2015-01-19 20:58:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Are you using the i5 Intel graphics for the host?&#160; Did you apply the i915 patch to your kernel?</p></div></blockquote></div><p>Yes, I am using i5 Intel graphics for the host.<br />i915_317.patch patch was used in linux-mainline-3.18.0.tar.gz (3.18.0 + acs override patch + i915 vga arbiter fixes)</p><p>I added the following kernel option:i915.enable_hd_vgaarb=1 and now I see in logs:</p><div class="codebox"><pre><code>Jan 19 23:40:56 localhost kernel: device tap1 entered promiscuous mode Jan 19 23:40:56 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:40:56 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:40:57 localhost ntpd[1641]: bind(32) AF_INET6 fe80::fc1e:56ff:fe2b:fdb2%13%13#123 flags 0x11 failed: Cannot assign requested address Jan 19 23:40:57 localhost ntpd[1641]: unable to create socket on tap1 (17) for fe80::fc1e:56ff:fe2b:fdb2%13#123 Jan 19 23:40:57 localhost ntpd[1641]: failed to init interface for address fe80::fc1e:56ff:fe2b:fdb2%13 Jan 19 23:40:57 localhost kernel: vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Jan 19 23:40:59 localhost ntpd[1641]: Listen normally on 18 tap1 [fe80::fc1e:56ff:fe2b:fdb2%13]:123 Jan 19 23:40:59 localhost ntpd[1641]: new interface(s) found: waking up resolver Jan 19 23:41:01 localhost kernel: kvm: zapping shadow pages for mmio generation wraparound Jan 19 23:41:11 localhost kernel: br0: port 3(tap1) entered forwarding state Jan 19 23:41:13 localhost kernel: kvm_get_msr_common: 3 callbacks suppressed Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1c9 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1a6 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x1a7 Jan 19 23:41:13 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x3f6 Jan 19 23:41:14 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x606 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x611 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x639 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x641 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x619 Jan 19 23:41:16 localhost kernel: kvm [13684]: vcpu0 unhandled rdmsr: 0x611 Jan 19 23:41:16 localhost kernel: vfio-pci 0000:01:00.1: irq 33 for MSI/MSI-X</code></pre></div><p>But display is still black and guest does not boot</p></div></blockquote></div><p>I added i915 module to black list and now I see the following information in dmesg:</p><div class="codebox"><pre><code>[ 41.665779] br0: port 2(tap0) entered forwarding state [ 41.665790] br0: port 2(tap0) entered forwarding state [ 42.167464] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 42.167597] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 42.171227] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002) [ 45.893325] kvm: zapping shadow pages for mmio generation wraparound [ 56.689435] br0: port 2(tap0) entered forwarding state [ 57.805957] kvm [1248]: vcpu0 unhandled rdmsr: 0x1c9 [ 57.807847] kvm [1248]: vcpu0 unhandled rdmsr: 0x1a6 [ 57.809960] kvm [1248]: vcpu0 unhandled rdmsr: 0x1a7 [ 57.812242] kvm [1248]: vcpu0 unhandled rdmsr: 0x3f6 [ 58.991381] kvm [1248]: vcpu0 unhandled rdmsr: 0x606 [ 60.451997] kvm [1248]: vcpu0 unhandled rdmsr: 0x611 [ 60.453933] kvm [1248]: vcpu0 unhandled rdmsr: 0x639 [ 60.455845] kvm [1248]: vcpu0 unhandled rdmsr: 0x641 [ 60.457879] kvm [1248]: vcpu0 unhandled rdmsr: 0x619 [ 60.740637] vfio-pci 0000:01:00.1: irq 31 for MSI/MSI-X [ 74.566563] saa7146: interrupt_hw: warning: interrupt enabled, but not handled properly.(0xe7fcfbff) [ 74.569760] saa7146: interrupt_hw: disabling interrupt source(s)! [ 100.167145] saa7146: saa7146 (0): unexpected i2c irq: isr e7fffbff psr 00040420 ssr 00810000 [ 100.167149] saa7146: interrupt_hw: warning: interrupt enabled, but not handled properly.(0xe7fcfbff) [ 100.171143] saa7146: interrupt_hw: disabling interrupt source(s)! [ 118.367566] saa7146: saa7146 (0): unexpected i2c irq: isr e7fffbff psr 00040420 ssr 00810000 [ 118.367570] saa7146: interrupt_hw: warning: interrupt enabled, but not handled properly.(0xe7fcfbff) [ 118.371014] saa7146: interrupt_hw: disabling interrupt source(s)!</code></pre></div><p>old nvidia driver without vga=none works fine:<br />nvidia-smi -q</p><div class="codebox"><pre class="vscroll"><code>==============NVSMI LOG============== Timestamp : Tue Jan 20 00:15:22 2015 Driver Version : 304.125 Attached GPUs : 1 GPU 0000:01:00.0 Product Name : GeForce GT 640 Display Mode : N/A Persistence Mode : Disabled Driver Model Current : N/A Pending : N/A Serial Number : N/A GPU UUID : GPU-ae36e4e0-8e34-e7d2-e571-159b9bfe3020 VBIOS Version : 80.07.26.00.5B Inforom Version Image Version : N/A OEM Object : N/A ECC Object : N/A Power Management Object : N/A GPU Operation Mode Current : N/A Pending : N/A PCI Bus : 0x01 Device : 0x00 Domain : 0x0000 Device Id : 0x0FC110DE Bus Id : 0000:01:00.0 Sub System Id : 0x840E1043 GPU Link Info PCIe Generation Max : N/A Current : N/A Link Width Max : N/A Current : N/A Fan Speed : 37 % Performance State : N/A Clocks Throttle Reasons : N/A Memory Usage Total : 1023 MB Used : 77 MB Free : 946 MB Compute Mode : Default Utilization Gpu : N/A Memory : N/A Ecc Mode Current : N/A Pending : N/A ECC Errors Volatile Single Bit Device Memory : N/A Register File : N/A L1 Cache : N/A L2 Cache : N/A Texture Memory : N/A Total : N/A Double Bit Device Memory : N/A Register File : N/A L1 Cache : N/A L2 Cache : N/A Texture Memory : N/A Total : N/A Aggregate Single Bit Device Memory : N/A Register File : N/A L1 Cache : N/A L2 Cache : N/A Texture Memory : N/A Total : N/A Double Bit Device Memory : N/A Register File : N/A L1 Cache : N/A L2 Cache : N/A Texture Memory : N/A Total : N/A Temperature Gpu : 44 C Power Readings Power Management : N/A Power Draw : N/A Power Limit : N/A Default Power Limit : N/A Min Power Limit : N/A Max Power Limit : N/A Clocks Graphics : N/A SM : N/A Memory : N/A Applications Clocks Graphics : N/A Memory : N/A Max Clocks Graphics : N/A SM : N/A Memory : N/A Compute Processes : N/A</code></pre></div> <p class="postedit"><em>Last edited by myweb (2015-01-19 21:20:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494636">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1494639" class="blockpost rowodd"> <h2><span><span class="conr">#3925</span> <a href="viewtopic.php?pid=1494639#p1494639">2015-01-19 21:07:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Am i right in assuming i can&#039;t enable Spice at all on nividia passthrough? I&#039;d love to hotplug usb devices to the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1494639">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=156">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <a href="viewtopic.php?id=162768&amp;p=156">156</a> <strong>157</strong> <a href="viewtopic.php?id=162768&amp;p=158">158</a> <a href="viewtopic.php?id=162768&amp;p=159">159</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=158">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
