<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 89) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=89" title="Page 89" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=88" title="Page 88" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=90" title="Page 90" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=88">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=87">87</a> <a href="viewtopic.php?id=162768&amp;p=88">88</a> <strong>89</strong> <a href="viewtopic.php?id=162768&amp;p=90">90</a> <a href="viewtopic.php?id=162768&amp;p=91">91</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=90">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1429746" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2201</span> <a href="viewtopic.php?pid=1429746#p1429746">2014-06-24 22:01:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82966">mdm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-22</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does the nosnoop patch still need to be applied to qemu.git?&#160; I have check and my Nvidia card does have NoSnoop+.&#160; I applied this patch <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a>, but now get the follow errors:</p><div class="codebox"><pre><code>[ 8055.445808] vfio-pci 0000:01:00.0: enabling device (0006 -&gt; 0007) [ 8056.454042] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 8056.713926] qemu-system-x86[7317]: segfault at 4 ip 00007f27870719b0 sp 00007fff40d8ca38 error 4 in libc-2.19.so[7f2786f3c000+1a4000]</code></pre></div><p>Qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 \ -cpu host,hv-time,kvm=off -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga vmware \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk</code></pre></div><p>Without the patch, I am able to get into Windows 8 but receive error 43.</p> <p class="postedit"><em>Last edited by mdm (2014-06-24 22:08:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1429746">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1429762" class="blockpost roweven"> <h2><span><span class="conr">#2202</span> <a href="viewtopic.php?pid=1429762#p1429762">2014-06-24 23:14:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mdm wrote:</cite><blockquote><div><p>Does the nosnoop patch still need to be applied to qemu.git?&#160; I have check and my Nvidia card does have NoSnoop+.&#160; I applied this patch <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a>, but now get the follow errors:</p><div class="codebox"><pre><code>[ 8055.445808] vfio-pci 0000:01:00.0: enabling device (0006 -&gt; 0007) [ 8056.454042] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 8056.713926] qemu-system-x86[7317]: segfault at 4 ip 00007f27870719b0 sp 00007fff40d8ca38 error 4 in libc-2.19.so[7f2786f3c000+1a4000]</code></pre></div><p>Qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 \ -cpu host,hv-time,kvm=off -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga vmware \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk</code></pre></div><p>Without the patch, I am able to get into Windows 8 but receive error 43.</p></div></blockquote></div><p>No, the nosnoop patch is defunct.&#160; It was never going to be a reliable solution.&#160; Since you&#039;re already using kvm=off, I don&#039;t know what&#039;s wrong.&#160; Is anyone running Windows 8 successfully with NVIDIA?&#160; TBH, I&#039;ve almost exclusively tested Windows 7.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1429762">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1429771" class="blockpost rowodd"> <h2><span><span class="conr">#2203</span> <a href="viewtopic.php?pid=1429771#p1429771">2014-06-24 23:44:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mdm wrote:</cite><blockquote><div><p>Does the nosnoop patch still need to be applied to qemu.git?&#160; I have check and my Nvidia card does have NoSnoop+.&#160; I applied this patch <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a>, but now get the follow errors:</p><div class="codebox"><pre><code>[ 8055.445808] vfio-pci 0000:01:00.0: enabling device (0006 -&gt; 0007) [ 8056.454042] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 8056.713926] qemu-system-x86[7317]: segfault at 4 ip 00007f27870719b0 sp 00007fff40d8ca38 error 4 in libc-2.19.so[7f2786f3c000+1a4000]</code></pre></div><p>Qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 \ -cpu host,hv-time,kvm=off -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga vmware \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk</code></pre></div><p>Without the patch, I am able to get into Windows 8 but receive error 43.</p></div></blockquote></div><p>No, the nosnoop patch is defunct.&#160; It was never going to be a reliable solution.&#160; Since you&#039;re already using kvm=off, I don&#039;t know what&#039;s wrong.&#160; Is anyone running Windows 8 successfully with NVIDIA?&#160; TBH, I&#039;ve almost exclusively tested Windows 7.</p></div></blockquote></div><p>I had my GTS450 running under Windows 8.1, with 335.xx driver tho.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1429771">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1429787" class="blockpost roweven"> <h2><span><span class="conr">#2204</span> <a href="viewtopic.php?pid=1429787#p1429787">2014-06-25 01:04:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Enabling intel&#039;s DMA remapping in the kernel/cmdline is breaking my nvidia&#039;s vdpau on an Intel/Nvidia setup (as I state in <a href="https://bbs.archlinux.org/viewtopic.php?pid=1426889" rel="nofollow">this thread</a>) I assume either vdpau or the DMA Remapping code need some patch for this.</p><p>Where can I get help with this?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1429787">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1429788" class="blockpost rowodd"> <h2><span><span class="conr">#2205</span> <a href="viewtopic.php?pid=1429788#p1429788">2014-06-25 01:08:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82966">mdm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-22</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>belliash wrote:</cite><blockquote><div><div class="quotebox"><cite>mdm wrote:</cite><blockquote><div><p>I have been working through getting this setup on my laptop.&#160; I am at the point now where I just get a black screen when booting up my virtual machine.&#160; Here are my laptop specs:</p><p>Sager np8250<br />CPU: i7-4800MQ w/ HD 4600<br />MB Chipset: HM87<br />GPU: GTX 780M using Optimus</p><p>Before I get into more troubleshooting, is it possible to even use the GTX 780M with the pass through since it is on a laptop with Optimus?</p></div></blockquote></div><p>Install Windows (8 preferrably) using additional emulated VGA like currus or vmware. Then install nvidia drivers and check if it will be working, or if you get error 43.<br />If you got error 43, check if disabling and re-enablig nvidia card helps.</p></div></blockquote></div><p>I was able to get Windows 8.1 to recognize the nvidia card with the latest drivers by disabling and then renabling, but I can&#039;t get Windows to use the Nvidia card.&#160; I also cannot get the Nvidia control panel to open.&#160; I may just be stuck since the Optimus Nvidia card doesn&#039;t have anything to write out to.&#160; If I use -vga none, a window opens but it is a qemu command prompt.</p><p>Grub:</p><div class="codebox"><pre><code>linux/vmlinuz-linux-mainline root=UUID=662044e6-2035-46dc-8300-6e205fc39365 rw pci-stub.ids=10de:119f intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 i915.enable_hd_vgaarb=1 kvm.ignore_msrs=1 quiet</code></pre></div><p>&#160; <br />Qemu:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 \ -cpu host,hv-time,kvm=off -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1429788">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430005" class="blockpost roweven"> <h2><span><span class="conr">#2206</span> <a href="viewtopic.php?pid=1430005#p1430005">2014-06-25 17:52:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81541">belliash</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-25</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:belliash@asiotec.eu.org">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mdm wrote:</cite><blockquote><div><div class="quotebox"><cite>belliash wrote:</cite><blockquote><div><div class="quotebox"><cite>mdm wrote:</cite><blockquote><div><p>I have been working through getting this setup on my laptop.&#160; I am at the point now where I just get a black screen when booting up my virtual machine.&#160; Here are my laptop specs:</p><p>Sager np8250<br />CPU: i7-4800MQ w/ HD 4600<br />MB Chipset: HM87<br />GPU: GTX 780M using Optimus</p><p>Before I get into more troubleshooting, is it possible to even use the GTX 780M with the pass through since it is on a laptop with Optimus?</p></div></blockquote></div><p>Install Windows (8 preferrably) using additional emulated VGA like currus or vmware. Then install nvidia drivers and check if it will be working, or if you get error 43.<br />If you got error 43, check if disabling and re-enablig nvidia card helps.</p></div></blockquote></div><p>I was able to get Windows 8.1 to recognize the nvidia card with the latest drivers by disabling and then renabling, but I can&#039;t get Windows to use the Nvidia card.&#160; I also cannot get the Nvidia control panel to open.&#160; I may just be stuck since the Optimus Nvidia card doesn&#039;t have anything to write out to.&#160; If I use -vga none, a window opens but it is a qemu command prompt.</p><p>Grub:</p><div class="codebox"><pre><code>linux/vmlinuz-linux-mainline root=UUID=662044e6-2035-46dc-8300-6e205fc39365 rw pci-stub.ids=10de:119f intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 i915.enable_hd_vgaarb=1 kvm.ignore_msrs=1 quiet</code></pre></div><p>&#160; <br />Qemu:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 \ -cpu host,hv-time,kvm=off -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk</code></pre></div></div></blockquote></div><p>No, it opens console because it shows it when there is no emulated card enabled.<br />You can also disable that console. There is described the same, or nearly the same problem with desktop nvidia GTX 7X0, so i think its not related to notebook and/or optimus. Optimus is a software solution.<br />I think our cards can have EFI instead of BIOS or sth... I&#039;m not sure about that. But this problem was albo observed on desktop version of nvidia cards. Thats why Im waiting &#039;till anyone will try to pass through mobile radeon...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430005">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430304" class="blockpost rowodd"> <h2><span><span class="conr">#2207</span> <a href="viewtopic.php?pid=1430304#p1430304">2014-06-26 13:30:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=17456">FruitieX</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2008-07-03</span></dd> <dd><span>Posts: 18</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=17456">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey, just wanted to post a short success story and thank anyone who is involved with making VGA passthrough possible.</p><p>I carefully picked my PC parts to support VGA passthrough, and since building the PC about 4 months ago I&#039;ve yet to find a game that can&#039;t run well on maxed out settings inside a freaking virtual machine! I don&#039;t even have a bare metal Windows install to compare performance with because I never felt the need for that. This is a really amazing accomplishment and in my opinion one of the most amazing things I&#039;ve been able to do on a computer! :-)</p><p>So again thank you and best of luck for anyone trying to set up VGA passthrough!</p><p>Fancy scripts for automatic USB passthrough once a Windows guest has finished booting if anyone is interested: <a href="https://github.com/FruitieX/vm-scripts/tree/master/scripts" rel="nofollow">https://github.com/FruitieX/vm-scripts/ … er/scripts</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430304">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430334" class="blockpost roweven"> <h2><span><span class="conr">#2208</span> <a href="viewtopic.php?pid=1430334#p1430334">2014-06-26 14:56:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Cool,</p><p>I hope I will get this working on my machine too <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Some weeks ago I had an i5 2500K and was a little bit frustrated to hear that this CPU does not support IOMMU. After a little bit of searching around in ebay I got an i5 3470 which supports IOMMU but I have no luck getting it to work.</p><p>I set up the vfio-bind and pci-stub stuff but every time I want to launch I get the following:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on</code></pre></div><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>the last line makes me wonder a little bit ... why enabling ?</p><div class="codebox"><pre><code>[pheinrich@ARCH tmp]$ dmesg | grep pci-stub [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0140 quiet [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0140 quiet [ 0.691337] pci-stub: add 10DE:0140 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.691352] pci-stub 0000:02:00.0: claimed by stub [ 1.872554] pci-stub 0000:02:00.0: enabling device (0000 -&gt; 0002)</code></pre></div><div class="codebox"><pre><code>[pheinrich@ARCH tmp]$ dmesg | grep IOMMU [ 0.000000] Intel-IOMMU: enabled [ 0.114583] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c9008020660262 ecap f0105a [ 0.114654] IOAPIC id 2 under DRHD base 0xfed90000 IOMMU 0 [ 0.619324] IOMMU 0 0xfed90000: using Queued invalidation [ 0.619326] IOMMU: Setting RMRR: [ 0.619335] IOMMU: Setting identity map for device 0000:00:1a.0 [0xcf0d5000 - 0xcf0e3fff] [ 0.619354] IOMMU: Setting identity map for device 0000:00:1d.0 [0xcf0d5000 - 0xcf0e3fff] [ 0.619362] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.619368] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] </code></pre></div><div class="codebox"><pre><code>[pheinrich@ARCH tmp]$ ls /dev/vfio/ 1 vfio </code></pre></div><p>I want to passthrough the geforce 6600GT</p><div class="codebox"><pre><code>[pheinrich@ARCH tmp]$ lspci | grep VGA 01:00.0 VGA compatible controller: NVIDIA Corporation GT200 [GeForce GTX 260] (rev a1) 02:00.0 VGA compatible controller: NVIDIA Corporation NV43 [GeForce 6600 GT] (rev a2) </code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430339" class="blockpost rowodd"> <h2><span><span class="conr">#2209</span> <a href="viewtopic.php?pid=1430339#p1430339">2014-06-26 15:15:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58169">aldum</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/58169.jpg?m=1401983659" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-03-14</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58169">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>I want to passthrough the geforce 6600GT</p><div class="codebox"><pre><code>[pheinrich@ARCH tmp]$ lspci | grep VGA 01:00.0 VGA compatible controller: NVIDIA Corporation GT200 [GeForce GTX 260] (rev a1) 02:00.0 VGA compatible controller: NVIDIA Corporation NV43 [GeForce 6600 GT] (rev a2) </code></pre></div></div></blockquote></div><p>Okay, you can&#039;t do that. The 6600 GT (or any pre 7xxx card AFAWK) is not capable.<br />(I should know, I too wasted a week trying to get it work)<br />Try exchanging them, the 260 will work better for passthrough.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430339">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430342" class="blockpost roweven"> <h2><span><span class="conr">#2210</span> <a href="viewtopic.php?pid=1430342#p1430342">2014-06-26 15:37:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>Cool,</p><p>I hope I will get this working on my machine too <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Some weeks ago I had an i5 2500K and was a little bit frustrated to hear that this CPU does not support IOMMU. After a little bit of searching around in ebay I got an i5 3470 which supports IOMMU but I have no luck getting it to work.</p><p>I set up the vfio-bind and pci-stub stuff but every time I want to launch I get the following:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on</code></pre></div><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div></div></blockquote></div><p>You don&#039;t need vfio_iommu_type1.allow_unsafe_interrupts=1, but that&#039;s not the problem here.</p><p>Look at:</p><div class="codebox"><pre><code>ls -l /sys/bus/pci/devices/0000\:02\:00.0/iommu_group/devices/</code></pre></div><p>All of the <strong>endpoints</strong> listed there need to be attached to either vfio-pci or pci-stub.&#160; If you can&#039;t make that happen, then you need to apply and enable the ACS override patch.&#160; And then as aldum wrote, a 6600GT is pretty old, if it doesn&#039;t work already I don&#039;t think there&#039;s any point in adding code to trying to support it.&#160; If you want a cheap Nvidia card, go grab a GT 635 off ebay.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430342">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430396" class="blockpost rowodd"> <h2><span><span class="conr">#2211</span> <a href="viewtopic.php?pid=1430396#p1430396">2014-06-26 18:53:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok i found this:</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ ls -l /sys/bus/pci/devices/0000\:02\:00.0/iommu_group/devices/ total 0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:00:01.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:00:01.1 -&gt; ../../../../devices/pci0000:00/0000:00:01.1 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:01:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:02:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0</code></pre></div><p>but the third line is my GTX&#160; 0000:01:00.0 or am I wrong?</p><p>whould be an 7950GT better than my old 6600GT ?</p><p>Trying to passthrough the GTX 260 is a problem because the current nvidia driver does not support the GT 6600 anymore so I have to install the old nvidia driver to support the GT 6600 as host gpu</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430396">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430401" class="blockpost roweven"> <h2><span><span class="conr">#2212</span> <a href="viewtopic.php?pid=1430401#p1430401">2014-06-26 19:03:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81541">belliash</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-25</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:belliash@asiotec.eu.org">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>you dont need any drivers on host. only on guest</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430401">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430402" class="blockpost rowodd"> <h2><span><span class="conr">#2213</span> <a href="viewtopic.php?pid=1430402#p1430402">2014-06-26 19:05:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>ok i found this:</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ ls -l /sys/bus/pci/devices/0000\:02\:00.0/iommu_group/devices/ total 0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:00:01.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:00:01.1 -&gt; ../../../../devices/pci0000:00/0000:00:01.1 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:01:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0 lrwxrwxrwx 1 root root 0 Jun 26 20:48 0000:02:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0</code></pre></div><p>but the third line is my GTX&#160; 0000:01:00.0 or am I wrong?</p></div></blockquote></div><p>That&#039;s correct, Intel consumer processors don&#039;t support ACS on the PEG root ports and Intel has not been able to confirm that isolation is provided between root ports.&#160; You&#039;ll need the ACS override patch if you want the kernel to accept them as isolated.</p><div class="quotebox"><blockquote><div><p>whould be an 7950GT better than my old 6600GT ?</p></div></blockquote></div><p>A slightly newer ancient card?&#160; Probably not.&#160; I&#039;ve tested a 7300LE and it doesn&#039;t work very well.&#160; My 8400GS works ok though, so 8-series might be the oldest I&#039;d bother trying.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430402">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430425" class="blockpost roweven"> <h2><span><span class="conr">#2214</span> <a href="viewtopic.php?pid=1430425#p1430425">2014-06-26 20:06:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok thank you for your answer.</p><p>now I took the 6600GT as my primary host card and blocked the GTX 260 via pci-stub to use it with qemu.</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>same result as above ... so now I will try the ACS patch <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>maybe my ASUS P8P67 evo is the faulty part <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430425">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430427" class="blockpost rowodd"> <h2><span><span class="conr">#2215</span> <a href="viewtopic.php?pid=1430427#p1430427">2014-06-26 20:13:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>ok thank you for your answer.</p><p>now I took the 6600GT as my primary host card and blocked the GTX 260 via pci-stub to use it with qemu.</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 1 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>same result as above ... so now I will try the ACS patch <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>maybe my ASUS P8P67 evo is the faulty part <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>Why would you expect it to be any different?&#160; Swapping the two cards between the same two slots won&#039;t change the group.&#160; Your motherboard has 3 x16 slots, installing one graphics card into the bottom black slot should put it into a separate IOMMU group if you&#039;re running a v3.15 kernel.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430427">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430430" class="blockpost roweven"> <h2><span><span class="conr">#2216</span> <a href="viewtopic.php?pid=1430430#p1430430">2014-06-26 20:17:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>yes but i wasn&#039;t able to get anything on my screen from my 6600GT plugged into the second slot.</p><p>Then I plugged it into the first slot and blocked the GTX 260 plugged into the second slot.<br />I thought it would work trying to passthrough the newer card <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Now I am trying to patch a 3.15.1 kernel with the ACS patch provided in the first post.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430430">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430480" class="blockpost rowodd"> <h2><span><span class="conr">#2217</span> <a href="viewtopic.php?pid=1430480#p1430480">2014-06-27 00:41:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, I managed to passthrough the 8500GT Nvidia card, yet got error 43 or 42, can&#039;t remember, I will try to fix it later ( how to pass kvm off in virt-manager?)</p><p>Now, with the AMD HD 4760 card ( 4xxx HD series ), I managed to pass it through, but after installing the drivers and rebooting windows, it just would hang at the start screen (logo).<br />The HD 4 series card is very old, yet it got some power, so I&#039;m asking, is the problem from the card or the driver? does this happen often with AMD cards ?<br />I got some other entry series AMD card (6 series) that I&#039;m looking to test it just to see the results ( and share it with you ), and then, I would buy a newer card, I&#039;m looking at Asus r9 280x OC, so what&#039;s your recommendation about it?</p><p>The other thing I&#039;m looking to do, is to create 2 PC&#039;s back2back, each one with it&#039;s own passedthrough keyboard and mouse, the problem I&#039;m facing is I could not manage to get any VGA output from the cards to the second screen ?.<br />Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430480">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430492" class="blockpost roweven"> <h2><span><span class="conr">#2218</span> <a href="viewtopic.php?pid=1430492#p1430492">2014-06-27 01:37:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone figured out how to get audio to work with libvirt? I&#039;ve got everything <em>except</em> audio working right now. I&#039;m thinking about using a different program to stream the audio from the guest to my host, but I wasn&#039;t sure how others were handling this.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430492">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430573" class="blockpost rowodd"> <h2><span><span class="conr">#2219</span> <a href="viewtopic.php?pid=1430573#p1430573">2014-06-27 10:35:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Slabity wrote:</cite><blockquote><div><p>Has anyone figured out how to get audio to work with libvirt? I&#039;ve got everything <em>except</em> audio working right now. I&#039;m thinking about using a different program to stream the audio from the guest to my host, but I wasn&#039;t sure how others were handling this.</p></div></blockquote></div><p>Try global pulseaudio, cheap USB audio card or passthru host&#039;s HD audio.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430573">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430623" class="blockpost roweven"> <h2><span><span class="conr">#2220</span> <a href="viewtopic.php?pid=1430623#p1430623">2014-06-27 14:03:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>Slabity wrote:</cite><blockquote><div><p>Has anyone figured out how to get audio to work with libvirt? I&#039;ve got everything <em>except</em> audio working right now. I&#039;m thinking about using a different program to stream the audio from the guest to my host, but I wasn&#039;t sure how others were handling this.</p></div></blockquote></div><p>Try global pulseaudio, cheap USB audio card or passthru host&#039;s HD audio.</p></div></blockquote></div><p>Or try pulseaudio over network (127.0.0.1). That&#039;s what I do.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430623">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430657" class="blockpost rowodd"> <h2><span><span class="conr">#2221</span> <a href="viewtopic.php?pid=1430657#p1430657">2014-06-27 15:40:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83118">random_user9547</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-27</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I have tried VGA-Passthrough on my system but it fails.</p><p>My specifications are:<br />Motherboard: gigabyte ga 970 UD3<br />CPU: AMD FX 6300<br />VGA1: AMD HD 7790 on 01:00.0 01:00.01<br />VGA2: AMD HD 6450 on 06:00.0 06:00.01</p><p>The host OS uses HD 6450, I am trying to pass HD 7790 to a guest OS.</p><p>Qemu version:<br />qemu-x86_64 version 2.0.0, Copyright (c) 2003-2008 Fabrice Bellard</p><p>kernel version:<br />3.14.1-3-mainline #1 SMP PREEMPT (the one nbhs posted)</p><p>Added this to grub:<br />vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1002:665c,1002:0002</p><p>binded the devices.</p><p>And got the Seabios output on the screen.</p><p>But after attachin something bootable to qemu, like this:<br />-drive file=/home/nbhs/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd</p><p>I get:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: VFIO 0000:01:00.0 BAR 0 mmap unsupported. Performance may be slow<br />qemu-system-x86_64: vfio_bar_write(,0x0, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x4, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x8, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0xc, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x10, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x14, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x18, 0x0, 4) failed: Device or resource busy<br />...</p><p>and a load of vfio_bar_write fails.</p><p>Any idea how to solve this one?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430657">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430679" class="blockpost roweven"> <h2><span><span class="conr">#2222</span> <a href="viewtopic.php?pid=1430679#p1430679">2014-06-27 16:48:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>Or try pulseaudio over network (127.0.0.1). That&#039;s what I do.</p></div></blockquote></div><p>What&#039;s your method of doing this?</p> <p class="postedit"><em>Last edited by Slabity (2014-06-27 20:27:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430679">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430709" class="blockpost rowodd"> <h2><span><span class="conr">#2223</span> <a href="viewtopic.php?pid=1430709#p1430709">2014-06-27 17:59:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>random_user9547 wrote:</cite><blockquote><div><p>Hello,</p><p>I have tried VGA-Passthrough on my system but it fails.</p><p>My specifications are:<br />Motherboard: gigabyte ga 970 UD3<br />CPU: AMD FX 6300<br />VGA1: AMD HD 7790 on 01:00.0 01:00.01<br />VGA2: AMD HD 6450 on 06:00.0 06:00.01</p><p>The host OS uses HD 6450, I am trying to pass HD 7790 to a guest OS.</p><p>Qemu version:<br />qemu-x86_64 version 2.0.0, Copyright (c) 2003-2008 Fabrice Bellard</p><p>kernel version:<br />3.14.1-3-mainline #1 SMP PREEMPT (the one nbhs posted)</p><p>Added this to grub:<br />vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1002:665c,1002:0002</p><p>binded the devices.</p><p>And got the Seabios output on the screen.</p><p>But after attachin something bootable to qemu, like this:<br />-drive file=/home/nbhs/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd</p><p>I get:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: VFIO 0000:01:00.0 BAR 0 mmap unsupported. Performance may be slow<br />qemu-system-x86_64: vfio_bar_write(,0x0, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x4, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x8, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0xc, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x10, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x14, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x18, 0x0, 4) failed: Device or resource busy<br />...</p><p>and a load of vfio_bar_write fails.</p><p>Any idea how to solve this one?</p></div></blockquote></div><p>how about reading the topic first?..</p><p>installations are usually performed with qemu-emulated video, passthrough should be enabled on already installed os - this way it&#039;s easier to see what is wrong</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430709">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430715" class="blockpost roweven"> <h2><span><span class="conr">#2224</span> <a href="viewtopic.php?pid=1430715#p1430715">2014-06-27 18:25:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83118">random_user9547</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-27</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>how about reading the topic first?..</p><p>installations are usually performed with qemu-emulated video, passthrough should be enabled on already installed os - this way it&#039;s easier to see what is wrong</p></div></blockquote></div><p>It actually does not matter.<br />Even if I first install an OS(can be windows or linux) and later try to start it with a dedicated GPU i get the same error.</p><p>It seems to happen when qemu goes beyond seabios(starts anything graphical).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1430722" class="blockpost rowodd"> <h2><span><span class="conr">#2225</span> <a href="viewtopic.php?pid=1430722#p1430722">2014-06-27 18:57:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>random_user9547 wrote:</cite><blockquote><div><p>It actually does not matter.<br />Even if I first install an OS(can be windows or linux) and later try to start it with a dedicated GPU i get the same error.</p><p>It seems to happen when qemu goes beyond seabios(starts anything graphical).</p></div></blockquote></div><p>Could you post the result of `lspci -v`? The section related to your graphics card.</p> <p class="postedit"><em>Last edited by Slabity (2014-06-27 18:58:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1430722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=88">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=87">87</a> <a href="viewtopic.php?id=162768&amp;p=88">88</a> <strong>89</strong> <a href="viewtopic.php?id=162768&amp;p=90">90</a> <a href="viewtopic.php?id=162768&amp;p=91">91</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=90">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
