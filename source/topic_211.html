<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 211) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=211" title="Page 211" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=210" title="Page 210" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=212" title="Page 212" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=210">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <a href="viewtopic.php?id=162768&amp;p=210">210</a> <strong>211</strong> <a href="viewtopic.php?id=162768&amp;p=212">212</a> <a href="viewtopic.php?id=162768&amp;p=213">213</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=212">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1534070" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5251</span> <a href="viewtopic.php?pid=1534070#p1534070">2015-06-03 13:57:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91627">goeo_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-03</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:me@goeo.pink">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi. I&#039;m trying to do this, but I keep getting a code 43 error. </p><p>I have a laptop with an intel i7 4900mq cpu and a nvidia gtx 770m gpu. I&#039;m assigning the nvidia gpu to the vm (running windows 8.1) and using the igpu (intel hd 4600) on the host. Here&#039;s my vm&#039;s xml file:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;goeosvm&lt;/name&gt; &lt;uuid&gt;fb039381-3dbf-4bb6-b8cd-83a602b141db&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;8&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.3&#039;&gt;hvm&lt;/type&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;2&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;utc&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdb4&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/goeosvm.img&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:3a:8b:fc&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039; listen=&#039;127.0.0.1&#039; keymap=&#039;tr&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;127.0.0.1&#039;/&gt; &lt;image compression=&#039;off&#039;/&gt; &lt;/graphics&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;cirrus&#039; vram=&#039;16384&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;rom bar=&#039;on&#039; file=&#039;/home/goeo_/Documents/MSI.GTX770M.3072.130324.rom&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>What am I doing wrong?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534070">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534073" class="blockpost roweven"> <h2><span><span class="conr">#5252</span> <a href="viewtopic.php?pid=1534073#p1534073">2015-06-03 14:09:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>noctlos wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>In order to assign a PCI device to a VM, all of the guest memory needs to be pinned (ie. locked) into host memory and mapped through the IOMMU.&#160; A normal user only has the ability to lock 64KB of memory (see <em>ulimit</em>).&#160; Your VM is probably bigger than that, therefore you need to increase the locked memory limit for the user to run the VM.</p></div></blockquote></div><p>Thanks for the tip! How do I increase the locked memory limit?</p></div></blockquote></div><p>/etc/security/limits.d/ (see limits.conf it the parent directory)</p></div></blockquote></div><p>I created a file at /etc/security/limits.d/50-qemu.conf</p><div class="codebox"><pre><code>@domain hard as 10000000</code></pre></div><p>I also did the following:</p><div class="codebox"><pre><code>#chown noctlos:noctlos /dev/vfio/15 #chmod 666 /dev/vfio/vfio #chown -R noctlos:noctlos /dev/hugepages</code></pre></div><p>unfortunately, when I go to run qemu, it again gives me:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=03:00.0: vfio_dma_map(0x7f69d1c20890, 0x0, 0x80000000, 0x7f6718000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0: vfio_dma_map(0x7f69d1c20890, 0x100000000, 0x200000000, 0x7f6798000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=03:00.0: vfio: failed to setup container for group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=03:00.0: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>And for reference:</p><div class="codebox"><pre><code>% ulimit -a :( -t: cpu time (seconds) unlimited -f: file size (blocks) unlimited -d: data seg size (kbytes) unlimited -s: stack size (kbytes) 8192 -c: core file size (blocks) unlimited -m: resident set size (kbytes) unlimited -u: processes 63576 -n: file descriptors 4096 -l: locked-in-memory size (kbytes) 64 -v: address space (kbytes) unlimited -x: file locks unlimited -i: pending signals 63576 -q: bytes in POSIX msg queues 819200 -e: max nice 20 -r: max rt priority 0 -N 15: unlimited</code></pre></div> <p class="postedit"><em>Last edited by noctlos (2015-06-03 14:10:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534073">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534074" class="blockpost rowodd"> <h2><span><span class="conr">#5253</span> <a href="viewtopic.php?pid=1534074#p1534074">2015-06-03 14:16:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@noctlos</p><p>You&#039;re not setting the locked memory limit</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534074">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534075" class="blockpost roweven"> <h2><span><span class="conr">#5254</span> <a href="viewtopic.php?pid=1534075#p1534075">2015-06-03 14:18:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@goeo_</p><p>You&#039;re expecting discrete graphics in a laptop to behave the same as a discrete card in a desktop.&#160; You might have a whole new set of issues to tackle for optimus.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534075">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534078" class="blockpost rowodd"> <h2><span><span class="conr">#5255</span> <a href="viewtopic.php?pid=1534078#p1534078">2015-06-03 14:44:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91627">goeo_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-03</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:me@goeo.pink">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@goeo_</p><p>You&#039;re expecting discrete graphics in a laptop to behave the same as a discrete card in a desktop.&#160; You might have a whole new set of issues to tackle for optimus.</p></div></blockquote></div><p>i thought optimus was software only? what kind of different behaviors should i expect? has this never been done before?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534078">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534080" class="blockpost roweven"> <h2><span><span class="conr">#5256</span> <a href="viewtopic.php?pid=1534080#p1534080">2015-06-03 14:47:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>well, at least it somehow arbiters the display, it usually copies contents of the video buffers back and forth, I&#039;d kinda fear what it will do if there will be different OSes using them ... though you can try <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534080">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534089" class="blockpost rowodd"> <h2><span><span class="conr">#5257</span> <a href="viewtopic.php?pid=1534089#p1534089">2015-06-03 15:10:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@noctlos</p><p>You&#039;re not setting the locked memory limit</p></div></blockquote></div><p>Yup. Instead of:</p><div class="codebox"><pre><code>@group hard as &lt;limit&gt;</code></pre></div><p>I needed to use something like</p><div class="codebox"><pre><code>@group hard memlock &lt;limit&gt; @group soft memlock &lt;limit&gt;</code></pre></div><p>Along with chown&#039;ing the appropriate files mentioned previously, I can start my VM as user. Woohoo!</p><p>Now, if only I could figure out a way to get the sound to work!</p><p>I&#039;m using the qemu option </p><div class="codebox"><pre><code> -soundhw hda </code></pre></div><p> with QEMU_AUDIO_DRV=pa. I don&#039;t get any errors when I run it as user as some have, but the sound quality is as bad as ever. Did anyone solve this?</p><p>EDIT: Nevermind, the sound works okay when I increase QEMU_PA_SAMPLES to the default of 4096.</p> <p class="postedit"><em>Last edited by noctlos (2015-06-03 15:15:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534089">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534107" class="blockpost roweven"> <h2><span><span class="conr">#5258</span> <a href="viewtopic.php?pid=1534107#p1534107">2015-06-03 16:33:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>goeo_ wrote:</cite><blockquote><div><p> has this never been done before?</p></div></blockquote></div><p><span class="bbu">Exactly</span><br />BTW, i&#039;ve observed very bad behaviour of 770m in some other(i think it was lenovo) notebook, breaking lspci with unknown headers.<br />So i&#039;d totally not expect it to work. Ask ghormoon, he has an old laptop with a more &quot;true&quot; dedicated card, and that&#039;s even a radeon, and... there&#039;s still a huge fail.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534107">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534171" class="blockpost rowodd"> <h2><span><span class="conr">#5259</span> <a href="viewtopic.php?pid=1534171#p1534171">2015-06-03 23:31:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91167">avi9526</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-15</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I tried to use GPU passthrough with libvirt, qemu-kvm on ubuntu, but there was a problem related to PCI-e in guest OS was downgraded to version 1.1 instead of 2.0 (when run win on bare metal), does this problem appears with latest software versions on arch?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534171">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534181" class="blockpost roweven"> <h2><span><span class="conr">#5260</span> <a href="viewtopic.php?pid=1534181#p1534181">2015-06-04 00:33:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>avi9526 wrote:</cite><blockquote><div><p>Hi, I tried to use GPU passthrough with libvirt, qemu-kvm on ubuntu, but there was a problem related to PCI-e in guest OS was downgraded to version 1.1 instead of 2.0 (when run win on bare metal), does this problem appears with latest software versions on arch?</p></div></blockquote></div><p>Devices will often reduce the link rate to save power when not under load, this is why tools like gpu-z provide a render load to see the correct link rate.&#160; You also don&#039;t want to fully trust what the guest thinks of the link rate, look at the host device with lspci.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534181">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534186" class="blockpost rowodd"> <h2><span><span class="conr">#5261</span> <a href="viewtopic.php?pid=1534186#p1534186">2015-06-04 01:12:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91638">PrinzipDesSees</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-04</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91638">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I can pass a second gpu through just fine with a naked qemu line, like exactly in the OP. But when I try to punch this into a libvirt xml, it won&#039;t work.<br />Even with xmls others posted as working.<br />The log says: that the monitoring socket could not be created and that vfio-pci could not be initialised because it gets access to /dev/vfio/16 denied.<br />Well, I have made everything root for testing in /etc/libvirt/libvirtd.conf and /etc/libvirt/qemu.conf.<br />I chmodded /dev/vfio/16 /dev/vfio/17 /dev/vfio/7 /dev/vfio/vfio to 666.<br />I set selinux to disabled.<br />I have allowed the device cgroup in the config files.<br />I tried with brute force on a testing kernel without support for cgroups, selinux, capabilities and every security feature I could find ripped out or set to allow. Still access denied.<br />Inbefore the failing are warnings that the virtual instance is &quot;tained&quot; with high privileges (o rly?) and custom argv. Yeah sure thats right. Does that taint prevent starting?<br />How can I give qemu the x-vga=on parameter without having the extra &lt;qemu:commandline&gt; segment in the xml? Would make life a lot easier. <br />I was browsing the libvirt source code some time but I wasnt entirely sure where the allowed extra arguments are passed to qemu.<br />I will paste actual configs, logs and versions later, because the target computer is offline and I am typing from another guys internet.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534186">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534188" class="blockpost roweven"> <h2><span><span class="conr">#5262</span> <a href="viewtopic.php?pid=1534188#p1534188">2015-06-04 01:40:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@PrinzipDesSees</p><p>See part 5 of the series in my blog (sig) for how to use wrapper scripts to apply x-vga=on.&#160; Using qemu:args is likely the problem, there are very few cases where those are necessary or advised.&#160; You should not need to touch libvirtd.conf or qemu.conf.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534188">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534191" class="blockpost rowodd"> <h2><span><span class="conr">#5263</span> <a href="viewtopic.php?pid=1534191#p1534191">2015-06-04 02:34:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>update to the laptop experiment:<br />I&#039;ve fiddled a bit more with drivers, ended up on latest beta ones anyway ...</p><p>it works except that it turns the display off in windows for some strange reason.<br />in linux, everything is ok, extending to external display too.<br />in windows, laptop screen goes black, though it actually sees it in the OS, detects resolutions and such. external display works fine. somehow usable if I disable the internal one so it won&#039;t extend desktop to it. windows rated it 5.3 and 5.9, which is aprox. what it had bare metal (I don&#039;t remember exactly). I&#039;ll do some game tests someday <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>what I need to fix now, is that the VMs don&#039;t shutdown properly. thinking of trying another distro (more stable kvm and qemu), did anyone succed vfio passthrough eg. on debian?<br />also next thing to do is to modify qemu for ps/2 passthrough, write some management scripts and I&#039;m good to go! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I actually can somehow live with that the internal screen doesn&#039;t work in windows, though it&#039;s not preffered variant (can&#039;t play games except at home, but I don&#039;t have that much time for gaming anyway <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534191">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534192" class="blockpost roweven"> <h2><span><span class="conr">#5264</span> <a href="viewtopic.php?pid=1534192#p1534192">2015-06-04 02:35:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=60543">Duodecillian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-05-28</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ugearnine@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Say I wanted to run this to use primarily for virtual reality applications. Would the latency inherent in virtualization be a deal breaker? Has anyone tried?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534192">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534242" class="blockpost rowodd"> <h2><span><span class="conr">#5265</span> <a href="viewtopic.php?pid=1534242#p1534242">2015-06-04 08:17:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi there! Long time no see! My System is working really well. However I am still at Linux 3.9.</p><p>Is it safe to upgrade to 4.04? I am using the regular Linux kernel, NOT a patched one.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534242">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534321" class="blockpost roweven"> <h2><span><span class="conr">#5266</span> <a href="viewtopic.php?pid=1534321#p1534321">2015-06-04 14:17:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi there! Long time no see! My System is working really well. However I am still at Linux 3.9.</p><p>Is it safe to upgrade to 4.04? I am using the regular Linux kernel, NOT a patched one.</p></div></blockquote></div><p>You&#039;re really the only one that can answer this, but I sure hope the answer is yes.&#160; That&#039;s certainly the goal, to improve things without breaking existing users.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534329" class="blockpost rowodd"> <h2><span><span class="conr">#5267</span> <a href="viewtopic.php?pid=1534329#p1534329">2015-06-04 14:30:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duodecillian wrote:</cite><blockquote><div><p>Say I wanted to run this to use primarily for virtual reality applications. Would the latency inherent in virtualization be a deal breaker? Has anyone tried?</p></div></blockquote></div><p>Direct device assignment is generally a way to avoid the latency inherent in virtualization.&#160; For the most part, the VM has direct access to the hardware.&#160; The exceptions to that are interrupts, which are bounced through the host on current hardware, PCI config space, which is filtered by the hypervisor for virtualization, and any regions that cannot map directly to the guest, such as quirks for mmio mirrors of config space, io-port regions, or regions smaller than the processor page size.&#160; There are also configuration options important to reducing latency, such as MSI tuning, vCPU pinning and proper balancing of CPU resources between host and guest, and potentially even IRQ pinning in the host.&#160; If you have a processor that supports Intel APICv, the latter may allow interrupts to be injected to the guest without a vmexit.&#160; We&#039;ll have to wait for software and hardware to support Intel Posted Interrupts to avoid the host in the interrupt path altogether.&#160; People here are showing results within a few percentage points of bare metal in the best cases, so I would naively assume that the same is possible for VR applications.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534329">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534345" class="blockpost roweven"> <h2><span><span class="conr">#5268</span> <a href="viewtopic.php?pid=1534345#p1534345">2015-06-04 15:11:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>awesome, thank you very much. I tried it and nothing broke! So I&#039;m up to date. </p><p>I have another question that&#039;s bugging me for months.</p><p>Whenever I turn on my pc, first automatically archlinux starts and after that through virt-manager Windows 8.1. </p><p>How about turning it off? Is there a single command I can use to first shut down safely my virtualized Windows and after that the host? </p><p>Because If I simply use &quot;poweroff&quot; in terminal I don&#039;t think it&#039;s done properly, right??</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534345">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534359" class="blockpost rowodd"> <h2><span><span class="conr">#5269</span> <a href="viewtopic.php?pid=1534359#p1534359">2015-06-04 15:27:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>awesome, thank you very much. I tried it and nothing broke! So I&#039;m up to date. </p><p>I have another question that&#039;s bugging me for months.</p><p>Whenever I turn on my pc, first automatically archlinux starts and after that through virt-manager Windows 8.1. </p><p>How about turning it off? Is there a single command I can use to first shut down safely my virtualized Windows and after that the host? </p><p>Because If I simply use &quot;poweroff&quot; in terminal I don&#039;t think it&#039;s done properly, right??</p></div></blockquote></div><p>On Fedora there&#039;s an /etc/sysconfig/libvirt-guests file that includes such things as:</p><div class="codebox"><pre class="vscroll"><code># action taken on host boot # - start all guests which were running on shutdown are started on boot # regardless on their autostart settings # - ignore libvirt-guests init script won&#039;t start any guest on boot, however, # guests marked as autostart will still be automatically started by # libvirtd #ON_BOOT=start # Number of seconds to wait between each guest start. Set to 0 to allow # parallel startup. #START_DELAY=0 # action taken on host shutdown # - suspend all running guests are suspended using virsh managedsave # - shutdown all running guests are asked to shutdown. Please be careful with # this settings since there is no way to distinguish between a # guest which is stuck or ignores shutdown requests and a guest # which just needs a long time to shutdown. When setting # ON_SHUTDOWN=shutdown, you must also set SHUTDOWN_TIMEOUT to a # value suitable for your guests. #ON_SHUTDOWN=suspend # If set to non-zero, shutdown will suspend guests concurrently. Number of # guests on shutdown at any time will not exceed number set in this variable. #PARALLEL_SHUTDOWN=0 # Number of seconds we&#039;re willing to wait for a guest to shut down. If parallel # shutdown is enabled, this timeout applies as a timeout for shutting down all # guests on a single URI defined in the variable URIS. If this is 0, then there # is no time out (use with caution, as guests might not respond to a shutdown # request). The default value is 300 seconds (5 minutes). #SHUTDOWN_TIMEOUT=300</code></pre></div><p>I assume this works in conjunction with the systemd libvirt-guests.service.&#160; For an assigned device VM I&#039;d generally suggest shutdown vs suspend, unless you know suspend works with your devices.&#160; I also notice that Windows only wakes up the first time sending a shutdown command, so there may be some configuration in the guest necessary to make it shutdown on the first attempt.&#160; There&#039;s also libvirt xml options to configure whether suspend is available to the guest.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534359">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534390" class="blockpost roweven"> <h2><span><span class="conr">#5270</span> <a href="viewtopic.php?pid=1534390#p1534390">2015-06-04 16:26:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>that&#039;s great. I will try this. </p><p>Thank you very much Alex! Always a help. Awesome!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534390">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534632" class="blockpost rowodd"> <h2><span><span class="conr">#5271</span> <a href="viewtopic.php?pid=1534632#p1534632">2015-06-05 14:15:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there a updated site/post where I can find the newest _working_ nvidia driver version and a todo list to get it working?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534632">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534636" class="blockpost roweven"> <h2><span><span class="conr">#5272</span> <a href="viewtopic.php?pid=1534636#p1534636">2015-06-05 14:31:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Is there a updated site/post where I can find the newest _working_ nvidia driver version and a todo list to get it working?</p></div></blockquote></div><p>There are no non-working versions.&#160; Follow the guide series in my blog below for what I think is the current best setup.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534636">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534687" class="blockpost rowodd"> <h2><span><span class="conr">#5273</span> <a href="viewtopic.php?pid=1534687#p1534687">2015-06-05 19:22:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86845">garnerlogan65</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-22</span></dd> <dd><span>Posts: 26</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:garnerlogan65@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Having issues with this, see my thread here: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1534516#p1534516" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 6#p1534516</a>. Some sort of driver conflict, I think.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534691" class="blockpost roweven"> <h2><span><span class="conr">#5274</span> <a href="viewtopic.php?pid=1534691#p1534691">2015-06-05 19:41:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>garnerlogan65 wrote:</cite><blockquote><div><p>Having issues with this, see my thread here: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1534516#p1534516" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 6#p1534516</a>. Some sort of driver conflict, I think.</p></div></blockquote></div><p>There&#039;s a perfectly good guide that I&#039;d recommend in the link in my sig, I&#039;d strongly recommend it over any of this vfio-bind script nonsense.&#160; Your picture is way too blurry to figure out anything meaningful from it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534691">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1534694" class="blockpost rowodd"> <h2><span><span class="conr">#5275</span> <a href="viewtopic.php?pid=1534694#p1534694">2015-06-05 19:58:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86845">garnerlogan65</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-22</span></dd> <dd><span>Posts: 26</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:garnerlogan65@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Should I start from Part 3 and proceed from there? It will be a tad difficult since I cannot boot into a graphical environment, I think i just need to remove pci-stub from the initramfs, and boot without loading the systemd service and kernel module (pci_stub).</p> <p class="postedit"><em>Last edited by garnerlogan65 (2015-06-05 20:00:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1534694">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=210">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <a href="viewtopic.php?id=162768&amp;p=210">210</a> <strong>211</strong> <a href="viewtopic.php?id=162768&amp;p=212">212</a> <a href="viewtopic.php?id=162768&amp;p=213">213</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=212">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
