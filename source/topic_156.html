<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 156) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=156" title="Page 156" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=155" title="Page 155" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=157" title="Page 157" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=155">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=154">154</a> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <strong>156</strong> <a href="viewtopic.php?id=162768&amp;p=157">157</a> <a href="viewtopic.php?id=162768&amp;p=158">158</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=157">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1493050" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3876</span> <a href="viewtopic.php?pid=1493050#p1493050">2015-01-14 21:05:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you :-) It works!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493050">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493051" class="blockpost roweven"> <h2><span><span class="conr">#3877</span> <a href="viewtopic.php?pid=1493051#p1493051">2015-01-14 21:06:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I think if=none goes on the <em>-drive</em> option...</p></div></blockquote></div><p>Yeah sorry, i edited it</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493210" class="blockpost rowodd"> <h2><span><span class="conr">#3878</span> <a href="viewtopic.php?pid=1493210#p1493210">2015-01-15 14:29:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Mmmay be what we need is a new FAQ/OP-post made up. Any opinions/suggestions about that?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493210">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493422" class="blockpost roweven"> <h2><span><span class="conr">#3879</span> <a href="viewtopic.php?pid=1493422#p1493422">2015-01-16 05:49:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve followed the steps and attempted to read through a lot of the comments looking for anything relating to my problem but I haven&#039;t found anything to help. </p><p>First, my specs</p><p>CPU: i7 4790k<br />Mobo: g1.sniper h6<br />Main GPU: GTX 970<br />Passthrough GPU: GTX 260</p><p>I currently see no errors in dmesg or from qemu. I am using this to start the VM</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -vga none -device vfio-pci,host=06:00.0,x-vga=on</code></pre></div><p>The QEMU 2.2.0 monitor console pops up and when I switch inputs on my monitor all I see is &quot;entering powersave mode&quot; and no signal seems to be passed to it. </p><p>The only dmesg info that shows up is this </p><div class="codebox"><pre><code>[ 2283.841755] vfio-pci 0000:06:00.0: enabling device (0400 -&gt; 0403)</code></pre></div><p>I am using the kernel supplied in OP&#039;s post which was built using makepkg. The card is picked up by pci-stub in dmesg, the vfio-bind command works without error.</p> <p class="postedit"><em>Last edited by tully (2015-01-16 06:09:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493422">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493431" class="blockpost rowodd"> <h2><span><span class="conr">#3880</span> <a href="viewtopic.php?pid=1493431#p1493431">2015-01-16 06:35:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75818">ceri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 44</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Mmmay be what we need is a new FAQ/OP-post made up. Any opinions/suggestions about that?</p></div></blockquote></div><p>It would be nice to have everything that&#039;s known all in one place, as opposed to scattered all around this thread with no decent way of searching (besides awkward google searches). I think putting it on the arch wiki would be best since it would be editable by all.</p><p>I actually considered starting one but I don&#039;t have time to maintain it. Here is a collection of useful links I found for my personal usage:<br /><a href="http://pastebin.com/sdkZPykz" rel="nofollow">http://pastebin.com/sdkZPykz</a></p><p>(for some links, you have to scroll down to a *reply* with the useful info)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493431">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493437" class="blockpost roweven"> <h2><span><span class="conr">#3881</span> <a href="viewtopic.php?pid=1493437#p1493437">2015-01-16 07:21:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ tully <br />try using rom file for your gpu</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493451" class="blockpost rowodd"> <h2><span><span class="conr">#3882</span> <a href="viewtopic.php?pid=1493451#p1493451">2015-01-16 08:43:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>I&#039;ve followed the steps and attempted to read through a lot of the comments looking for anything relating to my problem but I haven&#039;t found anything to help. </p><p>First, my specs</p><p>CPU: i7 4790k<br />Mobo: g1.sniper h6<br />Main GPU: GTX 970<br />Passthrough GPU: GTX 260</p><p>I currently see no errors in dmesg or from qemu. I am using this to start the VM</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -vga none -device vfio-pci,host=06:00.0,x-vga=on</code></pre></div><p>The QEMU 2.2.0 monitor console pops up and when I switch inputs on my monitor all I see is &quot;entering powersave mode&quot; and no signal seems to be passed to it. </p><p>The only dmesg info that shows up is this </p><div class="codebox"><pre><code>[ 2283.841755] vfio-pci 0000:06:00.0: enabling device (0400 -&gt; 0403)</code></pre></div><p>I am using the kernel supplied in OP&#039;s post which was built using makepkg. The card is picked up by pci-stub in dmesg, the vfio-bind command works without error.</p></div></blockquote></div><p>there is a note in OP:</p><div class="quotebox"><blockquote><div><p>NOTE: There might be some problems using nvidia/fglrx/nouveau drivers on the host gpu, see the ISSUES section below on how to solve this.</p></div></blockquote></div><p>i beleive there was a note in now-missing ISSUES section about the need to patch nvidia drivers if both host and guest are using nvidia gpus (or something like that - cant remember for sure)</p> <p class="postedit"><em>Last edited by sinny (2015-01-16 08:43:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493451">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493483" class="blockpost roweven"> <h2><span><span class="conr">#3883</span> <a href="viewtopic.php?pid=1493483#p1493483">2015-01-16 11:42:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79899">winie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-01</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:alireza4051@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>I&#039;ve followed the steps and attempted to read through a lot of the comments looking for anything relating to my problem but I haven&#039;t found anything to help. </p><p>First, my specs</p><p>CPU: i7 4790k...</p></div></blockquote></div><p>I suggest you to use the intel integrated gpu as main gpu and use OVMF uefi in guest instead of bios</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493483">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493518" class="blockpost rowodd"> <h2><span><span class="conr">#3884</span> <a href="viewtopic.php?pid=1493518#p1493518">2015-01-16 13:18:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88044">zlice</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>don&#039;t see a way to search just this thread (156 pages)</p><p>i have 2 cards - problem is the card i&#039;d like to passthrough is seen by my mobo(asus) as primary, guessing because it&#039;s in slot1, but i can&#039;t swap it because the thing&#039;s so big</p><p>is there any way to switch the pci bus? i&#039;ve seen people talk about modding kernel code but i don&#039;t really know where i&#039;d start to look if that&#039;s even the answer</p><br /><p>edit:<br />Asus M5A99FX PRO R20<br />pci-stub is in dmesg but the card is still what displays bios and OS<br />even trying to run Xorg on the card i want, it grabs pci:1:0:0 even though it&#039;s not in my xorg.conf<br />both ati/amd cards (5870 and 290)</p> <p class="postedit"><em>Last edited by zlice (2015-01-16 13:23:03)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493518">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493540" class="blockpost roweven"> <h2><span><span class="conr">#3885</span> <a href="viewtopic.php?pid=1493540#p1493540">2015-01-16 15:12:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>winie wrote:</cite><blockquote><div><div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>I&#039;ve followed the steps and attempted to read through a lot of the comments looking for anything relating to my problem but I haven&#039;t found anything to help. </p><p>First, my specs</p><p>CPU: i7 4790k...</p></div></blockquote></div><p>I suggest you to use the intel integrated gpu as main gpu and use OVMF uefi in guest instead of bios</p></div></blockquote></div><br /><p>I have three monitors. I can&#039;t extend to 3 monitors with IGP.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493540">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493560" class="blockpost rowodd"> <h2><span><span class="conr">#3886</span> <a href="viewtopic.php?pid=1493560#p1493560">2015-01-16 16:18:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@ tully <br />try using rom file for your gpu</p></div></blockquote></div><p>I pulled the ROM with gpu-z in windows and tried a few from techpowerup. Here is the output when I try to use it. </p><div class="codebox"><pre><code>root@tully ~]# qemu-system-x86_64 -enable-kvm -M q35 -m 4G -cpu host -smp 3,sockets=1,cores=3,threads=1 -bios /usr/share/qemu/bios.bin -k en-us -no-reboot -vga none -device qxl -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=06:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/root/GT200.rom -boot menu=on dma: command 84 not supported dma: command 84 not supported dma: command b4 not supported dma: command b4 not supported dma: command 84 not supported dma: command 84 not supported dma: command 78 not supported dma: command c not supported dma: command 48 not supported dma: command 48 not supported dma: command 4c not supported dma: command c not supported</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493560">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493568" class="blockpost roweven"> <h2><span><span class="conr">#3887</span> <a href="viewtopic.php?pid=1493568#p1493568">2015-01-16 16:37:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zlice wrote:</cite><blockquote><div><p>i have 2 cards - problem is the card i&#039;d like to passthrough is seen by my mobo(asus) as primary, guessing because it&#039;s in slot1, but i can&#039;t swap it because the thing&#039;s so big</p><p>is there any way to switch the pci bus? i&#039;ve seen people talk about modding kernel code but i don&#039;t really know where i&#039;d start to look if that&#039;s even the answer</p></div></blockquote></div><p>Unless there&#039;s an option in your bios to actually choose which PCIe slot to boot primary graphics from, which from a look at the manual doesn&#039;t seem to be the case and not something I have on my own board (Asus P9D WS), so your only other option is to swap the cards around.</p><p>When you say you can&#039;t swap because it&#039;s too big, is it because it wouldn&#039;t fit in that spot in the case or because it&#039;s taking up another slot that you&#039;re using or due to the physical constraints of the case? It looks like, from the manual, that only two of the PCIe/PCI slots are PCIe 2 x16 slots on that board as well (1 and 4).</p> <p class="postedit"><em>Last edited by Myranti (2015-01-16 16:38:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493574" class="blockpost rowodd"> <h2><span><span class="conr">#3888</span> <a href="viewtopic.php?pid=1493574#p1493574">2015-01-16 16:54:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88044">zlice</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Myranti wrote:</cite><blockquote><div><div class="quotebox"><cite>zlice wrote:</cite><blockquote><div><p>i have 2 cards - problem is the card i&#039;d like to passthrough is seen by my mobo(asus) as primary, guessing because it&#039;s in slot1, but i can&#039;t swap it because the thing&#039;s so big</p><p>is there any way to switch the pci bus? i&#039;ve seen people talk about modding kernel code but i don&#039;t really know where i&#039;d start to look if that&#039;s even the answer</p></div></blockquote></div><p>Unless there&#039;s an option in your bios to actually choose which PCIe slot to boot primary graphics from, which from a look at the manual doesn&#039;t seem to be the case and not something I have on my own board (Asus P9D WS), so your only other option is to swap the cards around.</p><p>When you say you can&#039;t swap because it&#039;s too big, is it because it wouldn&#039;t fit in that spot in the case or because it&#039;s taking up another slot that you&#039;re using or due to the physical constraints of the case? It looks like, from the manual, that only two of the PCIe/PCI slots are PCIe 2 x16 slots on that board as well (1 and 4).</p></div></blockquote></div><p>ya there&#039;s nothing in bios about video but switching PEG/PCI which does nothing.<br />and yes the card it too big, i&#039;d have to cut up the HD holder.</p><p>i may try to unbind/bind and ssh to see if i can get anything to happen...then i&#039;m going to take it out of the case to make sure slot1 is what&#039;s making it display (probably why)</p><p>if i can get it working out of the case...i&#039;ll probably burn another $70...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493574">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493587" class="blockpost roweven"> <h2><span><span class="conr">#3889</span> <a href="viewtopic.php?pid=1493587#p1493587">2015-01-16 17:31:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>I&#039;ve followed the steps and attempted to read through a lot of the comments looking for anything relating to my problem but I haven&#039;t found anything to help. </p><p>First, my specs</p><p>CPU: i7 4790k...</p></div></blockquote></div><p>I suggest you to use the intel integrated gpu as main gpu and use OVMF uefi in guest instead of bios</p></div></blockquote></div><br /><p>I have three monitors. I can&#039;t extend to 3 monitors with IGP.</p></div></blockquote></div><p>well, if you gonna ignore possible need to patch nvidia drivers, you could try twisting your setup a bit:<br /> - [ host ] virtualization host, nothing more (minimal install)<br /> - [ guest0 ] takes the role of your current triple-monitor host<br /> - [ guest1 ] your currently desired guest (i assume windows)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493587">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493614" class="blockpost rowodd"> <h2><span><span class="conr">#3890</span> <a href="viewtopic.php?pid=1493614#p1493614">2015-01-16 18:47:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone , long time no see .</p><p>Does anyone experience soft lockups of VMs once every couple of minutes ?</p><p>I always experience such lockups that lasts for a second or less in every Windows 8.1 VM I have . This is on my X99 host by the way .</p><p>CMD line if anyone would have an idea what&#039;s causing them :</p><div class="codebox"><pre><code>qemu-system-x86_64 -name main -nographic \ -enable-kvm -m 8192 -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -vga none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/VMs/ovmf_main.bin \ -device vfio-pci,host=05:00.0,multifunction=on \ -device vfio-pci,host=05:00.1 \ -device vfio-pci,host=0f:00.0 \ -device vfio-pci,host=00:1b.0 \ -drive file=/VMs/Win_Main.img,cache=none,format=raw,if=none,id=drive0,aio=native \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/VMs/Win8.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /VMs/virtio.iso \ -localtime \ -net nic,model=virtio,macaddr=33:29:21:5F:C4:7D -net bridge,br=br0 \ -monitor unix:/tmp/vm_main,server,nowait &amp;</code></pre></div><p>I believe that heavy HDD activity causes it more often . These VMs are sitting on a 4 disk RAID0 . Disks are 7200 ones .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493614">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493617" class="blockpost roweven"> <h2><span><span class="conr">#3891</span> <a href="viewtopic.php?pid=1493617#p1493617">2015-01-16 19:01:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>tully wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><p>I suggest you to use the intel integrated gpu as main gpu and use OVMF uefi in guest instead of bios</p></div></blockquote></div><br /><p>I have three monitors. I can&#039;t extend to 3 monitors with IGP.</p></div></blockquote></div><p>well, if you gonna ignore possible need to patch nvidia drivers, you could try twisting your setup a bit:<br /> - [ host ] virtualization host, nothing more (minimal install)<br /> - [ guest0 ] takes the role of your current triple-monitor host<br /> - [ guest1 ] your currently desired guest (i assume windows)</p></div></blockquote></div><p>Would you mind elaborating on that setup? I&#039;m assuming you are suggesting that I passthrough my 970 to a linux VM and then the 260 to a windows VM. I would think that if the 260 doesn&#039;t currently work with this setup that OP provided that it wouldn&#039;t work under those circumstances either. I&#039;m probably missing something though which is why I&#039;m asking for clarification. </p><p>I wasn&#039;t attempting to ignore patching the nvidia drivers, I simply haven&#039;t found any up to date information on doing it. The last I saw was about two years ago and I&#039;d prefer to be on a more recent driver. </p><p>If I can&#039;t get the 260 to work I think the next recourse is to just bit the bullet and run two monitors off the 260 and one off the IGP. From my understanding I can&#039;t have 3 monitors extended and able to pass applications back and forth with that setup. But, I should be able to use OVMF with the 970 I think. Do you know if the host gpu has to support OVMF as well or is it only the GPU that is getting passed through? </p><p>Thanks</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493617">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493624" class="blockpost rowodd"> <h2><span><span class="conr">#3892</span> <a href="viewtopic.php?pid=1493624#p1493624">2015-01-16 19:23:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>Do you know if the host gpu has to support OVMF as well or is it only the GPU that is getting passed through?</p></div></blockquote></div><p>Only the GPU you&#039;re passing-through . OVMF has nothing to&#160; do with your host GPUs .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493624">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493659" class="blockpost roweven"> <h2><span><span class="conr">#3893</span> <a href="viewtopic.php?pid=1493659#p1493659">2015-01-16 21:29:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Tried to switch GPUs on my mobo:</p><p>so, now we have</p><p>HD 6850, x16, blue<br />R9 270, x4, black</p><p>after reboot can&#039;t load to my kernel, it just stuck on <br />grub complaining about diskfilter writes (system&#039;s on lvm, just wait or press any key -&gt; it goes away, and system boots as expected)</p><p>It doesn&#039;t matter if I removed pci-ids or not.</p><p>But I managed to boot in ARCH-kernel, and now I get in dmesg:</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; sudo dmesg | grep -i AMD-Vi&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ~<br />[sudo] password for walkindude: <br />[&#160; &#160; 0.107871] AMD-Vi: device: 00:00.2 cap: 0040 seg: 0 flags: 3e info 1300<br />[&#160; &#160; 0.107872] AMD-Vi:&#160; &#160; &#160; &#160; mmio-addr: 00000000feb20000<br />[&#160; &#160; 0.107883] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 00:00.0 flags: 00<br />[&#160; &#160; 0.107885] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 00:00.2<br />[&#160; &#160; 0.107886] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:02.0 flags: 00<br />[&#160; &#160; 0.107887] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 01:00.0 flags: 00<br />[&#160; &#160; 0.107888] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 01:00.1<br />[&#160; &#160; 0.107889] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:11.0 flags: 00<br />[&#160; &#160; 0.107890] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 00:12.0 flags: 00<br />[&#160; &#160; 0.107891] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 00:12.2<br />[&#160; &#160; 0.107892] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 00:13.0 flags: 00<br />[&#160; &#160; 0.107893] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 00:13.2<br />[&#160; &#160; 0.107894] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:14.0 flags: d7<br />[&#160; &#160; 0.107895] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:14.3 flags: 00<br />[&#160; &#160; 0.107896] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:14.4 flags: 00<br />[&#160; &#160; 0.107898] AMD-Vi:&#160; &#160;DEV_ALIAS_RANGE&#160; &#160; &#160; &#160;&#160; devid: 02:00.0 flags: 00 devid_to: 00:14.4<br />[&#160; &#160; 0.107898] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 02:1f.7<br />[&#160; &#160; 0.107906] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:14.5 flags: 00<br />[&#160; &#160; 0.107907] AMD-Vi:&#160; &#160;DEV_SELECT&#160; &#160; &#160; &#160; &#160; &#160;&#160; devid: 00:15.0 flags: 00<br />[&#160; &#160; 0.107908] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 03:00.0 flags: 00<br />[&#160; &#160; 0.107909] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 03:00.1<br />[&#160; &#160; 0.107910] AMD-Vi:&#160; &#160;DEV_SELECT_RANGE_START&#160; &#160;&#160; devid: 00:16.0 flags: 00<br />[&#160; &#160; 0.107911] AMD-Vi:&#160; &#160;DEV_RANGE_END&#160; &#160; &#160; &#160;&#160; devid: 00:16.2<br />[&#160; &#160; 0.107912] AMD-Vi:&#160; &#160;DEV_SPECIAL(IOAPIC[0])&#160; &#160; &#160; &#160; devid: 00:14.0<br />[&#160; &#160; 0.107914] AMD-Vi:&#160; &#160;DEV_SPECIAL(HPET[0])&#160; &#160; &#160; &#160; devid: 00:14.0<br />[&#160; &#160; 0.107915] AMD-Vi:&#160; &#160;DEV_SPECIAL(IOAPIC[255])&#160; &#160; &#160; &#160; devid: 00:00.1<br />[&#160; &#160; 2.908990] AMD-Vi: Found IOMMU at 0000:00:00.2 cap 0x40<br />[&#160; &#160; 2.908992] AMD-Vi: Interrupt remapping enabled<br />[&#160; &#160; 2.909114] AMD-Vi: Initialized for Passthrough Mode<br />[&#160; &#160; 3.045906] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.156248] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.266509] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.376798] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.487084] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.597349] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.707628] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.817917] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 3.928191] AMD-Vi: Completion-Wait loop timed out<br />[&#160; &#160; 4.017795] AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=03:00.0 address=0x00000002331e88e0]<br />[&#160; &#160; 4.017805] AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=03:00.0 address=0x00000002331e8900]<br />[&#160; &#160; 4.017810] AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=03:00.0 address=0x00000002331e8930]</p></div></blockquote></div><p>If I switch GPUs back,my kernel boots, but during this process I&#039;m seing something strange (can&#039;t find it later in logs, so I shot it by my phone camera)<br /><a href="http://rghost.net/private/60392304/15d7e0fd9de4cf57cad4c8e6c83e5413.view" rel="nofollow">http://rghost.net/private/60392304/15d7 … e5413.view</a><br />These two line were present on all my attempts (on this and previous pages of current topic)</p><p>In dmesg after</p><div class="quotebox"><blockquote><div><p>AMD-Vi: Initialized for Passthrough Mode</p></div></blockquote></div><p>nothing, no lines about </p><div class="quotebox"><blockquote><div><p>Completion-Wait loop timed out or</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>Event logged [IOTLB_INV_TIMEOUT device=03:00.0 address=0x00000002331e8900]</p></div></blockquote></div><p>UEFI bios on my mobo (M5A97 PRO) is the latest available: 1604. I&#039;d flashed it a long time ago, during the installation of FX CPU.</p><p>What is wrong here? Should I buy the second revision or completely another AM3+ motherboard? or smth wrong in my settings?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493671" class="blockpost rowodd"> <h2><span><span class="conr">#3894</span> <a href="viewtopic.php?pid=1493671#p1493671">2015-01-16 22:08:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>Do you know if the host gpu has to support OVMF as well or is it only the GPU that is getting passed through?</p></div></blockquote></div><p>Only the GPU you&#039;re passing-through . OVMF has nothing to&#160; do with your host GPUs .</p></div></blockquote></div><p>Thanks. I&#039;ve reconfigured my rig now. My gtx 260 is in the primary pcie slot, gtx 970 in the second. I&#039;ve got all the monitors working and extended with xrandr. Time to give OVMF a shot.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493671">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493691" class="blockpost roweven"> <h2><span><span class="conr">#3895</span> <a href="viewtopic.php?pid=1493691#p1493691">2015-01-16 22:58:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Hi everyone , long time no see .</p><p>Does anyone experience soft lockups of VMs once every couple of minutes ?</p><p>I always experience such lockups that lasts for a second or less in every Windows 8.1 VM I have . This is on my X99 host by the way .</p><p>CMD line if anyone would have an idea what&#039;s causing them :</p><div class="codebox"><pre><code>qemu-system-x86_64 -name main -nographic \ -enable-kvm -m 8192 -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -vga none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/VMs/ovmf_main.bin \ -device vfio-pci,host=05:00.0,multifunction=on \ -device vfio-pci,host=05:00.1 \ -device vfio-pci,host=0f:00.0 \ -device vfio-pci,host=00:1b.0 \ -drive file=/VMs/Win_Main.img,cache=none,format=raw,if=none,id=drive0,aio=native \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/VMs/Win8.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /VMs/virtio.iso \ -localtime \ -net nic,model=virtio,macaddr=33:29:21:5F:C4:7D -net bridge,br=br0 \ -monitor unix:/tmp/vm_main,server,nowait &amp;</code></pre></div><p>I believe that heavy HDD activity causes it more often . These VMs are sitting on a 4 disk RAID0 . Disks are 7200 ones .</p></div></blockquote></div><p>It&#039;s probably because you&#039;re using images instead of block devices (and if your fs is btrfs then can be even worse. Also, how much RAM did you left for your host?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493691">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493696" class="blockpost rowodd"> <h2><span><span class="conr">#3896</span> <a href="viewtopic.php?pid=1493696#p1493696">2015-01-16 23:09:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>It&#039;s probably because you&#039;re using images instead of block devices (and if your fs is btrfs then can be even worse. Also, how much RAM did you left for your host?</p></div></blockquote></div><p>I went the RAW images path because they&#039;re easy to manage , move around , duplicate and delete . Those soft lock-ups used to happen alot when I was using QCOW2 images , they are alot less now with RAW but not gone completely . The RAID0 which all of these images are is an MDRAID (RAID0) + EXT4 . About the ram , now the whole system is consuming 18GB out of 32GB total , so It&#039;s not about the RAM I guess .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493696">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493736" class="blockpost roweven"> <h2><span><span class="conr">#3897</span> <a href="viewtopic.php?pid=1493736#p1493736">2015-01-17 03:08:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88033">tully</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Update: We have video! Using the 970 as the passthrough and OVMF I was able to get output to the screen. However, I&#039;m unable to get the VM to boot from the windows iso. When trying it I see &quot;Boot failed. EFI DVD/CDROM 1&quot;, it tries to pxe boot, then it kicks over to the UEFI Interactive shell v2.1. </p><p>Here is my qemu launch script</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 8192 -cpu host,kvm=off -smp 2,cores=2,threads=1 \ -vga none \ -drive if=pflash,format=raw,file=/usr/share/ovmf/ovmf_x64.bin \ -device virtio-scsi-pci,id=scsi \ -device vfio-pci,host=06:00.0,multifunction=on \ -device vfio-pci,host=06:00.1 \ -drive file=/VMs/win.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/VMs/win8.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/VMs/virt.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -boot menu=on</code></pre></div><p>Also, this is probably pretty stupid but I haven&#039;t found an answer anywhere else. How exactly are you guys using your keyboard and mouse in the guest? I saw a youtube video of someone using synergy so that seems like a good option, but other than plugging in a separate keyboard and passing it through as well I&#039;m at a loss as to how I&#039;m supposed to share the keyboard and mouse without them potentially getting stuck in the guest. Thanks for all of your help.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493736">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493772" class="blockpost rowodd"> <h2><span><span class="conr">#3898</span> <a href="viewtopic.php?pid=1493772#p1493772">2015-01-17 08:30:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88044">zlice</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-16</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>so after messing around for quite some time. i ended up with an old 8600gts and my r290...</p><p>maybe it&#039;s an issue someone came across on this thread, but can someone tell me how my video output is from my passthrough but device manager/amd doesn&#039;t know it&#039;s an amd card?<br />changed my qemu command a few times, maybe i have to redo the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493772">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493802" class="blockpost roweven"> <h2><span><span class="conr">#3899</span> <a href="viewtopic.php?pid=1493802#p1493802">2015-01-17 10:27:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>Update: We have video! Using the 970 as the passthrough and OVMF I was able to get output to the screen. However, I&#039;m unable to get the VM to boot from the windows iso. When trying it I see &quot;Boot failed. EFI DVD/CDROM 1&quot;, it tries to pxe boot, then it kicks over to the UEFI Interactive shell v2.1.</p></div></blockquote></div><p>Use this to assign the ISO to the VM :</p><div class="codebox"><pre><code>-device virtio-scsi-pci,id=scsi \ -drive file=/VMs/win8.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \</code></pre></div><p>Good luck !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493802">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1493903" class="blockpost rowodd"> <h2><span><span class="conr">#3900</span> <a href="viewtopic.php?pid=1493903#p1493903">2015-01-17 16:10:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tully wrote:</cite><blockquote><div><p>How exactly are you guys using your keyboard and mouse in the guest? I saw a youtube video of someone using synergy so that seems like a good option, but other than plugging in a separate keyboard and passing it through as well I&#039;m at a loss as to how I&#039;m supposed to share the keyboard and mouse without them potentially getting stuck in the guest.</p></div></blockquote></div><p>My setup is less common I assume, but I actually have essentially a dumb* USB switch setup (well, 2 of them actually), that I soldered together with some 4 Pole Double Throw (4PDT), On-Off-On switches and some short USB connectors and then have a separate PCIe USB 3 card passed through to the guest, giving me dedicated USB ports on the guest with separate USB connections going to the host and guest (via the USB 3 card) and then switch between them with the switches. You could also get some sort of basic USB switch if you were using something like a dedicated USB card, the kind of thing that&#039;s designed to share printers for instance (like an Aten US221A), though depending on the keyboard it might not pass through multimedia keys or other special keys (like the Roccat keyboard and mouse I used to use).</p><p>* When I say dumb, I mean that it&#039;s not like the Aten US221A that I mentioned which normally keeps the devices enumerated on each system whether connected to a particular system or not. In my setup it&#039;s dumb and actually results in disconnection of the electrical circuit, akin to unplugging and plugging the cable back in, also meaning that the keyboard and mouse have to re-enumerate each time you switch systems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1493903">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=155">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=154">154</a> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <strong>156</strong> <a href="viewtopic.php?id=162768&amp;p=157">157</a> <a href="viewtopic.php?id=162768&amp;p=158">158</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=157">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
