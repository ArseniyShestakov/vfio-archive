<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 129) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=129" title="Page 129" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=128" title="Page 128" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=130" title="Page 130" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=128">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=127">127</a> <a href="viewtopic.php?id=162768&amp;p=128">128</a> <strong>129</strong> <a href="viewtopic.php?id=162768&amp;p=130">130</a> <a href="viewtopic.php?id=162768&amp;p=131">131</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=130">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1474321" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3201</span> <a href="viewtopic.php?pid=1474321#p1474321">2014-11-10 22:42:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83606">Child_of_Sun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 8</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Child_of_Sun wrote:</cite><blockquote><div><p>Hi @all</p><p>I have managed to passthrough my Primary Graphic Card (And the Secondary for CrossfireX).</p><p>I use a custom initramfs with a custom init script, which means that i don&#039;t know if it&#039;s important to setup this during boot.</p><p>My Computer:<br />CPU: Amd FX-8350<br />Mainboard: Asrock 970 Extreme4<br />Primary Graphics: PowerColor PCS+ HD7770 GHz Edition 1GB GDDR5&#160; &#160; &#160; (vfio-pci, Windows)<br />Secondary Graphics: PowerColor HD7770 GHz Edition 1GB GDDR5 (V2?)&#160; (vfio-pci, Windows)<br />Tertiary Graphics: PowerColor HD7750 1GB GDDR5&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;(Linux Host)<br />Memory: 16 GB Transcend 1333MHz Memory<br />Power Supply: Thermaltake Berlin 630W</p><p>I use Gentoo Linux ~amd64 with kernel 3.18.0-rc2 (Because of the OverlayFS :-), should work with 3.17.1 too) and Qemu-2.1.2 with Seabios-1.7.5 (Release)</p><p>My Kernel cmdline is:</p><div class="codebox"><pre><code>root=/dev/mapper/root rootfstype=btrfs rw iommu=pt video=radeondrmfb:1280x1024-24@75,mtrr:3,pmipal,ywrap kvm.ignore_msrs=1 vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1b21:1042,1002:4383,1002:4391,1002:4393,1002:439c vfio-bind=0000:02:00.0,0000:02:00.1,0000:01:00.0,0000:01:00.1,0000:00:14.2,0000:00:11.0,0000:04:00.0,0000:05:00.0 hugepagesz=1GB fbcon=map:1</code></pre></div><p>The vfio-bind Option is parsed by the custom init in my initramfs.</p><p>At boot i bind the devices (Like mentioned here) to the pci-stub driver, later to the vfio-pci driver. The Essential Lines from my init for this Proces are:</p><div class="codebox"><pre><code>/sbin/vfio-bind &quot;${vfiobond}&quot; echo 0000:03:00.1 &gt; /sys/bus/pci/devices/0000:03:00.1/driver/unbind # The Amd Audio device binds to pci-stub, since it has the same ids at the 7750 and the 7770, this fix this Problem. modprobe radeon # Here i Load the radeon kernel module for the framebuffer sleep 4 # Wait a little bit to be sure everything has enough time to switch echo 1 &gt; /sys/bus/pci/drivers/vfio-pci/0000:01:00.0/remove # Here i remove the Primary adapter from the PCI bus echo 1 &gt; /sys/bus/pci/drivers/vfio-pci/0000:01:00.1/remove echo 1 &gt; /sys/bus/pci/rescan # Here i rescan the Pci-Bus for new devices, it find the Primary radeon and binds it automatically to the vfio-pci driver</code></pre></div><p>The Last three Lines are Essential for this to work, with this config i can restart the VM, install newer Graphics Drivers, Play 3D Games (Elder Scrolls Online at the moment :-) ).</p><p>I use the rombios=/path/to/bios/file Option for the Primary Card, don&#039;t know if it is essential.</p><p>At Last here is the Qemu Startup Line from my script:</p><br /><div class="codebox"><pre><code>until /usr/bin/sudo /usr/bin/nice -n 10 /usr/bin/qemu-system-x86_64 -M q35 -enable-kvm -monitor stdio -nographic -balloon none -mem-path /dev/hugepages -mem-prealloc \ -m 10240 -k de -cpu host -smp 8,sockets=1,cores=8,threads=1 -bios /usr/share/qemu/bios.bin-1.7.5 -realtime mlock=on \ -vga none -D /var/log/qemu-out.log -boot menu=on -usb -usbdevice host:046d:c517 -usbdevice host:093a:2510 \ -device vfio-pci,host=00:11.0,bus=pcie.0,addr=1c.0,multifunction=on,bootindex=0 \ -device vfio-pci,host=00:14.2,bus=pcie.0,addr=1c.1,multifunction=on \ -device ioh3420,bus=pcie.0,addr=1c.2,multifunction=on,port=1,chassis=2,id=root.0 \ -device ioh3420,bus=pcie.0,addr=1c.3,multifunction=on,port=2,chassis=3,id=root.1 \ -device nec-usb-xhci,multifunction=on,addr=1c.4,bus=pcie.0,id=usb3 \ -device vfio-pci,host=01:00.0,bus=root.0,addr=00.0,multifunction=on,romfile=/etc/qemu/vbios/Powercolor.HD7770.1024.120418.rom,x-vga=on \ -device vfio-pci,host=01:00.1,bus=pcie.0,multifunction=on \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=pcie.0,multifunction=on \ -device vfio-pci,host=04:00.0,bus=pcie.0,addr=1c.6,multifunction=on \ -device vfio-pci,host=05:00.0,bus=pcie.0,addr=1c.7,multifunction=on \ -drive id=bitlocker_keys,file=/dev/loop0,if=none -device usb-storage,drive=bitlocker_keys,bus=usb3.0 \ -netdev type=tap,id=guest0,vhost=on,ifname=&quot;${IFACE}&quot; -device virtio-net-pci,netdev=guest0,mac=&quot;${macaddr}&quot; ${options} ; do echo &quot;Qemu crashed with exit code $?. Respawning..&quot; &gt;&amp;2 sleep 5 done</code></pre></div><p>I hope it helps somebody who tries the same :-)</p></div></blockquote></div><br /><p>I bought a new Graphics Card and tried Primary Passthrough with it and it works perfect :-)</p><p>It&#039;s a Sapphire Radeon R9 280X Tri-X OC and it replaces both Radeon HD7770 and brings slightly better Graphics Performance.</p><p>My Sartup command is now:</p><div class="codebox"><pre><code>until /usr/bin/sudo /usr/bin/nice -n 0 /usr/bin/qemu-system-x86_64 -M q35 -enable-kvm -monitor stdio -nographic \ -balloon none -mem-path /dev/hugepages -mem-prealloc -m 10240 -k de -cpu host -smp 8,sockets=1,cores=8,threads=1 \ -bios /usr/share/qemu/bios.bin-1.7.5 -realtime mlock=on -vga none -D /var/log/qemu-out.log -boot menu=on -usb \ -usbdevice host:046d:c517 -usbdevice host:093a:2510 -usbdevice host:1a2c:0023 \ -device vfio-pci,host=00:11.0,bus=pcie.0,addr=1c.0,multifunction=on,bootindex=0 \ -device vfio-pci,host=00:14.2,bus=pcie.0,addr=1c.1,multifunction=on \ -device ioh3420,bus=pcie.0,addr=1c.2,multifunction=on,port=1,chassis=1,id=root.0 \ -device vfio-pci,host=01:00.0,bus=root.0,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=pcie.0,multifunction=on \ -device vfio-pci,host=03:00.0,bus=pcie.0,addr=1c.6,multifunction=on \ -device vfio-pci,host=04:00.0,bus=pcie.0,addr=1c.7,multifunction=on \ -drive id=bitlocker_keys,file=/dev/loop0,if=none -device usb-storage,drive=bitlocker_keys \ -netdev type=tap,id=guest0,vhost=on,ifname=&quot;${IFACE}&quot; -device virtio-net-pci,netdev=guest0,mac=&quot;${macaddr}&quot; ${options} ; do echo &quot;Qemu crashed with exit code $?. Respawning..&quot; &gt;&amp;2 sleep 5 done</code></pre></div><p>*EDIT* Since the Card have a switchable Bios (UEFI/Compatible) i wanted to tell you all that both settings work.</p> <p class="postedit"><em>Last edited by Child_of_Sun (2014-11-10 22:45:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474352" class="blockpost roweven"> <h2><span><span class="conr">#3202</span> <a href="viewtopic.php?pid=1474352#p1474352">2014-11-11 02:11:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86599">s00pcan</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve got this working, but I&#039;m getting a jerky mouse input.&#160; Video is smooth and I can play games fine.&#160; What&#039;s the usual thing to try for this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474352">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474399" class="blockpost rowodd"> <h2><span><span class="conr">#3203</span> <a href="viewtopic.php?pid=1474399#p1474399">2014-11-11 09:46:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><p>Is there a way to fix the new nvidia drivers looking for hyper-v parameters? possibly in future releases of qemu or from inside windows?</p></div></blockquote></div><p>Are you asking for a solution beyond simply not using hyper-v extensions?&#160; You might want to revert back to an old nvidia driver and test whether it would be worthwhile.&#160; I don&#039;t know of anyone looking a further solutions.&#160; If you need hyper-v extensions, nvidia professional series cards or AMD cards might be a better option.</p></div></blockquote></div><p>I have been thinking about the whole nvidia situation and came up with two possible solutions. However I don&#039;t know enough about the details of PCI-E and emulation in general to tell if they are feasible or not.</p><p>The first idea is to &quot;softmod&quot; a GeForce to a Quadro by tapping in the vfio driver or pcie subsystem of the linux kernel. So instead of hardmodding the pci id with a soldering iron, you provide a fake pci id to the guest.</p><p>The second idea is mostly a hack. Since the nvidia driver checks the cpuid for hv_* features, would it be possible to patch qemu to change the cpuid during runtime? So during bootup when the nvidia driver is initialized, the hv_* features are hidden and only enabled after two minutes or via the qemu console.</p><p>Maybe @aw or others could comment if one of these approaches could work and which component of the stack needs to be patched.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474399">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474403" class="blockpost roweven"> <h2><span><span class="conr">#3204</span> <a href="viewtopic.php?pid=1474403#p1474403">2014-11-11 10:13:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>The first idea is to &quot;softmod&quot; a GeForce to a Quadro by tapping in the vfio driver or pcie subsystem of the linux kernel. So instead of hardmodding the pci id with a soldering iron, you provide a fake pci id to the guest.</p></div></blockquote></div><p><a href="http://www.eevblog.com/forum/chat/hacking-nvidia-cards-into-their-professional-counterparts/" rel="nofollow">http://www.eevblog.com/forum/chat/hacki … nterparts/</a><br />For SOME cards and vendors, you also need to provide the &quot;correct&quot; VBIOS. Interesting idea, actually.<br />It gets funnier as changing the PCI ID physically just makes the firmware blob work different, providing additional stuff. The chips are identical.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474403">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474404" class="blockpost rowodd"> <h2><span><span class="conr">#3205</span> <a href="viewtopic.php?pid=1474404#p1474404">2014-11-11 10:14:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><p>Is there a way to fix the new nvidia drivers looking for hyper-v parameters? possibly in future releases of qemu or from inside windows?</p></div></blockquote></div><p>Are you asking for a solution beyond simply not using hyper-v extensions?&#160; You might want to revert back to an old nvidia driver and test whether it would be worthwhile.&#160; I don&#039;t know of anyone looking a further solutions.&#160; If you need hyper-v extensions, nvidia professional series cards or AMD cards might be a better option.</p></div></blockquote></div><p>I see your point. But on the other hand I hate the fact that Nvidia is crippling the possible performance to boost sales of their professional series cards...</p><div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>I have been thinking about the whole nvidia situation and came up with two possible solutions. However I don&#039;t know enough about the details of PCI-E and emulation in general to tell if they are feasible or not.</p><p>The first idea is to &quot;softmod&quot; a GeForce to a Quadro by tapping in the vfio driver or pcie subsystem of the linux kernel. So instead of hardmodding the pci id with a soldering iron, you provide a fake pci id to the guest.</p><p>The second idea is mostly a hack. Since the nvidia driver checks the cpuid for hv_* features, would it be possible to patch qemu to change the cpuid during runtime? So during bootup when the nvidia driver is initialized, the hv_* features are hidden and only enabled after two minutes or via the qemu console.</p><p>Maybe @aw or others could comment if one of these approaches could work and which component of the stack needs to be patched.</p></div></blockquote></div><p>The first idea sounds doable, the second approach I agree seems like a flaky hack. But before trying to hack something together - Are there some numbers in which way the hyper-v enlightments increase the performance of a typical gaming machine scenario? There are some stats included in <a href="http://www.linux-kvm.org/wiki/images/0/0a/2012-forum-kvm_hyperv.pdf" rel="nofollow">http://www.linux-kvm.org/wiki/images/0/ … hyperv.pdf</a> which show partly significant differences, but it is not clear for me if these tests are relevant for a gaming rig?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474404">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474406" class="blockpost roweven"> <h2><span><span class="conr">#3206</span> <a href="viewtopic.php?pid=1474406#p1474406">2014-11-11 10:25:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>Are there some numbers in which way the hyper-v enlightments increase the performance of a typical gaming machine scenario? There are some stats included in <a href="http://www.linux-kvm.org/wiki/images/0/0a/2012-forum-kvm_hyperv.pdf" rel="nofollow">http://www.linux-kvm.org/wiki/images/0/ … hyperv.pdf</a> which show partly significant differences, but it is not clear for me if these tests are relevant for a gaming rig?</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1383040#p1383040" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1383040</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474406">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474413" class="blockpost rowodd"> <h2><span><span class="conr">#3207</span> <a href="viewtopic.php?pid=1474413#p1474413">2014-11-11 10:56:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Good afternoon everyone <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><strong>@aw</strong></p><p>Regarding X99 quirks , I recompiled 3.18-rc4 , and instead of adding the ACS patch , I edited the file &quot;drivers/pci/quirks.c&quot; and add these 2 lines :</p><div class="codebox"><pre><code>/* Wellsburg (X99) PCH */ 0x8d10, 0x8d16, 0x8d18, 0x8d1c,</code></pre></div><p>I added them exactly after the X79 ones . And it broke the large group just like the ACS patch did !</p><p>VMs rebooted fine , and system is stable (uptill now) .</p><p>lsgroup :</p><div class="codebox"><pre class="vscroll"><code>### Group 0 ### ff:0b.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 R3 QPI Link 0 &amp; 1 Monitoring [8086:2f81] (rev 02) ff:0b.1 Performance counters [1101]: Intel Corporation Xeon E5 v3/Core i7 R3 QPI Link 0 &amp; 1 Monitoring [8086:2f36] (rev 02) ff:0b.2 Performance counters [1101]: Intel Corporation Xeon E5 v3/Core i7 R3 QPI Link 0 &amp; 1 Monitoring [8086:2f37] (rev 02) ### Group 1 ### ff:0c.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe0] (rev 02) ff:0c.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe1] (rev 02) ff:0c.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe2] (rev 02) ff:0c.3 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe3] (rev 02) ff:0c.4 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe4] (rev 02) ff:0c.5 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Unicast Registers [8086:2fe5] (rev 02) ### Group 2 ### ff:0f.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Buffered Ring Agent [8086:2ff8] (rev 02) ff:0f.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Buffered Ring Agent [8086:2ff9] (rev 02) ff:0f.4 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 System Address Decoder &amp; Broadcast Registers [8086:2ffc] (rev 02) ff:0f.5 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 System Address Decoder &amp; Broadcast Registers [8086:2ffd] (rev 02) ff:0f.6 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 System Address Decoder &amp; Broadcast Registers [8086:2ffe] (rev 02) ### Group 3 ### ff:10.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 PCIe Ring Interface [8086:2f1d] (rev 02) ff:10.1 Performance counters [1101]: Intel Corporation Xeon E5 v3/Core i7 PCIe Ring Interface [8086:2f34] (rev 02) ff:10.5 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Scratchpad &amp; Semaphore Registers [8086:2f1e] (rev 02) ff:10.6 Performance counters [1101]: Intel Corporation Xeon E5 v3/Core i7 Scratchpad &amp; Semaphore Registers [8086:2f7d] (rev 02) ff:10.7 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Scratchpad &amp; Semaphore Registers [8086:2f1f] (rev 02) ### Group 4 ### ff:12.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Home Agent 0 [8086:2fa0] (rev 02) ff:12.1 Performance counters [1101]: Intel Corporation Xeon E5 v3/Core i7 Home Agent 0 [8086:2f30] (rev 02) ### Group 5 ### ff:13.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Target Address, Thermal &amp; RAS Registers [8086:2fa8] (rev 02) ff:13.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Target Address, Thermal &amp; RAS Registers [8086:2f71] (rev 02) ff:13.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder [8086:2faa] (rev 02) ff:13.3 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder [8086:2fab] (rev 02) ff:13.4 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder [8086:2fac] (rev 02) ff:13.5 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder [8086:2fad] (rev 02) ff:13.6 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO Channel 0/1 Broadcast [8086:2fae] (rev 02) ff:13.7 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO Global Broadcast [8086:2faf] (rev 02) ### Group 6 ### ff:14.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 0 Thermal Control [8086:2fb0] (rev 02) ff:14.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 1 Thermal Control [8086:2fb1] (rev 02) ff:14.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 0 ERROR Registers [8086:2fb2] (rev 02) ff:14.3 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 1 ERROR Registers [8086:2fb3] (rev 02) ff:14.6 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 0 &amp; 1 [8086:2fbe] (rev 02) ff:14.7 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 0 &amp; 1 [8086:2fbf] (rev 02) ### Group 7 ### ff:15.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 2 Thermal Control [8086:2fb4] (rev 02) ff:15.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 3 Thermal Control [8086:2fb5] (rev 02) ff:15.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 2 ERROR Registers [8086:2fb6] (rev 02) ff:15.3 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 0 Channel 3 ERROR Registers [8086:2fb7] (rev 02) ### Group 8 ### ff:16.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 1 Target Address, Thermal &amp; RAS Registers [8086:2f68] (rev 02) ff:16.6 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO Channel 2/3 Broadcast [8086:2f6e] (rev 02) ff:16.7 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO Global Broadcast [8086:2f6f] (rev 02) ### Group 9 ### ff:17.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Integrated Memory Controller 1 Channel 0 Thermal Control [8086:2fd0] (rev 02) ff:17.4 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 2 &amp; 3 [8086:2fb8] (rev 02) ff:17.5 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 2 &amp; 3 [8086:2fb9] (rev 02) ff:17.6 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 2 &amp; 3 [8086:2fba] (rev 02) ff:17.7 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 DDRIO (VMSE) 2 &amp; 3 [8086:2fbb] (rev 02) ### Group 10 ### ff:1e.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Power Control Unit [8086:2f98] (rev 02) ff:1e.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Power Control Unit [8086:2f99] (rev 02) ff:1e.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Power Control Unit [8086:2f9a] (rev 02) ff:1e.3 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Power Control Unit [8086:2fc0] (rev 02) ff:1e.4 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Power Control Unit [8086:2f9c] (rev 02) ### Group 11 ### ff:1f.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 VCU [8086:2f88] (rev 02) ff:1f.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 VCU [8086:2f8a] (rev 02) ### Group 12 ### 00:00.0 Host bridge [0600]: Intel Corporation Xeon E5 v3/Core i7 DMI2 [8086:2f00] (rev 02) ### Group 13 ### 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 1 [8086:2f02] (rev 02) ### Group 14 ### 00:02.0 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 2 [8086:2f04] (rev 02) ### Group 15 ### 00:02.2 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 2 [8086:2f06] (rev 02) ### Group 16 ### 00:03.0 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 3 [8086:2f08] (rev 02) ### Group 17 ### 00:03.2 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 3 [8086:2f0a] (rev 02) ### Group 18 ### 00:05.0 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Address Map, VTd_Misc, System Management [8086:2f28] (rev 02) 00:05.1 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 Hot Plug [8086:2f29] (rev 02) 00:05.2 System peripheral [0880]: Intel Corporation Xeon E5 v3/Core i7 RAS, Control Status and Global Errors [8086:2f2a] (rev 02) 00:05.4 PIC [0800]: Intel Corporation Xeon E5 v3/Core i7 I/O APIC [8086:2f2c] (rev 02) ### Group 19 ### 00:11.0 Unassigned class [ff00]: Intel Corporation C610/X99 series chipset SPSR [8086:8d7c] (rev 05) ### Group 20 ### 00:16.0 Communication controller [0780]: Intel Corporation C610/X99 series chipset MEI Controller #1 [8086:8d3a] (rev 05) ### Group 21 ### 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection (2) I218-V [8086:15a1] (rev 05) ### Group 22 ### 00:1a.0 USB controller [0c03]: Intel Corporation C610/X99 series chipset USB Enhanced Host Controller #2 [8086:8d2d] (rev 05) ### Group 23 ### 00:1b.0 Audio device [0403]: Intel Corporation C610/X99 series chipset HD Audio Controller [8086:8d20] (rev 05) ### Group 24 ### 00:1c.0 PCI bridge [0604]: Intel Corporation C610/X99 series chipset PCI Express Root Port #1 [8086:8d10] (rev d5) ### Group 25 ### 00:1c.3 PCI bridge [0604]: Intel Corporation C610/X99 series chipset PCI Express Root Port #4 [8086:8d16] (rev d5) ### Group 26 ### 00:1c.4 PCI bridge [0604]: Intel Corporation C610/X99 series chipset PCI Express Root Port #5 [8086:8d18] (rev d5) ### Group 27 ### 00:1c.6 PCI bridge [0604]: Intel Corporation C610/X99 series chipset PCI Express Root Port #7 [8086:8d1c] (rev d5) ### Group 28 ### 00:1d.0 USB controller [0c03]: Intel Corporation C610/X99 series chipset USB Enhanced Host Controller #1 [8086:8d26] (rev 05) ### Group 29 ### 00:1f.0 ISA bridge [0601]: Intel Corporation C610/X99 series chipset LPC Controller [8086:8d47] (rev 05) 00:1f.2 SATA controller [0106]: Intel Corporation C610/X99 series chipset 6-Port SATA Controller [AHCI mode] [8086:8d02] (rev 05) 00:1f.3 SMBus [0c05]: Intel Corporation C610/X99 series chipset SMBus Controller [8086:8d22] (rev 05) ### Group 30 ### 05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF119 [GeForce GT 610] [10de:104a] (rev a1) 05:00.1 Audio device [0403]: NVIDIA Corporation GF119 HDMI Audio Controller [10de:0e08] (rev a1) ### Group 31 ### 04:00.0 Serial Attached SCSI controller [0107]: LSI Logic / Symbios Logic SAS2008 PCI-Express Fusion-MPT SAS-2 [Falcon] [1000:0072] (rev 03) ### Group 32 ### 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) ### Group 33 ### 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GT218 [GeForce 210] [10de:0a65] (rev a2) 01:00.1 Audio device [0403]: NVIDIA Corporation High Definition Audio Controller [10de:0be3] (rev a1) ### Group 34 ### 07:00.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:118f] ### Group 35 ### 08:01.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:118f] 09:00.0 Ethernet controller [0200]: Intel Corporation I211 Gigabit Network Connection [8086:1539] (rev 03) ### Group 36 ### 08:02.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:118f] 0a:00.0 Network controller [0280]: Broadcom Corporation BCM4360 802.11ac Wireless Network Adapter [14e4:43a0] (rev 03) ### Group 37 ### 08:03.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:118f] ### Group 38 ### 08:04.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:118f] ### Group 39 ### 0d:00.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch [10b5:8608] (rev ba) ### Group 40 ### 0e:01.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch [10b5:8608] (rev ba) ### Group 41 ### 0e:05.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch [10b5:8608] (rev ba) ### Group 42 ### 0e:07.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch [10b5:8608] (rev ba) ### Group 43 ### 0e:09.0 PCI bridge [0604]: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch [10b5:8608] (rev ba) ### Group 44 ### 0f:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02) ### Group 45 ### 10:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02) ### Group 46 ### 11:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02) ### Group 47 ### 12:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02) ### Group 48 ### 13:00.0 USB controller [0c03]: ASMedia Technology Inc. ASM1042A USB 3.0 Host Controller [1b21:1142]</code></pre></div><p>So I think it is safe to add these to the quirks file upstream . </p><p>Thank you .</p><p>EDIT :</p><p>When rebooting the host I recieve :</p><div class="codebox"><pre><code>genirq: Flags mismatch irq 17. 00000000 (vfio-intx(0000:10:00.0)) vs. 00000000 (vfio-intx(0000:0f:00.0))</code></pre></div><p>And it is related to the USB PCI-E card I installed two days ago . This error prevents my 2nd VM from launching (It shares another controller from the same USB PCI-E card)</p><p>Tried booting with &quot;options vfio_pci nointxmask=1&quot; , both VMs boot fine , but the sound becomes choppy and useless .</p> <p class="postedit"><em>Last edited by Denso (2014-11-11 11:20:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474413">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474414" class="blockpost roweven"> <h2><span><span class="conr">#3208</span> <a href="viewtopic.php?pid=1474414#p1474414">2014-11-11 10:56:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>Are there some numbers in which way the hyper-v enlightments increase the performance of a typical gaming machine scenario? There are some stats included in <a href="http://www.linux-kvm.org/wiki/images/0/0a/2012-forum-kvm_hyperv.pdf" rel="nofollow">http://www.linux-kvm.org/wiki/images/0/ … hyperv.pdf</a> which show partly significant differences, but it is not clear for me if these tests are relevant for a gaming rig?</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1383040#p1383040" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1383040</a></p></div></blockquote></div><p>Doh... 20%! That&#039;s definitely worth a closer look - Thanks for the pointer.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474414">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474416" class="blockpost rowodd"> <h2><span><span class="conr">#3209</span> <a href="viewtopic.php?pid=1474416#p1474416">2014-11-11 10:56:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah from my experience is also about 20% on cpu bound applications (dota2).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474416">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474423" class="blockpost roweven"> <h2><span><span class="conr">#3210</span> <a href="viewtopic.php?pid=1474423#p1474423">2014-11-11 11:57:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Do i have to explicitly enable hyper-v extensions(enlightenment or what it&#039;s called), or it is automatically added if i use -cpu host?(provided i have an AMD trinity CPU)</p> <p class="postedit"><em>Last edited by Duelist (2014-11-11 11:58:29)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474423">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474435" class="blockpost rowodd"> <h2><span><span class="conr">#3211</span> <a href="viewtopic.php?pid=1474435#p1474435">2014-11-11 12:18:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah u must enable it, with hv-time option (-cpu host,hv-time) if i remember correctly.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474435">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474438" class="blockpost roweven"> <h2><span><span class="conr">#3212</span> <a href="viewtopic.php?pid=1474438#p1474438">2014-11-11 12:29:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Yeah u must enable it, with hv-time option (-cpu host,hv-time) if i remember correctly.</p></div></blockquote></div><p>But i can&#039;t find it in -cpu help. Does AMD support these at all? There is &quot;hypervisor&quot; CPUID flag in qemu-system-x86-64 -cpu help list.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474438">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474442" class="blockpost rowodd"> <h2><span><span class="conr">#3213</span> <a href="viewtopic.php?pid=1474442#p1474442">2014-11-11 12:36:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>You need to make sure you are using virtio disk in xml, then add ide cd-rom with virtio-drivers... like here </p><div class="quotebox"><blockquote><div><p>&lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/mnt/hdd2/win8.img&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/mnt/hdd/INSTALL/en_windows_8.1_professional_vl_with_update_x64_dvd_4065194.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/mnt/hdd/INSTALL/virtio-win-0.1-81.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;</p></div></blockquote></div><p>At windows setup, when it asks where to install, choose load driver and then point it to mounted cd-rom with viritio drivers.</p></div></blockquote></div><br /><p>Hi there! Thanks for posting part of your XML file. Unfortunately, it didn&#039;t work. Not only did it not ask for the virtio Drivers, it also doesn&#039;t find my storage - a physical device. This is part of my XML file where I made some changes:</p><br /><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039;&gt;<br />&#160; &lt;name&gt;win8.1&lt;/name&gt;<br />&#160; &lt;uuid&gt;502f5be4-0126-4a32-8d63-3f8d06a1c80a&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &#160; &lt;loader type=&#039;pflash&#039;&gt;/var/lib/libvirt/images/win8.1-OVMF.fd&lt;/loader&gt;<br />&#160; &lt;/os&gt;<br />....<br />&#160; &#160;&lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source dev=&#039;/dev/mapper/VG-kvmwin&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/root/windows.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;3&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/root/virtio.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;</p></div></blockquote></div><p>Can you please have a look? Is there something missing or wrong? Thank you very much!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474442">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474497" class="blockpost roweven"> <h2><span><span class="conr">#3214</span> <a href="viewtopic.php?pid=1474497#p1474497">2014-11-11 16:37:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><p>Is there a way to fix the new nvidia drivers looking for hyper-v parameters? possibly in future releases of qemu or from inside windows?</p></div></blockquote></div><p>Are you asking for a solution beyond simply not using hyper-v extensions?&#160; You might want to revert back to an old nvidia driver and test whether it would be worthwhile.&#160; I don&#039;t know of anyone looking a further solutions.&#160; If you need hyper-v extensions, nvidia professional series cards or AMD cards might be a better option.</p></div></blockquote></div><p>I have been thinking about the whole nvidia situation and came up with two possible solutions. However I don&#039;t know enough about the details of PCI-E and emulation in general to tell if they are feasible or not.</p><p>The first idea is to &quot;softmod&quot; a GeForce to a Quadro by tapping in the vfio driver or pcie subsystem of the linux kernel. So instead of hardmodding the pci id with a soldering iron, you provide a fake pci id to the guest.</p><p>The second idea is mostly a hack. Since the nvidia driver checks the cpuid for hv_* features, would it be possible to patch qemu to change the cpuid during runtime? So during bootup when the nvidia driver is initialized, the hv_* features are hidden and only enabled after two minutes or via the qemu console.</p><p>Maybe @aw or others could comment if one of these approaches could work and which component of the stack needs to be patched.</p></div></blockquote></div><p>I&#039;m going to tread lightly here, but I will confirm that PCI config space of assigned devices is a combination of direct passthrough, emulation, and virtualization.&#160; PCI SR-IOV devices, by the spec, don&#039;t actually have PCI vendor and device IDs, it&#039;s up to system software/VMM to provide them.&#160; Likewise, it&#039;s a trivial matter to virtualize the PCI config space IDs - <a href="http://fpaste.org/149722/72280914/" rel="nofollow">http://fpaste.org/149722/72280914/</a>&#160; In the vast majority of cases, modifying the vendor ID is a bad idea, but I include it to be complete.</p><p>On a completely separate note, I&#039;ll mention that PCI device IDs are also stored in the PCI ROM and the ROM includes a checksum.&#160; In the <strong>unlikely</strong> event that you want to expose the ROM on a modified device, the device ID and checksum need to be updated.</p><p>Also note that supported Quadro devices operate in a secondary graphics mode, ie. in addition to emulated VGA.&#160; I&#039;ve also never had much luck getting them to work on Q35 machine types, but it&#039;s on my todo list to look further into the Code 12 they get there.&#160; They work fine on a 440FX machine.</p><p>I don&#039;t think we have much opportunity to try to be creative in exposing hyper-v features, both the core guest OS and the graphics driver are going to be probing this at similar times and I doubt we have much visibility to which is calling for it.&#160; I also tried to do some benchmarks with Unigine/3DMark so I could complain properly about the change, but I was unable to come up with a significant difference.&#160; Perhaps this is because they&#039;re just benchmarks, maybe it&#039;s real.&#160; We did note a while ago a fairly significant differences in Borderlands2, but that was also when we were fighting the lazy debug register use.&#160; That 20% number might be much, much smaller now that we&#039;ve optimized that path in the hypervisor.&#160; It should be easy for someone to back down to a pre-340 driver version and test with and without hyper-v extensions for various games.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474497">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474501" class="blockpost rowodd"> <h2><span><span class="conr">#3215</span> <a href="viewtopic.php?pid=1474501#p1474501">2014-11-11 16:48:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Good afternoon everyone <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><strong>@aw</strong></p><p>Regarding X99 quirks , I recompiled 3.18-rc4 , and instead of adding the ACS patch , I edited the file &quot;drivers/pci/quirks.c&quot; and add these 2 lines :</p><div class="codebox"><pre><code>/* Wellsburg (X99) PCH */ 0x8d10, 0x8d16, 0x8d18, 0x8d1c,</code></pre></div><p>I added them exactly after the X79 ones . And it broke the large group just like the ACS patch did !</p><p>VMs rebooted fine , and system is stable (uptill now) .</p><p>lsgroup :</p><div class="codebox"><pre><code>&lt;snip&gt;</code></pre></div><p>So I think it is safe to add these to the quirks file upstream .</p></div></blockquote></div><p>The groups are going to be split by that patch regardless of whether it&#039;s safe to do so.&#160; We still need to wait for confirmation from Intel that X99 PCH root ports use the same programming algorithm and most importantly, provide the required isolation.</p><div class="quotebox"><blockquote><div><p>EDIT :</p><p>When rebooting the host I recieve :</p><div class="codebox"><pre><code>genirq: Flags mismatch irq 17. 00000000 (vfio-intx(0000:10:00.0)) vs. 00000000 (vfio-intx(0000:0f:00.0))</code></pre></div><p>And it is related to the USB PCI-E card I installed two days ago . This error prevents my 2nd VM from launching (It shares another controller from the same USB PCI-E card)</p><p>Tried booting with &quot;options vfio_pci nointxmask=1&quot; , both VMs boot fine , but the sound becomes choppy and useless .</p></div></blockquote></div><p>When you rebooted the host you saw this error, or do you mean after you rebooted with the new quirk you ran into this problem.&#160; The description doesn&#039;t make much sense to me.&#160; The error indicates that both devices tried to register with no flags (00000000), which I think means exclusive IRQ, which means the INTx disable masking test failed.&#160; By using nointxmask=1, you&#039;re telling vfio to use the same path that it should have been using based on those flags, so I&#039;m not sure why it makes a difference.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474501">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474519" class="blockpost roweven"> <h2><span><span class="conr">#3216</span> <a href="viewtopic.php?pid=1474519#p1474519">2014-11-11 18:13:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I tested couple of games on 340 driver with hyperv on, and most games and benchmarks use GPU at 100% and CPU not so much, so that might be reason why u don&#039;t see much difference, as I said before Dota2 that depends on single/dual core performance works 20% better with hyperv on.</p> <p class="postedit"><em>Last edited by slis (2014-11-11 18:17:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474519">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474542" class="blockpost rowodd"> <h2><span><span class="conr">#3217</span> <a href="viewtopic.php?pid=1474542#p1474542">2014-11-11 20:14:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>By the way, how do you guys enable hyperv? Im trying &quot;-cpu host,hv-time&quot; and its always saying that is is running as a VM in task manager?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474542">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474566" class="blockpost roweven"> <h2><span><span class="conr">#3218</span> <a href="viewtopic.php?pid=1474566#p1474566">2014-11-11 21:50:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>When you rebooted the host you saw this error, or do you mean after you rebooted with the new quirk you ran into this problem.&#160; The description doesn&#039;t make much sense to me.&#160; The error indicates that both devices tried to register with no flags (00000000), which I think means exclusive IRQ, which means the INTx disable masking test failed.&#160; By using nointxmask=1, you&#039;re telling vfio to use the same path that it should have been using based on those flags, so I&#039;m not sure why it makes a difference.</p></div></blockquote></div><p>It happened before and after I applied the new quirk . Sorry for not mentioning that <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>It works with nointxmask=1 , but with sound being choppy and slow .</p><p>Also this might be related :</p><div class="codebox"><pre class="vscroll"><code>Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 73 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 73 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 74 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 73 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 74 for MSI/MSI-X Nov 10 13:31:27 srv1 kernel: vfio-pci 0000:0f:00.0: irq 75 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 73 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 67 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 68 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 69 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 70 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 71 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 72 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 73 for MSI/MSI-X Nov 10 13:31:47 srv1 kernel: vfio-pci 0000:10:00.0: irq 74 for MSI/MSI-X</code></pre></div><p>Sorry for my lack of knowledge , but I see that both devices use some identical IRQs . Maybe that&#039;s the issue here ?</p><p>EDIT :</p><p>One side note , I use these modules options /etc/modprobe.d/kvm.conf :</p><div class="codebox"><pre><code>options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div> <p class="postedit"><em>Last edited by Denso (2014-11-11 21:53:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474566">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474596" class="blockpost rowodd"> <h2><span><span class="conr">#3219</span> <a href="viewtopic.php?pid=1474596#p1474596">2014-11-11 22:52:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>By the way, how do you guys enable hyperv? Im trying &quot;-cpu host,hv-time&quot; and its always saying that is is running as a VM in task manager?</p></div></blockquote></div><p>hv-time enables one of the hyper-v <strong>extensions</strong>, iow the guest thinks that it&#039;s running on the hyper-v hypervisor and enables some paravirtual features for the hypervisor.&#160; KVM also supports these features.&#160; AFAIK, nobody here is attempting to run hyper-v inside a KVM guest.&#160; That might be possible with nested virtualization support, but it&#039;s not really relevant to the topic in this thread.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474596">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474602" class="blockpost roweven"> <h2><span><span class="conr">#3220</span> <a href="viewtopic.php?pid=1474602#p1474602">2014-11-11 22:59:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>By the way, how do you guys enable hyperv? Im trying &quot;-cpu host,hv-time&quot; and its always saying that is is running as a VM in task manager?</p></div></blockquote></div><p>hv-time enables one of the hyper-v <strong>extensions</strong>, iow the guest thinks that it&#039;s running on the hyper-v hypervisor and enables some paravirtual features for the hypervisor.&#160; KVM also supports these features.&#160; AFAIK, nobody here is attempting to run hyper-v inside a KVM guest.&#160; That might be possible with nested virtualization support, but it&#039;s not really relevant to the topic in this thread.</p></div></blockquote></div><p>Yeah I&#039;m sorry that its not relevant. What I want is nested virtualization. I thought it&#039;s easy-peasy for everyone here? It shouldn&#039;t be that hard.. I added &quot;kvm-intel.nested=1&quot; to grub and thats all someone can do I believe?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474602">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474603" class="blockpost rowodd"> <h2><span><span class="conr">#3221</span> <a href="viewtopic.php?pid=1474603#p1474603">2014-11-11 23:03:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>By the way, how do you guys enable hyperv? Im trying &quot;-cpu host,hv-time&quot; and its always saying that is is running as a VM in task manager?</p></div></blockquote></div><p>hv-time enables one of the hyper-v <strong>extensions</strong>, iow the guest thinks that it&#039;s running on the hyper-v hypervisor and enables some paravirtual features for the hypervisor.&#160; KVM also supports these features.&#160; AFAIK, nobody here is attempting to run hyper-v inside a KVM guest.&#160; That might be possible with nested virtualization support, but it&#039;s not really relevant to the topic in this thread.</p></div></blockquote></div><p>Yeah I&#039;m sorry that its not relevant. What I want is nested virtualization. I thought it&#039;s easy-peasy for everyone here? It shouldn&#039;t be that hard.. I added &quot;kvm-intel.nested=1&quot; to grub and thats all someone can do I believe?</p></div></blockquote></div><p>You might need to add +vmx to your -cpu parameters for QEMU</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474603">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474604" class="blockpost roweven"> <h2><span><span class="conr">#3222</span> <a href="viewtopic.php?pid=1474604#p1474604">2014-11-11 23:05:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>hv-time enables one of the hyper-v <strong>extensions</strong>, iow the guest thinks that it&#039;s running on the hyper-v hypervisor and enables some paravirtual features for the hypervisor.&#160; KVM also supports these features.&#160; AFAIK, nobody here is attempting to run hyper-v inside a KVM guest.&#160; That might be possible with nested virtualization support, but it&#039;s not really relevant to the topic in this thread.</p></div></blockquote></div><p>Yeah I&#039;m sorry that its not relevant. What I want is nested virtualization. I thought it&#039;s easy-peasy for everyone here? It shouldn&#039;t be that hard.. I added &quot;kvm-intel.nested=1&quot; to grub and thats all someone can do I believe?</p></div></blockquote></div><p>You might need to add +vmx to your -cpu parameters for QEMU</p></div></blockquote></div><p>Oh forgot. And that yes. Those 2 things. Even with that it doesnt work.</p><p>But +vmx is already enabled if its one of the supported features by the CPU (it doesnt emulate it, but pass it through).</p><p>EDIT: I&#039;m using i7-4790S. In ESXi theres an option for this and it then shows normally in task manager like it would be running bare-metal - with L1,L2,L3 cache sizes... Where in here it shows it is running as a VM)</p> <p class="postedit"><em>Last edited by devianceluka (2014-11-11 23:07:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474610" class="blockpost rowodd"> <h2><span><span class="conr">#3223</span> <a href="viewtopic.php?pid=1474610#p1474610">2014-11-11 23:26:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86620">dakabali</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dear all,</p><p>I&#039;ve succeded in setting up PCI passthrough with a Gigabyte board, i7 3770 (integrated iGPU) and a Gigabyte GTX Titan OC card. Now, I&#039;m trying to use the same board with a Xeon 1390v2 (no iGPU) the same Gigabyte Titan OC card and a second video card (Gigabyte GT 730). So basically two Nvidia cards installed. I would like to passthrough the Titan which sits in 0000:0100.0. Unfortunately I get the following errors in dmesg while getting black screen on the second monitor:</p><p>[&#160; 113.148867] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900<br />[&#160; 113.150151] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0x98000000-0x99ffffff 64bit pref]<br />[&#160; 113.150980] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002)<br />[&#160; 116.098894] vfio-pci 0000:01:00.0: Invalid ROM contents<br />[&#160; 116.099019] vfio-pci 0000:01:00.0: Invalid ROM contents</p><p>I&#039;m using the linux-mainline package incl. ACS patch. Thx.</p> <p class="postedit"><em>Last edited by dakabali (2014-11-11 23:27:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474610">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474612" class="blockpost roweven"> <h2><span><span class="conr">#3224</span> <a href="viewtopic.php?pid=1474612#p1474612">2014-11-11 23:35:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><p>Dear all,</p><p>I&#039;ve succeded in setting up PCI passthrough with a Gigabyte board, i7 3770 (integrated iGPU) and a Gigabyte GTX Titan OC card. Now, I&#039;m trying to use the same board with a Xeon 1390v2 (no iGPU) the same Gigabyte Titan OC card and a second video card (Gigabyte GT 730). So basically two Nvidia cards installed. I would like to passthrough the Titan which sits in 0000:0100.0. Unfortunately I get the following errors in dmesg while getting black screen on the second monitor:</p><p>[&#160; 113.148867] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900<br />[&#160; 113.150151] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0x98000000-0x99ffffff 64bit pref]<br />[&#160; 113.150980] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002)<br />[&#160; 116.098894] vfio-pci 0000:01:00.0: Invalid ROM contents<br />[&#160; 116.099019] vfio-pci 0000:01:00.0: Invalid ROM contents</p><p>I&#039;m using the linux-mainline package incl. ACS patch. Thx.</p></div></blockquote></div><p>Try passing a ROM file using :</p><p>romfile=/PATH/TO/ROM/FILE.rom</p><p>Like this :</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.0,multifunction=on,romfile=/PATH/TO/ROM/FILE.rom</code></pre></div><p>You can obtain ROM files from TechPowerUp website .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1474634" class="blockpost rowodd"> <h2><span><span class="conr">#3225</span> <a href="viewtopic.php?pid=1474634#p1474634">2014-11-12 01:08:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86620">dakabali</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><p>Dear all,</p><p>I&#039;ve succeded in setting up PCI passthrough with a Gigabyte board, i7 3770 (integrated iGPU) and a Gigabyte GTX Titan OC card. Now, I&#039;m trying to use the same board with a Xeon 1390v2 (no iGPU) the same Gigabyte Titan OC card and a second video card (Gigabyte GT 730). So basically two Nvidia cards installed. I would like to passthrough the Titan which sits in 0000:0100.0. Unfortunately I get the following errors in dmesg while getting black screen on the second monitor:</p><p>[&#160; 113.148867] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900<br />[&#160; 113.150151] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0x98000000-0x99ffffff 64bit pref]<br />[&#160; 113.150980] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002)<br />[&#160; 116.098894] vfio-pci 0000:01:00.0: Invalid ROM contents<br />[&#160; 116.099019] vfio-pci 0000:01:00.0: Invalid ROM contents</p><p>I&#039;m using the linux-mainline package incl. ACS patch. Thx.</p></div></blockquote></div><p>Try passing a ROM file using :</p><p>romfile=/PATH/TO/ROM/FILE.rom</p><p>Like this :</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.0,multifunction=on,romfile=/PATH/TO/ROM/FILE.rom</code></pre></div><p>You can obtain ROM files from TechPowerUp website .</p></div></blockquote></div><p>Hello,</p><p>thanks for the quick answer. Getting the card rom helped to eliminate the errors regarding the &quot;Invalid ROM contents&quot;. However, the situation didn&#039;t change - still no signal on the second monitor. Instead of enabling my Titan card /should be something like &quot; vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0001)&quot; like for the audio 01:00.1/ it drops a memory reservation error:</p><p>[&#160; 179.361851] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900<br />[&#160; 179.363102] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0x98000000-0x99ffffff 64bit pref]<br />[&#160; 179.365305] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002)</p><p>Furthermore starting Qemu says: &quot;VFIO 0000:01:00.0 BAR 3 mmap unsupported. Performance may be slow&quot;</p><p>Any idea? Thx.</p> <p class="postedit"><em>Last edited by dakabali (2014-11-12 01:08:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1474634">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=128">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=127">127</a> <a href="viewtopic.php?id=162768&amp;p=128">128</a> <strong>129</strong> <a href="viewtopic.php?id=162768&amp;p=130">130</a> <a href="viewtopic.php?id=162768&amp;p=131">131</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=130">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
