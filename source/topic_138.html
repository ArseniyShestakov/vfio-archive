<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 138) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=138" title="Page 138" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=137" title="Page 137" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=139" title="Page 139" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=137">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <a href="viewtopic.php?id=162768&amp;p=137">137</a> <strong>138</strong> <a href="viewtopic.php?id=162768&amp;p=139">139</a> <a href="viewtopic.php?id=162768&amp;p=140">140</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=139">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1479142" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3426</span> <a href="viewtopic.php?pid=1479142#p1479142">2014-11-25 19:24:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I am trying to use Virtio as a standard for network. I followed the libvirt wiki page (<a href="http://wiki.libvirt.org/page/Virtio" rel="nofollow">http://wiki.libvirt.org/page/Virtio</a>), but I couldn&#039;t make it work.</p><p>this is how my network configuration looks right now:</p><div class="quotebox"><blockquote><div><p>&lt;interface type=&#039;direct&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:f3:27:c5&#039;/&gt;<br />&#160; &#160; &#160; &lt;source dev=&#039;eno1&#039; mode=&#039;bridge&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;rtl8139&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;</p></div></blockquote></div><p>can someone please help me use Virtio for networking? Thanks a lot!</p> <p class="postedit"><em>Last edited by 4kGamer (2014-11-25 19:42:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479142">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479173" class="blockpost roweven"> <h2><span><span class="conr">#3427</span> <a href="viewtopic.php?pid=1479173#p1479173">2014-11-25 20:24:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am having a reproducable race-condition resulting in multiple kernel panics/oopses under the following condition:</p><p>- Use 3.17.2 kernel from OP (need it due to i915 arbiter mess)<br />- use systemd service to assign VGA card to vfio:</p><div class="codebox"><pre><code># /etc/systemd/system/vfio.service [Unit] Description=Binds devices to vfio-pci After=syslog.target [Service] EnvironmentFile=-/etc/vfio-pci.cfg Type=oneshot RemainAfterExit=yes ExecStart=-/usr/bin/vfio-bind $DEVICES [Install] WantedBy=multi-user.target</code></pre></div><p>Contents of /etc/vfio-pci.cfg:</p><div class="codebox"><pre><code>DEVICES=&quot;0000:01:00.0 0000:01:00.1&quot;</code></pre></div><p>vfio-bind script:</p><div class="codebox"><pre><code>#!/bin/bash modprobe vfio-pci for dev in &quot;$@&quot;; do vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done</code></pre></div><p>Kernel freaks out when trying to start kdm service (probably the underlying X is causing the problem) in parallel with the vfio service. If i disable them and start them manually one after the other everything is fine, no matter what sequence.</p><p>Now I know there are ways to workaround this, and it is not really a big deal for me. <br />My actual question is rather if this indicates a real/serious bug in the kernel or if this is somehow expected behaviour with the current setup which just should be accepted/ignored? Should I try to track this down in more detail and open a bug somewhere?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479173">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479255" class="blockpost rowodd"> <h2><span><span class="conr">#3428</span> <a href="viewtopic.php?pid=1479255#p1479255">2014-11-25 23:01:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86620">dakabali</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I&#039;ve made the next step in improving my configuration. After setting up a working PCI passthrough I connected a USB sound card (Creative OMNI Surround 5.1) to the virtual Windows 8.1 machine. It works, however the quality of the sound is not satisfying. It is noisy and seems to depend on the CPU because as the games start the quality decreases. Before going into the details in this forum: can it have something to do with the PCI and/or USB hardware delegations at all? Unfortunately I&#039;ve got no other PC where I could try a non-virtualized setup. Any experience? Thx.</p><p>EDIT:&#160; long story short --&gt; the USB passthrough seems to be very noisy which is ok for mouse and keyboard connections but disturbing for HDA. The solution was to send back the OMNI Surround 5.1 and purchase a PCI Creative Sound Blaster Zx. Having used pci-stub I managed to hide the sound card in Arch and delegate it to Win8.1 in KVM. Without stub the front speakers won&#039;t work as Linux reserves the stereo channels by default. Sorry for this off-topic because - as it came out at the end - this has nothing to do with VGA PCI passthrough at all.</p> <p class="postedit"><em>Last edited by dakabali (2014-12-10 17:55:33)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479255">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479284" class="blockpost roweven"> <h2><span><span class="conr">#3429</span> <a href="viewtopic.php?pid=1479284#p1479284">2014-11-26 02:31:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86478">snarfies</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-05</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How does one install the linux-mainline-3.17.2.tar.gz on the front page?</p><p>I tried pacman -U, but it gave me:</p><p>error: missing package metadata in /home/erik/linux-mainline-3.17.2.tar.gz<br />error: &#039;/home/erik/linux-mainline-3.17.2.tar.gz&#039;: invalid or corrupted package</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479284">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479316" class="blockpost rowodd"> <h2><span><span class="conr">#3430</span> <a href="viewtopic.php?pid=1479316#p1479316">2014-11-26 07:55:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>snarfies wrote:</cite><blockquote><div><p>How does one install the linux-mainline-3.17.2.tar.gz on the front page?</p><p>I tried pacman -U, but it gave me:</p><p>error: missing package metadata in /home/erik/linux-mainline-3.17.2.tar.gz<br />error: &#039;/home/erik/linux-mainline-3.17.2.tar.gz&#039;: invalid or corrupted package</p></div></blockquote></div><p>It&#039;s source package, not an actual one. You need to build it with makepkg.</p><div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi,</p><p>I am trying to use Virtio as a standard for network. I followed the libvirt wiki page (<a href="http://wiki.libvirt.org/page/Virtio" rel="nofollow">http://wiki.libvirt.org/page/Virtio</a>), but I couldn&#039;t make it work.</p><p>this is how my network configuration looks right now:</p><p>&#160; &#160; &lt;interface type=&#039;direct&#039;&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;mac address=&#039;52:54:00:f3:27:c5&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;source dev=&#039;eno1&#039; mode=&#039;bridge&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;model type=&#039;rtl8139&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;/interface&gt;</p><p>can someone please help me use Virtio for networking? Thanks a lot!</p></div></blockquote></div><p>Change rtl8139 to virtio. Done.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479316">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479322" class="blockpost roweven"> <h2><span><span class="conr">#3431</span> <a href="viewtopic.php?pid=1479322#p1479322">2014-11-26 08:10:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah I tried that. I got no connection then ...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479322">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479350" class="blockpost rowodd"> <h2><span><span class="conr">#3432</span> <a href="viewtopic.php?pid=1479350#p1479350">2014-11-26 09:26:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86931">Kironide</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-26</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I know that VGA passthrough using Xen has some issues when AMD graphics cards are used, namely, the guest OS cannot be rebooted.</p><p>My curiosity lies in the question of whether the same issue is present when using QEMU for VGA passthrough. I would imagine not, but I felt it best to make sure.</p><p>Best regards,</p><p>Kironide</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479350">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479357" class="blockpost roweven"> <h2><span><span class="conr">#3433</span> <a href="viewtopic.php?pid=1479357#p1479357">2014-11-26 09:48:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>go here: <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a></p><p>reboots do work under Xen</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479357">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479368" class="blockpost rowodd"> <h2><span><span class="conr">#3434</span> <a href="viewtopic.php?pid=1479368#p1479368">2014-11-26 10:19:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>I am having a reproducable race-condition resulting in multiple kernel panics/oopses under the following condition:</p><p>Contents of /etc/vfio-pci.cfg:</p><div class="codebox"><pre><code>DEVICES=&quot;0000:01:00.0 0000:01:00.1&quot;</code></pre></div></div></blockquote></div><p>This looks funny, are you sure these are correct device IDs for your graphics card and its audio when you run lspci -l on host ? Are they bound to pci-stub on system startup ?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479370" class="blockpost roweven"> <h2><span><span class="conr">#3435</span> <a href="viewtopic.php?pid=1479370#p1479370">2014-11-26 10:28:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>mine looks exactly the same</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479370">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479371" class="blockpost rowodd"> <h2><span><span class="conr">#3436</span> <a href="viewtopic.php?pid=1479371#p1479371">2014-11-26 10:39:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi,</p><p>I am trying to use Virtio as a standard for network. I followed the libvirt wiki page (<a href="http://wiki.libvirt.org/page/Virtio" rel="nofollow">http://wiki.libvirt.org/page/Virtio</a>), but I couldn&#039;t make it work.</p><p>this is how my network configuration looks right now:</p><p>&#160; &#160; &lt;interface type=&#039;direct&#039;&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;mac address=&#039;52:54:00:f3:27:c5&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;source dev=&#039;eno1&#039; mode=&#039;bridge&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;model type=&#039;rtl8139&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;/interface&gt;</p><p>can someone please help me use Virtio for networking? Thanks a lot!</p></div></blockquote></div><p>Change rtl8139 to virtio. Done.</p></div></blockquote></div><p>Just to be more precise: Windows 8.1 DOES start, but I got no internet connection then.</p> <p class="postedit"><em>Last edited by 4kGamer (2014-11-26 10:45:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479371">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479375" class="blockpost roweven"> <h2><span><span class="conr">#3437</span> <a href="viewtopic.php?pid=1479375#p1479375">2014-11-26 10:55:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Hi all,</p><p>I have a working setup based on Intel CPU and Z77 chipset + GTX 970 as graphic cards. However I have one question, and one issue.</p><p>First, here is my question: whats the point using a bios dump (from graphic card) in the qemu command-line? I am not doing it yet and everything seems ok. Good performance, VM reboots ok, etc. <strong>FIXED</strong></p><p>Then, my little issue. I have an USB sound card : Asus Xonar U7. If I use it on a USB hub (shared with my mouse + keyboard), then I have some sound issues. It stutters sometimes, and causes lag. Only happens during games; never while watching a movie / youtube / listening to music.<br />I decided to go with emulated audio (cf. command line below). Now i non longer have those sound / lags issue. However I have a little latency in sound. All the time. The sound occurs half a second (or even less) after the real action. I tried with various PA samples from 128 to 16384 (cf. command line). 128 to 512 is unusable, audio lag and video lag. And high values (above 4096) make the latency higher. So far, it seems that the best value is 1024.</p><p>Do you have any idea what to do? </p><p>Let me know if you need additional information.<br />Thanks in advance.</p><p>Edit ; HDMI audio is not a solution since my screen as no audio jack output (and on screen&#039;s speaker are just horrible).</p><p>Command line:</p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=1024 QEMU_AUDIO_DRV=pa \ qemu-system-x86_64 -name game -M q35 -enable-kvm \ -mem-path /dev/hugepages \ -balloon virtio \ -nographic \ -m 16384 \ -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin -realtime mlock=on -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=pcie.0 \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/guest/Windaube_7,id=sys,format=raw -device scsi-hd,drive=sys \ -drive file=/dev/guest/win7,id=data,format=raw -device scsi-hd,drive=data \ -device vfio-pci,host=00:1d.0,bus=pcie.0 \ -device virtio-scsi-pci,id=scsi2 \ -net nic,model=virtio,macaddr=52:54:00:7c:3c:42 -net bridge,br=virbr0 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0</code></pre></div></div></blockquote></div><p>Sorry to bump, but if anyone has any idea on the sound part, I&#039;ll be very happy.</p> <p class="postedit"><em>Last edited by Nesousx (2014-11-26 10:55:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479375">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479384" class="blockpost rowodd"> <h2><span><span class="conr">#3438</span> <a href="viewtopic.php?pid=1479384#p1479384">2014-11-26 11:57:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>First I&#039;d like thank you for this great post and the valuable information posted here.</p><p>I&#039;m trying to get vga passthrough work on ubuntu 14.10, I know here is a Arch Linux forum sorry if I&#039;m being rude or something.</p><p>My setup is the follow:</p><p>Core i7 4770S<br />Gigabyte GA-B85M-D3PH<br />Nvidia Geforce GT630 1GB<br />AMD R7 250 2GB</p><p>I&#039;ve tried to passthrough both gpus, but I can&#039;t get video signal from DVI output connected to VGAs.</p><p>I think the problem is related to missing i915 arbiter patch, I haven&#039;t found the 915 patch for 3.16 kernel which is the ubuntu 14.10 default kernel. </p><p>Does someone has the i915 arbiter patch for 3.16 kernel?</p><p>Thank you</p> <p class="postedit"><em>Last edited by bpbastos (2014-11-26 11:58:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479384">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479386" class="blockpost roweven"> <h2><span><span class="conr">#3439</span> <a href="viewtopic.php?pid=1479386#p1479386">2014-11-26 11:58:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Just to be more precise: Windows 8.1 DOES start, but I got no internet connection then.</p></div></blockquote></div><p>you need to install virtio network drivers form virtio drivers iso.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479386">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479387" class="blockpost rowodd"> <h2><span><span class="conr">#3440</span> <a href="viewtopic.php?pid=1479387#p1479387">2014-11-26 12:01:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Do you have any idea what to do? </p><br /><br /><p>Sorry to bump, but if anyone has any idea on the sound part, I&#039;ll be very happy.</p></div></blockquote></div><p>How do u pass usb devices? i have had same problem with -usb device, but passing whole INTEL usb controller with vifio worked flawlessly.</p> <p class="postedit"><em>Last edited by slis (2014-11-26 12:08:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479388" class="blockpost roweven"> <h2><span><span class="conr">#3441</span> <a href="viewtopic.php?pid=1479388#p1479388">2014-11-26 12:05:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><p>Hi,</p><p>First I&#039;d like thank you for this great post and the valuable information posted here.</p><p>I&#039;m trying to get vga passthrough work on ubuntu 14.10, I know here is a Arch Linux forum sorry if I&#039;m being rude or something.</p><p>My setup is the follow:</p><p>Core i7 4770S<br />Gigabyte GA-B85M-D3PH<br />Nvidia Geforce GT630 1GB<br />AMD R7 250 2GB</p><p>I&#039;ve tried to passthrough both gpus, but I can&#039;t get video signal from DVI output connected to VGAs.</p><p>I think the problem is related to missing i915 arbiter patch, I haven&#039;t found the 915 patch for 3.16 kernel which is the ubuntu 14.10 default kernel. </p><p>Does someone has the i915 arbiter patch for 3.16 kernel?</p><p>Thank you</p></div></blockquote></div><p>i used this patch for 3.15<br /><a href="http://paste.ubuntu.com/9248971/" rel="nofollow">http://paste.ubuntu.com/9248971/</a></p><p>if something fails apply manually.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479388">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479389" class="blockpost rowodd"> <h2><span><span class="conr">#3442</span> <a href="viewtopic.php?pid=1479389#p1479389">2014-11-26 12:12:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Just to be more precise: Windows 8.1 DOES start, but I got no internet connection then.</p></div></blockquote></div><p>you need to install virtio network drivers form virtio drivers iso.</p></div></blockquote></div><p>thank you so much, of course! </p><p>I got it working now <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479389">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479393" class="blockpost roweven"> <h2><span><span class="conr">#3443</span> <a href="viewtopic.php?pid=1479393#p1479393">2014-11-26 12:36:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Do you have any idea what to do? </p><br /><br /><p>Sorry to bump, but if anyone has any idea on the sound part, I&#039;ll be very happy.</p></div></blockquote></div><p>How do u pass usb devices? i have had same problem with -usb device, but passing whole INTEL usb controller with vifio worked flawlessly.</p></div></blockquote></div><p>Unfortunately, I already pass the whole controller:</p><div class="codebox"><pre><code>-device vfio-pci,host=00:1d.0,bus=pcie.0 \</code></pre></div><p>This controller controls 2 front USB ports on my case. From here, I plug an USB hub which contains mouse + keyboard (both wireless Logitech via 1 unify adapter), a micro USB cable (for Xbox gamepad), and the sound card.</p><p>PS: I just ordered a new USB soundcard from 20€ from Amazon (free return if it doesn&#039;t suits my needs). I&#039;ll give it a try to make sure it is not some stupid hardware issue, related to my sound card.</p> <p class="postedit"><em>Last edited by Nesousx (2014-11-26 12:40:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479393">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479394" class="blockpost rowodd"> <h2><span><span class="conr">#3444</span> <a href="viewtopic.php?pid=1479394#p1479394">2014-11-26 12:39:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Do you have any idea what to do? </p><br /><br /><p>Sorry to bump, but if anyone has any idea on the sound part, I&#039;ll be very happy.</p></div></blockquote></div><p>How do u pass usb devices? i have had same problem with -usb device, but passing whole INTEL usb controller with vifio worked flawlessly.</p></div></blockquote></div><p>Unfortunately, I already pass the whole controller:</p><div class="codebox"><pre><code>-device vfio-pci,host=00:1d.0,bus=pcie.0 \</code></pre></div></div></blockquote></div><p>is that intel controller? VIA caused problems for me..</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479394">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479395" class="blockpost roweven"> <h2><span><span class="conr">#3445</span> <a href="viewtopic.php?pid=1479395#p1479395">2014-11-26 12:41:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>How do u pass usb devices? i have had same problem with -usb device, but passing whole INTEL usb controller with vifio worked flawlessly.</p></div></blockquote></div><p>Unfortunately, I already pass the whole controller:</p><div class="codebox"><pre><code>-device vfio-pci,host=00:1d.0,bus=pcie.0 \</code></pre></div></div></blockquote></div><p>is that intel controller? VIA caused problems for me..</p></div></blockquote></div><p>Yup: </p><div class="codebox"><pre><code>lspci | grep 00:1d.0 00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 (rev 04)</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479395">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479397" class="blockpost rowodd"> <h2><span><span class="conr">#3446</span> <a href="viewtopic.php?pid=1479397#p1479397">2014-11-26 12:45:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><p>Hi,</p><p>First I&#039;d like thank you for this great post and the valuable information posted here.</p><p>I&#039;m trying to get vga passthrough work on ubuntu 14.10, I know here is a Arch Linux forum sorry if I&#039;m being rude or something.</p><p>My setup is the follow:</p><p>Core i7 4770S<br />Gigabyte GA-B85M-D3PH<br />Nvidia Geforce GT630 1GB<br />AMD R7 250 2GB</p><p>I&#039;ve tried to passthrough both gpus, but I can&#039;t get video signal from DVI output connected to VGAs.</p><p>I think the problem is related to missing i915 arbiter patch, I haven&#039;t found the 915 patch for 3.16 kernel which is the ubuntu 14.10 default kernel. </p><p>Does someone has the i915 arbiter patch for 3.16 kernel?</p><p>Thank you</p></div></blockquote></div><p>i used this patch for 3.15<br /><a href="http://paste.ubuntu.com/9248971/" rel="nofollow">http://paste.ubuntu.com/9248971/</a></p><p>if something fails apply manually.</p></div></blockquote></div><p>Thank you slis!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479397">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479470" class="blockpost roweven"> <h2><span><span class="conr">#3447</span> <a href="viewtopic.php?pid=1479470#p1479470">2014-11-26 16:19:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello all,</p><p>After reading a lot looking why sometimes my sound is not working on the KVM (Windows 8.1, NVIDIA sound from the GTX 770 card), I think I found the solution (needs to be checked more time but seems to work for now (2 hours testing) <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>First of all... when I was running:</p><div class="codebox"><pre class="vscroll"><code>[jgomez@myArch ~]$ sudo lspci -v -s 01:00.0 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1) (prog-if 00 [VGA controller]) Subsystem: eVga.com. Corp. Device 3774 Flags: bus master, fast devsel, latency 0, IRQ 49 Memory at ee000000 (32-bit, non-prefetchable) [size=16M] Memory at e0000000 (64-bit, prefetchable) [size=128M] Memory at e8000000 (64-bit, prefetchable) [size=32M] I/O ports at e000 [size=128] Expansion ROM at ef000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable+ Count=1/1 Maskable- 64bit+ -------------------&gt; Before was MSI: Enable- Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Capabilities: [900] #19 Kernel driver in use: vfio-pci Kernel modules: nouveau [jgomez@myArch ~]$ sudo lspci -v -s 01:00.1 //For the Sound part :) 01:00.1 Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) Subsystem: eVga.com. Corp. Device 3774 Flags: bus master, fast devsel, latency 0, IRQ 50 Memory at ef080000 (32-bit, non-prefetchable) [size=16K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable+ Count=1/1 Maskable- 64bit+ -------------------&gt; Before was MSI: Enable- Capabilities: [78] Express Endpoint, MSI 00 Kernel driver in use: vfio-pci Kernel modules: snd_hda_intel</code></pre></div><p>So, reading <a href="https://www.myricom.com/software/myri10ge/403-why-can-t-i-enable-msi-on-my-motherboard.html" rel="nofollow">here</a>,&#160; <a href="http://vfio.blogspot.fr/" rel="nofollow">here</a> and <a href="http://forums.guru3d.com/showthread.php?t=378044" rel="nofollow">here</a> that changed and seems to work for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Reading all of that suggests that you try (making backup or whatever to cover your back <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />):</p><p>add pci=msi on your kernel parameters --------&gt; That changes my enabled- to enabled+<br />and go to your Windows guest, Control Panel, System, Device Manager<br />View menu, Resources by Type<br />Check your device (VGA and Sound in my case)<br />Check if the IRQ it&#039;s positive (MSI not enabled) or negative (MSI Enabled) ---------&gt; In my case were positive so... let&#039;s go to the next step... remember to make backup, maybe your guest will not boot again!!!<br />Check the properties of that device, details tab, Device Instance Path and copy that value (something like PCI\VEN_10DE&amp;DEV_1184....<br />Open your regedit<br />Go to: HKEY_LOCAL_MACHINE\System\CurrentControlSet\Enum\PCI\ ------------- Your copied value here -----------------\DeviceParameters\Interrupt Management\</p><p>Maybe exists maybe not a key named MessageSignaledInterruptProperties (if does not exists, create it)<br />Create a new DWORD inside named MSISupported (value should be 1 for enabled and 0 for disabled)</p><p>Close regedit and reboot your computer</p><p>Cross your fingers and start praying <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>In my case was working and after reboot no more problems with sound (at the moment).</p><p>If you go again to the Device Manager you can check that now your IRQ for that device are negative.</p><p>If that does not happen, remove the keys on regedit and... bad luck... at least according to the post I read).</p><p>This should give us less latency so that means... better performance <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I hope it helps for all of you!</p><br /><p>Best regards,</p><br /><p>TheArcher</p><p>P.S.= Thanks a lot to the authors of these blogs / forum because they are genius!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479470">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479527" class="blockpost rowodd"> <h2><span><span class="conr">#3448</span> <a href="viewtopic.php?pid=1479527#p1479527">2014-11-26 19:12:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71471">dRaiser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Poland</span></dd> <dd><span>Registered: 2013-05-20</span></dd> <dd><span>Posts: 49</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pw@draiser.net">Email</a></span> <span class="website"><a href="http://draiser.net/en" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, could anyone tell me how exactly CPU assignment in KVM/QEMU works? <br />I have and i5 3550 CPU with 4 cores and no hyperthreading. I currently gave 2 cores for VM but, as I understand it, it doesn&#039;t give cores exclusively, so is it possible to pass all 4 cores and with&#160; CPU load on host near to 0 should it perform like it has native 4 cores on guest? I hope my question is easy to understand. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479527">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479535" class="blockpost roweven"> <h2><span><span class="conr">#3449</span> <a href="viewtopic.php?pid=1479535#p1479535">2014-11-26 19:49:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dRaiser wrote:</cite><blockquote><div><p>Hi, could anyone tell me how exactly CPU assignment in KVM/QEMU works? <br />I have and i5 3550 CPU with 4 cores and no hyperthreading. I currently gave 2 cores for VM but, as I understand it, it doesn&#039;t give cores exclusively, so is it possible to pass all 4 cores and with&#160; CPU load on host near to 0 should it perform like it has native 4 cores on guest? I hope my question is easy to understand. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>vCPUs are threads and by default are handled the same as any other thread on the host, scheduling on available physical CPUs.&#160; You can pin them to help out the scheduler and improve cache locality.&#160; You also need to realize that there are additional threads that run in the host for I/O, so if you have a 1:1 mapping of vCPU to pCPUs and don&#039;t have extra resources for the additional threads, then that time will get stolen from the vCPUs.&#160; It&#039;s therefore often advisable to not fully consume the available host CPUs.&#160; cgroups can be used to attempt to further isolate where processes can run and what can run on the same pCPUs as your guest.&#160; There&#039;s also always some overhead to virtualization, so you&#039;re never going to get 100% of native performance.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479535">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479536" class="blockpost rowodd"> <h2><span><span class="conr">#3450</span> <a href="viewtopic.php?pid=1479536#p1479536">2014-11-26 19:52:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dRaiser wrote:</cite><blockquote><div><p>Hi, could anyone tell me how exactly CPU assignment in KVM/QEMU works? <br />I have and i5 3550 CPU with 4 cores and no hyperthreading. I currently gave 2 cores for VM but, as I understand it, it doesn&#039;t give cores exclusively, so is it possible to pass all 4 cores and with&#160; CPU load on host near to 0 should it perform like it has native 4 cores on guest? I hope my question is easy to understand. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>I use <a href="https://code.google.com/p/cpuset/" rel="nofollow">cset</a> to do this, so i have 2 cores dedicated to the host, and 6 for the vm</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479536">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=137">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <a href="viewtopic.php?id=162768&amp;p=137">137</a> <strong>138</strong> <a href="viewtopic.php?id=162768&amp;p=139">139</a> <a href="viewtopic.php?id=162768&amp;p=140">140</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=139">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
