<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 81) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=81" title="Page 81" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=80" title="Page 80" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=82" title="Page 82" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=80">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <a href="viewtopic.php?id=162768&amp;p=80">80</a> <strong>81</strong> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <a href="viewtopic.php?id=162768&amp;p=83">83</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=82">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1423836" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2001</span> <a href="viewtopic.php?pid=1423836#p1423836">2014-06-09 07:34:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now i could make it all work with stock (from repos, no recompiling) software available:<br />Kernel: 3.15 (no patches)<br />Qemu 2.0.0<br />libvirt 1.2.2<br />virt-manager 1.0.1</p><p>CPU AMD FX(tm)-8350 Eight-Core Processor<br />GPU radeon R9 270X<br />Motherboard SABERTOOTH 990FX R2.0</p><p>This is on linux mint 17 (based on ubuntu 14.04 LTS). For libvirt i used default pc chipset (no manual xml editing!). Using emulated GPU for booting, OS switches to physical GPU later on during boot. Good to finally see this work without much hackery. :)</p> <p class="postedit"><em>Last edited by novist (2014-06-09 11:47:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423836">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423900" class="blockpost roweven"> <h2><span><span class="conr">#2002</span> <a href="viewtopic.php?pid=1423900#p1423900">2014-06-09 12:50:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82616">apporc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:appleorchard2000@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey, novist. I am using the same software with you, and there is still one problem for me.<br />Kernel: 3.15 (no patches)<br />Qemu: 2.0.0<br />libvirt: 1.2.2</p><p>CPU: Intel(R) Core(TM) i7-4770<br />GPU: radeon 7870<br />Motherboard: Asus Z87K</p><p>My OS is Linux Mint 17 too.&#160; I used the kvm + vfio_pci method. I configured all according to this thread except kernel/qemu version and patch.<br />I have succeeded to boot my guest os, as i think the VGA card is at least partially passthroughed. <br />When i start my guest os win7, the boot screen of this win7 will show through radeon 7870 to my secondary monitor.<br />Problem is i just can&#039;t find the &quot;radeon 7870&quot; device in win7&#039;s device manager. There is only one graphics card called &quot;Normal VGA Monitor&quot;.</p><p>Indeed, i have tried to install ATI driver and run warcraft III, everything is ok. I am just a little confused about that.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423952" class="blockpost rowodd"> <h2><span><span class="conr">#2003</span> <a href="viewtopic.php?pid=1423952#p1423952">2014-06-09 15:22:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>sounds like it works alright. if you get expected performance dont worry about it. could be some kvm hickup or something, who knows. you did not add emulated vga right? i can suggest you trying to set up vm on pc chipset with physical vga as secondary, maybe that would change something.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423952">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424025" class="blockpost roweven"> <h2><span><span class="conr">#2004</span> <a href="viewtopic.php?pid=1424025#p1424025">2014-06-09 20:03:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82553">bpye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ben@curlybracket.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Got it working, however as expected audio sucks. What sort of latency would I been looking it if I connected a usb sound card to my line in?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424025">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424043" class="blockpost rowodd"> <h2><span><span class="conr">#2005</span> <a href="viewtopic.php?pid=1424043#p1424043">2014-06-09 20:49:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82630">iwasaperson</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82630">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I keep getting this error:</p><p>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>Specs:<br />3570K<br />AMD Radeon 6970 (Card I&#039;m trying to pass through)<br />Mobo: ASUS P8Z77-V LK</p><p>This is the third time I&#039;ve tried this after several formats (not related to this).<br />Any idea on how to solve it? I&#039;ve tried looking around, but I can&#039;t find anything.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424043">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424046" class="blockpost roweven"> <h2><span><span class="conr">#2006</span> <a href="viewtopic.php?pid=1424046#p1424046">2014-06-09 20:51:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>iwasaperson wrote:</cite><blockquote><div><p>I keep getting this error:</p><p>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>Specs:<br />3570K<br />AMD Radeon 6970 (Card I&#039;m trying to pass through)<br />Mobo: ASUS P8Z77-V LK</p><p>This is the third time I&#039;ve tried this after several formats (not related to this).<br />Any idea on how to solve it? I&#039;ve tried looking around, but I can&#039;t find anything.</p></div></blockquote></div><p>Get a CPU that supports VT-d, yours does not:</p><p><a href="http://ark.intel.com/products/65520/Intel-Core-i5-3570K-Processor-6M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/65520/Int … o-3_80-GHz</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424046">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424051" class="blockpost rowodd"> <h2><span><span class="conr">#2007</span> <a href="viewtopic.php?pid=1424051#p1424051">2014-06-09 20:56:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82630">iwasaperson</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82630">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>iwasaperson wrote:</cite><blockquote><div><p>I keep getting this error:</p><p>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>Specs:<br />3570K<br />AMD Radeon 6970 (Card I&#039;m trying to pass through)<br />Mobo: ASUS P8Z77-V LK</p><p>This is the third time I&#039;ve tried this after several formats (not related to this).<br />Any idea on how to solve it? I&#039;ve tried looking around, but I can&#039;t find anything.</p></div></blockquote></div><p>Get a CPU that supports VT-d, yours does not:</p><p><a href="http://ark.intel.com/products/65520/Intel-Core-i5-3570K-Processor-6M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/65520/Int … o-3_80-GHz</a></p></div></blockquote></div><p>I was not aware of that. Thanks for letting me know. Does the 4790K support it?<br />EDIT: Just looked it up. It does.</p> <p class="postedit"><em>Last edited by iwasaperson (2014-06-09 20:57:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424079" class="blockpost roweven"> <h2><span><span class="conr">#2008</span> <a href="viewtopic.php?pid=1424079#p1424079">2014-06-09 22:43:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82631">spicy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>First time poster here, I hope you&#039;ll forgive my inexperience. I should also point out that I am trying this with Debian testing / &quot;jessie&quot;, hopefully that isn&#039;t a problem. This seems to be the best resource for KVM VGA passthrough right now.</p><p>I&#039;m trying to get primary VGA passthrough working but running into an issue when trying to enable x-vga=on. Secondary vga passthrough is working fine with &quot;-vga std&quot; set but I get the following when using x-vga and vga none:</p><p>&#160; &#160; qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: Device does not support requested feature x-vga<br />&#160; &#160; qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get device 0000:02:00.0<br />&#160; &#160; qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed.<br />&#160; &#160; qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>I should probably note here that I am using a git compiled kvm and qemu, but I am using a packaged kernel from Debian&#039;s testing repo: 3.14-1-amd64. This might be the source of my problems – it wasn&#039;t clear to me if many of the patches from the OP were still needed on newer releases of the kernel. I&#039;ve read through a fair bit of the thread, but I&#039;ll confess that I haven&#039;t read all 81 pages yet. I also haven&#039;t tried a compiled kernel, but if this looks to be the source of the problem I&#039;m happy to try it.</p><p>Otherwise, I&#039;m not sure what could be causing this issue. Both cards are working in secondary passthrough and are ATI Radeon cards – not Nvidia (though I am hoping to test a GTX card soon as well)</p><p>Thanks for your time, any suggestions would be greatly appreciated!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424079">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424081" class="blockpost rowodd"> <h2><span><span class="conr">#2009</span> <a href="viewtopic.php?pid=1424081#p1424081">2014-06-09 22:50:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>spicy wrote:</cite><blockquote><div><p>&#160; &#160; qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: Device does not support requested feature x-vga</p></div></blockquote></div><p>This means that either a) your kernel does not support CONFIG_VFIO_PCI_VGA or b) the device is not a VGA device.&#160; To test a):</p><p>$ grep CONFIG_VFIO_PCI_VGA /boot/config-`uname -r`</p><p>To test b):</p><p>$ lspci -s 2:00.0 | grep VGA</p><p>If you have Intel host graphics, you still need the i915 patch for your kernel.&#160; If you Radeon host graphics, you need the other VGA arbiter patch.&#160; Both of these have been referenced in the last few pages, IIRC.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424081">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424098" class="blockpost roweven"> <h2><span><span class="conr">#2010</span> <a href="viewtopic.php?pid=1424098#p1424098">2014-06-10 01:06:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Passthrough of an AMD 6450 works well with kernel 3.14 with i915 VGA arbiter patch applied. I need to passthrough the onboard SATA controller as well and that goes less smoothly. Said controller is found in iommu group 10</p><div class="codebox"><pre><code>### Group 10 ### 00:1f.0 ISA bridge: Intel Corporation H77 Express Chipset LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04)</code></pre></div><p>When starting a guest in libvirt with the SATA controller marked for passthrough results in </p><div class="codebox"><pre><code>Error starting domain: internal error: process exited while connecting to monitor: qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: vfio: error, group 10 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: vfio: failed to get group 10 qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>The acs override patch was applied against the 3.14 sources from which the running kernel was built (doublechecked that by applying it to the same source tree again).</p><div class="codebox"><pre><code>kvmhost-2:/home/user/Desktop # uname -r 3.14.4-vfio-acs-1.gbebeb6f-desktop kvmhost-2:/usr/src/linux-3.14.4-vfio-acs-1.gbebeb6f # patch -Np1 -i override_for_missing_acs_capabilities.patch patching file Documentation/kernel-parameters.txt Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file Documentation/kernel-parameters.txt.rej patching file drivers/pci/quirks.c Reversed (or previously applied) patch detected! Skipping patch. 3 out of 3 hunks ignored -- saving rejects to file drivers/pci/quirks.c.rej</code></pre></div><p>The boot loader has a flag set as per an earlier post:</p><div class="codebox"><pre><code>intel_iommu=on pcie_acs_override=downstream</code></pre></div><p>I&#039;m completely out of ideas. Any and all feedback are much appreciated. Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424098">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424100" class="blockpost rowodd"> <h2><span><span class="conr">#2011</span> <a href="viewtopic.php?pid=1424100#p1424100">2014-06-10 01:17:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82616">apporc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:appleorchard2000@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code>Error starting domain: internal error: process exited while connecting to monitor: qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: vfio: error, group 10 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.</code></pre></div><p>I have met this error several times.&#160; I patched the acs patch on 3.14.5. I think it just won&#039;t work. Because that patch may not be applicable to the kernel version you used. <br />For now, kernel 3.15 is ok. It seems like that acs commit is got applied.</p> <p class="postedit"><em>Last edited by apporc (2014-06-10 01:18:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424100">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424101" class="blockpost roweven"> <h2><span><span class="conr">#2012</span> <a href="viewtopic.php?pid=1424101#p1424101">2014-06-10 01:20:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><div class="codebox"><pre><code>### Group 10 ### 00:1f.0 ISA bridge: Intel Corporation H77 Express Chipset LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04)</code></pre></div><p>When starting a guest in libvirt with the SATA controller marked for passthrough results in </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=00:1f.2,bus=root.1: vfio: error, group 10 is not viable...</code></pre></div><p>The acs override patch was applied against the 3.14 sources from which the running kernel was built (doublechecked that by applying it to the same source tree again).<br />...<br />The boot loader has a flag set as per an earlier post:</p><div class="codebox"><pre><code>intel_iommu=on pcie_acs_override=downstream</code></pre></div><p>I&#039;m completely out of ideas. Any and all feedback are much appreciated. Thanks.</p></div></blockquote></div><p>I won&#039;t advise it, but there are more options to pcie_acs_override than just <em>downstream</em>.&#160; See <a href="https://lkml.org/lkml/2013/5/30/513" rel="nofollow">https://lkml.org/lkml/2013/5/30/513</a>&#160; IMHO, unless you have a specific need, assigning a SATA controller is more trouble than it&#039;s worth, especially when you can&#039;t guarantee device isolation.&#160; virtio-blk provides plenty of performance when backed by a sufficiently fast disk or ssd.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424101">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424106" class="blockpost rowodd"> <h2><span><span class="conr">#2013</span> <a href="viewtopic.php?pid=1424106#p1424106">2014-06-10 01:31:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I won&#039;t advise it, but there are more options to pcie_acs_override than just <em>downstream</em>.&#160; See <a href="https://lkml.org/lkml/2013/5/30/513" rel="nofollow">https://lkml.org/lkml/2013/5/30/513</a>&#160; IMHO, unless you have a specific need, assigning a SATA controller is more trouble than it&#039;s worth, especially when you can&#039;t guarantee device isolation.&#160; virtio-blk provides plenty of performance when backed by a sufficiently fast disk or ssd.</p></div></blockquote></div><p>Thanks Alex for your fast reply. I&#039;ll have a look at those options. Agree with virtio-blk offering sufficient performance, however in this particular case I need to passthrough the SATA controller to a guest running UnRAID (a networked storage server product). I have this running on another box that is on kernel 3.11 and QEMU 1.6.2 using PCI assign.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424106">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424107" class="blockpost roweven"> <h2><span><span class="conr">#2014</span> <a href="viewtopic.php?pid=1424107#p1424107">2014-06-10 01:33:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apporc wrote:</cite><blockquote><div><p>I have met this error several times.&#160; I patched the acs patch on 3.14.5. I think it just won&#039;t work. Because that patch may not be applicable to the kernel version you used. <br />For now, kernel 3.15 is ok. It seems like that acs commit is got applied.</p></div></blockquote></div><p>Thanks! That would be good. I&#039;ll give kernel 3.15 a try tomorrow and report back.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424107">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424178" class="blockpost rowodd"> <h2><span><span class="conr">#2015</span> <a href="viewtopic.php?pid=1424178#p1424178">2014-06-10 08:21:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just found out something unpleasant sniffing around my windows nvidia drivers and I notice it says I&#039;m using &quot;pci-express x4&quot; turns out the secondary PCI-Express x16 slot on most motherboards is actually just x4 (read the small letters right?) the performance implication as far as I understand is that x16 has more bandwidth capabilites than x4 and as such this probably really borks the performance of high end graphics cards. As even <a href="http://www.tomshardware.com/reviews/pci-express-scaling-analysis,1572-10.html" rel="nofollow">old studies</a> would suggest. I also hear that using the extra PCI-E slot will reduce the bandwidth of the primary slot (i.e. drop it from x16 to x12) but I haven&#039;t confirmed any of this yet. Chances are you have this same problem too unless you have like a really expensive high end motherboard. Mine is like medium end.</p><p>This whole thing is kinda dubious and I&#039;m not sure what to think about it, so <a href="https://superuser.com/questions/766789/what-are-the-performance-differences-between-pci-express-x16-and-x4" rel="nofollow">I asked</a>. Only workaround for this problem I can think of is passing through the primary card which xen should be capable of but it&#039;s a lot harder to get working than this. Another workaround might be to use an intergrated gpu on the host (unless the primary gpu can actually be passed through instead of the secondary one)</p> <p class="postedit"><em>Last edited by rabcor (2014-06-10 08:27:35)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424178">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424182" class="blockpost roweven"> <h2><span><span class="conr">#2016</span> <a href="viewtopic.php?pid=1424182#p1424182">2014-06-10 08:39:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>rabcor, I think it is possible to pass through primary card. Do need your host to use any GPU at all, or are you happy to let it run headless (and perhaps present its GUI over the network using tools such as xvnc or nomachine)?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424182">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424184" class="blockpost rowodd"> <h2><span><span class="conr">#2017</span> <a href="viewtopic.php?pid=1424184#p1424184">2014-06-10 08:45:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Lol of course I need my host to use a GPU at all, otherwise what would be the point in all of this? I&#039;d just boot Windows and skip linux, but I want to be doing everything except gaming on Linux.</p> <p class="postedit"><em>Last edited by rabcor (2014-06-10 08:46:34)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424184">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424192" class="blockpost roweven"> <h2><span><span class="conr">#2018</span> <a href="viewtopic.php?pid=1424192#p1424192">2014-06-10 09:26:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>rabcor maybe it is possible to use second GPU for host. after all if windows can switch to second GPU on boot then linux should be able to do this even more so. sideeffect of that would be boot messages showing on first gpu early on boot including grub menus. if i were you i would try passing through first gpu same way like you do with second and see what happens. it might work.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424192">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424197" class="blockpost rowodd"> <h2><span><span class="conr">#2019</span> <a href="viewtopic.php?pid=1424197#p1424197">2014-06-10 10:04:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Lol of course I need my host to use a GPU at all, otherwise what would be the point in all of this? I&#039;d just boot Windows and skip linux, but I want to be doing everything except gaming on Linux.</p></div></blockquote></div><p>Dunno, I am so used to Linux command line over ssh, that I do not care to see its GUI at all. I guess I am not the only one.</p><p>Still, Linux should work with second GPU, I think the challenge is to:<br />1. get vgacon to give away primary GPU before you start the guest<br />2. get X to ignore primary GPU</p><p>Both should be doable, I think 915 patch might help with 1.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424197">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424198" class="blockpost roweven"> <h2><span><span class="conr">#2020</span> <a href="viewtopic.php?pid=1424198#p1424198">2014-06-10 10:08:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><p>I have met this error several times.&#160; I patched the acs patch on 3.14.5. I think it just won&#039;t work. Because that patch may not be applicable to the kernel version you used. <br />For now, kernel 3.15 is ok. It seems like that acs commit is got applied.</p></div></blockquote></div><p>Built a kernel 3.15 with only the i915 VGA arbiter patch applied and have the same result- </p><div class="codebox"><pre><code>vfio: error, group 10 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.</code></pre></div><p>. There is a 3.15 version of the ACS override patch in linux-mainline.tar.gz linked on the first post and I&#039;ll try that next. Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424198">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424221" class="blockpost rowodd"> <h2><span><span class="conr">#2021</span> <a href="viewtopic.php?pid=1424221#p1424221">2014-06-10 12:19:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82553">bpye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ben@curlybracket.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is libvirt/virsh viable for running a VM with VGA passthrough or does it lack some of the configuration settings? I ask because it&#039;d be nice to have my VM in a deamon, and hotplugging say USB devices without having to have qemu stay open would be nice.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424221">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424224" class="blockpost roweven"> <h2><span><span class="conr">#2022</span> <a href="viewtopic.php?pid=1424224#p1424224">2014-06-10 12:27:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Is libvirt/virsh viable for running a VM with VGA passthrough or does it lack some of the configuration settings? I ask because it&#039;d be nice to have my VM in a deamon, and hotplugging say USB devices without having to have qemu stay open would be nice.</p></div></blockquote></div><p>Yes it is. You can convert a QEMU command line invocation to libvirt xml using </p><div class="codebox"><pre><code>virsh domxml-from-native qemu-argv &lt;qemu command line invocation&gt;</code></pre></div><p>It does not always work straight out of the box though, I&#039;ve had difficulties with defining disks for example. More information can be found on <a href="http://libvirt.org/drvqemu.html#imex" rel="nofollow">http://libvirt.org/drvqemu.html#imex</a>. I believe there are some examples in this thread of libvirt xml that you can use to define a guest. The configuration settings that are not directly supported by libvirt can be passed to QEMU as in the following example </p><div class="codebox"><pre><code>&lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;qemu:commandline&gt;</code></pre></div><p>edit: added url</p> <p class="postedit"><em>Last edited by siddharta (2014-06-10 12:30:12)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424224">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424238" class="blockpost rowodd"> <h2><span><span class="conr">#2023</span> <a href="viewtopic.php?pid=1424238#p1424238">2014-06-10 13:07:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Is libvirt/virsh viable for running a VM with VGA passthrough or does it lack some of the configuration settings? I ask because it&#039;d be nice to have my VM in a deamon, and hotplugging say USB devices without having to have qemu stay open would be nice.</p></div></blockquote></div><p>Yes it is. You can convert a QEMU command line invocation to libvirt xml using </p><div class="codebox"><pre><code>virsh domxml-from-native qemu-argv &lt;qemu command line invocation&gt;</code></pre></div><p>It does not always work straight out of the box though, I&#039;ve had difficulties with defining disks for example. More information can be found on <a href="http://libvirt.org/drvqemu.html#imex" rel="nofollow">http://libvirt.org/drvqemu.html#imex</a>. I believe there are some examples in this thread of libvirt xml that you can use to define a guest. The configuration settings that are not directly supported by libvirt can be passed to QEMU as in the following example </p><div class="codebox"><pre><code>&lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;qemu:commandline&gt;</code></pre></div><p>edit: added url</p></div></blockquote></div><p>or like this:</p><div class="codebox"><pre class="vscroll"><code>&lt;!-- WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit gaming or other application using the libvirt API. --&gt; &lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;gaming&lt;/name&gt; &lt;uuid&gt;4541f648-2ada-4268-9882-0f3d4f5100b1&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;memoryBacking&gt; &lt;hugepages/&gt; &lt;/memoryBacking&gt; &lt;vcpu placement=&#039;static&#039;&gt;8&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.0&#039;&gt;hvm&lt;/type&gt; &lt;loader&gt;/home/novist/vm/bios.bin-1.7.2&lt;/loader&gt; &lt;bootmenu enable=&#039;no&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Opteron_G5&lt;/model&gt; &lt;vendor&gt;AMD&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;perfctr_core&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;skinit&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;perfctr_nb&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;mmxext&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;topoext&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;fxsr_opt&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;bmi1&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;cr8legacy&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ibs&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;wdt&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;extapic&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osvw&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;nodeid_msr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tce&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;cmp_legacy&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;lwp&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdc&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0d&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sda&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0e&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0c&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;scsi&#039; index=&#039;1&#039; model=&#039;virtio-scsi&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x10&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:29:ae:89&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039; keymap=&#039;en-us&#039;/&gt; &lt;video&gt; &lt;model type=&#039;vga&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x06&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x06&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x13&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x13&#039; function=&#039;0x2&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;rng model=&#039;virtio&#039;&gt; &lt;backend model=&#039;random&#039;&gt;/dev/random&lt;/backend&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0f&#039; function=&#039;0x0&#039;/&gt; &lt;/rng&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div> <p class="postedit"><em>Last edited by novist (2014-06-10 13:07:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424241" class="blockpost roweven"> <h2><span><span class="conr">#2024</span> <a href="viewtopic.php?pid=1424241#p1424241">2014-06-10 13:19:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>or like this:</p></div></blockquote></div><p>Exactly, that&#039;s a very complete xml. Thanks. Didn&#039;t have a full xml handy.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424241">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424263" class="blockpost rowodd"> <h2><span><span class="conr">#2025</span> <a href="viewtopic.php?pid=1424263#p1424263">2014-06-10 14:39:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><p>I have met this error several times.&#160; I patched the acs patch on 3.14.5. I think it just won&#039;t work. Because that patch may not be applicable to the kernel version you used. <br />For now, kernel 3.15 is ok. It seems like that acs commit is got applied.</p></div></blockquote></div><p>Built a kernel 3.15 with only the i915 VGA arbiter patch applied and have the same result- </p><div class="codebox"><pre><code>vfio: error, group 10 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.</code></pre></div><p>There is a 3.15 version of the ACS override patch in linux-mainline.tar.gz linked on the first post and I&#039;ll try that next. Thanks.</p></div></blockquote></div><p>I built two versions of the 3.15 kernel, one with and one without the override_acs patch from the archive linked in the first post. Both kernel sources have the i915_315 patch applied. I have two issues, broken VGA passthrough (working on 3.14) and not being able to passthrough onboard SATA.</p><p>Using kernel 3.15 I have host display corruption and non-working VGA passthrough (host with igfx, AMD HD6450 for passthrough) despite having applied the i915_315 VGA arbiter patch. I re-ran the patch against the source to be certain:</p><div class="codebox"><pre><code>kvmhost-2:/usr/src/linux-3.15.0-desktop # patch -Np1 -i i915_315.patch patching file drivers/gpu/drm/i915/i915_dma.c Reversed (or previously applied) patch detected! Skipping patch. 2 out of 2 hunks ignored -- saving rejects to file drivers/gpu/drm/i915/i915_dma.c.rej patching file drivers/gpu/drm/i915/i915_drv.h Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file drivers/gpu/drm/i915/i915_drv.h.rej patching file drivers/gpu/drm/i915/i915_params.c Reversed (or previously applied) patch detected! Skipping patch. 2 out of 2 hunks ignored -- saving rejects to file drivers/gpu/drm/i915/i915_params.c.rej patching file drivers/gpu/drm/i915/intel_display.c Reversed (or previously applied) patch detected! Skipping patch. 3 out of 3 hunks ignored -- saving rejects to file drivers/gpu/drm/i915/intel_display.c.rej patching file drivers/gpu/drm/i915/intel_drv.h Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file drivers/gpu/drm/i915/intel_drv.h.rej patching file include/linux/vgaarb.h Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file include/linux/vgaarb.h.rej</code></pre></div><p>As for passing through the onboard SATA controller I have no luck </p><p>- with either 3.14 and 3.15 kernels<br />- with or without the respective override_acs patch<br />- with kernel boot parameter pcie_acs_override= set to downstream/multifunction/id:8086:1e02 or any combination thereof.</p><p>I&#039;ve also attempted to unbind the SATA controller from vfio-pci and use PCI assign as I&#039;ve done on QEMU 1.6.2 and kernel 3.11, defined with libvirt using Virtual Machine Manager. The device is defined as </p><div class="codebox"><pre><code>&lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt;</code></pre></div><p>Surprisingly (to me) this fails with </p><div class="codebox"><pre><code>Error starting domain: internal error: process exited while connecting to monitor: qemu-system-x86_64: -device vfio-pci,host=00:1f.2,id=hostdev0,bus=pci.0,addr=0x7: vfio: error, group 8 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=00:1f.2,id=hostdev0,bus=pci.0,addr=0x7: vfio: failed to get group 8 qemu-system-x86_64: -device vfio-pci,host=00:1f.2,id=hostdev0,bus=pci.0,addr=0x7: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=00:1f.2,id=hostdev0,bus=pci.0,addr=0x7: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p> or the same error I have when attempting passthrough of this device using vfio. It would appear the PCI assign mechanism was abandoned in favor of vfio, is that correct? If so, is there a way to force use of PCI assignment?</p><p>I would really need to passthrough SATA and USB controllers, as USB per-device passthrough doesn&#039;t work for me due to a non-libusb enabled QEMU.</p><p>Please let me know if I can provide further information or take diagnostic steps. I&#039;m not at all opposed to testing out new patches or using debug versions, consider me a guinea pig if so needed. Thanks all.</p> <p class="postedit"><em>Last edited by siddharta (2014-06-10 14:40:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=80">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <a href="viewtopic.php?id=162768&amp;p=80">80</a> <strong>81</strong> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <a href="viewtopic.php?id=162768&amp;p=83">83</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=82">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
