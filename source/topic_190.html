<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 190) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=190" title="Page 190" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=189" title="Page 189" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=191" title="Page 191" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=189">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <strong>190</strong> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=191">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1517475" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4726</span> <a href="viewtopic.php?pid=1517475#p1517475">2015-04-06 17:12:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>Can&#039;t use keyboard before windows begins to load (after I can use it without problems), but I need it to press button to load from DVD.</p></div></blockquote></div><p>Have a look at the arch wiki pages for qemu and look for information about setting up a spice server. You will get an empty black window, which makes you able to press keys in the VM. The other option is to use VNC in your setup and connect to the VM via a VNC client.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517475">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517477" class="blockpost roweven"> <h2><span><span class="conr">#4727</span> <a href="viewtopic.php?pid=1517477#p1517477">2015-04-06 17:27:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@apex8<br />Don&#039;t want to use VNC. Besides it&#039;s working for now, so I guess I stick to qemu (without -git)<br />But more serious problem remains: sometimes it cannot boot at all, just seabios screen -&gt; black for 1-2 second -&gt; seabios screen -&gt; black -&gt; seabios... If I then use hard reset, and then turn VM on again windows boots as expected. It happening on 2.2.1 and on git version.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517477">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517480" class="blockpost rowodd"> <h2><span><span class="conr">#4728</span> <a href="viewtopic.php?pid=1517480#p1517480">2015-04-06 17:31:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77641">zir_blazer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 35</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@logix</p><p>The IOMMU is not enabled, your first grep should produce lots more output.&#160; Does /sys/firmware/acpi/tables/DMAR exist on your system?&#160; A DMAR reference should have shown in the grep.&#160; Without a DMAR table, VT-d cannot be configured, which suggests a BIOS issue.</p><p>EDIT: I&#039;ve seen cases where a hard power cycle is required after enabling VT-d in the BIOS to make it actually take effect.</p></div></blockquote></div><div class="quotebox"><cite>logix wrote:</cite><blockquote><div><p>I do not have a DMAR reference</p><div class="codebox"><pre><code>$ sudo ls -al /sys/firmware/acpi/tables/DMAR ls: cannot access /sys/firmware/acpi/tables/DMAR: No such file or directory</code></pre></div><p>I had a feeling it was a problem with the firmware, and I guess that confirms it. I have hard-reset many times. In fact, disabling and enabling VT-d does a hard reset automatically. I will try downgrading the bios-- as there is a post with it working for old bios.</p><p>Thanks!</p><p>Edit: Tried 4 different bios dating from 1/2013 to most current. Cannot get DMAR tables to appear. Sad.</p></div></blockquote></div><br /><p>I think that this info is wrong. If I recall correctly, ACPI DMAR Tables are for the AMD IOMMU implementation, AMD-Vi. Intel ACPI tables are called IVRS. Basically, you should not have DMAR on Intel or IVRS on AMD, it makes no sense.</p><br /><p>About your vfio: error no iommu_group for device, if my common sense is right, you should check if you have populated the /sys/kernel/iommu_groups location. Try this:</p><p>find /sys/kernel/iommu_groups/</p><p>It should return lots of results, something like...</p><p>/sys/kernel/iommu_groups/0/devices/0000:00:00.0<br />/sys/kernel/iommu_groups/1/devices/0000:00:01.0<br />/sys/kernel/iommu_groups/1/devices/0000:01:00.0<br />/sys/kernel/iommu_groups/1/devices/0000:01:00.1</p><p>If your iommu_groups directory is not populated, maybe you require something else in your Boot Loader besides intel_iommu=on. There were a few more parameters that some guys required to have the iommu_groups directory populated, one was related to unsafe interrupts or something like that.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517480">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517481" class="blockpost roweven"> <h2><span><span class="conr">#4729</span> <a href="viewtopic.php?pid=1517481#p1517481">2015-04-06 17:35:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zir_blazer wrote:</cite><blockquote><div><p>I think that this info is wrong. If I recall correctly, ACPI DMAR Tables are for the AMD IOMMU implementation, AMD-Vi. Intel ACPI tables are called IVRS. Basically, you should not have DMAR on Intel or IVRS on AMD, it makes no sense.</p></div></blockquote></div><p>You have this completely backwards.</p><div class="quotebox"><blockquote><div><p>If your iommu_groups directory is not populated, maybe you require something else in your Boot Loader besides intel_iommu=on. There were a few more parameters that some guys required to have the iommu_groups directory populated, one was related to unsafe interrupts or something like that.</p></div></blockquote></div><p>allow_unsafe_interrupts has absolutely no bearing on whether iommu_groups is populated.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517481">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517485" class="blockpost rowodd"> <h2><span><span class="conr">#4730</span> <a href="viewtopic.php?pid=1517485#p1517485">2015-04-06 17:43:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77641">zir_blazer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 35</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>zir_blazer wrote:</cite><blockquote><div><p>I think that this info is wrong. If I recall correctly, ACPI DMAR Tables are for the AMD IOMMU implementation, AMD-Vi. Intel ACPI tables are called IVRS. Basically, you should not have DMAR on Intel or IVRS on AMD, it makes no sense.</p></div></blockquote></div><p>You have this completely backwards.</p></div></blockquote></div><p>It seems you&#039;re right. Intel mentions DMAR and AMD IVRS, I got it backwards.</p><p><a href="https://www.kernel.org/doc/Documentation/Intel-IOMMU.txt" rel="nofollow">https://www.kernel.org/doc/Documentatio … -IOMMU.txt</a><br /><a href="http://ubuntuforums.org/showthread.php?t=2254677" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2254677</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517485">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517503" class="blockpost roweven"> <h2><span><span class="conr">#4731</span> <a href="viewtopic.php?pid=1517503#p1517503">2015-04-06 19:10:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89974">SoftWinds</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-02</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dangsquall+archbbs@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve managed to passthrough my nVidia 970 card to my Windows guest using OVMF, and everything&#039;s working perfectly except for one weird thing: my mainboard is a Supermicro X10SAE, and I&#039;ve configured it to use my integrated GPU (Intel P4600) as the main GPU, and pci-stub to stub out the GTX 970. This all works fine if I don&#039;t have the HDMI cable connect to the nVidia card when the computer boots up; however if it&#039;s connected, weird thing starts happening - it seems that nVidia &quot;hijacks&quot; the boot process somehow - GRUB doesn&#039;t display the entries correctly, and Arch starts showing on the HDMI output even though it shouldn&#039;t. The OS can&#039;t even get to show the display manager in this case, it just stays in the console. Does anyone have any suggestions? Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517503">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517520" class="blockpost rowodd"> <h2><span><span class="conr">#4732</span> <a href="viewtopic.php?pid=1517520#p1517520">2015-04-06 20:58:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SoftWinds wrote:</cite><blockquote><div><p>I&#039;ve managed to passthrough my nVidia 970 card to my Windows guest using OVMF, and everything&#039;s working perfectly except for one weird thing: my mainboard is a Supermicro X10SAE, and I&#039;ve configured it to use my integrated GPU (Intel P4600) as the main GPU, and pci-stub to stub out the GTX 970. This all works fine if I don&#039;t have the HDMI cable connect to the nVidia card when the computer boots up; however if it&#039;s connected, weird thing starts happening - it seems that nVidia &quot;hijacks&quot; the boot process somehow - GRUB doesn&#039;t display the entries correctly, and Arch starts showing on the HDMI output even though it shouldn&#039;t. The OS can&#039;t even get to show the display manager in this case, it just stays in the console. Does anyone have any suggestions? Thanks!</p></div></blockquote></div><p>Maybe it&#039;s your HDMI audio function? Is it stubbed too?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517520">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517623" class="blockpost roweven"> <h2><span><span class="conr">#4733</span> <a href="viewtopic.php?pid=1517623#p1517623">2015-04-07 14:07:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89974">SoftWinds</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-02</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dangsquall+archbbs@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>SoftWinds wrote:</cite><blockquote><div><p>I&#039;ve managed to passthrough my nVidia 970 card to my Windows guest using OVMF, and everything&#039;s working perfectly except for one weird thing: my mainboard is a Supermicro X10SAE, and I&#039;ve configured it to use my integrated GPU (Intel P4600) as the main GPU, and pci-stub to stub out the GTX 970. This all works fine if I don&#039;t have the HDMI cable connect to the nVidia card when the computer boots up; however if it&#039;s connected, weird thing starts happening - it seems that nVidia &quot;hijacks&quot; the boot process somehow - GRUB doesn&#039;t display the entries correctly, and Arch starts showing on the HDMI output even though it shouldn&#039;t. The OS can&#039;t even get to show the display manager in this case, it just stays in the console. Does anyone have any suggestions? Thanks!</p></div></blockquote></div><p>Maybe it&#039;s your HDMI audio function? Is it stubbed too?</p></div></blockquote></div><p>Yes it is stubbed as well. I also use it to output audio in the VM so I know it&#039;s passed through correctly.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517623">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517626" class="blockpost rowodd"> <h2><span><span class="conr">#4734</span> <a href="viewtopic.php?pid=1517626#p1517626">2015-04-07 14:35:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88373">dhiru1602</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-28</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88373">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone managed to get SLI working by passing through 2 cards? </p><p>I have a spare AMD graphic card that I would like to use for my host and passthrough both my identical 9600GT to the guest OS so that I can create an SLI. I have blacklisted both the cards and assigned them to the VM using i440fx. However, I was able to see both the cards listed in the Device Manager but Nvidia Control Panel was unable to detect any SLI capability. After some reading, I came to a conclusion that Nvidia drivers required SLI certified motherboard to enable SLI configuration. </p><p>I tried using the q35 chipset hoping that it was SLI certified. However, my 2nd GPU shows up in the device manager with error &quot;Code 12&quot;. Came across a similar issue in the qemu-devel mailing list.</p><p><a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00753.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517626">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517634" class="blockpost roweven"> <h2><span><span class="conr">#4735</span> <a href="viewtopic.php?pid=1517634#p1517634">2015-04-07 14:55:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dhiru1602 wrote:</cite><blockquote><div><p>Has anyone managed to get SLI working by passing through 2 cards? </p><p>I have a spare AMD graphic card that I would like to use for my host and passthrough both my identical 9600GT to the guest OS so that I can create an SLI. I have blacklisted both the cards and assigned them to the VM using i440fx. However, I was able to see both the cards listed in the Device Manager but Nvidia Control Panel was unable to detect any SLI capability. After some reading, I came to a conclusion that Nvidia drivers required SLI certified motherboard to enable SLI configuration. </p><p>I tried using the q35 chipset hoping that it was SLI certified. However, my 2nd GPU shows up in the device manager with error &quot;Code 12&quot;. Came across a similar issue in the qemu-devel mailing list.</p><p><a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00753.html</a></p></div></blockquote></div><p>Maybe an interesting endeavor, if your time and electricity are free.&#160; A 9600GT is not an impressive card anymore.&#160; Conservatively, a GT740 has 2x the passmark score of a 9600GT, runs about 2/3 the power of a single 9600GT, and can be purchased for under $100.&#160; For not much more, something like a GTX750 doubles the performance again, at a lower power point and better performance per dollar margin.&#160; It&#039;s fun to use the hardware you&#039;ve got laying around, but there&#039;s all sorts of unknown proprietary bits of Nvidia SLI and in this case it just doesn&#039;t seem worth it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517634">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517731" class="blockpost rowodd"> <h2><span><span class="conr">#4736</span> <a href="viewtopic.php?pid=1517731#p1517731">2015-04-07 21:12:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88373">dhiru1602</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-28</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88373">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>dhiru1602 wrote:</cite><blockquote><div><p>Has anyone managed to get SLI working by passing through 2 cards? </p><p>I have a spare AMD graphic card that I would like to use for my host and passthrough both my identical 9600GT to the guest OS so that I can create an SLI. I have blacklisted both the cards and assigned them to the VM using i440fx. However, I was able to see both the cards listed in the Device Manager but Nvidia Control Panel was unable to detect any SLI capability. After some reading, I came to a conclusion that Nvidia drivers required SLI certified motherboard to enable SLI configuration. </p><p>I tried using the q35 chipset hoping that it was SLI certified. However, my 2nd GPU shows up in the device manager with error &quot;Code 12&quot;. Came across a similar issue in the qemu-devel mailing list.</p><p><a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00753.html</a></p></div></blockquote></div><p>Maybe an interesting endeavor, if your time and electricity are free.&#160; A 9600GT is not an impressive card anymore.&#160; Conservatively, a GT740 has 2x the passmark score of a 9600GT, runs about 2/3 the power of a single 9600GT, and can be purchased for under $100.&#160; For not much more, something like a GTX750 doubles the performance again, at a lower power point and better performance per dollar margin.&#160; It&#039;s fun to use the hardware you&#039;ve got laying around, but there&#039;s all sorts of unknown proprietary bits of Nvidia SLI and in this case it just doesn&#039;t seem worth it.</p></div></blockquote></div><p>I totally agree with you. I stopped gaming after I moved permanently to linux few years ago and I haven&#039;t considered upgrading my GPU. Thanks to your great work with vfio, I was able to passthrough my GPU to a virtual machine and combined with a monitor and keyboard mouse pair, I was able to create a second standalone PC for family use and save electricity. <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Putting together a PC with a beefy hardware for linux finally makes sense. Thanks to you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by dhiru1602 (2015-04-07 21:13:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517731">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517747" class="blockpost roweven"> <h2><span><span class="conr">#4737</span> <a href="viewtopic.php?pid=1517747#p1517747">2015-04-07 22:26:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dhiru1602 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>dhiru1602 wrote:</cite><blockquote><div><p>Has anyone managed to get SLI working by passing through 2 cards? </p><p>I have a spare AMD graphic card that I would like to use for my host and passthrough both my identical 9600GT to the guest OS so that I can create an SLI. I have blacklisted both the cards and assigned them to the VM using i440fx. However, I was able to see both the cards listed in the Device Manager but Nvidia Control Panel was unable to detect any SLI capability. After some reading, I came to a conclusion that Nvidia drivers required SLI certified motherboard to enable SLI configuration. </p><p>I tried using the q35 chipset hoping that it was SLI certified. However, my 2nd GPU shows up in the device manager with error &quot;Code 12&quot;. Came across a similar issue in the qemu-devel mailing list.</p><p><a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00753.html</a></p></div></blockquote></div><p>Maybe an interesting endeavor, if your time and electricity are free.&#160; A 9600GT is not an impressive card anymore.&#160; Conservatively, a GT740 has 2x the passmark score of a 9600GT, runs about 2/3 the power of a single 9600GT, and can be purchased for under $100.&#160; For not much more, something like a GTX750 doubles the performance again, at a lower power point and better performance per dollar margin.&#160; It&#039;s fun to use the hardware you&#039;ve got laying around, but there&#039;s all sorts of unknown proprietary bits of Nvidia SLI and in this case it just doesn&#039;t seem worth it.</p></div></blockquote></div><p>I totally agree with you. I stopped gaming after I moved permanently to linux few years ago and I haven&#039;t considered upgrading my GPU. Thanks to your great work with vfio, I was able to passthrough my GPU to a virtual machine and combined with a monitor and keyboard mouse pair, I was able to create a second standalone PC for family use and save electricity. <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Putting together a PC with a beefy hardware for linux finally makes sense. Thanks to you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Using two 9600GTs you could... do three PCs in one, but you&#039;ll probably will run out of memory or CPU power or some other IOMMU-related resource like iommu groups.</p><p>Also, seems like amd crossfire works overall better than nvidia SLI, considering the fact that back in the day you would have to install some hypervisor-like software called <a href="http://www.techpowerup.com/forums/threads/hypersli-enabling-sli-on-non-sli-motherboards.153046/" rel="nofollow">HyperSLI</a> on a real hardware platform, let alone virtual machine.</p><p>Offtopic:<br />just accidentally found out that spice or VNC passes through ACPI power button event. Seems like my virtual PC works so well and integrated, i began &quot;blurring the edge between virtuality and reality&quot;.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-07 22:30:10)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517748" class="blockpost rowodd"> <h2><span><span class="conr">#4738</span> <a href="viewtopic.php?pid=1517748#p1517748">2015-04-07 22:52:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just curious, is it possible to have a &quot;passed through&quot; physical hard drive without any virtual disk drive/image? Basically, instead of having an OS raw or qcow2 image file on the host&#039;s hard disk/filesystem, or instead of even passing an entire block device (drive /dev/sda for example), can we attach a physical hard drive to a motherboard&#039;s 2nd SATA controller, and pass through the SATA controller to the guest and have all disk operations performed by the guest alone through that controller? Will OVMF and the guest see the hard disk and be able to install OS, boot off it, etc?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517748">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517753" class="blockpost roweven"> <h2><span><span class="conr">#4739</span> <a href="viewtopic.php?pid=1517753#p1517753">2015-04-07 23:09:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89974">SoftWinds</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-02</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dangsquall+archbbs@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Actually I do have another question, but I&#039;m not really sure if it&#039;s related to GPU passthrough or just general KVM/QEMU: When I start the VM the first time everything&#039;s fine, but if I shut down the VM and try to start it again I run into the error:</p><div class="codebox"><pre><code>qemu-system-x86_64: cannot set up guest memory &#039;pc.ram&#039;: Cannot allocate memory</code></pre></div><p>Here&#039;s my qemu command:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 10240 -cpu host,kvm=off -smp 8,sockets=1,cores=4,threads=2 \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -device vfio-pci,host=01:00.0 -device vfio-pci,host=01:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/mapper/VolGroup00-vm,id=disk,format=raw,if=none \ -device scsi-hd,drive=disk \ -net nic -net bridge,br=br0 \ -rtc base=localtime,clock=host \ -vga none</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517753">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517766" class="blockpost rowodd"> <h2><span><span class="conr">#4740</span> <a href="viewtopic.php?pid=1517766#p1517766">2015-04-07 23:56:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SoftWinds wrote:</cite><blockquote><div><p>Actually I do have another question, but I&#039;m not really sure if it&#039;s related to GPU passthrough or just general KVM/QEMU: When I start the VM the first time everything&#039;s fine, but if I shut down the VM and try to start it again I run into the error:</p><div class="codebox"><pre><code>qemu-system-x86_64: cannot set up guest memory &#039;pc.ram&#039;: Cannot allocate memory</code></pre></div></div></blockquote></div><p>Sounds like you&#039;re hitting a memory leak, what kernel/qemu versions are you using?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517766">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517767" class="blockpost roweven"> <h2><span><span class="conr">#4741</span> <a href="viewtopic.php?pid=1517767#p1517767">2015-04-08 00:00:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mutiny wrote:</cite><blockquote><div><p>Just curious, is it possible to have a &quot;passed through&quot; physical hard drive without any virtual disk drive/image? Basically, instead of having an OS raw or qcow2 image file on the host&#039;s hard disk/filesystem, or instead of even passing an entire block device (drive /dev/sda for example), can we attach a physical hard drive to a motherboard&#039;s 2nd SATA controller, and pass through the SATA controller to the guest and have all disk operations performed by the guest alone through that controller? Will OVMF and the guest see the hard disk and be able to install OS, boot off it, etc?</p></div></blockquote></div><p>Yes, you can theoretically pass through any PCI endpoint device.&#160; How well it works depends on the device.&#160; Whether it&#039;s supported as a pre-boot device depends on whether there&#039;s a boot ROM for the device or built-in support or standard compatibility in the VM firmware.&#160; IOW, try it and find out.&#160; OTOH, my personal opinion is that assigning PCI HBAs often provides a marginal performance improvement and significantly more headaches vs paravirtual solutions.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517767">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517768" class="blockpost rowodd"> <h2><span><span class="conr">#4742</span> <a href="viewtopic.php?pid=1517768#p1517768">2015-04-08 00:03:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89974">SoftWinds</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-02</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dangsquall+archbbs@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SoftWinds wrote:</cite><blockquote><div><p>Actually I do have another question, but I&#039;m not really sure if it&#039;s related to GPU passthrough or just general KVM/QEMU: When I start the VM the first time everything&#039;s fine, but if I shut down the VM and try to start it again I run into the error:</p><div class="codebox"><pre><code>qemu-system-x86_64: cannot set up guest memory &#039;pc.ram&#039;: Cannot allocate memory</code></pre></div></div></blockquote></div><p>Sounds like you&#039;re hitting a memory leak, what kernel/qemu versions are you using?</p></div></blockquote></div><p>I&#039;m running qemu 2.2.1-2 on Arch with kernel 3.19.2-1. I think it&#039;s a memory leak as well, since I checked all the process in htop and nothing seems out of the ordinary, and when I sum the memory usage up it&#039;s nowhere near enough to fill up my RAM. Is there anything I can do to debug this?</p><p>By the way, thanks aw for your work on this!</p> <p class="postedit"><em>Last edited by SoftWinds (2015-04-08 00:05:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517768">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518009" class="blockpost roweven"> <h2><span><span class="conr">#4743</span> <a href="viewtopic.php?pid=1518009#p1518009">2015-04-08 20:00:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to figure out whether or not my Nvidia 780 supports EFI. I would think it would, but when I try to dump the rom:</p><div class="codebox"><pre><code>$ cd /sys/bus/pci/devices/000:02:00.0 $ echo 1 &gt; rom $ cat rom cat: rom: Input/output error $ dmesg | tail ... [ 4850.407367] pci-stub 0000:02:00.0: Invalid ROM contents</code></pre></div><p>The card has been taken as a stub:</p><div class="codebox"><pre><code>$ dmesg | grep stub [ 0.435187] pci-stub: add 10DE:1004 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.435192] pci-stub 0000:02:00.0: claimed by stub [ 0.435195] pci-stub: add 10DE:0E1A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.435199] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><p>My relevant kernel boot parameters:</p><div class="codebox"><pre><code>$ cat /proc/cmdline intel_iommu=on pci-stub.ids=10de:1004,10de:0e1a pcie_acs_override=downstream</code></pre></div><p>And my lspci:</p><div class="codebox"><pre><code>$ lspci 00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 04) 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04) 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-V (rev 04) 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 04) 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 04) 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) 00:1c.1 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #2 (rev d4) 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) 00:1c.5 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #6 (rev d4) 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 04) 00:1f.0 ISA bridge: Intel Corporation Z87 Express LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 04) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Barts XT [Radeon HD 6870] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GK110 [GeForce GTX 780] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GK110 HDMI Audio (rev a1) 04:00.0 Network controller: Qualcomm Atheros AR9462 Wireless Network Adapter (rev 01) 05:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) 06:04.0 Multimedia audio controller: C-Media Electronics Inc CMI8788 [Oxygen HD Audio] 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)</code></pre></div><p>In the past I&#039;ve been able to successfully do the hacky VGA-based passthrough, but I&#039;d like to use the OVMF/EFI method instead.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518009">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518011" class="blockpost rowodd"> <h2><span><span class="conr">#4744</span> <a href="viewtopic.php?pid=1518011#p1518011">2015-04-08 20:05:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Slabity wrote:</cite><blockquote><div><p>I&#039;m trying to figure out whether or not my Nvidia 780 supports EFI. I would think it would, but when I try to dump the rom:</p></div></blockquote></div><p>There&#039;s no harm in just trying it and it seems likely that it would.&#160; If you get the TianoCore bootsplash, the answer is yes.</p> <p class="postedit"><em>Last edited by aw (2015-04-08 20:05:37)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518011">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518023" class="blockpost roweven"> <h2><span><span class="conr">#4745</span> <a href="viewtopic.php?pid=1518023#p1518023">2015-04-08 22:21:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Slabity wrote:</cite><blockquote><div><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Barts XT [Radeon HD 6870] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GK110 [GeForce GTX 780] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GK110 HDMI Audio (rev a1)</code></pre></div><p>In the past I&#039;ve been able to successfully do the hacky VGA-based passthrough, but I&#039;d like to use the OVMF/EFI method instead.</p></div></blockquote></div><p>I&#039;d say, both of your GPUs support UEFI.<br />EFI GOP driver part of my VBIOS is taken from barts GPU vbios.</p><p>There are some problems with nvidia ROMs, like pre-POST/post-POST ROMs and stuff. You could actually try lurking in <a href="http://www.techpowerup.com/vgabios/index.php" rel="nofollow">TPU&#039;s VBIOS database</a> or try fetching the VBIOS from windows using GPU-z software, i&#039;ve heard recent versions of it can handle stuff well.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-08 22:22:46)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518023">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518056" class="blockpost rowodd"> <h2><span><span class="conr">#4746</span> <a href="viewtopic.php?pid=1518056#p1518056">2015-04-09 04:30:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yes, you can theoretically pass through any PCI endpoint device.&#160; How well it works depends on the device.&#160; Whether it&#039;s supported as a pre-boot device depends on whether there&#039;s a boot ROM for the device or built-in support or standard compatibility in the VM firmware.&#160; IOW, try it and find out.&#160; OTOH, my personal opinion is that assigning PCI HBAs often provides a marginal performance improvement and significantly more headaches vs paravirtual solutions.</p></div></blockquote></div><p>I gave this a shot today just to experiment. I connected a spare 1TB SATA drive to the motherboard&#039;s Marvell SATA controller (non-chipset 2nd controller) and passed that through qemu to play around with. OVMF shows no signs of seeing a drive/controller (not sure if I should even be seeing anything really), but booting off a Windows install ISO shows the hard drive perfectly fine, and allows me to install to it. However, after the install completes and the guest system reboots, OVMF just dumps back at the Shell&gt; prompt. OVMF&#039;s Boot Manager shows a &quot;Windows Boot Manager&quot; entry with device path: HD(2,GPT,UUID#)/\EFI\Microsoft\Boot\bootmgfw.efi so it seems like Windows at least installed boot information to the drive and to the firmware VARS I think? Not sure what to do from here or if it is a dead end. Maybe others have experimented with trying something like this (this is just all out of curiosity&#039;s sake). Probably has something to do with HD index showing as being at 2, wonder if this could be manually edited.</p> <p class="postedit"><em>Last edited by mutiny (2015-04-09 04:44:03)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518056">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518120" class="blockpost roweven"> <h2><span><span class="conr">#4747</span> <a href="viewtopic.php?pid=1518120#p1518120">2015-04-09 10:59:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I encountered small problem when reinstalling my hypervisor OS recently, hope someone can point me to most robust solution.</p><p>My setup is basically headless host running two guest Windows 7 instances, each with own GPU and other peripherals (including native sound). One of guest instances takes primary GPU and the other takes second; hypervisor is controlled via serial console and/or ssh. The problem seems to be that &quot;basically headless&quot; is not as good as (planned) &quot;actually headless&quot;. </p><p>What seems to be happening is that pci-stub is unable to attach itself to primary GPU because it is used by vgaarb early on kernel startup. Because pci-stub is unable to attach itself to primary GPU, snd_hda_intel comes along later and grabs HDMI audio output of this card (readeon is blacklisted), and this leads to all sort of trouble when guest starts up. Of course simple configuration tweak is to blacklist this module (which I did) but I&#039;d prefer it pci-stub just did what it was configured to do in the first place i.e. prevent any driver from attaching itself to primary GPU (e.g. just in case some other driver came along in newer Linux version).</p><p>I think for this I need to disable vgaarb or set configuration such that vgaarb &quot;knows&quot; that the machine is meant to be running headless and no VGA output is available to host OS. Solutions coming to my mind are:<br />* disable CONFIG_VGA_CONSOLE in configuration and recompile kernel<br />* or disable CONFIG_VGA_ARB (same drawback as above)<br />* or set &quot;install vgaarb /bin/false&quot; in /etc/modprobe.d/ (assuming vgaarb can be built as module?)</p><p>I wonder what is the right way to approach the problem; ideally I&#039;d rather use configuration thus making my setup less dependent on correct set of configuration switches when building the kernel. If only I could somehow set kernel parameters such as to force screen_info.orig_video_isVGA=0 ... perhaps boot parameter &quot;earlyprintk=serial,...&quot; might help?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518120">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518141" class="blockpost rowodd"> <h2><span><span class="conr">#4748</span> <a href="viewtopic.php?pid=1518141#p1518141">2015-04-09 12:58:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><p>vgaarb is not a &quot;device driver&quot; and cannot be built as a module.&#160; It&#039;s a kernel service.&#160; It&#039;s not consuming resources of the device and won&#039;t prevent pci-stub from attaching.&#160; Have you tried building CONFIG_PCI_STUB=y?&#160; If you build pci-stub as a module then you need to go through extra effort to make sure it loads before other modules.&#160; See the modprobe.d softdep option for example.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518141">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518152" class="blockpost roweven"> <h2><span><span class="conr">#4749</span> <a href="viewtopic.php?pid=1518152#p1518152">2015-04-09 13:48:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Bronek</p><p>vgaarb is not a &quot;device driver&quot; and cannot be built as a module.&#160; It&#039;s a kernel service.&#160; It&#039;s not consuming resources of the device and won&#039;t prevent pci-stub from attaching.&#160; Have you tried building CONFIG_PCI_STUB=y?&#160; If you build pci-stub as a module then you need to go through extra effort to make sure it loads before other modules.&#160; See the modprobe.d softdep option for example.</p></div></blockquote></div><p>Thanks aw; yes I build with CONFIG_PCI_STUB=y and yet somehow option to claim my primary GPU is ignored by pci-stub while all other PCI resources are claimed with no problems (USB cards, secondary GPU, motherboard sound, motherboard USB). I can use primary GPU for passthrough despite it, but this does not seem very robust. From dmesg I can see that vgaarb makes this GPU its default and I thought this is related. My kernel is 3.18.11 , I will post more details later today when I get home. At this moment I&#039;m tempted to build without VGA_ARB but I&#039;d prefer runtime option instead if there is one ...</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518152">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518177" class="blockpost rowodd"> <h2><span><span class="conr">#4750</span> <a href="viewtopic.php?pid=1518177#p1518177">2015-04-09 15:40:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83606">Child_of_Sun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 8</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mutiny wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yes, you can theoretically pass through any PCI endpoint device.&#160; How well it works depends on the device.&#160; Whether it&#039;s supported as a pre-boot device depends on whether there&#039;s a boot ROM for the device or built-in support or standard compatibility in the VM firmware.&#160; IOW, try it and find out.&#160; OTOH, my personal opinion is that assigning PCI HBAs often provides a marginal performance improvement and significantly more headaches vs paravirtual solutions.</p></div></blockquote></div><p>I gave this a shot today just to experiment. I connected a spare 1TB SATA drive to the motherboard&#039;s Marvell SATA controller (non-chipset 2nd controller) and passed that through qemu to play around with. OVMF shows no signs of seeing a drive/controller (not sure if I should even be seeing anything really), but booting off a Windows install ISO shows the hard drive perfectly fine, and allows me to install to it. However, after the install completes and the guest system reboots, OVMF just dumps back at the Shell&gt; prompt. OVMF&#039;s Boot Manager shows a &quot;Windows Boot Manager&quot; entry with device path: HD(2,GPT,UUID#)/\EFI\Microsoft\Boot\bootmgfw.efi so it seems like Windows at least installed boot information to the drive and to the firmware VARS I think? Not sure what to do from here or if it is a dead end. Maybe others have experimented with trying something like this (this is just all out of curiosity&#039;s sake). Probably has something to do with HD index showing as being at 2, wonder if this could be manually edited.</p></div></blockquote></div><p>I try the &quot;same&quot; thing with my Motherbord Sata Controller it&#039;s a SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode]. The Windows 8.1 DVD won&#039;t boot and the Windows 10 Tech Preview freezes.</p><p>Ovmf has no boot option for this controller, even when i use uefi-raid mode.</p><p>I hope someone can help with that.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518177">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=189">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <strong>190</strong> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=191">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
