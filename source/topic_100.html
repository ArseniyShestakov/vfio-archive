<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 100) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=100" title="Page 100" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=99" title="Page 99" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=101" title="Page 101" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=99">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=98">98</a> <a href="viewtopic.php?id=162768&amp;p=99">99</a> <strong>100</strong> <a href="viewtopic.php?id=162768&amp;p=101">101</a> <a href="viewtopic.php?id=162768&amp;p=102">102</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=101">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1446078" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2476</span> <a href="viewtopic.php?pid=1446078#p1446078">2014-08-11 20:19:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I think I got it how to compile the kernel, read few guides.</p><p>What I now get is this:</p><p>sudo patch -p1 &lt; override_for_missing_acs_capabilities.patch<br />patching file Documentation/kernel-parameters.txt<br />Hunk #1 succeeded at 2490 with fuzz 1 (offset -64 lines).<br />patching file drivers/pci/quirks.c<br />Hunk #1 succeeded at 3394 (offset 10 lines).<br />Hunk #2 succeeded at 3539 with fuzz 1 (offset -45 lines).<br />Hunk #3 FAILED at 3597.<br />1 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej</p><p>Could anyone please tell me what I&#039;m doing wrong? The kernel I got is: &quot;linux-image-3.13.0-32-generic&quot; which I got with &quot;sudo apt-get source linux-image-`uname -r`&quot;</p></div></blockquote></div><p>here is the kernel : <br /><a href="http://kernel.org/" rel="nofollow">http://kernel.org/</a></p><p>change dir to </p><div class="codebox"><pre><code> cd /usr/src/ </code></pre></div><p>Download the last stable, extract with </p><div class="codebox"><pre><code>tar -xvf &quot;archive name&quot;</code></pre></div><p>Download the patches from the first page, extract to /usr/src<br />change dir to the extracted kernel, </p><div class="codebox"><pre><code> cd linux-3.16/ </code></pre></div><p>apply the needed patches by:</p><div class="codebox"><pre><code> patch -p1 &lt; ../linux-mainline/ [NEEDED .PATCH] </code></pre></div><p>you could also read here, it helped me very well:<br /><a href="http://edencomputing.com/" rel="nofollow">http://edencomputing.com/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446078">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446082" class="blockpost roweven"> <h2><span><span class="conr">#2477</span> <a href="viewtopic.php?pid=1446082#p1446082">2014-08-11 20:25:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I think I got it how to compile the kernel, read few guides.</p><p>What I now get is this:</p><p>sudo patch -p1 &lt; override_for_missing_acs_capabilities.patch<br />patching file Documentation/kernel-parameters.txt<br />Hunk #1 succeeded at 2490 with fuzz 1 (offset -64 lines).<br />patching file drivers/pci/quirks.c<br />Hunk #1 succeeded at 3394 (offset 10 lines).<br />Hunk #2 succeeded at 3539 with fuzz 1 (offset -45 lines).<br />Hunk #3 FAILED at 3597.<br />1 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej</p><p>Could anyone please tell me what I&#039;m doing wrong? The kernel I got is: &quot;linux-image-3.13.0-32-generic&quot; which I got with &quot;sudo apt-get source linux-image-`uname -r`&quot;</p></div></blockquote></div><p>here is the kernel : <br /><a href="http://kernel.org/" rel="nofollow">http://kernel.org/</a></p><p>change dir to </p><div class="codebox"><pre><code> cd /usr/src/ </code></pre></div><p>Download the last stable, extract with </p><div class="codebox"><pre><code>tar -xvf &quot;archive name&quot;</code></pre></div><p>Download the patches from the first page, extract to /usr/src<br />change dir to the extracted kernel, </p><div class="codebox"><pre><code> cd linux-3.16/ </code></pre></div><p>apply the needed patches by:</p><div class="codebox"><pre><code> patch -p1 &lt; ../linux-mainline/ [NEEDED .PATCH] </code></pre></div><p>you could also read here, it helped me very well:<br /><a href="http://edencomputing.com/" rel="nofollow">http://edencomputing.com/</a></p></div></blockquote></div><p>Thank you very much to you and sinny! But what I want to do is compile a &quot;stable&quot; kernel that gets updated every now and then by the OS to more and more &quot;stable&quot; one. Does this kernel from this site need to get &quot;manually&quot; updated every now and then? Im very grateful for what you wrote but try to answer this...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446082">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446198" class="blockpost rowodd"> <h2><span><span class="conr">#2478</span> <a href="viewtopic.php?pid=1446198#p1446198">2014-08-12 04:44:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@aw </p><p>one question pls <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>what are options for clock or what clock to use on windows guest to make it &quot;tight&quot; or something like that, i get this weird problem after 30 or 60mins clock on vm is re/set or smth, cause when streaming games logs show frame time in -12312435ms expected is 20-50ms, and it starts to lag, it shows estimated bandwith like 10-40mbps (expected is 400-1000) in steam stats on 1gbps lan (alt-tab, copy-paste at same time 100MB/s) etc.... maybe cause of high cpu load? clock lags?</p><p>i did try couple of options that i found here/on internet, but nothing seems to make it go away completely. </p><p>problem it is happening after 30mins so its pain to wait for it <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>does hwclock need to be in sync with os clock? </p><br /><p>thx</p></div></blockquote></div><p>A solution is posted on the very same page of the thread that your post is on <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Pass -no-hpet to qemu. HPET in qemu seems to cause time drift.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446198">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446199" class="blockpost roweven"> <h2><span><span class="conr">#2479</span> <a href="viewtopic.php?pid=1446199#p1446199">2014-08-12 04:46:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I think I got it how to compile the kernel, read few guides.</p><p>What I now get is this:</p><p>sudo patch -p1 &lt; override_for_missing_acs_capabilities.patch<br />patching file Documentation/kernel-parameters.txt<br />Hunk #1 succeeded at 2490 with fuzz 1 (offset -64 lines).<br />patching file drivers/pci/quirks.c<br />Hunk #1 succeeded at 3394 (offset 10 lines).<br />Hunk #2 succeeded at 3539 with fuzz 1 (offset -45 lines).<br />Hunk #3 FAILED at 3597.<br />1 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej</p><p>Could anyone please tell me what I&#039;m doing wrong? The kernel I got is: &quot;linux-image-3.13.0-32-generic&quot; which I got with &quot;sudo apt-get source linux-image-`uname -r`&quot;</p></div></blockquote></div><p>here is the kernel : <br /><a href="http://kernel.org/" rel="nofollow">http://kernel.org/</a></p><p>change dir to </p><div class="codebox"><pre><code> cd /usr/src/ </code></pre></div><p>Download the last stable, extract with </p><div class="codebox"><pre><code>tar -xvf &quot;archive name&quot;</code></pre></div><p>Download the patches from the first page, extract to /usr/src<br />change dir to the extracted kernel, </p><div class="codebox"><pre><code> cd linux-3.16/ </code></pre></div><p>apply the needed patches by:</p><div class="codebox"><pre><code> patch -p1 &lt; ../linux-mainline/ [NEEDED .PATCH] </code></pre></div><p>you could also read here, it helped me very well:<br /><a href="http://edencomputing.com/" rel="nofollow">http://edencomputing.com/</a></p></div></blockquote></div><p>Thank you very much to you and sinny! But what I want to do is compile a &quot;stable&quot; kernel that gets updated every now and then by the OS to more and more &quot;stable&quot; one. Does this kernel from this site need to get &quot;manually&quot; updated every now and then? Im very grateful for what you wrote but try to answer this...</p></div></blockquote></div><p>you will have to manually update it every time either way unless you stop updating kernel at all. or you may find somewhere some kind of ubuntu repo with kernels specifically built for vt-d puproses (though me doubts it)<br />once again: this IS experimental stuff, so it IS NOT a convenient thing and it MAY break with any change/update you perform on the system</p><p>@abdullah:<br />there are tons of distro-specific scenarios descriptions on the internet, so you probably should not even try to describe it here (simply because you will miss ton of distro-specific details: e.g. co-existing with distro infrastructure, managing initramfs/initrd, etc)</p> <p class="postedit"><em>Last edited by sinny (2014-08-12 04:47:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446199">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446207" class="blockpost rowodd"> <h2><span><span class="conr">#2480</span> <a href="viewtopic.php?pid=1446207#p1446207">2014-08-12 05:11:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=29941">maxexcloo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/29941.png?m=1294114138" width="80" height="80" alt="" /></dd> <dd><span>From: Australia</span></dd> <dd><span>Registered: 2009-10-14</span></dd> <dd><span>Posts: 177</span></dd> <dd class="usercontacts"><span class="website"><a href="http://www.excloo.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does this work with switcable graphics? It would be an awesome use of that capability in my laptop <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446207">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446216" class="blockpost roweven"> <h2><span><span class="conr">#2481</span> <a href="viewtopic.php?pid=1446216#p1446216">2014-08-12 07:04:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@aw </p><p>one question pls <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>what are options for clock or what clock to use on windows guest to make it &quot;tight&quot; or something like that, i get this weird problem after 30 or 60mins clock on vm is re/set or smth, cause when streaming games logs show frame time in -12312435ms expected is 20-50ms, and it starts to lag, it shows estimated bandwith like 10-40mbps (expected is 400-1000) in steam stats on 1gbps lan (alt-tab, copy-paste at same time 100MB/s) etc.... maybe cause of high cpu load? clock lags?</p><p>i did try couple of options that i found here/on internet, but nothing seems to make it go away completely. </p><p>problem it is happening after 30mins so its pain to wait for it <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>does hwclock need to be in sync with os clock? </p><br /><p>thx</p></div></blockquote></div><p>A solution is posted on the very same page of the thread that your post is on <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Pass -no-hpet to qemu. HPET in qemu seems to cause time drift.</p></div></blockquote></div><p>i did try that... but problem still presists... i think its not real clock problem, its ticks or something... cause in logs input time goes in negative values.... and it happens due high cpu load... like some ticks got delayed...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446216">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446232" class="blockpost rowodd"> <h2><span><span class="conr">#2482</span> <a href="viewtopic.php?pid=1446232#p1446232">2014-08-12 08:31:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84283">brezerk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84283.jpg?m=1407830798" width="50" height="50" alt="" /></dd> <dd><span>From: Kiev, Ukraine</span></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:brezerk@gmail.com">Email</a></span> <span class="website"><a href="https://github.com/brezerk/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lojsar wrote:</cite><blockquote><div><p>Furthermore, I had great success modifying the VBIOS. Using a program called &quot;nvbios&quot; from &quot;envytools&quot; together with nVidia&#039;s documentation of the DCB ( <a href="ftp://download.nvidia.com/open-gpu-doc/DCB/1/DCB-4.0-Specification.html#_dcb_flags" rel="nofollow">ftp://download.nvidia.com/open-gpu-doc/ … _dcb_flags</a> ), I was able to replace the VGA output. After this, I see BIOS output on my monitor! I was also able to run Windows (with -vga none), and install the nVidia drivers!</p></div></blockquote></div><p>Hi. Does anyone have an idea or doc how I can modify DCB table? </p><p>I have an Notebook with Intel HD + GT650M glued with optimus. <br />I was able to switch host output to Intel Graphic and bypass GT650M to kvm, and install nvidia drivers on w7 guest. But... I see no output on HDMI at all. =\<br />Also windows refuse to start if I set -vga none.</p><p>DCB reports:</p><div class="codebox"><pre><code>DCB table at 0x532a version 4.0 unk16 0x01 DCB 0: type 3 [LVDS] I2C 0 heads 0 CONN 0 [0x40] conntag 0 LOCAL unk02_6 2 OR 0 links 0 1 INFO EDID_I2C POWER 1 unk06 0x01 DCB 1: type 6 [DP] I2C 10 heads 1 CONN 1 [0x46] conntag 1 LOCAL unk02_6 2 OR 1 links 0 BW 270000 lanes 0 1 2 3 DCB 2: type 2 [TMDS] I2C 1 heads 1 CONN 1 [0x46] conntag 1 LOCAL OR 1 links 0 HDMI DCB 3: type 6 [DP] I2C 11 heads 2 CONN 2 [0x46] conntag 2 LOCAL unk02_6 2 OR 2 links 0 BW 270000 lanes 0 1 2 3 DCB 4: type 2 [TMDS] I2C 7 heads 2 CONN 2 [0x46] conntag 2 LOCAL OR 2 links 0 HDMI DCB 5: type 6 [DP] I2C 12 heads 3 CONN 3 [0x46] conntag 3 LOCAL unk02_6 2 OR 3 links 0 BW 270000 lanes 0 1 2 3 DCB 6: type 2 [TMDS] I2C 8 heads 3 CONN 3 [0x46] conntag 3 LOCAL OR 3 links 0 HDMI DCB 7: type 14 [EOL]</code></pre></div><p>It looks like I need to replace VGA output as well. But I am not 100% sure what I am doing :) Any help will be appreciated.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446232">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446233" class="blockpost roweven"> <h2><span><span class="conr">#2483</span> <a href="viewtopic.php?pid=1446233#p1446233">2014-08-12 08:40:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52587">Fira</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-24</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52587">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey. Just wanted to report my success thanks to this guide, been running this kind of setup for a few months and it&#039;s working great.</p><p>Running: <br /> - Kernel 3.14.2 with Gentoo patchset and the i915 drm patch listed at start of thread<br /> - Qemu 2.0.0 Vanilla<br /> - Seabios 1.7.4 Vanilla<br /> - Windows 8.1</p><p>On hardware:<br /> - Asrock Z87 Extreme3<br /> - Xeon E3-1275v3 (Xeon equivalent of the i7-4771, same price)<br /> - And a GeForce GTX 750 Ti, works with or without passing the sound sub-card<br /> - Running with EFI on the Host side, BIOS on the Guest side<br />I initially planned to run this kind of setup under Xen but apparently GeForce requires hardmods, and the 750 doesn&#039;t even seem to be moddable : p</p><p>Now for the gotchas:</p><p><strong> - Windows 8.1&#039;s bootloader</strong> <br />The install had to be done without VGA passthrough enabled: when it is enabled, any bootloader update just nukes it for some reason. I tried to install Windows 8 and upgrade to 8.1 with passthrough, nuked. I installed 8.1 and left Windows Update auto, nuked after two days. All my recovery attempts failed miserably and the bootloader partition is outright empty.</p><p><strong>- Commandline gotchas </strong><br />Some of the standard Qemu options didn&#039;t seem to work because of the custom chipset, for exemple i had to use -drive instead of -hda and such. <br />You wouldn&#039;t believe how long it took me to figure it out...</p><p><strong> - Sound</strong><br /> Sound&#039;s been a big issue for me at start. Using AC97 froze guest. I could never get the ES1370 driver from realtek installed on Win8. HDA seemed to work fine until i realized it added huge echo after some time. I settled with usb-audio which caused occasional crashes but worked fine. However once I installed PulseAudio on guest and output wasn&#039;t on ALSA anymore, it would start stuttering. After a while digging in the QEMU Source, i found out that the hda driver is meant to work on ICH6 chipsets while the IOH3420 is of the ICH9 variety. Thanksfully there is an undocumented &quot;ich9-intel-hda&quot; variant which works perfectly !</p><div class="codebox"><pre><code>-device ich9-intel-hda,bus=root.1 -device hda-duplex,bus=hda.0</code></pre></div><p><strong> - Virtio</strong><br />Couldn&#039;t manage to get virtio working correctly under Win8. It&#039;s probably possible, but i&#039;m too lazy to try again knowing about the bootloader problems.</p><p><strong> - Awkward Disk Iops Patterns</strong><br />The only real issue i still have today. Maybe because i&#039;m running with 32GB RAM (16GB Host; 16GB to Guest), there seems to be abberrant amount of caching. Got a 4-disk SATA RAID5 array underneath.<br />When doing a disk-to-disk transfer in the guest, rate peaks at 500 Mb then drops to zero. The guest freezes for a few seconds, then does it again.<br />This is especially noticeable in some games, where any object entering the field can cause a little freeze - i believe due to texture and models loading.</p><p><strong> - Synergy for mouse/keyboard sharing</strong><br />Little offtopic, but If you plan to use Synergy, be aware that the AltGr key seems to be buggued... <br />Even applying the workarounds found around the net, it doesn&#039;t seem to help much.<br />I chose to just live with it and keep @s to copy/paste around : p<br />Otherwise perfs are very good. Just be aware you need to lock the mouse to your screen to use mouse-grabbing apps or they glitch.</p><br /><p>The whole line:</p><div class="codebox"><pre><code>QEMU_AUDIO_DRV=pa \ qemu-system-x86_64 \ -name winix \ -enable-kvm \ -M q35 \ -m 16192 \ -cpu host \ -smp 4,sockets=1,cores=4 \ -net nic -net user \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -usb \ -device ich9-intel-hda,bus=root.1 \ -device hda-duplex,bus=hda.0 \ -drive file=/dev/raidvg/winix-sys,id=system \ -device ide-hd,bus=ide.0,drive=system \ -drive file=/dev/raidvg/winix,id=data \ -device ide-hd,bus=ide.1,drive=data \ -vga none -nographic \ -boot order=dc</code></pre></div><p>That&#039;s it. Thanks for all the help, and I hope these informations will help you in turn <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Good luck with your setups !</p> <p class="postedit"><em>Last edited by Fira (2014-08-12 09:00:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446233">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446238" class="blockpost rowodd"> <h2><span><span class="conr">#2484</span> <a href="viewtopic.php?pid=1446238#p1446238">2014-08-12 09:23:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve got an ubuntu 14.04 64bit server with an ATI HD7770 secondary card (HD5450 primary, no proprietary drivers loaded) and having issues, so hope someone could help.</p><p>Has anyone got this working with the virtual machine manager (GUI)?<br />I&#039;ve got hardware that is capable (did get EXSi VM working with my HD7770 and streaming some steam games), but struggling with kvm.<br />I have used the cli method to get my video card &amp; audio passed ( lspci -k |grep vfio shows the 2 entries) and installed Win7.<br />But after installing the ATI drivers (just video &amp; audio custom install) the first reboot I got error code 43 on the card. Close?<br />After a shutdown I can not boot the VM again successfully.</p><p>So thought I&#039;d try the VMM route.<br />Installed Win7 and passed the card, shows in device manager, but again install drivers and fails to boot again.<br />Remove card entries and will boot fine.<br />I&#039;m using a default sata drivers, using /dev/sdb2 raw partition and a fresh Win7x64 install.<br />So I noticed VMM was using kvm as the emulator (my error on creating I assume), so I started again with qemu-system-x86_64 but it blue screens on any VM boot it seems.<br />Is it futile to continue with VMM?<br />I have qemu 2.0 installed.<br />kvm --version<br />QEMU emulator version 2.0.0 (Debian 2.0.0+dfsg-2ubuntu1.2), Copyright (c) 2003-2008 Fabrice Bellard<br />Any suggestions?<br />Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446243" class="blockpost roweven"> <h2><span><span class="conr">#2485</span> <a href="viewtopic.php?pid=1446243#p1446243">2014-08-12 09:44:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>here is the kernel : <br /><a href="http://kernel.org/" rel="nofollow">http://kernel.org/</a></p><p>change dir to </p><div class="codebox"><pre><code> cd /usr/src/ </code></pre></div><p>Download the last stable, extract with </p><div class="codebox"><pre><code>tar -xvf &quot;archive name&quot;</code></pre></div><p>Download the patches from the first page, extract to /usr/src<br />change dir to the extracted kernel, </p><div class="codebox"><pre><code> cd linux-3.16/ </code></pre></div><p>apply the needed patches by:</p><div class="codebox"><pre><code> patch -p1 &lt; ../linux-mainline/ [NEEDED .PATCH] </code></pre></div><p>you could also read here, it helped me very well:<br /><a href="http://edencomputing.com/" rel="nofollow">http://edencomputing.com/</a></p></div></blockquote></div><p>Thank you very much to you and sinny! But what I want to do is compile a &quot;stable&quot; kernel that gets updated every now and then by the OS to more and more &quot;stable&quot; one. Does this kernel from this site need to get &quot;manually&quot; updated every now and then? Im very grateful for what you wrote but try to answer this...</p></div></blockquote></div><p>you will have to manually update it every time either way unless you stop updating kernel at all. or you may find somewhere some kind of ubuntu repo with kernels specifically built for vt-d puproses (though me doubts it)<br />once again: this IS experimental stuff, so it IS NOT a convenient thing and it MAY break with any change/update you perform on the system</p><p>@abdullah:<br />there are tons of distro-specific scenarios descriptions on the internet, so you probably should not even try to describe it here (simply because you will miss ton of distro-specific details: e.g. co-existing with distro infrastructure, managing initramfs/initrd, etc)</p></div></blockquote></div><p>I understand, I thought it was like that. Can you recommend me a distro which has a repo like that? I don&#039;t care to use any other distro if its better for this. I just want it to be &quot;stable&quot; so I dont get hacked... Thanks for explanation!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446243">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446269" class="blockpost rowodd"> <h2><span><span class="conr">#2486</span> <a href="viewtopic.php?pid=1446269#p1446269">2014-08-12 11:37:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I understand, I thought it was like that. Can you recommend me a distro which has a repo like that? I don&#039;t care to use any other distro if its better for this. I just want it to be &quot;stable&quot; so I dont get hacked... Thanks for explanation!</p></div></blockquote></div><p>you really think you are worth &quot;hacking&quot;? more like you can get &quot;hacked&quot; only if you do something weird with your own hands. bad news - no distro will protect you from that</p><p>btw, &quot;stable&quot; is not about being &quot;hack&quot;-proof. in case you wondered</p><p>back to the topic...<br />i doubt there is any (once again: experimental feature we are talking about here). people occasionally write their success reports, some include distro mention - you can dig the thread and get something to make a choice from. manual work will be needed any way though.<br />i use fedora, but every kernel update i download i have to manually rebuild i915 module and update initramfs (posted more detailed description few pages &quot;ago&quot;)</p><p>p.s. there was a google docs file containing peoples&#039; specs with success/failure indication - could anyone please bring up the link (have trouble finding it - would be great to have it in head post)?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446269">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446282" class="blockpost roweven"> <h2><span><span class="conr">#2487</span> <a href="viewtopic.php?pid=1446282#p1446282">2014-08-12 12:17:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I understand, I thought it was like that. Can you recommend me a distro which has a repo like that? I don&#039;t care to use any other distro if its better for this. I just want it to be &quot;stable&quot; so I dont get hacked... Thanks for explanation!</p></div></blockquote></div><p>you really think you are worth &quot;hacking&quot;? more like you can get &quot;hacked&quot; only if you do something weird with your own hands. bad news - no distro will protect you from that</p><p>btw, &quot;stable&quot; is not about being &quot;hack&quot;-proof. in case you wondered</p><p>back to the topic...<br />i doubt there is any (once again: experimental feature we are talking about here). people occasionally write their success reports, some include distro mention - you can dig the thread and get something to make a choice from. manual work will be needed any way though.<br />i use fedora, but every kernel update i download i have to manually rebuild i915 module and update initramfs (posted more detailed description few pages &quot;ago&quot;)</p><p>p.s. there was a google docs file containing peoples&#039; specs with success/failure indication - could anyone please bring up the link (have trouble finding it - would be great to have it in head post)?</p></div></blockquote></div><p>I will try fedora. As long as its updating kernel every now and then as it should, I&#039;m happy with rebuilding it manually. Fedora needs qemu from git yes? Ubuntu has qemuv2.x and it wasnt needed. Thanks man!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446282">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446305" class="blockpost rowodd"> <h2><span><span class="conr">#2488</span> <a href="viewtopic.php?pid=1446305#p1446305">2014-08-12 14:39:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I understand, I thought it was like that. Can you recommend me a distro which has a repo like that? I don&#039;t care to use any other distro if its better for this. I just want it to be &quot;stable&quot; so I dont get hacked... Thanks for explanation!</p></div></blockquote></div><p>you really think you are worth &quot;hacking&quot;? more like you can get &quot;hacked&quot; only if you do something weird with your own hands. bad news - no distro will protect you from that</p><p>btw, &quot;stable&quot; is not about being &quot;hack&quot;-proof. in case you wondered</p><p>back to the topic...<br />i doubt there is any (once again: experimental feature we are talking about here). people occasionally write their success reports, some include distro mention - you can dig the thread and get something to make a choice from. manual work will be needed any way though.<br />i use fedora, but every kernel update i download i have to manually rebuild i915 module and update initramfs (posted more detailed description few pages &quot;ago&quot;)</p><p>p.s. there was a google docs file containing peoples&#039; specs with success/failure indication - could anyone please bring up the link (have trouble finding it - would be great to have it in head post)?</p></div></blockquote></div><p>This one :</p><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a></p><p>If you have the right hardware, it should work, I did it on Ubuntu, debian, working on Linux Mint now. When I did it on ubuntu it was stable enough, yet I had to get A nvidia card, which came with troubles, ending in breaking the system trying to fix it, so yes, no, this is not about being stable, and if you value the work on your PC you should be packing it up right now before even starting.</p><p>And I found an intersting wiki here, on isolating the guest<br /><a href="http://wiki.qemu.org/Documentation/Networking" rel="nofollow">http://wiki.qemu.org/Documentation/Networking</a></p><p>and I was able to pass through a USB keyboard &amp; mouse by bus # and addr #, which is good for whom got identical keyboards, <br />the command would be </p><div class="codebox"><pre><code> -usb -device usb-host,hostbus=#,hostaddr=# </code></pre></div><p>this was a helpful doc from opensus: <br /><a href="http://doc.opensuse.org/products/draft/SLES/SLES-kvm_sd_draft/cha.qemu.running.html" rel="nofollow">http://doc.opensuse.org/products/draft/ … nning.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446305">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446390" class="blockpost roweven"> <h2><span><span class="conr">#2489</span> <a href="viewtopic.php?pid=1446390#p1446390">2014-08-12 18:22:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83741">monchi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83741">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Finally I got an video output on my passedthrough GPU with the following commandline:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Now I want to transfer this settings to an existing Win7 VM controlled via WebVirtmg. Here is my current configuration file:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;win7_test_vm&lt;/name&gt; &lt;uuid&gt;a4040ddc-cb89-b885-5758-7cd84af1fc16&lt;/uuid&gt; &lt;description&gt;None&lt;/description&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-trusty&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;utc&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/dev/lvmlocal/win7_test_vm&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/www/webvirtmgr/images/Microsoft.Windows.7.Ultimate.SP1.x64.iso&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/www/webvirtmgr/images/virtio-win-0.1-81.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;00:54:00:3d:df:01&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039; listen=&#039;0.0.0.0&#039; keymap=&#039;de&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;0.0.0.0&#039;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&#039;cirrus&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;dynamic&#039; model=&#039;apparmor&#039; relabel=&#039;yes&#039;/&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-bios&#039;/&gt; &lt;qemu:arg value=&#039;/usr/share/qemu/bios.bin&#039;/&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;qemu:arg value=&#039;-M&#039;/&gt; &lt;qemu:arg value=&#039;q35&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ahci,bus=pcie.0,id=ahci&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>If I try to power up the VM I get this error:</p><div class="codebox"><pre><code>internal error: process exited while connecting to monitor: qemu-system-x86_64: -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2: Bus &#039;pci.0&#039; not found </code></pre></div><p>Anyone got an idea how to fix this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446390">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446433" class="blockpost rowodd"> <h2><span><span class="conr">#2490</span> <a href="viewtopic.php?pid=1446433#p1446433">2014-08-12 22:50:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ monchi, the -smp should be 2, same as the # cores.<br />could you try to boot up from cmd first, just to make sure..?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446433">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446435" class="blockpost roweven"> <h2><span><span class="conr">#2491</span> <a href="viewtopic.php?pid=1446435#p1446435">2014-08-12 22:53:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ monchi, the -smp should be 2, same as the # cores.<br />could you try to boot up from cmd first, just to make sure..?</p></div></blockquote></div><p>You can actually just specify &quot;-smp sockets=x,cores=y,threads=z&quot;, QEMU can do the math to figure out the total.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446435">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446438" class="blockpost rowodd"> <h2><span><span class="conr">#2492</span> <a href="viewtopic.php?pid=1446438#p1446438">2014-08-12 23:14:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ monchi, the -smp should be 2, same as the # cores.<br />could you try to boot up from cmd first, just to make sure..?</p></div></blockquote></div><p>You can actually just specify &quot;-smp sockets=x,cores=y,threads=z&quot;, QEMU can do the math to figure out the total.</p></div></blockquote></div><p>will be testing that soon, thanks for the info, but what about the number just after the -smp tag?</p><p> I managed to set-up a windows 8 VM with Nvidia 760 GTX, updated to the latest drivers (no code errors), and I&#039;m just working to get Opensuse to work with the 8500 GT. If I got the chance, I will be adding AMD 4790 HD ( which worked before I bought the 760 GTX ), I&#039;m on Linux Mint 17 ( you need to add the packages yourself from debian testing and make sure to install the right tools, I did it through synaptic).</p><p>a side note, I got my windows key blocked, as a nice advise, isolate the windows guest with:</p><div class="codebox"><pre><code> -netdev user,id=mynet0,restrict=y </code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446438">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446439" class="blockpost roweven"> <h2><span><span class="conr">#2493</span> <a href="viewtopic.php?pid=1446439#p1446439">2014-08-12 23:19:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ monchi, the -smp should be 2, same as the # cores.<br />could you try to boot up from cmd first, just to make sure..?</p></div></blockquote></div><p>You can actually just specify &quot;-smp sockets=x,cores=y,threads=z&quot;, QEMU can do the math to figure out the total.</p></div></blockquote></div><p>will be testing that soon, thanks for the info, but what about the number just after the -smp tag?</p></div></blockquote></div><p>That&#039;s what I&#039;m saying, it&#039;s unnecessary.&#160; Once upon a time, -smp # was all QEMU understood.&#160; Then people wanted to specify topology, so along came sockets, cores, and threads.&#160; Obviously we can figure out the number of CPUs given just the latter, but the old way still exists for compatibility, and I suppose if you wanted to under populate your core... TBH, I&#039;m not sure what happens when they&#039;re out of sync because I don&#039;t specify both.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446439">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446467" class="blockpost rowodd"> <h2><span><span class="conr">#2494</span> <a href="viewtopic.php?pid=1446467#p1446467">2014-08-13 02:58:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=11204">shazeal</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/11204.jpg?m=1212918678" width="80" height="80" alt="" /></dd> <dd><span>From: New Zealand</span></dd> <dd><span>Registered: 2007-06-05</span></dd> <dd><span>Posts: 339</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=11204">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p><strong> - Synergy for mouse/keyboard sharing</strong><br />Little offtopic, but If you plan to use Synergy, be aware that the AltGr key seems to be buggued... <br />Even applying the workarounds found around the net, it doesn&#039;t seem to help much.<br />I chose to just live with it and keep @s to copy/paste around : p<br />Otherwise perfs are very good. Just be aware you need to lock the mouse to your screen to use mouse-grabbing apps or they glitch.</p></div></blockquote></div><p>Thanks for this, never knew about Synergy before, just made my life a zillion times easier. I was planning on getting a mechanical KVM but this... so much better!</p><p>One part I did not really understand is the locking of the mouse? How can you do this without the SDL window?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446467">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446500" class="blockpost roweven"> <h2><span><span class="conr">#2495</span> <a href="viewtopic.php?pid=1446500#p1446500">2014-08-13 08:16:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>shazeal wrote:</cite><blockquote><div><div class="quotebox"><cite>Fira wrote:</cite><blockquote><div><p><strong> - Synergy for mouse/keyboard sharing</strong><br />Little offtopic, but If you plan to use Synergy, be aware that the AltGr key seems to be buggued... <br />Even applying the workarounds found around the net, it doesn&#039;t seem to help much.<br />I chose to just live with it and keep @s to copy/paste around : p<br />Otherwise perfs are very good. Just be aware you need to lock the mouse to your screen to use mouse-grabbing apps or they glitch.</p></div></blockquote></div><p>Thanks for this, never knew about Synergy before, just made my life a zillion times easier. I was planning on getting a mechanical KVM but this... so much better!</p><p>One part I did not really understand is the locking of the mouse? How can you do this without the SDL window?</p></div></blockquote></div><p>Synergy can lock input on particular screen with key bind.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446500">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446673" class="blockpost rowodd"> <h2><span><span class="conr">#2496</span> <a href="viewtopic.php?pid=1446673#p1446673">2014-08-13 23:19:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84323">deivid</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-13</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I got this to work with vainilla 3.16, an existing windows installation BSOD&#039;s on boot, but I&#039;ll just reinstall and try again.</p><p>My question is ( I did not read the 100 pages of the thread so don&#039;t kill me if this has been posted before):</p><p>I am running this on a headless server and will try to use steam in home streaming to use it. Is there any way to disable the screen output? Just seems like a waste</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446673">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446674" class="blockpost roweven"> <h2><span><span class="conr">#2497</span> <a href="viewtopic.php?pid=1446674#p1446674">2014-08-13 23:26:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deivid wrote:</cite><blockquote><div><p>I got this to work with vainilla 3.16, an existing windows installation BSOD&#039;s on boot, but I&#039;ll just reinstall and try again.</p><p>My question is ( I did not read the 100 pages of the thread so don&#039;t kill me if this has been posted before):</p><p>I am running this on a headless server and will try to use steam in home streaming to use it. Is there any way to disable the screen output? Just seems like a waste</p></div></blockquote></div><p>You just need to read the first page to know why that might not work.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446674">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446785" class="blockpost rowodd"> <h2><span><span class="conr">#2498</span> <a href="viewtopic.php?pid=1446785#p1446785">2014-08-14 13:11:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83600">d3lxa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83600">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>When I applied the VGAARB patch of aw on 3.15 (and enabled i915.enable_hd_vgaarb=1) I had my host DRI disabled. I&#039;ve read some posts saying people applying 81b5c7bc and 6e1b4fdad but it was back in 2013, what&#039;s the status right now? Is this normal to not have DRI although the patch purpose is to lie to Xorg so he does not see it?</p><p>I can say it solve the color glitch when the VM startup but the host cannot wake up reliably after suspend (tried twice, one failed). I could try a bit more to see if I was unlucky.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446785">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446806" class="blockpost roweven"> <h2><span><span class="conr">#2499</span> <a href="viewtopic.php?pid=1446806#p1446806">2014-08-14 14:51:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73655">irtimmer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-30</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73655">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>DRI2 is still disabled when the VGA arbiter is used. But it looks like DRI3 don&#039;t suffer from that problem. Although is currently a little bit unstable and you have to recompile xf86-video-intel</p> </div> <div class="postsignature postmsg"><hr /><p>I can read and write in English, but my english grammar is just horrible.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446806">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1446807" class="blockpost rowodd"> <h2><span><span class="conr">#2500</span> <a href="viewtopic.php?pid=1446807#p1446807">2014-08-14 14:52:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83741">monchi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83741">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ monchi, the -smp should be 2, same as the # cores.<br />could you try to boot up from cmd first, just to make sure..?</p></div></blockquote></div><p>You can actually just specify &quot;-smp sockets=x,cores=y,threads=z&quot;, QEMU can do the math to figure out the total.</p></div></blockquote></div><p>thanks for the info. It works. But the error when trying to start the VM from webvirtmgr remains:</p><div class="codebox"><pre><code>internal error: process exited while connecting to monitor: qemu-system-x86_64: -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2: Bus &#039;pci.0&#039; not found</code></pre></div><p>I think its a configuration failure. Here is my XML file again:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;win7_test_vm&lt;/name&gt; &lt;uuid&gt;a4040ddc-cb89-b885-5758-7cd84af1fc16&lt;/uuid&gt; &lt;description&gt;None&lt;/description&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-trusty&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;utc&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/dev/lvmlocal/win7_test_vm&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/www/webvirtmgr/images/Microsoft.Windows.7.Ultimate.SP1.x64.iso&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/www/webvirtmgr/images/virtio-win-0.1-81.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;00:54:00:3d:df:01&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039; listen=&#039;0.0.0.0&#039; keymap=&#039;de&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;0.0.0.0&#039;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&#039;cirrus&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;dynamic&#039; model=&#039;apparmor&#039; relabel=&#039;yes&#039;/&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-bios&#039;/&gt; &lt;qemu:arg value=&#039;/usr/share/qemu/bios.bin&#039;/&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;qemu:arg value=&#039;-M&#039;/&gt; &lt;qemu:arg value=&#039;q35&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ahci,bus=pcie.0,id=ahci&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div> <p class="postedit"><em>Last edited by monchi (2014-08-14 15:05:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1446807">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=99">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=98">98</a> <a href="viewtopic.php?id=162768&amp;p=99">99</a> <strong>100</strong> <a href="viewtopic.php?id=162768&amp;p=101">101</a> <a href="viewtopic.php?id=162768&amp;p=102">102</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=101">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
