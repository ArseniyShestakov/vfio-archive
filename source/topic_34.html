<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 34) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=34" title="Page 34" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=33" title="Page 33" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=35" title="Page 35" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=33">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=32">32</a> <a href="viewtopic.php?id=162768&amp;p=33">33</a> <strong>34</strong> <a href="viewtopic.php?id=162768&amp;p=35">35</a> <a href="viewtopic.php?id=162768&amp;p=36">36</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=35">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1353787" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#826</span> <a href="viewtopic.php?pid=1353787#p1353787">2013-11-26 09:00:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.</p></div></blockquote></div><p>With VBIOS you mean the bios on the video card? No I haven&#039;t updated that. I`d rather keep the original bios b/c as far as I understand it manages clocks/fans in a way I want it to - as a GTX 680. Is there a way to force seabios to run GPU BIOS even though there is a mismatch?</p></div></blockquote></div><p>You won&#039;t have VGA on bare metal without a modified VBIOS either, so our emulation is accurate <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />&#160; The only way to force seabios to use the VBIOS would be to modify the code.</p><div class="quotebox"><cite>ila80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Thanks for advice! Ill try that.</p><p>Update: for some reason WIndows is not able to boot - BSOD with PAGE_FAULT_IN_NONPAGED_AREA code 0x00000050. Sometimes BSOD has different code 0x0000007E ( SYSTEM_THREAD_EXCEPTION_NOT_HANDLED )</p><p>I might look into seabios at see if it can be forced to load BIOS even though there is a mismatch.</p></div></blockquote></div><p>IIRC the PAGE_FAULT_IN_NONPAGED_AREA is the manifestation of the -cpu host problem on Nvidia.&#160; Try -cpu qemu64 or one of the CPU specific types.&#160; Note that you can dump the VBIOS, modify it, then load it with romfile= to avoid flashing it back to hardware.</p></div></blockquote></div><p>AW, thanks for your input, it is really appreciated!</p><p>I do boot Win7 on bare metal with my mainboard BIOS and I installed Quadro/Tesla/GRID drivers on it. Plays modern games as it did before <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> However my next steps are download bios from the card, patch the device ID and the checksum, and then feed that to seabios. Re: -cpu options I`ve had problems with it before, played with it and ended up booting fine with -cpu host. I`ll give it a some tries for sure though.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353787">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354852" class="blockpost roweven"> <h2><span><span class="conr">#827</span> <a href="viewtopic.php?pid=1354852#p1354852">2013-11-29 08:37:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76389">blitzschlag</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-30</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hmm, i have problems passing through my Etron EJ168 USB 3 Controller.</p><p>i bind it to vfio-pci and pass it to the Windows 7 VM. There its recognised and i can install the (latest) driver by Etron. The driver seems to be intalled ok but there is no power on the ports.</p><p>I read someone (aw?) got a machine up and running with eJ168?</p><p>kernel 3.12 and still only qemu-kvm 1.60 (debian unstable).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354852">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354898" class="blockpost rowodd"> <h2><span><span class="conr">#828</span> <a href="viewtopic.php?pid=1354898#p1354898">2013-11-29 11:40:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><p>hmm, i have problems passing through my Etron EJ168 USB 3 Controller.</p><p>i bind it to vfio-pci and pass it to the Windows 7 VM. There its recognised and i can install the (latest) driver by Etron. The driver seems to be intalled ok but there is no power on the ports.</p><p>I read someone (aw?) got a machine up and running with eJ168?</p><p>kernel 3.12 and still only qemu-kvm 1.60 (debian unstable).</p></div></blockquote></div><div class="codebox"><pre><code>$ lspci|grep Etron 03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 04:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>Hi, the person with those controllers seems to be me <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> although there might be more than one person with them</p><p>I managed to pass them to a Windows (7?) VM quite a while ago and they &quot;worked&quot; but etrons drivers and probably hardware were/are total garbage. The VM constantly threw BSODs at me, my mouse or kvm switch was lagging/randomly resetting when connected to one of the controllers and so on. This doesn&#039;t seem to be a problem with vfio though, since people without it are <a href="http://forums.tweaktown.com/asrock/47756-etron-usb3-0-bsod-issues-extreme-4-gen-3-a.html" rel="nofollow">having</a> <a href="http://forums.overclockers.com.au/showthread.php?t=994536" rel="nofollow">problems</a> too.</p><p>So yeah, this was probably not what you are looking for but my solution was to not use usb3 in the vm but usb2 controllers.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354907" class="blockpost roweven"> <h2><span><span class="conr">#829</span> <a href="viewtopic.php?pid=1354907#p1354907">2013-11-29 12:25:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76389">blitzschlag</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-30</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><p>hmm, i have problems passing through my Etron EJ168 USB 3 Controller.</p><p>i bind it to vfio-pci and pass it to the Windows 7 VM. There its recognised and i can install the (latest) driver by Etron. The driver seems to be intalled ok but there is no power on the ports.</p><p>I read someone (aw?) got a machine up and running with eJ168?</p><p>kernel 3.12 and still only qemu-kvm 1.60 (debian unstable).</p></div></blockquote></div><div class="codebox"><pre><code>$ lspci|grep Etron 03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 04:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>Hi, the person with those controllers seems to be me <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> although there might be more than one person with them</p><p>I managed to pass them to a Windows (7?) VM quite a while ago and they &quot;worked&quot; but etrons drivers and probably hardware were/are total garbage. The VM constantly threw BSODs at me, my mouse or kvm switch was lagging/randomly resetting when connected to one of the controllers and so on. This doesn&#039;t seem to be a problem with vfio though, since people without it are <a href="http://forums.tweaktown.com/asrock/47756-etron-usb3-0-bsod-issues-extreme-4-gen-3-a.html" rel="nofollow">having</a> <a href="http://forums.overclockers.com.au/showthread.php?t=994536" rel="nofollow">problems</a> too.</p><p>So yeah, this was probably not what you are looking for but my solution was to not use usb3 in the vm but usb2 controllers.</p></div></blockquote></div><p>ah, ok, thx for the Information.</p><p>My main Problem or concern is that just passing through the usb-hdd and emulating usb has really poor performance (7-9MB/s write). At least passing through one of the usb2 Controllers will give me better performance.<br />I was kinda hoping to be able to use&#160; the usb3 Controller for my usual video-editing (non-professional) stuff. As it is (with emulated usb) i have constant bufferings&#160; which freaks me out ^^</p><p>oh, btw, i use Synergy for sharing my Keyboard and Mouse. Works pretty solid even with gaming.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354907">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354911" class="blockpost rowodd"> <h2><span><span class="conr">#830</span> <a href="viewtopic.php?pid=1354911#p1354911">2013-11-29 12:31:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><p>hmm, i have problems passing through my Etron EJ168 USB 3 Controller.</p><p>i bind it to vfio-pci and pass it to the Windows 7 VM. There its recognised and i can install the (latest) driver by Etron. The driver seems to be intalled ok but there is no power on the ports.</p><p>I read someone (aw?) got a machine up and running with eJ168?</p><p>kernel 3.12 and still only qemu-kvm 1.60 (debian unstable).</p></div></blockquote></div><div class="codebox"><pre><code>$ lspci|grep Etron 03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 04:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>Hi, the person with those controllers seems to be me <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> although there might be more than one person with them</p><p>I managed to pass them to a Windows (7?) VM quite a while ago and they &quot;worked&quot; but etrons drivers and probably hardware were/are total garbage. The VM constantly threw BSODs at me, my mouse or kvm switch was lagging/randomly resetting when connected to one of the controllers and so on. This doesn&#039;t seem to be a problem with vfio though, since people without it are <a href="http://forums.tweaktown.com/asrock/47756-etron-usb3-0-bsod-issues-extreme-4-gen-3-a.html" rel="nofollow">having</a> <a href="http://forums.overclockers.com.au/showthread.php?t=994536" rel="nofollow">problems</a> too.</p><p>So yeah, this was probably not what you are looking for but my solution was to not use usb3 in the vm but usb2 controllers.</p></div></blockquote></div><p>ah, ok, thx for the Information.</p><p>My main Problem or concern is that just passing through the usb-hdd and emulating usb has really poor performance (7-9MB/s write). At least passing through one of the usb2 Controllers will give me better performance.<br />I was kinda hoping to be able to use&#160; the usb3 Controller for my usual video-editing (non-professional) stuff. As it is (with emulated usb) i have constant bufferings&#160; which freaks me out ^^</p><p>oh, btw, i use Synergy for sharing my Keyboard and Mouse. Works pretty solid even with gaming.</p></div></blockquote></div><p>Looks like qemu supports xhci emulation </p><div class="quotebox"><blockquote><div><p>xhci controller support<br />-----------------------</p><p>There is also xhci host controller support available.&#160; It got a lot<br />less testing than ehci and there are a bunch of known limitations, so<br />ehci may work better for you.&#160; On the other hand the xhci hardware<br />design is much more virtualization-friendly, thus xhci emulation uses<br />less resources (especially cpu).&#160; If you want to give xhci a try<br />use this to add the host controller ...</p><p>&#160; &#160; qemu -device nec-usb-xhci,id=xhci</p><p>... then use &quot;bus=xhci.0&quot; when assigning usb devices.</p></div></blockquote></div><p>You might want to take a look at that</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354911">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354943" class="blockpost roweven"> <h2><span><span class="conr">#831</span> <a href="viewtopic.php?pid=1354943#p1354943">2013-11-29 15:52:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76389">blitzschlag</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-30</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Looks like qemu supports xhci emulation </p><div class="quotebox"><blockquote><div><p>xhci controller support<br />-----------------------</p><p>There is also xhci host controller support available.&#160; It got a lot<br />less testing than ehci and there are a bunch of known limitations, so<br />ehci may work better for you.&#160; On the other hand the xhci hardware<br />design is much more virtualization-friendly, thus xhci emulation uses<br />less resources (especially cpu).&#160; If you want to give xhci a try<br />use this to add the host controller ...</p><p>&#160; &#160; qemu -device nec-usb-xhci,id=xhci</p><p>... then use &quot;bus=xhci.0&quot; when assigning usb devices.</p></div></blockquote></div><p>You might want to take a look at that</p></div></blockquote></div><p>hmm,</p><p>i tried </p><div class="codebox"><pre><code>-device nec-usb-xhci,id=xhci \ -drive file=/dev/sde1,id=usbhdd,format=raw \ -device usb-storage,bus=xhci.0,drive=usbhdd \</code></pre></div><p>to no avail. there is no new storage device present in my VM.</p><p>am i missing something?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354943">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354949" class="blockpost rowodd"> <h2><span><span class="conr">#832</span> <a href="viewtopic.php?pid=1354949#p1354949">2013-11-29 16:06:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><p>hmm,</p><p>i tried </p><div class="codebox"><pre><code>-device nec-usb-xhci,id=xhci \ -drive file=/dev/sde1,id=usbhdd,format=raw \ -device usb-storage,bus=xhci.0,drive=usbhdd \</code></pre></div><p>to no avail. there is no new storage device present in my VM.</p><p>am i missing something?</p></div></blockquote></div><p>Why dont you pass it as a virtio device?</p><br /><div class="codebox"><pre><code>-drive file=/dev/sde1,if=virtio,id=disk</code></pre></div><p>You can get the virtio drivers here: <a href="http://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/" rel="nofollow">http://alt.fedoraproject.org/pub/alt/vi … st/images/</a></p> <p class="postedit"><em>Last edited by nbhs (2013-11-29 16:07:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354949">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1354977" class="blockpost roweven"> <h2><span><span class="conr">#833</span> <a href="viewtopic.php?pid=1354977#p1354977">2013-11-29 18:09:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76389">blitzschlag</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-30</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thy for the Input</p><p>if i pass it with</p><div class="codebox"><pre><code>-device nec-usb-xhci,id=xhci \ -drive file=/dev/sde1,if=virtio,id=usbhdd \ -device usb-storage,bus=xhci.0,drive=usbhdd \</code></pre></div><p>i get the error:</p><div class="codebox"><pre><code>Property &#039;virtio-blk-pci.drive&#039; can&#039;t take value &#039;usbhdd&#039;, it&#039;s in use</code></pre></div><p>googeling around says that i defined the interface two times.</p><p>i&#039;m probably just thick but i can&#039;t see where the problem is.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1354977">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355070" class="blockpost rowodd"> <h2><span><span class="conr">#834</span> <a href="viewtopic.php?pid=1355070#p1355070">2013-11-30 00:44:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blitzschlag wrote:</cite><blockquote><div><p>thy for the Input</p><p>if i pass it with</p><div class="codebox"><pre><code>-device nec-usb-xhci,id=xhci \ -drive file=/dev/sde1,if=virtio,id=usbhdd \ -device usb-storage,bus=xhci.0,drive=usbhdd \</code></pre></div><p>i get the error:</p><div class="codebox"><pre><code>Property &#039;virtio-blk-pci.drive&#039; can&#039;t take value &#039;usbhdd&#039;, it&#039;s in use</code></pre></div><p>googeling around says that i defined the interface two times.</p><p>i&#039;m probably just thick but i can&#039;t see where the problem is.</p></div></blockquote></div><p>Forget about the xhci controller, what i ment was something like this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -drive file=/dev/sde1,if=virtio,id</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355070">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355106" class="blockpost roweven"> <h2><span><span class="conr">#835</span> <a href="viewtopic.php?pid=1355106#p1355106">2013-11-30 04:21:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys, great work here so far. I am excited to get my setup to work. I have run into a problem getting my second PCIe vga card (AMD 7870) passed through to the vm. Any attempt in passing it through results in the whole system hanging which mean I need to power down/up the system. There appear to be no logs produced when the attempt is made. The system just hangs. Any insights on what could be happening?</p><p>Here are my specs. </p><p>Supermicro X7DWA-N<br />16DDR2 ECC Ram<br />2x AMD 7870 running open source radeon drivers. <br />Fakeraid Sil3132 eSata card<br />Dual Xeon 5462 (VT-x enabled)</p><p>I&#039;m at a loss here and have been reading through the posts and other forums. I must be missing something here. Any help is appreciated. Thanks</p><p>I have an nvidia 660ti I might attempt to pass through instead just to see if its something there. But I suspect its not the issue.</p> <p class="postedit"><em>Last edited by paradexes (2013-11-30 06:47:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355106">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355281" class="blockpost rowodd"> <h2><span><span class="conr">#836</span> <a href="viewtopic.php?pid=1355281#p1355281">2013-11-30 18:21:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77317">sharkwouter</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77317">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>This guide is awesome, my Windows installation works great. I do have one problem though, both graphics cards in my system have the same hardware id which makes me unable to run Xorg on my arch installation directly. I could run a second vm, but that seems a bit inefficient to me. Did anyone encounter this issue with 2 identical graphics cards and fix it? I don&#039;t know if it helps, but I&#039;m using an AMD FX 8320 processor, and ASUS Sabertooth 990FX mobo and 2 AMD Radeon HD7850 graphics cards.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355519" class="blockpost roweven"> <h2><span><span class="conr">#837</span> <a href="viewtopic.php?pid=1355519#p1355519">2013-12-01 08:32:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72338">empie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: The Netherlands</span></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Hey guys, great work here so far. I am excited to get my setup to work. I have run into a problem getting my second PCIe vga card (AMD 7870) passed through to the vm. Any attempt in passing it through results in the whole system hanging which mean I need to power down/up the system. There appear to be no logs produced when the attempt is made. The system just hangs. Any insights on what could be happening?</p><p>Here are my specs. </p><p>Supermicro X7DWA-N<br />16DDR2 ECC Ram<br />2x AMD 7870 running open source radeon drivers. <br />Fakeraid Sil3132 eSata card<br />Dual Xeon 5462 (VT-x enabled)</p><p>I&#039;m at a loss here and have been reading through the posts and other forums. I must be missing something here. Any help is appreciated. Thanks</p><p>I have an nvidia 660ti I might attempt to pass through instead just to see if its something there. But I suspect its not the issue.</p></div></blockquote></div><p>Your CPU&#039;s have no VT-d support.</p> <p class="postedit"><em>Last edited by empie (2013-12-01 08:33:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355519">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355543" class="blockpost rowodd"> <h2><span><span class="conr">#838</span> <a href="viewtopic.php?pid=1355543#p1355543">2013-12-01 10:59:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sharkwouter wrote:</cite><blockquote><div><p>This guide is awesome, my Windows installation works great. I do have one problem though, both graphics cards in my system have the same hardware id which makes me unable to run Xorg on my arch installation directly. I could run a second vm, but that seems a bit inefficient to me. Did anyone encounter this issue with 2 identical graphics cards and fix it? I don&#039;t know if it helps, but I&#039;m using an AMD FX 8320 processor, and ASUS Sabertooth 990FX mobo and 2 AMD Radeon HD7850 graphics cards.</p></div></blockquote></div><p>On recent kernels im able to unload my secondary card from the radeon module&#160; (before starting X) and then binding it to vfio without crashing the host (i do get some ugly kernel warns though) and without having to use pci-stub, you could try it.</p> <p class="postedit"><em>Last edited by nbhs (2013-12-01 11:00:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355543">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355570" class="blockpost roweven"> <h2><span><span class="conr">#839</span> <a href="viewtopic.php?pid=1355570#p1355570">2013-12-01 13:06:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77317">sharkwouter</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77317">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>sharkwouter wrote:</cite><blockquote><div><p>This guide is awesome, my Windows installation works great. I do have one problem though, both graphics cards in my system have the same hardware id which makes me unable to run Xorg on my arch installation directly. I could run a second vm, but that seems a bit inefficient to me. Did anyone encounter this issue with 2 identical graphics cards and fix it? I don&#039;t know if it helps, but I&#039;m using an AMD FX 8320 processor, and ASUS Sabertooth 990FX mobo and 2 AMD Radeon HD7850 graphics cards.</p></div></blockquote></div><p>On recent kernels im able to unload my secondary card from the radeon module&#160; (before starting X) and then binding it to vfio without crashing the host (i do get some ugly kernel warns though) and without having to use pci-stub, you could try it.</p></div></blockquote></div><p>I&#039;ll give it a try. Did anyone manage to pass-through his primary graphics adapter? I&#039;d like to try running 2 vms, but I don&#039;t know if that could work.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355570">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355600" class="blockpost rowodd"> <h2><span><span class="conr">#840</span> <a href="viewtopic.php?pid=1355600#p1355600">2013-12-01 15:04:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>empie wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Hey guys, great work here so far. I am excited to get my setup to work. I have run into a problem getting my second PCIe vga card (AMD 7870) passed through to the vm. Any attempt in passing it through results in the whole system hanging which mean I need to power down/up the system. There appear to be no logs produced when the attempt is made. The system just hangs. Any insights on what could be happening?</p><p>Here are my specs. </p><p>Supermicro X7DWA-N<br />16DDR2 ECC Ram<br />2x AMD 7870 running open source radeon drivers. <br />Fakeraid Sil3132 eSata card<br />Dual Xeon 5462 (VT-x enabled)</p><p>I&#039;m at a loss here and have been reading through the posts and other forums. I must be missing something here. Any help is appreciated. Thanks</p><p>I have an nvidia 660ti I might attempt to pass through instead just to see if its something there. But I suspect its not the issue.</p></div></blockquote></div><p>Your CPU&#039;s have no VT-d support.</p></div></blockquote></div><p>VT-d is only listed for the CPU when the CPU hosts root ports.&#160; This is an older system with a Northbridge-Southbridge architecture.&#160; The datasheet for the 5400 series chipset listed for this motherboard does say it supports VT-d.&#160; Unfortunately I don&#039;t have any idea why this is hanging, but I&#039;d definitely try the Nvidia card.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355600">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355819" class="blockpost roweven"> <h2><span><span class="conr">#841</span> <a href="viewtopic.php?pid=1355819#p1355819">2013-12-02 03:31:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>empie wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Hey guys, great work here so far. I am excited to get my setup to work. I have run into a problem getting my second PCIe vga card (AMD 7870) passed through to the vm. Any attempt in passing it through results in the whole system hanging which mean I need to power down/up the system. There appear to be no logs produced when the attempt is made. The system just hangs. Any insights on what could be happening?</p><p>Here are my specs. </p><p>Supermicro X7DWA-N<br />16DDR2 ECC Ram<br />2x AMD 7870 running open source radeon drivers. <br />Fakeraid Sil3132 eSata card<br />Dual Xeon 5462 (VT-x enabled)</p><p>I&#039;m at a loss here and have been reading through the posts and other forums. I must be missing something here. Any help is appreciated. Thanks</p><p>I have an nvidia 660ti I might attempt to pass through instead just to see if its something there. But I suspect its not the issue.</p></div></blockquote></div><p>Your CPU&#039;s have no VT-d support.</p></div></blockquote></div><p>Sorry man intel clearly states the CPU has the support. VT-x And I do have it otherwise I would not even be able to properly set up a 64bit VM. Thats one aspect of this tech that is required. It works, I just am having issues passing the card through to the VM. IOMMU is clearly there. Clearly I am missing something. <br /><a href="http://ark.intel.com/products/virtualizationtechnology" rel="nofollow">http://ark.intel.com/products/virtualizationtechnology</a> Its in the list. E5462</p><p>I am giving the nvidia card a try on the host system on the guest as well. Hopefully that yields results. Thanks.</p> <p class="postedit"><em>Last edited by paradexes (2013-12-02 03:32:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355819">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355824" class="blockpost rowodd"> <h2><span><span class="conr">#842</span> <a href="viewtopic.php?pid=1355824#p1355824">2013-12-02 03:47:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><div class="quotebox"><cite>empie wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Hey guys, great work here so far. I am excited to get my setup to work. I have run into a problem getting my second PCIe vga card (AMD 7870) passed through to the vm. Any attempt in passing it through results in the whole system hanging which mean I need to power down/up the system. There appear to be no logs produced when the attempt is made. The system just hangs. Any insights on what could be happening?</p><p>Here are my specs. </p><p>Supermicro X7DWA-N<br />16DDR2 ECC Ram<br />2x AMD 7870 running open source radeon drivers. <br />Fakeraid Sil3132 eSata card<br />Dual Xeon 5462 (VT-x enabled)</p><p>I&#039;m at a loss here and have been reading through the posts and other forums. I must be missing something here. Any help is appreciated. Thanks</p><p>I have an nvidia 660ti I might attempt to pass through instead just to see if its something there. But I suspect its not the issue.</p></div></blockquote></div><p>Your CPU&#039;s have no VT-d support.</p></div></blockquote></div><p>Sorry man intel clearly states the CPU has the support. VT-x And I do have it otherwise I would not even be able to properly set up a 64bit VM. Thats one aspect of this tech that is required. It works, I just am having issues passing the card through to the VM. IOMMU is clearly there. Clearly I am missing something. <br /><a href="http://ark.intel.com/products/virtualizationtechnology" rel="nofollow">http://ark.intel.com/products/virtualizationtechnology</a> Its in the list. E5462</p><p>I am giving the nvidia card a try on the host system on the guest as well. Hopefully that yields results. Thanks.</p></div></blockquote></div><p>VT-d != VT-x</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355824">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355844" class="blockpost roweven"> <h2><span><span class="conr">#843</span> <a href="viewtopic.php?pid=1355844#p1355844">2013-12-02 05:29:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><div class="quotebox"><cite>empie wrote:</cite><blockquote><div><p>Your CPU&#039;s have no VT-d support.</p></div></blockquote></div><p>Sorry man intel clearly states the CPU has the support. VT-x And I do have it otherwise I would not even be able to properly set up a 64bit VM. Thats one aspect of this tech that is required. It works, I just am having issues passing the card through to the VM. IOMMU is clearly there. Clearly I am missing something. <br /><a href="http://ark.intel.com/products/virtualizationtechnology" rel="nofollow">http://ark.intel.com/products/virtualizationtechnology</a> Its in the list. E5462</p><p>I am giving the nvidia card a try on the host system on the guest as well. Hopefully that yields results. Thanks.</p></div></blockquote></div><p>VT-d != VT-x</p></div></blockquote></div><p> Agreed and thanks. Just glad its not just me saying it. That said I am still kind of at odds with the host freezing. If anyone has any ideas that would be great. I have added the nvidia card and am going to give it a go with that. Altho I think it may likley happen with that one as well.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355844">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355936" class="blockpost rowodd"> <h2><span><span class="conr">#844</span> <a href="viewtopic.php?pid=1355936#p1355936">2013-12-02 14:23:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39060">alphaniner</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/39060.png?m=1312435868" width="80" height="80" alt="" /></dd> <dd><span>From: Ancapistan</span></dd> <dd><span>Registered: 2010-07-12</span></dd> <dd><span>Posts: 2,291</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=39060">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@paradexes</p><p>I think you misunderstood aw. VT-x is not the same thing as VT-d. And according to the <a href="http://ark.intel.com/products/33084/Intel-Xeon-Processor-E5462-12M-Cache-2_80-GHz-1600-MHz-FSB" rel="nofollow">ark</a> your CPUs do not support VT-d. I don&#039;t think VT-d even existed when your CPU hit the market (2007).</p><p>The good news is that your mobo does support VT-d, so your setup isn&#039;t a total loss. <a href="http://ark.intel.com/search/advanced/?s=t&amp;FamilyText=Intel%C2%AE%20Xeon%C2%AE%20Processor%205000%20Sequence&amp;VTD=true" rel="nofollow">Here&#039;s a list</a> of &#039;5000 Sequence&#039; Xeons that support VT-d.</p> <p class="postedit"><em>Last edited by alphaniner (2013-12-02 14:35:32)</em></p> </div> <div class="postsignature postmsg"><hr /><p>But whether the Constitution really be one thing, or another, this much is certain - that it has either authorized such a government as we have had, or has been powerless to prevent it. In either case, it is unfit to exist.<br />-Lysander Spooner</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355936">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355963" class="blockpost roweven"> <h2><span><span class="conr">#845</span> <a href="viewtopic.php?pid=1355963#p1355963">2013-12-02 16:20:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for clearing it up. Yes you are correct. I did some checking myself. I guess my whole concern is whether I will be able to pass the GPU at this point or not. I am not terribly concerned about any other hardware besides maybe USB hardware.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355963">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355986" class="blockpost rowodd"> <h2><span><span class="conr">#846</span> <a href="viewtopic.php?pid=1355986#p1355986">2013-12-02 17:24:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>IIRC the PAGE_FAULT_IN_NONPAGED_AREA is the manifestation of the -cpu host problem on Nvidia.&#160; Try -cpu qemu64 or one of the CPU specific types.&#160; Note that you can dump the VBIOS, modify it, then load it with romfile= to avoid flashing it back to hardware.</p></div></blockquote></div><p>You were right about CPU type - I used SandyBridge and was able to install. </p><p>After installing WIn7, I installed GRID K2 drivers, but now windows report Code 12 on NVIDIA GRID K2 device: This device cannot find enough free resources that it can use. If you want to use this device, you will need to disable one of the other devices on this system.</p><p>I have tried adding -vga none to the qemu command line and booting like this after I installed the drivers, but i dont get any signal on either video outputs of the card still.</p><p>Any ideas anyone?</p><p>Thanks,<br />Ilya.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355986">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1355988" class="blockpost roweven"> <h2><span><span class="conr">#847</span> <a href="viewtopic.php?pid=1355988#p1355988">2013-12-02 17:32:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>IIRC the PAGE_FAULT_IN_NONPAGED_AREA is the manifestation of the -cpu host problem on Nvidia.&#160; Try -cpu qemu64 or one of the CPU specific types.&#160; Note that you can dump the VBIOS, modify it, then load it with romfile= to avoid flashing it back to hardware.</p></div></blockquote></div><p>You were right about CPU type - I used SandyBridge and was able to install. </p><p>After installing WIn7, I installed GRID K2 drivers, but now windows report Code 12 on NVIDIA GRID K2 device: This device cannot find enough free resources that it can use. If you want to use this device, you will need to disable one of the other devices on this system.</p><p>I have tried adding -vga none to the qemu command line and booting like this after I installed the drivers, but i dont get any signal on either video outputs of the card still.</p><p>Any ideas anyone?</p></div></blockquote></div><p>Real GRID cards report the same Code 12 on the q35 chipset model, try 440fx instead.&#160; I can&#039;t figure out what resources it&#039;s missing, nor have I had time to experiment.&#160; Linux guests will work fine on the q35 model.&#160; Again, you&#039;re not going to get pre-boot VGA output unless the VBIOS matches the hardware.&#160; Also, Nvidia does not support GRID in a VGA mode, it&#039;s only supported as a secondary device to emulated VGA.&#160; The professional version of the drivers detect that they&#039;re running on a VM and behave differently.&#160; The quirks enabled with x-vga=on do not work correctly with those drivers.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1355988">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356115" class="blockpost rowodd"> <h2><span><span class="conr">#848</span> <a href="viewtopic.php?pid=1356115#p1356115">2013-12-03 00:46:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well it appears installing the nvidia card and blacklisting it from the host sems to resolve the hanging issue. However now I am getting this error. Since the motherboard supports IOMMU would it not support vfio? at least in theory. Any thoughts?</p><p>Error starting domain: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p><p>Traceback (most recent call last):<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 96, in cb_wrapper<br />&#160; &#160; callback(asyncjob, *args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 117, in tmpcb<br />&#160; &#160; callback(*args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1162, in startup<br />&#160; &#160; self._backend.create()<br />&#160; File &quot;/usr/lib/python2.7/dist-packages/libvirt.py&quot;, line 698, in create<br />&#160; &#160; if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self)<br />libvirtError: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356115">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356127" class="blockpost roweven"> <h2><span><span class="conr">#849</span> <a href="viewtopic.php?pid=1356127#p1356127">2013-12-03 01:15:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Well it appears installing the nvidia card and blacklisting it from the host sems to resolve the hanging issue. However now I am getting this error. Since the motherboard supports IOMMU would it not support vfio? at least in theory. Any thoughts?</p><p>Error starting domain: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p><p>Traceback (most recent call last):<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 96, in cb_wrapper<br />&#160; &#160; callback(asyncjob, *args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 117, in tmpcb<br />&#160; &#160; callback(*args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1162, in startup<br />&#160; &#160; self._backend.create()<br />&#160; File &quot;/usr/lib/python2.7/dist-packages/libvirt.py&quot;, line 698, in create<br />&#160; &#160; if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self)<br />libvirtError: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p></div></blockquote></div><p>Suspect you&#039;re not using vfio because libvirt only tries to reset devices with legacy KVM device assignment.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356127">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356149" class="blockpost rowodd"> <h2><span><span class="conr">#850</span> <a href="viewtopic.php?pid=1356149#p1356149">2013-12-03 04:12:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Well it appears installing the nvidia card and blacklisting it from the host sems to resolve the hanging issue. However now I am getting this error. Since the motherboard supports IOMMU would it not support vfio? at least in theory. Any thoughts?</p><p>Error starting domain: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p><p>Traceback (most recent call last):<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 96, in cb_wrapper<br />&#160; &#160; callback(asyncjob, *args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 117, in tmpcb<br />&#160; &#160; callback(*args, **kwargs)<br />&#160; File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1162, in startup<br />&#160; &#160; self._backend.create()<br />&#160; File &quot;/usr/lib/python2.7/dist-packages/libvirt.py&quot;, line 698, in create<br />&#160; &#160; if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self)<br />libvirtError: internal error: Unable to reset PCI device 0000:02:00.0: internal error: Active 0000:02:00.1 devices on bus with 0000:02:00.0, not doing bus reset</p></div></blockquote></div><p>Suspect you&#039;re not using vfio because libvirt only tries to reset devices with legacy KVM device assignment.</p></div></blockquote></div><p>Ok. I will keep at it and post my results. Thanks. Being that the motherboard supports IOMMU I assume its possible to make this work?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356149">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=33">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=32">32</a> <a href="viewtopic.php?id=162768&amp;p=33">33</a> <strong>34</strong> <a href="viewtopic.php?id=162768&amp;p=35">35</a> <a href="viewtopic.php?id=162768&amp;p=36">36</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=35">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
