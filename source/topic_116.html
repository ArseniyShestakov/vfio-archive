<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 116) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=116" title="Page 116" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=115" title="Page 115" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=117" title="Page 117" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=115">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=114">114</a> <a href="viewtopic.php?id=162768&amp;p=115">115</a> <strong>116</strong> <a href="viewtopic.php?id=162768&amp;p=117">117</a> <a href="viewtopic.php?id=162768&amp;p=118">118</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=117">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1462351" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2876</span> <a href="viewtopic.php?pid=1462351#p1462351">2014-10-02 17:42:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85560">GrigoryPtashko</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello.</p><p>Here&#039;s my setup:</p><br /><p>1. Supermicro X9DRFF-iG+/-7G+/-iTG+/-7TG+/X9DRFF-iG+/-7G+/-iTG+/-7TG+, BIOS 3.0 07/29/2013<br />2. Custom built kernel 3.16.3 (taken from kernel.org) + applied patches from OP<br />3. Cmdline intel_iommu=on,igfx_off pci_stub.ids=10de:1005,10de:0e1a4,1002:0b0c,1002:aac8 vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 nohz=off<br />4. Latest Qemu from git built by myself.<br />5. Latest Seabios from git built by myself.</p><br /><p>With this I&#039;ve managed to passthrough an NVIDIA GTX TITAN. Everything works fine.<br />Now I&#039;m trying to passthrough the AMD FirePro W8100 (and W9100). I set up a VM with emulated VGA and with passedthrough W8100. I set up the driver. The driver sees the W8100. But it is with yellow sign since it is not primary.</p><p>And now the problem:</p><p>I turn on the VM with the W8100 as the primary adapter and I get a <strong>kernel panic on the host (!)</strong>.</p><p>Here&#039;s VM:</p><div class="codebox"><pre><code>/usr/local/bin/qemu-system-x86_64 -enable-kvm -M q35 -m 16000 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin \ -nodefaults \ -nographic \ -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=83:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=83:00.1,bus=root.1,addr=00.1 \ -net bridge,br=br0 -net nic,model=virtio,macaddr=52:54:00:12:34:60 \ -drive file=/vmstorage/win7test2kvm-firepro-node3.img,id=disk,format=raw,if=virtio \ -mon chardev=monitor0 \ -chardev socket,id=monitor0,path=/home/admin/tmp/win7test2kvm-firepro-node3.monitor,nowait,server \</code></pre></div><br /><p>Here&#039;s the kernel panic:</p><br /><div class="codebox"><pre class="vscroll"><code>... [ 2013.702012] vfio_ecap_init: 0000:83:00.0 hiding ecap 0x19@0x270 [ 2013.707946] vfio_ecap_init: 0000:83:00.0 hiding ecap 0x1b@0x2d0 [ 2020.563698] kvm: zapping shadow pages for mmio generation wraparound [ 2028.031369] vfio-pci 0000:83:00.0: irq 146 for MSI/MSI-X [ 2050.912282] dmar: DRHD: handling fault status reg 40 .... lots of the same dmar: DRHD: handling fault status reg 40 here [ 2064.032487] dmar: DRHD: handling fault status reg 40 [ 2064.033072] Kernel panic - not syncing: Watchdog detected hard LOCKUP on cpu 31 [ 2064.033074] CPU: 31 PID: 4197 Comm: qemu-system-x86 Tainted: G W 3.16.3 #1 [ 2064.033075] Hardware name: Supermicro X9DRFF-iG+/-7G+/-iTG+/-7TG+/X9DRFF-iG+/-7G+/-iTG+/-7TG+, BIOS 3.0 07/29/2013 [ 2064.033077] 0000000000000000 000000006cf33090 ffff88307fde6c10 ffffffff817eb37c [ 2064.033079] ffffffff81ab62c0 ffff88307fde6c90 ffffffff817e3c66 0000000000000010 [ 2064.033080] ffff88307fde6ca0 ffff88307fde6c40 000000006cf33090 0000000000000000 [ 2064.033080] Call Trace: [ 2064.033087] &lt;NMI&gt; [&lt;ffffffff817eb37c&gt;] dump_stack+0x45/0x56 [ 2064.033089] [&lt;ffffffff817e3c66&gt;] panic+0xd8/0x20c [ 2064.033093] [&lt;ffffffff81121250&gt;] ? restart_watchdog_hrtimer+0x50/0x50 [ 2064.033095] [&lt;ffffffff81121312&gt;] watchdog_overflow_callback+0xc2/0xd0 [ 2064.033097] [&lt;ffffffff8115dd8d&gt;] __perf_event_overflow+0x9d/0x250 [ 2064.033098] [&lt;ffffffff8115e884&gt;] perf_event_overflow+0x14/0x20 [ 2064.033102] [&lt;ffffffff81032bcd&gt;] intel_pmu_handle_irq+0x1fd/0x410 [ 2064.033105] [&lt;ffffffff811a3381&gt;] ? unmap_kernel_range_noflush+0x11/0x20 [ 2064.033110] [&lt;ffffffff81436974&gt;] ? ghes_copy_tofrom_phys+0x124/0x210 [ 2064.033113] [&lt;ffffffff81029f5b&gt;] perf_event_nmi_handler+0x2b/0x50 [ 2064.033115] [&lt;ffffffff81017e90&gt;] nmi_handle+0x90/0x130 [ 2064.033116] [&lt;ffffffff810184ae&gt;] default_do_nmi+0xde/0x140 [ 2064.033117] [&lt;ffffffff81018598&gt;] do_nmi+0x88/0xc0 [ 2064.033120] [&lt;ffffffff817f7671&gt;] end_repeat_nmi+0x1e/0x2e [ 2064.033124] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033125] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033127] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033129] &lt;&lt;EOE&gt;&gt; [&lt;ffffffff81670536&gt;] qi_flush_dev_iotlb+0x86/0xd0 [ 2064.033130] [&lt;ffffffff81672534&gt;] iommu_flush_dev_iotlb+0xa4/0xd0 [ 2064.033132] [&lt;ffffffff81672612&gt;] iommu_flush_iotlb_psi+0xb2/0xe0 [ 2064.033133] [&lt;ffffffff81674fce&gt;] intel_iommu_unmap+0x1ce/0x1e0 [ 2064.033135] [&lt;ffffffff81668340&gt;] iommu_unmap+0xb0/0x190 [ 2064.033140] [&lt;ffffffff81599553&gt;] vfio_remove_dma+0xc3/0x1a0 [ 2064.033142] [&lt;ffffffff817f36e2&gt;] ? mutex_lock+0x12/0x2f [ 2064.033144] [&lt;ffffffff81599c71&gt;] vfio_iommu_type1_ioctl+0x3e1/0xa20 [ 2064.033163] [&lt;ffffffffa0005486&gt;] ? kvm_set_memory_region+0x36/0x40 [kvm] [ 2064.033169] [&lt;ffffffffa0005902&gt;] ? kvm_vm_ioctl+0x472/0x730 [kvm] [ 2064.033171] [&lt;ffffffff81597769&gt;] vfio_fops_unl_ioctl+0x79/0x2b0 [ 2064.033174] [&lt;ffffffff811ef660&gt;] do_vfs_ioctl+0x2e0/0x4a0 [ 2064.033175] [&lt;ffffffff811ef8a1&gt;] SyS_ioctl+0x81/0xa0 [ 2064.033177] [&lt;ffffffff8110ec66&gt;] ? __audit_syscall_exit+0x1f6/0x2a0 [ 2064.033179] [&lt;ffffffff817f5369&gt;] system_call_fastpath+0x16/0x1b [ 2065.078698] Shutting down cpus with NMI [ 2065.082550] Kernel Offset: 0x0 from 0xffffffff81000000 (relocation range: 0xffffffff80000000-0xffffffff9fffffff) [ 2065.092720] drm_kms_helper: panic occurred, switching back to text console [ 2065.402288] ------------[ cut here ]------------ [ 2065.406910] kernel BUG at mm/vmalloc.c:1320! [ 2065.411178] invalid opcode: 0000 [#1] SMP [ 2065.415312] Modules linked in: tun ip6table_filter ip6_tables iptable_filter ip_tables ebtable_nat ebtables sg rpcsec_gss_krb5 nls_utf8 mlx4_ib ib_sa ib_mad ib_core ib_addr x86_pkg_temp_thermal coretemp crct10dif_pclmul crct10dif_common crc32_pclmul crc32c_intel iTCO_wdt iTCO_vendor_support ghash_clmulni_intel mgag200 syscopyarea sysfillrect sysimgblt aesni_intel ttm lrw ahci gf128mul drm_kms_helper mlx4_core glue_helper libahci mei_me drm ablk_helper sb_edac lpc_ich ioatdma cryptd ipmi_si libata edac_core pcspkr mei shpchp mfd_core i2c_i801 wmi dca ipmi_msghandler binfmt_misc kvm_intel nfsd kvm [ 2065.469011] CPU: 31 PID: 4197 Comm: qemu-system-x86 Tainted: G W 3.16.3 #1 [ 2065.476839] Hardware name: Supermicro X9DRFF-iG+/-7G+/-iTG+/-7TG+/X9DRFF-iG+/-7G+/-iTG+/-7TG+, BIOS 3.0 07/29/2013 [ 2065.487183] task: ffff882ff4e8d220 ti: ffff882fee33c000 task.ti: ffff882fee33c000 [ 2065.494665] RIP: 0010:[&lt;ffffffff811a2980&gt;] [&lt;ffffffff811a2980&gt;] __get_vm_area_node+0x150/0x160 [ 2065.503388] RSP: 0018:ffff88307fde65f8 EFLAGS: 00010006 [ 2065.508701] RAX: 0000000080110000 RBX: 00000000ffffffff RCX: ffffc90000000000 [ 2065.515830] RDX: 0000000000000022 RSI: 0000000000000001 RDI: 0000000000002000 [ 2065.522964] RBP: ffff88307fde6658 R08: ffffe8ffffffffff R09: 00000000ffffffff [ 2065.530102] R10: ffffffffa08bfe84 R11: ffff882ff2eb2218 R12: 0000000000001800 [ 2065.537236] R13: 0000000000300000 R14: 00000000000080d2 R15: ffffea0001dbd780 [ 2065.544372] FS: 00007f23dd4b69c0(0000) GS:ffff88307fde0000(0000) knlGS:0000000000000000 [ 2065.552461] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [ 2065.558210] CR2: 00007f23de4693f8 CR3: 0000002ffa139000 CR4: 00000000000427e0 [ 2065.565338] Stack: [ 2065.567348] ffffffff811a4040 ffffffff000080d2 ffffffffa05022b9 8000000000000163 [ 2065.574806] 000080d200000001 ffff88307fde675d 000000006cf33090 ffff882ff4d73de0 [ 2065.582262] ffff882ff2eb21f8 0000000000300000 0000000000000080 ffffea0001dbd780 [ 2065.589719] Call Trace: [ 2065.592163] &lt;NMI&gt; [ 2065.594089] [&lt;ffffffff811a4040&gt;] ? __vmalloc_node_range+0x80/0x280 [ 2065.600586] [&lt;ffffffffa05022b9&gt;] ? ttm_tt_init+0x69/0xb0 [ttm] [ 2065.606506] [&lt;ffffffff811a4281&gt;] __vmalloc+0x41/0x50 [ 2065.611555] [&lt;ffffffffa05022b9&gt;] ? ttm_tt_init+0x69/0xb0 [ttm] [ 2065.617474] [&lt;ffffffffa05022b9&gt;] ttm_tt_init+0x69/0xb0 [ttm] [ 2065.623233] [&lt;ffffffffa08bfea8&gt;] mgag200_ttm_tt_create+0x58/0x90 [mgag200] [ 2065.630204] [&lt;ffffffffa0502a5d&gt;] ttm_bo_add_ttm+0x8d/0xc0 [ttm] [ 2065.636213] [&lt;ffffffffa05040e1&gt;] ttm_bo_handle_move_mem+0x571/0x5b0 [ttm] [ 2065.643096] [&lt;ffffffffa0504756&gt;] ? ttm_bo_mem_space+0x116/0x340 [ttm] [ 2065.649633] [&lt;ffffffffa0504e47&gt;] ttm_bo_validate+0x247/0x260 [ttm] [ 2065.655919] [&lt;ffffffff8105e959&gt;] ? iounmap+0x79/0xa0 [ 2065.660982] [&lt;ffffffff81050059&gt;] ? native_safe_x2apic_wait_icr_idle+0x9/0x10 [ 2065.668119] [&lt;ffffffffa08c0522&gt;] mgag200_bo_push_sysram+0x82/0xe0 [mgag200] [ 2065.675160] [&lt;ffffffffa08bba95&gt;] mga_crtc_do_set_base.isra.8.constprop.20+0x85/0x470 [mgag200] [ 2065.683857] [&lt;ffffffffa08bcebb&gt;] mga_crtc_mode_set+0x103b/0x2160 [mgag200] [ 2065.690836] [&lt;ffffffff8139b088&gt;] ? __const_udelay+0x28/0x30 [ 2065.696508] [&lt;ffffffffa01d6939&gt;] drm_crtc_helper_set_mode+0x2e9/0x520 [drm_kms_helper] [ 2065.704519] [&lt;ffffffffa01d76bf&gt;] drm_crtc_helper_set_config+0x87f/0xaa0 [drm_kms_helper] [ 2065.712709] [&lt;ffffffffa03ff6d1&gt;] drm_mode_set_config_internal+0x61/0xe0 [drm] [ 2065.719935] [&lt;ffffffffa01d9ca3&gt;] restore_fbdev_mode+0xb3/0xe0 [drm_kms_helper] [ 2065.727243] [&lt;ffffffffa01d9ea5&gt;] drm_fb_helper_force_kernel_mode+0x75/0xb0 [drm_kms_helper] [ 2065.735680] [&lt;ffffffffa01dabb9&gt;] drm_fb_helper_panic+0x29/0x30 [drm_kms_helper] [ 2065.743084] [&lt;ffffffff8109b7ac&gt;] notifier_call_chain+0x4c/0x70 [ 2065.749005] [&lt;ffffffff8109b80a&gt;] atomic_notifier_call_chain+0x1a/0x20 [ 2065.755534] [&lt;ffffffff817e3c93&gt;] panic+0x105/0x20c [ 2065.760416] [&lt;ffffffff81121250&gt;] ? restart_watchdog_hrtimer+0x50/0x50 [ 2065.766936] [&lt;ffffffff81121312&gt;] watchdog_overflow_callback+0xc2/0xd0 [ 2065.773456] [&lt;ffffffff8115dd8d&gt;] __perf_event_overflow+0x9d/0x250 [ 2065.779630] [&lt;ffffffff8115e884&gt;] perf_event_overflow+0x14/0x20 [ 2065.785552] [&lt;ffffffff81032bcd&gt;] intel_pmu_handle_irq+0x1fd/0x410 [ 2065.791733] [&lt;ffffffff811a3381&gt;] ? unmap_kernel_range_noflush+0x11/0x20 [ 2065.798428] [&lt;ffffffff81436974&gt;] ? ghes_copy_tofrom_phys+0x124/0x210 [ 2065.804869] [&lt;ffffffff81029f5b&gt;] perf_event_nmi_handler+0x2b/0x50 [ 2065.811051] [&lt;ffffffff81017e90&gt;] nmi_handle+0x90/0x130 [ 2065.816270] [&lt;ffffffff810184ae&gt;] default_do_nmi+0xde/0x140 [ 2065.821836] [&lt;ffffffff81018598&gt;] do_nmi+0x88/0xc0 [ 2065.826623] [&lt;ffffffff817f7671&gt;] end_repeat_nmi+0x1e/0x2e [ 2065.832102] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2065.837930] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2065.843765] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2065.849589] &lt;&lt;EOE&gt;&gt; [ 2065.851687] [&lt;ffffffff81670536&gt;] qi_flush_dev_iotlb+0x86/0xd0 [ 2065.857733] [&lt;ffffffff81672534&gt;] iommu_flush_dev_iotlb+0xa4/0xd0 [ 2065.863827] [&lt;ffffffff81672612&gt;] iommu_flush_iotlb_psi+0xb2/0xe0 [ 2065.869915] [&lt;ffffffff81674fce&gt;] intel_iommu_unmap+0x1ce/0x1e0 [ 2065.875835] [&lt;ffffffff81668340&gt;] iommu_unmap+0xb0/0x190 [ 2065.881142] [&lt;ffffffff81599553&gt;] vfio_remove_dma+0xc3/0x1a0 [ 2065.886796] [&lt;ffffffff817f36e2&gt;] ? mutex_lock+0x12/0x2f [ 2065.892103] [&lt;ffffffff81599c71&gt;] vfio_iommu_type1_ioctl+0x3e1/0xa20 [ 2065.898463] [&lt;ffffffffa0005486&gt;] ? kvm_set_memory_region+0x36/0x40 [kvm] [ 2065.905252] [&lt;ffffffffa0005902&gt;] ? kvm_vm_ioctl+0x472/0x730 [kvm] [ 2065.911429] [&lt;ffffffff81597769&gt;] vfio_fops_unl_ioctl+0x79/0x2b0 [ 2065.917428] [&lt;ffffffff811ef660&gt;] do_vfs_ioctl+0x2e0/0x4a0 [ 2065.922907] [&lt;ffffffff811ef8a1&gt;] SyS_ioctl+0x81/0xa0 [ 2065.927955] [&lt;ffffffff8110ec66&gt;] ? __audit_syscall_exit+0x1f6/0x2a0 [ 2065.934300] [&lt;ffffffff817f5369&gt;] system_call_fastpath+0x16/0x1b [ 2065.940299] Code: 00 00 00 0f bd cf 83 c1 01 83 f9 0c 0f 4c c8 b0 13 83 f9 13 0f 4f c8 49 d3 e4 e9 fd fe ff ff 4c 89 ff e8 f4 b3 01 00 31 c0 eb b3 &lt;0f&gt; 0b 66 66 66 66 66 2e 0f 1f 84 00 00 00 00 00 66 66 66 66 90 [ 2065.960268] RIP [&lt;ffffffff811a2980&gt;] __get_vm_area_node+0x150/0x160 [ 2065.966631] RSP &lt;ffff88307fde65f8&gt;</code></pre></div><p>I&#039;ve also tried the romfile option with the BIOS dumped with ATIFlash (FreeDOS bootable USB stick with ATIFlash). But it did not change anything.</p><p>I googled but I did not find anyone&#039;s experience with W8100 and W9100 GPUs. So I&#039;m confused on where to move.. I&#039;ve read pretty much info but I&#039;m really stuck. Any help is really appriciated.</p><p>PS I have to say that I actually don&#039;t know which set of options from my cmdline actually made the GTX TITAN passthrough possible. I&#039;ve been reading this post and Alex Williamson&#039;s vfio blog and adding stuff and experimenting. After another try I&#039;ve got a working VM and stopped <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Thank you,<br />Grigory.</p> <p class="postedit"><em>Last edited by GrigoryPtashko (2014-10-02 17:46:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462351">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462539" class="blockpost roweven"> <h2><span><span class="conr">#2877</span> <a href="viewtopic.php?pid=1462539#p1462539">2014-10-03 11:04:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I am running a similar setup than OP (kvm vga passthrough vfio) based on Ubuntu 14.04 with kernel 3.13 and KVM 2.0. I have a weird similar to the one OP mentioned. My sound sometimes &quot;lags&quot;. It is completely chopped and make the games lag. It only occurs on games. Video playback and music are fine. It happens both with audio through HDMI and with a dedicated USB sound card passed through (along with keyboard / mouse).</p><p>I noticed OP fixed this (in his 2Nd post), however the fix only applies on AMD board (I tried it, just to be sure), and I have an Intel one.</p><p>Anyone has this same issue or knows how to fix it?</p><p>Thanks in advance</p><p>PS: talking about sound, I have another issue. I am pretty sure &quot;this is not a bug, this a feature&quot;, however I&#039;ll ask. When playing a Windows game, if I change input via an HDMI switch (eg: I switch back to linux), then when I go back to the game there is no longer sound. Sounds still works in Windows if I ALT + TAB, but nothing in game. I have to quit and relaunch. Happens also with an USB sound card when I switch back to Linux. If someone has as fix, I&#039;ll love to know about it.</p><p>EDIT: actually this issue is really software related. Not longer an issue then. For example, Watch_Dogs does it, while Middle Earth: Battle for Mordor doesn&#039;t.</p> <p class="postedit"><em>Last edited by Nesousx (2014-10-03 16:34:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462539">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462627" class="blockpost rowodd"> <h2><span><span class="conr">#2878</span> <a href="viewtopic.php?pid=1462627#p1462627">2014-10-03 16:26:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Hi,</p><p>I am running a similar setup than OP (kvm vga passthrough vfio) based on Ubuntu 14.04 with kernel 3.13 and KVM 2.0. I have a weird similar to the one OP mentioned. My sound sometimes &quot;lags&quot;. It is completely chopped and make the games lag. It only occurs on games. Video playback and music are fine. It happens both with audio through HDMI and with a dedicated USB sound card passed through (along with keyboard / mouse).</p><p>I noticed OP fixed this (in his 2Nd post), however the fix only applies on AMD board (I tried it, just to be sure), and I have an Intel one.</p><p>Anyone has this same issue or knows how to fix it?</p><p>Thanks in advance</p><p>PS: talking about sound, I have another issue. I am pretty sure &quot;this is not a bug, this a feature&quot;, however I&#039;ll ask. When playing a Windows game, if I change input via an HDMI switch (eg: I switch back to linux), then when I go back to the game there is no longer sound. Sounds still works in Windows if I ALT + TAB, but nothing in game. I have to quit and relaunch. Happens also with an USB sound card when I switch back to Linux. If someone has as fix, I&#039;ll love to know about it.</p></div></blockquote></div><br /><p>If you have a dedicated USB sound card, you can use it, well, dedicated to linux, without getting linux sound out of it. I think that should help your latest issue. And maybe the former too.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462628" class="blockpost roweven"> <h2><span><span class="conr">#2879</span> <a href="viewtopic.php?pid=1462628#p1462628">2014-10-03 16:31:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Hi,</p><p>I am running a similar setup than OP (kvm vga passthrough vfio) based on Ubuntu 14.04 with kernel 3.13 and KVM 2.0. I have a weird similar to the one OP mentioned. My sound sometimes &quot;lags&quot;. It is completely chopped and make the games lag. It only occurs on games. Video playback and music are fine. It happens both with audio through HDMI and with a dedicated USB sound card passed through (along with keyboard / mouse).</p><p>I noticed OP fixed this (in his 2Nd post), however the fix only applies on AMD board (I tried it, just to be sure), and I have an Intel one.</p><p>Anyone has this same issue or knows how to fix it?</p><p>Thanks in advance</p><p>PS: talking about sound, I have another issue. I am pretty sure &quot;this is not a bug, this a feature&quot;, however I&#039;ll ask. When playing a Windows game, if I change input via an HDMI switch (eg: I switch back to linux), then when I go back to the game there is no longer sound. Sounds still works in Windows if I ALT + TAB, but nothing in game. I have to quit and relaunch. Happens also with an USB sound card when I switch back to Linux. If someone has as fix, I&#039;ll love to know about it.</p></div></blockquote></div><br /><p>If you have a dedicated USB sound card, you can use it, well, dedicated to linux, without getting linux sound out of it. I think that should help your latest issue. And maybe the former too.</p></div></blockquote></div><p>I have been doing this for months, but it doesn&#039;t help at all. I am back with full sound over HDMI and will sell the sound card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462628">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462629" class="blockpost rowodd"> <h2><span><span class="conr">#2880</span> <a href="viewtopic.php?pid=1462629#p1462629">2014-10-03 16:33:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Hi,</p><p>I am running a similar setup than OP (kvm vga passthrough vfio) based on Ubuntu 14.04 with kernel 3.13 and KVM 2.0. I have a weird similar to the one OP mentioned. My sound sometimes &quot;lags&quot;. It is completely chopped and make the games lag. It only occurs on games. Video playback and music are fine. It happens both with audio through HDMI and with a dedicated USB sound card passed through (along with keyboard / mouse).</p><p>I noticed OP fixed this (in his 2Nd post), however the fix only applies on AMD board (I tried it, just to be sure), and I have an Intel one.</p><p>Anyone has this same issue or knows how to fix it?</p><p>Thanks in advance</p><p>PS: talking about sound, I have another issue. I am pretty sure &quot;this is not a bug, this a feature&quot;, however I&#039;ll ask. When playing a Windows game, if I change input via an HDMI switch (eg: I switch back to linux), then when I go back to the game there is no longer sound. Sounds still works in Windows if I ALT + TAB, but nothing in game. I have to quit and relaunch. Happens also with an USB sound card when I switch back to Linux. If someone has as fix, I&#039;ll love to know about it.</p></div></blockquote></div><br /><p>If you have a dedicated USB sound card, you can use it, well, dedicated to linux, without getting linux sound out of it. I think that should help your latest issue. And maybe the former too.</p></div></blockquote></div><p>I have been doing this for months, but it doesn&#039;t help at all. I am back with full sound over HDMI and will sell the sound card.</p></div></blockquote></div><br /><p>Durr, i&#039;ve meant, dedicated to VM, not linux. Wasn&#039;t too fast to edit the message.<br />So, like, linux sound getting out of HDMI, VM sound getting out of USB.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462629">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462630" class="blockpost roweven"> <h2><span><span class="conr">#2881</span> <a href="viewtopic.php?pid=1462630#p1462630">2014-10-03 16:38:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ Duelist, I have tried many combinations, with one or several (one per host and one per VM) cards... always the same bug happen (the first issue I was talking about). The sound is choppy then the game lag. I am thinking that this might not be sound related. Sound being choppy is probably just a side effect, but where to look? Found nothing relevant yet, in logs. It seems to happen randomly too.</p><p>About my 2nd issue, it is no longer an issue since it is software related. I edited my post. I have been playing one game all the time that causes the bug, and I remember I had it before on other games too and then thought it was system wide before testing for real.</p> <p class="postedit"><em>Last edited by Nesousx (2014-10-03 16:48:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462630">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462644" class="blockpost rowodd"> <h2><span><span class="conr">#2882</span> <a href="viewtopic.php?pid=1462644#p1462644">2014-10-03 17:16:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>@ Duelist, I have tried many combinations, with one or several (one per host and one per VM) cards... always the same bug happen (the first issue I was talking about). The sound is choppy then the game lag. I am thinking that this might not be sound related. Sound being choppy is probably just a side effect, but where to look? Found nothing relevant yet, in logs. It seems to happen randomly too.</p></div></blockquote></div><p>Audio might be fairly sensitive to interrupt latency.&#160; Have you tried my instructions <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">here</a> for making Windows use MSI interrupts for the audio device?&#160; I&#039;ve done this successfully for both AMD and NVIDIA audio functions on Win8.&#160; Pinning vCPUs and using hugepages can also help latency issues.&#160; You can also pin the host interrupt for the device to a host CPU not used by the VM to try to further improve latency.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462644">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462691" class="blockpost roweven"> <h2><span><span class="conr">#2883</span> <a href="viewtopic.php?pid=1462691#p1462691">2014-10-03 20:20:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>This is probably a question for redger, but anyone with an idea can chime right in.&#160; </p><p>I&#039;ve had a working Win7 passthrough for quite some time, but have wanted to migrate over from qemu commandline to libvirt for a variety of reasons.&#160; I followed the excellent guide on page 94 of the thread, but Windows 7 gets caught in the Windows cannot start, repair or reboot loop.&#160; Interestingly, if one tries to restart the VM from inside, it bluescreens.&#160; </p><p>I can post the details of the qemu script and the xml if needed, but there is nothing remarkable.&#160; Using kernel 3.15.5 and qemu 2.0.0, libvirt 1.2.9.&#160; I use the virtio drivers for the hd and network.&#160; Other VMs (new to libvirt, not migrated) seem to work OK, so I assume this is a Windows problem having to do with a &quot;change&quot; in hardware between qemu commandline and libvirt.</p><p>Presumably this is a common problem with migrations and the unpalatable answer is to reinstall Windows under libvirt, but I&#039;d rather avoid that. (If I did that I&#039;d probably also change from q35 to 440fx and give OVMF a try.)&#160; Is there a VM preparation maneuver to make the transition less likely to fail?&#160; A registry hack? Google fails to enlighten in this case.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462691">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462694" class="blockpost rowodd"> <h2><span><span class="conr">#2884</span> <a href="viewtopic.php?pid=1462694#p1462694">2014-10-03 20:42:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>This is probably a question for redger, but anyone with an idea can chime right in.&#160; </p><p>I&#039;ve had a working Win7 passthrough for quite some time, but have wanted to migrate over from qemu commandline to libvirt for a variety of reasons.&#160; I followed the excellent guide on page 94 of the thread, but Windows 7 gets caught in the Windows cannot start, repair or reboot loop.&#160; Interestingly, if one tries to restart the VM from inside, it bluescreens.&#160; </p><p>I can post the details of the qemu script and the xml if needed, but there is nothing remarkable.&#160; Using kernel 3.15.5 and qemu 2.0.0, libvirt 1.2.9.&#160; I use the virtio drivers for the hd and network.&#160; Other VMs (new to libvirt, not migrated) seem to work OK, so I assume this is a Windows problem having to do with a &quot;change&quot; in hardware between qemu commandline and libvirt.</p><p>Presumably this is a common problem with migrations and the unpalatable answer is to reinstall Windows under libvirt, but I&#039;d rather avoid that. (If I did that I&#039;d probably also change from q35 to 440fx and give OVMF a try.)&#160; Is there a VM preparation maneuver to make the transition less likely to fail?&#160; A registry hack? Google fails to enlighten in this case.</p></div></blockquote></div><p>It should be entirely possible to convert from qemu commandline to libvirt in a compatible way, but the differences can be subtle.&#160; Often people don&#039;t specify addresses for every device on the commandline and libvirt is likely to re-order the device declaration, so at a minimum you&#039;d want to figure out the PCI address for each device and specify it explicitly in the xml.&#160; Windows gets confused enough when devices move around, but if you end up changing devices at the same time, you&#039;re probably in for a world of hurt.&#160; You probably also want to switch to a dummy disk image or snapshot so that you can make a few attempts comparing the libvirt generated commandline to your own before you risk the real VM disk image.&#160; libvirt&#039;s restrictive support for q35 just makes the conversion all that much harder too.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462694">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462702" class="blockpost roweven"> <h2><span><span class="conr">#2885</span> <a href="viewtopic.php?pid=1462702#p1462702">2014-10-03 21:24:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>@ Duelist, I have tried many combinations, with one or several (one per host and one per VM) cards... always the same bug happen (the first issue I was talking about). The sound is choppy then the game lag. I am thinking that this might not be sound related. Sound being choppy is probably just a side effect, but where to look? Found nothing relevant yet, in logs. It seems to happen randomly too.</p></div></blockquote></div><p>Audio might be fairly sensitive to interrupt latency.&#160; Have you tried my instructions <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">here</a> for making Windows use MSI interrupts for the audio device?&#160; I&#039;ve done this successfully for both AMD and NVIDIA audio functions on Win8.&#160; Pinning vCPUs and using hugepages can also help latency issues.&#160; You can also pin the host interrupt for the device to a host CPU not used by the VM to try to further improve latency.</p></div></blockquote></div><p>Thanks. I&#039;ll give it a shot tomorrow.</p> <p class="postedit"><em>Last edited by Nesousx (2014-10-03 21:28:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462702">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462705" class="blockpost rowodd"> <h2><span><span class="conr">#2886</span> <a href="viewtopic.php?pid=1462705#p1462705">2014-10-03 21:32:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>@ Duelist, I have tried many combinations, with one or several (one per host and one per VM) cards... always the same bug happen (the first issue I was talking about). The sound is choppy then the game lag. I am thinking that this might not be sound related. Sound being choppy is probably just a side effect, but where to look? Found nothing relevant yet, in logs. It seems to happen randomly too.</p></div></blockquote></div><p>Audio might be fairly sensitive to interrupt latency.&#160; Have you tried my instructions <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">here</a> for making Windows use MSI interrupts for the audio device?&#160; I&#039;ve done this successfully for both AMD and NVIDIA audio functions on Win8.&#160; Pinning vCPUs and using hugepages can also help latency issues.&#160; You can also pin the host interrupt for the device to a host CPU not used by the VM to try to further improve latency.</p></div></blockquote></div><p>Thanks. It looks like my device doesn&#039;t support MSI. Sorry if I missed something from your post, I am about to go to bed, and quite tired.</p><div class="codebox"><pre><code>sudo lspci -v -s 1:00.0 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti PRO [Radeon HD 7950/8950 OEM / R9 280] (prog-if 00 [VGA controller]) Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+</code></pre></div><p>We can notice an MSI- instead of MSI+.</p></div></blockquote></div><p>The fact that it has an MSI capability means that it supports MSI.&#160; -/+ tells you whether it&#039;s enabled.&#160; However, what I&#039;m suggesting is that you assign and enable MSI interrupts for the audio function in order to reduce interrupt latency and perhaps improve the choppy audio.&#160; What you&#039;ve listed here is the GPU function.&#160; Enabling MSI for both is even better, but MSI on the GPU is typically enabled by default on AMD.</p> <p class="postedit"><em>Last edited by aw (2014-10-03 21:33:29)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462705">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462741" class="blockpost roweven"> <h2><span><span class="conr">#2887</span> <a href="viewtopic.php?pid=1462741#p1462741">2014-10-03 23:38:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw Thanks; I&#039;ll give it a try. However I&#039;m unsure about something; you mentioned a</p><div class="quotebox"><blockquote><div><p>libvirt generated commandline</p></div></blockquote></div><p>I&#039;ve got the xml (which has some autogenerated PCI lines in it) eg.</p><div class="codebox"><pre><code>&lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;</code></pre></div><p>for non-vfio passthrough devices, like the pci-bridge. I presume these are what you mean I should compare to their equivalents somewhere in Windows&#039; Device Manager?</p><p>I&#039;ve also got the qemu command line, eg.</p><div class="codebox"><pre><code> -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 </code></pre></div><p>which just gets translated as</p><div class="codebox"><pre><code>&lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039; </code></pre></div><p>which look identical so are presumably not the problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462741">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462785" class="blockpost rowodd"> <h2><span><span class="conr">#2888</span> <a href="viewtopic.php?pid=1462785#p1462785">2014-10-04 06:36:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi .</p><p>I always had this question in mind :</p><p>Does using PLX chips on motherboards to expand PCI-E lanes make it harder to passthorugh devices installed in such PCI-E slots ?</p><p>I used to have ASRock Z77 Extreme 11 which has PLX chips , whenever I tried to passthrough GPUs , the whole host hanged .</p><p>I might opt for an ASUS X99-E WS , which has PLX chips as well . Can anyone confirm whether it is possible or not ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462785">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462830" class="blockpost roweven"> <h2><span><span class="conr">#2889</span> <a href="viewtopic.php?pid=1462830#p1462830">2014-10-04 11:31:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Audio might be fairly sensitive to interrupt latency.&#160; Have you tried my instructions <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">here</a> for making Windows use MSI interrupts for the audio device?&#160; I&#039;ve done this successfully for both AMD and NVIDIA audio functions on Win8.&#160; Pinning vCPUs and using hugepages can also help latency issues.&#160; You can also pin the host interrupt for the device to a host CPU not used by the VM to try to further improve latency.</p></div></blockquote></div><p>Thanks. It looks like my device doesn&#039;t support MSI. Sorry if I missed something from your post, I am about to go to bed, and quite tired.</p><div class="codebox"><pre><code>sudo lspci -v -s 1:00.0 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti PRO [Radeon HD 7950/8950 OEM / R9 280] (prog-if 00 [VGA controller]) Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+</code></pre></div><p>We can notice an MSI- instead of MSI+.</p></div></blockquote></div><p>The fact that it has an MSI capability means that it supports MSI.&#160; -/+ tells you whether it&#039;s enabled.&#160; However, what I&#039;m suggesting is that you assign and enable MSI interrupts for the audio function in order to reduce interrupt latency and perhaps improve the choppy audio.&#160; What you&#039;ve listed here is the GPU function.&#160; Enabling MSI for both is even better, but MSI on the GPU is typically enabled by default on AMD.</p></div></blockquote></div><p>I read too fast yesterday, and you replied before my edit. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I did some change and now MSI is enabled. I&#039;ll try and let you know.</p><div class="codebox"><pre><code>sudo lspci -v -s 1:00.0 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti PRO [Radeon HD 7950/8950 OEM / R9 280] (prog-if 00 [VGA controller]) Subsystem: PC Partner Limited / Sapphire Technology Device e210 Flags: bus master, fast devsel, latency 0, IRQ 59 Memory at e0000000 (64-bit, prefetchable) [size=256M] Memory at f7b00000 (64-bit, non-prefetchable) [size=256K] I/O ports at e000 [size=256] Expansion ROM at f7b40000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [270] #19 Capabilities: [2b0] Address Translation Service (ATS) Capabilities: [2c0] #13 Capabilities: [2d0] #1b Kernel driver in use: vfio-pci</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462830">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462859" class="blockpost rowodd"> <h2><span><span class="conr">#2890</span> <a href="viewtopic.php?pid=1462859#p1462859">2014-10-04 13:46:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GrigoryPtashko wrote:</cite><blockquote><div><p>Hello.</p><p>Here&#039;s my setup:</p><br /><p>1. Supermicro X9DRFF-iG+/-7G+/-iTG+/-7TG+/X9DRFF-iG+/-7G+/-iTG+/-7TG+, BIOS 3.0 07/29/2013<br />2. Custom built kernel 3.16.3 (taken from kernel.org) + applied patches from OP<br />3. Cmdline intel_iommu=on,igfx_off pci_stub.ids=10de:1005,10de:0e1a4,1002:0b0c,1002:aac8 vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 nohz=off<br />4. Latest Qemu from git built by myself.<br />5. Latest Seabios from git built by myself.</p><br /><p>With this I&#039;ve managed to passthrough an NVIDIA GTX TITAN. Everything works fine.<br />Now I&#039;m trying to passthrough the AMD FirePro W8100 (and W9100). I set up a VM with emulated VGA and with passedthrough W8100. I set up the driver. The driver sees the W8100. But it is with yellow sign since it is not primary.</p><p>And now the problem:</p><p>I turn on the VM with the W8100 as the primary adapter and I get a <strong>kernel panic on the host (!)</strong>.</p></div></blockquote></div><p>Note that the quirks we currently have in place are designed and developed for Radeon cards.&#160; We have no idea if they&#039;re relevant or correct for FirePro cards.&#160; Quadro cards are similar, they also do not work in primary VGA mode using the GeForce quirks.&#160; Nvidia does however support secondary assignment for those cards, so we don&#039;t bother to come up with quirks for them.</p><div class="quotebox"><blockquote><div><p>Here&#039;s the kernel panic:</p><br /><div class="codebox"><pre><code>... [ 2013.702012] vfio_ecap_init: 0000:83:00.0 hiding ecap 0x19@0x270 [ 2013.707946] vfio_ecap_init: 0000:83:00.0 hiding ecap 0x1b@0x2d0 [ 2020.563698] kvm: zapping shadow pages for mmio generation wraparound [ 2028.031369] vfio-pci 0000:83:00.0: irq 146 for MSI/MSI-X [ 2050.912282] dmar: DRHD: handling fault status reg 40 .... lots of the same dmar: DRHD: handling fault status reg 40 here</code></pre></div></div></blockquote></div><p>dmar faults are usually two lines, one indicating the status register, which you&#039;ve included and another indicating the faulting device, type of fault, and address, not included.&#160; The not included line is generally much more insightful.</p><div class="quotebox"><blockquote><div><div class="codebox"><pre class="vscroll"><code>[ 2064.032487] dmar: DRHD: handling fault status reg 40 [ 2064.033072] Kernel panic - not syncing: Watchdog detected hard LOCKUP on cpu 31 [ 2064.033074] CPU: 31 PID: 4197 Comm: qemu-system-x86 Tainted: G W 3.16.3 #1 [ 2064.033075] Hardware name: Supermicro X9DRFF-iG+/-7G+/-iTG+/-7TG+/X9DRFF-iG+/-7G+/-iTG+/-7TG+, BIOS 3.0 07/29/2013 [ 2064.033077] 0000000000000000 000000006cf33090 ffff88307fde6c10 ffffffff817eb37c [ 2064.033079] ffffffff81ab62c0 ffff88307fde6c90 ffffffff817e3c66 0000000000000010 [ 2064.033080] ffff88307fde6ca0 ffff88307fde6c40 000000006cf33090 0000000000000000 [ 2064.033080] Call Trace: [ 2064.033087] &lt;NMI&gt; [&lt;ffffffff817eb37c&gt;] dump_stack+0x45/0x56 [ 2064.033089] [&lt;ffffffff817e3c66&gt;] panic+0xd8/0x20c [ 2064.033093] [&lt;ffffffff81121250&gt;] ? restart_watchdog_hrtimer+0x50/0x50 [ 2064.033095] [&lt;ffffffff81121312&gt;] watchdog_overflow_callback+0xc2/0xd0 [ 2064.033097] [&lt;ffffffff8115dd8d&gt;] __perf_event_overflow+0x9d/0x250 [ 2064.033098] [&lt;ffffffff8115e884&gt;] perf_event_overflow+0x14/0x20 [ 2064.033102] [&lt;ffffffff81032bcd&gt;] intel_pmu_handle_irq+0x1fd/0x410 [ 2064.033105] [&lt;ffffffff811a3381&gt;] ? unmap_kernel_range_noflush+0x11/0x20 [ 2064.033110] [&lt;ffffffff81436974&gt;] ? ghes_copy_tofrom_phys+0x124/0x210 [ 2064.033113] [&lt;ffffffff81029f5b&gt;] perf_event_nmi_handler+0x2b/0x50 [ 2064.033115] [&lt;ffffffff81017e90&gt;] nmi_handle+0x90/0x130 [ 2064.033116] [&lt;ffffffff810184ae&gt;] default_do_nmi+0xde/0x140 [ 2064.033117] [&lt;ffffffff81018598&gt;] do_nmi+0x88/0xc0 [ 2064.033120] [&lt;ffffffff817f7671&gt;] end_repeat_nmi+0x1e/0x2e [ 2064.033124] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033125] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033127] [&lt;ffffffff816700d6&gt;] ? qi_submit_sync+0x196/0x400 [ 2064.033129] &lt;&lt;EOE&gt;&gt; [&lt;ffffffff81670536&gt;] qi_flush_dev_iotlb+0x86/0xd0 [ 2064.033130] [&lt;ffffffff81672534&gt;] iommu_flush_dev_iotlb+0xa4/0xd0 [ 2064.033132] [&lt;ffffffff81672612&gt;] iommu_flush_iotlb_psi+0xb2/0xe0 [ 2064.033133] [&lt;ffffffff81674fce&gt;] intel_iommu_unmap+0x1ce/0x1e0 [ 2064.033135] [&lt;ffffffff81668340&gt;] iommu_unmap+0xb0/0x190 [ 2064.033140] [&lt;ffffffff81599553&gt;] vfio_remove_dma+0xc3/0x1a0 [ 2064.033142] [&lt;ffffffff817f36e2&gt;] ? mutex_lock+0x12/0x2f [ 2064.033144] [&lt;ffffffff81599c71&gt;] vfio_iommu_type1_ioctl+0x3e1/0xa20 [ 2064.033163] [&lt;ffffffffa0005486&gt;] ? kvm_set_memory_region+0x36/0x40 [kvm] [ 2064.033169] [&lt;ffffffffa0005902&gt;] ? kvm_vm_ioctl+0x472/0x730 [kvm] [ 2064.033171] [&lt;ffffffff81597769&gt;] vfio_fops_unl_ioctl+0x79/0x2b0 [ 2064.033174] [&lt;ffffffff811ef660&gt;] do_vfs_ioctl+0x2e0/0x4a0 [ 2064.033175] [&lt;ffffffff811ef8a1&gt;] SyS_ioctl+0x81/0xa0 [ 2064.033177] [&lt;ffffffff8110ec66&gt;] ? __audit_syscall_exit+0x1f6/0x2a0 [ 2064.033179] [&lt;ffffffff817f5369&gt;] system_call_fastpath+0x16/0x1b</code></pre></div></div></blockquote></div><p>It looks like the watchdog kicked in while we were trying to unmap some pages from the iommu and then the mga driver exploded, as it&#039;s prone to do.&#160; What was going on with the VM at this point?&#160; The intel-iommu code has had some issues with stalling the kernel during large unmaps, but it shouldn&#039;t be happening for a small, 16G VM.&#160; You can try disabling the hardware watchdog to see if this is just that the unmap takes longer than the watchdog allows, we&#039;re only looking at ~50s from VM start to lockup.</p><p>In general though, I would not expect FirePro cards to work.&#160; AFAIK, we don&#039;t have any evidence that would suggest that they necessarily use the same set of quirks as Radeon cards.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462859">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462861" class="blockpost roweven"> <h2><span><span class="conr">#2891</span> <a href="viewtopic.php?pid=1462861#p1462861">2014-10-04 13:52:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Hi .</p><p>I always had this question in mind :</p><p>Does using PLX chips on motherboards to expand PCI-E lanes make it harder to passthorugh devices installed in such PCI-E slots ?</p><p>I used to have ASRock Z77 Extreme 11 which has PLX chips , whenever I tried to passthrough GPUs , the whole host hanged .</p><p>I might opt for an ASUS X99-E WS , which has PLX chips as well . Can anyone confirm whether it is possible or not ?</p></div></blockquote></div><p>I assume you mean PLX branded PCIe switches.&#160; If they support ACS and aren&#039;t crap, then in theory they don&#039;t pose any issue for device assignment.&#160; If they don&#039;t support ACS, it pretty much guarantees that you&#039;ll always need the ACS override patch.&#160; In general, more components are just more opportunities for things to be broken.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462861">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462869" class="blockpost rowodd"> <h2><span><span class="conr">#2892</span> <a href="viewtopic.php?pid=1462869#p1462869">2014-10-04 15:05:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Hi .</p><p>I always had this question in mind :</p><p>Does using PLX chips on motherboards to expand PCI-E lanes make it harder to passthorugh devices installed in such PCI-E slots ?</p><p>I used to have ASRock Z77 Extreme 11 which has PLX chips , whenever I tried to passthrough GPUs , the whole host hanged .</p><p>I might opt for an ASUS X99-E WS , which has PLX chips as well . Can anyone confirm whether it is possible or not ?</p></div></blockquote></div><p>I assume you mean PLX branded PCIe switches.&#160; If they support ACS and aren&#039;t crap, then in theory they don&#039;t pose any issue for device assignment.&#160; If they don&#039;t support ACS, it pretty much guarantees that you&#039;ll always need the ACS override patch.&#160; In general, more components are just more opportunities for things to be broken.</p></div></blockquote></div><p>PLX advertises that most (all?) of their PEX chips support ACS . Maybe it was the motherboard that was causing issues , and not the PLX chip itself .</p><p>I&#039;ve got a kernel panic just now :</p><div class="codebox"><pre class="vscroll"><code>[ 42.002633] irq 28: nobody cared (try booting with the &quot;irqpoll&quot; option) [ 42.002633] CPU: 0 PID: 0 Comm: swapper/0 Tainted: P O 3.16.3-1-ARCH #1 [ 42.002633] Hardware name: ASUS All Series/X99-DELUXE, BIOS 0904 09/22/2014 [ 42.002633] 0000000000000000 e24784535cef3a79 ffff88085fc03ad8 ffffffff8152b3bc [ 42.002633] ffff8808323f9a00 ffff88085fc03b00 ffffffff810d02a2 ffff8808323f9a00 [ 42.002633] 0000000000000000 000000000000001c ffff88085fc03b38 ffffffff810d0657 [ 42.002633] Call Trace: [ 42.002633] &lt;IRQ&gt; [&lt;ffffffff8152b3bc&gt;] dump_stack+0x4d/0x6f [ 42.002633] [&lt;ffffffff810d02a2&gt;] __report_bad_irq+0x32/0xd0 [ 42.002633] [&lt;ffffffff810d0657&gt;] note_interrupt+0x257/0x2a0 [ 42.002633] [&lt;ffffffff810cdbae&gt;] handle_irq_event_percpu+0xae/0x1f0 [ 42.002633] [&lt;ffffffff810cdd2d&gt;] handle_irq_event+0x3d/0x60 [ 42.002633] [&lt;ffffffff810d1281&gt;] handle_fasteoi_irq+0x81/0x170 [ 42.002633] [&lt;ffffffff8101717e&gt;] handle_irq+0x1e/0x40 [ 42.002633] [&lt;ffffffff81533bed&gt;] do_IRQ+0x4d/0xe0 [ 42.002633] [&lt;ffffffff81531bad&gt;] common_interrupt+0x6d/0x6d [ 42.002633] [&lt;ffffffff810b6710&gt;] ? __wake_up_bit+0x40/0x60 [ 42.002633] [&lt;ffffffff8114be63&gt;] unlock_page+0x23/0x30 [ 42.002633] [&lt;ffffffff8114cf3e&gt;] page_endio+0x1e/0x60 [ 42.002633] [&lt;ffffffff811ff892&gt;] mpage_end_io+0x42/0x60 [ 42.002633] [&lt;ffffffff8126f4db&gt;] bio_endio+0x6b/0xa0 [ 42.002633] [&lt;ffffffff812766a4&gt;] blk_update_request+0x94/0x380 [ 42.002633] [&lt;ffffffff812769ae&gt;] blk_update_bidi_request+0x1e/0xa0 [ 42.002633] [&lt;ffffffff81276d01&gt;] blk_end_bidi_request+0x21/0x60 [ 42.002633] [&lt;ffffffff81276d50&gt;] blk_end_request+0x10/0x20 [ 42.002633] [&lt;ffffffffa003238d&gt;] scsi_io_completion+0xad/0x710 [scsi_mod] [ 42.002633] [&lt;ffffffffa00293d2&gt;] scsi_finish_command+0xa2/0xe0 [scsi_mod] [ 42.002633] [&lt;ffffffffa00321fe&gt;] scsi_softirq_done+0x10e/0x130 [scsi_mod] [ 42.002633] [&lt;ffffffff8127d5eb&gt;] blk_done_softirq+0x8b/0xb0 [ 42.002633] [&lt;ffffffff810736c2&gt;] __do_softirq+0xf2/0x2e0 [ 42.002633] [&lt;ffffffff81073a06&gt;] irq_exit+0x86/0xb0 [ 42.002633] [&lt;ffffffff81533bf6&gt;] do_IRQ+0x56/0xe0 [ 42.002633] [&lt;ffffffff81531bad&gt;] common_interrupt+0x6d/0x6d [ 42.002633] &lt;EOI&gt; [&lt;ffffffff813e88bc&gt;] ? cpuidle_enter_state+0x4c/0xc0 [ 42.002633] [&lt;ffffffff813e8a17&gt;] cpuidle_enter+0x17/0x20 [ 42.002633] [&lt;ffffffff810b710f&gt;] cpu_startup_entry+0x32f/0x520 [ 42.002633] [&lt;ffffffff815216c4&gt;] rest_init+0x84/0x90 [ 42.002633] [&lt;ffffffff818f5fc9&gt;] start_kernel+0x45e/0x47f [ 42.002633] [&lt;ffffffff818f5120&gt;] ? early_idt_handlers+0x120/0x120 [ 42.002633] [&lt;ffffffff818f54d7&gt;] x86_64_start_reservations+0x2a/0x2c [ 42.002633] [&lt;ffffffff818f5626&gt;] x86_64_start_kernel+0x14d/0x170 [ 42.002633] handlers: [ 42.002633] [&lt;ffffffffa05c43e0&gt;] vfio_intx_handler [vfio_pci] [ 42.002633] Disabling IRQ #28</code></pre></div><p>It happened when I started copying large files from my SMB share to my VM&#039;s virtio qcow2 disk file , which crashes the VM alone and not other VMs or the host .</p><p>Thank you .</p> <p class="postedit"><em>Last edited by Denso (2014-10-04 15:05:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462869">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462875" class="blockpost roweven"> <h2><span><span class="conr">#2893</span> <a href="viewtopic.php?pid=1462875#p1462875">2014-10-04 15:32:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>I&#039;ve got a kernel panic just now :</p><div class="codebox"><pre class="vscroll"><code>[ 42.002633] irq 28: nobody cared (try booting with the &quot;irqpoll&quot; option) [ 42.002633] CPU: 0 PID: 0 Comm: swapper/0 Tainted: P O 3.16.3-1-ARCH #1 [ 42.002633] Hardware name: ASUS All Series/X99-DELUXE, BIOS 0904 09/22/2014 [ 42.002633] 0000000000000000 e24784535cef3a79 ffff88085fc03ad8 ffffffff8152b3bc [ 42.002633] ffff8808323f9a00 ffff88085fc03b00 ffffffff810d02a2 ffff8808323f9a00 [ 42.002633] 0000000000000000 000000000000001c ffff88085fc03b38 ffffffff810d0657 [ 42.002633] Call Trace: [ 42.002633] &lt;IRQ&gt; [&lt;ffffffff8152b3bc&gt;] dump_stack+0x4d/0x6f [ 42.002633] [&lt;ffffffff810d02a2&gt;] __report_bad_irq+0x32/0xd0 [ 42.002633] [&lt;ffffffff810d0657&gt;] note_interrupt+0x257/0x2a0 [ 42.002633] [&lt;ffffffff810cdbae&gt;] handle_irq_event_percpu+0xae/0x1f0 [ 42.002633] [&lt;ffffffff810cdd2d&gt;] handle_irq_event+0x3d/0x60 [ 42.002633] [&lt;ffffffff810d1281&gt;] handle_fasteoi_irq+0x81/0x170 [ 42.002633] [&lt;ffffffff8101717e&gt;] handle_irq+0x1e/0x40 [ 42.002633] [&lt;ffffffff81533bed&gt;] do_IRQ+0x4d/0xe0 [ 42.002633] [&lt;ffffffff81531bad&gt;] common_interrupt+0x6d/0x6d [ 42.002633] [&lt;ffffffff810b6710&gt;] ? __wake_up_bit+0x40/0x60 [ 42.002633] [&lt;ffffffff8114be63&gt;] unlock_page+0x23/0x30 [ 42.002633] [&lt;ffffffff8114cf3e&gt;] page_endio+0x1e/0x60 [ 42.002633] [&lt;ffffffff811ff892&gt;] mpage_end_io+0x42/0x60 [ 42.002633] [&lt;ffffffff8126f4db&gt;] bio_endio+0x6b/0xa0 [ 42.002633] [&lt;ffffffff812766a4&gt;] blk_update_request+0x94/0x380 [ 42.002633] [&lt;ffffffff812769ae&gt;] blk_update_bidi_request+0x1e/0xa0 [ 42.002633] [&lt;ffffffff81276d01&gt;] blk_end_bidi_request+0x21/0x60 [ 42.002633] [&lt;ffffffff81276d50&gt;] blk_end_request+0x10/0x20 [ 42.002633] [&lt;ffffffffa003238d&gt;] scsi_io_completion+0xad/0x710 [scsi_mod] [ 42.002633] [&lt;ffffffffa00293d2&gt;] scsi_finish_command+0xa2/0xe0 [scsi_mod] [ 42.002633] [&lt;ffffffffa00321fe&gt;] scsi_softirq_done+0x10e/0x130 [scsi_mod] [ 42.002633] [&lt;ffffffff8127d5eb&gt;] blk_done_softirq+0x8b/0xb0 [ 42.002633] [&lt;ffffffff810736c2&gt;] __do_softirq+0xf2/0x2e0 [ 42.002633] [&lt;ffffffff81073a06&gt;] irq_exit+0x86/0xb0 [ 42.002633] [&lt;ffffffff81533bf6&gt;] do_IRQ+0x56/0xe0 [ 42.002633] [&lt;ffffffff81531bad&gt;] common_interrupt+0x6d/0x6d [ 42.002633] &lt;EOI&gt; [&lt;ffffffff813e88bc&gt;] ? cpuidle_enter_state+0x4c/0xc0 [ 42.002633] [&lt;ffffffff813e8a17&gt;] cpuidle_enter+0x17/0x20 [ 42.002633] [&lt;ffffffff810b710f&gt;] cpu_startup_entry+0x32f/0x520 [ 42.002633] [&lt;ffffffff815216c4&gt;] rest_init+0x84/0x90 [ 42.002633] [&lt;ffffffff818f5fc9&gt;] start_kernel+0x45e/0x47f [ 42.002633] [&lt;ffffffff818f5120&gt;] ? early_idt_handlers+0x120/0x120 [ 42.002633] [&lt;ffffffff818f54d7&gt;] x86_64_start_reservations+0x2a/0x2c [ 42.002633] [&lt;ffffffff818f5626&gt;] x86_64_start_kernel+0x14d/0x170 [ 42.002633] handlers: [ 42.002633] [&lt;ffffffffa05c43e0&gt;] vfio_intx_handler [vfio_pci] [ 42.002633] Disabling IRQ #28</code></pre></div><p>It happened when I started copying large files from my SMB share to my VM&#039;s virtio qcow2 disk file , which crashes the VM alone and not other VMs or the host .</p><p>Thank you .</p></div></blockquote></div><p>This is not a panic.&#160; &#160;This is the kernel reporting that IRQ28 is continuing to fire and none of the handlers for that IRQ (vfio) are claiming the interrupt.&#160; The kernel is therefore announcing that it is disabling that interrupt.&#160; Since vfio is the only handler and it thinks the device is masked (otherwise it would claim the interrupt), that might mean that INTx disable on the device doesn&#039;t actually work.&#160; You can force vfio to mask at the APIC rather than the device by adding the nointxmask=1 parameter to the vfio-pci host kernel module.&#160; This does however require that no other devices share the interrupt, which can make configuration difficult.&#160; If the device supports MSI, you can also try to make it use that in the guest to avoid the problem.&#160; See my <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">post</a> on the blog for more info and how to do that.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462875">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462899" class="blockpost rowodd"> <h2><span><span class="conr">#2894</span> <a href="viewtopic.php?pid=1462899#p1462899">2014-10-04 17:36:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Audio bug still here after enabling MSI. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462899">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462940" class="blockpost roweven"> <h2><span><span class="conr">#2895</span> <a href="viewtopic.php?pid=1462940#p1462940">2014-10-04 22:08:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76159">dwightjl</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-23</span></dd> <dd><span>Posts: 8</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m getting the following error:</p><div class="codebox"><pre><code>vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.</code></pre></div><p>Here is the list of devices in that group:</p><div class="codebox"><pre><code>/sys/bus/pci/devices/0000:02:00.0/iommu_group/devices$ dir 0000:00:01.0 0000:00:01.1 0000:01:00.0 0000:01:00.1 0000:02:00.0 0000:02:00.1</code></pre></div><p>I would go ahead and list all of those devices in /etc/vfio-pci.cfg, but the problem with that is 01:00.0 and 01:00.1 are my primary display adapter. If I include that device in my vfio-pci.cfg file, it crashes the primary display when I try to bind it.</p><p>Is there a way to remove my primary display adapter from the iommu_group/devices list so that I don&#039;t get this error message? I&#039;ve seen other people post this error message before, but never saw any instructions on how to change iommu_group device lists.</p><p>EDIT: After some more digging, it seems like I might need to patch something. I thought patches were only for my kernel if my primary display adapter was the integrated intel. I&#039;ll keep digging.</p> <p class="postedit"><em>Last edited by dwightjl (2014-10-04 22:28:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462940">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462957" class="blockpost rowodd"> <h2><span><span class="conr">#2896</span> <a href="viewtopic.php?pid=1462957#p1462957">2014-10-04 23:25:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwightjl wrote:</cite><blockquote><div><p>I&#039;m getting the following error:</p><div class="codebox"><pre><code>vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.</code></pre></div><p>Here is the list of devices in that group:</p><div class="codebox"><pre><code>/sys/bus/pci/devices/0000:02:00.0/iommu_group/devices$ dir 0000:00:01.0 0000:00:01.1 0000:01:00.0 0000:01:00.1 0000:02:00.0 0000:02:00.1</code></pre></div><p>I would go ahead and list all of those devices in /etc/vfio-pci.cfg, but the problem with that is 01:00.0 and 01:00.1 are my primary display adapter. If I include that device in my vfio-pci.cfg file, it crashes the primary display when I try to bind it.</p><p>Is there a way to remove my primary display adapter from the iommu_group/devices list so that I don&#039;t get this error message? I&#039;ve seen other people post this error message before, but never saw any instructions on how to change iommu_group device lists.</p><p>EDIT: After some more digging, it seems like I might need to patch something. I thought patches were only for my kernel if my primary display adapter was the integrated intel. I&#039;ll keep digging.</p></div></blockquote></div><p><a href="http://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html" rel="nofollow">http://vfio.blogspot.com/2014/08/iommu- … d-out.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462961" class="blockpost roweven"> <h2><span><span class="conr">#2897</span> <a href="viewtopic.php?pid=1462961#p1462961">2014-10-04 23:57:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So you guys have helped me get set up and it&#039;s been runing <em>ok</em>, but there is still a major issue. My machine hangs when I reboot the vm. I wouldn&#039;t have a problem with just rebooting my pc when i reboot the vm, but the vm is crashing when rebooting to install windows updates which is completely corrupting the machine. I&#039;ve had this happen multiple times, so I need to try to find a solution. I&#039;ve tried to find a solution but I just haven&#039;t been able to find anything. I wish there was a way to do a search from this thread.</p><p>My setup</p><p>Running the patched 3.16 kernel from the first page.</p><p>lspci -nn</p><div class="codebox"><pre class="vscroll"><code>... 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF110 [GeForce GTX 580] [10de:1080] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GF110 High Definition Audio Controller [10de:0e09] (rev a1) ... 00:00.0 Host bridge [0600]: Intel Corporation 4th Gen Core Processor DRAM Controller [8086:0c00] (rev 06) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:01.1 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller [8086:0c05] (rev 06) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller [8086:0412] (rev 06) 00:03.0 Audio device [0403]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller [8086:0c0c] (rev 06) 00:14.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB xHCI Controller [8086:8cb1] 00:16.0 Communication controller [0780]: Intel Corporation 9 Series Chipset Family ME Interface #1 [8086:8cba] 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection (2) I218-V [8086:15a1] 00:1a.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB EHCI Controller #2 [8086:8cad] 00:1c.0 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 1 [8086:8c90] (rev d0) 00:1c.2 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 3 [8086:8c94] (rev d0) 00:1c.3 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 4 [8086:8c96] (rev d0) 00:1c.6 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 7 [8086:8c9c] (rev d0) 00:1d.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 [8086:8ca6] 00:1f.0 ISA bridge [0601]: Intel Corporation 9 Series Chipset Family Z97 LPC Controller [8086:8cc4] 00:1f.2 SATA controller [0106]: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode] [8086:8c82] 00:1f.3 SMBus [0c05]: Intel Corporation 9 Series Chipset Family SMBus Controller [8086:8ca2] ... 02:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller [1912:0014] (rev 03) 04:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 11) 05:00.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 06:01.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 06:03.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 06:05.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 06:07.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 07:00.0 PCI bridge [0604]: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge [1b21:1080] (rev 04) 08:04.0 Multimedia audio controller [0401]: C-Media Electronics Inc CMI8788 [Oxygen HD Audio] [13f6:8788] 09:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 02) 0a:00.0 Network controller [0280]: Qualcomm Atheros AR93xx Wireless Network Adapter [168c:0030] (rev 01) 0b:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 02) 0c:00.0 USB controller [0c03]: ASMedia Technology Inc. Device [1b21:1142]</code></pre></div><p>from syslinux.cfg</p><div class="codebox"><pre><code>LABEL arch-qemu MENU LABEL Arch Qemu LINUX ../vmlinuz-linux-mainline APPEND root=/dev/sdb1 rootflags=subvol=__active/rootvol intel_iommu=on i915.enable_hd_vgaarb=1 pcie_acs_override=downstream pci-stub.ids=10de:1080,10de:8086:0c0c modeset.nouveau=0 modeset.radeon=0 rw INITRD ../initramfs-linux-mainline.img</code></pre></div><br /><p>script for booting the vm:</p><div class="codebox"><pre class="vscroll"><code>sudo vfio-bind 0000:01:00.0 0000:01:00.1 0000:00:03.0 #qemu-system-x86_64 -enable-kvm -m 1024 -cpu host \ #-smp 6,sockets=1,cores=2,threads=1 \ #-bios /usr/share/qemu/bios.bin -vga none \ #-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ ##-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ #-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64 -enable-kvm -M q35 -m 8196 -mem-path /dev/hugepages -cpu host,kvm=off \ -smp 6,sockets=1,cores=3,threads=2 \ -boot menu=on \ -bios /usr/share/qemu/bios.bin -vga none\ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -nographic \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -drive file=/home/anonymous/Downloads/Win.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -drive file=/dev/sda,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -usb -usbdevice host:046d:c52e -usbdevice host:041e:30e0 -usbdevice host:045e:0719 \ # -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ # -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 # -device vfio-pci,host=07:00.0,bus=pcie.0 \ # -device vfio-pci,host=08:04.0,bus=pcie.0 # -device vfio-pci,host=0c:00.0,bus=pcie.0 # -drive file=/dev/sda,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \ # -boot menu=on \ # -rtc base=localtime \</code></pre></div><p>fwiw dunno if this is relevant, but when i run the vm using huge pages appears to fail</p><div class="codebox"><pre><code>qemu-system-x86_64: unable to map backing store for hugepages: Cannot allocate memory</code></pre></div><p>but it was having that issue before i started trying to use the huge pages.</p><div class="codebox"><pre><code>Bus 002 Device 002: ID 8087:8001 Intel Corp. Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 008 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 007 Device 003: ID 041e:30e0 Creative Technology, Ltd Bus 007 Device 002: ID 0409:005a NEC Corp. HighSpeed Hub Bus 007 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 001 Device 002: ID 8087:8009 Intel Corp. Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 004 Device 002: ID 174c:3074 ASMedia Technology Inc. Bus 004 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 003 Device 007: ID 046d:c52b Logitech, Inc. Unifying Receiver Bus 003 Device 006: ID 9886:0001 Bus 003 Device 005: ID 24f0:0137 Bus 003 Device 004: ID 174c:2074 ASMedia Technology Inc. Bus 003 Device 003: ID 046d:c52e Logitech, Inc. MK260 Wireless Combo Receiver Bus 003 Device 002: ID 045e:0719 Microsoft Corp. Xbox 360 Wireless Adapter Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div><p>edit:</p><p>by the way my cpu is an intel 4790k and the mb is asrock z97 extreme6</p> <p class="postedit"><em>Last edited by risho (2014-10-05 00:00:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462961">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462968" class="blockpost rowodd"> <h2><span><span class="conr">#2898</span> <a href="viewtopic.php?pid=1462968#p1462968">2014-10-05 00:20:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85053">Lauer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Have you installed a guest, installed a VNC server, installed Catalyst drivers, and have the VM working so that you can connect to that VNC server from the host?</p></div></blockquote></div><p>I did this but I can&#039;t connect to the guest VNC server from the host. I did some googling and found that the host and guest are not visible to each other on the default network.</p><p>There appear to be a lot of ways to get around this problem, none of which I understand <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />, what method do you suggest I look into?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462968">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462969" class="blockpost roweven"> <h2><span><span class="conr">#2899</span> <a href="viewtopic.php?pid=1462969#p1462969">2014-10-05 00:25:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauer wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Have you installed a guest, installed a VNC server, installed Catalyst drivers, and have the VM working so that you can connect to that VNC server from the host?</p></div></blockquote></div><p>I did this but I can&#039;t connect to the guest VNC server from the host. I did some googling and found that the host and guest are not visible to each other on the default network.</p><p>There appear to be a lot of ways to get around this problem, none of which I understand <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" />, what method do you suggest I look into?</p></div></blockquote></div><p>Use a bridge</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462969">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1462979" class="blockpost rowodd"> <h2><span><span class="conr">#2900</span> <a href="viewtopic.php?pid=1462979#p1462979">2014-10-05 01:52:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>after going back through journalctl this is the last bit of information before the crash if this helps any </p><div class="codebox"><pre class="vscroll"><code>Oct 04 18:42:11 arch kernel: xhci_hcd 0000:0c:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8807c0e4be88 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:0c:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8807c0e4be40 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:0c:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8807bfe96ea0 Oct 04 18:42:11 arch kernel: usb 7-2: ep 0x83 - rounding interval to 64 microframes, ep desc says 80 microframes Oct 04 18:42:11 arch kernel: usb 3-1: reset full-speed USB device number 2 using xhci_hcd Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: Setup ERROR: setup context command for slot 1. Oct 04 18:42:11 arch kernel: usb 3-1: hub failed to enable device, error -22 Oct 04 18:42:11 arch kernel: usb 3-1: reset full-speed USB device number 2 using xhci_hcd Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: Setup ERROR: setup context command for slot 1. Oct 04 18:42:11 arch kernel: usb 3-1: hub failed to enable device, error -22 Oct 04 18:42:11 arch kernel: usb 3-1: reset full-speed USB device number 2 using xhci_hcd Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235d048 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235d000 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235d1c8 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235d180 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235de88 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff88080235de40 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2048 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2000 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2108 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa20c0 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa21c8 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2180 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2288 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2240 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2348 Oct 04 18:42:11 arch kernel: xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880801fa2300 Oct 04 18:42:32 arch kernel: BUG: unable to handle kernel paging request at 00007fff00000000 Oct 04 18:42:32 arch kernel: IP: [&lt;00007fff00000000&gt;] 0x7fff00000000 Oct 04 18:42:32 arch kernel: PGD 75ed0d067 PUD 0 Oct 04 18:42:32 arch kernel: Oops: 0010 [#1] PREEMPT SMP Oct 04 18:42:32 arch kernel: Modules linked in: bridge stp llc md4 md5 hmac nls_utf8 cifs dns_resolver fscache ctr ccm hid_logitech_dj uas snd_usb_audio usb_storage snd_usbmidi_lib snd_hda_codec_hdmi vfio_pci vfio_iommu_type1 vfio nct6775 hwmon_vid ext4 crc16 mbcache jbd Oct 04 18:42:32 arch kernel: i2c_designware_platform tpm e1000e i2c_designware_core i2c_core battery dw_dmac dw_dmac_core snd_timer 8250_dw gpio_lynxpoint mei_me video spi_pxa2xx_platform snd mei ptp shpchp soundcore pps_core wmi processor acpi_pad button btrfs xor raid Oct 04 18:42:32 arch kernel: CPU: 1 PID: 1110 Comm: qemu-system-x86 Not tainted 3.16.0-1-mainline #1 Oct 04 18:42:32 arch kernel: Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./Z97 Extreme6, BIOS P1.30 05/22/2014 Oct 04 18:42:32 arch kernel: task: ffff8807bfd54750 ti: ffff8800a90f0000 task.ti: ffff8800a90f0000 Oct 04 18:42:32 arch kernel: RIP: 0010:[&lt;00007fff00000000&gt;] [&lt;00007fff00000000&gt;] 0x7fff00000000 Oct 04 18:42:32 arch kernel: RSP: 0018:ffff8800a90f3d98 EFLAGS: 00010006 Oct 04 18:42:32 arch kernel: RAX: ffff8807bf3c3e38 RBX: 000000008101478d RCX: 0000000000000000 Oct 04 18:42:32 arch kernel: RDX: 0000000000000000 RSI: 0000000000000003 RDI: ffff8807bf3c3e38 Oct 04 18:42:32 arch kernel: RBP: ffff8800a90f3dd8 R08: 0000000000000000 R09: 0000000000000000 Oct 04 18:42:32 arch kernel: R10: 00000000000103c0 R11: 0000000000000293 R12: ffffffff8189eb08 Oct 04 18:42:32 arch kernel: R13: 00000000004a0418 R14: 0000000000000000 R15: 0000000000000003 Oct 04 18:42:32 arch kernel: FS: 00007f1923fff700(0000) GS:ffff88082fa40000(0000) knlGS:0000000000000000 Oct 04 18:42:32 arch kernel: CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 Oct 04 18:42:32 arch kernel: CR2: 00007fff00000000 CR3: 0000000780c26000 CR4: 00000000001427e0 Oct 04 18:42:32 arch kernel: DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000 Oct 04 18:42:32 arch kernel: DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400 Oct 04 18:42:32 arch kernel: Stack: Oct 04 18:42:32 arch kernel: ffffffff810b6425 00000000bfd54750 0000000000000000 ffffffff8189eb00 Oct 04 18:42:32 arch kernel: 0000000000000046 0000000000000003 0000000000000000 0000000000000000 Oct 04 18:42:32 arch kernel: ffff8800a90f3e10 ffffffff810b66a9 ffff880803ab0000 0000000000000000 Oct 04 18:42:32 arch kernel: Call Trace: Oct 04 18:42:32 arch kernel: [&lt;ffffffff810b6425&gt;] ? __wake_up_common+0x55/0x90 Oct 04 18:42:32 arch kernel: [&lt;ffffffff810b66a9&gt;] __wake_up+0x39/0x50 Oct 04 18:42:32 arch kernel: [&lt;ffffffff8139aed8&gt;] __vga_put+0x98/0x150 Oct 04 18:42:32 arch kernel: [&lt;ffffffff8139b56f&gt;] vga_put+0x5f/0x90 Oct 04 18:42:32 arch kernel: [&lt;ffffffffa010d104&gt;] vfio_pci_vga_rw+0x1f4/0x240 [vfio_pci] Oct 04 18:42:32 arch kernel: [&lt;ffffffffa010a4e5&gt;] vfio_pci_rw+0x35/0x80 [vfio_pci] Oct 04 18:42:32 arch kernel: [&lt;ffffffffa010b2cf&gt;] vfio_pci_write+0x1f/0x30 [vfio_pci] Oct 04 18:42:32 arch kernel: [&lt;ffffffffa00492eb&gt;] vfio_device_fops_write+0x2b/0x30 [vfio] Oct 04 18:42:32 arch kernel: [&lt;ffffffff811c1b87&gt;] vfs_write+0xb7/0x200 Oct 04 18:42:32 arch kernel: [&lt;ffffffff811c29ca&gt;] SyS_pwrite64+0x9a/0xc0 Oct 04 18:42:32 arch kernel: [&lt;ffffffff811d48bb&gt;] ? SyS_ioctl+0x6b/0xa0 Oct 04 18:42:32 arch kernel: [&lt;ffffffff81530869&gt;] system_call_fastpath+0x16/0x1b Oct 04 18:42:32 arch kernel: Code: Bad RIP value. Oct 04 18:42:32 arch kernel: RIP [&lt;00007fff00000000&gt;] 0x7fff00000000</code></pre></div><p>and it happens either right as or a few moments after shutting down a vm.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1462979">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=115">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=114">114</a> <a href="viewtopic.php?id=162768&amp;p=115">115</a> <strong>116</strong> <a href="viewtopic.php?id=162768&amp;p=117">117</a> <a href="viewtopic.php?id=162768&amp;p=118">118</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=117">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
