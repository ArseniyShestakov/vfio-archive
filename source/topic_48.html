<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 48) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=48" title="Page 48" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=47" title="Page 47" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=49" title="Page 49" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=47">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=46">46</a> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <strong>48</strong> <a href="viewtopic.php?id=162768&amp;p=49">49</a> <a href="viewtopic.php?id=162768&amp;p=50">50</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=49">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1382715" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1176</span> <a href="viewtopic.php?pid=1382715#p1382715">2014-02-17 21:47:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for the info, it&#039;s doing exactly what it&#039;s supposed to...</p><div class="quotebox"><cite>Val532 wrote:</cite><blockquote><div><p>On my AsRock Z87 extrem 6 :<br />Without patch</p><div class="codebox"><pre><code>### Group 8 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d4) 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d4) 05:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 06:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03) 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)</code></pre></div></div></blockquote></div><p>I&#039;ve trimmed this down to just the problem caused by the PCH root ports</p><div class="quotebox"><blockquote><div><p>With old ACS patch :</p></div></blockquote></div><p>Doesn&#039;t matter, trimmed</p><div class="quotebox"><blockquote><div><p>Whit the new ACS patch : </p><div class="codebox"><pre><code>### Group 8 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) ### Group 9 ### 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d4) ### Group 10 ### 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) ### Group 11 ### 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d4) ### Group 14 ### 05:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) ### Group 15 ### 06:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03) ### Group 16 ### 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)</code></pre></div></div></blockquote></div><p>So all of the problems caused by lack of _PCH_ root more ACS are gone, the devices are properly separated.</p><div class="quotebox"><blockquote><div><p>On my GigaByte X58 .... :</p></div></blockquote></div><p>Doesn&#039;t matter, X58 is ICH, not PCH.</p><p>So you seem to be expecting this patch to address lack of ACS on every known Intel root port.&#160; As stated in the patch, this only supports PCH root ports.&#160; As of yet, I cannot confirm whether it&#039;s safe to use the ACS override patch on other root ports, but I will continue to push Intel for solutions.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382723" class="blockpost roweven"> <h2><span><span class="conr">#1177</span> <a href="viewtopic.php?pid=1382723#p1382723">2014-02-17 22:08:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Thanks for the info, it&#039;s doing exactly what it&#039;s supposed to...</p></div></blockquote></div><p>But no, or i do not understand, for the X58 ok it just for compare (and my report is not good).<br />When i use the new acs patch on my Z87 hardware my two VGA card are on the same iommu group ?!</p><div class="codebox"><pre><code>### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) 00:01.2 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller (rev 06) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770 GHz Edition] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Redwood PRO [Radeon HD 5550/5570/5630/6510/6610/7570] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Redwood HDMI Audio [Radeon HD 5000 Series]</code></pre></div><p>But why with the old patch i have that :</p><div class="codebox"><pre><code>### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) ### Group 2 ### 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) ### Group 3 ### 00:01.2 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller (rev 06) ### Group 9 ### 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 04) ### Group 10 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) ### Group 11 ### 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d4) ### Group 12 ### 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) ### Group 13 ### 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d4) ### Group 16 ### 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770 GHz Edition] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ### Group 17 ### 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Redwood PRO [Radeon HD 5550/5570/5630/6510/6610/7570] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Redwood HDMI Audio [Radeon HD 5000 Series]</code></pre></div><p>If i understand corectly, the root port on the CPU is to &quot;ACS&quot; enable ?</p> <p class="postedit"><em>Last edited by Val532 (2014-02-17 22:12:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382723">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382730" class="blockpost rowodd"> <h2><span><span class="conr">#1178</span> <a href="viewtopic.php?pid=1382730#p1382730">2014-02-17 22:22:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Val532 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Thanks for the info, it&#039;s doing exactly what it&#039;s supposed to...</p></div></blockquote></div><p>But no, or i do not understand, for the X58 ok it just for compare (and my report is not good).<br />When i use the new acs patch on my Z87 hardware my two VGA card are on the same iommu group ?!</p></div></blockquote></div><p>See this diagram:</p><p><span class="postimg"><img src="http://archive.benchmarkreviews.com/images/reviews/processor/4770K/intel_corei7_4770k_haswell_diagram.jpg" alt="Z87 chipset diagram" /></span></p><p>The line coming out of the top left of the processor goes to a set of boxes representing the possible root port configuration for processor-based root ports.&#160; You have the last option, which provides 3 slots, however those root ports are sourced from the processor, not the PCH, so are unaffected by this patch that&#039;s currently going upstream.</p><div class="quotebox"><blockquote><div><div class="codebox"><pre><code>### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) 00:01.2 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller (rev 06) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770 GHz Edition] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Redwood PRO [Radeon HD 5550/5570/5630/6510/6610/7570] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Redwood HDMI Audio [Radeon HD 5000 Series]</code></pre></div><p>But why with the old patch i have that :</p><div class="codebox"><pre><code>### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) ### Group 2 ### 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) ### Group 3 ### 00:01.2 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller (rev 06) ### Group 9 ### 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 04) ### Group 10 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) ### Group 11 ### 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d4) ### Group 12 ### 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) ### Group 13 ### 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d4) ### Group 16 ### 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770 GHz Edition] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ### Group 17 ### 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Redwood PRO [Radeon HD 5550/5570/5630/6510/6610/7570] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Redwood HDMI Audio [Radeon HD 5000 Series]</code></pre></div></div></blockquote></div><p>This is likely because you&#039;re using the &quot;downstream&quot; option of the patch.&#160; Regardless, we don&#039;t have confirmation from Intel that it&#039;s safe to do this for processor-based root ports or what configuration bits we can tweak to make it safe.&#160; So for the time being, we&#039;ve only been able to create a quirk for PCH-based root ports, which are the ones coming out of the top left box of the Z87 chipset box in the diagram above.&#160; Unfortunately, that&#039;s often where lower speed devices are attached, but it&#039;s all we&#039;ve got at the moment.&#160; You&#039;ll need to continue to use the ACS override patch and take the risk that there could be non-IOMMU translated DMA between devices.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382730">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382740" class="blockpost roweven"> <h2><span><span class="conr">#1179</span> <a href="viewtopic.php?pid=1382740#p1382740">2014-02-17 22:41:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This is likely because you&#039;re using the &quot;downstream&quot; option of the patch.&#160; Regardless, we don&#039;t have confirmation from Intel that it&#039;s safe to do this for processor-based root ports or what configuration bits we can tweak to make it safe.&#160; So for the time being, we&#039;ve only been able to create a quirk for PCH-based root ports, which are the ones coming out of the top left box of the Z87 chipset box in the diagram above.&#160; Unfortunately, that&#039;s often where lower speed devices are attached, but it&#039;s all we&#039;ve got at the moment.&#160; You&#039;ll need to continue to use the ACS override patch and take the risk that there could be non-IOMMU translated DMA between devices.</p></div></blockquote></div><p>Ok so for the moment i have to use the old patch not the new even if it&#039;s probably not a safe patch.</p><p>Ok ^^.</p><p>Are your planning to make an adition to the new patch ? That add the processor-based root ports a not safe patch but just for people like me with multiple VGA passthrough ^^.</p> <p class="postedit"><em>Last edited by Val532 (2014-02-17 22:46:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382744" class="blockpost rowodd"> <h2><span><span class="conr">#1180</span> <a href="viewtopic.php?pid=1382744#p1382744">2014-02-17 22:47:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Val532 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This is likely because you&#039;re using the &quot;downstream&quot; option of the patch.&#160; Regardless, we don&#039;t have confirmation from Intel that it&#039;s safe to do this for processor-based root ports or what configuration bits we can tweak to make it safe.&#160; So for the time being, we&#039;ve only been able to create a quirk for PCH-based root ports, which are the ones coming out of the top left box of the Z87 chipset box in the diagram above.&#160; Unfortunately, that&#039;s often where lower speed devices are attached, but it&#039;s all we&#039;ve got at the moment.&#160; You&#039;ll need to continue to use the ACS override patch and take the risk that there could be non-IOMMU translated DMA between devices.</p></div></blockquote></div><p>Ok so for the moment i have to use the old patch not the new because of probably not a safe patch.</p><p>Ok ^^.</p><p>Are your planning to make an adition to the new patch ? That add the processor-based root ports a not safe patch but just for people like me with multiple VGA passthrough ^^.</p></div></blockquote></div><p>No, I proposed the ACS override patch upstream and it was rejected for fear that it once again places a dangerous tool in the arsenal that users are quick to jump on for functionality without fully understanding the implications (as evidenced by this forum <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />).&#160; The kernel will only accept quirks that the vendors identify as safe.&#160; I expect that as a result of this, we&#039;ll see a resurgence of ACS support in Intel chipsets, but getting confirmation and code in place for existing devices is a tedious process.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382744">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382775" class="blockpost roweven"> <h2><span><span class="conr">#1181</span> <a href="viewtopic.php?pid=1382775#p1382775">2014-02-18 00:04:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>No, I proposed the ACS override patch upstream and it was rejected for fear that it once again places a dangerous tool in the arsenal that users are quick to jump on for functionality without fully understanding the implications (as evidenced by this forum <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />).&#160; The kernel will only accept quirks that the vendors identify as safe.&#160; I expect that as a result of this, we&#039;ll see a resurgence of ACS support in Intel chipsets, but getting confirmation and code in place for existing devices is a tedious process.</p></div></blockquote></div><p>Ok i understand, but it&#039;s a fun fonction ^^. I understand the acs is a tools that can make some problem for some people (like me ^^), but for the problem is just i was to fast and not completly read the comment in the patch ^^, so it&#039;s my fault.</p><p>For the moment the old acs is sufficient for the use of people like my (with multiple vga card and multiple guest ^^) but i think a proper implementation of the stuf in the i915 patch is needed, and probably the correction of some bug on iommu for intel (like the AsMedia or marvell sata controler and probably other). And by the way any news for this problem ?</p><p>Thanks for the time you spent to answering to me.</p><p>PS : If some body is intersted for a Mac OSX 10.x VM with VGA passthrough i can help to make this, because i have a &quot;working&quot; VM with Max OSX 10.8.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382775">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382802" class="blockpost rowodd"> <h2><span><span class="conr">#1182</span> <a href="viewtopic.php?pid=1382802#p1382802">2014-02-18 03:05:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone, I&#039;m trying to do this these days, finally works, only have one problem.<br />And...if this question unsuitable to post here, please help me to delete this reply.<br />Also, my English is bad, so apologize for my bad English.</p><p>Post my PC spec first:</p><p>CPU: Intel Core i7 3820<br />MB: ASUS Rampage IV Gene (Intel X79)<br />RAM: 4GB*2<br />VGA1: AMD Radeon R9 270 (Host)<br />VGA2: NVIDIA GeForce GTX770 (Guest)</p><p>But I&#039;m not use Archlinux to do this, I&#039;m using Ubuntu 12.04.4 x86_64.</p><p>And here is my installation steps</p><p>1.&#160; Install VFIO-patched kernel as module and iommu_vfio</p><p>1.1&#160; Add settings to kernel (CONFIG_VIFO*=y)</p><p>1.2&#160; Add &quot;intel_iommu=on&quot; and &quot;pci-stub.ids=(HID)&quot; into /etc/default/grub</p><p>1.3&#160; Set nouveau to blacklist</p><p>1.4. Add pci-stub to /etc/modules</p><p>When I finished in here, I checked dmesg, IOMMU and pci-stub is work.<br />Then.</p><p>2.&#160; Reboot. And make vfio-bind according from 1st post, copy to /usr/bin and set permission.</p><p>2.1&#160; Make service according from 1st post into /etc/systemd/system</p><p>2.2&#160; Put GTX770 pci number into /etc/vfio-pci.cfg</p><p>3.&#160; Reboot again, now bind GTX770 pci number into VFIO (need root)</p><p>4.&#160; Start VM with this command:</p><p># qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/home/ak74/test.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \<br />-drive file=/home/ak74/win7.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \</p><br /><p>Now a problem is, it can run without errors. But when I typed start command, it only shows</p><p>&quot;VNC server started at 127.0.0.1:5900&quot;</p><p>And didn&#039;t show any VNC screen, just like nothing happen.<br />But if I plug DVI cable on GTX770 it can shows VM screen (as I saw is WIndows 7 setup.)</p><p>After that, I installed TigerVNC and try to connect VM&#039;s VNC server, but when I connected, it only show QEMU command.</p><p>Maybe I&#039;ll try Archlinux to do this, but how can I use VNC to show GTX770&#039;s screen?<br />What step that I doing wrong or I forget to do?</p><p>Many thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382802">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382806" class="blockpost roweven"> <h2><span><span class="conr">#1183</span> <a href="viewtopic.php?pid=1382806#p1382806">2014-02-18 03:30:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p># qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/home/ak74/test.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \<br />-drive file=/home/ak74/win7.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \</p><br /><p>Now a problem is, it can run without errors. But when I typed start command, it only shows</p><p>&quot;VNC server started at 127.0.0.1:5900&quot;</p></div></blockquote></div><p>When using an assigned VGA, the VNC server doesn&#039;t have anything to connect to.&#160; You can use the -nographic option to prevent it from being started.&#160; If you need remote access to the accelerated desktop, you&#039;ll need to get it from inside the VM, just like you would if it was a separate physical system (ex. guest-based VNC server).</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382806">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382821" class="blockpost rowodd"> <h2><span><span class="conr">#1184</span> <a href="viewtopic.php?pid=1382821#p1382821">2014-02-18 05:16:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>When using an assigned VGA, the VNC server doesn&#039;t have anything to connect to.&#160; You can use the -nographic option to prevent it from being started.&#160; If you need remote access to the accelerated desktop, you&#039;ll need to get it from inside the VM, just like you would if it was a separate physical system (ex. guest-based VNC server).</p></div></blockquote></div><p>Thanks for your reply.</p><p>So let me make a example, if I want to install Windows first, I need to use virtual graphic at beginning<br />After that, install VNC server that support guest OS into Windows, then disable virtual VGA and virtual graphic, and connect to guest OS when VM is already get into Windows.</p><p>Will it work?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382821">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382824" class="blockpost roweven"> <h2><span><span class="conr">#1185</span> <a href="viewtopic.php?pid=1382824#p1382824">2014-02-18 05:30:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>When using an assigned VGA, the VNC server doesn&#039;t have anything to connect to.&#160; You can use the -nographic option to prevent it from being started.&#160; If you need remote access to the accelerated desktop, you&#039;ll need to get it from inside the VM, just like you would if it was a separate physical system (ex. guest-based VNC server).</p></div></blockquote></div><p>Thanks for your reply.</p><p>So let me make a example, if I want to install Windows first, I need to use virtual graphic at beginning<br />After that, install VNC server that support guest OS into Windows, then disable virtual VGA and virtual graphic, and connect to guest OS when VM is already get into Windows.</p><p>Will it work?</p></div></blockquote></div><p>Yes, if you can&#039;t use a physical monitor attached to the card, that&#039;s precisely what you&#039;ll need to do.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382824">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382892" class="blockpost rowodd"> <h2><span><span class="conr">#1186</span> <a href="viewtopic.php?pid=1382892#p1382892">2014-02-18 08:55:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Video passthrought had worked for me with reboot problem when I used pci-stub metod and started VM via virt-manager.</p><p>Reboot&#160; problem dissapeared&#160; for me when I used vfio method and started via console, but host intel graphics becomes spoiled.</p><p>After I had installed Radeon Driver it stopped working at all, and host begun to crash.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382892">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382897" class="blockpost roweven"> <h2><span><span class="conr">#1187</span> <a href="viewtopic.php?pid=1382897#p1382897">2014-02-18 09:25:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yes, if you can&#039;t use a physical monitor attached to the card, that&#039;s precisely what you&#039;ll need to do.</p></div></blockquote></div><p>Actually, I can. My monitor support HDMI and DVI, so I can use DVI to see GTX770&#039;s VM screen.<br />The problem is I can&#039;t assign my wireless keyboard and mouse into VM, even I assigned USB 2.0 controllor into VFIO.</p><p>Also I tried:</p><p>-usb -usbdevice host:046d:c534</p><p>but got error</p><p>qemu: could not add USB device &#039;host:046d:c534&#039;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382897">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382898" class="blockpost rowodd"> <h2><span><span class="conr">#1188</span> <a href="viewtopic.php?pid=1382898#p1382898">2014-02-18 09:28:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>Also I tried:</p><p>-usb -usbdevice host:046d:c534</p><p>but got error</p><p>qemu: could not add USB device &#039;host:046d:c534&#039;</p></div></blockquote></div><p>You need to prefix them with 0x (those numbers are in hexadecimal).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382908" class="blockpost roweven"> <h2><span><span class="conr">#1189</span> <a href="viewtopic.php?pid=1382908#p1382908">2014-02-18 10:30:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>What is the cause of this crash ?</p><p>[&#160; &#160; 0.387396] ------------[ cut here ]------------<br />[&#160; &#160; 0.387401] WARNING: CPU: 0 PID: 1 at drivers/pci/search.c:46 pci_find_upstream_pcie_bridge+0x77/0x90()<br />[&#160; &#160; 0.387402] Modules linked in:<br />[&#160; &#160; 0.387405] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.13.0-1-mainline #1<br />[&#160; &#160; 0.387406] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./Z77 Professional, BIOS P1.70B 11/12/2013<br />[&#160; &#160; 0.387407]&#160; 0000000000000009 ffff880803469d20 ffffffff814f5cc4 0000000000000000<br />[&#160; &#160; 0.387410]&#160; ffff880803469d58 ffffffff81061abd ffff8808032b3098 ffff8808032b3000<br />[&#160; &#160; 0.387412]&#160; ffff8808032b3098 0000000000000000 ffff88080e8097e0 ffff880803469d68<br />[&#160; &#160; 0.387413] Call Trace:<br />[&#160; &#160; 0.387418]&#160; [&lt;ffffffff814f5cc4&gt;] dump_stack+0x4d/0x6f<br />[&#160; &#160; 0.387422]&#160; [&lt;ffffffff81061abd&gt;] warn_slowpath_common+0x7d/0xa0<br />[&#160; &#160; 0.387424]&#160; [&lt;ffffffff81061b9a&gt;] warn_slowpath_null+0x1a/0x20<br />[&#160; &#160; 0.387426]&#160; [&lt;ffffffff812c9c07&gt;] pci_find_upstream_pcie_bridge+0x77/0x90<br />[&#160; &#160; 0.387429]&#160; [&lt;ffffffff813e429d&gt;] intel_iommu_add_device+0x4d/0x220<br />[&#160; &#160; 0.387431]&#160; [&lt;ffffffff813da620&gt;] ? bus_set_iommu+0x50/0x50<br />[&#160; &#160; 0.387433]&#160; [&lt;ffffffff813da64a&gt;] add_iommu_group+0x2a/0x50<br />[&#160; &#160; 0.387436]&#160; [&lt;ffffffff8138c633&gt;] bus_for_each_dev+0x63/0xa0<br />[&#160; &#160; 0.387438]&#160; [&lt;ffffffff813da618&gt;] bus_set_iommu+0x48/0x50<br />[&#160; &#160; 0.387441]&#160; [&lt;ffffffff8192d0cb&gt;] intel_iommu_init+0xaad/0xba2<br />[&#160; &#160; 0.387443]&#160; [&lt;ffffffff81052355&gt;] ? free_init_pages+0x75/0xa0<br />[&#160; &#160; 0.387446]&#160; [&lt;ffffffff818e61c5&gt;] ? maybe_link.part.1+0x10e/0x10e<br />[&#160; &#160; 0.387449]&#160; [&lt;ffffffff818eed6a&gt;] ? memblock_find_dma_reserve+0x124/0x124<br />[&#160; &#160; 0.387451]&#160; [&lt;ffffffff818eed7c&gt;] pci_iommu_init+0x12/0x3c<br />[&#160; &#160; 0.387453]&#160; [&lt;ffffffff8100214a&gt;] do_one_initcall+0xfa/0x1b0<br />[&#160; &#160; 0.387456]&#160; [&lt;ffffffff810818b5&gt;] ? parse_args+0x225/0x3f0<br />[&#160; &#160; 0.387459]&#160; [&lt;ffffffff818e50da&gt;] kernel_init_freeable+0x17b/0x200<br />[&#160; &#160; 0.387461]&#160; [&lt;ffffffff818e48d0&gt;] ? do_early_param+0x88/0x88<br />[&#160; &#160; 0.387464]&#160; [&lt;ffffffff814e8bf0&gt;] ? rest_init+0x90/0x90<br />[&#160; &#160; 0.387466]&#160; [&lt;ffffffff814e8bfe&gt;] kernel_init+0xe/0x130<br />[&#160; &#160; 0.387467]&#160; [&lt;ffffffff8150407c&gt;] ret_from_fork+0x7c/0xb0<br />[&#160; &#160; 0.387469]&#160; [&lt;ffffffff814e8bf0&gt;] ? rest_init+0x90/0x90<br />[&#160; &#160; 0.387474] ---[ end trace a2c46857dc8df419 ]---</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382908">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382925" class="blockpost rowodd"> <h2><span><span class="conr">#1190</span> <a href="viewtopic.php?pid=1382925#p1382925">2014-02-18 12:12:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zzz3000 wrote:</cite><blockquote><div><p>Video passthrought had worked for me with reboot problem when I used pci-stub metod and started VM via virt-manager.</p><p>Reboot&#160; problem dissapeared&#160; for me when I used vfio method and started via console, but host intel graphics becomes spoiled.</p><p>After I had installed Radeon Driver it stopped working at all, and host begun to crash.</p></div></blockquote></div><p>You&#039;ll probably need to use the i915 patch</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382925">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1382995" class="blockpost roweven"> <h2><span><span class="conr">#1191</span> <a href="viewtopic.php?pid=1382995#p1382995">2014-02-18 16:05:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><p>What is the cause of this crash ?</p><p>[&#160; &#160; 0.387396] ------------[ cut here ]------------<br />[&#160; &#160; 0.387401] WARNING: CPU: 0 PID: 1 at drivers/pci/search.c:46 pci_find_upstream_pcie_bridge+0x77/0x90()</p></div></blockquote></div><p>A trivial search would find <a href="https://bugzilla.kernel.org/show_bug.cgi?id=44881" rel="nofollow">https://bugzilla.kernel.org/show_bug.cgi?id=44881</a></p><p>The short answer is broken hardware.&#160; A number of PCIe-to-PCI bridges do not include a PCIe capability, in direct violation of the PCIe spec, confusing the code that tries to find the upstream PCIe bridge and suddenly finds itself on a non-bridge PCIe device.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1382995">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383019" class="blockpost rowodd"> <h2><span><span class="conr">#1192</span> <a href="viewtopic.php?pid=1383019#p1383019">2014-02-18 16:57:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks.</p><p>Is it possible to find the device which causes the crash in order to disable it ?</p><div class="codebox"><pre class="vscroll"><code>00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller (rev 09) 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200/2nd Generation Core Processor Family PCI Express Root Port (rev 09) 00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller (rev 09) 00:14.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller (rev 04) 00:16.0 Communication controller: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 (rev 04) 00:1a.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 (rev 04) 00:1b.0 Audio device: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller (rev 04) 00:1c.0 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 (rev c4) 00:1c.7 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 8 (rev c4) 00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 (rev 04) 00:1f.0 ISA bridge: Intel Corporation Z77 Express Chipset LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Bonaire XT [Radeon HD 7790/8770] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Device 0002 02:00.0 SCSI storage controller: LSI Logic / Symbios Logic SAS1068E PCI-Express Fusion-MPT SAS (rev 08) 03:00.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:01.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:04.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:05.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:06.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:07.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:08.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 04:09.0 PCI bridge: PLX Technology, Inc. PEX 8608 8-lane, 8-Port PCI Express Gen 2 (5.0 GT/s) Switch (rev ba) 05:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 06:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 01) 08:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 09:00.0 Ethernet controller: Broadcom Corporation NetLink BCM57781 Gigabit Ethernet PCIe (rev 10) 0a:00.0 USB controller: Etron Technology, Inc. EJ188/EJ198 USB 3.0 Host Controller 0b:00.0 Ethernet controller: Broadcom Corporation NetLink BCM57781 Gigabit Ethernet PCIe (rev 10) 0c:00.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6315 Series Firewire Controller 0c:00.1 IDE interface: VIA Technologies, Inc. VT6415 PATA IDE Host Controller (rev a0)</code></pre></div><div class="codebox"><pre><code>-[0000:00]-+-00.0 Intel Corporation 2nd Generation Core Processor Family DRAM Controller +-01.0-[01]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Bonaire XT [Radeon HD 7790/8770] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Device 0002 +-02.0 Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller +-14.0 Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller +-16.0 Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 +-1a.0 Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 +-1b.0 Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller +-1c.0-[02]----00.0 LSI Logic / Symbios Logic SAS1068E PCI-Express Fusion-MPT SAS +-1c.7-[03-0c]----00.0-[04-0c]--+-01.0-[05]----00.0 ASMedia Technology Inc. ASM1062 Serial ATA Controller | +-04.0-[06-07]----00.0-[07]-- | +-05.0-[08]----00.0 ASMedia Technology Inc. ASM1062 Serial ATA Controller | +-06.0-[09]----00.0 Broadcom Corporation NetLink BCM57781 Gigabit Ethernet PCIe | +-07.0-[0a]----00.0 Etron Technology, Inc. EJ188/EJ198 USB 3.0 Host Controller | +-08.0-[0b]----00.0 Broadcom Corporation NetLink BCM57781 Gigabit Ethernet PCIe | \-09.0-[0c]--+-00.0 VIA Technologies, Inc. VT6315 Series Firewire Controller | \-00.1 VIA Technologies, Inc. VT6415 PATA IDE Host Controller +-1d.0 Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 +-1f.0 Intel Corporation Z77 Express Chipset LPC Controller +-1f.2 Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] \-1f.3 Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383019">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383025" class="blockpost roweven"> <h2><span><span class="conr">#1193</span> <a href="viewtopic.php?pid=1383025#p1383025">2014-02-18 17:04:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><p>Thanks.</p><p>Is it possible to find the device which causes the crash in order to disable it ?</p></div></blockquote></div><p>Probably not unless you&#039;re very good with a soldering iron.</p><div class="quotebox"><blockquote><div><div class="codebox"><pre><code>06:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 01)</code></pre></div></div></blockquote></div><p>This is a known offender.</p><div class="quotebox"><blockquote><div><div class="codebox"><pre><code> | +-04.0-[06-07]----00.0-[07]--</code></pre></div></div></blockquote></div><p>You don&#039;t have anything behind it anyway, so can&#039;t you ignore it?&#160; It&#039;s not actually a kernel crash, it&#039;s just a warning and stack trace.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383025">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383040" class="blockpost rowodd"> <h2><span><span class="conr">#1194</span> <a href="viewtopic.php?pid=1383040#p1383040">2014-02-18 18:30:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Borderlands folks, I think this is the problem you&#039;re trying to describe:</p><p><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/19831938/borderlands2-baremetal.jpg" alt="Bare Metal" /></span></p><p><span class="postimg"><img src="https://dl.dropboxusercontent.com/u/19831938/borderlands2-vm.jpg" alt="VM" /></span></p><p>This vantage point in the training area seems to give me a consistently low FPS and high latency and seems invariant to the lighting.&#160; The VM shows about 1/3rd the FPS and 3x the latency.&#160; What is that latency actually measuring anyway?&#160; These are separate win7x64 installs on the same Haswell/GTX660 hardware with Nvidia Experience optimizing the game in both (highest settings for all).</p><p>I don&#039;t have any solutions yet, but it&#039;s good to understand the problem.&#160; I did run the VM with vfio debugging turned on and I&#039;m not seeing any excessive hits to the card, which means we&#039;re not bouncing out to userspace regularly as a result of the assigned devices (GPU + audio + NIC in this case).&#160; I see a write to 0x88154 at a rate of about 10/s.&#160; This is an area we must trap because it&#039;s an mmio mirror of PCI config space.&#160; That happens regardless of what&#039;s going on in the game and also happens at a basic desktop, so if it was causing any trouble I&#039;d expect it would be across the board and not select games.</p><p>I&#039;m suspicious of USB passthrough, but my only evidence is that hitting the escape key in the game is not as responsive as bare metal and often requires a second hit.&#160; Assignment of the USB controller might be an option, but didn&#039;t just work in my first attempt, maybe an issue with windows drivers.</p><p>EDIT: game reported latency appears to just be the inverse of FPS, so it&#039;s SPF (seconds per frame)</p><p>EDIT2: Further analysis (special thanks to Paolo Bonzini) shows two issues that are hurting performance here.&#160; First is a known issue with Windows that it pounds on the time source, whether it&#039;s ACPI PM timer or HPET.&#160; Code just recently went upstream (kernel and qemu) that enables a Hyper-V enlightened timer that can help to reduce this.&#160; To enable it add &quot;hv-time&quot; to your -cpu option, ex. -cpu Haswell,hv-time&#160; This gives me about 20% more FPS and is likely to help performance of any game running in a Windows guest.&#160; The second problem is that we see extensive use of the processor debug registers.&#160; Each move to or from these registers traps into the hypvervisor and they appear to be batched into a context switch function, so we have a burst of them all at once.&#160; I&#039;ve submitted a support ticket to gearbox software to see if they have any suggestions to avoid these registers.</p> <p class="postedit"><em>Last edited by aw (2014-02-19 17:23:21)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383040">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383043" class="blockpost roweven"> <h2><span><span class="conr">#1195</span> <a href="viewtopic.php?pid=1383043#p1383043">2014-02-18 18:41:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79595">peedeeX21</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79595">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hi ppl,</p><p>tying to set up a virual machine and passing throug my gt610m.</p><p>CPU: Intel Core i5 3317<br />RAM: 4GB*2<br />VGA1: Intel HD4000<br />VGA2: Nvidia GeForce GT 610M<br />OS: Linux Mint 16</p><p>I set up everything like GizmoChicken <a href="https://bbs.archlinux.org/viewtopic.php?pid=1313007#p1313007" rel="nofollow">posted</a>.</p><p>I am using a Kernel build with the options: </p><div class="codebox"><pre><code>CONFIG_VFIO_IOMMU_TYPE1=y CONFIG_VFIO=y CONFIG_VFIO_PCI=y CONFIG_VFIO_PCI_VGA=y CONFIG_INTEL_IOMMU_DEFAULT_ON=y</code></pre></div><p>(stock kernel 1.11.0-12 does also not work...)</p><p>The problem ist now, that here are no iommu_group links in /sys/bus/pci/devices/xxxx:xx:xx.x.</p><p>Things i did / checked:</p><ul><li><p>In BIOS the Intel Virtualisation Technology is enable</p></li><li><p>intel_iommu=1 is set in /etc/default/grub</p></li><li><div class="codebox"><pre><code>echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/vfio_iommu_type1.conf</code></pre></div></li></ul><p>Has anybody an idea why this links are missing? thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383043">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383072" class="blockpost rowodd"> <h2><span><span class="conr">#1196</span> <a href="viewtopic.php?pid=1383072#p1383072">2014-02-18 20:26:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>What motherboard are you using?&#160; Intel Virtualization technology just means Vt-x not Vt-d.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383072">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383085" class="blockpost roweven"> <h2><span><span class="conr">#1197</span> <a href="viewtopic.php?pid=1383085#p1383085">2014-02-18 21:20:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79595">peedeeX21</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79595">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>What motherboard are you using?&#160; Intel Virtualization technology just means Vt-x not Vt-d.</p></div></blockquote></div><p>oh... i missed that. i got a Lenovo motherboard with Mobile Intel HM77 Express Chipset on it, which does not support vt-d.</p><p>thanks for your support.</p><p>EDIT:</p><p>but how is it possible </p><div class="codebox"><pre><code> dmesg | grep IOMMU </code></pre></div><p> tells me </p><div class="codebox"><pre><code> Intel-IOMMU: enabled </code></pre></div><p>?</p> <p class="postedit"><em>Last edited by peedeeX21 (2014-02-18 21:25:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383085">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383100" class="blockpost rowodd"> <h2><span><span class="conr">#1198</span> <a href="viewtopic.php?pid=1383100#p1383100">2014-02-18 21:48:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I believe that is the kernel acknowledging your intel_iommu=on</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383100">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383162" class="blockpost roweven"> <h2><span><span class="conr">#1199</span> <a href="viewtopic.php?pid=1383162#p1383162">2014-02-19 01:30:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After some test, now I can use this VM functionally.</p><p>I tried to use TigerVNC server, but I don&#039;t know why if it set to service mode, client application can&#039;t connect.<br />And use user-mode server, it can connect, but after less 10 sec, server will get crashes.</p><p>Finally, I use TeamViewer to my temporary VNC. Looks like plug another monitor is the best choice, or does it have better solutions to this?</p><br /><p>Also, sound is another problem, too.<br />I don&#039;t know why my QEMU doesn&#039;t have ALSA or pa.<br />When I type -audio-help, it only shows oss and wav. And oss can&#039;t use.<br />How can I find other modules and how to install it?</p><br /><p>Sorry for my &#039;newbie&#039; questions.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383162">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1383560" class="blockpost rowodd"> <h2><span><span class="conr">#1200</span> <a href="viewtopic.php?pid=1383560#p1383560">2014-02-20 06:01:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just installed a second of the same video card (to forward to the same VM), and no matter what I try, qemu always aborts with an assertion failure.</p><br /><p>With EFI and piix4 (since EFI has never worked with q35):</p><div class="codebox"><pre><code>ASSERT /home/dana/Downloads/edk2/PcAtChipsetPkg/PciHostBridgeDxe/PciHostBridge.c(394): ((BOOLEAN)(0==1))</code></pre></div><p>With BIOS mode and q35, I&#039;ve tried the same settings that somewhat work with a single card:</p><div class="codebox"><pre><code>qemu-system-x86_64: hw/pci/pci.c:232: pcibus_reset: Assertion `bus-&gt;irq_count[i] == 0&#039; failed.</code></pre></div><p>With a single video card, I still get this assertion failure, but only when I try to disable the Radeon in Device Manager.</p><p>I&#039;d love to get the second video card working, but that&#039;s not possible, I&#039;ll have to return it.</p><p>EDIT: Hmm, after some more wrestling, I may have gotten it working.&#160; Anyway, the &quot;irq count&quot; assertion seems like there must be some broken logic somewhere.</p><p>Last edit for the night: I got it to actually, totally, work (aside from likely crashing if I disable a device).&#160; I had to make sure both video cards had the dual-ROM switch set to the GOP mode.&#160; It would still be good to get that assertion fixed, though.</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-02-20 07:19:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383560">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=47">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=46">46</a> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <strong>48</strong> <a href="viewtopic.php?id=162768&amp;p=49">49</a> <a href="viewtopic.php?id=162768&amp;p=50">50</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=49">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
