<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 83) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=83" title="Page 83" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=82" title="Page 82" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=84" title="Page 84" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=82">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=81">81</a> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <strong>83</strong> <a href="viewtopic.php?id=162768&amp;p=84">84</a> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=84">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1424516" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2051</span> <a href="viewtopic.php?pid=1424516#p1424516">2014-06-11 01:33:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Apart from that benchmark I linked to before, just for fun (I&#039;ve always wanted to know the below) I added in an OpenGL windows vs OpenGL linux benchmark against DirectX11 on Unigine, I will blame Unigine for having poorly optimized OpenGL code though ad the max FPS difference on windows was roughly 20 FPS between DX11 and OpenGL. (Writing OpenGL is no joke, I&#039;m not surprised) I wanted to test the mettle of Windows vs Linux nvidia proprietary drivers in OpenGL performance matching the settings as closely as I could, as it turns out the performance was significantly better on Linux than in Windows (unsurprising as OpenGL should be the main focus of the linux drivers whereas DX should be the main focus of the windows drivers) anyways, here we go (All running on the x16 bus)</p><p><strong>Linux (3.14.5) driver version: 337.25</strong><br /><strong>Windows (7 x64) driver version: 337.88</strong><br /><strong>Unigine Heaven Settings: Extreme @1920x1080 Fullscreen</strong></p><p>Note that while launching Unigine from a terminal in linux spat out for me the OpenGL version (3.2) I have no such output in windows, so I am only assuming windows uses 3.2 as well. I might be wrong however and it might be using 2.0 which would explain the (dramatic) performance differences between windows and linux when using OpenGL. Also note that they claim on the official website to be using 4.0</p><p><strong>Nvidia GTX-670 Linux (OpenGL 3.2)</strong></p><div class="codebox"><pre><code>Min FPS:12.1 Max FPS:65.5 FPS:24.9 Score:627</code></pre></div><p><strong>Nvidia GTX-670 Windows (OpenGL 3.2)</strong></p><div class="codebox"><pre><code>Min FPS:6.2 Max FPS:51.6 FPS:20.6 Score:518</code></pre></div><p><strong>Nvidia GTX-670 Windows (DirectX11)</strong></p><div class="codebox"><pre><code>Min FPS:17.1 Max FPS:69.2 FPS:32.0 Score:807</code></pre></div><p>It is worth noting that for the above scores on Linux I disabled flipping in the nvidia drivers. I ran it first with flipping enabled but this resulted in some ugly (what appeared to be) delayed frames which was literally driving me nuts, there was very minimal performance difference with flipping disabled/enabled however as the score and avg FPS were the exact same. (Min and Max FPS differed only slightly as max was 66.4 and min was 6.9 with flipping enabled) however take this as a tip from me to keep flipping disabled on Linux <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>It is also worth noting that the above benchmarks are probably not good DirectX vs OpenGL benchmarks since there is no telling which code was more optimized in Unigine Heaven (but by the looks of it DX11 was better optimized than OpenGL) Unigine also only seems to use OpenGL 3.2 rather than 4.4 or similar (I assume this was done so it could work on Mac as well but naturally the performance of GL will take a hit from this)</p><p>Hopefully I can later add to that the performance of the 670 as it&#039;s been passed through to windows rather than from a windows boot.</p><br /><p><strong>Update</strong>: <br />GTX 550-Ti results, these were done on the x4 bus but the performance difference between x4 and x16 on this card was so trivial it doesn&#039;t really matter (might be like 1FPS difference tops compared to x16)</p><p><strong>Unigine Settings: Basic @1920x1080 Fullscreen</strong></p><p><strong>GTX 550-Ti Linux (OpenGL 3.2)</strong></p><div class="codebox"><pre><code>FPS:21.0 Score:530 Min FPS:8.7 Max FPS:34.6</code></pre></div><p><strong>GTX 550-Ti Windows (OpenGL 3.2)</strong></p><div class="codebox"><pre><code>FPS:13.9 Score:351 Min FPS:6.4 Max FPS:29.1</code></pre></div><p><strong>GTX 550-Ti Windows (DirectX 11)</strong></p><div class="codebox"><pre><code>FPS:21.2 Score:534 Min FPS:9.8 Max FPS:37.8</code></pre></div><p>What shocked me with these results is that the Linux OpenGL benchmark was actually on par with the DX11 benchmark, I was doing these tests (a few comments below) because I had a suspicion everything wasn&#039;t all right in linux on the x4 bus (i.e. I was getting strangely mismatching results between x16 and x4 on there) but that seems to have been little more than a fluke because I was after all running this benchmark with settings way beyond the capabilities of this card (which is how I ended up trying settings the card could actually handle).</p><p>The fact that it matched up to DX11 was more than enough to convince me that everything is in fact performing outstandingly well in Linux and I was just worrying over nothing (like I said, a fluke).</p><p>It is also interesting to note that on Windows (in both benchmarks) the card would run at 72°C but on Linux the heat would never exceed 60°C. (Meaning it was performing on par with DX11 at lower temperatures)</p><p>There are only two reasons I can think of for why OpenGL performed on par with DX11 in this test and why it didn&#039;t in the 670 test.</p><p>1: The Fermi architecture works better for the Nvidia proprietary drivers on Linux (I find this highly unlikely though as when Nvidia started working at it&#039;s hardest ever on the linux drivers, the Kepler architecture which the 600 and 700 series use was already out)<br />2: OpenGL 3.2 is on par with DX11 in most areas excluding Tessellation which is disabled when the Basic preset is used (This is much likelier)</p> <p class="postedit"><em>Last edited by rabcor (2014-06-11 14:46:27)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424523" class="blockpost roweven"> <h2><span><span class="conr">#2052</span> <a href="viewtopic.php?pid=1424523#p1424523">2014-06-11 02:08:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Follow up on that, I have not yet tried to pass through the primary card to a virtual machine (it wil be fun to see what happens) but I did decide that no one was giving me a proper answer for my case (outdated benchmarks and whatnot) so I simply tried running a benchmark myself. <a href="http://superuser.com/a/767176/290082" rel="nofollow">These are the results</a>. I imagine that the less bandwidth your card is capable of using (for example the <a href="http://www.geforce.com/hardware/desktop-gpus/geforce-gtx-670/specifications" rel="nofollow">670 has 192.2GB/s bandwidth</a>) the less noticable the difference will be, where the difference starts to be noticable remains to be seen though.</p></div></blockquote></div><p>I&#039;m not sure I agree with your hypothesis that installing the card on a x4 electrical slot gives you more overclocking headroom.&#160; I think it shows that that particular test was bus limited and the GPU was data starved and scaling back frequency.&#160; Overclocking the GPU isn&#039;t likely to equalize the difference and a GPU-bound workload is still likely to generate the same heat load.&#160; Also, a GTX670 does have a PCIe 3.0 interface (<a href="http://www.geforce.com/hardware/desktop-gpus/geforce-gtx-670/specifications" rel="nofollow">http://www.geforce.com/hardware/desktop … ifications</a>), so if you&#039;re limited to PCIe 2.0, it&#039;s because of your motherboard/processor combination.</p><p>EDIT: ark confirms your i7-2600 only supports PCIe 2.0, I didn&#039;t see your motherboard specs in the post history to lookup those specs though</p> <p class="postedit"><em>Last edited by aw (2014-06-11 02:15:15)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424523">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424528" class="blockpost rowodd"> <h2><span><span class="conr">#2053</span> <a href="viewtopic.php?pid=1424528#p1424528">2014-06-11 02:33:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have an i7-2600 so I guess that&#039;s why. I slightly modified that answer to clarify that the overclocking thing was just me guessing. (Thanks for looking into this for me btw)</p><p>I have <a href="https://www.asus.com/Motherboards/P8Z77V_LX/specifications/" rel="nofollow">this board</a> really though I just saw it said &quot;PCI Express 3.0&quot; on the board which was how I found out.</p><p>It&#039;s a shame that my CPU doesn&#039;t support pci-express 3.0 &gt;_&lt; god damn that pisses me off considering I would get a lot better performance out of that I think (which would further increase my need to use the primary slot)</p><p>As an update on my progress with using the primary card.</p><p>Running pci-stub on it works BUT after booting the console will use the stubbed card as it is in the primary slot and what GRUB used. To force X to ignore the card I had to add this to a file in xorg.conf.d/</p><div class="codebox"><pre><code>Section &quot;Device&quot; Identifier &quot;Device0&quot; Driver &quot;nvidia&quot; VendorName &quot;NVIDIA Corporation&quot; BoardName &quot;GeForce GTX 550 Ti&quot; BusID &quot;PCI:2:0:0&quot; EndSection</code></pre></div><p>I am pretty sure only the &quot;Identifier&quot; &quot;Driver&quot; and &quot;BusID&quot; values are important but I kept the others just for show. This will make the nvidia drivers in X think that the 550-Ti on bus 2:0:0 is my primary card, however when I try to start X with the 670 stubbed currently everything will freeze up. The things I&#039;ll try to do to fix this is to install that VGA_ARB patch for the nvidia drivers first, if that&#039;s a no go I will enable ACS Override and if that&#039;s a no go I&#039;m running short on ideas.</p> <p class="postedit"><em>Last edited by rabcor (2014-06-11 02:38:22)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424528">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424530" class="blockpost roweven"> <h2><span><span class="conr">#2054</span> <a href="viewtopic.php?pid=1424530#p1424530">2014-06-11 02:43:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82616">apporc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:appleorchard2000@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, siddharta.<br />To be clear, below is my information:<br />os: Linux Mint 17<br />Kernel: 3.15 (with no patches, no i915, no acs_override.) Link: <a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v3.15-rc8-utopic/" rel="nofollow">http://kernel.ubuntu.com/~kernel-ppa/ma … c8-utopic/</a><br />Qemu: 2.0.0<br />libvirt: 1.2.2</p><p>CPU: Intel(R) Core(TM) i7-4770<br />GPU: radeon 7870<br />Motherboard: Asus Z87K</p><p>If your hardware is different from mine, it may be the reason why it don&#039;t work.<br />Use the software and hardware above, i almost did nothing, and it just worked.<br />I used to use pci_stub or radeon blacklist, vfio_bind and config .xml manually like this:</p><div class="codebox"><pre><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.0&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;qemu:arg value=&#039;-bios&#039;/&gt; &lt;qemu:arg value=&#039;/usr/share/qemu/bios.bin&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>But now all of above turned out to be not necessary. <br />The kernel/qemu i used now is all from linux mint&#039; repository, with no patch.<br />I cleared the pci_stub in my kernel command line, just left &quot;intel_iommu=on&quot;.<br />I unblacklisted radeon and fglrx in my /etc/modprobe.d/blacklist.conf.<br />And i didn&#039;t vfio_bind the radeon card on boot, i just removed /etc/init/vfio-bind.conf which i used at first:</p><div class="codebox"><pre><code># vfio-bind - Binds devices to vfio-pci # description &quot;vfio binding devices&quot; start on runlevel [2345] stop on runlevel [!2345] exec /usr/local/bin/vfio-bind 0000:04:00.0 0000:04:00.1</code></pre></div><p>The configuration i am still using is :</p><div class="codebox"><pre><code>echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/vfio_iommu_type1.conf echo &quot;options kvm ignore_msrs=1&quot; &gt;&gt; /etc/modprobe.d/kvm.conf #/etc/libvirt/qemu.conf, add: user = &quot;root&quot; group = &quot;root&quot; clear_emulator_capabilities = 0 ls -1 /dev/vfio #For ever number that appears, ensure its full path appears in the cgroup_device_acl configuration parameter. For example, mine looks like so: cgroup_device_acl = [ &quot;/dev/null&quot;, &quot;/dev/full&quot;, &quot;/dev/zero&quot;, &quot;/dev/random&quot;, &quot;/dev/urandom&quot;, &quot;/dev/ptmx&quot;, &quot;/dev/kvm&quot;, &quot;/dev/kqemu&quot;, &quot;/dev/rtc&quot;,&quot;/dev/hpet&quot;, &quot;/dev/vfio/vfio&quot;, &quot;/dev/vfio/8&quot; ]</code></pre></div><br /><p>After above, I just used virt-manager to create my win7 vm. I totally use virt-manager to add vga card and usb device to my vm.<br />Here is my xml:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; id=&#039;2&#039;&gt; &lt;name&gt;win7&lt;/name&gt; &lt;uuid&gt;6cb6904a-ff53-6038-8718-c82a39eeab19&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.0&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;bootmenu enable=&#039;no&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;2&#039; threads=&#039;2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;abm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdpe1gb&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;rdrand&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;f16c&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/kvm&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win7.img&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;alias name=&#039;virtio-disk0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/apporc/Software/ISO/virtio-win-0.1-65.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;alias name=&#039;ide0-1-0&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;&gt; &lt;alias name=&#039;pci.0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;pci-bridge&#039;&gt; &lt;alias name=&#039;pci.1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt; &lt;alias name=&#039;pci.2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;ide0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:5a:a6:ef&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;target dev=&#039;vnet0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;alias name=&#039;net0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; port=&#039;5900&#039; autoport=&#039;yes&#039; listen=&#039;127.0.0.1&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;127.0.0.1&#039;/&gt; &lt;/graphics&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;alias name=&#039;sound0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; heads=&#039;1&#039;/&gt; &lt;alias name=&#039;video0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x04&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x04&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x17ef&#039;/&gt; &lt;product id=&#039;0x6047&#039;/&gt; &lt;address bus=&#039;3&#039; device=&#039;4&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev3&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;alias name=&#039;balloon0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;none&#039;/&gt; &lt;/domain&gt;</code></pre></div><p>The method virt-manager uses is now vfio_pci too, not pci_assign.</p><p>Here is another link i used to refer to: <a href="http://www.firewing1.com/howtos/fedora-20/create-gaming-virtual-machine-using-vfio-pci-passthrough-kvm" rel="nofollow">http://www.firewing1.com/howtos/fedora- … hrough-kvm</a>.</p><p>Good luck!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424530">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424531" class="blockpost rowodd"> <h2><span><span class="conr">#2055</span> <a href="viewtopic.php?pid=1424531#p1424531">2014-06-11 02:46:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I have an i7-2600 so I guess that&#039;s why. I slightly modified that answer to clarify that the overclocking thing was just me guessing. (Thanks for looking into this for me btw)</p><p>I have <a href="https://www.asus.com/Motherboards/P8Z77V_LX/specifications/" rel="nofollow">this board</a> really though I just saw it said &quot;PCI Express 3.0&quot; on the board which was how I found out.</p><p>It&#039;s a shame that my CPU doesn&#039;t support pci-express 3.0 &gt;_&lt; god damn that pisses me off considering I would get a lot better performance out of that I think (which would further increase my need to use the primary slot)</p></div></blockquote></div><p>Z77 only supports PCIe 2.0 as well - <a href="http://ark.intel.com/products/64024/Intel-BD82Z77-PCH" rel="nofollow">http://ark.intel.com/products/64024/Intel-BD82Z77-PCH</a></p><p>I think the PCIe 3.0/2.0 reference in the motherboard spec is referring the the PEG express slot, ie. the one hosted from the CPU.&#160; So if you were to install a 3rd gen Core processor, you&#039;d have PCIe 3.0 for that one slot.</p><div class="quotebox"><blockquote><div><p>As an update on my progress with using the primary card.</p><p>Running pci-stub on it works BUT after booting the console will use the stubbed card as it is in the primary slot and what GRUB used. To force X to ignore the card I had to add this to a file in xorg.conf.d/</p><div class="codebox"><pre><code>Section &quot;Device&quot; Identifier &quot;Device0&quot; Driver &quot;nvidia&quot; VendorName &quot;NVIDIA Corporation&quot; BoardName &quot;GeForce GTX 550 Ti&quot; BusID &quot;PCI:2:0:0&quot; EndSection</code></pre></div></div></blockquote></div><p>I think requiring BusID is pretty standard for NVIDIA anytime you stray from a standard config.</p><div class="quotebox"><blockquote><div><p>I am pretty sure only the &quot;Identifier&quot; &quot;Driver&quot; and &quot;BusID&quot; values are important but I kept the others just for show. This will make the nvidia drivers in X think that the 550-Ti on bus 2:0:0 is my primary card, however when I try to start X with the 670 stubbed currently everything will freeze up. The things I&#039;ll try to do to fix this is to install that VGA_ARB patch for the nvidia drivers first, if that&#039;s a no go I will enable ACS Override and if that&#039;s a no go too I will start looking into third party solutions (like vgacon)</p></div></blockquote></div><p>The host doesn&#039;t care about ACS stuff, so that&#039;s surely not going to do anything.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424531">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424533" class="blockpost roweven"> <h2><span><span class="conr">#2056</span> <a href="viewtopic.php?pid=1424533#p1424533">2014-06-11 03:06:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82616">apporc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-09</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:appleorchard2000@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>About the noise of my Radeon 7870 card. It is really very loud.<br />Before i tried the guide of this thread, i used fglrx driver, and Radeon 7870 card didn&#039;t make noise.<br />I know if i used radeon driver, the noise will be there. Maybe just as they said, radeon driver doesn&#039;t handle the frequency well.</p><p>But after pci-stub, why Radeon 7870 is still noisy. I thought when Radeon is got stubed, nobody is using it, and nobody using it should lead to &quot;no noise&quot;.<br />Surpringly it&#039;s not. No mater i blacklist radeon/fglrx module or pci-stub Radeon, the noise is all there. Until i boot my guest win7 vm, then win7&#039;s ATI driver make it quiet.<br />My question is, after host os(linux) booted, before guest win7 booted, Is there a way to make Radeon 7870 quiet? <br />I hope i don&#039;t need to keep my the guest win7 always booted, it&#039;s only one game machine.</p><p>Any suggestion is apreciated.<br />Thanks in advance.</p> <p class="postedit"><em>Last edited by apporc (2014-06-11 03:08:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424533">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424556" class="blockpost rowodd"> <h2><span><span class="conr">#2057</span> <a href="viewtopic.php?pid=1424556#p1424556">2014-06-11 04:10:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Rabcor, is your &quot;4x PCIE&quot; electrical slot directly linked to the CPU or does it go through the the Z77 PCH? If it goes through the controller hub, it would explain why you&#039;re noticing a huge performance because you&#039;re passing through what used to be the south bridge. DMI 2.0 is limited to 20gbit/s. If it was directly linked to the CPU, I doubt you&#039;d see a substantial difference in benchmarks. If your motherboard supports SLI or Crossfire, use the slots indicated for this by your manufacturer because they are the ones with direct access to the northbridge that is part of the CPU now.</p><p>I&#039;ve seen the effect this has on graphic cards and it&#039;s quite noticeable with simple desktop compositing (Aero, Compiz, Mutter).</p><p>For reference, see : <a href="http://www.anandtech.com/show/5728/intel-z77-panther-point-chipset-and-motherboard-preview-asrock-asus-gigabyte-msi-ecs-and-biostar" rel="nofollow">http://www.anandtech.com/show/5728/inte … nd-biostar</a></p> <p class="postedit"><em>Last edited by mv0lnicky (2014-06-11 06:11:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424556">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424565" class="blockpost roweven"> <h2><span><span class="conr">#2058</span> <a href="viewtopic.php?pid=1424565#p1424565">2014-06-11 04:53:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>VGA_ARB patch did not seem to help (I suspect it is needed either way) is it normal that xorg.log will say this when the VGA arb patch is enabled?</p><div class="codebox"><pre><code>[ 10.381] (WW) NVIDIA(0): [DRI2] Direct rendering is not supported when VGA arb is necessary for the device [ 10.381] (II) NVIDIA(0): The X server will not be able to send the VDPAU driver name to [ 10.381] (II) NVIDIA(0): libvdpau. [ 10.381] (--) RandR disabled [ 10.381] (II) Found 2 VGA devices: arbiter wrapping enabled</code></pre></div><p>I thought it disabled arbiter wrapping entirely.</p><p>What I think I need is a method for the kernel to load my secondary GPU as if it were my primary one. Think it&#039;s possible?</p><p>Edit: I found a way, my motherboard supports selecting a main display, it offers</p><div class="codebox"><pre><code>iGPU PCIe PCI</code></pre></div><p>Choosing PCI resulted in the motherboard reading my GTX 550 rather than my 670 as the primary card even if it is in the x4 bus. It would be neat to have an alternative way to do this in case someone has to deal with a motherboard that doesn&#039;t support doing this. (And I still need an answer to that VGA Arb question please)</p> <p class="postedit"><em>Last edited by rabcor (2014-06-11 05:01:43)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424565">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424567" class="blockpost rowodd"> <h2><span><span class="conr">#2059</span> <a href="viewtopic.php?pid=1424567#p1424567">2014-06-11 05:06:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apporc wrote:</cite><blockquote><div><p>About the noise of my Radeon 7870 card. It is really very loud.<br />Before i tried the guide of this thread, i used fglrx driver, and Radeon 7870 card didn&#039;t make noise.<br />I know if i used radeon driver, the noise will be there. Maybe just as they said, radeon driver doesn&#039;t handle the frequency well.</p><p>But after pci-stub, why Radeon 7870 is still noisy. I thought when Radeon is got stubed, nobody is using it, and nobody using it should lead to &quot;no noise&quot;.<br />Surpringly it&#039;s not. No mater i blacklist radeon/fglrx module or pci-stub Radeon, the noise is all there. Until i boot my guest win7 vm, then win7&#039;s ATI driver make it quiet.<br />My question is, after host os(linux) booted, before guest win7 booted, Is there a way to make Radeon 7870 quiet? <br />I hope i don&#039;t need to keep my the guest win7 always booted, it&#039;s only one game machine.</p></div></blockquote></div><p>Sadly, that&#039;s probably the solution.&#160; Without a driver that knows how to do power management, the cooling device on the card just runs at a default speed.&#160; Ideally devices would turn the fan off (like AMD ZeroCore) or at least to a minimum level when put into the D3 power state, but they don&#039;t (I&#039;ve tried).&#160; It&#039;s probably still worthwhile to add some basic power management to vfio-pci to put devices in D3 while not in use, it saves 2-3 Watts on my system, but it&#039;s still quieter to run a guest with a driver that can silence the fan.</p> <p class="postedit"><em>Last edited by aw (2014-06-11 05:09:23)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424567">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424577" class="blockpost roweven"> <h2><span><span class="conr">#2060</span> <a href="viewtopic.php?pid=1424577#p1424577">2014-06-11 06:05:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Edit: I found a way, my motherboard supports selecting a main display, it offers</p><div class="codebox"><pre><code>iGPU PCIe PCI</code></pre></div><p>Choosing PCI resulted in the motherboard reading my GTX 550 rather than my 670 as the primary card even if it is in the x4 bus. It would be neat to have an alternative way to do this in case someone has to deal with a motherboard that doesn&#039;t support doing this. (And I still need an answer to that VGA Arb question please)</p></div></blockquote></div><p>PCI BIOS setting pretty much confirms what I said in my previous post. Your 4x slot is most likely routed through DMI 2.0. I don&#039;t think that the results of your research you linked in one of your previous post are accurate, seeing as you&#039;re hitting a major bottleneck in the chipset configuration. And if you had PCIE3.0 slots, or even 4.0 slots, you&#039;d have the same problem.</p><p>How many physical 16x PCIE ports are present on your motherboard?</p> <p class="postedit"><em>Last edited by mv0lnicky (2014-06-11 06:14:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424577">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424579" class="blockpost rowodd"> <h2><span><span class="conr">#2061</span> <a href="viewtopic.php?pid=1424579#p1424579">2014-06-11 06:40:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=60514">ttouch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: /dev/null</span></dd> <dd><span>Registered: 2012-05-27</span></dd> <dd><span>Posts: 129</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=60514">Email</a></span> <span class="website"><a href="http://dzervas.gr" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Umm, qemu adds an outer frame.<br />I change the resolution to 1920x1080, but the outer black frame remains. any advice? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://github.com/ttouch" rel="nofollow">GitHub</a> | <a href="http://git.dzervas.gr" rel="nofollow">Git Server</a> | <a href="http://dzervas.gr" rel="nofollow">Blog</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424579">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424581" class="blockpost roweven"> <h2><span><span class="conr">#2062</span> <a href="viewtopic.php?pid=1424581#p1424581">2014-06-11 06:53:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><p>Umm, qemu adds an outer frame.<br />I change the resolution to 1920x1080, but the outer black frame remains. any advice? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p> You mean like underscan?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424606" class="blockpost rowodd"> <h2><span><span class="conr">#2063</span> <a href="viewtopic.php?pid=1424606#p1424606">2014-06-11 08:21:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Edit: I found a way, my motherboard supports selecting a main display, it offers</p><div class="codebox"><pre><code>iGPU PCIe PCI</code></pre></div><p>Choosing PCI resulted in the motherboard reading my GTX 550 rather than my 670 as the primary card even if it is in the x4 bus. It would be neat to have an alternative way to do this in case someone has to deal with a motherboard that doesn&#039;t support doing this. (And I still need an answer to that VGA Arb question please)</p></div></blockquote></div><p>PCI BIOS setting pretty much confirms what I said in my previous post. Your 4x slot is most likely routed through DMI 2.0. I don&#039;t think that the results of your research you linked in one of your previous post are accurate, seeing as you&#039;re hitting a major bottleneck in the chipset configuration. And if you had PCIE3.0 slots, or even 4.0 slots, you&#039;d have the same problem.</p><p>How many physical 16x PCIE ports are present on your motherboard?</p></div></blockquote></div><p><a href="https://www.asus.com/Motherboards/P8Z77V_LX/specifications/" rel="nofollow">These</a> are my motherboard specs, <a href="http://dlcdnet.asus.com/pub/ASUS/mb/LGA1155/P8Z77-V_LX/E8533_P8Z77-V_LX.pdf" rel="nofollow">manual is here too</a>. I have very little idea what you&#039;re talking about.</p><p>But I did try running a benchmark on the 550-Ti too (I added this to <a href="http://superuser.com/a/767176/290082" rel="nofollow">superuser</a> too) and in that case the performance difference was trivial (less than 1FPS) but my results seem like they are accurate from my perspective, matches what I expected before benchmarking (except that I was expecting the 670 to do significantly worse than it did on the x4 bus)</p><p>My understanding is that the x4 bus is connected to the CPU by first going through the x16 bus (meaning the x16 bus actually becomes an x12 bus in the process, I might want to add that to the superuser benchmark info as well, but I just don&#039;t know anything about this)</p><p>Edit: According to the manual the x16 bus card will remain at x16 mode even when a card is in use by the x4 bus. It does not say anything about DMI 2.0 or the PCI Express connecting to the CPU via it, but according to the reference you linked to earlier the pci express x16 is connected directly to the CPU and the pci express x4 is connected to a &quot;pci express switch&quot; which forwards it to the processor (not through the DMI)</p><p>I think you&#039;re confusing the pci express x16 operating at x4 bandiwdth with the actual pci express x4 bus (which is another thing entirely and much smaller, you wouldn&#039;t fit a GeForce card in there)</p><p>Edit2: I am however having a quite dubious performance difference for the GTX 550-Ti on linux&#039;s OpenGL between the x4 and x16, no really it is fucking amazingly bad.</p><p>GTX 550-Ti on x16 (Linux)</p><div class="codebox"><pre><code>FPS:3.5 Score:89 Min FPS:2.6 Max FPS:6.6</code></pre></div><p>GTX 550-Ti on x16(x4) (Linux)</p><div class="codebox"><pre><code>FPS:1.3 Score:33 Min FPS:1.1 Max FPS:2.4</code></pre></div><p>I&#039;m having a hard time believing how huge that difference was (although when I think of it it really is only a 2.2 overall FPS difference, but this I find quite odd I need to investigate this, although it should be considered I am running it on settings the card clearly can&#039;t possibly handle so my first step should of course be to try running something it can handle and comparing between windows and linux)</p><p>Edit 3: The performance difference on the same settings between Windows and Linux on OpenGL 3.2 with the 550-Ti were so huge I am inclined to believe that that 89 score I got was some kind of fluke (maybe I forgot to enable the FXAA and force x16 anisotropic filtering, I&#039;ll look into this as well)</p><p>Either way here are my results.</p><p>GTX 550-Ti on x16 (Windows)</p><div class="codebox"><pre><code>FPS:13.9 Score:351 Min FPS:6.4 Max FPS:29.1</code></pre></div><p>GTX 550-Ti on x16(x4) (Linux)</p><div class="codebox"><pre><code>FPS:21.0 Score:530 Min FPS:8.7 Max FPS:34.6</code></pre></div><p>Settings were Unigines &quot;basic&quot; preset with 1920x1080 full screen resolution on OpenGL renderer. What I was doing here (as I am too lazy to put the 550-Ti back in the x16 slot it&#039;s just too much trouble to switch the cards up) was testing to confirm if the performance in Windows on OpenGL on this card wasn&#039;t still lower than on Linux. This benchmark was enough to convince me that the card is functioning at full efficiency (or like 99% since I think the x4 bus chips just a tiny little bit of performance away from this card, nothing as much as on the 670) on linux and I must have made a mistake in my settings somewhere to get so different results earlier. The performance difference was much bigger than between the 670 on linux and windows (meaning it was even higher than I expected and hoped it would be)</p><p>I am doing this because I know the card is working just as well on windows on this x4 bus as it was on the x16 bus (I triple checked with DX11 and it is indeed just getting roughly the same results as it did on the x16 pass)</p><p>One thing I did notice however is that 550-Ti on OpenGL on windows ran 10°C (72°C) hotter than it ever did on linux(60°C)&#160; so it actually may be that the performance on linux is Slightly borked somehow (I mean this is the same behavior as I got when I switched 670 between x16 and x4, except that this isn&#039;t between buses but between operating systems, and possibly drivers, might be VGA arb related)</p><p>Edit 4: Just to check I tried installing the Nvidia drivers again (without the VGA arb patch) to see if they would perform any differently and well they did to a point. It seems like everything runs the same way as it did when I scored 89 earlier. except that after an X amount of time (which actually varies) it slows down and everything drops to around 1 FPS (temperature also refuses to exceed 60, perhaps that is the problem? perhaps nvidia&#039;s linux drivers don&#039;t want this card to exceed 60°C whereas the windows ones cap it at 70°C instead?)</p><p>Ah well I will give up on it, but I am pretty sure this is temperature and power management related, if not it must be a problem with the program&#039;s code somewhere (or drivers) at least on settings the card actually can handle it performs just as well as I would have expected it to.</p><p>Edit 5: Interesting thing to add is that the 550-Ti on OpenGL 3.2 in Unigine Heaven is actually <strong>on par</strong> with DX11</p><p>GTX 550-Ti on x16(x4) (Windows, DX11)</p><div class="codebox"><pre><code>FPS:21.2 Score:534 Min FPS:9.8 Max FPS:37.8</code></pre></div> <p class="postedit"><em>Last edited by rabcor (2014-06-11 10:38:30)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424606">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424679" class="blockpost roweven"> <h2><span><span class="conr">#2064</span> <a href="viewtopic.php?pid=1424679#p1424679">2014-06-11 12:39:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>rabcor: refer back to your finding that DRI is disabled when multiple graphics cards are installed.&#160; The difference you&#039;re seeing is a software limitation, not hardware.</p><p>mv0lnicky: DMI is more than sufficient to handle a x4 PCIe link.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424679">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424688" class="blockpost rowodd"> <h2><span><span class="conr">#2065</span> <a href="viewtopic.php?pid=1424688#p1424688">2014-06-11 13:00:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>But I am technically only using one card. And DRI3 gave me no error (meaning DRI3 is working) but if you&#039;re referring to the benchmarks i was doing above that had me baffled, the one that scored twice as high as the other GL benchmarks on the same settings was taken with the same setup (with my 670 stubbed)</p> <p class="postedit"><em>Last edited by rabcor (2014-06-11 14:51:47)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424688">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424752" class="blockpost roweven"> <h2><span><span class="conr">#2066</span> <a href="viewtopic.php?pid=1424752#p1424752">2014-06-11 15:37:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>P8Z77-V LX link -&#160; I have very little idea what you&#039;re talking about.</p><p>My understanding is that the x4 bus is connected to the CPU by first going through the x16 bus (meaning the x16 bus actually becomes an x12 bus in the process, I might want to add that to the superuser benchmark info as well, but I just don&#039;t know anything about this)</p><p>Edit: According to the manual the x16 bus card will remain at x16 mode even when a card is in use by the x4 bus. It does not say anything about DMI 2.0 or the PCI Express connecting to the CPU via it, but according to the reference you linked to earlier the pci express x16 is connected directly to the CPU and the pci express x4 is connected to a &quot;pci express switch&quot; which forwards it to the processor (not through the DMI)</p><p>I think you&#039;re confusing the pci express x16 operating at x4 bandiwdth with the actual pci express x4 bus (which is another thing entirely and much smaller, you wouldn&#039;t fit a GeForce card in there)</p></div></blockquote></div><p>Let me get this straight, when you&#039;re referring to 4x, you&#039;re talking about the black colored slot. No I am not talking about the little PCIe slots (they are actually 1x slots on your board).</p><p>Asus does not support multi-gpu (SLI/Xfire) on the LX motherboard as a result of product differentiation. From looking at the specs, this board seems artificially limited to running only one full 16x link. (directly attached to the CPU thus, no bottleneck on this one) </p><p>The confusion comes from the fact that in the ideal scenario, a board with two 16x PCIe slots - like the P8Z77-V PRO - will run on mode 1 (only one GPU) at full 16x, and on mode 2 (two GPU) at a reduced rate 8x + 8x. This limitation has been existing with Intel motherboards for a long time (think P35/X38 days) but it is not relevant in your case. If you took the same P8Z77-V PRO, stuck a GPU into slot 3, you&#039;d have the same scenario as you currently have n your P8Z77-V LX.</p><p>I made a little picture since I guess it&#039;s hard to explain in words. <a href="http://oi59.tinypic.com/33xkndc.jpg" rel="nofollow">http://oi59.tinypic.com/33xkndc.jpg</a> EDIT: I made a bad circling on the the PRO board, the writing is on the PCI slot when it should be on the PCIE slot. Doesn&#039;t change anything anyway.</p><br /><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>mv0lnicky: DMI is more than sufficient to handle a x4 PCIe link.</p></div></blockquote></div><p> It is but DMI shares it&#039;s bandwidth with every other I/O (USB, SATA) and is max 20Gbit for everything with a 4x bus. I have not benchmarked it but going from two different PCIe slots, one on the PCH to one of the PCIe switch from the CPU is like night and day when using desktop compositing. Even switching workspace is noticably slower. Almost like a GPU switching power management modes even though they work at 100% clock rate. I suspect that access to system memory is significantly impacted by passing through DMI. For the gazillion SATA and USB ports, DMI is fine, but for serious 3D work, it&#039;s terrible.</p><p>A &quot;normal&quot; 4x PCIe slot should not be sharing it&#039;s entire bandwidth with everything under the sun.</p> <p class="postedit"><em>Last edited by mv0lnicky (2014-06-11 15:41:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424752">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424777" class="blockpost rowodd"> <h2><span><span class="conr">#2067</span> <a href="viewtopic.php?pid=1424777#p1424777">2014-06-11 17:01:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apporc wrote:</cite><blockquote><div><p>Hi, siddharta.<br />But now all of above turned out to be not necessary. <br />After above, I just used virt-manager to create my win7 vm. I totally use virt-manager to add vga card and usb device to my vm.</p><p>The method virt-manager uses is now vfio_pci too, not pci_assign.</p><p>Here is another link i used to refer to: <a href="http://www.firewing1.com/howtos/fedora-20/create-gaming-virtual-machine-using-vfio-pci-passthrough-kvm" rel="nofollow">http://www.firewing1.com/howtos/fedora- … hrough-kvm</a>.</p><p>Good luck!</p></div></blockquote></div><p>Thanks apporc, that&#039;s very interesting. I also like to use virsh and virt-manager to provision and manage guests. I now have VGA passthrough working (kernel 3.15 with i915 vga arbiter patch), can PCI assign those devices that can&#039;t be passed through with vfio (thanks to aw) and have USB device passthrough working again (I&#039;m on OpenSUSE 13.1 and it seems qemu 2.0.0 in the virtualization repository is built with libusb disabled, so I had to rebuild that). </p><p>Now I&#039;m struggling with converting everything to libvirt xml which doesn&#039;t go smootly... for example, if you provision a new guest through virt-manager, then change the chipset to q35 rather than i440 it complains that the USB controller needs a PCI bus. It&#039;s a good idea to try and stick with the virt-manager defined guest and work from there, I&#039;ll give that a go.</p><p>edit: I spoke in haste. While I don&#039;t get an error anymore when starting a guest that has a passthrough USB device in its definition, as was the case with the standard qemu 2.0.0 in OpenSUSE&#039;s virtualization repo, even a passthrough USB keyboard doesn&#039;t work in a guest. Not certain if the problem is with the updated libusb I had to install to build qemu with --enable-libusb or the qemu I built. This throws another stick in the gearbox (is that the expression?) so I might just see about building the whole thing on Arch as that seems the least painful-ish.</p> <p class="postedit"><em>Last edited by siddharta (2014-06-11 17:33:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424777">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424780" class="blockpost roweven"> <h2><span><span class="conr">#2068</span> <a href="viewtopic.php?pid=1424780#p1424780">2014-06-11 17:03:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks mv0lnicky.</p><p>I have a problem, I&#039;m setting up my system again (this time actually with arch as opposed to gentoo last time) I&#039;m using the official arch kernel (but with ACS Override patch) here&#039;s what happens when I try to use vfio-bind (and I&#039;m sure this is some really noobish mistake i&#039;m making)</p><div class="codebox"><pre><code>$ dmesg | grep vfio [ 2.613944] vfio-pci: probe of 0000:01:00.0 failed with error -22 [ 2.616525] vfio-pci: probe of 0000:01:00.0 failed with error -22 [ 2.616536] vfio-pci: probe of 0000:01:00.1 failed with error -22 [ 2.619017] vfio-pci: probe of 0000:01:00.0 failed with error -22 [ 2.619028] vfio-pci: probe of 0000:01:00.1 failed with error -22 [ 2.619037] vfio-pci: probe of 0000:06:00.0 failed with error -22</code></pre></div><p>Here is my cmdline</p><div class="codebox"><pre><code>$ cat /proc/cmdline BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=0773b55f-24c9-494a-a43b-db6b45a36a80 rw quiet pci-stub.ids=10de:1189,10de:0e0a pcie_acs_override=downstream</code></pre></div><div class="codebox"><pre><code>$ cat /etc/modprobe.d/kvm.conf options kvm ignore_msrs=1 options vfio_iommu_type1 allow_unsafe_interrupts=1 blacklist snd_ctxfi</code></pre></div><p>(where ctxfi is the mysterious 06:00.0 soundblaster card) I know that pci-stub worked, I know that something fails between pci-stub and the vfio-bind. What am I doing wrong? &quot;lspci -v&quot; should show &quot;kernel driver in use:vfio-pci&quot; should it not? (instead I see no kernel driver line at all for the devices in question,&#160; i get a &quot;&gt;?&quot; sign of some sort instead)</p><p>/dev/vfio/vfio exists.</p><p>Edit: I think I know what the issue may be.</p><div class="codebox"><pre><code>$ zgrep IOMMU_DEFAULT /proc/config.gz # CONFIG_INTEL_IOMMU_DEFAULT_ON is not set</code></pre></div><p>How do I work aorund this? (Is there any other way than to recompile the kernel with the setting enabled?)</p> <p class="postedit"><em>Last edited by rabcor (2014-06-11 17:43:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424780">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424804" class="blockpost rowodd"> <h2><span><span class="conr">#2069</span> <a href="viewtopic.php?pid=1424804#p1424804">2014-06-11 17:50:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Edit: I think I know what the issue may be.</p><div class="codebox"><pre><code>$ zgrep IOMMU_DEFAULT /proc/config.gz # CONFIG_INTEL_IOMMU_DEFAULT_ON is not set</code></pre></div><p>How do I work aorund this? (Is there any other way than to recompile the kernel with the setting enabled?)</p></div></blockquote></div><p>Add intel_iommu=on to your kernel boot options</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424804">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424824" class="blockpost roweven"> <h2><span><span class="conr">#2070</span> <a href="viewtopic.php?pid=1424824#p1424824">2014-06-11 19:16:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=60514">ttouch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: /dev/null</span></dd> <dd><span>Registered: 2012-05-27</span></dd> <dd><span>Posts: 129</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=60514">Email</a></span> <span class="website"><a href="http://dzervas.gr" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><p>Umm, qemu adds an outer frame.<br />I change the resolution to 1920x1080, but the outer black frame remains. any advice? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p> You mean like underscan?</p></div></blockquote></div><p>Yes.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://github.com/ttouch" rel="nofollow">GitHub</a> | <a href="http://git.dzervas.gr" rel="nofollow">Git Server</a> | <a href="http://dzervas.gr" rel="nofollow">Blog</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424824">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424846" class="blockpost rowodd"> <h2><span><span class="conr">#2071</span> <a href="viewtopic.php?pid=1424846#p1424846">2014-06-11 20:43:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I have the same problem like rabcor.</p><p>vfio-bind results in</p><div class="codebox"><pre><code>[root@ARCH iommu_groups]# dmesg | grep vfio [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0140 quiet [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0140 quiet [ 209.145692] vfio-pci: probe of 0000:02:00.0 failed with error -22 [ 473.422577] vfio-pci: probe of 0000:02:00.0 failed with error -22 [ 832.559887] vfio-pci: probe of 0000:02:00.0 failed with error -22</code></pre></div><p>I think that intel_iommu is enabled ... see kernel options above.</p><div class="codebox"><pre><code>[root@ARCH tmp]# zgrep IOMMU /proc/config.gz CONFIG_GART_IOMMU=y CONFIG_CALGARY_IOMMU=y CONFIG_CALGARY_IOMMU_ENABLED_BY_DEFAULT=y CONFIG_IOMMU_HELPER=y CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_IOMMU_API=y CONFIG_IOMMU_SUPPORT=y CONFIG_AMD_IOMMU=y # CONFIG_AMD_IOMMU_STATS is not set CONFIG_AMD_IOMMU_V2=m CONFIG_INTEL_IOMMU=y # CONFIG_INTEL_IOMMU_DEFAULT_ON is not set CONFIG_INTEL_IOMMU_FLOPPY_WA=y # CONFIG_IOMMU_DEBUG is not set # CONFIG_IOMMU_STRESS is not set</code></pre></div><p>CPU: i5 2500k<br />MB: Asus P8P67 EVO</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424846">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424850" class="blockpost roweven"> <h2><span><span class="conr">#2072</span> <a href="viewtopic.php?pid=1424850#p1424850">2014-06-11 20:47:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>CPU: i5 2500k<br />MB: Asus P8P67 EVO</p></div></blockquote></div><p>Your CPU doesn&#039;t support VT-d - <a href="http://ark.intel.com/products/52210/Intel-Core-i5-2500K-Processor-6M-Cache-up-to-3_70-GHz" rel="nofollow">http://ark.intel.com/products/52210/Int … o-3_70-GHz</a></p><p>Thanks for playing</p><p>nbhs, maybe you could add a link to ark on the first post, we&#039;re getting this a lot.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424850">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424860" class="blockpost rowodd"> <h2><span><span class="conr">#2073</span> <a href="viewtopic.php?pid=1424860#p1424860">2014-06-11 21:17:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m surprised people can&#039;t verify for themselves since the first post mentions :</p><p>&quot;NOTE: to get this working you&#039;ll need:</p><p>&#160; &#160; AMD-VI/VT-D enabled and working.&quot;</p> <p class="postedit"><em>Last edited by mv0lnicky (2014-06-11 21:17:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424860">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424864" class="blockpost roweven"> <h2><span><span class="conr">#2074</span> <a href="viewtopic.php?pid=1424864#p1424864">2014-06-11 21:20:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><p>Umm, qemu adds an outer frame.<br />I change the resolution to 1920x1080, but the outer black frame remains. any advice? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p> You mean like underscan?</p></div></blockquote></div><p>Yes.</p></div></blockquote></div><p> I doubt it&#039;s related to QEMU since it is just passing complete control of the hardware to the guest. </p><p>What operating system are you running as guest VM? Did you install the drivers for your graphic card?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424864">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424865" class="blockpost rowodd"> <h2><span><span class="conr">#2075</span> <a href="viewtopic.php?pid=1424865#p1424865">2014-06-11 21:22:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><p>I&#039;m surprised people can&#039;t verify for themselves since the first post mentions :</p><p>&quot;NOTE: to get this working you&#039;ll need:</p><p>&#160; &#160; AMD-VI/VT-D enabled and working.&quot;</p></div></blockquote></div><p>To be fair, the kernel does like to lie and say things like &quot;Intel-IOMMU: enabled&quot; when actually all it&#039;s done is register that you&#039;ve passed intel_iommu=on.&#160; The actual telling line that nobody seems to get right when trying to prove that it&#039;s enabled is &quot;PCI-DMA: Intel(R) Virtualization Technology for Directed I/O&quot;.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424865">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=82">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=81">81</a> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <strong>83</strong> <a href="viewtopic.php?id=162768&amp;p=84">84</a> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=84">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
