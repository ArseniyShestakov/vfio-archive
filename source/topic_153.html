<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 153) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=153" title="Page 153" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=152" title="Page 152" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=154" title="Page 154" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=152">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <strong>153</strong> <a href="viewtopic.php?id=162768&amp;p=154">154</a> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=154">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1491585" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3801</span> <a href="viewtopic.php?pid=1491585#p1491585">2015-01-09 10:55:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78314">MacCoaster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-06</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to set up a OVMF VM so I can also use the Intel iGPU for a Linux workstation, but I seem to get no video output at all. I know it&#039;s booting from my test Linux ISO (the serial output shows something).</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/OVMF-pure-efi.fd -vga none -device vfio-pci,host=08:00.0 -device vfio-pci,host=08:00.1 -drive file=CentOS-7.0-1406-x86_64-DVD.iso,id=virtiocd</code></pre></div><p>No video, zilch. Am I missing something obvious?</p><p>In dmesg, I see:</p><div class="codebox"><pre><code>[ 1755.997185] vfio-pci 0000:08:00.0: enabling device (0400 -&gt; 0403) [ 1756.019017] vfio_ecap_init: 0000:08:00.0 hiding ecap 0x19@0x270 [ 1756.021067] vfio-pci 0000:08:00.1: enabling device (0400 -&gt; 0402) [ 1757.395393] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>Which I assume is good?</p><p>EDIT: And of course, tell me what I can do to debug/what more information if any is needed.</p> <p class="postedit"><em>Last edited by MacCoaster (2015-01-09 11:01:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491585">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491613" class="blockpost roweven"> <h2><span><span class="conr">#3802</span> <a href="viewtopic.php?pid=1491613#p1491613">2015-01-09 13:47:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MacCoaster wrote:</cite><blockquote><div><p>I&#039;m trying to set up a OVMF VM so I can also use the Intel iGPU for a Linux workstation, but I seem to get no video output at all. I know it&#039;s booting from my test Linux ISO (the serial output shows something).</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/OVMF-pure-efi.fd -vga none -device vfio-pci,host=08:00.0 -device vfio-pci,host=08:00.1 -drive file=CentOS-7.0-1406-x86_64-DVD.iso,id=virtiocd</code></pre></div><p>No video, zilch. Am I missing something obvious?</p><p>In dmesg, I see:</p><div class="codebox"><pre><code>[ 1755.997185] vfio-pci 0000:08:00.0: enabling device (0400 -&gt; 0403) [ 1756.019017] vfio_ecap_init: 0000:08:00.0 hiding ecap 0x19@0x270 [ 1756.021067] vfio-pci 0000:08:00.1: enabling device (0400 -&gt; 0402) [ 1757.395393] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>Which I assume is good?</p><p>EDIT: And of course, tell me what I can do to debug/what more information if any is needed.</p></div></blockquote></div><p>The graphics card needs to support UEFI.&#160; Does it?</p><p><a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.com/2014/08/does-m … t-efi.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491613">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491624" class="blockpost rowodd"> <h2><span><span class="conr">#3803</span> <a href="viewtopic.php?pid=1491624#p1491624">2015-01-09 14:46:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MacCoaster wrote:</cite><blockquote><div><p>I&#039;m trying to set up a OVMF VM so I can also use the Intel iGPU for a Linux workstation, but I seem to get no video output at all. I know it&#039;s booting from my test Linux ISO (the serial output shows something).</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/OVMF-pure-efi.fd -vga none -device vfio-pci,host=08:00.0 -device vfio-pci,host=08:00.1 -drive file=CentOS-7.0-1406-x86_64-DVD.iso,id=virtiocd</code></pre></div><p>No video, zilch. Am I missing something obvious?</p><p>In dmesg, I see:</p><div class="codebox"><pre><code>[ 1755.997185] vfio-pci 0000:08:00.0: enabling device (0400 -&gt; 0403) [ 1756.019017] vfio_ecap_init: 0000:08:00.0 hiding ecap 0x19@0x270 [ 1756.021067] vfio-pci 0000:08:00.1: enabling device (0400 -&gt; 0402) [ 1757.395393] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>Which I assume is good?</p><p>EDIT: And of course, tell me what I can do to debug/what more information if any is needed.</p></div></blockquote></div><p>1. Tell us about your hardware - what GPU are you trying to passthrough.<br />2. Are you sure that the guest OS(CentOS) does support pure EFI and works with GOP and stuff? I&#039;m sorry, i&#039;m a bit unfamiliar with CentOS(while using fedora, heh) on UEFI.<br />3. Try booting with CSM on - maybe it&#039;ll get you video output, but there will be no gains - it will use VGA.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491624">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491627" class="blockpost roweven"> <h2><span><span class="conr">#3804</span> <a href="viewtopic.php?pid=1491627#p1491627">2015-01-09 15:01:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87894">longyny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-09</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:longi19@msn.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I need some assistance, please. My rig has an Asus P9X79E-WS with Xeon E5-2670, 32gb of ram and 4x AMD R9 280x. What I want to do is to passthrough 2 GPU to the guest OS, but I don&#039;t know how to blacklist only 2 of them without blacklisting all 4 GPUs. I want to leave 2 GPUs for the Host OS&#160; with its own HDMI Audio Device, and the other pair for the Guest OS with its HDMI Audio Device. </p><p>I don&#039;t want to go the ESXi way because I want to have direct access by Linux without any virtualization layer to a pool of 28 hdds that I have attached to an HP SAS Expander Card</p><div class="quotebox"><blockquote><div><p>04:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970/8970 OEM / R9 280X] [1002:6798]<br />04:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] [1002:aaa0]<br />06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970/8970 OEM / R9 280X] [1002:6798]<br />06:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] [1002:aaa0]<br />0a:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970/8970 OEM / R9 280X] [1002:6798]<br />0a:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] [1002:aaa0]<br />0b:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970/8970 OEM / R9 280X] [1002:6798]<br />0b:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] [1002:aaa0]</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491638" class="blockpost rowodd"> <h2><span><span class="conr">#3805</span> <a href="viewtopic.php?pid=1491638#p1491638">2015-01-09 15:59:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>longyny wrote:</cite><blockquote><div><p>Hi,</p><p>I need some assistance, please. My rig has an Asus P9X79E-WS with Xeon E5-2670, 32gb of ram and 4x AMD R9 280x. What I want to do is to passthrough 2 GPU to the guest OS, but I don&#039;t know how to blacklist only 2 of them without blacklisting all 4 GPUs. I want to leave 2 GPUs for the Host OS&#160; with its own HDMI Audio Device, and the other pair for the Guest OS with its HDMI Audio Device.</p></div></blockquote></div><p>Somewhere in this thread, within the last couple weeks, is an example of someone using Xen&#039;s pci-back driver (not Xen itself) in place of pci-stub because it has the ability to claim based on bus address.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491638">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491657" class="blockpost roweven"> <h2><span><span class="conr">#3806</span> <a href="viewtopic.php?pid=1491657#p1491657">2015-01-09 18:00:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78314">MacCoaster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-06</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The graphics card needs to support UEFI.&#160; Does it?</p><p><a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.com/2014/08/does-m … t-efi.html</a></p></div></blockquote></div><p>Hi aw, thanks for the quick response.</p><div class="codebox"><pre><code>[root@localhost 0000:08:00.0]# cat rom &gt; /tmp/image.rom cat: rom: Input/output error [root@localhost 0000:08:00.0]# (snip) [root@localhost 0000:08:00.0]# dmesg (snip) [ 117.891895] pci-stub 0000:08:00.0: Invalid ROM contents [root@localhost 0000:08:00.0]#</code></pre></div><p>Can&#039;t seem to extract the ROM. Any other way? Maybe I have to do GPU-Z?</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>1. Tell us about your hardware - what GPU are you trying to passthrough.</p></div></blockquote></div><p>ASUS PD9-WS, with Radeon R7 240 in the last PCI-E port (PCH).</p><div class="codebox"><pre class="vscroll"><code>08:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Oland PRO [Radeon R7 240] (prog-if 00 [VGA controller]) Subsystem: PC Partner Limited / Sapphire Technology Device e263 Control: I/O- Mem- BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Interrupt: pin A routed to IRQ 11 Region 0: Memory at e0000000 (64-bit, prefetchable) [disabled] [size=256M] Region 2: Memory at f0000000 (64-bit, non-prefetchable) [disabled] [size=256K] Region 4: I/O ports at a000 [disabled] [size=256] Expansion ROM at f0040000 [disabled by cmd] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1+,D2+,D3hot+,D3cold-) Status: D0 NoSoftRst- PME-Enable- DSel=0 DScale=0 PME- Capabilities: [58] Express (v2) Legacy Endpoint, MSI 00 DevCap: MaxPayload 256 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 unlimited ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr+ UncorrErr- FatalErr- UnsuppReq+ AuxPwr- TransPend- LnkCap: Port #0, Speed 8GT/s, Width x8, ASPM L0s L1, Exit Latency L0s &lt;64ns, L1 &lt;1us ClockPM- Surprise- LLActRep- BwNot- ASPMOptComp+ LnkCtl: ASPM L0s L1 Enabled; RCB 64 bytes Disabled- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 5GT/s, Width x4, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Not Supported, TimeoutDis-, LTR-, OBFF Not Supported DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled LnkCtl2: Target Link Speed: 8GT/s, EnterCompliance- SpeedDis- Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS- Compliance De-emphasis: -6dB LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Address: 0000000000000000 Data: 0000 Capabilities: [100 v1] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150 v2] Advanced Error Reporting UESta: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UEMsk: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UESvrt: DLP+ SDES+ TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol- CESta: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+ CEMsk: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr+ AERCap: First Error Pointer: 00, GenCap+ CGenEn- ChkCap+ ChkEn- Capabilities: [270 v1] #19 Kernel driver in use: pci-stub Kernel modules: radeon</code></pre></div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>2. Are you sure that the guest OS(CentOS) does support pure EFI and works with GOP and stuff? I&#039;m sorry, i&#039;m a bit unfamiliar with CentOS(while using fedora, heh) on UEFI.</p></div></blockquote></div><p>Fair question -- but wouldn&#039;t I also get EFI BIOS output on the GPU too? I tried to use the Windows 8.1 ISO but it says boot failed (in the serial console) from a CD/DVD. :\</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>3. Try booting with CSM on - maybe it&#039;ll get you video output, but there will be no gains - it will use VGA.</p></div></blockquote></div><p>I see several options for that in the BIOS. Right now it&#039;s set to [Enabled].</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491657">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491660" class="blockpost rowodd"> <h2><span><span class="conr">#3807</span> <a href="viewtopic.php?pid=1491660#p1491660">2015-01-09 18:29:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, I got new hardware in hands, a 5820k with a Asrock X99 Extreme 6, I can confirm that GT430 in second slot works but when I try to pass the GTX970 at first slot I get</p><div class="codebox"><pre><code>vfio-pci 0000:02:00.0: BAR 3: can&#039;t reserve [mem 0xe0000000-0xe1ffffff 64bit pref]</code></pre></div><p>in dmesg and similar warning in QEMU console warning about performance, the gpu resets but then stays black, any suggestion?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491660">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491688" class="blockpost roweven"> <h2><span><span class="conr">#3808</span> <a href="viewtopic.php?pid=1491688#p1491688">2015-01-09 20:41:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><p>Hello, I got new hardware in hands, a 5820k with a Asrock X99 Extreme 6, I can confirm that GT430 in second slot works but when I try to pass the GTX970 at first slot I get</p><div class="codebox"><pre><code>vfio-pci 0000:02:00.0: BAR 3: can&#039;t reserve [mem 0xe0000000-0xe1ffffff 64bit pref]</code></pre></div><p>in dmesg and similar warning in QEMU console warning about performance, the gpu resets but then stays black, any suggestion?</p></div></blockquote></div><p>Check if the GPU is used by some splash-screens. Do cat /proc/iomem and search the given memory range. I bet there is something like vesafb.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491688">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491689" class="blockpost rowodd"> <h2><span><span class="conr">#3809</span> <a href="viewtopic.php?pid=1491689#p1491689">2015-01-09 20:42:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MacCoaster wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>3. Try booting with CSM on - maybe it&#039;ll get you video output, but there will be no gains - it will use VGA.</p></div></blockquote></div><p>I see several options for that in the BIOS. Right now it&#039;s set to [Enabled].</p></div></blockquote></div><p>By saying &quot;booting with CSM on&quot; i&#039;ve meant booting the VM with OVMF-with-csm image. My OVMF would always output on the serial instead of any graphics given, QXL, STD or passed through GPU.</p><p>About the rom... My suggestion would be placing the GPU in the first pci-e slot, booting with it and extracting the ROM. I can&#039;t extract ROM from my second card resting in pci-e x8(02:00.0) slot.</p> <p class="postedit"><em>Last edited by Duelist (2015-01-09 20:51:11)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491689">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491690" class="blockpost roweven"> <h2><span><span class="conr">#3810</span> <a href="viewtopic.php?pid=1491690#p1491690">2015-01-09 20:49:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>longyny wrote:</cite><blockquote><div><p>Hi,</p><p>I need some assistance, please. My rig has an Asus P9X79E-WS with Xeon E5-2670, 32gb of ram and 4x AMD R9 280x. What I want to do is to passthrough 2 GPU to the guest OS, but I don&#039;t know how to blacklist only 2 of them without blacklisting all 4 GPUs. I want to leave 2 GPUs for the Host OS&#160; with its own HDMI Audio Device, and the other pair for the Guest OS with its HDMI Audio Device.</p></div></blockquote></div><p>Somewhere in this thread, within the last couple weeks, is an example of someone using Xen&#039;s pci-back driver (not Xen itself) in place of pci-stub because it has the ability to claim based on bus address.</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1486869#p1486869" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1486869</a></p><div class="quotebox"><cite>JohnyPea wrote:</cite><blockquote><div><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.18.1-custom root=UUID=7ca2c85e-f29e-404d-91c7-92ad1e087465 ro splash ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1 iommu=pt iommu=1 xen-pciback.hide=(06:00.0)(06:00.1) default_hugepagesz=1G hugepagesz=1G panic=10 hugepages=6 isolcpus=2-7 vt.handoff=7</code></pre></div></div></blockquote></div><p><strong>xen-pciback.hide=(06:00.0)(06:00.1)</strong></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491690">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491749" class="blockpost rowodd"> <h2><span><span class="conr">#3811</span> <a href="viewtopic.php?pid=1491749#p1491749">2015-01-10 03:14:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Check if the GPU is used by some splash-screens. Do cat /proc/iomem and search the given memory range. I bet there is something like vesafb.</p></div></blockquote></div><p>Wow thanks, really, I was quite lost and comtemplating posiblity of changing the pc case because the 970 doesn&#039;t fit in the second slot<br />The culprit was &quot;efifb&quot; even it was not showing in lsmod, just recompiling the kernel without vesafb,efifb... did the trick</p><p>EDIT:<br />Seems that trying to boot host with CSM/legacy vbios causes Invalid ROM error, but booting host without CSM/Using UEFI vbios just works fine, interesting... (guest booting in legacy/uefi mode has the same outcome, seems that host booting mode matters)</p> <p class="postedit"><em>Last edited by Cubex (2015-01-10 03:28:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491749">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491799" class="blockpost roweven"> <h2><span><span class="conr">#3812</span> <a href="viewtopic.php?pid=1491799#p1491799">2015-01-10 11:10:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><p>Seems that trying to boot host with CSM/legacy vbios causes Invalid ROM error, but booting host without CSM/Using UEFI vbios just works fine, interesting... (guest booting in legacy/uefi mode has the same outcome, seems that host booting mode matters)</p></div></blockquote></div><p>Turn on CSM on host, try booting VM without CSM(pure-efi). What happens? It is obvious that if you turn off CSM on host, it won&#039;t work in VM while not using emulated graphics that have VGA(qxl-vga for example).<br />Turn on CSM on host, try booting VM with csm(with-csm). What happens? Invalid ROM contents error? Try passing the ROM via romfile= option to the vfio-pci device. You can get the ROM file on techpowerup vbios database(i personally don&#039;t like that approach, since my asus cards had serial number inside that can be omitted harmlessly, but you can&#039;t know for sure if it&#039;s all the same) or plugging the card into the first PCI-E slot(making it your ONLY host GPU) and dumping the ROM via sysfs as told in aw&#039;s blog post. The NASTY way of getting ROM out of the card is using GPU-Z or ATIWinFlash(or just ATIFlash) on windows, but it works with cards not-in-the-first-slot.<br />Also, it may turn out that your GPU(R7 240, yes?my HD7750 didn&#039;t originally, and they are rebadged R7 250E) doesn&#039;t support UEFI at all. In that case you can check your vendor&#039;s site(like asus.com) for bios updates - i did so and updated my cards&#039; VBIOS to make them support UEFI and GOP. Though there may be problems with some vendors(again, like asus) having a broken update tool.</p> <p class="postedit"><em>Last edited by Duelist (2015-01-10 11:11:28)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491799">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491825" class="blockpost rowodd"> <h2><span><span class="conr">#3813</span> <a href="viewtopic.php?pid=1491825#p1491825">2015-01-10 14:11:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Booting host with UEFI vbios or disabling CSM its the only way it works, the guest can be run using bios or ovmf<br />If I boot host with legacy vbios there is no way running the guest, yesterday tried with romfile too but nothing happens, anyways csm on host is not very relevant to me</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491825">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491832" class="blockpost roweven"> <h2><span><span class="conr">#3814</span> <a href="viewtopic.php?pid=1491832#p1491832">2015-01-10 14:42:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><p>Booting host with UEFI vbios or disabling CSM its the only way it works, the guest can be run using bios or ovmf<br />If I boot host with legacy vbios there is no way running the guest, yesterday tried with romfile too but nothing happens, anyways csm on host is not very relevant to me</p></div></blockquote></div><p>Oh my! I think i&#039;ve mistaken you with the other guy.</p><p>Forget all that i&#039;ve said there<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1491799#p1491799" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1491799</a><br />Sorry.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491832">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1491955" class="blockpost rowodd"> <h2><span><span class="conr">#3815</span> <a href="viewtopic.php?pid=1491955#p1491955">2015-01-10 22:37:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Check if the GPU is used by some splash-screens. Do cat /proc/iomem and search the given memory range. I bet there is something like vesafb.</p></div></blockquote></div><p>Wow thanks, really, I was quite lost and comtemplating posiblity of changing the pc case because the 970 doesn&#039;t fit in the second slot<br />The culprit was &quot;efifb&quot; even it was not showing in lsmod, just recompiling the kernel without vesafb,efifb... did the trick</p><p>EDIT:<br />Seems that trying to boot host with CSM/legacy vbios causes Invalid ROM error, but booting host without CSM/Using UEFI vbios just works fine, interesting... (guest booting in legacy/uefi mode has the same outcome, seems that host booting mode matters)</p></div></blockquote></div><p>That sounds a lot like the issue I had on my SuperMicro board (X10SAT).<br />My board has BIOS options for choosing primary dispaly device, and for what mode to use when loading the ROM from a given PCIe slot.</p><p>If I have the Intel card set as always-enabled and primary, I must also make sure the PCIe slot is set to &quot;legacy&quot; or &quot;disabled&quot; ROM loading.<br />Otherwise, even though it&#039;s not the primary device, the Radeon card will hijack the boot display.&#160; If I remember correctly, the Radeon became fb0 and the Intel became fb1.<br />Worse than that, though, is the fact that the device&#039;s framebuffer base address gets screwed up.&#160; This breaks everything, including the native-boot Windows Catalyst driver!</p><p>You may still be able to EFI boot the host with framebuffer if your BIOS lets you disable loading the discrete card&#039;s ROM.</p> <p class="postedit"><em>Last edited by DanaGoyette (2015-01-10 22:37:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1491955">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492019" class="blockpost roweven"> <h2><span><span class="conr">#3816</span> <a href="viewtopic.php?pid=1492019#p1492019">2015-01-11 04:21:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The problem is that my CPU doesn&#039;t have any IGPU so using a secondary 430 for host does solve, the good part about this new system is that I don&#039;t need to apply the override ACS patch, iommu grouping works fine out of box.</p><p>Seems that booting guest with seabios causes a host crash after ~8-10 secs, but using OVMF seems to work fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492019">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492040" class="blockpost rowodd"> <h2><span><span class="conr">#3817</span> <a href="viewtopic.php?pid=1492040#p1492040">2015-01-11 07:52:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...long story short...<br />I&#039;ve finally flashed my cards with UEFI-compatible &quot;secret&quot;(i can&#039;t get it anywhere anymore) firmware, but appears like windows7 doesn&#039;t really works right with it. I turn off CSM, boot up the windows, it shows the splash logo and then image freezes. Yay for windows7. So, OVMF/UEFI and windows 7 is possible but troublesome, so most folks shouldn&#039;t bother about it.</p></div></blockquote></div><p>Have you had any further success with UEFI Windows 7? I&#039;m stuck at this flash screen as well, unfortunately.</p><p>No errors or messages, just a pulsing &quot;Starting Windows&quot; logo indefinitely on both the installation disk and a boot disk.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492040">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492112" class="blockpost roweven"> <h2><span><span class="conr">#3818</span> <a href="viewtopic.php?pid=1492112#p1492112">2015-01-11 13:58:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>need a little help here:</p><p>PC:</p><div class="quotebox"><blockquote><div><p>Processor: Amd FX-8320<br />Motherboard: M597 Pro<br />8 GB ram<br />Video1: Asus Radeon R9 270<br />Video2: Sapphire Radeon HD 6850</p></div></blockquote></div><p>System:</p><div class="quotebox"><blockquote><div><p>arch linux, linux-uksm-ck 3.18.2</p></div></blockquote></div><p>For example, I want to passthrough video2</p><p>i have in my grub:</p><div class="quotebox"><blockquote><div><p>GRUB_CMDLINE_LINUX_DEFAULT=&quot;root=/dev/mapper/lvmVolume-lvmRoot discard rw iommu=pt iommu=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1 amd_iommu_dump=1 pci-stub.ids=1002:6739,1002:aa88,1002:43a0&quot;</p></div></blockquote></div><p>because:</p><p>lspci</p><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850] [1002:6739]<br />03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] [1002:aa88]</p></div></blockquote></div><p>and </p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ls /sys/bus/pci/devices/0000:03:00.0/iommu_group/devices/&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ~<br />0000:00:15.0&#160; 0000:03:00.0&#160; 0000:03:00.1<br />walkindude@Desktop&gt;</p></div></blockquote></div><p>so we need also </p><div class="quotebox"><blockquote><div><p>00:15.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) [1002:43a0]</p></div></blockquote></div><p>on start pci-stub gives me:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 2.983932] pci-stub: add 1002:6739 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.983954] pci-stub 0000:03:00.0: claimed by stub<br />[&#160; &#160; 2.983960] pci-stub: add 1002:AA88 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.983969] pci-stub 0000:03:00.1: claimed by stub<br />[&#160; &#160; 2.983973] pci-stub: add 1002:43A0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000</p></div></blockquote></div><p>my windows.xml (windows 10 9888):</p><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt;<br />&#160; &lt;name&gt;windows&lt;/name&gt;<br />&#160; &lt;uuid&gt;c8bc2373-6271-4810-991e-8618a0ee01d2&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;3145728&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;3145728&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &#160; &lt;loader type=&#039;pflash&#039;&gt;/usr/share/ovmf/ovmf_x64.bin&lt;/loader&gt;<br />&#160; &#160; &lt;bootmenu enable=&#039;yes&#039;/&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;clock offset=&#039;utc&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/virtio-win-0.1-94.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/brasero.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/var/lib/libvirt/images/vm1.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;4&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt;<br />&#160; &#160; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt;<br />&#160; &#160; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039;/&gt;<br />&#160; &#160; &lt;sound model=&#039;ich6&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;video&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;cirrus&#039; vram=&#039;16384&#039; heads=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/video&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x0cf3&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x9271&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&#160; &lt;seclabel type=&#039;none&#039; model=&#039;none&#039;/&gt;<br />&#160; &lt;qemu:commandline&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-vga&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;none&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.0,x-vga=on&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-runas&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;root&#039;/&gt;<br />&#160; &lt;/qemu:commandline&gt;<br />&lt;/domain&gt;</p></div></blockquote></div><p>after </p><div class="quotebox"><blockquote><div><p>sudo vfio-bind 0000:03:00.0 0000:03:00.1 0000:00:15.0</p></div></blockquote></div><p>and </p><div class="quotebox"><blockquote><div><p>sudo virsh start windows</p></div></blockquote></div><p>i get this:</p><div class="quotebox"><blockquote><div><p>error: Failed to start domain windows<br />error: internal error: process exited while connecting to monitor: 2015-01-11T13:57:15.773249Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12</p><p>2015-01-11T13:57:15.773322Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0x0, 0xa0000, 0x7f4d58000000) = -12 (Cannot allocate memory)<br />2015-01-11T13:57:15.773402Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12</p><p>2015-01-11T13:57:15.773429Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0xc0000, 0x20000, 0x7f4e23400000) = -12 (Cannot allocate memory)<br />2015-01-11T13:57:15.773481Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12</p><p>2015-01-11T13:57:15.773505Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0xe0000, 0x20000, 0x7f4e23600000) = -12 (Cannot allocate memory)<br />2015-01-11T13:57:15.773541Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12</p></div></blockquote></div><p>and in dmesg:</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; sudo dmesg | tail&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ~<br />[ 2727.433870] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2727.433929] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2727.433932] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570647] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570655] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570807] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570810] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570880] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570945] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />[ 2733.570947] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded<br />walkindude@Desktop&gt;</p></div></blockquote></div> <p class="postedit"><em>Last edited by walkindude (2015-01-11 14:25:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492112">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492120" class="blockpost rowodd"> <h2><span><span class="conr">#3819</span> <a href="viewtopic.php?pid=1492120#p1492120">2015-01-11 14:13:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Maybe I sould have said this earlier, AFAIK Windows 7 boots in UEFI mode, however doesn&#039;t support UEFI vbios. I remenber getting a boot error on bare metal when disabling CSM even If i was booting using UEFI mode.<br />If you can&#039;t use seabios or ovmf with csm (like me), use Win8+&#160; <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492120">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492132" class="blockpost roweven"> <h2><span><span class="conr">#3820</span> <a href="viewtopic.php?pid=1492132#p1492132">2015-01-11 14:53:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>need a little help here:</p><p>PC:</p><div class="codebox"><pre><code>Processor: Amd FX-8320 Motherboard: M597 Pro 8 GB ram Video1: Asus Radeon R9 270 Video2: Sapphire Radeon HD 6850</code></pre></div><p>System:</p><div class="codebox"><pre><code>arch linux, linux-uksm-ck 3.18.2</code></pre></div><p>For example, I want to passthrough video2</p><p>i have in my grub:</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;root=/dev/mapper/lvmVolume-lvmRoot discard rw iommu=pt iommu=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1 amd_iommu_dump=1 pci-stub.ids=1002:6739,1002:aa88,1002:43a0&quot;</code></pre></div><p>because:</p><p>lspci</p><div class="codebox"><pre><code>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850] [1002:6739] 03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] [1002:aa88]</code></pre></div><p>and </p><div class="codebox"><pre><code>walkindude@Desktop&gt; ls /sys/bus/pci/devices/0000:03:00.0/iommu_group/devices/ ~ 0000:00:15.0 0000:03:00.0 0000:03:00.1 walkindude@Desktop&gt; </code></pre></div><p>so we need also </p><div class="codebox"><pre><code>00:15.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) [1002:43a0]</code></pre></div></div></blockquote></div><p>No, the root ports never get bound to vfio-pci, only endpoints.&#160; There&#039;s a patch that just went upstream, and tagged for stable, that will prevent binding root ports, bridges, and switches to vfio-pci.</p><div class="quotebox"><blockquote><div><p>on start pci-stub gives me:</p><div class="codebox"><pre><code>[ 2.983932] pci-stub: add 1002:6739 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.983954] pci-stub 0000:03:00.0: claimed by stub [ 2.983960] pci-stub: add 1002:AA88 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.983969] pci-stub 0000:03:00.1: claimed by stub [ 2.983973] pci-stub: add 1002:43A0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000</code></pre></div><p>my windows.xml (windows 10 9888):</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;windows&lt;/name&gt; &lt;uuid&gt;c8bc2373-6271-4810-991e-8618a0ee01d2&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;3145728&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;3145728&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039;&gt;/usr/share/ovmf/ovmf_x64.bin&lt;/loader&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;clock offset=&#039;utc&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/walkindude/virtio-win-0.1-94.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/walkindude/brasero.iso&#039;/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/vm1.qcow2&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;cirrus&#039; vram=&#039;16384&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0cf3&#039;/&gt; &lt;product id=&#039;0x9271&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;none&#039; model=&#039;none&#039;/&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.0,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-runas&#039;/&gt; &lt;qemu:arg value=&#039;root&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div></div></blockquote></div><p>Well, you got 440fx and ovmf right, but all of your &lt;qemu:arg&gt; stuff needs to go away.&#160; <em>-vga none</em> doesn&#039;t get specified here, you do that in xml by deleting the &lt;video&gt; and &lt;graphics&gt; entries.&#160; You don&#039;t need <em>x-vga=on</em> because you&#039;re using ovmf, and trying to specify the <em>-runas</em> option here is pointless and futile.&#160; Use a proper &lt;hostdev&gt; entry with <em>managed=&quot;yes&quot;</em> to assign the GPU.</p><div class="quotebox"><blockquote><div><p>after </p><div class="codebox"><pre><code> sudo vfio-bind 0000:03:00.0 0000:03:00.1 0000:00:15.0</code></pre></div></div></blockquote></div><p>This becomes unnecessary when you properly define the device in the XML.</p><div class="quotebox"><blockquote><div><p>and </p><div class="codebox"><pre><code>sudo virsh start windows</code></pre></div><p>i get this:</p><div class="codebox"><pre><code>error: Failed to start domain windows error: internal error: process exited while connecting to monitor: 2015-01-11T13:57:15.773249Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12 2015-01-11T13:57:15.773322Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0x0, 0xa0000, 0x7f4d58000000) = -12 (Cannot allocate memory) 2015-01-11T13:57:15.773402Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12 2015-01-11T13:57:15.773429Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0xc0000, 0x20000, 0x7f4e23400000) = -12 (Cannot allocate memory) 2015-01-11T13:57:15.773481Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12 2015-01-11T13:57:15.773505Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f4e40656020, 0xe0000, 0x20000, 0x7f4e23600000) = -12 (Cannot allocate memory) 2015-01-11T13:57:15.773541Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: VFIO_MAP_DMA: -12</code></pre></div><p>and in dmesg:</p><div class="codebox"><pre><code>walkindude@Desktop&gt; sudo dmesg | tail ~ [ 2727.433870] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2727.433929] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2727.433932] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570647] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570655] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570807] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570810] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570880] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570945] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded [ 2733.570947] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded walkindude@Desktop&gt;</code></pre></div></div></blockquote></div><p>Both of these are because you&#039;re hiding the define from libvirt in &lt;qemu:arg&gt; options.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492132">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492147" class="blockpost rowodd"> <h2><span><span class="conr">#3821</span> <a href="viewtopic.php?pid=1492147#p1492147">2015-01-11 15:37:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />ok, thanks</p><p>so, i deleted video and graphics tags, and add this:</p><div class="quotebox"><blockquote><div><p>&lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;</p></div></blockquote></div><p>for</p><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850] [1002:6739]</p></div></blockquote></div><p>Is it right?</p><p>Now vm boots, i see spikes in virt-manager. I&#039;ve already installed windows, everything works in there, except catalyst always gives me VIDEO_TDR_FAILURE, that&#039;s why I tried to solve with qemu:args.</p><p>Stupid question: now, as I haven&#039;t any graphics in xml config, how do I see whats going on wm?<br />Tried to connect hdmi cable from gpu to my second monitor (it&#039;s a tv really, multiple hdmi outs) - nothing happens.<br />Previously I did it with the help of virt-manager, through VNC.</p> <p class="postedit"><em>Last edited by walkindude (2015-01-11 15:37:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492147">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492150" class="blockpost roweven"> <h2><span><span class="conr">#3822</span> <a href="viewtopic.php?pid=1492150#p1492150">2015-01-11 15:43:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>@aw<br />ok, thanks</p><p>so, i deleted video and graphics tags, and add this:</p><div class="quotebox"><blockquote><div><p>&lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;</p></div></blockquote></div><p>for</p><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850] [1002:6739]</p></div></blockquote></div><p>Is it right?</p><p>Now vm boots, i see spikes in virt-manager. I&#039;ve already installed windows, everything works in there, except catalyst always gives me VIDEO_TDR_FAILURE, that&#039;s why I tried to solve with qemu:args.</p><p>Stupid question: now, as I haven&#039;t any graphics in xml config, how do I see whats going on wm?<br />Tried to connect hdmi cable from gpu to my second monitor (it&#039;s a tv really, multiple hdmi outs) - nothing happens.<br />Previously I did it with the help of virt-manager, through VNC.</p></div></blockquote></div><p>&lt;qemu:args&gt; is almost never the right answer.&#160; Have you checked whether your HD 6850 actually supports UEFI in the ROM?&#160; You should be getting OVMF splash screen as well as the Windows loading animation on the connected screen.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492150">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492156" class="blockpost rowodd"> <h2><span><span class="conr">#3823</span> <a href="viewtopic.php?pid=1492156#p1492156">2015-01-11 16:06:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />When I was using graphics VNC, I indeed see OVMF splash screen (TianoCore) and after it Windows logo, than system boots as expected.<br />You had said that I need to delete &lt;graphics&gt; from xml, which I did. So I plug hdmi cable from 6850 to hdmi-out of tv-screen. It&#039;s also connect by another hdmi to first card, R9 and I have properly configured dual screen.<br />When I start the VM I tried to switch to another out of my tv, but it says only connecting... and then logo of LG appears - means nothing here.</p><p>I&#039;ve tried this videocard on the same hardware with the same windows UEFI - catalyst works. Also, before I bought this R9 I was running arch on UEFI with this HD 6850 - no problems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492156">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492158" class="blockpost roweven"> <h2><span><span class="conr">#3824</span> <a href="viewtopic.php?pid=1492158#p1492158">2015-01-11 16:14:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>@aw<br />When I was using graphics VNC, I indeed see OVMF splash screen (TianoCore) and after it Windows logo, than system boots as expected.</p></div></blockquote></div><p>This means the emulated graphics support UEFI and proves nothing about your 6850.</p><div class="quotebox"><blockquote><div><p>You had said that I need to delete &lt;graphics&gt; from xml, which I did. So I plug hdmi cable from 6850 to hdmi-out of tv-screen. It&#039;s also connect by another hdmi to first card, R9 and I have properly configured dual screen.<br />When I start the VM I tried to switch to another out of my tv, but it says only connecting... and then logo of LG appears - means nothing here.</p></div></blockquote></div><p>Not sounding good for UEFI support.</p><div class="quotebox"><blockquote><div><p>I&#039;ve tried this videocard on the same hardware with the same windows UEFI - catalyst works. Also, before I bought this R9 I was running arch on UEFI with this HD 6850 - no problems.</p></div></blockquote></div><p>Bare-meta UEFI systems almost always support the Compatibility Support Module (CSM), which allows support for legacy x86 option ROMs and VGA.&#160; So, this doesn&#039;t really prove anything either.&#160; To avoid VGA and all the issues that come with it, we explicitly do not want a CSM for our VM, which is why we use the pure-EFI OVMF image.&#160; There&#039;s a post on my blog (link below) to determine whether the card supports UEFI.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492164" class="blockpost rowodd"> <h2><span><span class="conr">#3825</span> <a href="viewtopic.php?pid=1492164#p1492164">2015-01-11 16:28:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />Thanks again for explanations. Now it gives me, when the driver for this card is pci-stub (lspci -kn)</p><div class="quotebox"><blockquote><div><p>cat rom &gt; /tmp/image.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;/sys/bus/pci/devices/0000:03:00.0<br />cat: rom: Input/output error</p></div></blockquote></div><p>Maybe I just try with the latest bios on <a href="http://www.techpowerup.com/" rel="nofollow">http://www.techpowerup.com/</a> ...</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ./rom-parser ~/Sapphire.HD6850.1024.110620.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ~/rom-parser<br />Valid ROM signature found @0h, PCIR offset 1f4h<br />&#160; &#160; PCIR: type 0, vendor: 1002, device: 6739, class: 030000<br />&#160; &#160; PCIR: revision 0, vendor revision: d0c<br />&#160; &#160; Last image</p></div></blockquote></div><p>latest from this site.. meanging no UEFI with this card?</p><p>and if I disable OVMF, and boot with seabios, should I see anything on screen which is connected to hd 6850 by hdmi? For now, it&#039;s nothing there.</p> <p class="postedit"><em>Last edited by walkindude (2015-01-11 17:52:03)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492164">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=152">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <strong>153</strong> <a href="viewtopic.php?id=162768&amp;p=154">154</a> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=154">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
