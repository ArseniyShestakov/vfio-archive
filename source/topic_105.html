<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 105) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=105" title="Page 105" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=104" title="Page 104" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=106" title="Page 106" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=104">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=103">103</a> <a href="viewtopic.php?id=162768&amp;p=104">104</a> <strong>105</strong> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=106">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1451907" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2601</span> <a href="viewtopic.php?pid=1451907#p1451907">2014-08-30 13:40:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This means you are not running a new enough QEMU.&#160; You need at least 2.1 for the kvm=off property.</p></div></blockquote></div><p>Ok, so got from git qemu 2.1.50, but when I then try to run my vm I just get a &#039;QEMU 2.1.50 monitor&#039; prompt?<br />Even added full path /usr/local/bin/qemu... to make sure was using.<br />And then I still get the same KVM internal error. Suberror: 1 emulation failure after a short time :\<br />May have to put the card in another machine to confirm all is working ok for a start (used card I just picked up). Or just stick with ATI cards..</p></div></blockquote></div><p>Does this resolve the emulation failure: <a href="https://git.kernel.org/cgit/virt/kvm/kvm.git/patch/?id=0a37027e83f867793af0ccb9176a6b383dd0b7c8" rel="nofollow">https://git.kernel.org/cgit/virt/kvm/kv … 383dd0b7c8</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451907">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451944" class="blockpost roweven"> <h2><span><span class="conr">#2602</span> <a href="viewtopic.php?pid=1451944#p1451944">2014-08-30 15:41:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Those errors are what we need to debug.&#160; rombar=0 tells QEMU to not expose a PCI option ROM for the device.&#160; Following that with romfile= makes QEMU put that rom in the genroms section, which is sort of like having it builtin to the BIOS.&#160; The problem with that is that it is no longer associated with the device, so unless you know ROM has the ability to scan through all the devices to find the hardware, you&#039;ve probably just broken the option ROM execution.</p><p>Remove the rombar option and report the error, if there is one.</p></div></blockquote></div><p>Ok, don&#039;t know about that.</p><br /><p>I removed &quot;rombar&quot; and &quot;romfile&quot;, magically qemu doesn&#039;t report any error/warning.<br />The only messages I got are from dmesg:</p><div class="codebox"><pre><code>vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>However the problem persist: black screen and can&#039;t connect to VNC server inside Windows 7.<br />The strangest thing is that I can arping the VM and nmap report its ip as &quot;up&quot;, but both nmap and vncviewer can&#039;t find open ports.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451944">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452096" class="blockpost rowodd"> <h2><span><span class="conr">#2603</span> <a href="viewtopic.php?pid=1452096#p1452096">2014-08-30 22:47:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Does this resolve the emulation failure: <a href="https://git.kernel.org/cgit/virt/kvm/kvm.git/patch/?id=0a37027e83f867793af0ccb9176a6b383dd0b7c8" rel="nofollow">https://git.kernel.org/cgit/virt/kvm/kv … 383dd0b7c8</a></p></div></blockquote></div><p>Thanks for the response.<br />Hmm, not sure sorry. Prob over my head <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />But I&#039;m trying to install Win7, so not 8.1 and no nvidia driver (yet). <br />Can&#039;t even get Win7 to install.<br />So much more painful that AMD/ATI!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452096">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452102" class="blockpost roweven"> <h2><span><span class="conr">#2604</span> <a href="viewtopic.php?pid=1452102#p1452102">2014-08-30 23:06:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Does this resolve the emulation failure: <a href="https://git.kernel.org/cgit/virt/kvm/kvm.git/patch/?id=0a37027e83f867793af0ccb9176a6b383dd0b7c8" rel="nofollow">https://git.kernel.org/cgit/virt/kvm/kv … 383dd0b7c8</a></p></div></blockquote></div><p>Thanks for the response.<br />Hmm, not sure sorry. Prob over my head <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />But I&#039;m trying to install Win7, so not 8.1 and no nvidia driver (yet). <br />Can&#039;t even get Win7 to install.<br />So much more painful that AMD/ATI!</p></div></blockquote></div><p>How did you install the qemu git version? Applying patches really isn&#039;t that complicated…</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452102">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452105" class="blockpost rowodd"> <h2><span><span class="conr">#2605</span> <a href="viewtopic.php?pid=1452105#p1452105">2014-08-30 23:13:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>How did you install the qemu git version? Applying patches really isn&#039;t that complicated…</p></div></blockquote></div><p>git clone, config, make, install.<br />Didn&#039;t spit out any errors I noticed. Took a while to configure though.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452105">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452143" class="blockpost roweven"> <h2><span><span class="conr">#2606</span> <a href="viewtopic.php?pid=1452143#p1452143">2014-08-31 04:08:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>theres no pain with nvidia... it just works. you got config issues.... @ansa89 your last log shows it&#039;s running normally...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452143">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452173" class="blockpost rowodd"> <h2><span><span class="conr">#2607</span> <a href="viewtopic.php?pid=1452173#p1452173">2014-08-31 07:02:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>theres no pain with nvidia... it just works. you got config issues.... @ansa89 your last log shows it&#039;s running normally...</p></div></blockquote></div><p>well, it actually differs.<br />while hd 6450 worked almost without any problems, i totally failed getting my gt 430 to work as well - there were many &quot;iterations&quot;/attempts to get it to work and lots of reading to try to get what i am doing wrong. either my card is somehow broken by itself or there is something else i am missing - for now i stick with hd 6450 only, the goal being simultaneous passthrough of 2 gpus to 2 different vms.</p><p>p.s. totally failed trying to get gt 430 working via ovmf, but that&#039;s another thing to look into. hard to understand what&#039;s wrong when no video is shown anywhere and there is no logs aside from usual &quot;enabling device ...&quot;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452173">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452175" class="blockpost roweven"> <h2><span><span class="conr">#2608</span> <a href="viewtopic.php?pid=1452175#p1452175">2014-08-31 07:21:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>well yeah... I tried 6 gpus from nvidia and 3 mbos form intel, all working, even on quad sli mbo 4gpu-s 4vm-s... but i guess u have amd mbo or (edit) NOT .. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&#160; i don&#039;t know but it works for me.</p> <p class="postedit"><em>Last edited by slis (2014-08-31 07:26:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452175">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452181" class="blockpost rowodd"> <h2><span><span class="conr">#2609</span> <a href="viewtopic.php?pid=1452181#p1452181">2014-08-31 08:24:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@ansa89 your last log shows it&#039;s running normally...</p></div></blockquote></div><p>Ok, but the problem persists, so somewhere there should be something that fails.<br />Any idea/test/patch/voodoo-magic?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452181">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452182" class="blockpost roweven"> <h2><span><span class="conr">#2610</span> <a href="viewtopic.php?pid=1452182#p1452182">2014-08-31 08:43:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>well yeah... I tried 6 gpus from nvidia and 3 mbos form intel, all working, even on quad sli mbo 4gpu-s 4vm-s... but i guess u have amd mbo or (edit) NOT .. :)&#160; i don&#039;t know but it works for me.</p></div></blockquote></div><p>MB: asrock z87 pro4<br />CPU: intel i7 4770<br />OS: fedora 20 x86_64<br />kernel: distro-based kernel-3.15.8 with i915 and vga arbiter patches<br />host GPU: integrated (intel i7 4770)<br />guest GPU0: radeon hd 6450 (Gigabyte GV-R645-1GI)&#160; &lt;-- worked almost flawlessly for several months already<br />guest GPU1: nvidia gt 430 (Palit GT 430)&#160; &lt;-- NOT working (most i got from it was showing video on first run (counting since host reboot/startup), than host freeze on second (again, counting since host reboot/startup) gpu passthrough attempt)</p><p>seems to me that there is something fundamentally different between nvidia and amd gpu passthrough (from configuration/setup/procedure point of view), but i haven&#039;t yet caught up on what exactly it is</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452182">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452216" class="blockpost rowodd"> <h2><span><span class="conr">#2611</span> <a href="viewtopic.php?pid=1452216#p1452216">2014-08-31 11:45:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@sinny well for REBOOT u need rom file from gpu (atleast that was case for mine 560ti, should be same for 4xx), without rombar option...</p><p>@ansa89 you could try to remove that bios-256k option and u don&#039;t need gpu romfile option... and if u edit that script when adding gpu, care for spaces / new lines... that could be reason for not booting</p> <p class="postedit"><em>Last edited by slis (2014-08-31 11:55:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452216">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452228" class="blockpost roweven"> <h2><span><span class="conr">#2612</span> <a href="viewtopic.php?pid=1452228#p1452228">2014-08-31 12:55:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84731">Cenm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-29</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><p>I&#039;ve managed to get everything working for the first boot of the VM but it fails for every subsequent boot with the error &#039;vfio-pci 0000:03:00.0: Invalid ROM contents&#039;</p><p>If I specify romfile=/path/to/rom I don&#039;t get the error but nothing appears on the screen.</p><p>I have also noticed when I kill the VM whatever was on the screen remains there until I start the VM again, at which point the screen turns off.</p><p>Any advice would be great.</p></div></blockquote></div><br /><p>Any ideas on getting this fixed? GPU is a GTX 560 Ti. As far as I can tell everything else works fine, but only once.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452228">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452273" class="blockpost rowodd"> <h2><span><span class="conr">#2613</span> <a href="viewtopic.php?pid=1452273#p1452273">2014-08-31 16:01:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@cenm are u dumping bios from gpu? or downloading from net? you should dump it... are u using latest qemu? etc...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452288" class="blockpost roweven"> <h2><span><span class="conr">#2614</span> <a href="viewtopic.php?pid=1452288#p1452288">2014-08-31 17:02:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>p.s. totally failed trying to get gt 430 working via ovmf, but that&#039;s another thing to look into. hard to understand what&#039;s wrong when no video is shown anywhere and there is no logs aside from usual &quot;enabling device ...&quot;</p></div></blockquote></div><p>Just added a new blog post: <a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">Does my graphics card support EFI?</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452288">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452289" class="blockpost rowodd"> <h2><span><span class="conr">#2615</span> <a href="viewtopic.php?pid=1452289#p1452289">2014-08-31 17:10:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><p>I&#039;ve managed to get everything working for the first boot of the VM but it fails for every subsequent boot with the error &#039;vfio-pci 0000:03:00.0: Invalid ROM contents&#039;</p><p>If I specify romfile=/path/to/rom I don&#039;t get the error but nothing appears on the screen.</p><p>I have also noticed when I kill the VM whatever was on the screen remains there until I start the VM again, at which point the screen turns off.</p><p>Any advice would be great.</p></div></blockquote></div><br /><p>Any ideas on getting this fixed? GPU is a GTX 560 Ti. As far as I can tell everything else works fine, but only once.</p></div></blockquote></div><p>You haven&#039;t told us what you&#039;re running or how you&#039;re running it.&#160; Recent QEMU, including 2.1 (maybe even 2.0) changed a lot about loading the ROM to make it more reliable.&#160; The 3.17 kernel adds the ability for VFIO to do bus reset when the device is closed, but both functions of the device need to be bound to vfio-pci for this to work.&#160; It works well on Nvidia, but not so well on newer AMD cards which falsely claim to support reset via PM state transition.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452292" class="blockpost roweven"> <h2><span><span class="conr">#2616</span> <a href="viewtopic.php?pid=1452292#p1452292">2014-08-31 17:20:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84731">Cenm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-29</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@cenm are u dumping bios from gpu? or downloading from net? you should dump it... are u using latest qemu? etc...</p></div></blockquote></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You haven&#039;t told us what you&#039;re running or how you&#039;re running it.&#160; Recent QEMU, including 2.1 (maybe even 2.0) changed a lot about loading the ROM to make it more reliable.&#160; The 3.17 kernel adds the ability for VFIO to do bus reset when the device is closed, but both functions of the device need to be bound to vfio-pci for this to work.&#160; It works well on Nvidia, but not so well on newer AMD cards which falsely claim to support reset via PM state transition.</p></div></blockquote></div><p>Dumped BIOS from GPU. Running QEMU 2.1.0-2, Kernel 3.16.1-1, vfio bound both the video and audio components of the GPU</p> <p class="postedit"><em>Last edited by Cenm (2014-08-31 17:24:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452292">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452293" class="blockpost rowodd"> <h2><span><span class="conr">#2617</span> <a href="viewtopic.php?pid=1452293#p1452293">2014-08-31 17:27:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@cenm are u dumping bios from gpu? or downloading from net? you should dump it... are u using latest qemu? etc...</p></div></blockquote></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You haven&#039;t told us what you&#039;re running or how you&#039;re running it.&#160; Recent QEMU, including 2.1 (maybe even 2.0) changed a lot about loading the ROM to make it more reliable.&#160; The 3.17 kernel adds the ability for VFIO to do bus reset when the device is closed, but both functions of the device need to be bound to vfio-pci for this to work.&#160; It works well on Nvidia, but not so well on newer AMD cards which falsely claim to support reset via PM state transition.</p></div></blockquote></div><p>Dumped BIOS from GPU. Running QEMU 2.1.0-2, Kernel 3.16.1-1, vfio bound</p></div></blockquote></div><p>You&#039;re still not telling us how you&#039;re running it or what hardware you have other than a GTX650Ti.&#160; If you expect your stock distro kernel to work, please see the OP or read-up on the blog below for the condensed version.&#160; If you&#039;d like to report a problem, please provide the base version and list any patches you&#039;ve applied for QEMU and kernel, the kernel command line options you&#039;re booting with, the host and guest graphics devices, whether this is an AMD or Intel system, and the commands/configuration used to start the guest.&#160; Please don&#039;t expect us to guess.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452293">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452295" class="blockpost roweven"> <h2><span><span class="conr">#2618</span> <a href="viewtopic.php?pid=1452295#p1452295">2014-08-31 17:28:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>are there any benefits with using ovfm other than getting rid of i915 patches/vga?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452295">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452297" class="blockpost rowodd"> <h2><span><span class="conr">#2619</span> <a href="viewtopic.php?pid=1452297#p1452297">2014-08-31 17:38:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>are there any benefits with using ovfm other than getting rid of i915 patches/vga?</p></div></blockquote></div><p>If that isn&#039;t enough reason, you may not have a full grasp of the problems with i915 and VGA arbitration <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Everything is currently upstream to be able to create OVMF VMs with assigned GPUs and manage them with libvirt.&#160; Eventually your distro will include this.&#160; AFAICT, i915 will never have working VGA arbitration and even if a plan comes about to support it, it could take years to deprecate the existing functionality to be able to implement it.&#160; Not to mention all the other holes with VGA, like the vgacon driver not participating so you may end up with a host login prompt on the guest VGA console.&#160; VGA is a fixed address space shared across the system and our management of it leaves much to be desired.&#160; It&#039;s best to stick with the resources specific to your device, which is how we operate under OVMF.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452297">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452304" class="blockpost roweven"> <h2><span><span class="conr">#2620</span> <a href="viewtopic.php?pid=1452304#p1452304">2014-08-31 17:56:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you for your&#160; answer. Since i use headless host, i guess i don&#039;t care about i915 working or not <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&#160; I thought about using 440fx instead q35 does it make any difference?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452304">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452311" class="blockpost rowodd"> <h2><span><span class="conr">#2621</span> <a href="viewtopic.php?pid=1452311#p1452311">2014-08-31 18:14:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Thank you for your&#160; answer. Since i use headless host, i guess i don&#039;t care about i915 working or not <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />&#160; I thought about using 440fx instead q35 does it make any difference?</p></div></blockquote></div><p>The theory with Q35 is that it more closely matches the host hardware topology and therefore is more likely to &quot;just work&quot;.&#160; In a small number of cases, this is true.&#160; The most apparent case is that of a Linux guest using the radeon driver, which attempts to negotiate link speed with the downstream port above it.&#160; In a 440FX model there is no such downstream port and the driver code in the guest effectively segfaults.&#160; If we want to use 440FX here we need to <a href="http://vfio.blogspot.com/2014/08/fixes-for-linux-radeon-with-440fx-guests.html" rel="nofollow">fix the driver</a> rather than change the guest machine to accommodate the driver.&#160; (Note that even in a Q35 model there is no negotiation with the parent downstream port.&#160; The parent device registers are only emulated and do not support negotiation)&#160; </p><p>In the majority of cases, the guest drivers work well independent of the VM topology.&#160; This seems to be the case with nouveau on Linux as well as the Nvidia and AMD drivers on Windows (nvidia/fglrx on Linux is untested).&#160; Therefore, using Q35 is often an unnecessary complication.</p><p>OVMF doesn&#039;t yet support Q35, so 440FX is currently your only option, but I expect that will eventually change.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452311">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452319" class="blockpost roweven"> <h2><span><span class="conr">#2622</span> <a href="viewtopic.php?pid=1452319#p1452319">2014-08-31 18:32:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks again for answers. Now i know more than i wanted <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /> i&#039;ll try omfv tommorow got some isp issues right now....</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452319">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452348" class="blockpost rowodd"> <h2><span><span class="conr">#2623</span> <a href="viewtopic.php?pid=1452348#p1452348">2014-08-31 19:35:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84731">Cenm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-29</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>@cenm are u dumping bios from gpu? or downloading from net? you should dump it... are u using latest qemu? etc...</p></div></blockquote></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You haven&#039;t told us what you&#039;re running or how you&#039;re running it.&#160; Recent QEMU, including 2.1 (maybe even 2.0) changed a lot about loading the ROM to make it more reliable.&#160; The 3.17 kernel adds the ability for VFIO to do bus reset when the device is closed, but both functions of the device need to be bound to vfio-pci for this to work.&#160; It works well on Nvidia, but not so well on newer AMD cards which falsely claim to support reset via PM state transition.</p></div></blockquote></div><p>Dumped BIOS from GPU. Running QEMU 2.1.0-2, Kernel 3.16.1-1, vfio bound</p></div></blockquote></div><p>You&#039;re still not telling us how you&#039;re running it or what hardware you have other than a GTX650Ti.&#160; If you expect your stock distro kernel to work, please see the OP or read-up on the blog below for the condensed version.&#160; If you&#039;d like to report a problem, please provide the base version and list any patches you&#039;ve applied for QEMU and kernel, the kernel command line options you&#039;re booting with, the host and guest graphics devices, whether this is an AMD or Intel system, and the commands/configuration used to start the guest.&#160; Please don&#039;t expect us to guess.</p></div></blockquote></div><p>...</p><p>Hardware:<br />&#160; 3930K C2 Stepping<br />&#160; Asus Extreme Rampage IV<br />&#160; Nvidia GTX680 (Host (Nouveau Driver))<br />&#160; Nvidia GTX560Ti (Guest)<br />&#160; <br />Stock kernel unpatched, but &gt;3.16 is the only thing mentioned as &#039;required&#039;<br />No QEMU Patches are suggested...</p><p>Kernel param&#039;s <br />&#160; intel_iommu=on <br />&#160; pci-stub.ids=10de:1200,10de:0e0c (GTX 560Ti audio and video components)</p><p>Basic command on the first page to start the VM + romfile option</p><p>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \<br />&#160; -smp 6,sockets=1,cores=6,threads=1 \<br />&#160; -bios /usr/share/qemu/bios.bin -vga none \<br />&#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/path/to/rom \<br />&#160; -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452348">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452356" class="blockpost roweven"> <h2><span><span class="conr">#2624</span> <a href="viewtopic.php?pid=1452356#p1452356">2014-08-31 20:03:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cenm wrote:</cite><blockquote><div><p>Hardware:<br />&#160; 3930K C2 Stepping<br />&#160; Asus Extreme Rampage IV<br />&#160; Nvidia GTX680 (Host (Nouveau Driver))<br />&#160; Nvidia GTX560Ti (Guest)<br />&#160; <br />Stock kernel unpatched, but &gt;3.16 is the only thing mentioned as &#039;required&#039;<br />No QEMU Patches are suggested...</p><p>Kernel param&#039;s <br />&#160; intel_iommu=on <br />&#160; pci-stub.ids=10de:1200,10de:0e0c (GTX 560Ti audio and video components)</p><p>Basic command on the first page to start the VM + romfile option</p><p>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \<br />&#160; -smp 6,sockets=1,cores=6,threads=1 \<br />&#160; -bios /usr/share/qemu/bios.bin -vga none \<br />&#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/path/to/rom \<br />&#160; -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1</p></div></blockquote></div><p>It&#039;s possible you need the &quot;other&quot; VGA arbiter patch listed in <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">question 4 of the FAQ</a>.&#160; That bug in arbitration was found with radeon, but if nouveau behaves similarly, the arbiter might be getting stuck with VGA routing enabled to the wrong device.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452356">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1452387" class="blockpost rowodd"> <h2><span><span class="conr">#2625</span> <a href="viewtopic.php?pid=1452387#p1452387">2014-08-31 21:58:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84731">Cenm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-29</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It&#039;s possible you need the &quot;other&quot; VGA arbiter patch listed in <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">question 4 of the FAQ</a>.&#160; That bug in arbitration was found with radeon, but if nouveau behaves similarly, the arbiter might be getting stuck with VGA routing enabled to the wrong device.</p></div></blockquote></div><p>Thanks. Will try that, but the same thing happens when the host is running the nvidia drivers.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1452387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=104">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=103">103</a> <a href="viewtopic.php?id=162768&amp;p=104">104</a> <strong>105</strong> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=106">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
