<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 121) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=121" title="Page 121" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=120" title="Page 120" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=122" title="Page 122" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=120">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=119">119</a> <a href="viewtopic.php?id=162768&amp;p=120">120</a> <strong>121</strong> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=122">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1467225" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3001</span> <a href="viewtopic.php?pid=1467225#p1467225">2014-10-18 12:02:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Mostly perfomance, but I had some trouble with OVMF not recognising non-scsi devices, so I have everything on scsi now.</p></div></blockquote></div><p>That&#039;s strange: I had the opposite problem.<br />If I want to use SCSI, will I also need &quot;-device virtio-scsi-pci,id=scsi&quot; option?</p></div></blockquote></div><p>As far as I know, yes. This option puts a virtual SCSI bus onto the PCI bus.<br />After you have created this SCSI bus, you can then add devices to it like this:</p><div class="codebox"><pre><code>-drive file=${WINDOWS_INSTALL_DISK},id=iso_install,if=none \ -device scsi-cd,bus=scsi.0,drive=iso_install</code></pre></div><p>or this:</p><div class="codebox"><pre><code>-drive file=/path/to/device,if=none,id=disk_primary \ -device scsi-hd,bus=scsi.0,drive=disk_primary</code></pre></div><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Sorry if this sound condescending, but are you sure you&#039;re on the serial console and not the compat monitor? That&#039;s what the compat monitor should be showing, not the serial console.<br />You should have three views to choose from (if your qemu is compiled with GTK and SDL at least):<br />View -&gt; compatmonitor0<br />View -&gt; serial0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;---- This is the one<br />View -&gt; parallel0</p></div></blockquote></div><p>My qemu is compiled without SDL nor GTK.<br />The explanation of this is that qemu reside on a headless pc (Xorg not installed at all) and all the work is done through ssh.</p></div></blockquote></div><p>If you don&#039;t mind me asking this, what is the use-case for this? VNC (which IIRC is what you&#039;re using) isn&#039;t even fast enough to use it for high-quality video transmission inside one PC (I tried) from guest to host. Not to mention the latency and spikes.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>EDIT: just found <a href="http://en.wikibooks.org/wiki/QEMU/Monitor" rel="nofollow">this</a>, so I can say I&#039;m accessing the qemu monitor console (hope it can be useful).</p></div></blockquote></div><p>Well, you need to see the output of the serial console. One way to do this would be to compile qemu-git like I said above (WITH sdl and gtk) and then start qemu over your ssh connection with X11 forwarding. That way, you should see the qemu window on your SSH client (with these three views) and be able to access the serial console. Read the &quot;X11 forwarding&quot; section of <a href="https://wiki.archlinux.org/index.php/Secure_Shell" rel="nofollow">this</a> wiki page,</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467225">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467243" class="blockpost roweven"> <h2><span><span class="conr">#3002</span> <a href="viewtopic.php?pid=1467243#p1467243">2014-10-18 12:52:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>After you have created this SCSI bus, you can then add devices to it like this:</p><div class="codebox"><pre><code>-drive file=${WINDOWS_INSTALL_DISK},id=iso_install,if=none \ -device scsi-cd,bus=scsi.0,drive=iso_install</code></pre></div><p>or this:</p><div class="codebox"><pre><code>-drive file=/path/to/device,if=none,id=disk_primary \ -device scsi-hd,bus=scsi.0,drive=disk_primary</code></pre></div></div></blockquote></div><p>Is exactly what I did, but after initial installation screen, Windows said &quot;cannot find installation media&quot; (probably due to lack of necessary drivers); so I ended up using IDE.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>If you don&#039;t mind me asking this, what is the use-case for this? VNC (which IIRC is what you&#039;re using) isn&#039;t even fast enough to use it for high-quality video transmission inside one PC (I tried) from guest to host. Not to mention the latency and spikes.</p></div></blockquote></div><p>You right about VNC performance, but I my idea was to use nVidia GameStream and/or Steam HomeStreaming (they had been created for this situation).</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Well, you need to see the output of the serial console. One way to do this would be to compile qemu-git like I said above (WITH sdl and gtk) and then start qemu over your ssh connection with X11 forwarding. That way, you should see the qemu window on your SSH client (with these three views) and be able to access the serial console. Read the &quot;X11 forwarding&quot; section of <a href="https://wiki.archlinux.org/index.php/Secure_Shell" rel="nofollow">this</a> wiki page,</p></div></blockquote></div><p>Isn&#039;t there a way to access serial0 without SDL/GTK (for example &quot;<a href="http://superuser.com/questions/126428/qemu-in-an-ssh-session-or-the-quest-for-the-nographic-option" rel="nofollow">-serial stdio</a>&quot; option)?<br />I&#039;m asking this because SDL has a ton of dependencies <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>EDIT: quote from <a href="http://forums.fedoraforum.org/showthread.php?t=159263" rel="nofollow">this (very outdated) thread</a>:</p><div class="quotebox"><blockquote><div><p>When I try the Ctrl+Alt+2 thing in VNC, I get a screen with a display &quot;serial0&quot;, with no &quot;(qemu)&quot; prompt as was implied in documentation. From what I gather from the aforementioned thread, the Ctrl+Alt+2 thing is disabled by default, won&#039;t get you to a QEMU Monitor.</p></div></blockquote></div><p>I tried Ctrl+Atl+2 and the console0 switched to (or at lest become) a black screen without the &quot;(qemu)&quot; prompt (however can&#039;t see &quot;serial0&quot; written anywhere).</p> <p class="postedit"><em>Last edited by Ansa89 (2014-10-18 14:41:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467243">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467291" class="blockpost rowodd"> <h2><span><span class="conr">#3003</span> <a href="viewtopic.php?pid=1467291#p1467291">2014-10-18 15:52:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>After you have created this SCSI bus, you can then add devices to it like this:</p><div class="codebox"><pre><code>-drive file=${WINDOWS_INSTALL_DISK},id=iso_install,if=none \ -device scsi-cd,bus=scsi.0,drive=iso_install</code></pre></div><p>or this:</p><div class="codebox"><pre><code>-drive file=/path/to/device,if=none,id=disk_primary \ -device scsi-hd,bus=scsi.0,drive=disk_primary</code></pre></div></div></blockquote></div><p>Is exactly what I did, but after initial installation screen, Windows said &quot;cannot find installation media&quot; (probably due to lack of necessary drivers); so I ended up using IDE.</p></div></blockquote></div><p>Yes, that is normal. That&#039;s not OVMF not finding your device, though (which would mean that the device does not show up on the UEFI shell), that&#039;s (as you suspected) Windows not having any Virtio drivers by default.<br />What guide did you follow? You <strong>need</strong> VirtIO drivers for Windows if you want to use VirtIO devices in a Windows guest, see <a href="http://www.linux-kvm.org/page/WindowsGuestDrivers/Download_Drivers" rel="nofollow">here</a>. If you want a direct download, you can grab the - currently - latest Fedora-compiled, signed VirtIO drivers for Windows <a href="http://alt.fedoraproject.org/pub/alt/virtio-win/archives/virtio-win-0.1-81/virtio-win-0.1-81.iso" rel="nofollow">here</a>. That is an iso file, so you have to add it to your machine <strong>without VirtIO, i.e. as a normal IDE drive</strong>, so Windows can find it (Adding &quot;-cdrom /path/to/virtio-win-0.1-81.iso&quot; to your qemu command should do it). Once you booted from the Windows installation disc and got to the part where the installer &quot;cannot find installation media&quot; you should be able to select &quot;Browse&quot; or something similar (cannot remember exactly what it is called), at which point you select the Win8 directory on the drive that corresponds to the virtio driver iso (should be the only CDROM drive at this point) and select all the VirtIO drivers that he shows you for installation. Afterwards, you should be able to continue the Windows installation normally.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>If you don&#039;t mind me asking this, what is the use-case for this? VNC (which IIRC is what you&#039;re using) isn&#039;t even fast enough to use it for high-quality video transmission inside one PC (I tried) from guest to host. Not to mention the latency and spikes.</p></div></blockquote></div><p>You right about VNC performance, but I my idea was to use nVidia GameStream and/or Steam HomeStreaming (they had been created for this situation).</p></div></blockquote></div><p>And in my experience they have not succeeded yet by a long shot. I&#039;ve tried Steam InhomeStreaming from the guest VM directly to the Gentoo host (no real network card involved) with the Guest using a VirtIO network card (which is currently the best in performance AFAIK).<br />I had my left monitor show the actual output of the guest VM (connected to the passed-through graphics card) and the right monitor be the Host&#039;s Steam Inhome-Streaming client with the following results at 1080p@60Hz:<br />If the screen content stays nearly the same or is very slow moving, you&#039;re not going to see a difference <em>on average</em>. But I saw a significant difference with fast-moving content, There were many skipped frames, the FPS count plummeted from 60 down do 30. Also, regardless of whether it&#039;s fast or slow-moving content, I had spikes which had the Inhome-Streaming client lag as far behind as one second (the missing frames were then completly skipped to get to the current frames).<br />I have no experience with nVidia GameStream, but I doubt they have a solution for network spikes. If the above is something you can live with, then definitely go for it, but for me this was unbearable.</p><p>But regardless of the above two paragraphs, you might really want to get your passthrough to work on its own, before moving on to that stuff, because right now you&#039;re trying two things at the same time without having confirmed the first thing to be working properly.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Well, you need to see the output of the serial console. One way to do this would be to compile qemu-git like I said above (WITH sdl and gtk) and then start qemu over your ssh connection with X11 forwarding. That way, you should see the qemu window on your SSH client (with these three views) and be able to access the serial console. Read the &quot;X11 forwarding&quot; section of <a href="https://wiki.archlinux.org/index.php/Secure_Shell" rel="nofollow">this</a> wiki page,</p></div></blockquote></div><p>Isn&#039;t there a way to access serial0 without SDL/GTK (for example &quot;<a href="http://superuser.com/questions/126428/qemu-in-an-ssh-session-or-the-quest-for-the-nographic-option" rel="nofollow">-serial stdio</a>&quot; option)?<br />I&#039;m asking this because SDL has a ton of dependencies <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> .</p><p>EDIT: quote from <a href="http://forums.fedoraforum.org/showthread.php?t=159263" rel="nofollow">this (very outdated) thread</a>:</p><div class="quotebox"><blockquote><div><p>When I try the Ctrl+Alt+2 thing in VNC, I get a screen with a display &quot;serial0&quot;, with no &quot;(qemu)&quot; prompt as was implied in documentation. From what I gather from the aforementioned thread, the Ctrl+Alt+2 thing is disabled by default, won&#039;t get you to a QEMU Monitor.</p></div></blockquote></div><p>I tried Ctrl+Atl+2 and the console0 switched to (or at lest become) a black screen without the &quot;(qemu)&quot; prompt (however can&#039;t see &quot;serial0&quot; written anywhere).</p></div></blockquote></div><p>Sorry, I have no further information about that. Although imho you should really get the passthrough to work properly <em>first</em> and <em>then</em> move on to accessing the VM via network. What&#039;s the problem with having the SDL dependencies, though. If your machine is even remotely close to good enough to be used for virtualised gaming, you should be able to give the host a few more MB. It&#039;s not like they&#039;ll slow down your host? Anyway, what I can tell you is that when you start QEMU with OVMF, the serial console will show the EFI shell, which you can then use to boot the Windows installer or the installed windows should it in fact be stuck there. Once the VM has booted an EFI program (like Windows bootloader) it will become black. Anyway, I would suggest to try qemu-git first, before doing anything else.</p> <p class="postedit"><em>Last edited by Calrama (2014-10-18 16:41:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467291">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467307" class="blockpost roweven"> <h2><span><span class="conr">#3004</span> <a href="viewtopic.php?pid=1467307#p1467307">2014-10-18 16:59:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I use in-home streaming and with option FAST + Unlimited bandwith (peaks about 90+mbps) = 0 frame drops at 1200p 60fps, no matter how fast screen moves....<br />If u install geforce experience&#160; and turn on / off shadowplay, that enables NVFBC for full desktop/better capture for streaming.<br /><a href="http://i.imgur.com/D2bWvrR.jpg" rel="nofollow">http://i.imgur.com/D2bWvrR.jpg</a> u can see at bottom that display latency is below 20ms and that screen is pretty much worst case scenario, lots of action, cpu suffers <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by slis (2014-10-18 17:10:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467307">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467367" class="blockpost rowodd"> <h2><span><span class="conr">#3005</span> <a href="viewtopic.php?pid=1467367#p1467367">2014-10-18 20:21:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Did anyone had this issue where nVidia&#039;s Windows drivers crash every 20 minutes , and produce artifacts on pretty much everything that moves on the screen ?</p><p>I&#039;m using 340.52 .</p><p>Removing ALL &quot;hv_enhancements&quot; EXCEPT &quot;hv_time&quot; seems to solve the issue + it finally allowed me to reboot the VM without crashing it .</p><p>And it seems that I didn&#039;t lose any performance too .</p><p>I will keep it running for 48 hours and see if the artifacts issues are indeed gone .</p><p>EDIT :</p><p>Nope , artifacts and horizontal tears still appear in videos . I want to update the drivers , but the new ones require the removal of &quot;hv_time&quot; . Will I lose THAT much of CPU performance by removing it ?</p> <p class="postedit"><em>Last edited by Denso (2014-10-18 21:41:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467367">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467485" class="blockpost roweven"> <h2><span><span class="conr">#3006</span> <a href="viewtopic.php?pid=1467485#p1467485">2014-10-19 07:23:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>That sounds more like hardware problem, too high oc/temp.</p><p>You will lose about 10-20% cpu performance by removing it.</p><p>Maybe u load wrong bios with romfile option?</p> <p class="postedit"><em>Last edited by slis (2014-10-19 08:27:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467485">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467511" class="blockpost rowodd"> <h2><span><span class="conr">#3007</span> <a href="viewtopic.php?pid=1467511#p1467511">2014-10-19 09:49:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78331">MichaelLong</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-06</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78331">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Did anyone had this issue where nVidia&#039;s Windows drivers crash every 20 minutes , and produce artifacts on pretty much everything that moves on the screen ?</p><p>I&#039;m using 340.52 .</p><p>Removing ALL &quot;hv_enhancements&quot; EXCEPT &quot;hv_time&quot; seems to solve the issue + it finally allowed me to reboot the VM without crashing it .</p><p>And it seems that I didn&#039;t lose any performance too .</p><p>I will keep it running for 48 hours and see if the artifacts issues are indeed gone .</p><p>EDIT :</p><p>Nope , artifacts and horizontal tears still appear in videos . I want to update the drivers , but the new ones require the removal of &quot;hv_time&quot; . Will I lose THAT much of CPU performance by removing it ?</p></div></blockquote></div><p>Hi Denso,</p><p>over time I&#039;ve tested my VM with three different graphic cards: </p><ul><li><p>AMD 5850</p></li><li><p>NVIDIA GTX 560 TI</p></li><li><p>NVIDIA GTX 980.</p></li></ul><p>With all of them I&#039;ve got vertical colored polygon-shaped artifacs, they flicker with different intensity and often related to the direction in which I&#039;m looking when playing a Battlefield 4 map. The problem occurs only after a few hours and can be &quot;solved&quot; be restarting the game. I would also rule out overheating problems because the mentioned cards are very different regarding their cooling solutions and I don&#039;t have those artifacts when playing on the same physical machine with the same hardware.</p><p>Also I found no relation to hv_*-parameters. There is no doubt a performance loss without hv_*-parameters. But my impression is that the host, more specifically the qemu-process produces more load.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467511">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467528" class="blockpost roweven"> <h2><span><span class="conr">#3008</span> <a href="viewtopic.php?pid=1467528#p1467528">2014-10-19 11:30:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>That sounds more like hardware problem, too high oc/temp.</p><p>You will lose about 10-20% cpu performance by removing it.</p><p>Maybe u load wrong bios with romfile option?</p></div></blockquote></div><p>This is a normal slim GT610 , no exotic thing and no OCing , just a small stock fan for web browsing .</p><p>And I don&#039;t specify a ROM file at all , it just &quot;works&quot; for passthrough .</p><div class="quotebox"><cite>MichaelLong wrote:</cite><blockquote><div><p>Hi Denso,</p><p>over time I&#039;ve tested my VM with three different graphic cards:</p><p>&#160; &#160; AMD 5850</p><p>&#160; &#160; NVIDIA GTX 560 TI</p><p>&#160; &#160; NVIDIA GTX 980.</p><p>With all of them I&#039;ve got vertical colored polygon-shaped artifacs, they flicker with different intensity and often related to the direction in which I&#039;m looking when playing a Battlefield 4 map. The problem occurs only after a few hours and can be &quot;solved&quot; be restarting the game. I would also rule out overheating problems because the mentioned cards are very different regarding their cooling solutions and I don&#039;t have those artifacts when playing on the same physical machine with the same hardware.</p><p>Also I found no relation to hv_*-parameters. There is no doubt a performance loss without hv_*-parameters. But my impression is that the host, more specifically the qemu-process produces more load.</p></div></blockquote></div><p>Exactly what I found today . There is no relation between my issues and hv_ parameters .</p><p>I have 2 exact VMs , one with a GTX770 and it works with no issues at all , I can reboot it , shutdown and launch it again , no issues at all .</p><p>The second one has a GT610 for my web browsing , it also works good except for this stupid reboot issue , it reboots ok until Windows logo finishes then it hangs forever . The host and other VMs are not affected though .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467528">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467533" class="blockpost rowodd"> <h2><span><span class="conr">#3009</span> <a href="viewtopic.php?pid=1467533#p1467533">2014-10-19 11:43:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dump bios from gt610 and use it to solve reboot issue. I think that is 5xx series rebranded and for me 560ti rebooting only worked with dumped bios.</p> <p class="postedit"><em>Last edited by slis (2014-10-19 11:43:50)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467533">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467563" class="blockpost roweven"> <h2><span><span class="conr">#3010</span> <a href="viewtopic.php?pid=1467563#p1467563">2014-10-19 13:31:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Dump bios from gt610 and use it to solve reboot issue. I think that is 5xx series rebranded and for me 560ti rebooting only worked with dumped bios.</p></div></blockquote></div><p>Well , a GPU-Z dump from the VM result in the exact same issue . Also , trying the way mentioned in Alex&#039;s blog results in input/output error (Invalid ROM contents) .</p><p>Any other way to obtain non-initialized ROM file ?</p><p>TechPowerUp&#039;s ROMs do not work at all and result in passthrough failure .</p><p>By the way , I tried dumping the ROM from the card while it wasn&#039;t touched by anything else other than PCI-STUB . VFIO was disabled , and VM wasn&#039;t started yet . So I don&#039;t know what was really wrong .</p> <p class="postedit"><em>Last edited by Denso (2014-10-19 13:51:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467563">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467604" class="blockpost rowodd"> <h2><span><span class="conr">#3011</span> <a href="viewtopic.php?pid=1467604#p1467604">2014-10-19 15:03:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>I use in-home streaming and with option FAST + Unlimited bandwith (peaks about 90+mbps) = 0 frame drops at 1200p 60fps, no matter how fast screen moves....<br />If u install geforce experience&#160; and turn on / off shadowplay, that enables NVFBC for full desktop/better capture for streaming.<br /><a href="http://i.imgur.com/D2bWvrR.jpg" rel="nofollow">http://i.imgur.com/D2bWvrR.jpg</a> u can see at bottom that display latency is below 20ms and that screen is pretty much worst case scenario, lots of action, cpu suffers <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Wow, thank you for that bit of information:<br />After enabling NVFBC as the encoder on the host&#160; AND VAAPI as the decoder on the guest (the latter of which took some fiddling on Gentoo), I only notice a slight lag between input and output on the client side (not noticeable on the monitor connected to the guest graphics card), which is still too much for FPS games. For everything else, though, this should be pretty good.<br />So, I have to retract my previous statement of them not getting it to work by a long shot, you just need to use a hardware encoder and a hardware decoder.</p> <p class="postedit"><em>Last edited by Calrama (2014-10-19 16:06:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467605" class="blockpost roweven"> <h2><span><span class="conr">#3012</span> <a href="viewtopic.php?pid=1467605#p1467605">2014-10-19 15:10:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Dump bios from gt610 and use it to solve reboot issue. I think that is 5xx series rebranded and for me 560ti rebooting only worked with dumped bios.</p></div></blockquote></div><p>Also , trying the way mentioned in Alex&#039;s blog results in input/output error (Invalid ROM contents) .</p><p>By the way , I tried dumping the ROM from the card while it wasn&#039;t touched by anything else other than PCI-STUB . VFIO was disabled , and VM wasn&#039;t started yet . So I don&#039;t know what was really wrong .</p></div></blockquote></div><p>Just for reference: I cannot access my GTK 660 TIs firmware that way either. Even in pristine pci-stub stub right after booting. I&#039;m not sure, but I think that&#039;s a thing with certain NVIDIA cards and hybrid firmware. My card came with only a legacy BIOS as its firmware, so for OVMF I had to flash it with the official ASUS tool. Before flashing - that is, when it had the legacy bios as firmware - I could dump the firmware like described in the blog you referenced, but after flashing the new firmware I get get the input/output error.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467605">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467735" class="blockpost rowodd"> <h2><span><span class="conr">#3013</span> <a href="viewtopic.php?pid=1467735#p1467735">2014-10-19 21:48:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Dump bios from gt610 and use it to solve reboot issue. I think that is 5xx series rebranded and for me 560ti rebooting only worked with dumped bios.</p></div></blockquote></div><p>Also , trying the way mentioned in Alex&#039;s blog results in input/output error (Invalid ROM contents) .</p><p>By the way , I tried dumping the ROM from the card while it wasn&#039;t touched by anything else other than PCI-STUB . VFIO was disabled , and VM wasn&#039;t started yet . So I don&#039;t know what was really wrong .</p></div></blockquote></div><p>Just for reference: I cannot access my GTK 660 TIs firmware that way either. Even in pristine pci-stub stub right after booting. I&#039;m not sure, but I think that&#039;s a thing with certain NVIDIA cards and hybrid firmware. My card came with only a legacy BIOS as its firmware, so for OVMF I had to flash it with the official ASUS tool. Before flashing - that is, when it had the legacy bios as firmware - I could dump the firmware like described in the blog you referenced, but after flashing the new firmware I get get the input/output error.</p></div></blockquote></div><p>Thank you . It wasn&#039;t surprising , as nvidia will do their best to fight this usage scenario of their cards .</p><p>This exact card was working fine on my previous system (AMD FX-8350 + 990FXA) , but with this X99 + i7-5930k it&#039;s not .</p><p>How about using a thin client + SPICE protocol instead of GPU passthrough , will it give a near-native performance ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467735">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467778" class="blockpost roweven"> <h2><span><span class="conr">#3014</span> <a href="viewtopic.php?pid=1467778#p1467778">2014-10-19 23:45:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Thank you . It wasn&#039;t surprising , as nvidia will do their best to fight this usage scenario of their cards .</p></div></blockquote></div><p>Suprising, no. Assholly, yes. But it works for me without artifacts so I&#039;m happy for now. Soon enough most new AAA games will have Linux support anyway with the Unreal 4 engine and several others having official support for it, so to me all of this is mostly for legacy-game support and bridging the intermission time.</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>This exact card was working fine on my previous system (AMD FX-8350 + 990FXA) , but with this X99 + i7-5930k it&#039;s not .</p></div></blockquote></div><p>I&#039;m using <a href="http://ark.intel.com/de/products/80810/Intel-Core-i5-4690-Processor-6M-Cache-up-to-3_90-GHz" rel="nofollow">this processor</a> on <a href="http://www.asrock.com/mb/Intel/Z97%20OC%20Formula/" rel="nofollow">this mainboard</a>. Warning, [OT]Never saw any real use-case for the *k processors or the i7 series for desktop systems (or overclocking in general for that matter)[/OT]. One thing, though: I know that Intel made the recent *K models Vt-d capable (previous generations were not, only the non-*K variants IIRC), but maybe there&#039;s an issue there? Seems somewhat unlikely, but you never know with all these black boxes.</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>How about using a thin client + SPICE protocol instead of GPU passthrough , will it give a near-nativthin cliente performance ?</p></div></blockquote></div><p>Not sure what you mean by that, sorry. Would you care to elaborate on that?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467778">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467779" class="blockpost rowodd"> <h2><span><span class="conr">#3015</span> <a href="viewtopic.php?pid=1467779#p1467779">2014-10-19 23:49:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Not sure what you mean by that, sorry. Would you care to elaborate on that?</p></div></blockquote></div><p>Umm , think of it as a VNC brother , only faster as I read . I&#039;ve done a little search about it , and it seems that it&#039;s still a bit laggy behind an actual GPU passthrough .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467779">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467780" class="blockpost roweven"> <h2><span><span class="conr">#3016</span> <a href="viewtopic.php?pid=1467780#p1467780">2014-10-19 23:53:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Not sure what you mean by that, sorry. Would you care to elaborate on that?</p></div></blockquote></div><p>Umm , think of it as a VNC brother , only faster as I read . I&#039;ve done a little search about it , and it seems that it&#039;s still a bit laggy behind an actual GPU passthrough .</p></div></blockquote></div><p>No, I&#160; know what SPICE is. But I don&#039;t understand what you want to do. SPICE is a protocol for remote control (like VNC), it has - AFAIK - nothing to do with your graphics card itself. You still need to either pass a graphics card to a virtualised Windows, or use a native Windows, so I don&#039;t get why you would bring SPICE into this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467780">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467786" class="blockpost rowodd"> <h2><span><span class="conr">#3017</span> <a href="viewtopic.php?pid=1467786#p1467786">2014-10-20 00:37:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Not sure what you mean by that, sorry. Would you care to elaborate on that?</p></div></blockquote></div><p>Umm , think of it as a VNC brother , only faster as I read . I&#039;ve done a little search about it , and it seems that it&#039;s still a bit laggy behind an actual GPU passthrough .</p></div></blockquote></div><p>No, I&#160; know what SPICE is. But I don&#039;t understand what you want to do. SPICE is a protocol for remote control (like VNC), it has - AFAIK - nothing to do with your graphics card itself. You still need to either pass a graphics card to a virtualised Windows, or use a native Windows, so I don&#039;t get why you would bring SPICE into this?</p></div></blockquote></div><p>The idea of using SPICE with a low-end thin client (maybe a thin client that costs less than a dedicated GPU) sounds good enough for web browsing and watching YouTube . It can also be a solution for those who don&#039;t have enough PCI-E lanes for more GPUs . But I watched it in action on a YT video , and it seems to stutter/lag . So it won&#039;t be a good replacement for GPU passthrough .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467786">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467881" class="blockpost roweven"> <h2><span><span class="conr">#3018</span> <a href="viewtopic.php?pid=1467881#p1467881">2014-10-20 12:40:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Umm , think of it as a VNC brother , only faster as I read . I&#039;ve done a little search about it , and it seems that it&#039;s still a bit laggy behind an actual GPU passthrough .</p></div></blockquote></div><p>No, I&#160; know what SPICE is. But I don&#039;t understand what you want to do. SPICE is a protocol for remote control (like VNC), it has - AFAIK - nothing to do with your graphics card itself. You still need to either pass a graphics card to a virtualised Windows, or use a native Windows, so I don&#039;t get why you would bring SPICE into this?</p></div></blockquote></div><p>The idea of using SPICE with a low-end thin client (maybe a thin client that costs less than a dedicated GPU) sounds good enough for web browsing and watching YouTube . It can also be a solution for those who don&#039;t have enough PCI-E lanes for more GPUs . But I watched it in action on a YT video , and it seems to stutter/lag . So it won&#039;t be a good replacement for GPU passthrough .</p></div></blockquote></div><p>Forgive me for being so blunt, but from my point of view you&#039;re still not answering my question about why you think about bringing in SPICE <em>as a replacement for a graphics card passthrough</em>. Please consider the following:</p><p>Setup A:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box and gets a graphics card passed through from the Linux host</p><p>Setup B:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box with an emulated graphics card (for QEMU that would be any of std,cirrus,qxl,vmware,...)</p><p>Setup C:</p><p>- Two separate hardware boxes, connected by some network (e.g. 1Gbit Ethernet, Infiniband, whatever)<br />- Box 1 has a native Linux running<br />- Box 2 has a native Windows running</p><p>These are essentially your choices (very abstract). The statement &quot;SPICE with a low-end thin client&quot; does not specify which, though, since the native Linux in all three setups could be such a thin client.<br />SPICE, VNC, or any such protocol is about how you control - in this context - the Windows machine (regardless of whether you have one or two boxes); the Windows machine (regardless of whether it is being virtualised or not) will still need access to a real, dedicated graphics card (setups A and C). I know of no way aroung that. In the far future when XenGT has become something that can actually be done with NVIDIA and AMD graphics cards, we will have a way around that by paravirtualising our graphics card analogous to how Vt-x/AMD-V paravirtualise your processor. But that&#039;s still quite a bit away.</p><p>SPICE is by definition not a replacement for a graphics card passthrough, it&#039;s about remote control and can be done regardless of whether you&#039;re doing such a passthrough, which is why I was - and still am - so confused by your posts about this.</p><p>From what I can gather from your posts, I believe - but am not certain - that what you meant was &quot;Setup B using SPICE for controlling the Windows VM from the Linux machine&quot;. Is that correct? If so, then you won&#039;t be able to use that for any GPU-heavy applications, since an emulated graphics card won&#039;t be even close to good enough to what you need for that, regardless of how good or bad SPICE is for streaming the video to you.</p> <p class="postedit"><em>Last edited by Calrama (2014-10-20 12:44:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467881">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467942" class="blockpost rowodd"> <h2><span><span class="conr">#3019</span> <a href="viewtopic.php?pid=1467942#p1467942">2014-10-20 17:08:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86040">mouton_sanglant</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-20</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone, &amp; thanks <strong>nbhs</strong> for this tutorial.</p><p>I I tried to set up a working VGA-Passthrough on my laptop for a few days now, I wish I could do it by myself with this excellent tutorial but it seems I&#039;m doing some things wrong. Now I&#039;m stuck, and I call for your help, it will be very appreciated.<br />I know this is experimental and there&#039;s a 50/50 chance that it work for my configuration but since I&#039;m not 100% sure I didn&#039;t forgot or misunderstood something, I prefer to ask before giving up.</p><p>I plugged in a screen with HDMI. (got VGA cable too)</p><p>Here is my setup:</p><div class="codebox"><pre><code>model: Acer Aspire 7745G proc: intel i5-540M (not the original one, I changed to get VT-d support, intel&#039;s KB tells it is supported: http://ark.intel.com/fr/products/43544/Intel-Core-i5-540M-Processor-3M-Cache-2_53-GHz) chipset: hm55 (still refering to intel&#039;s kb, should support VT-d too: http://ark.intel.com/products/43183/Intel-BD82HM55-PCH) host gpu (IGP): Intel® HD Graphics guest gpu: ATI Mobility Radeon HD5650</code></pre></div><p>In order to enable VT-d in BIOS, I had to flash it with a modded BIOS enabling Intel&#039;s hidden menu. VT-d was &quot;disabled&quot; ans I put it &quot;enabled&quot;</p><p><strong><span style="color: red">Question 0:</span></strong> First, I got a strange message in dmesg about DMAR:</p><div class="codebox"><pre><code># dmesg | grep -e DMAR -e IOMMU [ 0.000000] ACPI: DMAR 0x00000000937EF000 0000B8 (v01 INTEL CP_DALE 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.033446] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c9008020e30272 ecap 1000 [ 0.033451] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c0000020230272 ecap 1000 [ 0.033458] dmar: IOMMU 2: reg_base_addr fed93000 ver 1:0 cap c9008020630272 ecap 1000 --&gt;[ 0.348199] DMAR: BIOS has allocated no shadow GTT; disabling IOMMU for graphics [ 0.452912] DMAR: No ATSR found [ 0.452968] IOMMU 0 0xfed90000: using Register based invalidation [ 0.452969] IOMMU 2 0xfed93000: using Register based invalidation [ 0.452971] IOMMU: Setting RMRR: [ 0.452992] IOMMU: Setting identity map for device 0000:00:1a.0 [0x936e9000 - 0x936fffff] [ 0.453055] IOMMU: Setting identity map for device 0000:00:1d.0 [0x936e9000 - 0x936fffff] [ 0.453087] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.453108] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</code></pre></div><p>I can&#039;t find any understandable informations about this &quot;shadow GTT&quot;, every google search leads me to techy stuff. Seems to be something important, I dont&#039;t want to disable IOMMU for graphics, right ? Is it important ? Or is it just a message to tell &quot;your IGP can&#039;t be passed&quot; ? That would be ok since I don&#039;t want to pass the IGP but the discret gpu, right ?<br />I couldn&#039;t find anything about this GTT in the BIOS, I suppose it should be somewhere because I unlocked the hidden intel menus, maybe with an alternative name ?</p><p>Since I couldn&#039;t find anything about this issue, I tried to go further.</p><p>What I have done:<br />- install a fresh arch linux, the downloaded qemu from the main repository<br />- compile linux-mainstream with patches </p><div class="codebox"><pre><code># uname -r 3.17.0.1-mainline</code></pre></div><p>- set kernel parameters in bootloader</p><div class="codebox"><pre><code># cat /proc/cmdline BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=d28d848b-32ae-4fe9-b74e-3978972c840e rw intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=1002:68c1,1002:aa60 quiet</code></pre></div><p>- blacklist radeon<br />- configure pci-stub</p><div class="codebox"><pre><code># dmesg | grep pci-stub [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=d28d848b-32ae-4fe9-b74e-3978972c840e rw intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=1002:68c1,1002:aa60 quiet [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=d28d848b-32ae-4fe9-b74e-3978972c840e rw intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=1002:68c1,1002:aa60 quiet [ 0.694456] pci-stub: add 1002:68C1 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.694473] pci-stub 0000:01:00.0: claimed by stub [ 0.694481] pci-stub: add 1002:AA60 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.694490] pci-stub 0000:01:00.1: claimed by stub</code></pre></div><p>- setting up vfio &amp; KVM modules</p><div class="codebox"><pre><code># cat /etc/modprobe.d/vfio_iommu_type1.conf options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>- enable service to automatically bind the devices</p><p>- test it with the following command</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 \ -enable-kvm \ -m 2048 \ -M q35 \ -bios /usr/share/qemu/bios.bin \ -cpu host \ -vga none \ -device &#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039; \ -device &#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/mouton/GPUPT/vgabios.bin&#039; \ -device &#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039; \ -cdrom /home/mouton/GPUPT/win7.iso </code></pre></div><p>That&#039;s where I&#039;m stuck: qemu launches but laptop&#039;s screen show &quot;compat_monitor0 console from qemu&quot;. I can see there is cpu-usage so I suppose emulation works fine but I just can&#039;t see the results screen.</p><p><strong><span style="color: red">Question 1:</span></strong> Removing &quot;-vga none&quot;, it is functionning correctly, but from what I understood, the GPU is not passed then. Is it wrong ?</p><p>I tried with and without &quot;romfile=...&quot; result is the same. I dumped the rom from my graphic card with a liveCD, rom-parser returns the following</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 40h PCIR: type 0, vendor: 8086, device: 0046, class: 030000 PCIR: revision 0, vendor revision: 0 Last image</code></pre></div><p><strong><span style="color: red">Question 2:</span></strong> This is the first things which surprise me: vendor/device is 8086:0046 which correspond to my IGP. So, this is the vgabios from my IGP. Is it the correct vbios for &quot;romfile&quot; option or should I find a way to get the passthroughed GPU vbios ? (Which sounds logical to me, but I don&#039;t get the whole picture yet, so many confusion right now...)</p><p><strong><span style="color: red">Question 3:</span></strong> I&#039;m actually using qemu version 2.1.2 from official arch repository... I couldn&#039;t find a link in the thread for nbhs&#039; qemu. In the tutorial, it is advised not to use the qemu-git one so I didn&#039;t. Is it important ? Where can I find nbhs&#039; qemu and Seabios ? (couldn&#039;t find it too, all links are broken)</p><p><strong><span style="color: red">Question 4:</span></strong> Since it&#039;s my first time with vga-passthrough, I&#039;m not sure about the cable configuration. Actually I plugged a secondary screen on the HDMI connector of my laptop. Screen is not duplicated. However, when I plug a cable in the VGA connector, screen is duplicated. Should I use VGA instead or stay on HDMI ? (I assumed, since we pass the hdmi audio device, I should use HDMI)</p><p>What makes me persevere is I achieved to send some junk datas to the secondary screen with the &quot;echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/pci-stub/bind &quot; command. It worked once but I am not able to reproduce it.</p><p><strong><span style="color: red">Question 5:</span></strong> Last, I got so much confused with all the threads I read on the topic that I can&#039;t understand if I should or should not install the passed-through gpu drivers ?!</p><br /><p>If anyone could guide me in order to make my configuration work, I would greatly apreciate it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467942">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467943" class="blockpost roweven"> <h2><span><span class="conr">#3020</span> <a href="viewtopic.php?pid=1467943#p1467943">2014-10-20 17:13:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OK so after letting it rest for a while, and then starting to fiddle with it again, I have found what part in the command line ruined the booting (just entering &quot;QEMU 2.1.2 monitor&quot;)...<br />Whenever I remove the <em>-vga none</em> option it boots up fine. But whenever I add it back it gives me the console again.</p><p>What is going wrong here?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467943">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1467966" class="blockpost rowodd"> <h2><span><span class="conr">#3021</span> <a href="viewtopic.php?pid=1467966#p1467966">2014-10-20 18:57:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><div class="codebox"><pre><code>host gpu (IGP): Intel® HD Graphics guest gpu: ATI Mobility Radeon HD5650</code></pre></div></div></blockquote></div><p>Are you sure that&#039;s even feasible? In a normal PC, every graphics card has its own output ports (the IGP&#039;s ports are on the mainboard and every other graphics card has its on its own board).<br />In laptops - at least to the best of my knownledge - the dedicated graphics cards usually don&#039;t have any external ports, but instead operate as &quot;calculation slaves&quot; below the IGP, meaning that any output the dedicated graphics card produces is forwarded to the IGP through shared memory, which in turn forwards it to its own output ports (which is either the laptop&#039;s screen or the IGP&#039;s external ports). Even if you did pass through the dedicated card correctly, how would the guest OS know about using it correctly (since this card doesn&#039;t seem to be designed to be used on its own)? This is pure speculation on my part, of course, but I somewhat doubt the AMD drivers inside the guest system would be able to function properly (though I would be happy to be proven wrong).</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>In order to enable VT-d in BIOS, I had to flash it with a modded BIOS enabling Intel&#039;s hidden menu. VT-d was &quot;disabled&quot; ans I put it &quot;enabled&quot;</p><p><strong><span style="color: red">Question 0:</span></strong> First, I got a strange message in dmesg about DMAR:</p><div class="codebox"><pre><code>[...] --&gt;[ 0.348199] DMAR: BIOS has allocated no shadow GTT; disabling IOMMU for graphics [...]</code></pre></div><p>I can&#039;t find any understandable informations about this &quot;shadow GTT&quot;, every google search leads me to techy stuff.</p></div></blockquote></div><p>Personally I have not heard of &quot;shadow GTT&quot; before (speculation: it might be related to the shared memory I mentioned above; it could be that in order for the host to be able to pass through the dedicated graphics card, the bios needs to have allocated some extra memory, because the usual shared memory is in use by the host OS video driver), but a quick Google search turned up <a href="http://www.spinics.net/lists/linux-pci/msg09587.html" rel="nofollow">this commit</a>, which seems to imply that if this happens, your bios contains a bug. You might want to try asking the committer (who seems to be an Intel developer, so he should really know about this) for an explanation.</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>That&#039;s where I&#039;m stuck: qemu launches but laptop&#039;s screen show &quot;compat_monitor0 console from qemu&quot;. I can see there is cpu-usage so I suppose emulation works fine but I just can&#039;t see the results screen.</p></div></blockquote></div><p>Where would you expect the passed through graphics card&#039;s output to be shown? The external ports belong to the IGP (unless of course that is different for your specific laptop?).</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p><strong><span style="color: red">Question 1:</span></strong> Removing &quot;-vga none&quot;, it is functionning correctly, but from what I understood, the GPU is not passed then. Is it wrong ?</p></div></blockquote></div><div class="codebox"><pre><code>qemu-system-x86_64 --help | grep -A1 vga</code></pre></div><p>returns</p><div class="codebox"><pre><code>-vga [std|cirrus|vmware|qxl|xenfb|tcx|cg3|none] select video card type</code></pre></div><p>That is the graphics card you want QEMU to emulate. In other words, if you set &quot;std&quot; here, the VM will get an emulated graphics card of the type &quot;std&quot;. If you don&#039;t set this argument at all, the default (which is one of these, don&#039;t remember which) will be selected. If you select &quot;none&quot;, the VM will not have any emulated graphics card, which is what you usually want when you passthrough a real graphics card because you don&#039;t have any use for the emulated one. But the emulated graphics card should not interfere with the passed through graphics card in any way other then it being selected as the primary card. It should not have any effect on whether your card gets passed through correctly.</p><br /><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>I tried with and without &quot;romfile=...&quot; result is the same. I dumped the rom from my graphic card with a liveCD, rom-parser returns the following</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 40h PCIR: type 0, vendor: 8086, device: 0046, class: 030000 PCIR: revision 0, vendor revision: 0 Last image</code></pre></div><p><strong><span style="color: red">Question 2:</span></strong> This is the first things which surprise me: vendor/device is 8086:0046 which correspond to my IGP. So, this is the vgabios from my IGP. Is it the correct vbios for &quot;romfile&quot; option or should I find a way to get the passthroughed GPU vbios ? (Which sounds logical to me, but I don&#039;t get the whole picture yet, so many confusion right now...)</p></div></blockquote></div><p>If it is the bios of the IGP, then no, it&#039;s not the correct one to be set for your dedicated card. If you want to set a romfile option for the dedicated card you need a firmware compatible with the dedicated card.</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p><strong><span style="color: red">Question 4:</span></strong> Since it&#039;s my first time with vga-passthrough, I&#039;m not sure about the cable configuration. Actually I plugged a secondary screen on the HDMI connector of my laptop. Screen is not duplicated. However, when I plug a cable in the VGA connector, screen is duplicated. Should I use VGA instead or stay on HDMI ? (I assumed, since we pass the hdmi audio device, I should use HDMI)</p></div></blockquote></div><p>See my reasoning above. The external ports should all belong to the IGP so I don&#039;t see how you could see any output even if you passed through your card correctly. You could try installing a VNC on the guest OS while using an emulated graphics card and see if you can connect when not using one (and passing through your dedicated card).</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>What makes me persevere is I achieved to send some junk datas to the secondary screen with the &quot;echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/pci-stub/bind &quot; command. It worked once but I am not able to reproduce it.</p></div></blockquote></div><p>I cannot explain this one without reasonable doubt and it seems to contradict what I speculated about above, so take the above with a grain of salt. You should really try to get in touch with that Intel developer.</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p><strong><span style="color: red">Question 5:</span></strong> Last, I got so much confused with all the threads I read on the topic that I can&#039;t understand if I should or should not install the passed-through gpu drivers ?!</p></div></blockquote></div><p>In general you want to install the host&#039;s graphic card&#039;s driver in the host and the guest&#039;s graphics card&#039;s driver in the guest.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1467966">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468015" class="blockpost roweven"> <h2><span><span class="conr">#3022</span> <a href="viewtopic.php?pid=1468015#p1468015">2014-10-20 21:02:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85506">gyrfalco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-30</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Well, FWIW I now own an XFX HD7790 card.&#160; All I can confirm so far is that it&#039;s quite broken.&#160; VM reboots work well with the standard Windows VGA driver, but once the Catalyst drivers are loaded a reboot results</p></div></blockquote></div><p>SAPPHIRE Radeon HD 7790 1GB (non UEFI)<br />QEMU emulator version 2.1.50<br />seabios-1.7.5<br />q35 / -vga none</p><p>I succeeded to get a result: <a href="http://gpuz.techpowerup.com/14/10/20/2tg.png" rel="nofollow">http://gpuz.techpowerup.com/14/10/20/2tg.png</a></p><p>But only once, after uninstalling Catalyst in -vga qxl mode and starting machine in -vga none. Then i decided to install fresh system and repeat that procedure, but never been able to achieve the same result.&#160; <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468015">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468030" class="blockpost rowodd"> <h2><span><span class="conr">#3023</span> <a href="viewtopic.php?pid=1468030#p1468030">2014-10-20 22:02:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>No, I&#160; know what SPICE is. But I don&#039;t understand what you want to do. SPICE is a protocol for remote control (like VNC), it has - AFAIK - nothing to do with your graphics card itself. You still need to either pass a graphics card to a virtualised Windows, or use a native Windows, so I don&#039;t get why you would bring SPICE into this?</p></div></blockquote></div><p>The idea of using SPICE with a low-end thin client (maybe a thin client that costs less than a dedicated GPU) sounds good enough for web browsing and watching YouTube . It can also be a solution for those who don&#039;t have enough PCI-E lanes for more GPUs . But I watched it in action on a YT video , and it seems to stutter/lag . So it won&#039;t be a good replacement for GPU passthrough .</p></div></blockquote></div><p>Forgive me for being so blunt, but from my point of view you&#039;re still not answering my question about why you think about bringing in SPICE <em>as a replacement for a graphics card passthrough</em>. Please consider the following:</p><p>Setup A:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box and gets a graphics card passed through from the Linux host</p><p>Setup B:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box with an emulated graphics card (for QEMU that would be any of std,cirrus,qxl,vmware,...)</p><p>Setup C:</p><p>- Two separate hardware boxes, connected by some network (e.g. 1Gbit Ethernet, Infiniband, whatever)<br />- Box 1 has a native Linux running<br />- Box 2 has a native Windows running</p><p>These are essentially your choices (very abstract). The statement &quot;SPICE with a low-end thin client&quot; does not specify which, though, since the native Linux in all three setups could be such a thin client.<br />SPICE, VNC, or any such protocol is about how you control - in this context - the Windows machine (regardless of whether you have one or two boxes); the Windows machine (regardless of whether it is being virtualised or not) will still need access to a real, dedicated graphics card (setups A and C). I know of no way aroung that. In the far future when XenGT has become something that can actually be done with NVIDIA and AMD graphics cards, we will have a way around that by paravirtualising our graphics card analogous to how Vt-x/AMD-V paravirtualise your processor. But that&#039;s still quite a bit away.</p><p>SPICE is by definition not a replacement for a graphics card passthrough, it&#039;s about remote control and can be done regardless of whether you&#039;re doing such a passthrough, which is why I was - and still am - so confused by your posts about this.</p><p>From what I can gather from your posts, I believe - but am not certain - that what you meant was &quot;Setup B using SPICE for controlling the Windows VM from the Linux machine&quot;. Is that correct? If so, then you won&#039;t be able to use that for any GPU-heavy applications, since an emulated graphics card won&#039;t be even close to good enough to what you need for that, regardless of how good or bad SPICE is for streaming the video to you.</p></div></blockquote></div><p>Sorry for my lack of words (English isn&#039;t my native language <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />) , and yes , I meant setup B . Where I get to interact with the VM directly from the host or through an external client . I was wondering whether SPICE can offer a big performance improvement over regular VNC or RDP , and from what I saw on YT it&#039;s still somewhat laggy . Maybe this was off topic when it comes to GPU passthrough , but it can be a solution for web surfing , printing documents , and watching videos . (Especially when you lack PCI-E lanes to add more cards as I stated previously) .</p><p>Thank you <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468030">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468044" class="blockpost roweven"> <h2><span><span class="conr">#3024</span> <a href="viewtopic.php?pid=1468044#p1468044">2014-10-20 22:45:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>From what I can gather from your posts, I believe - but am not certain - that what you meant was &quot;Setup B using SPICE for controlling the Windows VM from the Linux machine&quot;. Is that correct? If so, then you won&#039;t be able to use that for any GPU-heavy applications, since an emulated graphics card won&#039;t be even close to good enough to what you need for that, regardless of how good or bad SPICE is for streaming the video to you.</p></div></blockquote></div><p>Sorry for my lack of words (English isn&#039;t my native language <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />) , and yes , I meant setup B . Where I get to interact with the VM directly from the host or through an external client . I was wondering whether SPICE can offer a big performance improvement over regular VNC or RDP , and from what I saw on YT it&#039;s still somewhat laggy . Maybe this was off topic when it comes to GPU passthrough , but it can be a solution for web surfing , printing documents , and watching videos . (Especially when you lack PCI-E lanes to add more cards as I stated previously) .</p><p>Thank you <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>No problem, it isn&#039;t my first language either. Alright, setup B it is. Do you mind my asking what the reason is? Web surfing, printing, watching videos, and pretty much anything else that does not expicitly depend on Windows-exclusive programs can be done on the Linux host, as well. And Intel&#039;s IGP are a lot more powerful than some people think, so even 1080p videos should be no problem at all. However, if you really want to do all of that on Windows, why even install Linux as the host? Just have Windows as the host and Linux in a VM (if you need the Linux at all, that is).</p><p>In either case, I don&#039;t think you should see stuttering from host-side if you use the &quot;std&quot; emulated graphics card (unless you intend to watch something really heavy, like a 1080p video). You don&#039;t need any extra VNC, or RDP there either, just use the normal monitor window that opens when you start the VM (I think it uses VNC internally, but I&#039;m not sure). If you want to connect from a different, separate box, however, you might want to look into Steam Inhome-streaming. I&#039;ve read on several pages that you can highjack it to get back at the desktop (i.e. have the Windows-desktop streamed to the client) and then you can just use any application you want through that. See <a href="http://steamcommunity.com/groups/homestream/discussions/0/540731690675937539/" rel="nofollow">this discussion</a> for some ways to do that.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468044">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468045" class="blockpost rowodd"> <h2><span><span class="conr">#3025</span> <a href="viewtopic.php?pid=1468045#p1468045">2014-10-20 22:48:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86040">mouton_sanglant</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-20</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello Calrama ! Thank you a lot for you suggestions !</p><p>I finally got it working !<br />The host display is on the laptop screen and the guest screen on the secondary screen. It works fine but I had some other duties to do so I couldn&#039;t finish my configuration right now but I will soon.</p><p>So the key issue was this vga bios misunderstanding. It became obvious as long as I was writting my request. So I completly disabled the IGP from the bios, then launched a live-cd, there I could dump the discrete gpu vbios. I specified it to qemu and it worked !</p><p>About the outputs ports, it&#039;s actually working on the hdmi. I will try on the VGA on next try.</p><p>The DMAR message is still there, but it doesn&#039;t seem to be an issue. Actually, there is something relative to memory in the BIOS: in the &quot;Video (Intel IGD) Control Sub-Menu&quot;, there is a parameter &quot;Total Graphics Memory&quot; which can be set to 128MB, 256MB or MaxDVMT. Informations says: &quot;Select the amount of Total Graphics Memory - Pre-Allocated + Fixed + DVMT for use by the Intel Graphics Device&quot; As I&#039;m actually working with OpenGL, I thought it was the framebuffer memory and nothing related to the DMA Remapping.<br />Well, I&#039;m still wondering what that really means...</p><p>I&#039;ll try to get in touch with this Intel guy, he would certainly know about it.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>I tried with and without &quot;romfile=...&quot; result is the same. I dumped the rom from my graphic card with a liveCD, rom-parser returns the following</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 40h PCIR: type 0, vendor: 8086, device: 0046, class: 030000 PCIR: revision 0, vendor revision: 0 Last image</code></pre></div><p><strong><span style="color: red">Question 2:</span></strong> This is the first things which surprise me: vendor/device is 8086:0046 which correspond to my IGP. So, this is the vgabios from my IGP. Is it the correct vbios for &quot;romfile&quot; option or should I find a way to get the passthroughed GPU vbios ? (Which sounds logical to me, but I don&#039;t get the whole picture yet, so many confusion right now...)</p></div></blockquote></div><p>If it is the bios of the IGP, then no, it&#039;s not the correct one to be set for your dedicated card. If you want to set a romfile option for the dedicated card you need a firmware compatible with the dedicated card.</p></div></blockquote></div><p>Yep, that&#039;s right, it bothered me a lot !</p><p>Anyway, thank you a lot for your time. I&#039;ll post again tomorrow to tell you if it&#039;s stable but the big part is done, know I&#039;m very satisfied and proud of my work. Gonna play with my new baby, hehe !</p><p>Have a nice day since then !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468045">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=120">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=119">119</a> <a href="viewtopic.php?id=162768&amp;p=120">120</a> <strong>121</strong> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=122">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
