<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 163) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=163" title="Page 163" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=162" title="Page 162" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=164" title="Page 164" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=162">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=161">161</a> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <strong>163</strong> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=164">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1499424" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4051</span> <a href="viewtopic.php?pid=1499424#p1499424">2015-02-03 17:58:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88401">Wooots</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-29</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Installed Windows 10 TP on the weekend through virt-manager, edited xml (virsh-edit) to use ovmf. So now I can manage everything with libvirt that&#039;s really great.</p><p>One question, I had to deactivate the hv_* options (@aw thanks for your blog) to get Code 43 Error away from my Nvidia GTX 780 (Next time I&#039;ll consider buying an AMD GPU)<br />I&#039;ve read that deactivating those extensions impose a performance penalty.</p><p>So has someone measured how big this penalty is?<br />Would be very interested in some numbers.</p> <p class="postedit"><em>Last edited by Wooots (2015-02-03 18:01:33)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499424">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499433" class="blockpost roweven"> <h2><span><span class="conr">#4052</span> <a href="viewtopic.php?pid=1499433#p1499433">2015-02-03 18:13:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wooots wrote:</cite><blockquote><div><p>Installed Windows 10 TP on the weekend through virt-manager, edited xml (virsh-edit) to use ovmf. So now I can manage everything with libvirt that&#039;s really great.</p><p>One question, I had to deactivate the hv_* options (@aw thanks for your blog) to get Code 43 Error away from my Nvidia GTX 780 (Next time I&#039;ll consider buying an AMD GPU)<br />I&#039;ve read that deactivating those extensions impose a performance penalty.</p><p>So has someone measured how big this penalty is?<br />Would be very interested in some numbers.</p></div></blockquote></div><p>You can test this yourself, download a version of the nvidia driver prior to 337.88, re-enable all the hyperv extensions and run your benchmarks.&#160; It depends on the benchmark what you&#039;ll see, but I&#039;m sure folks here would appreciate seeing your results.&#160; Note that you really want to test both hyperv enabled vs disabled on the same old driver, then for graphics, test again with the new driver and hyperv disabled.&#160; I think you&#039;ll find that the new driver more than compensates for the missing hyperv extensions, but non-graphics related benchmarks may still suffer slightly.</p> <p class="postedit"><em>Last edited by aw (2015-02-03 18:22:44)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499433">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499438" class="blockpost rowodd"> <h2><span><span class="conr">#4053</span> <a href="viewtopic.php?pid=1499438#p1499438">2015-02-03 18:29:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is this impossible to achieve on Core 2 Duo P9500? I was unable to find precise information but one site claimed that VT-d is available only from i7 onwards.</p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499438">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499465" class="blockpost roweven"> <h2><span><span class="conr">#4054</span> <a href="viewtopic.php?pid=1499465#p1499465">2015-02-03 19:29:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><p>Is this impossible to achieve on Core 2 Duo P9500? I was unable to find precise information but one site claimed that VT-d is available only from i7 onwards.</p></div></blockquote></div><p>Maybe.&#160; For some reason Intel was shipping VT-d on laptop chipsets way before servers.&#160; The Core 2 Duos were before Intel moved graphics onto the CPU.&#160; With the graphics, VT-d also had to migrate to the CPU.&#160; So in this generation, while the CPU doesn&#039;t show any signs of VT-d (<a href="http://ark.intel.com/products/35566" rel="nofollow">http://ark.intel.com/products/35566</a>), the chipset actually does (<a href="http://ark.intel.com/products/35135" rel="nofollow">http://ark.intel.com/products/35135</a>), assuming you&#039;re talking about the W500 in your sig and google told me the right chipset.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499465">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499473" class="blockpost rowodd"> <h2><span><span class="conr">#4055</span> <a href="viewtopic.php?pid=1499473#p1499473">2015-02-03 19:53:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes, that&#039;s W500 with dual Intel+Ati graphics. Is there a way to check for sure whether it supports it?</p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499473">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499475" class="blockpost roweven"> <h2><span><span class="conr">#4056</span> <a href="viewtopic.php?pid=1499475#p1499475">2015-02-03 19:55:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><p>Yes, that&#039;s W500 with dual Intel+Ati graphics. Is there a way to check for sure whether it supports it?</p></div></blockquote></div><p>Boot with <em>intel_iommu=on</em>, run <em>find /sys/kernel/iommu_groups</em>&#160; If you have groups and devices, then you have VT-d.&#160; That of course doesn&#039;t guarantee that you&#039;ll be able to get VGA assignment working, hybrid graphic laptops can be tricky.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499475">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499482" class="blockpost rowodd"> <h2><span><span class="conr">#4057</span> <a href="viewtopic.php?pid=1499482#p1499482">2015-02-03 20:06:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88401">Wooots</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-29</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok did a quick performance test</p><p>For the cpu-test I used the free geekbench and for gpu test I used 3D Mark Firestrike test.<br />My Hardware: i7-4930k, Geforce GTX-780</p><p>Results with hv options on:<br />&#160; - Geekbench (Single): 3314<br />&#160; - Geekbench (Multi): 20082<br />&#160; - 3D Mark: 9424, Graphics Score 10441</p><p>Results with hv options off:<br />&#160; - Geekbench (Single): 3203<br />&#160; - Geekbench (Multi): 19410<br />&#160; - 3D Mark: 9045, Graphics Score 10249</p><p>Cpufreq governor was set to ondemand, next time i&#039;ll use performance.<br />On the 3D Mark Score, the Graphics Score is more interesting, because I didn&#039;t install PhysX, and physics calculation has a high impact on 3D Mark Score (Correct me if I&#039;m wrong).</p><p>To sum up:<br />CPU: -3.4% (96.6%)<br />GPU: -1.9% (98.1%)</p><p>It was just a quick test but for the first, hv options seems not a really big performance penalty. I can live with that.<br />I would have to do these performance tests multiple times to get a more accurate value. I guess the cpu value could be +-1% when tested multiple times.</p> <p class="postedit"><em>Last edited by Wooots (2015-02-03 20:11:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499482">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499484" class="blockpost roweven"> <h2><span><span class="conr">#4058</span> <a href="viewtopic.php?pid=1499484#p1499484">2015-02-03 20:15:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Boot with <em>intel_iommu=on</em>, run <em>find /sys/kernel/iommu_groups</em>&#160; If you have groups and devices, then you have VT-d.&#160; That of course doesn&#039;t guarantee that you&#039;ll be able to get VGA assignment working, hybrid graphic laptops can be tricky.</p></div></blockquote></div><p>The groups and devices are there. I guess I will have to try, then.</p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499484">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499498" class="blockpost rowodd"> <h2><span><span class="conr">#4059</span> <a href="viewtopic.php?pid=1499498#p1499498">2015-02-03 20:50:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Wow, I didn&#039;t know that Intel had VT-D pre Core i7 processors. Super cool!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499498">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499499" class="blockpost roweven"> <h2><span><span class="conr">#4060</span> <a href="viewtopic.php?pid=1499499#p1499499">2015-02-03 20:51:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>Wow, I didn&#039;t know that Intel had VT-D pre Core i7 processors. Super cool!</p></div></blockquote></div><p>It exists on many i5 processors as well.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499499">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499521" class="blockpost rowodd"> <h2><span><span class="conr">#4061</span> <a href="viewtopic.php?pid=1499521#p1499521">2015-02-03 21:33:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am not clear on the vfio-bind part. You wrote you have two radeons, so have to&#160; use pci-stub. But since I have intel+radeon, I can just blacklist radeon and skip entire 2nd point, right?<br />Then, running vfio-bind, I only need to run it with BusID of radeon card, and not the audio, right? </p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0</code></pre></div><p>Because I only have one Audio device and it&#039;s Intel:</p><div class="codebox"><pre><code>$ lspci | grep Audio 00:1b.0 Audio device: Intel Corporation 82801I (ICH9 Family) HD Audio Controller (rev 03</code></pre></div> <p class="postedit"><em>Last edited by Lockheed (2015-02-03 21:34:37)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499521">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499535" class="blockpost roweven"> <h2><span><span class="conr">#4062</span> <a href="viewtopic.php?pid=1499535#p1499535">2015-02-03 22:51:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><p>I am not clear on the vfio-bind part. You wrote you have two radeons, so have to&#160; use pci-stub. But since I have intel+radeon, I can just blacklist radeon and skip entire 2nd point, right?<br />Then, running vfio-bind, I only need to run it with BusID of radeon card, and not the audio, right? </p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0</code></pre></div><p>Because I only have one Audio device and it&#039;s Intel:</p><div class="codebox"><pre><code>$ lspci | grep Audio 00:1b.0 Audio device: Intel Corporation 82801I (ICH9 Family) HD Audio Controller (rev 03</code></pre></div></div></blockquote></div><p>Can you post your full &#039;lspci -nn&#039; output?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499535">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499537" class="blockpost rowodd"> <h2><span><span class="conr">#4063</span> <a href="viewtopic.php?pid=1499537#p1499537">2015-02-03 22:52:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre class="vscroll"><code>00:00.0 Host bridge [0600]: Intel Corporation Mobile 4 Series Chipset Memory Controller Hub [8086:2a40] (rev 07) 00:01.0 PCI bridge [0604]: Intel Corporation Mobile 4 Series Chipset PCI Express Graphics Port [8086:2a41] (rev 07) 00:02.0 VGA compatible controller [0300]: Intel Corporation Mobile 4 Series Chipset Integrated Graphics Controller [8086:2a42] (rev 07) 00:03.0 Communication controller [0780]: Intel Corporation Mobile 4 Series Chipset MEI Controller [8086:2a44] (rev 07) 00:03.3 Serial controller [0700]: Intel Corporation Mobile 4 Series Chipset AMT SOL Redirection [8086:2a47] (rev 07) 00:1a.0 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #4 [8086:2937] (rev 03) 00:1a.1 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #5 [8086:2938] (rev 03) 00:1a.2 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #6 [8086:2939] (rev 03) 00:1a.7 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #2 [8086:293c] (rev 03) 00:1b.0 Audio device [0403]: Intel Corporation 82801I (ICH9 Family) HD Audio Controller [8086:293e] (rev 03) 00:1c.0 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 1 [8086:2940] (rev 03) 00:1c.1 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 2 [8086:2942] (rev 03) 00:1c.2 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 3 [8086:2944] (rev 03) 00:1c.3 PCI bridge [0604]: Intel Corporation 82801I (ICH9 Family) PCI Express Port 4 [8086:2946] (rev 03) 00:1d.0 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #1 [8086:2934] (rev 03) 00:1d.1 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #2 [8086:2935] (rev 03) 00:1d.2 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB UHCI Controller #3 [8086:2936] (rev 03) 00:1d.7 USB controller [0c03]: Intel Corporation 82801I (ICH9 Family) USB2 EHCI Controller #1 [8086:293a] (rev 03) 00:1e.0 PCI bridge [0604]: Intel Corporation 82801 Mobile PCI Bridge [8086:2448] (rev 93) 00:1f.0 ISA bridge [0601]: Intel Corporation ICH9M-E LPC Interface Controller [8086:2917] (rev 03) 00:1f.2 SATA controller [0106]: Intel Corporation 82801IBM/IEM (ICH9M/ICH9M-E) 4 port SATA Controller [AHCI mode] [8086:2929] (rev 03) 00:1f.3 SMBus [0c05]: Intel Corporation 82801I (ICH9 Family) SMBus Controller [8086:2930] (rev 03) 01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] RV635/M86 [Mobility Radeon HD 3650] [1002:9591] 03:00.0 Network controller [0280]: Intel Corporation Ultimate N WiFi Link 5300 [8086:4236] 04:00.0 Memory controller [0580]: Intel Corporation Turbo Memory Controller [8086:444e] (rev 11) 05:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02) 15:00.0 CardBus bridge [0607]: Ricoh Co Ltd RL5c476 II [1180:0476] (rev ba) 15:00.2 SD Host controller [0805]: Ricoh Co Ltd R5C822 SD/SDIO/MMC/MS/MSPro Host Adapter [1180:0822] (rev 21) 15:00.4 System peripheral [0880]: Ricoh Co Ltd R5C592 Memory Stick Bus Host Adapter [1180:0592] (rev 11) 15:00.5 System peripheral [0880]: Ricoh Co Ltd xD-Picture Card Controller [1180:0852] (rev 11)</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499537">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499539" class="blockpost roweven"> <h2><span><span class="conr">#4064</span> <a href="viewtopic.php?pid=1499539#p1499539">2015-02-03 22:58:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><p>I am not clear on the vfio-bind part. You wrote you have two radeons, so have to&#160; use pci-stub. But since I have intel+radeon, I can just blacklist radeon and skip entire 2nd point, right?<br />Then, running vfio-bind, I only need to run it with BusID of radeon card, and not the audio, right? </p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0</code></pre></div><p>Because I only have one Audio device and it&#039;s Intel:</p><div class="codebox"><pre><code>$ lspci | grep Audio 00:1b.0 Audio device: Intel Corporation 82801I (ICH9 Family) HD Audio Controller (rev 03</code></pre></div></div></blockquote></div><p>The set of devices largely depends on the isolation of the devices, which is represented by the IOMMU groups (<a href="http://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html" rel="nofollow">http://vfio.blogspot.com/2014/08/iommu- … d-out.html</a>).&#160; So we really need to see what your groups look like (that directory you ran <em>find</em> on before).&#160; In an ideal case, you can just blacklist radeon or use pci-stub for just the GPU.&#160; You may need to apply the ACS patch to break down groups into something usable (at your own risk).&#160; Hybrid laptops like this often have the VGA BIOS for the discrete card buried in the system firmware/ACPI, so you might have fun trying to get it.&#160; Since AMD has a fair success rate as a secondary GPU for the VM, that&#039;s the route I&#039;d probably start with to avoid that problem as well as VGA arbitration.&#160; The good news is that your system is old enough that you probably don&#039;t need the i915 VGA arbitration patch if you do end going the primary head/VGA route.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499539">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499578" class="blockpost rowodd"> <h2><span><span class="conr">#4065</span> <a href="viewtopic.php?pid=1499578#p1499578">2015-02-04 03:02:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>The problem is windows 7 requires a CSM present in order to boot, thats why you&#039;re stuck on the windows logo, i posted a <a href="https://bbs.archlinux.org/viewtopic.php?pid=1483550#p1483550" rel="nofollow">workarround</a> a few pages back, i recommend you use windows 8 instead.</p></div></blockquote></div><p>Does Win8 and Win8.1 have EFI difference?</p><p>Now I&#039;m trying to boot Win8.1 ISO, and trying to convert as img file /w FAT32 format and included bootx64.efi.<br />But both of them can&#039;t boot in OVMF, the EFI can&#039;t find any bootable devices.</p><p>EDIT:</p><p>Finally, I started install Windows 8 now.<br />I use my trump card: Mount USB 2.0 into VM and use USB Stick to install Windows 8, and it worked without any problem.</p> <p class="postedit"><em>Last edited by AKSN74 (2015-02-04 04:01:13)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499578">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499593" class="blockpost roweven"> <h2><span><span class="conr">#4066</span> <a href="viewtopic.php?pid=1499593#p1499593">2015-02-04 05:07:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I&#039;m successfully install WIn8 in VM with OVMF, but I found something strange.</p><p>My mouse and keyboard get &#039;laggy&#039; when in Win8 desktop, and while I test 3DMark on VM, some scenes will get hangs about 0.3 to 0.5 second<br />It never happen when I still use legacy BIOS with WIn7. And I&#039;m sure that its not caused by HDD.<br />How can I improve the performance and less delay?</p><p>BTW, now my GPU is GTX980.</p> <p class="postedit"><em>Last edited by AKSN74 (2015-02-04 05:09:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499593">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499596" class="blockpost rowodd"> <h2><span><span class="conr">#4067</span> <a href="viewtopic.php?pid=1499596#p1499596">2015-02-04 05:10:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>Now I&#039;m successfully install WIn8 in VM with OVMF, but I found something strange.</p><p>My mouse and keyboard get &#039;laggy&#039; when in Win8 desktop, and while I test 3DMark on VM, some scenes will get hangs about 0.3 to 0.5 second<br />It never happen when I still use legacy BIOS with WIn7.<br />How can I improve the performance and less delay?</p><p>BTW, now my GPU is GTX980.</p></div></blockquote></div><p>PIn vcpus, hugepages, hv-time, etc.</p> <p class="postedit"><em>Last edited by nbhs (2015-02-04 05:10:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499596">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499604" class="blockpost roweven"> <h2><span><span class="conr">#4068</span> <a href="viewtopic.php?pid=1499604#p1499604">2015-02-04 07:07:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>PIn vcpus, hugepages, hv-time, etc.</p></div></blockquote></div><p>Thanks for advice!</p><p>Now I added hv_time after -cpu host</p><div class="codebox"><pre><code>-cpu host,hv_time,kvm=off</code></pre></div><p>And the result of 3DMARK seems good</p><p><a href="http://www.3dmark.com/3dm/5775755" rel="nofollow">3DMARK result Webpage</a></p><p><span class="postimg"><img src="http://i.imgur.com/gyI5P1P.png" alt="gyI5P1P.png" /></span></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499608" class="blockpost rowodd"> <h2><span><span class="conr">#4069</span> <a href="viewtopic.php?pid=1499608#p1499608">2015-02-04 07:51:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87815">MrTUX-10</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:speer.jesse25@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>Now I&#039;m successfully install WIn8 in VM with OVMF, but I found something strange.</p><p>My mouse and keyboard get &#039;laggy&#039; when in Win8 desktop, and while I test 3DMark on VM, some scenes will get hangs about 0.3 to 0.5 second<br />It never happen when I still use legacy BIOS with WIn7.<br />How can I improve the performance and less delay?</p><p>BTW, now my GPU is GTX980.</p></div></blockquote></div><p>PIn vcpus, hugepages, hv-time, etc.</p></div></blockquote></div><br /><p>How do you pin the vcpus while using a script instead of virsh? Thanks in advance!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499608">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499610" class="blockpost roweven"> <h2><span><span class="conr">#4070</span> <a href="viewtopic.php?pid=1499610#p1499610">2015-02-04 08:04:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I got another problem.</p><p>After the test, I reboot my VM, gets Win8 crashes (How sucks of Win8......)</p><p>So, I re-install Win8 and NVIDIA Driver (347.25)<br />But now my GTX980 gets &quot;Warning&quot; icon and can&#039;t use.</p><p>I thought the reason is perhaps the hv_time. Because when I turn it on, it got a same problem at first time. (But solved by re-install driver.)<br />This time. it&#039;s still happening even I re-install driver.</p><p>EDIT: Problem solved if delete hv_time and re-install driver.<br />Really strange, it&#039;s not happen before.</p> <p class="postedit"><em>Last edited by AKSN74 (2015-02-04 08:12:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499610">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499618" class="blockpost rowodd"> <h2><span><span class="conr">#4071</span> <a href="viewtopic.php?pid=1499618#p1499618">2015-02-04 08:41:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lael wrote:</cite><blockquote><div><p>Hi guys congrats to this humongus thread!</p><p>I have been wanting to do such a setup for a long time, had some experience with XEN but i bought the wrong cpu for this with no vt-d and i postponed up until now that i am able to buy new hardware and would like to hear what parts to look out for and hopefully have less hassle setting everything up.</p><p>The doc with the listed Mainboards <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a> is a huge help but i fear that some info might be missing like info on Revision and the Motheboards i checked so far seem to be a quite a few years old but i am not done with the list yet.</p><p>Thanks for any suggestions.</p></div></blockquote></div><p>I have good experience with workstation class SuperMicro X9DA7&#160; - no compatibility issues of any kind, can turn on and off ROM of any individual slot, all slots on separate IOMMUs and also builtin hardware (USB and eth), can even redirect BIOS console to serial port. I use it with Xeon E5-2630 v2 and ECC memory.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499618">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499624" class="blockpost roweven"> <h2><span><span class="conr">#4072</span> <a href="viewtopic.php?pid=1499624#p1499624">2015-02-04 08:52:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre class="vscroll"><code>$ find /sys/kernel/iommu_groups /sys/kernel/iommu_groups /sys/kernel/iommu_groups/0 /sys/kernel/iommu_groups/0/devices /sys/kernel/iommu_groups/0/devices/0000:00:00.0 /sys/kernel/iommu_groups/1 /sys/kernel/iommu_groups/1/devices /sys/kernel/iommu_groups/1/devices/0000:00:01.0 /sys/kernel/iommu_groups/1/devices/0000:01:00.0 /sys/kernel/iommu_groups/2 /sys/kernel/iommu_groups/2/devices /sys/kernel/iommu_groups/2/devices/0000:00:02.0 /sys/kernel/iommu_groups/3 /sys/kernel/iommu_groups/3/devices /sys/kernel/iommu_groups/3/devices/0000:00:03.0 /sys/kernel/iommu_groups/3/devices/0000:00:03.3 /sys/kernel/iommu_groups/4 /sys/kernel/iommu_groups/4/devices /sys/kernel/iommu_groups/4/devices/0000:00:1a.0 /sys/kernel/iommu_groups/4/devices/0000:00:1a.1 /sys/kernel/iommu_groups/4/devices/0000:00:1a.2 /sys/kernel/iommu_groups/4/devices/0000:00:1a.7 /sys/kernel/iommu_groups/5 /sys/kernel/iommu_groups/5/devices /sys/kernel/iommu_groups/5/devices/0000:00:1b.0 /sys/kernel/iommu_groups/6 /sys/kernel/iommu_groups/6/devices /sys/kernel/iommu_groups/6/devices/0000:00:1c.0 /sys/kernel/iommu_groups/6/devices/0000:00:1c.1 /sys/kernel/iommu_groups/6/devices/0000:00:1c.2 /sys/kernel/iommu_groups/6/devices/0000:00:1c.3 /sys/kernel/iommu_groups/6/devices/0000:03:00.0 /sys/kernel/iommu_groups/6/devices/0000:04:00.0 /sys/kernel/iommu_groups/6/devices/0000:05:00.0 /sys/kernel/iommu_groups/7 /sys/kernel/iommu_groups/7/devices /sys/kernel/iommu_groups/7/devices/0000:00:1d.0 /sys/kernel/iommu_groups/7/devices/0000:00:1d.1 /sys/kernel/iommu_groups/7/devices/0000:00:1d.2 /sys/kernel/iommu_groups/7/devices/0000:00:1d.7 /sys/kernel/iommu_groups/8 /sys/kernel/iommu_groups/8/devices /sys/kernel/iommu_groups/8/devices/0000:00:1e.0 /sys/kernel/iommu_groups/8/devices/0000:15:00.0 /sys/kernel/iommu_groups/8/devices/0000:15:00.2 /sys/kernel/iommu_groups/8/devices/0000:15:00.4 /sys/kernel/iommu_groups/8/devices/0000:15:00.5 /sys/kernel/iommu_groups/9 /sys/kernel/iommu_groups/9/devices /sys/kernel/iommu_groups/9/devices/0000:00:1f.0 /sys/kernel/iommu_groups/9/devices/0000:00:1f.2 /sys/kernel/iommu_groups/9/devices/0000:00:1f.3</code></pre></div><br /><p>What is better/easier - blacklisting, or using PCI stub? Do I understand it right that you suggest going the pci-stub route because of VGA BIOS being integrated into system firmware?</p><p>I plan to use Intel GPU for the host system and give Radeon entirely to qemu. Not sure if that&#039;s what you meant by </p><div class="quotebox"><blockquote><div><p>you probably don&#039;t need the i915 VGA arbitration patch if you do end going the primary head/VGA route.</p></div></blockquote></div><p>?</p><p>Also, when I am not running qemu, is there a way to keep using radeon (occasionally) with DRI_PRIME?</p><br /><p>EDIT:<br />I booted with that custom kernel form the OP, but it has negative influence on the radeon GPU temperature. It skyrockets to ~90 C even when not in use and the fan is running like crazy. Perhaps it disables power management for it?</p> <p class="postedit"><em>Last edited by Lockheed (2015-02-04 10:41:32)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499624">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499660" class="blockpost rowodd"> <h2><span><span class="conr">#4073</span> <a href="viewtopic.php?pid=1499660#p1499660">2015-02-04 10:23:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Ok so I&#039;ve finally setup serial console and my host is finally headless. I was able to capture this when restarting virtual machine, which is Windows 7 (no EFI). This happens when VM is started after guest reboot </p><div class="codebox"><pre><code>[ 250.730914] kernel BUG at drivers/pci/ats.c:138!</code></pre></div><p>My kernel is 3.17.8 , I&#039;m planning upgrade to 3.18 &quot;any moment now&quot; but due to zfs used as a root filesystem this requires little work. This only happens if I restart virtual machine which is using FirePro W7100 - restart of the other virtual machine using FirePro V4900 does not trigger this bug. After hitting this bug it is not possible to gracefully shutdown qemu.</p></div></blockquote></div><p>That&#039;s saying that the device had ATS (Address Translation Services) enabled before reset, but when we went to restore the state of it after reset, we couldn&#039;t even find the capability.&#160; Maybe the device never really recovers from reset?</p></div></blockquote></div><p>Got it. I suppose I should complain to AMD support ...</p></div></blockquote></div><p>so I asked Sapphire support (it&#039;s their card) but no reply yet. I&#039;m tempted to experiment with a quirk for the device to disable ATS detection on boot. Any hints where to start?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499660">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499720" class="blockpost roweven"> <h2><span><span class="conr">#4074</span> <a href="viewtopic.php?pid=1499720#p1499720">2015-02-04 13:49:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>Now I got another problem.</p><p>After the test, I reboot my VM, gets Win8 crashes (How sucks of Win8......)</p><p>So, I re-install Win8 and NVIDIA Driver (347.25)<br />But now my GTX980 gets &quot;Warning&quot; icon and can&#039;t use.</p><p>I thought the reason is perhaps the hv_time. Because when I turn it on, it got a same problem at first time. (But solved by re-install driver.)<br />This time. it&#039;s still happening even I re-install driver.</p><p>EDIT: Problem solved if delete hv_time and re-install driver.<br />Really strange, it&#039;s not happen before.</p></div></blockquote></div><p>As reported countless times in this thread, the latest Nvidia driver is incompatible with hyper-v extensions, including hv_time.&#160; The driver doesn&#039;t seem to detect these extensions on every boot, which can lead to confusing issues like this, but hv_time and friends should never be recommended for Nvidia users.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499720">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499725" class="blockpost rowodd"> <h2><span><span class="conr">#4075</span> <a href="viewtopic.php?pid=1499725#p1499725">2015-02-04 14:13:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>I can confirm that I no longer have <a href="https://bbs.archlinux.org/viewtopic.php?pid=1495470#p1495470" rel="nofollow">DMAR issues</a> with 3.18.5 <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=162">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=161">161</a> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <strong>163</strong> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=164">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
