<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 54) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=54" title="Page 54" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=53" title="Page 53" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=55" title="Page 55" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=53">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=52">52</a> <a href="viewtopic.php?id=162768&amp;p=53">53</a> <strong>54</strong> <a href="viewtopic.php?id=162768&amp;p=55">55</a> <a href="viewtopic.php?id=162768&amp;p=56">56</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=55">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1391318" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1326</span> <a href="viewtopic.php?pid=1391318#p1391318">2014-03-11 21:13:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>trying to pass through a Radeon HD 5770, but can&#039;t get it to work</p><p>Using this as the only GPU (i.e. start qemu with -vga none) completely freezes the host some time during the boot of the guest. If I get a glimpse of dmesg on the host, it shows errors of some PCI device. Sometimes the AHCI controller, sometimes the USB controller. Sometimes I get &quot;[R600] flush TLB failed&quot;. </p><p>If I pass the GPU as the secondary device (-vga std), it works with a Linux guest. I can start X and run glxgears hardware accelerated.</p><p>It does not work, however, with a Windows 7 guest. Device Manager shows error 10 (can not start device). <span class="bbs">If I disable the device then scan for hardware changes, Windows BSODs with bugcheck 0x000000F4 (some system thread/process stopped).</span> (Edit: this has nothing to do with GPU passthrough. It also happens, if I don&#039;t pass through the GPU.)</p><p>Chipset: AMD 990FX<br />Kernel: 3.14.0-rc5<br />Qemu: qemu-git as of today<br />GPU:<br />06:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Juniper XT [Radeon HD 5770]<br />06:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Juniper HDMI Audio [Radeon HD 5700 Series]</p><p>I run qemu as root with the following command line :</p><div class="codebox"><pre><code>~/dev/kvm-gpu-passthrough/qemu/x86_64-softmmu/qemu-system-x86_64 \ -nodefaults \ -runas spielzeug \ -monitor unix:monitor,server,nowait \ -L ~/dev/kvm-gpu-passthrough/qemu/pc-bios \ -drive file=spielzeug.img,if=virtio,cache=none,media=disk \ -boot order=c \ -smp 4 \ -cpu host \ -m 4096M \ -net nic,model=virtio,macaddr=52:54:00:12:34:57 \ -net tap,ifname=tap0,script=no,downscript=no \ -localtime \ -enable-kvm \ -M q35 \ -sdl \ -vga std \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=0000:06:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=0000:06:00.1,bus=root.1,addr=00.1 \ -usbdevice tablet</code></pre></div><p>I&#039;ve already tried different things, like assigning the audio device to pcie.0, using other cpu types, providing a biosfile, but none of these fixed the problems.</p><p><strong>Edit</strong><br />I&#039;ve now switched around my GPUs and pass through a Radeon HD 6450. This works! I can boot the guest with this GPU as the only/primary GPU and install the AMD Catalyst driver in the guest. So it might be that the HD 5770 just does some naughty stuff. I have to use different PCI ports, however, because of space reasons. So this might also be a factor.</p><p>I still can&#039;t use the passed-through GPU as secondary GPU. It now says Code 12 (not enough free resources that it can use).</p><p>I&#039;d still really like to pass through the HD 5770. So my original problem remains.</p> <p class="postedit"><em>Last edited by rawuza (2014-03-14 11:39:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391318">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391368" class="blockpost roweven"> <h2><span><span class="conr">#1327</span> <a href="viewtopic.php?pid=1391368#p1391368">2014-03-11 23:57:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><p>Using this as the only GPU (i.e. start qemu with -vga none) completely freezes the host some time during the boot of the guest. If I get a glimpse of dmesg on the host, it shows errors of some PCI device. Sometimes the AHCI controller, sometimes the USB controller. Sometimes I get &quot;[R600] flush TLB failed&quot;.</p></div></blockquote></div><p>This might sound random, but I had similar problems with 3.14-rc4, so you might try 3.13.6 and see if it works better.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391415" class="blockpost rowodd"> <h2><span><span class="conr">#1328</span> <a href="viewtopic.php?pid=1391415#p1391415">2014-03-12 02:53:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80080">zoop2</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I just uploaded a new kernel package on the front page (3.13.6) that includes this patch</p></div></blockquote></div><p>B-but, but! 3.13 doesn&#039;t support hv-time. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>I thought that the hv-time was part of qemu Vs the kernel.&#160; I know when I used the qemu-git version it became available and improved performance for my system.&#160; I am currently using a 3.12 kernel.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391415">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391437" class="blockpost roweven"> <h2><span><span class="conr">#1329</span> <a href="viewtopic.php?pid=1391437#p1391437">2014-03-12 04:36:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GizmoChicken wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>That is good news! i wonder if they&#039;ll release an updated bios for the rest of their boards with this issue</p></div></blockquote></div><p>I recently learned that, in addition to the fix for my M5A99FX PRO R2.0 motherboard, ASUS issued a similar &quot;test BIOS&quot; for a Sabertooth 990FX R2.0.&#160; I don&#039;t know for certain what ASUS has planned for other motherboards, but I&#039;m under the impression ASUS will at least make an effort to add the fix to future BIOS releases... perhaps not the next stable BIOS release, but eventually.</p></div></blockquote></div><p>Late update on this, but I just updated my bios to the latest (late fall of last year. v2103) which came after his post.&#160; If I&#039;m reading dmesg correctly it looks like the test bios rolled into the official.</p><div class="codebox"><pre><code>[Pandora]:: dmesg | grep -i AMD ... [ 1.108304] AMD-Vi: Found IOMMU at 0000:00:00.2 cap 0x40 [ 1.108305] AMD-Vi: Interrupt remapping enabled [ 1.118270] AMD-Vi: Lazy IO/TLB flushing enabled [ 1.199374] perf: AMD IBS detected (0x0000001f) [ 1.271386] QUIRK: Enable AMD PLL fix [ 1.840492] ehci-pci 0000:00:12.2: applying AMD SB700/SB800/Hudson-2/3 EHCI dummy qh workaround [ 2.512930] ehci-pci 0000:00:13.2: applying AMD SB700/SB800/Hudson-2/3 EHCI dummy qh workaround [ 2.635756] ehci-pci 0000:00:16.2: applying AMD SB700/SB800/Hudson-2/3 EHCI dummy qh workaround [ 5.197053] AMD64 EDAC driver v3.4.0 [ 5.206768] EDAC amd64: DRAM ECC disabled. [ 5.206777] EDAC amd64: ECC disabled in the BIOS or no ECC capability, module will not load.</code></pre></div><p>So yeah, those ASUS people who don&#039;t update their BIOS&#039;s often might want to look into updating.</p> <p class="postedit"><em>Last edited by Blind Tree Frog (2014-03-12 04:47:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391439" class="blockpost rowodd"> <h2><span><span class="conr">#1330</span> <a href="viewtopic.php?pid=1391439#p1391439">2014-03-12 05:10:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zoop2 wrote:</cite><blockquote><div><p>I thought that the hv-time was part of qemu Vs the kernel.&#160; I know when I used the qemu-git version it became available and improved performance for my system.&#160; I am currently using a 3.12 kernel.</p></div></blockquote></div><p>Actually it needs both qemu and kernel bits. Some of kernel bits can be found here: <a href="https://git.kernel.org/cgit/virt/kvm/kvm.git/commit/?id=e984097b553ed2d6551c805223e4057421370f00" rel="nofollow">https://git.kernel.org/cgit/virt/kvm/kv … 7421370f00</a> (dunno if it&#039;s all)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391439">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391504" class="blockpost roweven"> <h2><span><span class="conr">#1331</span> <a href="viewtopic.php?pid=1391504#p1391504">2014-03-12 10:36:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><p>Using this as the only GPU (i.e. start qemu with -vga none) completely freezes the host some time during the boot of the guest. If I get a glimpse of dmesg on the host, it shows errors of some PCI device. Sometimes the AHCI controller, sometimes the USB controller. Sometimes I get &quot;[R600] flush TLB failed&quot;.</p></div></blockquote></div><p>This might sound random, but I had similar problems with 3.14-rc4, so you might try 3.13.6 and see if it works better.</p></div></blockquote></div><p>I&#039;ve already tried with 3.12 and 3.13. Doesn&#039;t make a difference.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391504">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391581" class="blockpost rowodd"> <h2><span><span class="conr">#1332</span> <a href="viewtopic.php?pid=1391581#p1391581">2014-03-12 14:22:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@pereczes, zzz3000, rawuza</p><p>To those passing the radeon HD series and getting the freeze or BSOD; try not passing the audio vfio device ie. 06:00.1 Audio device: Advanced Micro Device or 04:00.1 Audio device: Advanced Micro Device. just leave out the -device vfio-pci,host=0000:06:00.1,bus=root.1,addr=00.1 line out.&#160; I had the same problem with my HD7970.&#160; There are some comments about this earlier in the thread; perhaps they need to be added to the first page on hints/problems?</p><p>I still get acceptable audio through alsa; though I do get </p><div class="codebox"><pre><code>audio: Failed to create voice `adc&#039; ALSA lib pcm.c:7843:(snd_pcm_recover) underrun occurred</code></pre></div><p>in the console, with the ALSA error occuring every time there&#039;s sound.</p><p>Also, FYI all, ASUS has released an official bios for the RIVE supporting vt-d for IvyBridge, bios 4804, replacing the beta bios 9502.&#160; Seems to work fine.</p> <p class="postedit"><em>Last edited by mostlyharmless (2014-03-12 14:28:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391682" class="blockpost roweven"> <h2><span><span class="conr">#1333</span> <a href="viewtopic.php?pid=1391682#p1391682">2014-03-12 20:41:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79802">neona</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79802">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Since I built the new kernel/qemu from the OP, I&#039;ve had issues with system-wide lag spikes.</p><p>This affects everything from games to audio playback (though happens more often and is more annoying in games).&#160; Some spikes are short and cause fps dips/freezes, some are long, multiple seconds, and sometimes cause guest graphics driver crashes, and in one instance a bluescreen (I would guess because it causes things to not respond quickly enough).</p><p>How bad it is varies by game/activity, but it&#039;s making Titanfall a lot more difficult to play for me <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p><p>Anyone know what might be causing it?&#160; My guess is that the debug register patches aren&#039;t entirely stable, at least on amd systems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391682">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391687" class="blockpost rowodd"> <h2><span><span class="conr">#1334</span> <a href="viewtopic.php?pid=1391687#p1391687">2014-03-12 20:53:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>neona wrote:</cite><blockquote><div><p>Since I built the new kernel/qemu from the OP, I&#039;ve had issues with system-wide lag spikes.</p><p>This affects everything from games to audio playback (though happens more often and is more annoying in games).&#160; Some spikes are short and cause fps dips/freezes, some are long, multiple seconds, and sometimes cause guest graphics driver crashes, and in one instance a bluescreen (I would guess because it causes things to not respond quickly enough).</p><p>How bad it is varies by game/activity, but it&#039;s making Titanfall a lot more difficult to play for me <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p><p>Anyone know what might be causing it?&#160; My guess is that the debug register patches aren&#039;t entirely stable, at least on amd systems.</p></div></blockquote></div><p>have you tried:</p><div class="codebox"><pre><code>echo &quot;options kvm-amd npt=0&quot; &gt; /etc/modprobe.d/kvm-amd.conf</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391695" class="blockpost roweven"> <h2><span><span class="conr">#1335</span> <a href="viewtopic.php?pid=1391695#p1391695">2014-03-12 21:24:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79802">neona</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79802">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>have you tried:</p><div class="codebox"><pre><code>echo &quot;options kvm-amd npt=0&quot; &gt; /etc/modprobe.d/kvm-amd.conf</code></pre></div></div></blockquote></div><p>Already running with it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391695">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391705" class="blockpost rowodd"> <h2><span><span class="conr">#1336</span> <a href="viewtopic.php?pid=1391705#p1391705">2014-03-12 21:47:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79802">neona</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79802">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, it looks like my setup may have completely fallen apart.</p><p>Since bluescreening, I get *constant* microstutter.&#160; Previously, I got this when qemu used alsa instead of pulse, but only while sounds were playing.. and of course, pulse has been misbehaving, so I just run it as root and deal with the host effectively not having sound.</p><p>Considering trying removing sound from the equation entirely, though I&#039;m getting stutter even during os load animations, so i&#039;m not hopeful. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391705">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391709" class="blockpost roweven"> <h2><span><span class="conr">#1337</span> <a href="viewtopic.php?pid=1391709#p1391709">2014-03-12 22:19:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80088">pereczes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>@pereczes, zzz3000, rawuza</p><p>To those passing the radeon HD series and getting the freeze or BSOD; try not passing the audio vfio device ie. 06:00.1 Audio device: Advanced Micro Device or 04:00.1 Audio device: Advanced Micro Device. just leave out the -device vfio-pci,host=0000:06:00.1,bus=root.1,addr=00.1 line out.&#160; I had the same problem with my HD7970.&#160; There are some comments about this earlier in the thread; perhaps they need to be added to the first page on hints/problems?</p></div></blockquote></div><p>it was already suggested, tried already without tho audio, but the same (no) results <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. BTW: I have gigabyte 990fxa ud7</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391709">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391713" class="blockpost rowodd"> <h2><span><span class="conr">#1338</span> <a href="viewtopic.php?pid=1391713#p1391713">2014-03-12 22:34:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80028">trimm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-06</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80028">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Do any of you sometimes experience a total freeze of a VM when inside a game on the guest(seemingly at random, sometimes after a couple of seconds, other times after a couple of hours)? Host is ok and useable while guest is frozen.<br />Im not that bothered about it (at this time), however I cant seem to kill the qemu processes when this happens. Is it somehow possible to clean or reset the vm without completely restart the computer, just so that I can start it up again straight away? As of this moment, I have to reboot the whole computer and the frozen picture on the screen of the virtual machine will be the last thing that gets cleared before the reboot is completed.</p><p>Kernel: x86_64 Linux 3.13.5-1-mainline<br />Latest Qemu-git and Seabios-git<br />Nvidia GTX670, latest Nvidia driver on Windows 8.1<br />Synergy used between Arch Linux(server) and Windows(client)</p><p>Edit: Just tested Battlefield 4 and it froze(Everything ultra setting with 50FPS, at test range).<br />Ping against the VM stopped aswell, so its not only the GPU which froze.<br />This is the following journalctl:</p><div class="quotebox"><blockquote><div><p>Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: ERROR Transfer event for disabled endpoint or incorrect stream ring<br />Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: @00000000ffffe780 fff99920 00000000 0d00000a 07058000<br />Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: ERROR Transfer event for disabled endpoint or incorrect stream ring<br />Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: @00000000ffffe7a0 fff99930 00000000 0d00000c 07058000<br />Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: ERROR Transfer event for disabled endpoint or incorrect stream ring<br />Mar 13 00:40:09 arch kernel: xhci_hcd 0000:00:14.0: @00000000ffffe7c0 fff99940 00000000 0d00000c 07058000</p></div></blockquote></div><p>lspci -v<br />00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 05) (prog-if 30 [XHCI])</p> <p class="postedit"><em>Last edited by trimm (2014-03-12 22:56:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391713">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391743" class="blockpost roweven"> <h2><span><span class="conr">#1339</span> <a href="viewtopic.php?pid=1391743#p1391743">2014-03-13 00:15:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@pereczes<br />Have you tried installing the ati driver without the CCC? You&#039;ll still get 3D hardware acceleration.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391743">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391829" class="blockpost rowodd"> <h2><span><span class="conr">#1340</span> <a href="viewtopic.php?pid=1391829#p1391829">2014-03-13 07:46:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80234">shweng</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-13</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:shweng@163.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,all<br />Could any body tell me how to access the VM&#039;s desktop when successfully VGA-Passthroughed,<br />from virt-manager console on host, or other remote desktop access tools such as vncviewer, remote-viewer, rdesktop, freerdp etc?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391845" class="blockpost roweven"> <h2><span><span class="conr">#1341</span> <a href="viewtopic.php?pid=1391845#p1391845">2014-03-13 09:18:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=65027">blacky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-10-26</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=65027">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>shweng wrote:</cite><blockquote><div><p>Could any body tell me how to access the VM&#039;s desktop when successfully VGA-Passthroughed,</p></div></blockquote></div><p>How about attaching a display to the graphics card you passed through?</p><br /><p>I’m back after a few months with a new problem. I initially got this working with my good ol’ 4850 as a proof of concept while waiting for a viable custom design of the R290X. Now I finally acted and put a R290X Tri-X in there. Getting the new card passed through was straight forward and works great except for when Catalyst is supposed to kick in. Booting to safe mode, which uses the VESA drivers, works but as soon as I boot up normally the last thing I see is the Windows logo. After that the display simply shows black. It does *not* go into standby but shows a black screen. I tried both the stable and the Beta Catalyst so far; updated to latest kernel, qemu-git and seabios-git. Any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391845">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391875" class="blockpost rowodd"> <h2><span><span class="conr">#1342</span> <a href="viewtopic.php?pid=1391875#p1391875">2014-03-13 12:37:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80088">pereczes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>@pereczes<br />Have you tried installing the ati driver without the CCC? You&#039;ll still get 3D hardware acceleration.</p></div></blockquote></div><p>you mean Catalyst Control Center? ... well how would I do that... I mean other driver than the original one?<br />I assume the problem is with the driver, not with CCC, or?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391875">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391891" class="blockpost roweven"> <h2><span><span class="conr">#1343</span> <a href="viewtopic.php?pid=1391891#p1391891">2014-03-13 13:15:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@peterczes there were reported problem with using CCC (on GPU passthrough card) rather than with the driver</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391891">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1391903" class="blockpost rowodd"> <h2><span><span class="conr">#1344</span> <a href="viewtopic.php?pid=1391903#p1391903">2014-03-13 14:42:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80088">pereczes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>@peterczes there were reported problem with using CCC (on GPU passthrough card) rather than with the driver</p></div></blockquote></div><p>thanks... well little step further: uninstalled CCC, but it seems that the drivers remained installed under C:/Program Files/Amd</p><p>good news: started to work... wanted to install synergy (nice software btw if you do not know it), and:</p><p>bod news: bang... host froze again ...</p><p>will try to uninstall the driver and reinstall it... maybe helps <br />btw.. this experiment was without hdmi audio</p><p>I passed through a USB PCI controller as well for keyboard and mouse... after synergy will remove them, maybe it makes the system more stable</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1391903">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392402" class="blockpost roweven"> <h2><span><span class="conr">#1345</span> <a href="viewtopic.php?pid=1392402#p1392402">2014-03-14 19:24:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@op: Just downloaded the PKGBUILDs from page 1. The vfio_multifunction_regression.patch seems to be already applied upstream in quemu-git :-)</p><p>Edit: Was committed on March 9th: <a href="http://git.qemu.org/?p=qemu.git;a=commit;h=6e1f0a55a14bad1d0c8b9d29626ef4e4b2617c74" rel="nofollow">http://git.qemu.org/?p=qemu.git;a=commi … e4b2617c74</a></p> <p class="postedit"><em>Last edited by TripleSpeeder (2014-03-14 19:27:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392402">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392406" class="blockpost rowodd"> <h2><span><span class="conr">#1346</span> <a href="viewtopic.php?pid=1392406#p1392406">2014-03-14 19:32:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>@op: Just downloaded the PKGBUILDs from page 1. The vfio_multifunction_regression.patch seems to be already applied upstream in quemu-git :-)</p><p>Edit: Was committed on March 9th: <a href="http://git.qemu.org/?p=qemu.git;a=commit;h=6e1f0a55a14bad1d0c8b9d29626ef4e4b2617c74" rel="nofollow">http://git.qemu.org/?p=qemu.git;a=commi … e4b2617c74</a></p></div></blockquote></div><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392406">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392435" class="blockpost roweven"> <h2><span><span class="conr">#1347</span> <a href="viewtopic.php?pid=1392435#p1392435">2014-03-14 20:37:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78214">arny91</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78214">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, is the MSI 990FXA-GD80 a good motherboard for use with iommu?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392435">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392447" class="blockpost rowodd"> <h2><span><span class="conr">#1348</span> <a href="viewtopic.php?pid=1392447#p1392447">2014-03-14 21:12:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Somewhere in this very long thread there is a list of hardware with success or failure saved as a spreadsheet; perhaps a link on page 1 might be helpful.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392447">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392502" class="blockpost roweven"> <h2><span><span class="conr">#1349</span> <a href="viewtopic.php?pid=1392502#p1392502">2014-03-15 00:50:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80028">trimm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-06</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80028">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I cant for the life of me sort out my audio for my VM.</p><p>I use this:</p><div class="codebox"><pre><code>-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 </code></pre></div><p>I have also tried with -soundhw all and -soundhw ac97.</p><p>This is what I get when I fire up the computer:</p><div class="codebox"><pre><code>pulseaudio: pa_context_connect() failed pulseaudio: Reason: Connection refused pulseaudio: Failed to initialize PA contextaudio: Could not init `pa&#039; audio driver ALSA lib pcm_dmix.c:1022:(snd_pcm_dmix_open) unable to open slave alsa: Could not initialize DAC alsa: Failed to open `default&#039;: alsa: Reason: No such file or directory ALSA lib pcm_dmix.c:1022:(snd_pcm_dmix_open) unable to open slave alsa: Could not initialize DAC alsa: Failed to open `default&#039;: alsa: Reason: No such file or directory audio: Failed to create voice `dac&#039; ALSA lib pcm_dsnoop.c:618:(snd_pcm_dsnoop_open) unable to open slave alsa: Could not initialize ADC alsa: Failed to open `default&#039;: alsa: Reason: No such file or directory ALSA lib pcm_dsnoop.c:618:(snd_pcm_dsnoop_open) unable to open slave alsa: Could not initialize ADC alsa: Failed to open `default&#039;: alsa: Reason: No such file or directory audio: Failed to create voice `adc&#039;</code></pre></div><p>In the first post its stated that I may have to use the QEMU_AUDIO_DRV variable. I have tried this (export QEMU_AUDIO_DRV=alsa and QEMU_AUDIO_DRV=pa as root) without success. Anyone in the same boat as me, and/or found a solution?(except passing a USB headset? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)</p><p>Update: I managed to get audio somewhat working:</p><p>I use sudo -E export QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170 QEMU_AUDIO_DRV=alsa <br />and<br />sudo -E qemu-system-x86_64 ....<br />The -E option tries to preserve the environment even though you are running with sudo.</p><p>However the audio is crackling and sounding really disorted... <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p> <p class="postedit"><em>Last edited by trimm (2014-03-15 01:39:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1392576" class="blockpost rowodd"> <h2><span><span class="conr">#1350</span> <a href="viewtopic.php?pid=1392576#p1392576">2014-03-15 09:04:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>One more success story here. This is all done on mint 16 by the way.<br />Hardware: Sabertooth FX990 R2.0 motherboard, AMD FX(tm)-8350 CPU, host GPU geforce gtx 550ti, VM GPU Radeon R9 270X.<br />qemu: from git<br />kernel: <a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v3.13.6-trusty/" rel="nofollow">3.13.6</a></p><div class="codebox"><pre><code>00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 06:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Curacao XT [Radeon R9 270X] 06:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series]</code></pre></div><div class="codebox"><pre><code>~/VM/src/qemu/build/release/x86_64-softmmu/qemu-system-x86_64 \ -enable-kvm -m 4096 -cpu host -machine q35,accel=kvm \ -smp 8,sockets=1,cores=8,threads=1 \ -bios /usr/share/qemu/bios.bin \ -drive file=/dev/disk/by-id/ata-WDC_WD3200BEVT-22ZCT0_WD-WXE708J50240,if=none,id=virtio-disk0,format=raw,cache=none,aio$ -device virtio-blk-pci,scsi=off,drive=virtio-disk0,id=disk0 \ -drive file=/dev/disk/by-id/ata-WDC_WD7502AAEX-00Y9A0_WD-WCAW31075836,if=none,id=virtio-disk1,format=raw,cache=none,aio$ -device virtio-blk-pci,scsi=off,drive=virtio-disk1,id=disk1 \ -device e1000,netdev=vnet0,mac=20:64:32:c1:f9:22 -netdev tap,id=vnet0 \ -smb user,smbserver=10.0.2.4 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=06:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=06:00.1,bus=root.1,addr=00.1 \ -device vfio-pci,host=00:13.0,bus=pcie.0 \ -device vfio-pci,host=00:13.2,bus=pcie.0 \ -vga none</code></pre></div><p>Some observations i made:<br />To correctly pass-through USB controller i had to include both 00:13.0 and 00:13.2, othervise qemu threw an error about failing to bind vfio or something.<br />To find correct address of USB ports i wanted i used stupid method: plugged in mouse to target port and then go through pci addresses and vfio-bind them. When mouse lights went out i knew usb port was no longer working so that was last one i bound. Then had to reboot to make them come back. There probably is better way..<br />I could use -vga sdl along with passed-through GPU. Using stock 1.5 qemu from repos did not quite work. Device manager reported radeon had some kind of malfunction. Compiling qemu from git made it work. Both emulated vga and passed-through one side by side. 3d apps did not run on radeon vga in that mode though and i did not care to find out how to make that happen.<br />Everything else went pretty much as described in original guide.<br />Well and bit offtopic - to use virtio for disk i had to boot OS while disk with windows was attached with -hda and then i had to attach dummy few meg image in virtio mode. That way windows picked up new device and i could install drivers. After that all disks can be attached in virtio.</p><p>Now this brings me to problems.. I am too having this issue where after reboot vga will not reset and VM with passed-through vga can not be started again. As far as i read this thread did not see a solution. Correct me if im blind and i missed it.<br />Also performance issue led me to believe i should use these patches:</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Paolo has posted new patches to fix performance when debug registers are used in the guest.&#160; Performance should be the same as previous set on Intel, but this series also adds support for AMD.&#160; Patches:</p><p><a href="http://marc.info/?l=linux-kernel&amp;m=139419276204556&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4556&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419268004517&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4517&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419270004527&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4527&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419260404488&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4488&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419265404502&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4502&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419261204492&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4492&amp;q=raw</a><br /><a href="http://marc.info/?l=linux-kernel&amp;m=139419263204499&amp;q=raw" rel="nofollow">http://marc.info/?l=linux-kernel&amp;m=1394 … 4499&amp;q=raw</a></p></div></blockquote></div><p>For what kernel version are they? I fail to apply them because latest <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree" rel="nofollow">tree</a> does not quite match code in these patches. Not entirely sure if its a good idea to apply these patches in this case.</p><br /><p>EDIT:<br />After some more digging i figured out patches are for latest 3.14-rc6 kernel. Thing is after kernel update i still can not see reasonable speed improvement. I used passmarkt to test and only dx11 test seems to run at ~80% of speed compared to other users. dx9 is especially slow. Basically all other 3d tests are somewhere around 20-30% of other people&#039;s results. Really slow.. If anyone knows possible cure - hint me please!</p><p>Also i forgot to mention that if i run VM then host will not shut down properly. It hangs after bunch of &quot;synchronizing SCISI cache&quot; messages.<br />Also had to flib-back to nouveau driver for host as latest nvidia beta driver (which is supposed to work with rc6) wont install (hangs without displaying anything upon start). Anyone happen to install that beast?</p> <p class="postedit"><em>Last edited by novist (2014-03-15 15:45:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1392576">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=53">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=52">52</a> <a href="viewtopic.php?id=162768&amp;p=53">53</a> <strong>54</strong> <a href="viewtopic.php?id=162768&amp;p=55">55</a> <a href="viewtopic.php?id=162768&amp;p=56">56</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=55">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
