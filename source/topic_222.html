<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 222) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=222" title="Page 222" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=221" title="Page 221" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=223" title="Page 223" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=221">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=220">220</a> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <strong>222</strong> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=223">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1543257" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5526</span> <a href="viewtopic.php?pid=1543257#p1543257">2015-07-09 15:43:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone .</p><p>Sorry if this is slightly off-topic but is there any <em>real</em> performance or stability gains when using Libvirt over regular command line script to define and launch the VM ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543257">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543261" class="blockpost roweven"> <h2><span><span class="conr">#5527</span> <a href="viewtopic.php?pid=1543261#p1543261">2015-07-09 16:09:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Denso</p><p>libvirt is a VM management interface.&#160; It facilitates many things about managing VMs, but it&#039;s not some magic wrapper that turbo boosts the VM.&#160; It still emits a QEMU command line in the end.&#160; If you want to keep using vfio-bind and manual scripts, then please also keep all the bugs that come along with them.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543261">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543266" class="blockpost rowodd"> <h2><span><span class="conr">#5528</span> <a href="viewtopic.php?pid=1543266#p1543266">2015-07-09 16:34:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>then please also keep all the bugs that come along with them.</p></div></blockquote></div><p>Thank Alex . I saw that libvirt emits a longer QEMU command line too . I think using &quot;options vfio-pci ids=&quot; with a QEMU command script is the best solution for me . (I find it easier to edit a simple shell script that editing a libvirt XML) .</p><p>Thank you !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543266">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543362" class="blockpost roweven"> <h2><span><span class="conr">#5529</span> <a href="viewtopic.php?pid=1543362#p1543362">2015-07-10 01:03:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After following @aw&#039;s guide, libvirt returns:</p><div class="codebox"><pre><code>Error starting domain: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable</code></pre></div><p>Looking through my journal since today&#039;s boot, I have a loooot of errors. At the time I try to run the VM, I get messages similar to this for every IOMMU device (where 0000:01:00.1 is my GPU:</p><div class="codebox"><pre><code>libvirtd[5956]: internal error: Failed to find parent device for 0000:01:00.0 libvirtd[5956]: Failed to open config space file &#039;/sys/bus/pci/devices/0000:00:00.0/config&#039;: Permission denied</code></pre></div><p><a href="https://gist.github.com/a3a7cb2aa67f10fdb0d0" rel="nofollow">Dmesg here</a><br />Something something wit&#039;s end?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543362">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543368" class="blockpost rowodd"> <h2><span><span class="conr">#5530</span> <a href="viewtopic.php?pid=1543368#p1543368">2015-07-10 01:13:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>After following @aw&#039;s guide, libvirt returns:</p><div class="codebox"><pre><code>Error starting domain: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable</code></pre></div><p>Looking through my journal since today&#039;s boot, I have a loooot of errors. At the time I try to run the VM, I get messages similar to this for every IOMMU device (where 0000:01:00.1 is my GPU:</p><div class="codebox"><pre><code>libvirtd[5956]: internal error: Failed to find parent device for 0000:01:00.0 libvirtd[5956]: Failed to open config space file &#039;/sys/bus/pci/devices/0000:00:00.0/config&#039;: Permission denied</code></pre></div><p><a href="https://gist.github.com/a3a7cb2aa67f10fdb0d0" rel="nofollow">Dmesg here</a><br />Something something wit&#039;s end?</p></div></blockquote></div><p>session mode libvirt does not support device assignment, you need to use system mode libvirt (ie. run it as root).&#160; Also, your attempt to load vfio-pci early:</p><div class="codebox"><pre><code>rd.driver.pre=vfio-pci</code></pre></div><p>Isn&#039;t working:</p><div class="codebox"><pre><code>[ 8.591790] nouveau 0000:01:00.0: enabling device (0004 -&gt; 0007) [ 8.591932] nouveau [ DEVICE][0000:01:00.0] BOOT0 : 0x124000a1 [ 8.591934] nouveau [ DEVICE][0000:01:00.0] Chipset: GM204 (NV124) [ 8.591934] nouveau [ DEVICE][0000:01:00.0] Family : NV110 [ 8.646855] nouveau [ VBIOS][0000:01:00.0] using image from PROM [ 8.646990] nouveau [ VBIOS][0000:01:00.0] BIT signature found [ 8.646992] nouveau [ VBIOS][0000:01:00.0] version 84.04.31.00.c9 [ 8.647160] nouveau [ DEVINIT][0000:01:00.0] adaptor not initialised [ 8.658974] nouveau [ PMC][0000:01:00.0] MSI interrupts enabled [ 8.658994] nouveau [ PFB][0000:01:00.0] RAM type: GDDR5 [ 8.658995] nouveau [ PFB][0000:01:00.0] RAM size: 4096 MiB [ 8.658995] nouveau [ PFB][0000:01:00.0] ZCOMP: 0 tags</code></pre></div><p>You&#039;ll need to figure out the equivalent trick for Arch, rd.driver.pre works with dracut-based initramfs images, like Fedora.&#160; You may want to start with a simple pci-stub.ids option and move on to something more complicated later.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543374" class="blockpost roweven"> <h2><span><span class="conr">#5531</span> <a href="viewtopic.php?pid=1543374#p1543374">2015-07-10 02:16:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, some progress has been made...<br />When running the VM, libvirtd causes a <a href="https://gist.github.com/anonymous/c7e0eee171f90af9e7ec" rel="nofollow">kernel panic</a>. After reading it, it seems like it <strong>might</strong> be caused by a bug in libvirt, but I&#039;m no expert, so I&#039;ll defer to you. <a href="https://gist.github.com/838cf9314338b0599fdc" rel="nofollow">Dmesg here</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543374">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543375" class="blockpost rowodd"> <h2><span><span class="conr">#5532</span> <a href="viewtopic.php?pid=1543375#p1543375">2015-07-10 02:24:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>You fat fingered your pci-stub.ids entry and didn&#039;t verify that it worked correctly.&#160; You have:</p><div class="codebox"><pre><code>pci-stub.ids=10de:13x0,10de:0fbb#i915.enable_hd_vgaarb=1</code></pre></div><p>You want:</p><div class="codebox"><pre><code>pci-stub.ids=10de:13c0,10de:0fbb i915.enable_hd_vgaarb=1</code></pre></div><p>And then double check it worked with:</p><div class="codebox"><pre><code>lspci -nnks 1:</code></pre></div><p>Which should show the in-use driver is pci-stub.&#160; Not sure why your libvirt install is so unhappy.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543375">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543376" class="blockpost roweven"> <h2><span><span class="conr">#5533</span> <a href="viewtopic.php?pid=1543376#p1543376">2015-07-10 02:29:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You fat fingered your pci-stub.ids entry and didn&#039;t verify that it worked correctly.&#160; You have:</p><div class="codebox"><pre><code>pci-stub.ids=10de:13x0,10de:0fbb#i915.enable_hd_vgaarb=1</code></pre></div><p>You want:</p><div class="codebox"><pre><code>pci-stub.ids=10de:13c0,10de:0fbb i915.enable_hd_vgaarb=1</code></pre></div><p>And then double check it worked with:</p><div class="codebox"><pre><code>lspci -nnks 1:</code></pre></div><p>Which should show the in-use driver is pci-stub.&#160; Not sure why your libvirt install is so unhappy.</p></div></blockquote></div><p>Commenting out the vga fix was intentional, I have yet to patch the kernel, but that x.... Time to move on from the 2008 apple-supplied rubber dome keyboard, I think, causes more than a few mistakes.</p><p><strong>Update:</strong><br />I dont get a kernel panic any more, which is nice; but now libvirt spits this out:</p><div class="codebox"><pre><code>Error starting domain: internal error: early end of file from monitor: possible problem: 2015-07-10T12:55:29.897699Z qemu-system-x86_64: unable to map backing store for hugepages: Cannot allocate memory Traceback (most recent call last): File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 89, in cb_wrapper callback(asyncjob, *args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/asyncjob.py&quot;, line 125, in tmpcb callback(*args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/libvirtobject.py&quot;, line 83, in newfn ret = fn(self, *args, **kwargs) File &quot;/usr/share/virt-manager/virtManager/domain.py&quot;, line 1433, in startup self._backend.create() File &quot;/usr/lib/python2.7/site-packages/libvirt.py&quot;, line 1029, in create if ret == -1: raise libvirtError (&#039;virDomainCreate() failed&#039;, dom=self) libvirtError: internal error: early end of file from monitor: possible problem: 2015-07-10T12:55:29.897699Z qemu-system-x86_64: unable to map backing store for hugepages: Cannot allocate memory</code></pre></div><p>Hugepages have been set up as per your guide, @aw. <a href="https://gist.github.com/anonymous/97968601c8d794b5d5bb" rel="nofollow">Why break the trend?</a><br />It&#039;s so close, I can almost taste it...</p> <p class="postedit"><em>Last edited by morat (2015-07-10 03:01:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543376">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543380" class="blockpost rowodd"> <h2><span><span class="conr">#5534</span> <a href="viewtopic.php?pid=1543380#p1543380">2015-07-10 03:04:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>dmesg says you have 2048 2M pages, for 4G.&#160; What&#039;s the memory size of the guest?&#160; You could also start simple and add hugepages once you get things working...</p><p>EDIT:&#160; Also, you have a GTX980, which I&#039;d fully expect to support UEFI.&#160; Why are you considering the i915/VGA route?</p> <p class="postedit"><em>Last edited by aw (2015-07-10 03:06:48)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543380">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543383" class="blockpost roweven"> <h2><span><span class="conr">#5535</span> <a href="viewtopic.php?pid=1543383#p1543383">2015-07-10 03:35:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>dmesg says you have 2048 2M pages, for 4G.&#160; What&#039;s the memory size of the guest?&#160; You could also start simple and add hugepages once you get things working...</p><p>EDIT:&#160; Also, you have a GTX980, which I&#039;d fully expect to support UEFI.&#160; Why are you considering the i915/VGA route?</p></div></blockquote></div><p>I need to use the IGP for Arch, as I don&#039;t have another discrete card. EDIT: I just realized how inane that is, I&#039;m using the IGP right now without hassle; looks like I don&#039;t need i915. That being said, my onboard DVI is AWOL, and I have no idea why, in Arch, BIOS/UEFI, and the physical Windows.</p><p>It all seems to work now, or at least... start. I can&#039;t get networking going, libvirt lists my two physical interfaces, and an empty bridge. None of the three give the guest connectivity. I also can&#039;t mount a driver cd to the guest, virsh says hotplug isn&#039;t supported, and virt-manager claims it works, but the guest doesn&#039;t see the drive.</p> <p class="postedit"><em>Last edited by morat (2015-07-10 03:37:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543383">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543384" class="blockpost rowodd"> <h2><span><span class="conr">#5536</span> <a href="viewtopic.php?pid=1543384#p1543384">2015-07-10 03:36:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>dmesg says you have 2048 2M pages, for 4G.&#160; What&#039;s the memory size of the guest?&#160; You could also start simple and add hugepages once you get things working...</p><p>EDIT:&#160; Also, you have a GTX980, which I&#039;d fully expect to support UEFI.&#160; Why are you considering the i915/VGA route?</p></div></blockquote></div><p>I need to use the IGP for Arch, as I don&#039;t have another discrete card.</p></div></blockquote></div><p>Umm... you can still use IGD with the UEFI solution</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543384">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543385" class="blockpost roweven"> <h2><span><span class="conr">#5537</span> <a href="viewtopic.php?pid=1543385#p1543385">2015-07-10 03:40:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92304">Zeorymer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-03</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jerichokru@aol.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="codebox"><pre class="vscroll"><code>Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:02 JK-Desktop kernel: AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=07:00.0 address=0x00000002451e49e0] Jul 06 18:30:02 JK-Desktop kernel: BUG: unable to handle kernel paging request at ffffffffffffc039 Jul 06 18:30:02 JK-Desktop kernel: IP: [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90 Jul 06 18:30:02 JK-Desktop kernel: PGD 180e067 PUD 1810067 PMD 0 Jul 06 18:30:02 JK-Desktop kernel: Oops: 0000 [#1] PREEMPT SMP Jul 06 18:30:02 JK-Desktop kernel: Modules linked in: nls_utf8 isofs vfio_pci vfio_iommu_type1 vfio it87 hwmon_vid eeepc_wmi asus_wmi sparse_keymap led_class rfkill video kvm_amd kvm fuse crct10dif_pclmu Jul 06 18:30:02 JK-Desktop kernel: hid_logitech ff_memless hid_generic hid_microsoft usbhid hid uas usb_storage atkbd libps2 ahci libahci libata ohci_pci xhci_pci ohci_hcd ehci_pci xhci_hcd ehci_hcd scs Jul 06 18:30:02 JK-Desktop kernel: CPU: 4 PID: 720 Comm: cinnamon Not tainted 4.0.7-2-vfio #1 Jul 06 18:30:02 JK-Desktop kernel: Hardware name: To be filled by O.E.M. To be filled by O.E.M./M5A97 EVO, BIOS 1604 10/16/2012 Jul 06 18:30:02 JK-Desktop kernel: task: ffff88023db2b2a0 ti: ffff8800a4144000 task.ti: ffff8800a4144000 Jul 06 18:30:02 JK-Desktop kernel: RIP: 0010:[&lt;ffffffff81576b77&gt;] [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90 Jul 06 18:30:02 JK-Desktop kernel: RSP: 0018:ffff8800a4147a08 EFLAGS: 00010292 Jul 06 18:30:02 JK-Desktop kernel: RAX: 0000000000000000 RBX: 0000000000000001 RCX: 00000000c0000100 Jul 06 18:30:02 JK-Desktop kernel: RDX: ffff8800a4147fd8 RSI: ffff88023db2b2a0 RDI: ffff88024ed13e40 Jul 06 18:30:02 JK-Desktop kernel: RBP: ffff8800a4147a18 R08: ffff8800a4144000 R09: ffff88024ed13e70 Jul 06 18:30:02 JK-Desktop kernel: R10: 0000000000000020 R11: 0000000000000004 R12: 000000000006224f Jul 06 18:30:02 JK-Desktop kernel: R13: ffff8800a4147b80 R14: ffff8800a4147bec R15: 0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: FS: 00007f532c8c39c0(0000) GS:ffff88024ed00000(0000) knlGS:0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 Jul 06 18:30:02 JK-Desktop kernel: CR2: ffffffffffffc039 CR3: 00000000a4ca2000 CR4: 00000000000407e0 Jul 06 18:30:02 JK-Desktop kernel: Stack: Jul 06 18:30:02 JK-Desktop kernel: ffff8800a4147bec 0000000000000000 ffff8800a4147ab8 ffffffff815798fc Jul 06 18:30:02 JK-Desktop kernel: ffff8800a4147a28 0000000000000000 0000000000000000 000000a9a6b041b6 Jul 06 18:30:02 JK-Desktop kernel: 000000a9a6aa1f67 ffffffff810e0bd0 ffff88024ed0e408 0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: Call Trace: Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff815798fc&gt;] schedule_hrtimeout_range_clock.part.6+0xfc/0x120 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff810e0bd0&gt;] ? __run_hrtimer+0x250/0x250 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579891&gt;] ? schedule_hrtimeout_range_clock.part.6+0x91/0x120 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579939&gt;] schedule_hrtimeout_range_clock+0x19/0x50 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579983&gt;] schedule_hrtimeout_range+0x13/0x20 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ec8f4&gt;] poll_schedule_timeout+0x44/0x70 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ee111&gt;] do_sys_poll+0x531/0x600 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ee2e1&gt;] SyS_poll+0x71/0x130 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff8157a889&gt;] system_call_fastpath+0x12/0x17 Jul 06 18:30:02 JK-Desktop kernel: Code: b8 00 00 48 89 e5 53 48 83 ec 08 48 8b 10 48 85 d2 74 0a 48 83 b8 a8 07 00 00 00 74 27 65 48 8b 1c 25 60 b8 00 00 e8 99 f5 ff ff &lt;48&gt; 8b 83 38 c0 ff ff a8 08 75 f Jul 06 18:30:02 JK-Desktop kernel: RIP [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90</code></pre></div></div></blockquote></div><p>Actually, this looks very bad. I think only aw or someone his level can give you a proper advice. Strange thing those ioapic remapping commands didn&#039;t work.</p></div></blockquote></div><p>Since aw is in the thread, may I have your opinion on my troubles?&#160; That is, if you have any idea.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543385">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543396" class="blockpost rowodd"> <h2><span><span class="conr">#5538</span> <a href="viewtopic.php?pid=1543396#p1543396">2015-07-10 04:31:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Great, everything works; even the PCI wifi card. Oh, except the Code 43.</p><p>I&#039;m using a GTX 980, is it too new for the workarounds? Was all this for nothing?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543396">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543508" class="blockpost roweven"> <h2><span><span class="conr">#5539</span> <a href="viewtopic.php?pid=1543508#p1543508">2015-07-10 12:53:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="codebox"><pre class="vscroll"><code>Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:01 JK-Desktop kernel: AMD-Vi: Completion-Wait loop timed out Jul 06 18:30:02 JK-Desktop kernel: AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=07:00.0 address=0x00000002451e49e0] Jul 06 18:30:02 JK-Desktop kernel: BUG: unable to handle kernel paging request at ffffffffffffc039 Jul 06 18:30:02 JK-Desktop kernel: IP: [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90 Jul 06 18:30:02 JK-Desktop kernel: PGD 180e067 PUD 1810067 PMD 0 Jul 06 18:30:02 JK-Desktop kernel: Oops: 0000 [#1] PREEMPT SMP Jul 06 18:30:02 JK-Desktop kernel: Modules linked in: nls_utf8 isofs vfio_pci vfio_iommu_type1 vfio it87 hwmon_vid eeepc_wmi asus_wmi sparse_keymap led_class rfkill video kvm_amd kvm fuse crct10dif_pclmu Jul 06 18:30:02 JK-Desktop kernel: hid_logitech ff_memless hid_generic hid_microsoft usbhid hid uas usb_storage atkbd libps2 ahci libahci libata ohci_pci xhci_pci ohci_hcd ehci_pci xhci_hcd ehci_hcd scs Jul 06 18:30:02 JK-Desktop kernel: CPU: 4 PID: 720 Comm: cinnamon Not tainted 4.0.7-2-vfio #1 Jul 06 18:30:02 JK-Desktop kernel: Hardware name: To be filled by O.E.M. To be filled by O.E.M./M5A97 EVO, BIOS 1604 10/16/2012 Jul 06 18:30:02 JK-Desktop kernel: task: ffff88023db2b2a0 ti: ffff8800a4144000 task.ti: ffff8800a4144000 Jul 06 18:30:02 JK-Desktop kernel: RIP: 0010:[&lt;ffffffff81576b77&gt;] [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90 Jul 06 18:30:02 JK-Desktop kernel: RSP: 0018:ffff8800a4147a08 EFLAGS: 00010292 Jul 06 18:30:02 JK-Desktop kernel: RAX: 0000000000000000 RBX: 0000000000000001 RCX: 00000000c0000100 Jul 06 18:30:02 JK-Desktop kernel: RDX: ffff8800a4147fd8 RSI: ffff88023db2b2a0 RDI: ffff88024ed13e40 Jul 06 18:30:02 JK-Desktop kernel: RBP: ffff8800a4147a18 R08: ffff8800a4144000 R09: ffff88024ed13e70 Jul 06 18:30:02 JK-Desktop kernel: R10: 0000000000000020 R11: 0000000000000004 R12: 000000000006224f Jul 06 18:30:02 JK-Desktop kernel: R13: ffff8800a4147b80 R14: ffff8800a4147bec R15: 0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: FS: 00007f532c8c39c0(0000) GS:ffff88024ed00000(0000) knlGS:0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033 Jul 06 18:30:02 JK-Desktop kernel: CR2: ffffffffffffc039 CR3: 00000000a4ca2000 CR4: 00000000000407e0 Jul 06 18:30:02 JK-Desktop kernel: Stack: Jul 06 18:30:02 JK-Desktop kernel: ffff8800a4147bec 0000000000000000 ffff8800a4147ab8 ffffffff815798fc Jul 06 18:30:02 JK-Desktop kernel: ffff8800a4147a28 0000000000000000 0000000000000000 000000a9a6b041b6 Jul 06 18:30:02 JK-Desktop kernel: 000000a9a6aa1f67 ffffffff810e0bd0 ffff88024ed0e408 0000000000000000 Jul 06 18:30:02 JK-Desktop kernel: Call Trace: Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff815798fc&gt;] schedule_hrtimeout_range_clock.part.6+0xfc/0x120 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff810e0bd0&gt;] ? __run_hrtimer+0x250/0x250 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579891&gt;] ? schedule_hrtimeout_range_clock.part.6+0x91/0x120 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579939&gt;] schedule_hrtimeout_range_clock+0x19/0x50 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff81579983&gt;] schedule_hrtimeout_range+0x13/0x20 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ec8f4&gt;] poll_schedule_timeout+0x44/0x70 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ee111&gt;] do_sys_poll+0x531/0x600 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811eca70&gt;] ? poll_select_copy_remaining+0x150/0x150 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff811ee2e1&gt;] SyS_poll+0x71/0x130 Jul 06 18:30:02 JK-Desktop kernel: [&lt;ffffffff8157a889&gt;] system_call_fastpath+0x12/0x17 Jul 06 18:30:02 JK-Desktop kernel: Code: b8 00 00 48 89 e5 53 48 83 ec 08 48 8b 10 48 85 d2 74 0a 48 83 b8 a8 07 00 00 00 74 27 65 48 8b 1c 25 60 b8 00 00 e8 99 f5 ff ff &lt;48&gt; 8b 83 38 c0 ff ff a8 08 75 f Jul 06 18:30:02 JK-Desktop kernel: RIP [&lt;ffffffff81576b77&gt;] schedule+0x37/0x90</code></pre></div></div></blockquote></div><p>Actually, this looks very bad. I think only aw or someone his level can give you a proper advice. Strange thing those ioapic remapping commands didn&#039;t work.</p></div></blockquote></div><p>Since aw is in the thread, may I have your opinion on my troubles?&#160; That is, if you have any idea.</p></div></blockquote></div><p>Have you tried disabling hugepages for the IOMMU yet? (modprobe.d: options vfio_iommu_type1 disable_hugepages=1)&#160; What&#039;s the processor?&#160; This seems like a common problem on APUs but seems to work fine on non-APU processors.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543508">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543509" class="blockpost rowodd"> <h2><span><span class="conr">#5540</span> <a href="viewtopic.php?pid=1543509#p1543509">2015-07-10 12:55:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>Great, everything works; even the PCI wifi card. Oh, except the Code 43.</p><p>I&#039;m using a GTX 980, is it too new for the workarounds? Was all this for nothing?</p></div></blockquote></div><p>Sorry, no data, no help.&#160; I&#039;m not going to guess whether you followed the instructions to edit the domain xml to remove the hyper-v extensions.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543556" class="blockpost roweven"> <h2><span><span class="conr">#5541</span> <a href="viewtopic.php?pid=1543556#p1543556">2015-07-10 16:12:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Have you tried disabling hugepages for the IOMMU yet? (modprobe.d: options vfio_iommu_type1 disable_hugepages=1)&#160; What&#039;s the processor?&#160; This seems like a common problem on APUs but seems to work fine on non-APU processors.</p></div></blockquote></div><p>He has a family 15h CPU with</p><div class="codebox"><pre><code>00:13.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller [1002:4396]</code></pre></div><p>alike device, so i think it&#039;s an FX platform(not APU, APUs don&#039;t work without their specific southbridges) and the initial problem was </p><div class="codebox"><pre><code>[Firmware Bug]: AMD-Vi: IOAPIC[9] not in IVRS table [Firmware Bug]: AMD-Vi: IOAPIC[10] not in IVRS table [Firmware Bug]: AMD-Vi: No southbridge IOAPIC found AMD-Vi: Disabling interrupt remapping</code></pre></div><p>I&#039;ve suggested mapping ioapic directly via commandline, like</p><div class="codebox"><pre><code>ivrs_ioapic[7]=00:14.0 ivrs_ioapic[8]=00:00.1</code></pre></div><p> but that(after address adjustments) moved him to IOTLB_INV_TIMEOUT error. </p><p>The iommu dump he posted is:</p><div class="codebox"><pre class="vscroll"><code>AMD-Vi: device: 00:00.2 cap: 0040 seg: 0 flags: 3e info 1300 AMD-Vi: mmio-addr: 00000000feb20000 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:00.2 AMD-Vi: DEV_SELECT devid: 00:02.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 01:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 01:00.1 AMD-Vi: DEV_SELECT devid: 00:04.0 flags: 00 AMD-Vi: DEV_SELECT devid: 02:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:05.0 flags: 00 AMD-Vi: DEV_SELECT devid: 03:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:06.0 flags: 00 AMD-Vi: DEV_SELECT devid: 04:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:07.0 flags: 00 AMD-Vi: DEV_SELECT devid: 05:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:11.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:12.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:12.2 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:13.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:13.2 AMD-Vi: DEV_SELECT devid: 00:14.0 flags: d7 AMD-Vi: DEV_SELECT devid: 00:14.3 flags: 00 AMD-Vi: DEV_SELECT devid: 00:14.4 flags: 00 AMD-Vi: DEV_ALIAS_RANGE devid: 06:00.0 flags: 00 devid_to: 00:14.4 AMD-Vi: DEV_RANGE_END devid: 06:1f.7 AMD-Vi: DEV_SELECT devid: 00:14.5 flags: 00 AMD-Vi: DEV_SELECT devid: 00:15.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 07:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 07:00.1 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:16.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:16.2 AMD-Vi: DEV_SPECIAL(IOAPIC[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(HPET[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(IOAPIC[255]) devid: 00:00.1</code></pre></div><p>Maybe you can suggest something else?</p> <p class="postedit"><em>Last edited by Duelist (2015-07-10 16:13:39)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543556">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543557" class="blockpost rowodd"> <h2><span><span class="conr">#5542</span> <a href="viewtopic.php?pid=1543557#p1543557">2015-07-10 16:14:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Duelist</p><p>Suggestion: Working motherboard</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543557">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543560" class="blockpost roweven"> <h2><span><span class="conr">#5543</span> <a href="viewtopic.php?pid=1543560#p1543560">2015-07-10 16:23:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Duelist</p><p>Suggestion: Working motherboard</p></div></blockquote></div><p>Crap. Is his IVRS table messed up so bad?</p><p>@Zeorymer:<br />Can you tell us an exact model of your motherboard? I know that it&#039;s ASUS, but which one?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543560">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543561" class="blockpost rowodd"> <h2><span><span class="conr">#5544</span> <a href="viewtopic.php?pid=1543561#p1543561">2015-07-10 16:24:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Duelist</p><p>Suggestion: Working motherboard</p></div></blockquote></div><p>Crap. Is his IVRS table messed up so bad?</p></div></blockquote></div><p>Dunno, but it&#039;s beyond the scope of this thread.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543561">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543564" class="blockpost roweven"> <h2><span><span class="conr">#5545</span> <a href="viewtopic.php?pid=1543564#p1543564">2015-07-10 16:35:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Duelist</p><p>Suggestion: Working motherboard</p></div></blockquote></div><p>Crap. Is his IVRS table messed up so bad?</p></div></blockquote></div><p>Dunno, but it&#039;s beyond the scope of this thread.</p></div></blockquote></div><p>I understand your tiredness of supporting countless people, but if i&#039;ll come into #kvm and ask everyone, including you, about that..:D</p><br /><p><a href="http://www.gossamer-threads.com/lists/xen/devel/274857" rel="nofollow">http://www.gossamer-threads.com/lists/xen/devel/274857</a><br /><a href="https://bbs.archlinux.org/viewtopic.php?id=163102" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=163102</a></p><p>Suddenly, i&#039;ve cleared my vision and other google results started to seem fitting.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-10 16:40:47)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543564">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543565" class="blockpost rowodd"> <h2><span><span class="conr">#5546</span> <a href="viewtopic.php?pid=1543565#p1543565">2015-07-10 16:35:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw, What kernel are you currently running? I just updated to FC22 and stock 4.0.6-300 kernel without issues so far. Do you stay with Rawhide or within the FC releases for kernel packages? Or just compile your own :-)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543565">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543566" class="blockpost roweven"> <h2><span><span class="conr">#5547</span> <a href="viewtopic.php?pid=1543566#p1543566">2015-07-10 16:42:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Have you tried disabling hugepages for the IOMMU yet? (modprobe.d: options vfio_iommu_type1 disable_hugepages=1)&#160; What&#039;s the processor?&#160; This seems like a common problem on APUs but seems to work fine on non-APU processors.</p></div></blockquote></div><p>He has a family 15h CPU with</p><div class="codebox"><pre><code>00:13.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller [1002:4396]</code></pre></div><p>alike device, so i think it&#039;s an FX platform(not APU, APUs don&#039;t work without their specific southbridges) and the initial problem was </p><div class="codebox"><pre><code>[Firmware Bug]: AMD-Vi: IOAPIC[9] not in IVRS table [Firmware Bug]: AMD-Vi: IOAPIC[10] not in IVRS table [Firmware Bug]: AMD-Vi: No southbridge IOAPIC found AMD-Vi: Disabling interrupt remapping</code></pre></div><p>I&#039;ve suggested mapping ioapic directly via commandline, like</p><div class="codebox"><pre><code>ivrs_ioapic[7]=00:14.0 ivrs_ioapic[8]=00:00.1</code></pre></div><p> but that(after address adjustments) moved him to IOTLB_INV_TIMEOUT error. </p><p>The iommu dump he posted is:</p><div class="codebox"><pre class="vscroll"><code>AMD-Vi: device: 00:00.2 cap: 0040 seg: 0 flags: 3e info 1300 AMD-Vi: mmio-addr: 00000000feb20000 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:00.2 AMD-Vi: DEV_SELECT devid: 00:02.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 01:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 01:00.1 AMD-Vi: DEV_SELECT devid: 00:04.0 flags: 00 AMD-Vi: DEV_SELECT devid: 02:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:05.0 flags: 00 AMD-Vi: DEV_SELECT devid: 03:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:06.0 flags: 00 AMD-Vi: DEV_SELECT devid: 04:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:07.0 flags: 00 AMD-Vi: DEV_SELECT devid: 05:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:11.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:12.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:12.2 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:13.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:13.2 AMD-Vi: DEV_SELECT devid: 00:14.0 flags: d7 AMD-Vi: DEV_SELECT devid: 00:14.3 flags: 00 AMD-Vi: DEV_SELECT devid: 00:14.4 flags: 00 AMD-Vi: DEV_ALIAS_RANGE devid: 06:00.0 flags: 00 devid_to: 00:14.4 AMD-Vi: DEV_RANGE_END devid: 06:1f.7 AMD-Vi: DEV_SELECT devid: 00:14.5 flags: 00 AMD-Vi: DEV_SELECT devid: 00:15.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 07:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 07:00.1 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:16.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:16.2 AMD-Vi: DEV_SPECIAL(IOAPIC[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(HPET[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(IOAPIC[255]) devid: 00:00.1</code></pre></div><p>Maybe you can suggest something else?</p></div></blockquote></div><div class="codebox"><pre><code>ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1</code></pre></div> <p class="postedit"><em>Last edited by nbhs (2015-07-10 16:43:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543566">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543568" class="blockpost rowodd"> <h2><span><span class="conr">#5548</span> <a href="viewtopic.php?pid=1543568#p1543568">2015-07-10 16:47:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="codebox"><pre><code>ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1</code></pre></div></div></blockquote></div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="codebox"><pre><code>/init/ line 1 = ivrs_ioapic[9]=00:14.0 : Command not found /init/ line 1 = ivrs_ioapic[10]=00:00.1 : Command not found</code></pre></div><p>or something like that.</p></div></blockquote></div><p>Wait, how could i miss that part of his message?&gt;_&lt;<br />Sorry for bothering guys.</p><p>@Zeorymer:<br />Are you sure you&#039;ve put that command line switches into the right... place?<br />Cause if you&#039;re running kernel newer than 3.19(where there&#039;s a patch for that) - that line is your only solution apart from aw&#039;s ultimate one.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-10 16:48:37)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543587" class="blockpost roweven"> <h2><span><span class="conr">#5549</span> <a href="viewtopic.php?pid=1543587#p1543587">2015-07-10 17:55:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92304">Zeorymer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-03</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jerichokru@aol.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="codebox"><pre><code>ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1</code></pre></div></div></blockquote></div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="codebox"><pre><code>/init/ line 1 = ivrs_ioapic[9]=00:14.0 : Command not found /init/ line 1 = ivrs_ioapic[10]=00:00.1 : Command not found</code></pre></div><p>or something like that.</p></div></blockquote></div><p>Wait, how could i miss that part of his message?&gt;_&lt;<br />Sorry for bothering guys.</p><p>@Zeorymer:<br />Are you sure you&#039;ve put that command line switches into the right... place?<br />Cause if you&#039;re running kernel newer than 3.19(where there&#039;s a patch for that) - that line is your only solution apart from aw&#039;s ultimate one.</p></div></blockquote></div><p>Kernel was posted several posts ago: 4.0.7<br />Processor is an 8350.</p><div class="codebox"><pre class="vscroll"><code>GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=&quot;Arch&quot; GRUB_CMDLINE_LINUX_DEFAULT=&quot;iommu=debug,verbose amd_iommu_dump=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1&quot; GRUB_CMDLINE_LINUX=&quot;&quot; # # Preload both GPT and MBR modules so that they are not missed GRUB_PRELOAD_MODULES=&quot;part_gpt part_msdos&quot; # Uncomment to enable Hidden Menu, and optionally hide the timeout count #GRUB_HIDDEN_TIMEOUT=5 #GRUB_HIDDEN_TIMEOUT_QUIET=true # Uncomment to use basic console GRUB_TERMINAL_INPUT=console # Uncomment to disable graphical terminal #GRUB_TERMINAL_OUTPUT=console # The resolution used on graphical terminal # note that you can use only modes which your graphic card supports via VBE # you can see them in real GRUB with the command `vbeinfo&#039; GRUB_GFXMODE=auto # Uncomment to allow the kernel use the same resolution used by grub GRUB_GFXPAYLOAD_LINUX=keep # Uncomment if you want GRUB to pass to the Linux kernel the old parameter # format &quot;root=/dev/xxx&quot; instead of &quot;root=/dev/disk/by-uuid/xxx&quot; #GRUB_DISABLE_LINUX_UUID=true # Uncomment to disable generation of recovery mode menu entries #GRUB_DISABLE_RECOVERY=true # Uncomment and set to the desired menu colors. Used by normal and wallpaper # modes only. Entries specified as foreground/background. GRUB_COLOR_NORMAL=&quot;light-blue/black&quot; GRUB_COLOR_HIGHLIGHT=&quot;light-cyan/blue&quot; # Uncomment one of them for the gfx desired, a image background or a gfxtheme #GRUB_BACKGROUND=&quot;/path/to/wallpaper&quot; #GRUB_THEME=&quot;/path/to/gfxtheme&quot; # Uncomment to get a beep at GRUB start #GRUB_INIT_TUNE=&quot;480 440 1&quot; #GRUB_SAVEDEFAULT=&quot;true&quot;</code></pre></div><p>This is where I put it, is this wrong?&#160; I know there are other things in there that I recently added to see if I can get other information (first one doesn&#039;t seem to do anything new).</p><p>What I find odd id that I get the command not found messages but I don&#039;t get the IVRS messages being mapped wrong...which leads me to believe that the kernel THINKS the command is being passed(?)</p><p>So...a new board is the only solution?&#160; Damn you Asus.</p> <p class="postedit"><em>Last edited by Zeorymer (2015-07-10 17:59:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543587">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543592" class="blockpost rowodd"> <h2><span><span class="conr">#5550</span> <a href="viewtopic.php?pid=1543592#p1543592">2015-07-10 18:17:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Zeorymer</p><p>You can <a href="https://bugzilla.kernel.org/" rel="nofollow">file a bug</a> or <a href="https://lists.linuxfoundation.org/mailman/listinfo/iommu" rel="nofollow">post to the iommu mailing list</a></p><p>@The_Moves</p><p>Whatever I need for the situation.&#160; Often rc kernels for development and testing, latest Fedora kernel otherwise.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543592">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=221">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=220">220</a> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <strong>222</strong> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=223">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
