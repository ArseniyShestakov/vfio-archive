<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 188) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=188" title="Page 188" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=187" title="Page 187" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=189" title="Page 189" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=187">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=186">186</a> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <strong>188</strong> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=189">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1515918" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4676</span> <a href="viewtopic.php?pid=1515918#p1515918">2015-03-31 21:31:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Now when I run the VM script it gives the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: vfio: error no iommu_group for device</code></pre></div></div></blockquote></div><p>That means the IOMMU is not enabled.&#160; Maybe it&#039;s not enabled in the kernel config.</p></div></blockquote></div><p>Well that would be a bad thing, considering this kernel is made to enable pci passthrough... Well i&#039;ll report it in the AUR then.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515918">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515920" class="blockpost roweven"> <h2><span><span class="conr">#4677</span> <a href="viewtopic.php?pid=1515920#p1515920">2015-03-31 21:34:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89947">dante82</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-31</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And, aw, wasn&#039;t there some problem wioth one of hyper-v extensions and nvidia?</p></div></blockquote></div><p>I didn&#039;t feel like looking it up, I assume they&#039;re using the version that detects KVM, but not Hyper-V</p></div></blockquote></div><p>First of all, thanks for the quick replies!</p><p>I tried both variants, with and without hv-extensions. With latest driver version I get the error 43, with the 340.52 a horribly slow desktop experience.</p><div class="quotebox"><blockquote><div><p>Any messages in dmesg maybe? Like IO_PAGE_FAULT?<br />What motherboard and CPU do you have?<br />And, aw, wasn&#039;t there some problem with one of hyper-v extensions and nvidia?</p></div></blockquote></div><p>Nothing unusual in dmesg. I&#039;m currently changing graphics against an old 8800GTS I have spare here. Will post the dmesg output and results shortly</p><p>In the meantime further data that I can provide:<br />Mainboard: Intel DH87RL<br />CPU: Intel 4570<br />RAM: 32 GB</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515920">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515921" class="blockpost rowodd"> <h2><span><span class="conr">#4678</span> <a href="viewtopic.php?pid=1515921#p1515921">2015-03-31 21:41:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@dante82</p><p>Does the lag go away without the audio function assigned?&#160; If so: <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">http://vfio.blogspot.com/2014/09/vfio-i … ndows.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515921">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515923" class="blockpost roweven"> <h2><span><span class="conr">#4679</span> <a href="viewtopic.php?pid=1515923#p1515923">2015-03-31 21:47:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Now when I run the VM script it gives the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: vfio: error no iommu_group for device</code></pre></div></div></blockquote></div><p>That means the IOMMU is not enabled.&#160; Maybe it&#039;s not enabled in the kernel config.</p></div></blockquote></div><p>Well that would be a bad thing, considering this kernel is made to enable pci passthrough... Well i&#039;ll report it in the AUR then.</p></div></blockquote></div><p>It&#039;s unlikely its disabled in the kernel config since its based on -ARCH kernel:</p><p>try this and check if its enabled:</p><div class="codebox"><pre><code>zcat /proc/config.gz | grep -i iommu</code></pre></div><p>if not, check if its enabled in your bios</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515923">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515926" class="blockpost rowodd"> <h2><span><span class="conr">#4680</span> <a href="viewtopic.php?pid=1515926#p1515926">2015-03-31 21:56:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dante82 wrote:</cite><blockquote><div><p>In the meantime further data that I can provide:<br />Mainboard: Intel DH87RL<br />CPU: Intel 4570<br />RAM: 32 GB</p></div></blockquote></div><br /><p>Well, your hardware should support IOMMU, H87 chipset supports vt-d and intel i5-4570(i assume you have that CPU) supports vt-d.<br />That&#039;s a good thing. Try following aw&#039;s advice.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-31 21:56:40)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515926">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515931" class="blockpost roweven"> <h2><span><span class="conr">#4681</span> <a href="viewtopic.php?pid=1515931#p1515931">2015-03-31 22:13:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89947">dante82</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-31</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi guys,</p><p>to answer your comments first:</p><div class="quotebox"><blockquote><div><p>Does the lag go away without the audio function assigned?&#160; If so: <a href="http://vfio.blogspot.com/2014/09/vfio-i" rel="nofollow">http://vfio.blogspot.com/2014/09/vfio-i</a> … ndows.html</p></div></blockquote></div><p><del>From what I see in the qemu call, I don&#039;t have audio assigned. Correct me if I&#039;m wrong there, it&#039;s already late here.</del><br /><ins>By Audio, do you mean the Audio device of the GeForce (PCI ID 1:00.1)?</ins></p><div class="quotebox"><blockquote><div><p>Well, your hardware should support IOMMU, H87 chipset supports vt-d and intel i5-4570(i assume you have that CPU) supports vt-d.</p></div></blockquote></div><p>That&#039;s correct and I tried to choose my HW setup wisely considering the idle power consumption as well. Otherwise I would have gone with an Asrock ;-)</p><br /><p>here are the results. With the GF 8800 GTS I experience the same lagging with the drivers and dmesg gives me the following output:</p><div class="codebox"><pre class="vscroll"><code>[ 815.599961] device tap0 entered promiscuous mode [ 815.600081] br0: port 2(tap0) entered forwarding state [ 815.600090] br0: port 2(tap0) entered forwarding state [ 815.950618] vfio-pci 0000:01:00.0: enabling device (0400 -&gt; 0403) [ 815.978917] vfio-pci 0000:03:00.0: enabling device (0500 -&gt; 0502) [ 816.545577] irq 16: nobody cared (try booting with the &quot;irqpoll&quot; option) [ 816.546138] CPU: 1 PID: 0 Comm: swapper/1 Not tainted 3.19.2-1-vfio #1 [ 816.546139] Hardware name: /DH87RL, BIOS RLH8710H.86A.0327.2014.0924.1645 09/24/2014 [ 816.546140] 0000000000000000 1e87b86f7f3a999a ffff88082fa83e28 ffffffff8155d0cf [ 816.546142] 0000000000000000 ffff88080a6dac00 ffff88082fa83e58 ffffffff810ce6a6 [ 816.546143] ffff88080a0b4b50 ffff88080a6dac00 0000000000000000 0000000000000010 [ 816.546145] Call Trace: [ 816.546146] &lt;IRQ&gt; [&lt;ffffffff8155d0cf&gt;] dump_stack+0x4c/0x6e [ 816.546155] [&lt;ffffffff810ce6a6&gt;] __report_bad_irq+0x36/0xd0 [ 816.546157] [&lt;ffffffff810cea47&gt;] note_interrupt+0x257/0x2a0 [ 816.546159] [&lt;ffffffff810cbfae&gt;] handle_irq_event_percpu+0xae/0x1f0 [ 816.546161] [&lt;ffffffff810cc131&gt;] handle_irq_event+0x41/0x70 [ 816.546162] [&lt;ffffffff810cefd6&gt;] handle_fasteoi_irq+0x86/0x140 [ 816.546166] [&lt;ffffffff81018252&gt;] handle_irq+0x22/0x40 [ 816.546169] [&lt;ffffffff815654bf&gt;] do_IRQ+0x4f/0xf0 [ 816.546171] [&lt;ffffffff8156346d&gt;] common_interrupt+0x6d/0x6d [ 816.546172] &lt;EOI&gt; [&lt;ffffffff81421ac2&gt;] ? poll_idle+0x42/0x80 [ 816.546176] [&lt;ffffffff81421519&gt;] cpuidle_enter_state+0x49/0x190 [ 816.546177] [&lt;ffffffff81421747&gt;] cpuidle_enter+0x17/0x20 [ 816.546179] [&lt;ffffffff810b49c8&gt;] cpu_startup_entry+0x388/0x410 [ 816.546182] [&lt;ffffffff8104b55f&gt;] start_secondary+0x1af/0x1f0 [ 816.546183] handlers: [ 816.546384] [&lt;ffffffffa004da70&gt;] usb_hcd_irq [usbcore] [ 816.546817] [&lt;ffffffffa047a780&gt;] vfio_intx_handler [vfio_pci] [ 816.547298] Disabling IRQ #16 [ 818.531373] irq 16: nobody cared (try booting with the &quot;irqpoll&quot; option) [ 818.531875] CPU: 3 PID: 501 Comm: qemu-system-x86 Not tainted 3.19.2-1-vfio #1 [ 818.531876] Hardware name: /DH87RL, BIOS RLH8710H.86A.0327.2014.0924.1645 09/24/2014 [ 818.531877] 0000000000000000 00000000d16d99f1 ffff88082fb83e28 ffffffff8155d0cf [ 818.531879] 0000000000000000 ffff88080a6dac00 ffff88082fb83e58 ffffffff810ce6a6 [ 818.531880] ffff88080a0b4b50 ffff88080a6dac00 0000000000000000 0000000000000010 [ 818.531882] Call Trace: [ 818.531883] &lt;IRQ&gt; [&lt;ffffffff8155d0cf&gt;] dump_stack+0x4c/0x6e [ 818.531892] [&lt;ffffffff810ce6a6&gt;] __report_bad_irq+0x36/0xd0 [ 818.531894] [&lt;ffffffff810cea47&gt;] note_interrupt+0x257/0x2a0 [ 818.531896] [&lt;ffffffff810cbfae&gt;] handle_irq_event_percpu+0xae/0x1f0 [ 818.531897] [&lt;ffffffff810cc131&gt;] handle_irq_event+0x41/0x70 [ 818.531899] [&lt;ffffffff810cefd6&gt;] handle_fasteoi_irq+0x86/0x140 [ 818.531902] [&lt;ffffffff81018252&gt;] handle_irq+0x22/0x40 [ 818.531904] [&lt;ffffffff815654bf&gt;] do_IRQ+0x4f/0xf0 [ 818.531906] [&lt;ffffffff8156346d&gt;] common_interrupt+0x6d/0x6d [ 818.531907] &lt;EOI&gt; [&lt;ffffffff813c9f28&gt;] ? intel_iommu_unmap+0x1a8/0x1e0 [ 818.531911] [&lt;ffffffff813c9eb4&gt;] ? intel_iommu_unmap+0x134/0x1e0 [ 818.531913] [&lt;ffffffff813baedc&gt;] iommu_unmap+0xac/0x1c0 [ 818.531919] [&lt;ffffffffa040fa13&gt;] vfio_remove_dma+0xc3/0x1b0 [vfio_iommu_type1] [ 818.531921] [&lt;ffffffffa0410204&gt;] vfio_iommu_type1_ioctl+0x464/0xaae [vfio_iommu_type1] [ 818.531926] [&lt;ffffffffa05d08aa&gt;] ? kvm_set_memory_region+0x3a/0x50 [kvm] [ 818.531929] [&lt;ffffffffa05d0d05&gt;] ? kvm_vm_ioctl+0x445/0x790 [kvm] [ 818.531931] [&lt;ffffffffa0404fc7&gt;] vfio_fops_unl_ioctl+0x77/0x2c0 [vfio] [ 818.531935] [&lt;ffffffff811e4e48&gt;] do_vfs_ioctl+0x2f8/0x500 [ 818.531937] [&lt;ffffffff811ef592&gt;] ? __fget+0x72/0xb0 [ 818.531939] [&lt;ffffffff811e50d1&gt;] SyS_ioctl+0x81/0xa0 [ 818.531941] [&lt;ffffffff81562909&gt;] system_call_fastpath+0x12/0x17 [ 818.531941] handlers: [ 818.532119] [&lt;ffffffffa004da70&gt;] usb_hcd_irq [usbcore] [ 818.532505] [&lt;ffffffffa047a780&gt;] vfio_intx_handler [vfio_pci] [ 818.532936] Disabling IRQ #16 [ 822.210072] kvm: zapping shadow pages for mmio generation wraparound [ 830.651754] br0: port 2(tap0) entered forwarding state</code></pre></div><p>With re-attaching the GF 750TI I got an error message from KVM:</p><div class="codebox"><pre><code>KVM internal error. Suberror: 1 emulation failure RAX=0000000000000170 RBX=00000000003c2000 RCX=0000000000010008 RDX=00000000003c2000 RSI=0000000080000005 RDI=fffff80004560180 RBP=0000000000000001 RSP=ffffd000232e72e8 R8 =0000000000000000 R9 =0000000000001000 R10=ffffd000232e7490 R11=0000000000000000 R12=0000000000000000 R13=0000000000000002 R14=ffffd000232e7488 R15=0000000000000001 RIP=ffffffffffd03000 RFL=00010246 [---Z-P-] CPL=0 II=0 A20=1 SMM=0 HLT=0 ES =002b 0000000000000000 ffffffff 00c0f300 DPL=3 DS [-WA] CS =0010 0000000000000000 ffffffff 00a09b00 DPL=0 CS64 [-RA] SS =0018 0000000000000000 ffffffff 00c09300 DPL=0 DS [-WA] DS =002b 0000000000000000 ffffffff 00c0f300 DPL=3 DS [-WA] FS =0053 0000000066076000 00003c00 0040f300 DPL=3 DS [-WA] GS =002b fffff80004560000 ffffffff 00c0f300 DPL=3 DS [-WA] LDT=0000 0000000000000000 ffffffff 00c00000 TR =0040 fffff80005f01080 00000067 00008b00 DPL=0 TSS64-busy GDT= fffff80005f00000 0000007f IDT= fffff80005f00080 00000fff CR0=80050031 CR2=000000001026efd8 CR3=000000016bb4a000 CR4=001506f8 DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 DR6=00000000ffff0ff0 DR7=0000000000000400 EFER=0000000000000d01 Code=00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 &lt;0f&gt; 01 c1 c3 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00</code></pre></div><p>After a restart of the VM, the 340 driver shows an error 43 message (which didn&#039;t come up before). </p><p><strong>BUT: After reinstalling the driver and rebooting the VM again, the lagging has gone.</strong> <br />I don&#039;t understand why but here&#039;s typical output I see from dmesg:</p><div class="codebox"><pre><code>[ 144.160027] device tap0 entered promiscuous mode [ 144.160181] br0: port 2(tap0) entered forwarding state [ 144.160189] br0: port 2(tap0) entered forwarding state [ 144.522094] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1e@0x258 [ 144.522107] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 144.525417] vfio-pci 0000:03:00.0: enabling device (0500 -&gt; 0502) [ 150.145059] kvm: zapping shadow pages for mmio generation wraparound [ 159.222102] br0: port 2(tap0) entered forwarding state</code></pre></div><p>I&#039;m happy for now but the stability of the complete setup still worries me. Any further ideas on where to investigate?</p> <p class="postedit"><em>Last edited by dante82 (2015-03-31 22:19:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515931">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515934" class="blockpost rowodd"> <h2><span><span class="conr">#4682</span> <a href="viewtopic.php?pid=1515934#p1515934">2015-03-31 22:18:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@dante82:</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.1 \</code></pre></div><p>That&#039;s your line, and it passes your gpu&#039;s audio function.<br />First dmesg error just asking for aw&#039;s fix about MSI - IRQ #16 happened, but nobody cared. Something hints me that this irq 16 belong to 01:00.1 host device.</p><p>The solutions are:<br />1.Ditch out host device 01:00.1<br />2.Follow aw&#039;s advice on forcing it use MSI<br />3.Ditch the software part of driver installation doing anything with audio.<br />4.Get the IRQ #16 disabled via kernel error everytime.</p><p>Oh, and what the hell is host device 03:00.0? Usb controller? Studying your logs further gives me some idea about usb.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-31 22:21:08)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515934">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515935" class="blockpost roweven"> <h2><span><span class="conr">#4683</span> <a href="viewtopic.php?pid=1515935#p1515935">2015-03-31 22:22:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89947">dante82</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-31</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@dante82:</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.1 \</code></pre></div><p>That&#039;s your line, and it passes your gpu&#039;s audio function.<br />First dmesg error just asking for aw&#039;s fix about MSI - IRQ #16 happened, but nobody cared. Something hints me that this irq 16 belong to 01:00.1 host device.</p><p>The solutions are:<br />1.Ditch out host device 01:00.1<br />2.Follow aw&#039;s advice on forcing it use MSI<br />3.Ditch the software part of driver installation doing anything with audio.<br />4.Get the IRQ #16 disabled via kernel error everytime.</p></div></blockquote></div><p>I just had the same idea (see my edited post). ;-)</p><p>Thanks a lot for your advices! I will investigate further tomorrow and see how it goes.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515935">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515937" class="blockpost rowodd"> <h2><span><span class="conr">#4684</span> <a href="viewtopic.php?pid=1515937#p1515937">2015-03-31 22:25:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89947">dante82</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-31</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Oh, and what the hell is host device 03:00.0? Usb controller? Studying your logs further gives me some idea about usb.</p></div></blockquote></div><p>Yeah right, I forgot to mention that small detail:</p><div class="codebox"><pre><code>03:00.0 USB controller: VIA Technologies, Inc. Device 3483 (rev 01) (prog-if 30 [XHCI]) Subsystem: VIA Technologies, Inc. Device 3483 Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B- DisINTx+ Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx+ Latency: 0, Cache Line Size: 64 bytes Interrupt: pin A routed to IRQ 33 Region 0: Memory at f7800000 (64-bit, non-prefetchable) [size=4K] Capabilities: &lt;access denied&gt; Kernel driver in use: vfio-pci Kernel modules: xhci_pci</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515937">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515938" class="blockpost roweven"> <h2><span><span class="conr">#4685</span> <a href="viewtopic.php?pid=1515938#p1515938">2015-03-31 22:27:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>It&#039;s unlikely its disabled in the kernel config since its based on -ARCH kernel:</p><p>try this and check if its enabled:</p><div class="codebox"><pre><code>zcat /proc/config.gz | grep -i iommu</code></pre></div><p>if not, check if its enabled in your bios</p></div></blockquote></div><p>Well it seemed my BIOS got reset somehow without mentioning me, probably when I plugged the host GPU in again.<br />Vt-d was disabled, enabled it, and it worked again. Thanks for your help guys!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515938">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515979" class="blockpost rowodd"> <h2><span><span class="conr">#4686</span> <a href="viewtopic.php?pid=1515979#p1515979">2015-04-01 02:05:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, aw:</p><p>I use linux-3.18.6 and qemu-2.1.3 and can passthrough AMD R5000 successful.<br />but I can not see the VM bios startup message on screen, it direct go to the windows 7 startup process. </p><p>give me some idea, thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515979">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515980" class="blockpost roweven"> <h2><span><span class="conr">#4687</span> <a href="viewtopic.php?pid=1515980#p1515980">2015-04-01 02:14:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@erganzi</p><p>-boot menu=on[,splash-time=$timeout_ms]&#160; ?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515980">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515997" class="blockpost rowodd"> <h2><span><span class="conr">#4688</span> <a href="viewtopic.php?pid=1515997#p1515997">2015-04-01 05:17:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84454">darkstego</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-19</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84454">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys,</p><p>I was able to get Windows 8.1 running with VFIO and OVMF, but I have an odd issue.</p><p>After the windows install, OVMF will not boot windows if I remove the drive with the install media</p><p>Here is my running script.</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -L $HOME/Desktop/ovmf -bios bios.bin \ -enable-kvm -m 8192 -smp 4,cores=2,threads=2,sockets=1 \ -cpu host,kvm=off \ -device virtio-scsi-pci,id=scsi \ -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install \ -drive file=/dev/sdb,id=disk_primary,format=raw,if=none -device scsi-hd,drive=disk_primary \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -vga none \ -rtc base=localtime,clock=host \ -soundhw hda \ -device vfio-pci,host=05:00.0</code></pre></div><p>The trouble is if I omit the </p><div class="codebox"><pre><code> -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install </code></pre></div><p> line or move it after the disk drive the EFI will not find anything to boot.</p><p>I am sure the windows installed in EFI mode (GPT partition and everything), but I can&#039;t seem to convince OVMF to boot into it without the iso present.</p><p>I would appreciate any advice on the matter.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515997">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516012" class="blockpost roweven"> <h2><span><span class="conr">#4689</span> <a href="viewtopic.php?pid=1516012#p1516012">2015-04-01 07:18:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@erganzi</p><p>-boot menu=on[,splash-time=$timeout_ms]&#160; ?</p></div></blockquote></div><p>Try:<br />-boot menu=on,splash-time=20000</p><p>It still display nothing, just black screen, then turned into windows startup.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516012">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516016" class="blockpost rowodd"> <h2><span><span class="conr">#4690</span> <a href="viewtopic.php?pid=1516016#p1516016">2015-04-01 07:49:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Any idea why this command:</p><div class="codebox"><pre><code>virt-install --name=win7 --os-type=windows --disk path=/dev/mapper/VMssd-win7 --cdrom=/vm/win7x64.iso --graphics spice --ram=2048 --boot loader_type=pflash,loader_ro=yes,loader=/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd,nvram_template=/vm/win7_VARS-pure-efi.fd</code></pre></div><p>Results in this:</p><div class="codebox"><pre><code>ERROR Unknown options [&#039;loader_ro&#039;, &#039;nvram_template&#039;, &#039;loader_type&#039;]</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516016">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516024" class="blockpost roweven"> <h2><span><span class="conr">#4691</span> <a href="viewtopic.php?pid=1516024#p1516024">2015-04-01 08:51:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><p>Any idea why this command:</p><div class="codebox"><pre><code>virt-install --name=win7 --os-type=windows --disk path=/dev/mapper/VMssd-win7 --cdrom=/vm/win7x64.iso --graphics spice --ram=2048 --boot loader_type=pflash,loader_ro=yes,loader=/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd,nvram_template=/vm/win7_VARS-pure-efi.fd</code></pre></div><p>Results in this:</p><div class="codebox"><pre><code>ERROR Unknown options [&#039;loader_ro&#039;, &#039;nvram_template&#039;, &#039;loader_type&#039;]</code></pre></div></div></blockquote></div><p>Maybe it&#039;s /etc/libvirtd/qemu.conf error, and there&#039;s no OVMF line there as mentioned in OVMF whitepaper?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516024">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516125" class="blockpost rowodd"> <h2><span><span class="conr">#4692</span> <a href="viewtopic.php?pid=1516125#p1516125">2015-04-01 17:03:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code>nvram = [ &quot;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd&quot; ]</code></pre></div><p>That&#039;s in /etc/libvirt/qemu.conf</p><p>It almost seems like the error is telling me that virt-install isnt capable of those options (loader_ro, nvram_template and loader_type) even though it is documented <a href="https://fedoraproject.org/wiki/Using_UEFI_with_QEMU" rel="nofollow">here</a> and <a href="https://git.centos.org/blob/rpms!virt-manager.git/e2df08eec5891cd5102888c18f52abf4aaf876c1/SOURCES!virt-manager-virt-install-add-support-for-OVMF.patch;jsessionid=1lr71a9w5h8ing6tm850rf775" rel="nofollow">here</a>.</p><p>I think you are right duelist, because I have noticed in vart-manager I am lacking the option for setting OVMF instead of BIOS in overview.</p><p>Edit: virt-install not virsh</p><p>Even using the whitepaper as an example, I get the same error:</p><div class="codebox"><pre><code>LDR=&quot;loader=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd,loader_ro=yes,loader_type=pflash&quot; virt-install \ &gt; --name fedora20 \ &gt; --memory 2048 \ &gt; --vcpus 2 \ &gt; --os-variant fedora20 \ &gt; --boot hd,cdrom,$LDR \ &gt; --disk size=20 \ &gt; --disk path=Fedora-Live-Xfce-x86_64-20-1.iso,device=cdrom,bus=scsi</code></pre></div><div class="codebox"><pre><code>ERROR Unknown options [&#039;loader_ro&#039;, &#039;loader_type&#039;]</code></pre></div><p>Yes, I have a problem:</p><div class="codebox"><pre><code>$ virt-install --boot=? --boot options: arch cdrom clearxml domain_type dtb emulator fd hd init initargs initrd kernel kernel_args loader machine menu network os_type useserial</code></pre></div><p>I should have loader, loader_ro, loader_type, nvram and nvram_template...</p> <p class="postedit"><em>Last edited by Naruni (2015-04-01 17:59:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516125">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516144" class="blockpost roweven"> <h2><span><span class="conr">#4693</span> <a href="viewtopic.php?pid=1516144#p1516144">2015-04-01 19:04:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well libvirt git from aur lets you select ovmf. I am using ovmf pure from rpm and virt-manager works fine with ovmf </p><div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="codebox"><pre><code>nvram = [ &quot;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd&quot; ]</code></pre></div><p>That&#039;s in /etc/libvirt/qemu.conf</p><p>It almost seems like the error is telling me that virt-install isnt capable of those options (loader_ro, nvram_template and loader_type) even though it is documented <a href="https://fedoraproject.org/wiki/Using_UEFI_with_QEMU" rel="nofollow">here</a> and <a href="https://git.centos.org/blob/rpms!virt-manager.git/e2df08eec5891cd5102888c18f52abf4aaf876c1/SOURCES!virt-manager-virt-install-add-support-for-OVMF.patch;jsessionid=1lr71a9w5h8ing6tm850rf775" rel="nofollow">here</a>.</p><p>I think you are right duelist, because I have noticed in vart-manager I am lacking the option for setting OVMF instead of BIOS in overview.</p><p>Edit: virt-install not virsh</p><p>Even using the whitepaper as an example, I get the same error:</p><div class="codebox"><pre><code>LDR=&quot;loader=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd,loader_ro=yes,loader_type=pflash&quot; virt-install \ &gt; --name fedora20 \ &gt; --memory 2048 \ &gt; --vcpus 2 \ &gt; --os-variant fedora20 \ &gt; --boot hd,cdrom,$LDR \ &gt; --disk size=20 \ &gt; --disk path=Fedora-Live-Xfce-x86_64-20-1.iso,device=cdrom,bus=scsi</code></pre></div><div class="codebox"><pre><code>ERROR Unknown options [&#039;loader_ro&#039;, &#039;loader_type&#039;]</code></pre></div><p>Yes, I have a problem:</p><div class="codebox"><pre><code>$ virt-install --boot=? --boot options: arch cdrom clearxml domain_type dtb emulator fd hd init initargs initrd kernel kernel_args loader machine menu network os_type useserial</code></pre></div><p>I should have loader, loader_ro, loader_type, nvram and nvram_template...</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516144">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516160" class="blockpost rowodd"> <h2><span><span class="conr">#4694</span> <a href="viewtopic.php?pid=1516160#p1516160">2015-04-01 19:56:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="codebox"><pre><code>nvram = [ &quot;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd&quot; ]</code></pre></div><p>That&#039;s in /etc/libvirt/qemu.conf</p><p>It almost seems like the error is telling me that virt-install isnt capable of those options (loader_ro, nvram_template and loader_type) even though it is documented <a href="https://fedoraproject.org/wiki/Using_UEFI_with_QEMU" rel="nofollow">here</a> and <a href="https://git.centos.org/blob/rpms!virt-manager.git/e2df08eec5891cd5102888c18f52abf4aaf876c1/SOURCES!virt-manager-virt-install-add-support-for-OVMF.patch;jsessionid=1lr71a9w5h8ing6tm850rf775" rel="nofollow">here</a>.</p></div></blockquote></div><p>Y&#039;sure that your software is updated? Seems like old libvirtd on host to me.</p><div class="codebox"><pre><code>[user@crossfire ~]$ yum info libvirt Loaded plugins: langpacks Available Packages Name : libvirt Arch : x86_64 Version : 1.2.9.2 Release : 1.fc21 Size : 43 k Repo : updates/21/x86_64</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516160">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516173" class="blockpost roweven"> <h2><span><span class="conr">#4695</span> <a href="viewtopic.php?pid=1516173#p1516173">2015-04-01 20:44:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,<br />it&#039;s me again ... :&#039;(<br />I got the 4790k today and have a fresh arch on a drive but sadly no success with my setup <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> - I have no Idea what to try next, can&#039;t figure out how to create the iommu group other than with the vfio-bind script provided by the op.</p><p>This is the provided error msg:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>// journalctl:<br />Apr 01 22:23:36 teststation kernel: Intel-IOMMU: enabled<br />Apr 01 22:23:36 teststation kernel: pci-stub: add 10DE:13C2 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />Apr 01 22:23:36 teststation kernel: pci-stub 0000:01:00.0: claimed by stub<br />Apr 01 22:23:36 teststation kernel: pci-stub: add 10DE:0FBB sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />Apr 01 22:23:36 teststation kernel: pci-stub 0000:01:00.1: claimed by stub<br />Apr 01 22:24:04 teststation kernel: vfio-pci: probe of 0000:01:00.0 failed with error -22<br />Apr 01 22:24:04 teststation kernel: vfio-pci: probe of 0000:01:00.0 failed with error -22<br />Apr 01 22:24:04 teststation kernel: vfio-pci: probe of 0000:01:00.1 failed with error -22</p><br /><p>A short Rundown of my configuration:</p><p>i7 4970K<br />Nvidia GTX 970<br />Asus Sabertooth Z87<br />2 SSD Mirrors (one for arch, one for windows)<br />16 GB RAM</p><p>Monitor1 --&gt; Intel HD4600 HDMI<br />Monitor2 --&gt; Intel HD4600 DisplayPort<br />Monitor3 --&gt; GTX 970 Displayport</p><p>$ lspci -nnv | grep NVIDIA<br />01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM204 [GeForce GTX 970] [10de:13c2] (rev a1) (prog-if 00 [VGA controller])<br />&#160; &#160; Subsystem: NVIDIA Corporation Device [10de:1116]<br />01:00.1 Audio device [0403]: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1)<br />&#160; &#160; Subsystem: NVIDIA Corporation Device [10de:1116]</p><p>$ sed -n 4p /etc/default/grub<br />GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet pcie_acs_override=downstream i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:13c2,10de:0fbb&quot;</p><p>$ sed -n 7p /etc/mkinitcpio.conf<br />MODULES=&quot;pci-stub&quot;</p><p>$lsmod|egrep -i &quot;vfio|pci_stub|kvm&quot;<br />vfio_pci&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;35525&#160; 0 <br />vfio_iommu_type1&#160; &#160; &#160; &#160;17118&#160; 0 <br />vfio&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;18477&#160; 2 vfio_iommu_type1,vfio_pci<br />kvm_intel&#160; &#160; &#160; &#160; &#160; &#160; &#160;143417&#160; 0 <br />kvm&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;435299&#160; 1 kvm_intel<br />pci_stub&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;12429&#160; 0 </p><p>If you need any further Info on my system, pls let me know ...<br />Regards.</p><p>Edit: Added System Log.</p> <p class="postedit"><em>Last edited by bierbauch (2015-04-01 20:51:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516173">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516177" class="blockpost rowodd"> <h2><span><span class="conr">#4696</span> <a href="viewtopic.php?pid=1516177#p1516177">2015-04-01 20:57:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>This is the provided error msg:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device &#039;vfio-pci&#039; could not be initialized</p></div></blockquote></div><p>Look back a page or two; VT-d is not enabled, probably in you BIOS.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516177">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516182" class="blockpost roweven"> <h2><span><span class="conr">#4697</span> <a href="viewtopic.php?pid=1516182#p1516182">2015-04-01 21:06:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>This is the provided error msg:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: Device &#039;vfio-pci&#039; could not be initialized</p></div></blockquote></div><p>Look back a page or two; VT-d is not enabled, probably in you BIOS.</p></div></blockquote></div><p>Damn&#160; ...<br />You are right. The only good thing is, I figured it out before I read your post <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>MAAAAN I feel so dumb ^^ - The CPU swap disabled the feature and I forgot to recheck!</p><p>Got it working. Let the fun begin!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516182">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516439" class="blockpost rowodd"> <h2><span><span class="conr">#4698</span> <a href="viewtopic.php?pid=1516439#p1516439">2015-04-02 20:45:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81178">marcosonoio</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-14</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81178">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, <br />thanks to all for this useful topic.<br />in these days i&#039;m trying to have a working VM with windows 8.1, but i have some problems.<br />with this config i can install windows, boot up and use windows, but when i try to install nvidia driver (340.52), i received a BSOD (with a video driver&#039;s error):</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -m 2048 -cpu host,kvm=off -smp 4 \<br />-drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \<br />-drive if=pflash,format=raw,file=/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd \<br />-device vfio-pci,host=01:00.0,romfile=/home/marco/image.rom,multifunction=on \<br />-device vfio-pci,host=01:00.1 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/home/marco/it_windows_8.1_with_update_x64_dvd_4048528.iso,id=isocd,if=none -device scsi-cd,drive=isocd \<br />-drive file=/home/marco/Scaricati/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \<br />-drive file=/home/marco/win81.raw,id=disk,format=raw,if=none -device scsi-hd,drive=disk \<br />-rtc base=localtime,clock=host \<br />-soundhw hda \<br />-vga none</p></div></blockquote></div><p>so i want to try with the q25 chipset, i can&#039;t boot up windows, but i can install the system with the &quot;-vga std&quot; option:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -m 2048 -cpu host,kvm=off -smp 4 -M q35 \<br />-drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \<br />-drive if=pflash,format=raw,file=/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,romfile=/home/marco/image.rom,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/home/marco/it_windows_8.1_with_update_x64_dvd_4048528.iso,id=isocd,if=none -device scsi-cd,drive=isocd \<br />-drive file=/home/marco/Scaricati/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \<br />-drive file=/home/marco/win81.raw,id=disk,format=raw,if=none -device scsi-hd,drive=disk \<br />-rtc base=localtime,clock=host \<br />-soundhw hda \<br />-vga none</p></div></blockquote></div><p>when i start the VM i find this in the dmesg output(always):</p><div class="quotebox"><blockquote><div><p>[&#160; &#160;47.485338] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb000 flags=0x0010]<br />[&#160; &#160;47.485345] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb3c0 flags=0x0010]<br />[&#160; &#160;47.485347] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb040 flags=0x0010]<br />[&#160; &#160;47.485348] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb400 flags=0x0010]<br />[&#160; &#160;47.485350] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb440 flags=0x0010]<br />[&#160; &#160;47.485351] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb080 flags=0x0010]<br />[&#160; &#160;47.485353] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb680 flags=0x0010]<br />[&#160; &#160;47.485354] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb0c0 flags=0x0010]<br />[&#160; &#160;47.485355] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb480 flags=0x0010]<br />[&#160; &#160;47.485356] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb100 flags=0x0010]<br />[&#160; &#160;47.485358] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb4c0 flags=0x0010]<br />[&#160; &#160;47.485359] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb140 flags=0x0010]<br />[&#160; &#160;47.485360] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb500 flags=0x0010]<br />[&#160; &#160;47.485361] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb180 flags=0x0010]<br />[&#160; &#160;47.485363] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb540 flags=0x0010]<br />[&#160; &#160;47.485364] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb1c0 flags=0x0010]<br />[&#160; &#160;47.485365] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb580 flags=0x0010]<br />[&#160; &#160;47.485367] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb200 flags=0x0010]</p></div></blockquote></div><p>my system:</p><div class="quotebox"><blockquote><div><p>amd a10 7850k<br />gigabyte GA-F2A88XN-WIFI<br />2x4gb ddr3<br />ssd 128gb 840pro<br />nvidia gtx 750 ti<br />updated fedora 21 + libvirt preview repo</p></div></blockquote></div><p>i want to install the 340.52 to not have problem with the hyperv(nvidia related).<br />what&#039;s wrong?</p><p>thanks you</p> <p class="postedit"><em>Last edited by marcosonoio (2015-04-02 20:49:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516439">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516456" class="blockpost roweven"> <h2><span><span class="conr">#4699</span> <a href="viewtopic.php?pid=1516456#p1516456">2015-04-02 21:55:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Update:&#160; so the -smp answers were helpful, thanks.&#160; Apparently Win 7 under q35 and 440fx deals somewhat differently re number of processors.&#160; First I had looked under Computer-&gt;Properties, then under Device Manager-&gt;Processors.&#160; &#160;Both setups show 6 processors under Device Manager, which I guess is the important thing.&#160; Under Computer-&gt;Properties the q35 just mentions the processor name without a number; presumably that means 1 physical processor 6 virtual cores. Under the 440fx setup it says 2 processors; presumably 2 &quot;physical&quot; with 3 virtual each.&#160; Weird and probably unimportant.&#160; If I get a chance I&#039;ll see if it changes the &quot;windows experience&quot; processor score.</p><p>As far as the USB xhci driver vs passthrough: I haven&#039;t had a chance to experiment much yet, but thanks for the extra parameters to try.&#160; I&#039;m pretty sure Win 8/8.1/server 2012 and the rest of the UEFI aware OSes are probably not a good indicator of success with Win 7.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516456">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516496" class="blockpost rowodd"> <h2><span><span class="conr">#4700</span> <a href="viewtopic.php?pid=1516496#p1516496">2015-04-03 04:12:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yep, arch&#039;s current libvirt is version 1.2.14-1-x86_64<br />I wonder if I&#039;ll go to AUR libvirt...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516496">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=187">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=186">186</a> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <strong>188</strong> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=189">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
