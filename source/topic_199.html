<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 199) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=199" title="Page 199" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=198" title="Page 198" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=200" title="Page 200" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=198">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=197">197</a> <a href="viewtopic.php?id=162768&amp;p=198">198</a> <strong>199</strong> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=200">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1524549" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4951</span> <a href="viewtopic.php?pid=1524549#p1524549">2015-04-30 01:48:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90758">Zerqz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90758">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Zerqz wrote:</cite><blockquote><div><p>Hey everyone! I have been trying to set this up on my system for hours now and have came to a standstill, lol.</p><p>After I add the kernel parameter </p><div class="codebox"><pre><code>&quot;pci-stub.ids=10de:13c0,10de:0fbb&quot; </code></pre></div><p>my system fails to get passed the &quot;Reached target Graphical Interface&quot; tab while booting. If I remove that parameter it boots fine.</p></div></blockquote></div><p>Do you have.. a second GPU that should be left for host?<br />What distrib, kernel and hardware are you using? You sure that IOMMU is on?</p></div></blockquote></div><br /><p>I have 2 gtx980&#039;s the first in 01:00.0 and the second in 07:00.0.<br />and a x64 AMD cpu</p><p>Running arch, kernel 4.0.1-1, and iommu=on is in my kernel parameters as well. It is on. </p><p>and I have added pci-stub into /etc/mkinitcpio.conf and rebuilt and all that.</p> <p class="postedit"><em>Last edited by Zerqz (2015-04-30 02:36:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524549">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524574" class="blockpost roweven"> <h2><span><span class="conr">#4952</span> <a href="viewtopic.php?pid=1524574#p1524574">2015-04-30 05:21:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Zerqz</p><p>The vfio messages suggest the IOMMU is not enabled or not present.&#160; Generally the correct option on AMD is amd_iommu=on.&#160; If you have two identical cards then the pci-stub.ids= option is maybe not the best choice for you as it will claim both devices.&#160; This is why you&#039;re failing to start graphics on the host, pci-stub owns the device rather than the host graphics driver.&#160; You&#039;ll either need to create some scripts to unbind the host device from pci-stub and give it to the host, something like:</p><div class="codebox"><pre><code>echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/pci-stub/unbind echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/remove_id echo 0000:01:00.0 &gt; /sys/bus/pci/drivers_probe echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/new_id</code></pre></div><p>(repeat for audio function/ID)&#160; You could actually replace the drivers_probe line with modprobe --ignore-install of the host driver and specify the script as an install option in modprobe.d.&#160; Another option that you&#039;ll find used previously in this very long thread is to use the xen-pciback module in place of pci-stub since it has the ability to claim devices based on bus address rather than device IDs.</p><p>You also seem to be trying to use VGA-mode assignment (I&#039;d recommend UEFI/OVMF), but you&#039;re not specifying x-vga=on as an option for the vfio-pci device.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524574">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524576" class="blockpost rowodd"> <h2><span><span class="conr">#4953</span> <a href="viewtopic.php?pid=1524576#p1524576">2015-04-30 05:28:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90758">Zerqz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90758">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Zerqz</p><p>The vfio messages suggest the IOMMU is not enabled or not present.&#160; Generally the correct option on AMD is amd_iommu=on.&#160; If you have two identical cards then the pci-stub.ids= option is maybe not the best choice for you as it will claim both devices.&#160; This is why you&#039;re failing to start graphics on the host, pci-stub owns the device rather than the host graphics driver.&#160; You&#039;ll either need to create some scripts to unbind the host device from pci-stub and give it to the host, something like:</p><div class="codebox"><pre><code>echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/pci-stub/unbind echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/remove_id echo 0000:01:00.0 &gt; /sys/bus/pci/drivers_probe echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/new_id</code></pre></div><p>(repeat for audio function/ID)&#160; You could actually replace the drivers_probe line with modprobe --ignore-install of the host driver and specify the script as an install option in modprobe.d.&#160; Another option that you&#039;ll find used previously in this very long thread is to use the xen-pciback module in place of pci-stub since it has the ability to claim devices based on bus address rather than device IDs.</p><p>You also seem to be trying to use VGA-mode assignment (I&#039;d recommend UEFI/OVMF), but you&#039;re not specifying x-vga=on as an option for the vfio-pci device.</p></div></blockquote></div><p>I thought that pci-stub.ids=10de:13c0,10de:0fbb only pointed to the card in pci slot 7, not slot 1, because the numbers beside the card in slot 1 are all different. That&#039;s why I can&#039;t just blacklist nvidia, because I still need the nvidia drivers for the first 980.</p><p>I did do some command to check if amd-vi was on and it was successful, but I will change to amd_iommu=on to see.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524576">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524579" class="blockpost roweven"> <h2><span><span class="conr">#4954</span> <a href="viewtopic.php?pid=1524579#p1524579">2015-04-30 05:34:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Zerqz</p><p>Then perhaps you don&#039;t really have two GTX980s, because they would both be 10de:13c0.&#160; Maybe you could provide us with the actual data you&#039;re working from.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524579">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524601" class="blockpost rowodd"> <h2><span><span class="conr">#4955</span> <a href="viewtopic.php?pid=1524601#p1524601">2015-04-30 07:05:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Since some time ago USB ports on the front of PC stopped working when booted. They work fine when booting though (can boot from usb drive connected to said ports). I noticed this:</p><p>On GRUB command line:</p><div class="codebox"><pre><code>pci-stub.ids=1002:4397,1002:4396,1002:6810,1002:aab0</code></pre></div><div class="codebox"><pre><code>~ % lspci -n | grep 1002:4397 00:12.0 0c03: 1002:4397 00:13.0 0c03: 1002:4397 00:16.0 0c03: 1002:4397 ~ % lspci -n | grep 1002:4396 00:12.2 0c03: 1002:4396 00:13.2 0c03: 1002:4396 00:16.2 0c03: 1002:4396 ~ % lspci -n | grep 1002:6810 06:00.0 0300: 1002:6810 ~ % lspci -n | grep 1002:aab0 06:00.1 0403: 1002:aab0</code></pre></div><div class="codebox"><pre><code>~ % lspci ... 00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller ... 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller ... 06:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Curacao XT [Radeon R9 270X] 06:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ...</code></pre></div><p>How can it be that multiple usb controllers have same id (is it called id?) <strong>1002:4396</strong>? It makes me believe assigning <strong>1002:4396</strong> to pci-stub kills my front usb ports as well as card reader. Does anyone have any idea how could i diagnose and possibly fix this? In the past during manual testing i found out that ports i want passed through to VM are on controllers 00:13.0 and 00:13.2.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524601">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524603" class="blockpost roweven"> <h2><span><span class="conr">#4956</span> <a href="viewtopic.php?pid=1524603#p1524603">2015-04-30 07:14:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>Hi, all:</p><p>my environment:<br />kernel: 3.18.6 with i915 patches.<br />qemu: 2.1.3<br />arch: Intel Xeon series<br />type: legacy VGA passthrough</p><p>There is a problem when I passthrough AMD HD7850 card to VM. the catd can passthrough successfully.<br />but when I installed driver, the vm crashed with follow error:<br />pcieport 0000:00:03.0: AER: Multiple Uncorrected (Fatal) error received: id=0000<br />vfio-pci 0000:04:00.0: PCIe Bus Error: severity=Uncorrected (Fatal), type=Unaccessible, id=0400(Unregistered Agent ID)<br />vfio-pci 0000:04:00.1: PCIe Bus Error: severity=Uncorrected (Fatal), type=Unaccessible, id=0401(Unregistered Agent ID)</p><p>qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.1) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.0) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.1) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.0) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest</p><p>If I just passthrough the VGA card, without hdmi audio, the VM worked well with driver. I don&#039;t know why, somebody can explain to me, thanks.</p></div></blockquote></div><p>Just ignored the HDMI Audio completely (or adding it to pcie.0 bus works as well).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524603">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524604" class="blockpost rowodd"> <h2><span><span class="conr">#4957</span> <a href="viewtopic.php?pid=1524604#p1524604">2015-04-30 07:14:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>Hi, aw<br />the AMD Firepro R5000 can passthrough successfully, but when I install vga driver, it restart with BSOD like atikmpag.sys error</p><p>my kernel:<br />linux-3.18.6<br />qemu:<br />qemu-2.1.3</p><p>commandline:<br />/usr/libexec/qemu-kvm-passthrough -cpu host -smp 1,sockets=1,cores=1,threads=1 \<br />-m 8192 -M q35 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/usr/share/qemu/win-pre-install-with-slic.bin \<br />-drive file=/var/lib/libvirt/images/fwq_clean_win7_64bit-patched.img,id=virtio-scsi-disk0 \<br />-device virtio-blk-pci,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=06:d8:e8:00:00:1b,addr=0x3 \<br />-net tap,ifname=tap0,script=/root/qemu-ifup \<br />-vga none -display none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=07:00.1,bus=root.1,addr=00.1 \<br />-device vfio-pci,host=06:00.0,bus=root.1,addr=00.2 \<br />-device vfio-pci,host=06:00.1,bus=root.1,addr=00.3 \<br />-device vfio-pci,host=06:00.2,bus=root.1,addr=00.4 \<br />-monitor stdio</p></div></blockquote></div><p>just ignored the HDMI Audio completely (or adding it to pcie.0 bus works as well).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524628" class="blockpost roweven"> <h2><span><span class="conr">#4958</span> <a href="viewtopic.php?pid=1524628#p1524628">2015-04-30 08:59:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone found a way to disable/power down the passthrough device when the VM is not in use?<br />Having an additional graphics card drawing power and producing heat/noise isn&#039;t ideal.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524628">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524723" class="blockpost rowodd"> <h2><span><span class="conr">#4959</span> <a href="viewtopic.php?pid=1524723#p1524723">2015-04-30 14:16:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>Has anyone found a way to disable/power down the passthrough device when the VM is not in use?<br />Having an additional graphics card drawing power and producing heat/noise isn&#039;t ideal.</p></div></blockquote></div><p>There&#039;s no way to do this without hardware support for slot power control.&#160; The best we can do generically is put the device into a D3 power state.&#160; The vfio-pci kernel driver will do this automatically for unused device bound to the driver starting in v4.1-rc1.&#160; Don&#039;t expect a massive difference, but it saves a few watts.&#160; Unfortunately it doesn&#039;t do anything about the fan speed unless the device goes to a lower fan speed in D3.&#160; We would need device specific power management drivers to do anything more effective, but the better alternative to that is probably to make the host graphics drivers more robust with binding and unbinding devices so we can simply give the device back to the host and let the native driver put it into a low power state.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524723">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524730" class="blockpost roweven"> <h2><span><span class="conr">#4960</span> <a href="viewtopic.php?pid=1524730#p1524730">2015-04-30 14:26:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>How can it be that multiple usb controllers have same id (is it called id?) <strong>1002:4396</strong>? It makes me believe assigning <strong>1002:4396</strong> to pci-stub kills my front usb ports as well as card reader. Does anyone have any idea how could i diagnose and possibly fix this? In the past during manual testing i found out that ports i want passed through to VM are on controllers 00:13.0 and 00:13.2.</p></div></blockquote></div><p>See previous suggestions to Zerqz about pci-stub and multiple devices with the same device ID.&#160; You either need to switch to xen-pciback, use a script to better manage pci-stub, or since these are just usb controllers and manage unbinding and re-binding to host drivers just fine, dynamically move the device to vfio-pci just for the VM, which is what libvirt would do if you&#039;re using it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524730">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524750" class="blockpost rowodd"> <h2><span><span class="conr">#4961</span> <a href="viewtopic.php?pid=1524750#p1524750">2015-04-30 15:04:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90758">Zerqz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90758">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Zerqz</p><p>Then perhaps you don&#039;t really have two GTX980s, because they would both be 10de:13c0.&#160; Maybe you could provide us with the actual data you&#039;re working from.</p></div></blockquote></div><p>lspci</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 980] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) 02:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 03:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 04:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller 05:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 04) 06:04.0 Multimedia audio controller: C-Media Electronics Inc CMI8788 [Oxygen HD Audio] 07:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 980] (rev a1) 07:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) 0b:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 09) 0c:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller 0d:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller</code></pre></div><p>lspci -n</p><div class="codebox"><pre><code>01:00.0 0300: 10de:13c0 (rev a1) 01:00.1 0403: 10de:0fbb (rev a1) 02:00.0 0106: 1b21:0612 (rev 01) 03:00.0 0106: 1b21:0612 (rev 01) 04:00.0 0c03: 1b21:1042 05:00.0 0604: 1b21:1080 (rev 04) 06:04.0 0401: 13f6:8788 07:00.0 0300: 10de:13c0 (rev a1) 07:00.1 0403: 10de:0fbb (rev a1) 0b:00.0 0200: 10ec:8168 (rev 09)</code></pre></div><p>My mistake.</p><p>I&#039;ll try to unbind it and see what happens soon as I can.</p><div class="codebox"><pre><code>You&#039;ll either need to create some scripts to unbind the host device from pci-stub and give it to the host, something like: echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/pci-stub/unbind echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/remove_id echo 0000:01:00.0 &gt; /sys/bus/pci/drivers_probe echo 10de:13c0 &gt; /sys/bus/pci/drivers/pci-stub/new_id (repeat for audio function/ID) You could actually replace the drivers_probe line with modprobe --ignore-install of the host driver and specify the script as an install option in modprobe.d. Another option that you&#039;ll find used previously in this very long thread is to use the xen-pciback module in place of pci-stub since it has the ability to claim devices based on bus address rather than device IDs. You also seem to be trying to use VGA-mode assignment (I&#039;d recommend UEFI/OVMF), but you&#039;re not specifying x-vga=on as an option for the vfio-pci device.</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524750">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524756" class="blockpost roweven"> <h2><span><span class="conr">#4962</span> <a href="viewtopic.php?pid=1524756#p1524756">2015-04-30 15:17:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Off-topic a bit:<br />We&#039;re steadily going to page #<strong>200</strong>, and approaching <strong>5000</strong> posts in this thread. We really need to do something about it...</p><p>It makes me somewhat envy seeing people with two GTX980 not running SLI for maximum lulz... Would be awesome to quadrify and push them both into the VM.. Sadly, there&#039;s no quadro-counterpart yet.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-30 15:31:48)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524756">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524788" class="blockpost rowodd"> <h2><span><span class="conr">#4963</span> <a href="viewtopic.php?pid=1524788#p1524788">2015-04-30 16:20:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I posted about this issue <a href="https://bbs.archlinux.org/viewtopic.php?pid=1524772#p1524772" rel="nofollow">here</a>, but I&#039;m having issues with windows freezing as I&#039;m trying to boot in ovmf. Could anyone help me?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524788">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524797" class="blockpost roweven"> <h2><span><span class="conr">#4964</span> <a href="viewtopic.php?pid=1524797#p1524797">2015-04-30 16:43:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90178">Omar007</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-09</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90178">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@noctlos; I&#039;m having the same problem. I think I once read somewhere that it had to do with the Q35 chipset not allowing Windows 8 and later to boot properly but I can&#039;t seem to find it so I&#039;m not certain that is still the case or how to solve it.</p><p>@Duelist; a physical Q35 chipset doesn&#039;t support SLI/CF so I guess you can&#039;t use it in the VM even if you do pass through 2 GPU&#039;s.. Did anyone try to do this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524797">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524801" class="blockpost rowodd"> <h2><span><span class="conr">#4965</span> <a href="viewtopic.php?pid=1524801#p1524801">2015-04-30 17:04:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Omar007; I have another image on the same computer, with a similar windows installation. It boots fine under the same arguments. That it won&#039;t boot with a new image doesn&#039;t compute for me.</p><p>Edit: nevertheless, it appears that removing references to q35 chipsets resolved this. I&#039;ll do some more experimenting.</p> <p class="postedit"><em>Last edited by noctlos (2015-04-30 17:09:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524801">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524877" class="blockpost roweven"> <h2><span><span class="conr">#4966</span> <a href="viewtopic.php?pid=1524877#p1524877">2015-04-30 21:05:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83975">chillum</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83975">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi! I&#039;m using Linux Sabayon 3.9.0-sabayon</p><p>sysfs (/sys/) in this system isn&#039;t compatible with the sysfs folder structure used in vfio-bind on the front page; It used to work on my gentoo system, but then I upgraded to Sabayon instead of trying to figure zfs (and many other reasons), now I&#039;m stuck, quite an important bit of my work was done on Windoze, so I&#039;d like it back (and well, games of course), any help? please?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524877">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524881" class="blockpost rowodd"> <h2><span><span class="conr">#4967</span> <a href="viewtopic.php?pid=1524881#p1524881">2015-04-30 21:17:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw this time different card seem to have received communication intended for FirePro W7100 at 82:00 (see lspci -nnvt output above for my configuration)</p><div class="codebox"><pre class="vscroll"><code>[175157.337000] vfio-pci 0000:82:00.0: irq 160 for MSI/MSI-X [175157.354768] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.354957] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.354969] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355076] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.355082] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355088] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.355212] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.355218] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355223] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.355228] vfio-pci 0000:81:00.0: irq 164 for MSI/MSI-X [175157.355379] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.355385] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355390] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.355396] vfio-pci 0000:81:00.0: irq 164 for MSI/MSI-X [175157.355401] vfio-pci 0000:81:00.0: irq 165 for MSI/MSI-X [175157.355571] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.355577] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355582] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.355588] vfio-pci 0000:81:00.0: irq 164 for MSI/MSI-X [175157.355593] vfio-pci 0000:81:00.0: irq 165 for MSI/MSI-X [175157.355599] vfio-pci 0000:81:00.0: irq 166 for MSI/MSI-X [175157.355790] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.355796] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.355802] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.355807] vfio-pci 0000:81:00.0: irq 164 for MSI/MSI-X [175157.355812] vfio-pci 0000:81:00.0: irq 165 for MSI/MSI-X [175157.355818] vfio-pci 0000:81:00.0: irq 166 for MSI/MSI-X [175157.355824] vfio-pci 0000:81:00.0: irq 167 for MSI/MSI-X [175157.356036] vfio-pci 0000:81:00.0: irq 161 for MSI/MSI-X [175157.356042] vfio-pci 0000:81:00.0: irq 162 for MSI/MSI-X [175157.356047] vfio-pci 0000:81:00.0: irq 163 for MSI/MSI-X [175157.356052] vfio-pci 0000:81:00.0: irq 164 for MSI/MSI-X [175157.356057] vfio-pci 0000:81:00.0: irq 165 for MSI/MSI-X [175157.356062] vfio-pci 0000:81:00.0: irq 166 for MSI/MSI-X [175157.356068] vfio-pci 0000:81:00.0: irq 167 for MSI/MSI-X [175157.356076] vfio-pci 0000:81:00.0: irq 168 for MSI/MSI-X [175157.377567] dmar: DRHD: handling fault status reg 2 [175157.382540] dmar: DMAR:[DMA Read] Request device [81:00.0] fault addr 43e39b000 DMAR:[fault reason 06] PTE Read access is not set [175159.030150] usb 3-1: reset low-speed USB device number 2 using xhci_hcd [175159.319282] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d05120 [175159.319287] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d050c0 [175159.319295] usb 3-1: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes [175159.319299] usb 3-1: ep 0x82 - rounding interval to 64 microframes, ep desc says 80 microframes [175159.607427] usb 3-1: reset low-speed USB device number 2 using xhci_hcd [175159.896485] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d05120 [175159.896489] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d050c0 [175159.896495] usb 3-1: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes [175159.896499] usb 3-1: ep 0x82 - rounding interval to 64 microframes, ep desc says 80 microframes [175160.184610] usb 3-1: reset low-speed USB device number 2 using xhci_hcd [175160.472711] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d05120 [175160.472715] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff881025d050c0 [175160.472720] usb 3-1: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes [175160.472723] usb 3-1: ep 0x82 - rounding interval to 64 microframes, ep desc says 80 microframes [175160.764503] dmar: DRHD: handling fault status reg 102 [175160.769652] dmar: DMAR:[DMA Write] Request device [82:00.0] fault addr 43de38000 DMAR:[fault reason 05] PTE Write access is not set</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524881">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524882" class="blockpost roweven"> <h2><span><span class="conr">#4968</span> <a href="viewtopic.php?pid=1524882#p1524882">2015-04-30 21:21:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chillum wrote:</cite><blockquote><div><p>Hi! I&#039;m using Linux Sabayon 3.9.0-sabayon</p><p>sysfs (/sys/) in this system isn&#039;t compatible with the sysfs folder structure used in vfio-bind on the front page; It used to work on my gentoo system, but then I upgraded to Sabayon instead of trying to figure zfs (and many other reasons), now I&#039;m stuck, quite an important bit of my work was done on Windoze, so I&#039;d like it back (and well, games of course), any help? please?</p></div></blockquote></div><p>Why is sysfs incompatible?&#160; Is Sabayon based on a 3.9 kernel?&#160; That&#039;s way too old for VGA assignment.&#160; Have they messed with the sysfs mount point?&#160; If so, they&#039;re broken, <a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/sysfs-rules.txt" rel="nofollow">http://git.kernel.org/cgit/linux/kernel … -rules.txt</a></p><div class="quotebox"><blockquote><div><p>- sysfs is always at /sys<br />&#160; Parsing /proc/mounts is a waste of time. Other mount points are a<br />&#160; system configuration bug you should not try to solve. For test cases,<br />&#160; possibly support a SYSFS_PATH environment variable to overwrite the<br />&#160; application&#039;s behavior, but never try to search for sysfs. Never try<br />&#160; to mount it, if you are not an early boot script.</p></div></blockquote></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524882">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524885" class="blockpost rowodd"> <h2><span><span class="conr">#4969</span> <a href="viewtopic.php?pid=1524885#p1524885">2015-04-30 21:33:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83975">chillum</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83975">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>yes, sorry, I messed about trying to find a kernel that would compile and 3.9.0 was the only one that compiled, problem solved, too old a kernel thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524885">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524916" class="blockpost roweven"> <h2><span><span class="conr">#4970</span> <a href="viewtopic.php?pid=1524916#p1524916">2015-05-01 00:19:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89315">gg</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-06</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw (also, thanks @Bronek)</p><p>I&#039;m using your patch onto qemu v2.3.0 with kernel v4.1-rc1 (also with libvirt and OVMF) and my R9 290 will reset if I shutdown the machine and start it again, but not restart the machine reliably (see below).</p><p>This works both whether the Quadro 6000 is used by pci-stub, or vfio-pci and assigned together with the R9 290. I&#039;m not using the ACS quirk patch for the root PCH.</p><div class="codebox"><pre><code>-[0000:00]-+-00.0 Intel Corporation 4th Gen Core Processor DRAM Controller +-01.0-[01]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Hawaii PRO [Radeon R9 290] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Device aac8 +-01.1-[02]--+-00.0 NVIDIA Corporation GF100GL [Quadro 6000] | \-00.1 NVIDIA Corporation GF100 High Definition Audio Controller</code></pre></div><p>Before I installed the Windows drivers for the R9 290 (with only the R9 290 passed through) I was able to the restart the machine once. After installing them and going from a safe resolution to my monitor native resolution (accelerated) and then having the driver crash I haven&#039;t been able to restart (but I can shutdown and start the machine again). </p><p>After a driver crash,&#160; when I restart I get the &#039;blinking cursor on black background&#039; as mentioned by @Bronek. I&#039;m not getting messages via dmesg similar to what @Bronek is reporting when he/she also gets the blinking cursor. Per the notes in the patch, might it be the SMC firmware is not running or in some state the patch doesn&#039;t work with?</p><p>I&#039;m not sure why the driver has been crashing (I&#039;d not had the issue before with the R9 290 passed through but some other variables have changed too). I&#039;ve been unable to relate the driver crashes to anything yet and I don&#039;t know if that&#039;s what is preventing restarting. Being unable to restart the machine is a bit inconvenient when upgrading Windows 10 releases. I&#039;ll have to try again sometime with Windows 8.1 perhaps.</p><p>Just wanted to let you know that being able to shutdown and start the machine has made the R9 290 worlds more practical. </p><p>Thank you!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524916">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524923" class="blockpost rowodd"> <h2><span><span class="conr">#4971</span> <a href="viewtopic.php?pid=1524923#p1524923">2015-05-01 01:35:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90664">carterghill</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-26</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:carterghill@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m still having that code 43 issue on Windows 8.1. Here&#039;s my libvirt XML:</p><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039;&gt;<br />&#160; &lt;name&gt;Win&lt;/name&gt;<br />&#160; &lt;uuid&gt;f4f827da-ef6c-11e4-a668-8f0730658845&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;1&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-utopic&#039;&gt;hvm&lt;/type&gt;<br />&#160; &#160; &lt;boot dev=&#039;hd&#039;/&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &#160; &lt;kvm&gt;<br />&#160; &#160; &#160; &lt;hidden state=&#039;off&#039;/&gt;<br />&#160; &#160; &lt;/kvm&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt;<br />&#160; &#160; &lt;model fallback=&#039;allow&#039;&gt;SandyBridge&lt;/model&gt;<br />&#160; &lt;/cpu&gt;<br />&#160; &lt;clock offset=&#039;localtime&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/bin/kvm-spice&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/var/lib/libvirt/images/win8.1.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/carter/Windows_8.1_Pro_X64_Activated.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x7&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;4&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;interface type=&#039;network&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:a7:85:28&#039;/&gt;<br />&#160; &#160; &#160; &lt;source network=&#039;default&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;rtl8139&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;channel type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/channel&gt;<br />&#160; &#160; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt;<br />&#160; &#160; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt;<br />&#160; &#160; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt;<br />&#160; &#160; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt;<br />&#160; &#160; &lt;sound model=&#039;ich6&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;video&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; vgamem=&#039;16384&#039; heads=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/video&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x07&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x07&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&lt;/domain&gt;</p></div></blockquote></div><p>Host: Ubuntu 14.10 with GTX 560<br />Guest: Windows 8.1 GTX 760</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524923">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524930" class="blockpost roweven"> <h2><span><span class="conr">#4972</span> <a href="viewtopic.php?pid=1524930#p1524930">2015-05-01 02:36:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@carterghill</p><p>Remove the &lt;graphics&gt; and &lt;video&gt; sections.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524930">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524931" class="blockpost rowodd"> <h2><span><span class="conr">#4973</span> <a href="viewtopic.php?pid=1524931#p1524931">2015-05-01 02:40:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@gg</p><p>I can&#039;t really figure out whether the patch is an improvement for you.&#160; There&#039;s really not much difference for VM shutdown vs VM reset as far as the types of resets that occur for the device.&#160; My testing on a Bonaire seemed to indicate that resets vs shutdown/restart had about the same success rate, ie. mostly working but occasionally not.&#160; The SMC firmware must be running for the reset to work, otherwise it reverts to previous behavior, which in my experience gives you a black screen rather than bsod.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524931">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524933" class="blockpost roweven"> <h2><span><span class="conr">#4974</span> <a href="viewtopic.php?pid=1524933#p1524933">2015-05-01 02:57:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90664">carterghill</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-26</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:carterghill@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@carterghill</p><p>Remove the &lt;graphics&gt; and &lt;video&gt; sections.</p></div></blockquote></div><p>Sorry I should&#039;ve clarified, I have tried without them as well. I only had them in just now so that I could actually use windows. Without those tags, there is still no output on my second monitor.</p> <p class="postedit"><em>Last edited by carterghill (2015-05-01 04:56:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524933">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524936" class="blockpost rowodd"> <h2><span><span class="conr">#4975</span> <a href="viewtopic.php?pid=1524936#p1524936">2015-05-01 03:48:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89315">gg</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-06</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@gg</p><p>I can&#039;t really figure out whether the patch is an improvement for you.&#160; There&#039;s really not much difference for VM shutdown vs VM reset as far as the types of resets that occur for the device.&#160; My testing on a Bonaire seemed to indicate that resets vs shutdown/restart had about the same success rate, ie. mostly working but occasionally not.&#160; The SMC firmware must be running for the reset to work, otherwise it reverts to previous behavior, which in my experience gives you a black screen rather than bsod.</p></div></blockquote></div><p>Before using the patch on qemu 2.3 I was using 2.1 and was not once able to restart or shutdown|start a guest machine without suspending or rebooting the host. It seems from what I&#039;m experiencing that the patch has finally provided a reset (under certain conditions). Is there something else in qemu, the kernel, and the vfio-pci module in particular, that might be making this possible if not the patch you provided for qemu?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524936">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=198">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=197">197</a> <a href="viewtopic.php?id=162768&amp;p=198">198</a> <strong>199</strong> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=200">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
