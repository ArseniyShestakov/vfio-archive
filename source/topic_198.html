<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 198) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=198" title="Page 198" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=197" title="Page 197" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=199" title="Page 199" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=197">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <a href="viewtopic.php?id=162768&amp;p=197">197</a> <strong>198</strong> <a href="viewtopic.php?id=162768&amp;p=199">199</a> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=199">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1523720" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4926</span> <a href="viewtopic.php?pid=1523720#p1523720">2015-04-27 16:44:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey, so I have been poking around the thread trying to get this working, is the first page&#039;s guide still considered correct? I have seen mention of the linux-vfio aur package, but no other posts about how it works, and what needs to be configured on top of it. I guess my confusion revolves specifically around the pci-vfio bind script as I don&#039;t remember having to use that or that it was a dead end last time I got this working. </p><p>I have gotten this working before, but it&#039;s been at least 6 months and a hundred pages since I last read through the thread.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523720">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523726" class="blockpost roweven"> <h2><span><span class="conr">#4927</span> <a href="viewtopic.php?pid=1523726#p1523726">2015-04-27 16:57:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I would not recommend the vfio bind script to anyone.&#160; The better option is to use libvirt to manage the VM.&#160; If you&#039;re using OVMF for your guest (preferred), you can manage everything natively within the libvirt xml.&#160; If you need to go the seabios route due to old guest or old hardware, use a wrapper script to add the x-vga option to the vfio-pci device in the resulting QEMU commandline.&#160; If you insist on using q35 (not recommended except for Linux guests), you can also use the wrapper to move the GPU to the root complex or create and use root ports.&#160; This usage is really only a workaround until libvirt gets sane support for q35 topology though.&#160; Using &lt;qemu:arg&gt; options in the xml is generally not recommended or necessary and causes significant headaches if used to specify the assigned device since it&#039;s effectively hidden from libvirt.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523726">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523740" class="blockpost rowodd"> <h2><span><span class="conr">#4928</span> <a href="viewtopic.php?pid=1523740#p1523740">2015-04-27 17:28:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for the fast reply!</p><p>Ok, so I am planning on using OVMF(I have used it in the past in conjunction with libvirt and know the gotchas that apply to nvidia cards) but before I get there, is there anything with the kernel that I need to do? I have downloaded and compiled linux-vfio, and am about to add a boot configuration for it, but this is where my memory fails me. I don&#039;t remember if this is something I had to do to get OVMF to attach to the video card correctly, or if it was something I did that turned out to not apply. And is the required boot option just to enable iommu in the boot parameters on a stock kernel?</p><p>Setup:<br />Intel 4790k(Supports VT-d)<br />Intel IGD<br />Nvidia GTX760(Supports EFI)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523744" class="blockpost roweven"> <h2><span><span class="conr">#4929</span> <a href="viewtopic.php?pid=1523744#p1523744">2015-04-27 17:45:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Punkbob</p><p>Given your hardware and intended (non-VGA) usage, the only potential patch you&#039;d need vs stock is the ACS override.&#160; You can probably avoid that patch as well by being careful not to share processor root ports with other devices or worst case, moving the Nvidia card to a PCH root port.&#160; I&#039;m sorry, I don&#039;t know what the linux-vfio package is, I don&#039;t run Arch myself.&#160; Personally I&#039;d try to use the stock kernel for your configuration.&#160; I run a GTX750 guest (UEFI) with host IGD on stock Fedora.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523744">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523825" class="blockpost rowodd"> <h2><span><span class="conr">#4930</span> <a href="viewtopic.php?pid=1523825#p1523825">2015-04-27 21:27:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>is it independent from <a href="http://article.gmane.org/gmane.linux.kernel.pci/40663" rel="nofollow">http://article.gmane.org/gmane.linux.kernel.pci/40663</a> , or should I patch my kernel 3.18.12 as well? Or perhaps try with kernel 4.0?</p></div></blockquote></div><p>Not at all, it should be independent of kernel version.&#160; I&#039;ve also decided that the reset is not reliable enough for the kernel, so this is the patch proposed for QEMU: <a href="https://lists.gnu.org/archive/html/qemu-devel/2015-04/msg03128.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 03128.html</a></p><p>EDIT: Note that this version only enables the reset for specific device IDs.&#160; If you&#039;re looking to try it on something else, you&#039;ll need to add the ID for your hardware to the list.</p></div></blockquote></div><p>@aw</p><p>I added my device to your patch and it seems to work, I was able to restart guest (without crashing host) although tried only once. More testing needed because after first restart I noticed brief artifacts on screen of this card, until driver was loaded.</p><p>More details of my card, in case you are interested</p><div class="codebox"><pre class="vscroll"><code>root@gdansk ~ # lspci -nnv -s 0000:82:00.0 82:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tonga PRO GL [FirePro W7100] [1002:692b] (prog-if 00 [VGA controller]) Subsystem: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:030c] Flags: fast devsel, IRQ 11 Memory at e0000000 (64-bit, prefetchable) [disabled] [size=256M] Memory at f0000000 (64-bit, prefetchable) [disabled] [size=2M] I/O ports at f000 [disabled] [size=256] Memory at fbd00000 (32-bit, non-prefetchable) [disabled] [size=256K] Expansion ROM at fbd40000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [200] #15 Capabilities: [270] #19 Capabilities: [2b0] Address Translation Service (ATS) Capabilities: [2c0] #13 Capabilities: [2d0] #1b Capabilities: [328] Alternative Routing-ID Interpretation (ARI) root@gdansk ~ # lspci -nnv -s 0000:82:00.1 82:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:aad8] Subsystem: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:aad8] Flags: bus master, fast devsel, latency 0, IRQ 10 Memory at fbd60000 (64-bit, non-prefetchable) [size=16K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [328] Alternative Routing-ID Interpretation (ARI) Kernel modules: snd_hda_intel</code></pre></div><p>Here is change of your patch:</p><div class="codebox"><pre><code>+ case 0x67B9: + case 0x67BA: + case 0x67BE: + /1 /bin /boot /cdrom /dev /etc /home /initrd.img /initrd.img.old /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /ubiquity-apt-clone /usr /var /vmlinuz /vmlinuz.old /win81-base.qcow2 /win81-base.qcow2.md5 /win81-writable-amd.qcow2 /win81-writable-nvidia.qcow2 /win81-writable-nvidia.qcow2.backup Tonga */ + case 0x692B: /1 /bin /boot /cdrom /dev /etc /home /initrd.img /initrd.img.old /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /ubiquity-apt-clone /usr /var /vmlinuz /vmlinuz.old /win81-base.qcow2 /win81-base.qcow2.md5 /win81-writable-amd.qcow2 /win81-writable-nvidia.qcow2 /win81-writable-nvidia.qcow2.backup Tonga PRO GL [Radeon W7100] */ + vdev-&gt;resetfn = vfio_radeon_reset; + break; + } + break; + } +}</code></pre></div><p>FWIW, I noticed that I am able to cleanly (probably - didn&#039;t try to build yet) apply your patches from mainline kernel on 3.18.12 which I&#039;m using, would you recommend or discourage applying any of those? Assuming I am not merging any other patches from mainline </p><div class="codebox"><pre><code>bronek@gdansk ~/Sources/linux-stable (git)-[v3.18.12] % git log --oneline --reverse -n 21 43f497a Linux 3.18.12 8659c14 PCI: Add flag for devices that don&#039;t reset on D3hot-&gt;D0 transition d3aa82b PCI: Mark AMD/ATI VGA devices that don&#039;t reset on D3hot-&gt;D0 transition 92e46be vfio/type1: DMA unmap chunking def9cee vfio/type1: Chunk contiguous reserved/invalid page mappings f7fd50e vfio/type1: Add conditional rescheduling 87498ef vfio: Add device tracking during unbind afe7fd7 vfio: Tie IOMMU group reference to vfio group e22eb3a vfio: Add and use device request op for vfio bus drivers 1d8e0e3 vfio-pci: Generalize setup of simple eventfds e0919875 vfio-pci: Add device request interface 65c825f iommu/vt-d: Detach domain *only* from attached iommus 05b36e6 PCI: Add ACS quirks for Intel 1G NICs 6988212 iommu/vt-d: Remove unused variable 9971924 vgaarb: Stub vga_set_legacy_decoding() 7f56323 vfio-pci: Add module option to disable VGA region access b7316ee vfio-pci: Add VGA arbiter client b3d9280 vfio-pci: Allow PCI IDs to be specified as module options 0802afb vfio-pci: Remove warning if try-reset fails 42ee7c2 vfio-pci: Move idle devices to D3hot power state faadced vfio-pci: Fix use after free</code></pre></div><p>Thank you for your hard work on vfio and PCI subsystem :)</p> <p class="postedit"><em>Last edited by Bronek (2015-04-27 21:30:28)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523825">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523851" class="blockpost roweven"> <h2><span><span class="conr">#4931</span> <a href="viewtopic.php?pid=1523851#p1523851">2015-04-27 23:11:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I would not recommend the vfio bind script to anyone.</p></div></blockquote></div><p>Thanks for reminding me to remove it from my systemd and system overall - i&#039;ve moved to libvirt ever since and totally forgot about that script.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523851">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523854" class="blockpost rowodd"> <h2><span><span class="conr">#4932</span> <a href="viewtopic.php?pid=1523854#p1523854">2015-04-28 00:16:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90696">blakx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-27</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:nou@mailinator.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m interested in building a new system for this, with the Code 43 for Nvidia issue and the Radeon Hawaii/Bonaire reset issue, what is the recommended performant card to go with? Wait for the next line of Radeon cards?</p> <p class="postedit"><em>Last edited by blakx (2015-04-28 00:16:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523854">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523856" class="blockpost roweven"> <h2><span><span class="conr">#4933</span> <a href="viewtopic.php?pid=1523856#p1523856">2015-04-28 00:29:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for the help, just one more quick question:</p><p>Anyone have experience with getting code 10 errors on the HDMI driver for an Nvidia card?</p><p>Edit: NVM, just fixed it.</p> <p class="postedit"><em>Last edited by Punkbob (2015-04-28 00:30:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523856">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523874" class="blockpost rowodd"> <h2><span><span class="conr">#4934</span> <a href="viewtopic.php?pid=1523874#p1523874">2015-04-28 01:55:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90593">mqddb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-24</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:maqiang@shencloudtech.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mqddb wrote:</cite><blockquote><div><p>Hello everyone:<br />&#160; &#160; &#160; Will this vga-passthrough can support spice protocol? currently, spice only support qxl vga.</p></div></blockquote></div><p>No, an assigned GPU does not support any of the -display methods.&#160; Remote displays with GPU assignment requires guest-based solutions.</p></div></blockquote></div><p>@aw</p><p>&#160; &#160; If any solutions to use spice remote display when an GPU assignment. I am thinking cp the assignment GPU&#039;s FB to qxl vga, if windows guest support two vga working at the same time? If you want add this VGA-Passthrough feature to ovirt or openstack, this spice problem must be resolve, right? Do you have any plan to do this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523874">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523883" class="blockpost roweven"> <h2><span><span class="conr">#4935</span> <a href="viewtopic.php?pid=1523883#p1523883">2015-04-28 02:23:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90690">Linuxlookup</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-27</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="website"><a href="http://www.linuxlookup.com" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Has anybody actually had success following the Ubuntu guide?&#160; Seems like a flood of people following whatever misinformation it contains and landing here.</p></div></blockquote></div><p>I&#039;ve had success with Ubuntu. Though I did not follow any guide, my configurations are based on documentation and general experiences from users in various forums. I&#039;m planning to evaluate other hardware configurations and document my method in a HowTo article once satisfied with the results. For those interested in seeing Ubuntu in action, recently I published a video which demonstrates <a href="http://www.linuxlookup.com/windows_gaming_qemukvm_ubuntu_linux_amd_radeon_r9_280" rel="nofollow">Windows Gaming with QEMU/KVM on Ubuntu Linux</a>.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://www.linuxlookup.com" rel="nofollow">http://www.linuxlookup.com</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523883">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523890" class="blockpost rowodd"> <h2><span><span class="conr">#4936</span> <a href="viewtopic.php?pid=1523890#p1523890">2015-04-28 03:14:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Linuxlookup wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Has anybody actually had success following the Ubuntu guide?&#160; Seems like a flood of people following whatever misinformation it contains and landing here.</p></div></blockquote></div><p>I&#039;ve had success with Ubuntu. Though I did not follow any guide, my configurations are based on documentation and general experiences from users in various forums. I&#039;m planning to evaluate other hardware configurations and document my method in a HowTo article once satisfied with the results. For those interested in seeing Ubuntu in action, recently I published a video which demonstrates <a href="http://www.linuxlookup.com/windows_gaming_qemukvm_ubuntu_linux_amd_radeon_r9_280" rel="nofollow">Windows Gaming with QEMU/KVM on Ubuntu Linux</a>.</p></div></blockquote></div><p>R9 280 also has reset problems?&#160; That ought to be Tahiti based.&#160; Have you tried updating the Bonaire/Hawaii patch as Bronek did to add your ID?&#160; <a href="https://lists.gnu.org/archive/html/qemu-devel/2015-04/msg03128.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 03128.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523890">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523891" class="blockpost roweven"> <h2><span><span class="conr">#4937</span> <a href="viewtopic.php?pid=1523891#p1523891">2015-04-28 03:16:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mqddb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mqddb wrote:</cite><blockquote><div><p>Hello everyone:<br />&#160; &#160; &#160; Will this vga-passthrough can support spice protocol? currently, spice only support qxl vga.</p></div></blockquote></div><p>No, an assigned GPU does not support any of the -display methods.&#160; Remote displays with GPU assignment requires guest-based solutions.</p></div></blockquote></div><p>@aw</p><p>&#160; &#160; If any solutions to use spice remote display when an GPU assignment. I am thinking cp the assignment GPU&#039;s FB to qxl vga, if windows guest support two vga working at the same time? If you want add this VGA-Passthrough feature to ovirt or openstack, this spice problem must be resolve, right? Do you have any plan to do this?</p></div></blockquote></div><p>Nope.&#160; Scraping the framebuffer requires knowing where the framebuffer lives, which requires far more knowledge of proprietary drivers than I&#039;m interested in.&#160; There are client based solutions for this, NICE DCV, HP RGS, etc...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523891">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523892" class="blockpost rowodd"> <h2><span><span class="conr">#4938</span> <a href="viewtopic.php?pid=1523892#p1523892">2015-04-28 03:18:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><p>List looks like a pretty complete sync to v4.1-rc1.&#160; There&#039;s one more fix in the queue for e0919875, it&#039;s been posted, but not yet pushed.&#160; I&#039;ll try to get it in for rc2.&#160; Please update with further testing on Tonga.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523892">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1523932" class="blockpost roweven"> <h2><span><span class="conr">#4939</span> <a href="viewtopic.php?pid=1523932#p1523932">2015-04-28 09:04:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blakx wrote:</cite><blockquote><div><p>I&#039;m interested in building a new system for this, with the Code 43 for Nvidia issue and the Radeon Hawaii/Bonaire reset issue, what is the recommended performant card to go with? Wait for the next line of Radeon cards?</p></div></blockquote></div><p>Radeon R9 290X (more specifically, Saphire Tri-X UEFI enabled) worked very well for me, but now I&#039;m running two virtual machines and need space for 2 GPUs and a bunch of other cards, so it was simply too large. It is <strong>slightly larger</strong> than two slots, so it had to go, for only this reason. I do not have problems with AMD FirePro V series but they are quite expensive for what they do, similarly more expensive model of NVidia Quaddro should work for you since they are &quot;enabled&quot; for GPU pass-through (e.g. K2200 , K4200 etc) but again they are very expensive for what they do. I&#039;d guess Radeon R9 should work for you and is economical choice, but this is also a question of lucky/good choice of vendor and model.</p> <p class="postedit"><em>Last edited by Bronek (2015-04-28 09:05:24)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1523932">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524076" class="blockpost rowodd"> <h2><span><span class="conr">#4940</span> <a href="viewtopic.php?pid=1524076#p1524076">2015-04-28 19:17:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Bronek</p><p>List looks like a pretty complete sync to v4.1-rc1.&#160; There&#039;s one more fix in the queue for e0919875, it&#039;s been posted, but not yet pushed.&#160; I&#039;ll try to get it in for rc2.&#160; Please update with further testing on Tonga.</p></div></blockquote></div><br /><p>Something is not right, but I suspect it&#039;s not with qemu but vfio (or something else in kernel). Occasionally when I shutdown VM guest and then start it up again, it seems like its trying to use wrong PCI device at the moment when driver gets loaded. Not a GPU card, something entirely different. At first Windows start appears as normal, then it blanks and a cursor appears on black background (which is normal for short time when driver starts), at which moment &quot;dmesg -w&quot; starts showing errors from a <strong>different</strong> PCIe card and its driver (slot 84:00.0 is Intel P3700, driver nvme) and Windows guest remains with blank screen.</p><div class="codebox"><pre class="vscroll"><code>[80149.889741] dmar: DRHD: handling fault status reg 2 [80149.894627] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr ffe0e000 DMAR:[fault reason 06] PTE Read access is not set [80149.908554] dmar: DRHD: handling fault status reg 102 [80149.913614] dmar: DMAR:[DMA Write] Request device [84:00.0] fault addr ffff9000 DMAR:[fault reason 05] PTE Write access is not set [80150.052146] usb 3-1: reset low-speed USB device number 2 using xhci_hcd [80150.340244] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8810266a4600 [80150.340251] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8810266a4540 [80150.340259] usb 3-1: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes [80150.340265] usb 3-1: ep 0x82 - rounding interval to 64 microframes, ep desc says 80 microframes [80150.485412] dmar: DRHD: handling fault status reg 202 [80150.490475] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr fff24000 DMAR:[fault reason 06] PTE Read access is not set [80150.622368] usb 3-1: reset low-speed USB device number 2 using xhci_hcd [80150.910482] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8810266a4600 [80150.910489] xhci_hcd 0000:08:00.0: xHCI xhci_drop_endpoint called with disabled ep ffff8810266a4540 [80150.910497] usb 3-1: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes [80150.910502] usb 3-1: ep 0x82 - rounding interval to 64 microframes, ep desc says 80 microframes [80150.966996] dmar: DRHD: handling fault status reg 302 [80150.972052] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr ffeca000 DMAR:[fault reason 06] PTE Read access is not set [80151.560200] dmar: DRHD: handling fault status reg 402 [80151.565259] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr fffca000 DMAR:[fault reason 06] PTE Read access is not set [80155.227534] dmar: DRHD: handling fault status reg 502 [80155.232595] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr fffad000 DMAR:[fault reason 06] PTE Read access is not set [80155.246330] dmar: DRHD: handling fault status reg 602 [80155.251410] dmar: DMAR:[DMA Read] Request device [84:00.0] fault addr fff02000 DMAR:[fault reason 06] PTE Read access is not set [80170.201208] dmar: DRHD: handling fault status reg 702 [80170.206278] dmar: DMAR:[DMA Write] Request device [84:00.0] fault addr ffff9000 DMAR:[fault reason 05] PTE Write access is not set [80180.114179] nvme 0000:84:00.0: Aborting I/O 0 QID 1 [80180.114186] nvme 0000:84:00.0: Aborting I/O 1 QID 1 [80180.114194] nvme 0000:84:00.0: Aborting I/O 0 QID 16 [80180.114197] nvme 0000:84:00.0: Aborting I/O 1 QID 16 [80180.114279] dmar: DRHD: handling fault status reg 2 [80180.119169] dmar: DMAR:[DMA Write] Request device [84:00.0] fault addr fffff000 DMAR:[fault reason 05] PTE Write access is not set</code></pre></div><p>FWIW my current kernel does not any of your newer patches beyond 3.18.12</p> <p class="postedit"><em>Last edited by Bronek (2015-04-28 19:24:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524076">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524079" class="blockpost roweven"> <h2><span><span class="conr">#4941</span> <a href="viewtopic.php?pid=1524079#p1524079">2015-04-28 19:42:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><p>Are you using the ACS override patch?&#160; What&#039;s the topology (lspci -tv)?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524079">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524149" class="blockpost rowodd"> <h2><span><span class="conr">#4942</span> <a href="viewtopic.php?pid=1524149#p1524149">2015-04-28 23:33:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90690">Linuxlookup</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-27</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="website"><a href="http://www.linuxlookup.com" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Linuxlookup wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Has anybody actually had success following the Ubuntu guide?&#160; Seems like a flood of people following whatever misinformation it contains and landing here.</p></div></blockquote></div><p>I&#039;ve had success with Ubuntu. Though I did not follow any guide, my configurations are based on documentation and general experiences from users in various forums. I&#039;m planning to evaluate other hardware configurations and document my method in a HowTo article once satisfied with the results. For those interested in seeing Ubuntu in action, recently I published a video which demonstrates <a href="http://www.linuxlookup.com/windows_gaming_qemukvm_ubuntu_linux_amd_radeon_r9_280" rel="nofollow">Windows Gaming with QEMU/KVM on Ubuntu Linux</a>.</p></div></blockquote></div><p>R9 280 also has reset problems?&#160; That ought to be Tahiti based.&#160; Have you tried updating the Bonaire/Hawaii patch as Bronek did to add your ID?&#160; <a href="https://lists.gnu.org/archive/html/qemu-devel/2015-04/msg03128.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 03128.html</a></p></div></blockquote></div><p>Yes, I too have experienced a reset issue with AMD R9 280. Few months back I saw your Qemu-devel post from 12/02/14 and experimented with information provided. Unsuccessful, I haven&#039;t pursued any further solution myself.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://www.linuxlookup.com" rel="nofollow">http://www.linuxlookup.com</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524149">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524281" class="blockpost roweven"> <h2><span><span class="conr">#4943</span> <a href="viewtopic.php?pid=1524281#p1524281">2015-04-29 12:26:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90273">ughman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:chekwob@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have tried several more things trying to fix this freezing/bsod issue. Somewhere along the line it seems it&#039;s changed so that I no longer get freezes, just BSOD. At one point I did get a host freeze, unsure if this was caused by the VM or not.</p><ul><li><p>Made a new clean UEFI install of Windows 7, GPT on LVM on LUKS on mdadm raid1. BSOD now reboots the VM, likely the default behavior for windows. Event viewer says code is 0x116.</p></li><li><p>Changed to kvm-pci-assign. Issue still persisted, changed back to vfio-pci after.</p></li><li><p>Changed some settings to match closer to Duelist&#039;s posted configuration.</p><div class="codebox"><pre><code>root=UUID=4f2e65ef-ef21-4628-bbd7-219d7855732b rw quiet cryptdevice=UUID=17b9c41f-ab59-4a68-a5ec-b7b3e2776bf6:calue pci-stub.ids=1002:67b1,1002:aac8 iommu=pt acpi_enforce_resources=lax</code></pre></div><div class="codebox"><pre><code>options vfio_iommu_type1 disable_hugepages=1 options kvm-amd npt=1 nested=0</code></pre></div><div class="codebox"><pre class="vscroll"><code>#!/bin/sh export QEMU_AUDIO_DRV=sdl export QEMU_AUDIO_DAC_FIXED_SETTINGS=1 export QEMU_AUDIO_DAC_FIXED_FREQ=44100 export QEMU_AUDIO_DAC_FIXED_FMT=S16 export QEMU_SDL_SAMPLES=1024 qemu-system-x86_64 \ -machine accel=kvm \ -machine pc-i440fx-2.1,accel=kvm,usb=off \ -cpu Opteron_G5,+bmi1,+perfctr_nb,+perfctr_core,+topoext,+nodeid_msr,+tce,+lwp,+wdt,+skinit,+ibs,+osvw,+cr8legacy,+extapic,+cmp_legacy,+fxsr_opt,+mmxext,+osxsave,+monitor,+ht,+vme \ -drive file=OVMF-newinstall.fd,format=raw,if=pflash \ -drive file=/dev/mapper/urw-win,format=raw,if=ide \ -m 4096 \ -realtime mlock=on \ -smp 3 \ -no-user-config \ -nodefaults \ -rtc base=localtime,driftfix=slew \ -global kvm-pit.lost_tick_policy=discard \ -no-hpet \ -global PIIX4_PM.disable_s3=1 \ -global PIIX4_PM.disable_s4=1 \ -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 \ -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 \ -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 \ -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 \ -device usb-host,id=usbkbdms,bus=usb.0,vendorid=0x13ba,productid=0x0018 \ -netdev user,id=net \ -device rtl8139,netdev=net,bus=pci.0,addr=0x6 \ -device vfio-pci,host=01:00.0,bus=pci.0,addr=0x8 \ -device vfio-pci,host=01:00.1,bus=pci.0,addr=0x9 \ -vga none \ -soundhw hda \ $*</code></pre></div><p>(I did manage to mostly fix my audio issues by using sdl instead of alsa, and changing asound.conf to use 44100 Hz for dmix.)<br />Issue still persists.</p></li><li><p>Removed Radeon 9250 PCI card from motherboard, wasn&#039;t using it anyway. Didn&#039;t fix.</p></li><li><p>Removed &quot;blacklist radeon&quot; from modprobe.d. Guest card already stubbed through pci-stub.</p></li><li><p>Ran windows update on guest. Didn&#039;t fix issue.</p></li><li><p>Started running VM from remote system over SSH with -nographic. Didn&#039;t fix issue.</p></li><li><p>Removed host&#039;s card (GeForce 9800 GT), no longer running X on host, running VM over ssh. Didn&#039;t fix issue.</p></li></ul><p>I am going now to move the guest-assigned card to another PCI-e x16 slot and attempt again, not expecting any success. I have a powered x1 to x16 riser which I had been running this card on previously on an older motherboard, I may try that later, not expecting any success.</p><p>I don&#039;t really understand why this is an issue. I can even shutdown the guest, unbind the card from vfio and bind it to radeon, then log in and launch X on the host and use it without an issue. I&#039;m thinking this could be a bug in the guest radeon drivers. Perhaps I might try some older versions of the driver. I&#039;m running out of things left to test. I could run linux within the VM and attempt to get anything on the guest&#039;s dmesg output, but I don&#039;t know.</p><p>It&#039;s really frustrating being this close to success and not being able to do anything about it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524301" class="blockpost rowodd"> <h2><span><span class="conr">#4944</span> <a href="viewtopic.php?pid=1524301#p1524301">2015-04-29 13:45:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90340">paperinick</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-14</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90340">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You have a Quadro 2000, just assigned it as a secondary device and be done with it.&#160; <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-device-GPU.html" rel="nofollow">https://access.redhat.com/documentation … e-GPU.html</a></p><p>If it doesn&#039;t work, update kernel and/or QEMU.&#160; Note that only K-series Quadros are actually supported, but Fermi are likely to work.&#160; Quadro cards do not work well when configured as the primary display for a VM.</p></div></blockquote></div><p>I am trying to build a machine where the host is a server so basically no UI except SSH. Anyway, I was pointing to the fact that there is a bug somewhere that is causing the host to crash/freeze. Given the advanced experimentation going on, not really surprised, just wondering on what is the best action, if there is a bug tracker, etc.</p><p>I am planning to get a UEFI bios for my card, PNY technical support claims that they have a version of the BIOS with UEFI support, so trying that route. Thank you very much, I am impressed by how much of this stuff works anyway!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524301">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524345" class="blockpost roweven"> <h2><span><span class="conr">#4945</span> <a href="viewtopic.php?pid=1524345#p1524345">2015-04-29 15:21:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paperinick wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You have a Quadro 2000, just assigned it as a secondary device and be done with it.&#160; <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-device-GPU.html" rel="nofollow">https://access.redhat.com/documentation … e-GPU.html</a></p><p>If it doesn&#039;t work, update kernel and/or QEMU.&#160; Note that only K-series Quadros are actually supported, but Fermi are likely to work.&#160; Quadro cards do not work well when configured as the primary display for a VM.</p></div></blockquote></div><p>I am trying to build a machine where the host is a server so basically no UI except SSH. Anyway, I was pointing to the fact that there is a bug somewhere that is causing the host to crash/freeze. Given the advanced experimentation going on, not really surprised, just wondering on what is the best action, if there is a bug tracker, etc.</p></div></blockquote></div><p>Your kernel is too old to be interesting for upstream bugs.&#160; You can see if the problem still occurs on current upstream or file a bug with your distro.</p><div class="quotebox"><blockquote><div><p>I am planning to get a UEFI bios for my card, PNY technical support claims that they have a version of the BIOS with UEFI support, so trying that route. Thank you very much, I am impressed by how much of this stuff works anyway!!</p></div></blockquote></div><p>That doesn&#039;t solve the problem that Quadro cards don&#039;t generally behave as VM primary displays, if you use the secondary display approach, it doesn&#039;t matter whether you have a legacy or UEFI BIOS for the card.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524345">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524388" class="blockpost rowodd"> <h2><span><span class="conr">#4946</span> <a href="viewtopic.php?pid=1524388#p1524388">2015-04-29 17:30:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90340">paperinick</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-14</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90340">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>That doesn&#039;t solve the problem that Quadro cards don&#039;t generally behave as VM primary displays</p></div></blockquote></div><p>Where can I find more info about this? If it boots, runs and handle Premier 6 CUDA acceleration, I am happy. Investigating about the last part, but I am interested all there is to know about this. Thanks a lot!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524388">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524410" class="blockpost roweven"> <h2><span><span class="conr">#4947</span> <a href="viewtopic.php?pid=1524410#p1524410">2015-04-29 18:14:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paperinick wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>That doesn&#039;t solve the problem that Quadro cards don&#039;t generally behave as VM primary displays</p></div></blockquote></div><p>Where can I find more info about this? If it boots, runs and handle Premier 6 CUDA acceleration, I am happy. Investigating about the last part, but I am interested all there is to know about this. Thanks a lot!</p></div></blockquote></div><p>Try it, you&#039;ll see.&#160; Given that you have the hardware to run in a mode that Nvidia actually claims to support, I&#039;m not sure why you wouldn&#039;t want to run in that mode.&#160; Some people just like to make things more difficult...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524410">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524411" class="blockpost rowodd"> <h2><span><span class="conr">#4948</span> <a href="viewtopic.php?pid=1524411#p1524411">2015-04-29 18:22:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Bronek</p><p>Are you using the ACS override patch?&#160; What&#039;s the topology (lspci -tv)?</p></div></blockquote></div><p>No ACS override patch here, only patch on top of 3.18.12 I have at this moment is from &quot;git diff c143c2333c4..3ccb354d641&quot; (VFS change in kernel mainline), which is a workaround for ZFS issue <a href="https://github.com/zfsonlinux/zfs/issues/3030" rel="nofollow">https://github.com/zfsonlinux/zfs/issues/3030</a></p><p>Here is topology (with list of vfio devices):</p><div class="codebox"><pre class="vscroll"><code>root@gdansk ~ # cat /proc/cmdline BOOT_IMAGE=../vmlinuz-linux zfs=zroot rw spl.spl_hostid=0xa8c08502 console=ttyS0,115200N8R nomodeset udev.children-max=32 edac_core.edac_mc_panic_on_ue=1 intel_iommu=on pci-stub.ids=8086:1d2d,8086:1d20,8086:1d26,1912:0014,1002:692b,1002:aad8,1002:6707,1002:aa80 isolcpus=2,3,4,5,6,7,8,9,10,11,14,15,16,17,18,19,20,21,22,23 initrd=../initramfs-linux.img root@gdansk ~ # lspci -nnvt -+-[0000:ff]-+-08.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Link 0 [8086:0e80] | +-09.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Link 1 [8086:0e90] | +-0a.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 0 [8086:0ec0] | +-0a.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 1 [8086:0ec1] | +-0a.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 2 [8086:0ec2] | +-0a.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 3 [8086:0ec3] | +-0b.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 UBOX Registers [8086:0e1e] | +-0b.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 UBOX Registers [8086:0e1f] | +-0c.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee0] | +-0c.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee2] | +-0c.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee4] | +-0d.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee1] | +-0d.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee3] | +-0d.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee5] | +-0e.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Home Agent 0 [8086:0ea0] | +-0e.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Home Agent 0 [8086:0e30] | +-0f.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Target Address/Thermal Registers [8086:0ea8] | +-0f.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 RAS Registers [8086:0e71] | +-0f.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eaa] | +-0f.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eab] | +-0f.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eac] | +-0f.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0ead] | +-10.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 0 [8086:0eb0] | +-10.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 1 [8086:0eb1] | +-10.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 0 [8086:0eb2] | +-10.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 1 [8086:0eb3] | +-10.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 2 [8086:0eb4] | +-10.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 3 [8086:0eb5] | +-10.6 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 2 [8086:0eb6] | +-10.7 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 3 [8086:0eb7] | +-13.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 R2PCIe [8086:0e1d] | +-13.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 R2PCIe [8086:0e34] | +-13.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Ring Registers [8086:0e81] | +-13.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Ring Performance Ring Monitoring [8086:0e36] | +-16.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 System Address Decoder [8086:0ec8] | +-16.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Broadcast Registers [8086:0ec9] | \-16.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Broadcast Registers [8086:0eca] +-[0000:80]-+-01.0-[81]----00.0 Renesas Technology Corp. uPD720201 USB 3.0 Host Controller [1912:0014] | +-02.0-[82]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Tonga PRO GL [FirePro W7100] [1002:692b] | | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:aad8] | +-03.0-[83]----00.0 LSI Logic / Symbios Logic MegaRAID SAS 2208 [Thunderbolt] [1000:005b] | +-03.2-[84]----00.0 Intel Corporation PCIe Data Center SSD [8086:0953] | +-04.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 0 [8086:0e20] | +-04.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 1 [8086:0e21] | +-04.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 2 [8086:0e22] | +-04.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 3 [8086:0e23] | +-04.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 4 [8086:0e24] | +-04.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 5 [8086:0e25] | +-04.6 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 6 [8086:0e26] | +-04.7 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 7 [8086:0e27] | +-05.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 VTd/Memory Map/Misc [8086:0e28] | +-05.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IIO RAS [8086:0e2a] | \-05.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IOAPIC [8086:0e2c] +-[0000:7f]-+-08.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Link 0 [8086:0e80] | +-09.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Link 1 [8086:0e90] | +-0a.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 0 [8086:0ec0] | +-0a.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 1 [8086:0ec1] | +-0a.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 2 [8086:0ec2] | +-0a.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Power Control Unit 3 [8086:0ec3] | +-0b.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 UBOX Registers [8086:0e1e] | +-0b.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 UBOX Registers [8086:0e1f] | +-0c.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee0] | +-0c.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee2] | +-0c.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee4] | +-0d.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee1] | +-0d.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee3] | +-0d.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Unicast Registers [8086:0ee5] | +-0e.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Home Agent 0 [8086:0ea0] | +-0e.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Home Agent 0 [8086:0e30] | +-0f.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Target Address/Thermal Registers [8086:0ea8] | +-0f.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 RAS Registers [8086:0e71] | +-0f.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eaa] | +-0f.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eab] | +-0f.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0eac] | +-0f.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 0 Channel Target Address Decoder Registers [8086:0ead] | +-10.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 0 [8086:0eb0] | +-10.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 1 [8086:0eb1] | +-10.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 0 [8086:0eb2] | +-10.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 1 [8086:0eb3] | +-10.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 2 [8086:0eb4] | +-10.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 Thermal Control 3 [8086:0eb5] | +-10.6 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 2 [8086:0eb6] | +-10.7 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Integrated Memory Controller 1 Channel 0-3 ERROR Registers 3 [8086:0eb7] | +-13.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 R2PCIe [8086:0e1d] | +-13.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 R2PCIe [8086:0e34] | +-13.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Ring Registers [8086:0e81] | +-13.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 QPI Ring Performance Ring Monitoring [8086:0e36] | +-16.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 System Address Decoder [8086:0ec8] | +-16.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Broadcast Registers [8086:0ec9] | \-16.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Broadcast Registers [8086:0eca] \-[0000:00]-+-00.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 DMI2 [8086:0e00] +-01.0-[01]----00.0 LSI Logic / Symbios Logic SAS2308 PCI-Express Fusion-MPT SAS-2 [1000:0086] +-02.0-[02]----00.0 Renesas Technology Corp. uPD720201 USB 3.0 Host Controller [1912:0014] +-03.0-[03]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Cayman LE GL [FirePro V5900] [1002:6707] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Cayman/Antilles HDMI Audio [Radeon HD 6900 Series] [1002:aa80] +-04.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 0 [8086:0e20] +-04.1 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 1 [8086:0e21] +-04.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 2 [8086:0e22] +-04.3 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 3 [8086:0e23] +-04.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 4 [8086:0e24] +-04.5 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 5 [8086:0e25] +-04.6 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 6 [8086:0e26] +-04.7 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 Crystal Beach DMA Channel 7 [8086:0e27] +-05.0 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 VTd/Memory Map/Misc [8086:0e28] +-05.2 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IIO RAS [8086:0e2a] +-05.4 Intel Corporation Xeon E7 v2/Xeon E5 v2/Core i7 IOAPIC [8086:0e2c] +-11.0-[04]----00.0 Intel Corporation C602 chipset 4-Port SATA Storage Control Unit [8086:1d6b] +-16.0 Intel Corporation C600/X79 series chipset MEI Controller #1 [8086:1d3a] +-16.1 Intel Corporation C600/X79 series chipset MEI Controller #2 [8086:1d3b] +-1a.0 Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #2 [8086:1d2d] +-1b.0 Intel Corporation C600/X79 series chipset High Definition Audio Controller [8086:1d20] +-1c.0-[05-06]--+-00.0 Intel Corporation I350 Gigabit Network Connection [8086:1521] | \-00.1 Intel Corporation I350 Gigabit Network Connection [8086:1521] +-1c.5-[07]----00.0 NEC Corporation uPD720200 USB 3.0 Host Controller [1033:0194] +-1c.6-[08]----00.0 NEC Corporation uPD720200 USB 3.0 Host Controller [1033:0194] +-1d.0 Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #1 [8086:1d26] +-1e.0-[09]-- +-1f.0 Intel Corporation C600/X79 series chipset LPC Controller [8086:1d41] +-1f.2 Intel Corporation C600/X79 series chipset 6-Port SATA AHCI Controller [8086:1d02] +-1f.3 Intel Corporation C600/X79 series chipset SMBus Host Controller [8086:1d22] \-1f.6 Intel Corporation C600/X79 series chipset Thermal Management Controller [8086:1d24]</code></pre></div><p>I think I had these occasional problems with 84:00 before, but I do not remember whether these happened when I was using other graphic card (I also have FirePro V4900) or not.</p> <p class="postedit"><em>Last edited by Bronek (2015-04-29 18:24:03)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524543" class="blockpost roweven"> <h2><span><span class="conr">#4949</span> <a href="viewtopic.php?pid=1524543#p1524543">2015-04-30 01:21:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90758">Zerqz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-30</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90758">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey everyone! I have been trying to set this up on my system for hours now and have came to a standstill, lol.</p><p>After I add the kernel parameter </p><div class="codebox"><pre><code>&quot;pci-stub.ids=10de:13c0,10de:0fbb&quot; </code></pre></div><p>my system fails to get passed the &quot;Reached target Graphical Interface&quot; tab while booting. If I remove that parameter it boots fine.<br />Also when running, </p><div class="codebox"><pre><code>&quot;qemu-system-x86_64 -enable-kvm -m 8000 -cpu host,kvm=off -vga none -device vfio-pci,host=07:00.0 -smp 4,sockets=1,cores=4,threads=2 -hda /games/win.cow&quot;</code></pre></div><p>I get the error</p><div class="codebox"><pre><code>&quot;qemu-system-x86_64: -device vfio-pci,host=07:00.0: vfio: error opening /dev/vfio/23: No such file or directory qemu-system-x86_64: -device vfio-pci,host=07:00.0: vfio: failed to get group 23 qemu-system-x86_64: -device vfio-pci,host=07:00.0: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=07:00.0: Device &#039;vfio-pci&#039; could not be initialized&quot;</code></pre></div><p>I realize that the error for qemu is probably from the system not booting with the pci-stub kernel parameter, but I can&#039;t boot while its on.</p> <p class="postedit"><em>Last edited by Zerqz (2015-04-30 01:21:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524543">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1524546" class="blockpost rowodd"> <h2><span><span class="conr">#4950</span> <a href="viewtopic.php?pid=1524546#p1524546">2015-04-30 01:37:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Zerqz wrote:</cite><blockquote><div><p>Hey everyone! I have been trying to set this up on my system for hours now and have came to a standstill, lol.</p><p>After I add the kernel parameter </p><div class="codebox"><pre><code>&quot;pci-stub.ids=10de:13c0,10de:0fbb&quot; </code></pre></div><p>my system fails to get passed the &quot;Reached target Graphical Interface&quot; tab while booting. If I remove that parameter it boots fine.</p></div></blockquote></div><p>Do you have.. a second GPU that should be left for host?<br />What distrib, kernel and hardware are you using? You sure that IOMMU is on?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1524546">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=197">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <a href="viewtopic.php?id=162768&amp;p=197">197</a> <strong>198</strong> <a href="viewtopic.php?id=162768&amp;p=199">199</a> <a href="viewtopic.php?id=162768&amp;p=200">200</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=199">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
