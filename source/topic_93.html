<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 93) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=93" title="Page 93" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=92" title="Page 92" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=94" title="Page 94" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=92">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=91">91</a> <a href="viewtopic.php?id=162768&amp;p=92">92</a> <strong>93</strong> <a href="viewtopic.php?id=162768&amp;p=94">94</a> <a href="viewtopic.php?id=162768&amp;p=95">95</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=94">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1434835" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2301</span> <a href="viewtopic.php?pid=1434835#p1434835">2014-07-11 08:16:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>so... what does -smp intends to do ?</p><p>And, how I could block internet connection for one guest and let the other enjoy the internet ?</p></div></blockquote></div><p>-smp is number of processor sockets</p><p>iptables drop rule?</p><p>smth like </p><p>iptables -A FORWARD -s client ip -d 0.0.0.0/0 -j DROP<br />iptables -A FORWARD -s client ip -d LANsubnet -j ACCEPT</p><p>maybe... depending on your network configuration....</p> <p class="postedit"><em>Last edited by slis (2014-07-11 08:16:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1434835">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1434836" class="blockpost roweven"> <h2><span><span class="conr">#2302</span> <a href="viewtopic.php?pid=1434836#p1434836">2014-07-11 08:21:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone been able to get the HDMI audio working?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1434836">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1434838" class="blockpost rowodd"> <h2><span><span class="conr">#2303</span> <a href="viewtopic.php?pid=1434838#p1434838">2014-07-11 08:25:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MCMjolnir wrote:</cite><blockquote><div><p>Has anyone been able to get the HDMI audio working?</p></div></blockquote></div><p>what do you mean? on nvidia it works i think... but i have some latency issues maybe cause of pcie3.0 and sandy bridge... still waiting for ivy to arrive...<br />on 560ti pcie2.0 card it works flawless...</p> <p class="postedit"><em>Last edited by slis (2014-07-11 08:26:02)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1434838">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1434956" class="blockpost roweven"> <h2><span><span class="conr">#2304</span> <a href="viewtopic.php?pid=1434956#p1434956">2014-07-11 16:15:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82784">penetal</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-15</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82784">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am trying to create an audio infterface on the VM, but I end up with the scratchy / crackling sound problem that some others have come across in this thread.</p><p>I tried to set the sample rate and driver for QEMU, but that resulted in the problem becomming 100 times worse so I commented it out.<br />Startup Script:</p><div class="codebox"><pre><code>#!/bin/sh vfio-bind 0000:01:00.0 0000:01:00.1 #export QEMU_PA_SAMPLES=128 #export QEMU_AUDIO_DRV=pa qemu-system-x86_64 -enable-kvm -M q35 -m 10240 -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -drive file=/home/USER/vm/GamingWindows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -vga none \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:046d:c52b \ -monitor stdio</code></pre></div><p>I also disabled nested tables in kvm_intel:</p><div class="codebox"><pre class="vscroll"><code>% systool -vm kvm_intel Module = &quot;kvm_intel&quot; Attributes: coresize = &quot;135528&quot; initsize = &quot;0&quot; initstate = &quot;live&quot; refcnt = &quot;0&quot; taint = &quot;&quot; uevent = &lt;store method only&gt; Parameters: emulate_invalid_guest_state= &quot;Y&quot; enable_apicv = &quot;N&quot; enable_shadow_vmcs = &quot;Y&quot; ept = &quot;Y&quot; eptad = &quot;Y&quot; fasteoi = &quot;Y&quot; flexpriority = &quot;Y&quot; nested = &quot;N&quot; ple_gap = &quot;128&quot; ple_window = &quot;4096&quot; unrestricted_guest = &quot;Y&quot; vmm_exclusive = &quot;Y&quot; vpid = &quot;Y&quot; Sections: .bss = &quot;0xffffffffa00a7140&quot; .data = &quot;0xffffffffa00a6800&quot; .data..read_mostly = &quot;0xffffffffa00a6e68&quot; .data.unlikely = &quot;0xffffffffa00a6ea0&quot; .exit.text = &quot;0xffffffffa00971d2&quot; .fixup = &quot;0xffffffffa0095bdc&quot; .gnu.linkonce.this_module= &quot;0xffffffffa00a6ec0&quot; .init.text = &quot;0xffffffffa00ad000&quot; .note.gnu.build-id = &quot;0xffffffffa0097268&quot; .parainstructions = &quot;0xffffffffa00a5800&quot; .rodata = &quot;0xffffffffa00972c0&quot; .rodata.str1.1 = &quot;0xffffffffa00a5bf0&quot; .rodata.str1.8 = &quot;0xffffffffa00a5cc8&quot; .smp_locks = &quot;0xffffffffa00a5b8c&quot; .strtab = &quot;0xffffffffa00b0b30&quot; .symtab = &quot;0xffffffffa00add10&quot; .text = &quot;0xffffffffa008a000&quot; .text.unlikely = &quot;0xffffffffa00959d0&quot; __bug_table = &quot;0xffffffffa00a6089&quot; __ex_table = &quot;0xffffffffa00a5160&quot; __jump_table = &quot;0xffffffffa00a6cd0&quot; __mcount_loc = &quot;0xffffffffa00a6248&quot; __param = &quot;0xffffffffa00a60a8&quot; __verbose = &quot;0xffffffffa00a6e78&quot;</code></pre></div><p>Has anyone been able to solve this problem when those two things didn&#039;t help?</p><p>Edit:<br />I&#039;m becomming unsure if the nested option is refering to the page tables or something else.</p> <p class="postedit"><em>Last edited by penetal (2014-07-11 17:28:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1434956">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435218" class="blockpost rowodd"> <h2><span><span class="conr">#2305</span> <a href="viewtopic.php?pid=1435218#p1435218">2014-07-12 07:50:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76145">Midov</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-22</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:midov@midov.pl">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone tried to get snapshots working?<br />It seems that when i use -M -q35 snapshoting results in an -22 error.<br />I do have qcow2 disk</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435218">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435398" class="blockpost roweven"> <h2><span><span class="conr">#2306</span> <a href="viewtopic.php?pid=1435398#p1435398">2014-07-12 19:58:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83289">rafalcieslak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-04</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I am into the fourth week of experimenting with passing through a GTX770 (well, apparently a number of others were successful with it!).<br />The card appars in the device manager of a windows7, where it is recognized as a &quot;Standard VGA Graphics Adapter&quot;. Seems like it got passed through well.<br />However, it&#039;s status is:</p><div class="codebox"><pre><code>This device cannot start. (Code 10)</code></pre></div><p>Any nvidia driver fails to install, claiming it &quot;failed to find supported hardware&quot;.<br />This is the closest I got to&#160; a working setup. Has anyone seen that code 10 error? Google searching has not provided me with anything useful about this problem.&#160; What could I make out of it? What should I investigate?</p> <p class="postedit"><em>Last edited by rafalcieslak (2014-07-12 20:01:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435398">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435494" class="blockpost rowodd"> <h2><span><span class="conr">#2307</span> <a href="viewtopic.php?pid=1435494#p1435494">2014-07-13 08:56:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rafalcieslak wrote:</cite><blockquote><div><p>So I am into the fourth week of experimenting with passing through a GTX770 (well, apparently a number of others were successful with it!).<br />The card appars in the device manager of a windows7, where it is recognized as a &quot;Standard VGA Graphics Adapter&quot;. Seems like it got passed through well.<br />However, it&#039;s status is:</p><div class="codebox"><pre><code>This device cannot start. (Code 10)</code></pre></div><p>Any nvidia driver fails to install, claiming it &quot;failed to find supported hardware&quot;.<br />This is the closest I got to&#160; a working setup. Has anyone seen that code 10 error? Google searching has not provided me with anything useful about this problem.&#160; What could I make out of it? What should I investigate?</p></div></blockquote></div><p>post your configs and hardware specs?</p><p>error code 10 looks like its not passed correctly...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435494">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435523" class="blockpost roweven"> <h2><span><span class="conr">#2308</span> <a href="viewtopic.php?pid=1435523#p1435523">2014-07-13 10:53:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83289">rafalcieslak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-04</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>post your configs and hardware specs?</p><p>error code 10 looks like its not passed correctly...</p></div></blockquote></div><p>Okay, there it goes.</p><p>The hardware:</p><div class="codebox"><pre><code>Intel 4790K (with an integrated intel HD graphics 4600) NVIDIA GTX 770 (Gigabyte) ASRock Z97 Extreme6</code></pre></div><p>I use stock kernel 3.15.3 configured with:</p><div class="codebox"><pre><code>$ cat .config | grep -i vfi CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y</code></pre></div><p>and patched with vga arbiter fixes (inclucing these for i915) and acs overrides.</p><p>Therefore, my /etc/modules contains:</p><div class="codebox"><pre><code>vfio vfio_iommu_type1 vfio-pci</code></pre></div><p>The setup I use is meant to get the host system to use the the intel GPU, and I am passing the nvidia gtx 770 to the guest.<br />BIOS is set to use intel GPU as the primary graphics adapter (to ensure it won&#039;t initialize the gtx 770).</p><p>My kenel boot commandline:</p><div class="codebox"><pre><code>linux /vmlinuz-3.15.3 root=UUID=3b7c22f4-85dc-480c-90e7-58e743c1b5d8 ro nvidia.blacklist=yes nvidia-current.blacklist=yes nvidia_337.blacklist=yes nvidiafb.blacklist=yes i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:1184,10de:0e0a quiet</code></pre></div><p>(I might skip some of these blacklists, these are just to force the host to leave the gtx770 untoched).<br />I also use </p><div class="codebox"><pre><code>options kvm allow_unsafe_assigned_interrupts=1</code></pre></div><p>Host: </p><div class="codebox"><pre><code>$ lspci | grep VGA 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller (rev 06) 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1) $ lspci | grep NVIDIA 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) $ lspci -n | grep 01:00 01:00.0 0300: 10de:1184 (rev a1) 01:00.1 0403: 10de:0e0a (rev a1)</code></pre></div><p>I am working with qemu pulled from git.<br />Before I run qemu, I do:</p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><p>I start qemu with:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \ -smp cores=4 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -monitor stdio \ -vga cirrus \ -boot menu=on \ -drive file=/dev/sdb3,format=raw,media=disk,id=disk1 \ -drive file=/dev/mapper/main-win,format=raw,media=disk,id=disk2 \ -device ide-hd,bus=ide.0,drive=disk1 \ -device ide-hd,bus=ide.1,drive=disk2</code></pre></div><p>It seems to work, so the host indeed never uses the nvidia GPU, there are no problems mentioned in dmesg, vfio binding is successful, and qemu never complains about a thing.<br />A linux distro installed as a guest apparently detects the GPU, running lspci I get, among other entries:</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1)</code></pre></div><p>which is probably cool.</p><p>I will repeat here (for reference and completeness) that a windows7 installed there will detect the passed through device as a &quot;Standard VGA Graphics Adapter&quot; in its Device Manager, but the status of this devices is </p><div class="codebox"><pre><code>This device cannot start. (Code 10)</code></pre></div><p>and the nvidia drivers fail to install, as it &quot;cannot find supported hardware&quot;.</p><p><strong>Other configurations I have tried that did not help in any combination</strong><br />kvm=off does not change anything.<br />Using a romfile for my graphics card (as apparently many others do).<br />vga -none&#160; is probably quite pointless before I get the drivers to install, there is never any output from the passed GPU.</p><br /><p>I am looking both for ideas on what might be wron in my setup, as well as hints on how should I troubleshoot it to investigate the problem further.<br />Cheers!</p> <p class="postedit"><em>Last edited by rafalcieslak (2014-07-13 10:56:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435523">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435552" class="blockpost rowodd"> <h2><span><span class="conr">#2309</span> <a href="viewtopic.php?pid=1435552#p1435552">2014-07-13 12:20:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>-monitor stdio \<br /> -vga cirrus \<br /> -boot menu=on \</p></div></blockquote></div><p>u cant pass it with video cirrus .... u must disable that with -vga none or smth like that... that is error code 10. i think, <br />u must have SEABIOS screen through 770 when it works with -vga none and i915 patches&lt;&lt;&lt;</p><p>hints:<br />(aka 770 must be PRIMARY card not secondary with cirrus, it can be secondary if u mod it to quadro/grid) </p><p>geforce 6xx+ doesn&#039;t need rom file... 5xx or lower needs...</p><p>your geforce must work regradless of driver installed.... you must have seabios screen on gtx770</p><p>try lower driver than 340 aka 331 to be sure driver works with -vga none ofc....</p><p>here is my xml with all options for best perfomance i think... i am only misssing x-data-plane option for hdd i guess libvirt still doesn&#039;t support it...</p><p>this setup works for 2 weeks 0-24, win 8.1 x64, debian 3.15, z77, dual vm, dual 680gtx, used for streaming win games...</p><br /><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;name&gt;GTX680&lt;/name&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;uuid&gt;00000000-0000-0000-0000-000000000001&lt;/uuid&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;6242304&lt;/memory&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;6242304&lt;/currentMemory&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;vcpu placement=&#039;static&#039; cpuset=&#039;0-7&#039;&gt;4&lt;/vcpu&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &lt;os&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.1&#039;&gt;hvm&lt;/type&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &lt;boot dev=&#039;hd&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &lt;bootmenu enable=&#039;no&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;/os&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &lt;features&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &lt;acpi/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &lt;apic/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &lt;hap/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &lt;hyperv&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;on&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &#160; &lt;vapic state=&#039;on&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &#160; &lt;spinlocks state=&#039;on&#039; retries=&#039;4096&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &#160; &lt;/hyperv&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />&#160; &#160; &lt;pvspinlock state=&#039;on&#039;/&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;<br />&#160; &lt;/features&gt;<br />&#160; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt;<br />&#160; &#160; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt;<br />&#160; &#160; &lt;vendor&gt;Intel&lt;/vendor&gt;<br />&#160; &#160; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;rtm&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;invpcid&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;lahf_lm&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;erms&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;bmi2&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;smep&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;avx2&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;hle&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;bmi1&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;fsgsbase&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;movbe&#039;/&gt;<br />&#160; &#160; &lt;feature policy=&#039;force&#039; name=&#039;fma&#039;/&gt;<br />&#160; &lt;/cpu&gt;<br />&#160; &lt;clock offset=&#039;utc&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;destroy&lt;/on_crash&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/local/bin/qemu-system-x86_64&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/root/win1.img&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/root/storage/data1.img&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1e&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;3&#039; model=&#039;pci-bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;interface type=&#039;bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:12:34:01&#039;/&gt;<br />&#160; &#160; &#160; &lt;source bridge=&#039;br0&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;rom bar=&#039;off&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x1532&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x010b&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x1532&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x000a&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&#160; &lt;seclabel type=&#039;none&#039;/&gt;<br />&#160; &lt;qemu:commandline&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.1,bus=root.1,addr=00.1&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-set&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;device.virtio-disk0.scsi=off&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-set&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;device.virtio-disk0.config-wce=off&#039;/&gt;<br />&#160; &#160; &lt;qemu:env name=&#039;DISPLAY&#039; value=&#039;:0&#039;/&gt;<br />&#160; &lt;/qemu:commandline&gt;<br />&lt;/domain&gt;</p></div></blockquote></div> <p class="postedit"><em>Last edited by slis (2014-07-13 12:49:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435552">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435828" class="blockpost roweven"> <h2><span><span class="conr">#2310</span> <a href="viewtopic.php?pid=1435828#p1435828">2014-07-14 09:03:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82341">buraktamturk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-28</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:burak@tamturk.in">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have a problem with opengl driver. I am using intel i915 on host and ati radeon 5400 on guest, i applied &quot;i915_315.patch&quot; and enabled &quot;i915.enable_hd_vgaarb=1&quot; in kernel procline. DRI is working without vgaarb patch, not working with vaarb patch.</p><p>I am pretty sure i was able to play game (Don&#039;t Starve) on host, while guest is running with ati radeon 5400 card. But can&#039;t play now i don&#039;t know what problem is it.</p><p>From Xorg log:</p><div class="codebox"><pre><code>(WW) intel(0): [DRI2] Direct rendering is not supported when VGA arb is necessary for the device</code></pre></div><p>Is there any patch that i miss?</p><p>Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435828">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435845" class="blockpost rowodd"> <h2><span><span class="conr">#2311</span> <a href="viewtopic.php?pid=1435845#p1435845">2014-07-14 10:26:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83289">rafalcieslak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-04</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>slis, huge thanks for your hints! With this help and some slight experiments, I have managed to get my setup working completely. The performance is pretty good, even without tuning.<br />One particular thing I would like to mention for others who might experience similar problems is that it would seem that I have missed </p><div class="codebox"><pre><code>pcie_acs_override=downstream</code></pre></div><p>in my kernel command line. I am not entirely sure why would be necessary in my setup, but it never works without it, so it is apparently crucial.</p><p>Now I am stuck with maintaining my windows installation, as it boots correctly for the first 10-20 times after installing, and then it refuses to cooperate and crashes on boot <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> But that is another story... Passthrough is working well, thanks all for the aboundance of information in this topic!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435845">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435861" class="blockpost roweven"> <h2><span><span class="conr">#2312</span> <a href="viewtopic.php?pid=1435861#p1435861">2014-07-14 11:35:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code>pcie_acs_override=downstream</code></pre></div><p>you need that if u have multiple devices / gpu-s that use same group behind pcie bridge... so u separate them with it....</p> <p class="postedit"><em>Last edited by slis (2014-07-14 11:38:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435861">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435882" class="blockpost rowodd"> <h2><span><span class="conr">#2313</span> <a href="viewtopic.php?pid=1435882#p1435882">2014-07-14 13:01:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82341">buraktamturk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-28</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:burak@tamturk.in">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Since i can&#039;t use DRI with vga arb patch, I attached a nvidia gpu to the host, and installed non-free nvidia drivers from nvidia website. (340.24)</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Device 68f0 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GF114 [GeForce GTX 560] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GF114 HDMI Audio Controller (rev a1)</code></pre></div><p>But when i try to attach ATI to guest. I get</p><div class="codebox"><pre><code>[ 710.872104] vfio-pci 0000:01:00.0: Invalid ROM contents</code></pre></div><p>I have dumped ati card rom, and appened romfile=/home/buraktamturk/rom.rom to qemu command line.</p><div class="codebox"><pre><code> &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/buraktamturk/rom.rom&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt;</code></pre></div><p>Now guest starts with no video. No invalid rom contents error either.</p><p>NOTE: with old configuration, gpu passthrought was working without romfile, and after appending romfile to old working configuration, no video shows up too, it&#039;s was just fine without romfile.</p><p>Any throughts?</p><p>Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435882">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435897" class="blockpost roweven"> <h2><span><span class="conr">#2314</span> <a href="viewtopic.php?pid=1435897#p1435897">2014-07-14 13:47:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>buraktamturk wrote:</cite><blockquote><div><p>Since i can&#039;t use DRI with vga arb patch, I attached a nvidia gpu to the host, and installed non-free nvidia drivers from nvidia website. (340.24)</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Device 68f0 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GF114 [GeForce GTX 560] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GF114 HDMI Audio Controller (rev a1)</code></pre></div><p>But when i try to attach ATI to guest. I get</p><div class="codebox"><pre><code>[ 710.872104] vfio-pci 0000:01:00.0: Invalid ROM contents</code></pre></div><p>I have dumped ati card rom, and appened romfile=/home/buraktamturk/rom.rom to qemu command line.</p><div class="codebox"><pre><code> &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/buraktamturk/rom.rom&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt;</code></pre></div><p>Now guest starts with no video. No invalid rom contents error either.</p><p>NOTE: with old configuration, gpu passthrought was working without romfile, and after appending romfile to old working configuration, no video shows up too, it&#039;s was just fine without romfile.</p><p>Any throughts?</p><p>Thank you.</p></div></blockquote></div><p>Nvidia vga arbiter patch as mentioned in the original post?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435897">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1435900" class="blockpost rowodd"> <h2><span><span class="conr">#2315</span> <a href="viewtopic.php?pid=1435900#p1435900">2014-07-14 13:56:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82341">buraktamturk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-28</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:burak@tamturk.in">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>buraktamturk wrote:</cite><blockquote><div><p>Since i can&#039;t use DRI with vga arb patch, I attached a nvidia gpu to the host, and installed non-free nvidia drivers from nvidia website. (340.24)</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Device 68f0 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GF114 [GeForce GTX 560] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GF114 HDMI Audio Controller (rev a1)</code></pre></div><p>But when i try to attach ATI to guest. I get</p><div class="codebox"><pre><code>[ 710.872104] vfio-pci 0000:01:00.0: Invalid ROM contents</code></pre></div><p>I have dumped ati card rom, and appened romfile=/home/buraktamturk/rom.rom to qemu command line.</p><div class="codebox"><pre><code> &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/buraktamturk/rom.rom&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt;</code></pre></div><p>Now guest starts with no video. No invalid rom contents error either.</p><p>NOTE: with old configuration, gpu passthrought was working without romfile, and after appending romfile to old working configuration, no video shows up too, it&#039;s was just fine without romfile.</p><p>Any throughts?</p><p>Thank you.</p></div></blockquote></div><p>Nvidia vga arbiter patch as mentioned in the original post?</p></div></blockquote></div><p>Thank you, i didn&#039;t applied such thing.</p><p>How and where i can apply it? Should i apply it to the linux kernel or nvidia driver installer? How i can recompile kernel module to patch it?</p><p>Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1435900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436022" class="blockpost roweven"> <h2><span><span class="conr">#2316</span> <a href="viewtopic.php?pid=1436022#p1436022">2014-07-14 19:05:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82341">buraktamturk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-28</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:burak@tamturk.in">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>buraktamturk wrote:</cite><blockquote><div><p>Since i can&#039;t use DRI with vga arb patch, I attached a nvidia gpu to the host, and installed non-free nvidia drivers from nvidia website. (340.24)</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Device 68f0 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] 02:00.0 VGA compatible controller: NVIDIA Corporation GF114 [GeForce GTX 560] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GF114 HDMI Audio Controller (rev a1)</code></pre></div><p>But when i try to attach ATI to guest. I get</p><div class="codebox"><pre><code>[ 710.872104] vfio-pci 0000:01:00.0: Invalid ROM contents</code></pre></div><p>I have dumped ati card rom, and appened romfile=/home/buraktamturk/rom.rom to qemu command line.</p><div class="codebox"><pre><code> &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/buraktamturk/rom.rom&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt;</code></pre></div><p>Now guest starts with no video. No invalid rom contents error either.</p><p>NOTE: with old configuration, gpu passthrought was working without romfile, and after appending romfile to old working configuration, no video shows up too, it&#039;s was just fine without romfile.</p><p>Any throughts?</p><p>Thank you.</p></div></blockquote></div><p>Nvidia vga arbiter patch as mentioned in the original post?</p></div></blockquote></div><p>Now i applied this patch and i am getting the same error. &quot;Invalid ROM contents&quot; error without romfile, no video with romfile.</p><p>Old configuration was working without &quot;romfile&quot;, when i give &quot;romfile&quot; to old configuration, no video again. I dumped romfile with windows host and GPU-Z program, may be i got wrong dump or the romfile that program generated isn&#039;t compatible with seabios?</p><p>Any throughts?</p><p>EDIT: The ATI card was half-connected to the motherboard, i didn&#039;t think such a situation because lspci showed it up. Now everything is working fine. Thanks!</p> <p class="postedit"><em>Last edited by buraktamturk (2014-07-15 07:54:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436022">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436627" class="blockpost rowodd"> <h2><span><span class="conr">#2317</span> <a href="viewtopic.php?pid=1436627#p1436627">2014-07-16 08:08:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I got it to work, but only if I am using xf86-video-vesa for my host system.<br />Otherwise if I am using nouveau I get a mass of DMAR Read errors.</p><div class="codebox"><pre class="vscroll"><code>DMAR:[fault reason 06] PTE Read access is not set [ 81.044278] dmar: DRHD: handling fault status reg 3 [ 81.044279] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.044921] dmar: DRHD: handling fault status reg 3 [ 81.044923] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.054085] dmar: DRHD: handling fault status reg 3 [ 81.054086] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.055395] dmar: DRHD: handling fault status reg 3 [ 81.055398] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.058005] dmar: DRHD: handling fault status reg 3 [ 81.058007] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.058659] dmar: DRHD: handling fault status reg 3 [ 81.058661] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 81.061882] dmar: DRHD: handling fault status reg 3 [ 81.061883] dmar: DMAR:[DMA Read] Request device [01:00.0] fault addr 0 DMAR:[fault reason 06] PTE Read access is not set [ 118.857410] dmar: DRHD: handling fault status reg 3 [ 118.857425] dmar: DMAR:[DMA Write] Request device [07:00.0] fault addr a7aba000 DMAR:[fault reason 05] PTE Write access is not set [ 118.876399] dmar: DRHD: handling fault status reg 3 [ 118.876405] dmar: DMAR:[DMA Write] Request device [07:00.0] fault addr c9cdc000 DMAR:[fault reason 05] PTE Write access is not set [ 118.876413] dmar: DRHD: handling fault status reg 3 [ 118.876415] dmar: DMAR:[DMA Write] Request device [07:00.0] fault addr b1b5b000 DMAR:[fault reason 05] PTE Write access is not set [ 118.876419] dmar: DRHD: handling fault status reg 3 [ 118.876422] dmar: DMAR:[DMA Write] Request device [07:00.0] fault addr c1c5c000 DMAR:[fault reason 05] PTE Write access is not set [ 158.195280] dmar: DRHD: handling fault status reg 3 [ 158.195288] dmar: DMAR:[DMA Write] Request device [07:00.0] fault addr 1f472000</code></pre></div><div class="codebox"><pre><code>01:00.0 VGA compatible controller: NVIDIA Corporation NV43 [GeForce 6600 GT] (rev a2) Kernel driver in use: nouveau Kernel modules: nouveau 07:00.0 Multimedia controller: Twinhan Technology Co. Ltd Mantis DTV PCI Bridge Controller [Ver 1.0] (rev 01) Subsystem: TERRATEC Electronic GmbH Device 1178 Kernel driver in use: Mantis Kernel modules: mantis</code></pre></div><p>I have seen in this thread on page 63 some discussion about that problem to use intel_iommu=iglx_off but I think I am not able to passthrough VGA controllers with that option.</p><p>Is there a option to exclude devices from iommu since I only want to passthrouch pci 02:00:00?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436677" class="blockpost roweven"> <h2><span><span class="conr">#2318</span> <a href="viewtopic.php?pid=1436677#p1436677">2014-07-16 13:07:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83600">d3lxa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83600">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys, thanks for the great post! I would like to contribute what is working for me (everything for now, that&#039;s awesome). That&#039;s my personal notes:</p><div class="quotebox"><blockquote><div><p>Hardware:<br />&#160; &#160; CPU: Intel i7-4770S<br />&#160; &#160; MB : GA Z87N-WIFI<br />&#160; &#160; GPU: Intel HD 4600 (linux, integrated)<br />&#160; &#160; GPU: Asus HD 6850 (win7, dedicated)<br />&#160; &#160; &#160; &#160; romfile (VERY IMPORTANT): Asus.HD6850.1024.110616.rom<br />&#160; &#160; &#160; &#160; 2011-06-16 22:24:00&#160; &#160; &#160;013.012.000.021.000000&#160; PCI-E&#160; &#160;790 / 1000<br />&#160; &#160; &#160; &#160; ^ <a href="http://www.techpowerup.com/vgabios/index.php?architecture=ATI&amp;manufacturer=Asus&amp;model=HD+6850&amp;interface=PCI-E&amp;memType=&amp;memSize=" rel="nofollow">http://www.techpowerup.com/vgabios/inde … =&amp;memSize=</a><br />&#160; &#160; require (1 for linux, 1 for windows):<br />&#160; &#160; &#160; &#160; 2 monitors + 2 keyboards + 2 mouses<br />&#160; &#160; &#160; &#160; (^ or 1 monitor with two inputs)</p><br /><p>Linux:<br />Debian Testing, linux-image-3.14-1-amd64=3.14.12-1 (compiled myself with CONFIG_VFIO_PCI_VGA=y CONFIG_HZ_1000=y)<br />&#160; &#160; tested too: 3.15.5 (trunk + acs_override)<br />&#160; &#160; bootline: quiet intel_iommu=on<br />&#160; &#160; &#160; &#160; not necessary: vfio_iommu_type1.allow_unsafe_interrupts=1 pcie_acs_override=downstream i915.enable_hd_vgaarb=1 (corresponding patch not applied anyway)<br />&#160; &#160; qemu: qemu-kvm=2.0.0+dfsg-6+b1<br />&#160; &#160; &#160; &#160;or from git ab6d3749c4915cd5692633e321f7745dce06fe77<br />&#160; &#160; xserver-xorg 1:7.7+7<br />&#160; &#160; xserver-xorg-video-intel 2:2.21.15-2+b1<br />&#160; &#160; libegl1-mesa-drivers 10.2.2-1<br />&#160; &#160; firmware-linux 0.43<br />&#160; &#160; firmware-linux-free 3.3</p><p>qemu line:<br />&#160; &#160; QEMU_AUDIO_DRV=alsa QEMU_AUDIO_TIMER_PERIOD=0 ~/qemu-git/x86_64-softmmu/qemu-system-x86_64 \<br />&#160; &#160; &#160; &#160; -enable-kvm -M q35 -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 \<br />&#160; &#160; &#160; &#160; -bios /usr/share/qemu/bios.bin -vga none \<br />&#160; &#160; &#160; &#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; &#160; &#160; &#160; -device piix4-ide,bus=pcie.0,id=piix4-ide \<br />&#160; &#160; &#160; &#160; -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=$HOME/Asus.HD6850.1024.110616.rom \<br />&#160; &#160; &#160; &#160; -device vfio-pci,host=01:00.1,bus=pcie.0 \<br />&#160; &#160; &#160; &#160; -usb -usbdevice host:0603:00f2 -usbdevice host:046d:c01b \<br />&#160; &#160; &#160; &#160; -soundhw ac97 \<br />&#160; &#160; &#160; &#160; -drive file=$HOME/win7_rootfs.img,id=disk,format=raw -device ide-hd,bus=piix4-ide.0,drive=disk \<br />&#160; &#160; ;</p><p>audio<br />&#160; &#160; -soundhw ac97<br />&#160; &#160; &#160; &#160; nearly perfect (some glitches)<br />&#160; &#160; &#160; &#160; driver: <a href="http://www.realtek.com.tw/downloads/downloadsCheck.aspx?Langid=1&amp;PNid=14&amp;PFid=23&amp;Level=4&amp;Conn=3&amp;DownTypeID=3&amp;GetDown=false" rel="nofollow">http://www.realtek.com.tw/downloads/dow … Down=false</a><br />&#160; &#160; -device usb-audio and QEMU_AUDIO_TIMER_PERIOD=10<br />&#160; &#160; &#160; &#160; better but high CPU, may glitch under heavy load (or after closing program)<br />&#160; &#160; -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \<br />&#160; &#160; &#160; &#160; audio glitches (even with timer period to 0)</p><p>cdrom<br />&#160; &#160; for installation (OS or drivers):<br />&#160; &#160; -drive file=$HOME/win7.iso,id=isocd -device ide-cd,bus=piix4-ide.1,drive=isocd \<br />&#160; &#160; can be removed safely after reboot (install)</p><p>disks<br />&#160; &#160; virtio: can be switched to *after* fedora driver install<br />&#160; &#160; <a href="https://alt.fedoraproject.org/pub/alt/virtio-win/latest/images/bin/" rel="nofollow">https://alt.fedoraproject.org/pub/alt/v … mages/bin/</a><br />&#160; &#160; install manually in windows by &quot;updating&quot; the driver of the unknown disk device</p><p>software tested:<br />&#160; &#160; Firefox WebGL (google map)<br />&#160; &#160; Pangya<br />&#160; &#160; Natural Selection 2 (Steam)<br />&#160; &#160; Media Player Classic (h264 video)</p><p>bugs:<br />&#160; &#160; each time the VM boots, my linux display has color glitches (partial inversion), need to switch TTY (ctrl+alt+X) to reset colors (framebuffer)<br />&#160; &#160; sound may glitch a bit in video playback</p><br /><p>Windows 7 SP1 Ultimate (64 Bit)<br />&#160; &#160; torrent: 7ef0145bc19f53251df9ff7e11a795e9e088b65c<br />&#160; &#160; drivers: 14.10.1006-140417a-171099C (Overdrive works)<br />&#160; &#160; &#160; &#160; &#160; or amd_13_9_win7_win8_64_dd_ccc_whql.exe<br />&#160; &#160; &#160; &#160; &#160; &#160; ^ <a href="http://www.driversdown.com/drivers.asp?ID=129896&amp;brNum=3&amp;show=0" rel="nofollow">http://www.driversdown.com/drivers.asp? … m=3&amp;show=0</a></p></div></blockquote></div><p>Before starting qemu, I&#039;ve to switch to the vfio driver for my two devices (GPU+HDMI sound card, the readeon driver is *not* loaded it&#039;s blacklisted):</p><div class="codebox"><pre><code># $ lspci | grep AMD #01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850] [1002:6739] #01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] [1002:aa88] sudo modprobe vfio sudo modprobe vfio_pci echo &#039;0000:01:00.1&#039; | sudo tee /sys/bus/pci/devices/0000:01:00.1/driver/unbind echo 1002 6739 | sudo tee /sys/bus/pci/drivers/vfio-pci/new_id echo 1002 aa88 | sudo tee /sys/bus/pci/drivers/vfio-pci/new_id</code></pre></div><p>One thing that would be more convenient is to share the keyboard+mouse between the two OSes with a software multiplexer: that would create two virtual devices, one for linux + one for windows and you could choose to what it&#039;s connected. For the monitors that&#039;s fine, one way would be to use VNC inside windows but I&#039;m not sure of the overhead, wouldn&#039;t be nice. The network seems fine, I don&#039;t know if the default nic induce an important overhead, I didn&#039;t notice in game, seems fine.</p><p>I have tested the sound and it works (my microphone too! This is useful in NS2). The only problem of the whole is a minor bug when Windows init my card, it touches my linux buffer and changes some colors (kind of psychedelic) but that&#039;s once at boot, not that annoying. This looks a bit like what this guy had:</p><div class="quotebox"><cite>switchphase wrote:</cite><blockquote><div><p>After a few seconds my screen looks like this <a href="http://imgur.com/G7yT4uZ" rel="nofollow">http://imgur.com/G7yT4uZ</a>.</p></div></blockquote></div><p>You can see the harmless messages in my kern.log while the VM was running here (unsorted) <a href="http://paste.debian.net/110091/" rel="nofollow">http://paste.debian.net/110091/</a> .</p><p>Hope this helps!</p> <p class="postedit"><em>Last edited by d3lxa (2014-07-16 13:37:55)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436677">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436680" class="blockpost rowodd"> <h2><span><span class="conr">#2319</span> <a href="viewtopic.php?pid=1436680#p1436680">2014-07-16 13:22:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83600">d3lxa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83600">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>penetal wrote:</cite><blockquote><div><p>I am trying to create an audio infterface on the VM, but I end up with the scratchy / crackling sound problem that some others have come across in this thread.</p><p>I tried to set the sample rate and driver for QEMU, but that resulted in the problem becomming 100 times worse so I commented it out.<br />[…]<br />Has anyone been able to solve this problem when those two things didn&#039;t help?</p><p>Edit:<br />I&#039;m becomming unsure if the nested option is refering to the page tables or something else.</p></div></blockquote></div><p>I had this with the same settings you were using, try me version with -soundhw ac97 (remove the two &quot;sound&quot; lines) and don&#039;t forget to export the delay, not sure it works for PulseAudio though.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436680">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436779" class="blockpost roweven"> <h2><span><span class="conr">#2320</span> <a href="viewtopic.php?pid=1436779#p1436779">2014-07-16 19:42:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey folks,</p><p>I&#039;ve got some reset tweaks up for testing that might be useful to a number of you:</p><p><a href="https://lkml.org/lkml/2014/7/16/562" rel="nofollow">https://lkml.org/lkml/2014/7/16/562</a> (<a href="https://lkml.org/lkml/diff/2014/7/16/561/1" rel="nofollow">patch 1</a>, <a href="https://lkml.org/lkml/diff/2014/7/16/565/1" rel="nofollow">patch 2</a>, <a href="https://lkml.org/lkml/diff/2014/7/16/560/1" rel="nofollow">patch 3</a>)</p><p><a href="https://lkml.org/lkml/2014/7/16/567" rel="nofollow">https://lkml.org/lkml/2014/7/16/567</a> (<a href="https://lkml.org/lkml/diff/2014/7/16/567/1" rel="nofollow">patch</a>)</p><p>With these, the GPU should be reset regardless of how clean the guest was shutdown.&#160; Note that all devices on the bus need to be bound to vfio-pci for this to work.&#160; That means that if you&#039;re using pci-stub to sequester unused devices (perhaps the audio function), bind them to vfio-pci or there won&#039;t be any change.&#160; The second set of links is a patch necessary for AMD GPU users only and I&#039;d appreciate feedback on whether it solves and of the other reset issues (lack of reset) found on these GPUs.&#160; Thanks</p><p>PS - these are kernel patches against the latest development kernel, 3.16-rc5.&#160; They may or may not apply cleanly to older kernels.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436779">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436787" class="blockpost rowodd"> <h2><span><span class="conr">#2321</span> <a href="viewtopic.php?pid=1436787#p1436787">2014-07-16 20:10:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>d3lxa wrote:</cite><blockquote><div><p>One thing that would be more convenient is to share the keyboard+mouse between the two OSes with a software multiplexer: that would create two virtual devices, one for linux + one for windows and you could choose to what it&#039;s connected. For the monitors that&#039;s fine, one way would be to use VNC inside windows but I&#039;m not sure of the overhead, wouldn&#039;t be nice. The network seems fine, I don&#039;t know if the default nic induce an important overhead, I didn&#039;t notice in game, seems fine.</p></div></blockquote></div><p>Synergy?</p><div class="quotebox"><blockquote><div><p>I have tested the sound and it works (my microphone too! This is useful in NS2). The only problem of the whole is a minor bug when Windows init my card, it touches my linux buffer and changes some colors (kind of psychedelic) but that&#039;s once at boot, not that annoying.</p></div></blockquote></div><p>This is what the i915 patch and kernel option fixes that you&#039;ve decided is not necessary.&#160; It means that you won&#039;t get any VGA output on the guest, such as seabios or maybe Windows prompting how to startup after a crash.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436787">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436827" class="blockpost roweven"> <h2><span><span class="conr">#2322</span> <a href="viewtopic.php?pid=1436827#p1436827">2014-07-16 23:21:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>@aw Thanks for the new patch, i will test for AsMedia Sata controler.<br />But i found a new strange bug with Renesas USB 3.0 controler, when it use with vfio-pci the device is activate with a lot of new msi/msi-x like 43, 44, 45, 46 ... around 20 new irq adresse.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436827">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436829" class="blockpost rowodd"> <h2><span><span class="conr">#2323</span> <a href="viewtopic.php?pid=1436829#p1436829">2014-07-16 23:29:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Hey folks,</p><p>I&#039;ve got some reset tweaks up for testing that might be useful to a number of you:</p><p><a href="https://lkml.org/lkml/2014/7/16/562" rel="nofollow">https://lkml.org/lkml/2014/7/16/562</a> (<a href="https://lkml.org/lkml/diff/2014/7/16/561/1" rel="nofollow">patch 1</a>, <a href="https://lkml.org/lkml/diff/2014/7/16/565/1" rel="nofollow">patch 2</a>, <a href="https://lkml.org/lkml/diff/2014/7/16/560/1" rel="nofollow">patch 3</a>)</p><p><a href="https://lkml.org/lkml/2014/7/16/567" rel="nofollow">https://lkml.org/lkml/2014/7/16/567</a> (<a href="https://lkml.org/lkml/diff/2014/7/16/567/1" rel="nofollow">patch</a>)</p><p>With these, the GPU should be reset regardless of how clean the guest was shutdown.&#160; Note that all devices on the bus need to be bound to vfio-pci for this to work.&#160; That means that if you&#039;re using pci-stub to sequester unused devices (perhaps the audio function), bind them to vfio-pci or there won&#039;t be any change.&#160; The second set of links is a patch necessary for AMD GPU users only and I&#039;d appreciate feedback on whether it solves and of the other reset issues (lack of reset) found on these GPUs.&#160; Thanks</p><p>PS - these are kernel patches against the latest development kernel, 3.16-rc5.&#160; They may or may not apply cleanly to older kernels.</p></div></blockquote></div><p>I&#039;ve tested them against 3.16-rc5 kernel. They apply clean, I&#039;ve rebooted and re-tested my Linux + fglrx and Windows + catalyst with my R9 290X. It still suffers from the reset problem. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> On Linux + fglrx I get oops (inside VM) after reboot of VM and X start. On Windows + catalyst I still get the BSOD PAGE_FAULT_IN_NONPAGED_AREA.</p> <p class="postedit"><em>Last edited by mbroemme (2014-07-16 23:30:29)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436850" class="blockpost roweven"> <h2><span><span class="conr">#2324</span> <a href="viewtopic.php?pid=1436850#p1436850">2014-07-17 00:49:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=66944">shrubuntu</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-12-26</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=66944">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I ran </p><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU</code></pre></div><p>and got:</p><div class="codebox"><pre><code>[ 0.056332] IOAPIC id 8 under DRHD base 0xfed90000 IOMMU 0 rishub@debian:~$ dmesg | grep -e DMAR -e IOMMU [ 0.000000] ACPI: DMAR 00000000de555810 000080 (v01 INTEL BDW 00000001 INTL 00000001) [ 0.056269] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap d2008c20660462 ecap f010da [ 0.056332] IOAPIC id 8 under DRHD base 0xfed90000 IOMMU 0 [ 0.537854] AMD IOMMUv2 driver by Joerg Roedel &lt;joerg.roedel@amd.com&gt; [ 0.537854] AMD IOMMUv2 functionality not available on this system</code></pre></div><p>I am running i7 4790k with Msi Gaming 5<br />In my bios, there is a vt-d option and the processor supports it</p><p>Do I have it running on my system? Is this output correct?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436850">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1436854" class="blockpost rowodd"> <h2><span><span class="conr">#2325</span> <a href="viewtopic.php?pid=1436854#p1436854">2014-07-17 01:18:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mbroemme wrote:</cite><blockquote><div><p>I&#039;ve tested them against 3.16-rc5 kernel. They apply clean, I&#039;ve rebooted and re-tested my Linux + fglrx and Windows + catalyst with my R9 290X. It still suffers from the reset problem. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> On Linux + fglrx I get oops (inside VM) after reboot of VM and X start. On Windows + catalyst I still get the BSOD PAGE_FAULT_IN_NONPAGED_AREA.</p></div></blockquote></div><p>Bummer.&#160; Is the oops a regression or is that something you see already?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1436854">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=92">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=91">91</a> <a href="viewtopic.php?id=162768&amp;p=92">92</a> <strong>93</strong> <a href="viewtopic.php?id=162768&amp;p=94">94</a> <a href="viewtopic.php?id=162768&amp;p=95">95</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=94">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
