<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 229) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=229" title="Page 229" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=228" title="Page 228" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=230" title="Page 230" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=228">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=227">227</a> <a href="viewtopic.php?id=162768&amp;p=228">228</a> <strong>229</strong> <a href="viewtopic.php?id=162768&amp;p=230">230</a> <a href="viewtopic.php?id=162768&amp;p=231">231</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=230">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1546583" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5701</span> <a href="viewtopic.php?pid=1546583#p1546583">2015-07-21 15:50:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92679">Col_Panic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-19</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I&#039;m not quite ready to give up yet. <br />Since it looks to me like my [kvm/machine/driver] is trying to map and unmap the same memory region over and over again when it tries to attach the Radeon card to the host, is it possible that multiple devices are competing for the same memory space, or it&#039;s otherwise inaccessible? Maybe there&#039;s a way to tell VFIO to set the DMA mappings for this device at an early stage of the Linux boot process? <br />Or maybe I just have no idea what I&#039;m talking about, and should give up already?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546583">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546585" class="blockpost roweven"> <h2><span><span class="conr">#5702</span> <a href="viewtopic.php?pid=1546585#p1546585">2015-07-21 15:54:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Col_Panic</p><p>in fact, the majority of the IOMMU mappings for the VM are setup prior to an execution of the VM, it&#039;s only a small set of legacy ranges and memory mapped I/O regions that change run-time.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546585">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546767" class="blockpost rowodd"> <h2><span><span class="conr">#5703</span> <a href="viewtopic.php?pid=1546767#p1546767">2015-07-22 05:09:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@impulse_255</p><p>Have you run into the KMODE_EXCEPTION_NOT_HANDLED error? </p><p>I&#039;ve modified my GPU rom to have the Quadro K5000 (from a GTX 760) Device ID as well as the appropriate checksum. However, when I pass the romfile, all i get is a black screen... When I add a Virtual Console to the VM and view the boot through virt-manager, I see the above mentioned error. When I just change the device IDs and not pass a ROM, I am able to get Windows 10 setup to start, but when formatting the disk it shows the above error. Booting off a Windows 7 disk, all I get is a Windows 7 pulsating windows icon.</p><p>For some reason now, i can&#039;t even get my VM to boot with the previous config without hacking the device ID. I have power cycled my system, but I haven&#039;t pulled the GPU, maybe something bad is being stored on the GPU?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546767">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546808" class="blockpost roweven"> <h2><span><span class="conr">#5704</span> <a href="viewtopic.php?pid=1546808#p1546808">2015-07-22 09:02:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@The_Moves :</p><p>I had this exact BSOD with this exact error .</p><p>As soon as I switched to an older version of OVMF (15000~ something) , it was solved and I could install Windows 10 without a BSOD .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546808">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546814" class="blockpost rowodd"> <h2><span><span class="conr">#5705</span> <a href="viewtopic.php?pid=1546814#p1546814">2015-07-22 09:16:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@The_Moves:</p><p>Did you modify your own rom or did you download it from somewhere? I tried a 3rd party rom for my card and got a black screen. Likewise a rom dump made in the guest from an initialised card would not work. The only way that worked was this incantation after a power cycle/suspend:</p><div class="codebox"><pre><code># echo 1 &gt; /sys/bus/pci/devices/&lt;pciid&gt;/rom; # cat /sys/bus/pci/devices/&lt;pciid&gt;/rom &gt; vbios.rom; # echo 0 &gt; /sys/bus/pci/devices/&lt;pciid&gt;/rom</code></pre></div><p>Also, changing IDs/roms without a power cycle gave me KMODE_EXCEPTION_NOT_HANDLED BSODs.</p><p>Did you have a working, installed guest before? Like said, the new OVMF builds throw the same BSOD at boot or installation, namely at the copying files step. Windows 7 also won&#039;t work with OVMF without some magic but I gave up with that.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546814">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546869" class="blockpost roweven"> <h2><span><span class="conr">#5706</span> <a href="viewtopic.php?pid=1546869#p1546869">2015-07-22 14:21:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Denso and @impulse_255</p><p>I will have to look at downgrading my qemu to what I was at before, I believe 2.1 or so. Impulse, what version are you running currently? You guys described exactly what I was experiencing. I believe the ROM file I was using was a dump from my card, but i&#039;ll boot onto my FreeDOS USB and grab a new copy. I followed updating the Device ID and Checksum in the ROM, but maybe I should do the Subsystem ID as well - I only discovered late last night that the x-ss-vid was for subsystem...</p><p>I&#039;ve had a working Windows 10 build with OVMF for months now , only got the issue when I was when I started messing with the IDs for the card and used the latest version of Qemu to do it. It was my gaming system and was working on performance tweaking, trying to get as many FPS as possible.</p><p>I&#039;ve seen this before, but what does it do? How does echoing 1 to a file change things?</p><div class="codebox"><pre><code># echo 1 &gt; /sys/bus/pci/devices/&lt;pciid&gt;/rom; # cat /sys/bus/pci/devices/&lt;pciid&gt;/rom &gt; vbios.rom; # echo 0 &gt; /sys/bus/pci/devices/&lt;pciid&gt;/rom</code></pre></div><p>@impulse_255, by changing IDs you mean changing the x-vid and x-ss-vid in the qemu line?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546869">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546873" class="blockpost rowodd"> <h2><span><span class="conr">#5707</span> <a href="viewtopic.php?pid=1546873#p1546873">2015-07-22 14:37:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, I ended up flashing the updated vbios from gigabyte, which has a valid UEFI rom signature. This worked fine and still runs as normal in my seabios setup on the same system, but I get the same issue as before when trying to install catalyst -- it gets up to installing the driver proper, the system momentarily freezes up and then reboots during installing the actual driver. I do get (low-resolution) output on the physical card up until the VM freezes and reboots.</p><p>I&#039;ve pasted my vm config <a href="http://sprunge.us/aPiB?xml" rel="nofollow">here</a>. Is there anything I might be missing on the host side of the setup for ovmf to work?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546873">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546915" class="blockpost roweven"> <h2><span><span class="conr">#5708</span> <a href="viewtopic.php?pid=1546915#p1546915">2015-07-22 17:10:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>@Denso and @impulse_255</p><p>I will have to look at downgrading my qemu to what I was at before, I believe 2.1 or so. Impulse, what version are you running currently? You guys described exactly what I was experiencing. I believe the ROM file I was using was a dump from my card, but i&#039;ll boot onto my FreeDOS USB and grab a new copy. I followed updating the Device ID and Checksum in the ROM, but maybe I should do the Subsystem ID as well - I only discovered late last night that the x-ss-vid was for subsystem...</p><p>I&#039;ve had a working Windows 10 build with OVMF for months now , only got the issue when I was when I started messing with the IDs for the card and used the latest version of Qemu to do it. It was my gaming system and was working on performance tweaking, trying to get as many FPS as possible.</p></div></blockquote></div><p>Oh. :( I can&#039;t say what&#039;s wrong there. Power cycling has fixed all the black screen/BSOD messes I&#039;ve caused so far, and there shouldn&#039;t be any lasting hardware changes involved. The installer issues sound exactly like the OVMF issue. I once accidentally used a fresh, non-working version with my already installed Windows and it crashed all the same, so the issue is not limited to just the installer. Are you still using the same OVMF as before?</p><p>I&#039;m currently using Qemu 2.3.0 and the old sata patched OVMF build whose build date or number I don&#039;t know.</p><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>I&#039;ve seen this before, but what does it do? How does echoing 1 to a file change things?</p></div></blockquote></div><p>Frankly, I don&#039;t know what it exactly does. It&#039;s some kernel interface that presents itself as a file.</p><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>@impulse_255, by changing IDs you mean changing the x-vid and x-ss-vid in the qemu line?</p></div></blockquote></div><p>Yes. To clarify: if I booted the guest with one set of IDs, shut it down and tried to boot it again without a power cycle (or S3 suspend, which I use) with another set of IDs, Windows would BSOD. This happened even if the IDs and rom would otherwise work when I stick to using one at a time. <span class="bbs">BTW, did you modify the subsystem ID in the rom as well? I searched &amp; replaced all I could find: 2 instances of PCI ID and one of SS ID.</span> edit: couldn&#039;t read</p> <p class="postedit"><em>Last edited by impulse_255 (2015-07-22 17:19:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546915">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546918" class="blockpost rowodd"> <h2><span><span class="conr">#5709</span> <a href="viewtopic.php?pid=1546918#p1546918">2015-07-22 17:16:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>BTW, I reported the Win8.1/OVMF install issue to Laszlo who bisected and found the commit that introduced it.&#160; There&#039;s already a patch on their list to fix it, but the ongoing sorceforge outage is delaying it being committed and new builds including it.&#160; Stick with a pre-July build until things get moving again.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546918">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1546920" class="blockpost roweven"> <h2><span><span class="conr">#5710</span> <a href="viewtopic.php?pid=1546920#p1546920">2015-07-22 17:20:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>BTW, I reported the Win8.1/OVMF install issue to Laszlo who bisected and found the commit that introduced it.&#160; There&#039;s already a patch on their list to fix it, but the ongoing sorceforge outage is delaying it being committed and new builds including it.&#160; Stick with a pre-July build until things get moving again.</p></div></blockquote></div><p>Great, thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1546920">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547023" class="blockpost rowodd"> <h2><span><span class="conr">#5711</span> <a href="viewtopic.php?pid=1547023#p1547023">2015-07-23 01:02:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I installed stock Qemu 2.1 from Source RPMs and am still getting the &#039;KMODE_EXCEPTION_NOT_HANDLED&#039; error. When I remove libvirt and qemu, are there other files I should remove manually? I&#039;m almost to the point of rebuilding from stock Fedora 21 or Fedora 22. I had no issues until I upgraded from 21 to 22, but 21 is going out of support soon.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547023">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547027" class="blockpost roweven"> <h2><span><span class="conr">#5712</span> <a href="viewtopic.php?pid=1547027#p1547027">2015-07-23 01:18:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>BTW, I reported the Win8.1/OVMF install issue to Laszlo who bisected and found the commit that introduced it.&#160; There&#039;s already a patch on their list to fix it, but the ongoing sorceforge outage is delaying it being committed and new builds including it.&#160; Stick with a pre-July build until things get moving again.</p></div></blockquote></div><p>Oh, you mean OVMF itself. The OVMF firmware from EDK2 has an issue...so my Qemu/Libvirt reinstalling really wasn&#039;t the issue...ugh. I need to read closer.</p><p>Edit: I got finally got it working, but am still unable to pass a romfile or the multifunction attribute (not sure what it does). Windows does see the card as a K5000. In my game World of Tanks, normally when I would hover over different icons for tanks in the Garage, the screen would freeze for a split second. Overall though, there really isn&#039;t an improvement in FPS from what I can see. Loading into maps has improved by 50%. But it wouldn&#039;t hurt to do some actual benchmarks. </p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.0,addr=0x0f,addr=0x0f,bus=pci.0,x-vid=0x10DE,x-did=0x11BA,x-ss-vid=0x10DE,x-ss-did=0x0965,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.1,addr=0x10,bus=pci.0&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>Now for some reason, my Start Menu doesn&#039;t work, nor does Edge. It might just be a downlevel version of OVMF, libvirt, or qemu.</p><p>Edit 2: I was able to get my Start Menu and Edge to work with a reset of Windows itself.</p> <p class="postedit"><em>Last edited by The_Moves (2015-07-23 23:15:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547027">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547114" class="blockpost rowodd"> <h2><span><span class="conr">#5713</span> <a href="viewtopic.php?pid=1547114#p1547114">2015-07-23 09:02:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84998">jack_boss</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-09</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, I need help; before I go buy a KM switch which are not cheap considering I have to import it.. etc.</p><p>I need to passthrough a USB Host controller for mouse and keyboard, becasue if I want to pass through a USB Host device it has to be attached. I went with the following and it has its own iommu group:</p><div class="codebox"><pre><code>USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 /sys/kernel/iommu_groups/9/devices/0000:00:1d.0</code></pre></div><p> <strong>lspci -n -s 00:1d</strong> gave me <em>8086:8ca6</em> which I added to my kernel command line. <br />The other vendor:product id&#039;s are for my GTX770 </p><div class="codebox"><pre><code>options root=UUID=1aea1286-102b-444d-9f30-494305255937 rw elevator=noop intel_iommu=on iommu=pt pci-stub.ids=10de:1184,10de:0e0a,8086:8ca6 hugepages=2048</code></pre></div><p>A USB Controller was already present (I&#039;ve tried USB2 and USB3, same results)<br />Finally in virt-manager I clicked <strong>Add Hardware &gt;PCI Host Device&gt;</strong> USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1</p><p>In the VM (Windows) I can see drivers being loaded and installed. The thing is, it doesnt matter in which port I plug in my mouse (removed from host/tried wireless usb mouse dongle, pen drive) nothing is listed or moves (just in case i tried every port)</p><p>Please help.</p><p>Just if somebody needs to see this:</p><div class="codebox"><pre><code>00:1d.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 Subsystem: ASRock Incorporation Device 8ca6 Kernel driver in use: vfio-pci Kernel modules: ehci_pci</code></pre></div><p>lsmod | grep -E &quot;virt|kvm|iommu&quot;</p><br /><div class="codebox"><pre><code>vfio_iommu_type1 20480 1 vfio 24576 8 vfio_iommu_type1,vfio_pci kvm_intel 155648 4 kvm 442368 1 kvm_intel virtio_blk 20480 0 virtio_scsi 20480 0 scsi_mod 151552 5 uas,usb_storage,libata,sd_mod,virtio_scsi virtio_net 32768 0 virtio_ring 20480 3 virtio_blk,virtio_net,virtio_scsi virtio 16384 3 virtio_blk,virtio_net,virtio_scsi</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547114">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547137" class="blockpost roweven"> <h2><span><span class="conr">#5714</span> <a href="viewtopic.php?pid=1547137#p1547137">2015-07-23 10:21:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jack_boss wrote:</cite><blockquote><div><p>Hello, I need help; before I go buy a KM switch which are not cheap considering I have to import it.. etc.</p><p>I need to passthrough a USB Host controller for mouse and keyboard, becasue if I want to pass through a USB Host device it has to be attached. I went with the following and it has its own iommu group:</p><div class="codebox"><pre><code>USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 /sys/kernel/iommu_groups/9/devices/0000:00:1d.0</code></pre></div><p> <strong>lspci -n -s 00:1d</strong> gave me <em>8086:8ca6</em> which I added to my kernel command line. <br />The other vendor:product id&#039;s are for my GTX770 </p><div class="codebox"><pre><code>options root=UUID=1aea1286-102b-444d-9f30-494305255937 rw elevator=noop intel_iommu=on iommu=pt pci-stub.ids=10de:1184,10de:0e0a,8086:8ca6 hugepages=2048</code></pre></div><p>A USB Controller was already present (I&#039;ve tried USB2 and USB3, same results)<br />Finally in virt-manager I clicked <strong>Add Hardware &gt;PCI Host Device&gt;</strong> USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1</p><p>In the VM (Windows) I can see drivers being loaded and installed. The thing is, it doesnt matter in which port I plug in my mouse (removed from host/tried wireless usb mouse dongle, pen drive) nothing is listed or moves (just in case i tried every port)</p><p>Please help.</p><p>Just if somebody needs to see this:</p><div class="codebox"><pre><code>00:1d.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 Subsystem: ASRock Incorporation Device 8ca6 Kernel driver in use: vfio-pci Kernel modules: ehci_pci</code></pre></div><p>lsmod | grep -E &quot;virt|kvm|iommu&quot;</p><br /><div class="codebox"><pre><code>vfio_iommu_type1 20480 1 vfio 24576 8 vfio_iommu_type1,vfio_pci kvm_intel 155648 4 kvm 442368 1 kvm_intel virtio_blk 20480 0 virtio_scsi 20480 0 scsi_mod 151552 5 uas,usb_storage,libata,sd_mod,virtio_scsi virtio_net 32768 0 virtio_ring 20480 3 virtio_blk,virtio_net,virtio_scsi virtio 16384 3 virtio_blk,virtio_net,virtio_scsi</code></pre></div></div></blockquote></div><p>I think that on some Intel chipsets, the kernel maps all your physical USB ports behind the Intel xHCI USB controller by default and leaves the EHCI ones unused. <a href="http://lxr.free-electrons.com/source/drivers/usb/host/pci-quirks.c#L850" rel="nofollow">http://lxr.free-electrons.com/source/dr … rks.c#L850</a>. I worked around it by manually changing the Port Routing Mask Register to map physical ports behind the EHCI controllers. The register can simply be changed on the fly.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547137">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547160" class="blockpost rowodd"> <h2><span><span class="conr">#5715</span> <a href="viewtopic.php?pid=1547160#p1547160">2015-07-23 11:01:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84998">jack_boss</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-09</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I think that on some Intel chipsets, the kernel maps all your physical USB ports behind the Intel xHCI USB controller by default and leaves the EHCI ones unused. <a href="http://lxr.free-electrons.com/source/drivers/usb/host/pci-quirks.c#L850" rel="nofollow">http://lxr.free-electrons.com/source/dr … rks.c#L850</a>. I worked around it by manually changing the Port Routing Mask Register to map physical ports behind the EHCI controllers. The register can simply be changed on the fly.</p></div></blockquote></div><p>Might be worth a try, if I just knew how to do it... first google attempt didn&#039;t really help either.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547160">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547184" class="blockpost roweven"> <h2><span><span class="conr">#5716</span> <a href="viewtopic.php?pid=1547184#p1547184">2015-07-23 12:17:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jack_boss wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I think that on some Intel chipsets, the kernel maps all your physical USB ports behind the Intel xHCI USB controller by default and leaves the EHCI ones unused. <a href="http://lxr.free-electrons.com/source/drivers/usb/host/pci-quirks.c#L850" rel="nofollow">http://lxr.free-electrons.com/source/dr … rks.c#L850</a>. I worked around it by manually changing the Port Routing Mask Register to map physical ports behind the EHCI controllers. The register can simply be changed on the fly.</p></div></blockquote></div><p>Might be worth a try, if I just knew how to do it... first google attempt didn&#039;t really help either.</p></div></blockquote></div><p>You want to access the port routing register in the xhci controllers pci config space. Personally I ended up using &quot;setpci -s 00:14.0 0xd0.W=2037&quot; in my /etc/rc.local file on the Intel 8 Series PCH. Intel has pretty decent documentation available for the chipsets.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547184">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547322" class="blockpost rowodd"> <h2><span><span class="conr">#5717</span> <a href="viewtopic.php?pid=1547322#p1547322">2015-07-23 20:37:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Someone 2 pages ago asked about APU and it&#039;s GPU. His questions remain unanswered ever since.<br />Well, he was right, but there&#039;s some caveats left:<br />1. disable hugepages. They trash everything.<br />2. do not try to p-t APU&#039;s GPU, p-t only a dedicated one. The integrated one is... integrated into the CPU, so there&#039;s a sophisticated power management system present, which doesn&#039;t work with only the GPU p-t&#039;d.(i&#039;ve learned that only by examining amd&#039;s BKDG, so no practice experience) As such, even though CrossFireX works, dual graphics will not.<br />3. <strong>x-vga generally doesn&#039;t work on these platforms</strong>. Use OVMF, which is quite unstable now.<br />4. some bandwidth issues present on some motherboards. For example, i am crazy enough to run four GPUs on an FM2 system(i have an athlon 750k), and the only pci-e slot routed fully 16x is the first one, the others are 8x(and if there are other devices present in 1x connectors, it works as x4).<br />5. this platform has good device isolation capabilities, no ACS patch needed. When stuffed with GPUs, there are three IOMMU groups: the first GPU, the second, and the other stuff you have on PCI bus, so you&#039;ll have to use xen&#039;s pci-assign to use those devices.<br />6. <a href="http://openbenchmarking.org/system/1210129-RA-AMDA1058095/AMD%20A10-5800K/lspci" rel="nofollow">lspci</a> shows that the integrated GPU is near the root, so there must be no problems with device isolation, you may use it as a host device.<br />7. the setup switch, AFAIK, routes only VGA. GOP(UEFI) gets mirrored to all available devices and GPUs, making that switch useless. Gigabyte motherboards can change the primary VGA device on any platform, which is a nice feature for our objectives.<br />8. you might want to try running proprietary drivers on your host GPU. There was some problems in the past, i haven&#039;t heard about them very long. Maybe Device ID stanza in xorg.conf helps to sort out that &quot;autobinding&quot; problem.</p><p>I hope i&#039;ve answered most questions about FM2 platforms.<br />Conclusion: FM2 is not recommended for device pass-through, but you can do a dozen of work-arounds to make it work.</p><br /><p>BTW: Win7+OVMF worked for me until july. <a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a> tells us to add an additional QXL emulated GPU to be able to see something until the GPU fires up properly. Win7 likes VBE, which is emulated only on QXL and not present on real UEFI systems.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547322">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547359" class="blockpost roweven"> <h2><span><span class="conr">#5718</span> <a href="viewtopic.php?pid=1547359#p1547359">2015-07-23 23:14:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=25786">JHeaton</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: United Kingdom</span></dd> <dd><span>Registered: 2009-05-16</span></dd> <dd><span>Posts: 158</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=25786">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all. So I set this up over the past couple of days, thanks in huge part to the posters in this thread and the various linked resources. I&#039;m running two GTX 970 cards in my PC and passing them both through to the virtual machine; these are recognised by Windows, I have them showing in Device Manager, the latest nVidia drivers are installed, however I seem unable to use SLI; the nVidia control panel simply does not offer me the option, whereas normally in Windows it does so straight away. Has anyone so far managed to get SLI working using this kind of setup?</p><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547359">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547379" class="blockpost rowodd"> <h2><span><span class="conr">#5719</span> <a href="viewtopic.php?pid=1547379#p1547379">2015-07-24 01:10:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@JHeaton - I believe people have gotten CrossFire to work, but not that I remember reading. Have you tried setting it up to there the SLI doesn&#039;t use the bridge, but instead the interconnect through the PCIe bus? What motherboard are you running? What generation PCIe?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547379">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547380" class="blockpost roweven"> <h2><span><span class="conr">#5720</span> <a href="viewtopic.php?pid=1547380#p1547380">2015-07-24 01:13:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=25786">JHeaton</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: United Kingdom</span></dd> <dd><span>Registered: 2009-05-16</span></dd> <dd><span>Posts: 158</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=25786">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>@JHeaton - I believe people have gotten CrossFire to work, but not that I remember reading. Have you tried setting it up to there the SLI doesn&#039;t use the bridge, but instead the interconnect through the PCIe bus? What motherboard are you running? What generation PCIe?</p></div></blockquote></div><p>Thanks for the reply. I actually wasn&#039;t aware you could even do that, do you have information on how I would go about it? Motherboard is Asrock Z97 Extreme6 and PCIe 3.0.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547380">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547407" class="blockpost rowodd"> <h2><span><span class="conr">#5721</span> <a href="viewtopic.php?pid=1547407#p1547407">2015-07-24 04:25:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve only heard about it. Don&#039;t actually utilize SLI.</p> <p class="postedit"><em>Last edited by The_Moves (2015-07-24 04:26:29)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547407">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547507" class="blockpost roweven"> <h2><span><span class="conr">#5722</span> <a href="viewtopic.php?pid=1547507#p1547507">2015-07-24 14:02:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80749">SXX</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-31</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80749">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>Get second mouse for host (wireless for example) and passthrough main one<br /><em>or</em><br />passthrough your mouse to VM and use Synergy (host as client, VM as server).</p></div></blockquote></div><p>Sadly none of this work for me because I have multiple VMs at the same time where all of them must have mouse working in games. Still trying to figure out solution, may be going to try add some non-standard mouse support into QEMU.</p><p>Also I&#039;m managed to pass GTX 260 successfully, but only without &quot;x-vga&quot; and active &quot;-vga qxl&quot;. It&#039;s end up that my issue with it was caused by fact that GTX 260 won&#039;t reset properly on VM reset/poweroff so it&#039;s remain in some sort of unusable state after first usage. So I bypass it by booting VM with emulated GPU and then just disable/enable GTX 260 via Device Manager: it&#039;s end up working just fine.</p><p>Now I have other question. I heard that virtio driver must support &quot;read only&quot; mode with filesystem changes written into separate file and QCOW must support that. What I want is to share disk with Steam games between two VMs so both may access it without breakage. Is there anyone who successfully used read-only mode / snapshots with Windows guests?</p> <p class="postedit"><em>Last edited by SXX (2015-07-24 14:03:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><strong>Online</strong></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547507">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547519" class="blockpost rowodd"> <h2><span><span class="conr">#5723</span> <a href="viewtopic.php?pid=1547519#p1547519">2015-07-24 14:26:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@SXX</p><p>It&#039;s not very read-only if the filesystem can be changed, is it?&#160; qemu-img can create multiple qcow2 images, all using the same backing store file, so writes are added to each leaf image, not the base image.&#160; I suspect you do not want a read-only image exposed to each VM, because games generally like to apply updates.&#160; There&#039;s a QEMU <em>-snapshot</em> option which stores disk writes in memory and throws them away on VM shutdown, but I wouldn&#039;t recommend it for this case since any long running VM will quickly consume all your RAM.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547519">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547521" class="blockpost roweven"> <h2><span><span class="conr">#5724</span> <a href="viewtopic.php?pid=1547521#p1547521">2015-07-24 14:34:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>JHeaton wrote:</cite><blockquote><div><p>Hi all. So I set this up over the past couple of days, thanks in huge part to the posters in this thread and the various linked resources. I&#039;m running two GTX 970 cards in my PC and passing them both through to the virtual machine; these are recognised by Windows, I have them showing in Device Manager, the latest nVidia drivers are installed, however I seem unable to use SLI; the nVidia control panel simply does not offer me the option, whereas normally in Windows it does so straight away. Has anyone so far managed to get SLI working using this kind of setup?</p><p>Thanks!</p></div></blockquote></div><p>I am the one with the crossfire working. My cards use XDMA crossfire(nvidia doesn&#039;t have that technology), which utilizes PCI-e bandwidth instead of an external bridge.<br />So. Nvidia are some tight asses, and prohibit SLI running on non-SLI certified motherboards.<br />There was a project called <a href="http://www.techpowerup.com/forums/threads/hypersli-enabling-sli-on-non-sli-motherboards.153046/" rel="nofollow">HyperSLI</a> to enable SLI on any motherboard. Generally it requires the machine to have virtualization support(meaning nested virtualization for us), BUT i&#039;ve red a story where some sick folks ran two GeForce 6600 in SLI on a P3 motherboard(obviously lacking any virtualization), however they had a performance drawback instead of a boost.<br />I remember someone tried to use a more modern version of HyperSLI, but he failed. You can try too, but i doubt that it will work.</p><p>I don&#039;t know about 2-chip(SLI on one PCB) solutions working in a virtual machine. Maybe they do work.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547521">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1547528" class="blockpost rowodd"> <h2><span><span class="conr">#5725</span> <a href="viewtopic.php?pid=1547528#p1547528">2015-07-24 15:02:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80749">SXX</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-31</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80749">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>First of all thanks for an answer! This is super helpful because all information I can find on internet it&#039;s RHEL bugtracker where I suppose everyone talking about Linux guests and bugs related to VMs that&#039;s filesystem aware drive is read-only.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It&#039;s not very read-only if the filesystem can be changed, is it?</p></div></blockquote></div><p>The point it&#039;s to have them read-only on host. Reason for this is fact I don&#039;t want to apply any changes to system drive because I don&#039;t really need any Windows or driver updates and image itself stored on small SSD in compressed state. When Windows using drive it&#039;s start to become bigger and bigger so I wish to keep system drive image completely unchanged until I decide otherwise.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I suspect you do not want a read-only image exposed to each VM, because games generally like to apply updates.</p></div></blockquote></div><p>It&#039;s won&#039;t be running like that all the time because I only need it when some friends come to play with me.<br />So when I need to apply updates I&#039;ll just run it like normal VM with writetable drives.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>qemu-img can create multiple qcow2 images, all using the same backing store file, so writes are added to each leaf image, not the base image.</p></div></blockquote></div><p>It&#039;s not exactly what I need, but may be hanby for system drive. Is it possible to use that with existing QCOW image?<br />I already have Windows guest QCOW image so I want clone into two with little changes.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>There&#039;s a QEMU <em>-snapshot</em> option which stores disk writes in memory and throws them away on VM shutdown, but I wouldn&#039;t recommend it for this case since any long running VM will quickly consume all your RAM.</p></div></blockquote></div><p>It&#039;s actually exactly what I need. Any idea if it&#039;s going to work for physical HDD partition?</p><div class="codebox"><pre><code>-drive file=/dev/disk/by-uuid/0AD949C94647B394,format=raw,if=virtio</code></pre></div><p>Also according to <a href="http://wiki.qemu.org/Documentation/CreateSnapshot#Returning_to_a_previous_version" rel="nofollow">wiki</a> &quot;any changes made to the virtual machine while it is running are written to temporary&quot;. Would be interesting if I can write temporary changes on my HDD RAID.</p><p>Currently my setup looks like that:<br />- Host system and two Windows QCOW images (13GB each) on small SSD (60GB).<br />- RAID of two 250GB HDDs for data.<br />- 1TB HDD with NTFS partition for VM games<br />So I with it&#039;s possible to use that NTFS partition in both VMs because it&#039;s would take several days to move it into QCOW and not sure what performance would be.</p> <p class="postedit"><em>Last edited by SXX (2015-07-24 15:23:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><strong>Online</strong></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1547528">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=228">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=227">227</a> <a href="viewtopic.php?id=162768&amp;p=228">228</a> <strong>229</strong> <a href="viewtopic.php?id=162768&amp;p=230">230</a> <a href="viewtopic.php?id=162768&amp;p=231">231</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=230">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
