<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 177) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=177" title="Page 177" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=176" title="Page 176" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=178" title="Page 178" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=176">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=175">175</a> <a href="viewtopic.php?id=162768&amp;p=176">176</a> <strong>177</strong> <a href="viewtopic.php?id=162768&amp;p=178">178</a> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=178">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1508940" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4401</span> <a href="viewtopic.php?pid=1508940#p1508940">2015-03-06 15:01:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mbirkis wrote:</cite><blockquote><div><p>I have been searching abit in this forum and on aw&#039;s vfio blog faq. When going through the talking points you had aw i got the impression that if i switch to using OVMF and UEFI on my windows8.1 guest, the vga arbiter issue with Nvidia proprietary host drivers is a non issue (your faq question 9) and i can install and use the nvidia driver on the host without patching?</p><p>Sorry if this question has been answered before i just had a hard time finding the answer that looked obvious from your talking points &quot;VFIO, OVMF, GPU, and You &quot;.</p></div></blockquote></div><p>It&#039;s my understanding that this is true.&#160; The problem with the nvidia proprietary driver on the host is that it takes the VGA arbiter lock and never releases it.&#160; The expected usage model for the VGA arbiter is that the lock is held only while accesses to the legacy VGA space are being used.&#160; The lock is then released allowing other users of the arbiter a chance to acquire the lock and perform their access.&#160; This is how pseudo-concurrent VGA access works with multiple VGA assignment VMs.&#160; Therefore, so long as our VM is not performing VGA accesses, which can be enforced by disabling CONFIG_VFIO_PCI_VGA (or a vfio-pci module option I intend to add), there is no need to patch the host nvidia driver to prevent VGA locking.</p><p>Note however that while OVMF generally implies legacy-free, there is a legacy compatibility module, the CSM, available in some OVMF builds.&#160; The CSM will potentially do legacy VGA accesses and put you back in the position of needing to patch host drivers for VGA arbitration.&#160; You therefore want to make use of the &quot;pure&quot; version of OVMF to avoid this.&#160; On Fedora, the OVMF file to use is /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd (avoid the &quot;with-csm&quot; versions).&#160; Your builds may name them differently.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508940">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508943" class="blockpost roweven"> <h2><span><span class="conr">#4402</span> <a href="viewtopic.php?pid=1508943#p1508943">2015-03-06 15:06:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>efeu wrote:</cite><blockquote><div><p>I havent that good CPU Performance in Win8.1 using -smp 8,sockets=1,cores=4,threads=2 with my 4970k@4,6GHz so I saw Pin vcpu to pcpu in first post but this site seems to be do offline.<br />Can someone help me with that?</p></div></blockquote></div><p>Specifying a CPU topology with threads is generally only recommended in combination with pinning.&#160; Using 100% of the host CPU resources for a guest is also likely to cause glitches when the host needs some CPU resources.&#160; There&#039;s plenty of information online for vCPU pinning.&#160; libvirt can do this for you and is detailed on their site.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508943">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508946" class="blockpost rowodd"> <h2><span><span class="conr">#4403</span> <a href="viewtopic.php?pid=1508946#p1508946">2015-03-06 15:33:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>I&#039;ve seen this too (no need to patch host drivers if you&#039;re using OVMF). Sadly I have no clue how to make it work though.<br />From what I&#039;ve read you should launch Qemu with</p><div class="codebox"><pre><code>qemu-system-x86_64 -L .</code></pre></div><p>This while being in the directory where the UEFI bios.bin is in.<br />Well tried that, it did nothing, not even give me an UEFI shell.</p><p>Is there a proper guide to OVMF in Qemu out there that we can use?</p></div></blockquote></div><p>Assuming you&#039;re on arch:</p><p>Get <a href="https://aur.archlinux.org/packages/ovmf-svn/" rel="nofollow">OVMF-svn</a>, build an install it.</p><p>Then launch qemu like this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -device vfio-pci,host=07:00.0 -device vfio-pci,host=07:00.1 \ -vga none</code></pre></div></div></blockquote></div><p>Yes i&#039;m on Arch <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Well without -&quot;vga none&quot;, it at least drops me in the EFI shell now which it didn&#039;t before, so that&#039;s progress.<br />Sadly now with -&quot;vga none&quot; added again it only shows me the &quot;compat_monitor0 console&quot; again...<br />I seriously don&#039;t understand what i&#039;m missing here...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508946">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508950" class="blockpost roweven"> <h2><span><span class="conr">#4404</span> <a href="viewtopic.php?pid=1508950#p1508950">2015-03-06 15:49:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>I&#039;ve seen this too (no need to patch host drivers if you&#039;re using OVMF). Sadly I have no clue how to make it work though.<br />From what I&#039;ve read you should launch Qemu with</p><div class="codebox"><pre><code>qemu-system-x86_64 -L .</code></pre></div><p>This while being in the directory where the UEFI bios.bin is in.<br />Well tried that, it did nothing, not even give me an UEFI shell.</p><p>Is there a proper guide to OVMF in Qemu out there that we can use?</p></div></blockquote></div><p>Assuming you&#039;re on arch:</p><p>Get <a href="https://aur.archlinux.org/packages/ovmf-svn/" rel="nofollow">OVMF-svn</a>, build an install it.</p><p>Then launch qemu like this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -device vfio-pci,host=07:00.0 -device vfio-pci,host=07:00.1 \ -vga none</code></pre></div></div></blockquote></div><p>Yes i&#039;m on Arch <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Well without -&quot;vga none&quot;, it at least drops me in the EFI shell now which it didn&#039;t before, so that&#039;s progress.<br />Sadly now with -&quot;vga none&quot; added again it only shows me the &quot;compat_monitor0 console&quot; again...<br />I seriously don&#039;t understand what i&#039;m missing here...</p></div></blockquote></div><p>You&#039;re supposed to get output on the monitor connected to your secondary gpu, that black console doesnt matter, make sure your hdmi/dvi cables are ok</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508950">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508955" class="blockpost rowodd"> <h2><span><span class="conr">#4405</span> <a href="viewtopic.php?pid=1508955#p1508955">2015-03-06 16:17:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>Hmm, any idea how can I share CPU between two guest, assuming that CPU load is equal to 100% on both guests and host:<br />Max allowed CPU usage for guest#1 - 40%<br />-- for guest#2 - 40%<br />-- for host - 20%</p><p>when guest#1 load is low, guest#2 is getting up to 80% of CPU usage and vice versa, host - always 20%.</p><p>Is this possible?<br />Also same thing, but with RAM.</p></div></blockquote></div><div class="quotebox"><cite>efeu wrote:</cite><blockquote><div><p>I havent that good CPU Performance in Win8.1 using -smp 8,sockets=1,cores=4,threads=2 with my 4970k@4,6GHz so I saw Pin vcpu to pcpu in first post but this site seems to be do offline.<br />Can someone help me with that?</p></div></blockquote></div><p>First get <a href="https://code.google.com/p/cpuset/" rel="nofollow">cpuset</a>, (Arch pkg: <a href="https://drive.google.com/open?id=0Bxp_MsrVrNnEdGdnM0Nad2FxYUE&amp;authuser=0" rel="nofollow">cpuset.tar.gz</a>) and set up huge pages as described <a href="https://wiki.archlinux.org/index.php/KVM#Enabling_huge_pages" rel="nofollow">here</a>, also read <a href="http://www-01.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaattunpinproctop.htm" rel="nofollow">http://www-01.ibm.com/support/knowledge … roctop.htm</a> and <a href="http://wiki.qemu.org/QMP" rel="nofollow">http://wiki.qemu.org/QMP</a> </p><br /><p>i have an 8 core amd cpu, 16GB of ram and i want to achieve something like this:</p><ul><li><p>VM1 running on cores 5-7 @ 6144MB</p></li><li><p>VM2 running on cores 2-4 @ 6144MB</p></li><li><p>I want my system task running on unused system cores @ 4GB</p></li></ul><p>Create a &quot;system&quot; cpuset running on all cores [0-7]</p><div class="codebox"><pre><code>cset set -c 0-7 -s system</code></pre></div><div class="codebox"><pre><code>cset: --&gt; created cpuset &quot;system&quot;</code></pre></div><p>Move all processes from the root cpuset to the new system cpuset</p><div class="codebox"><pre><code>cset proc -m -f root -t system</code></pre></div><div class="codebox"><pre><code>cset: moving all tasks from root to /system cset: moving 289 userspace tasks to /system [==================================================]% cset: done</code></pre></div><p>We want to launch VM1 on cores [5-7] (5,6,7)</p><p>So we modify the &quot;system&quot; cpuset and reduce our cores dedicated to systems tasks from [0-7] to [0-4]</p><div class="codebox"><pre><code>cset set -c 0-4 -s system</code></pre></div><div class="codebox"><pre><code>cset: --&gt; modified cpuset &quot;system&quot;</code></pre></div><p>Create a new cpuset called &quot;VM1&quot; for cores [5-7]</p><div class="codebox"><pre><code>cset set -c 5-7 -s VM1</code></pre></div><div class="codebox"><pre><code>cset: --&gt; created cpuset &quot;VM1&quot;</code></pre></div><p>Launch qemu, as described on <a href="http://wiki.qemu.org/QMP" rel="nofollow">http://wiki.qemu.org/QMP</a>, on cpuset &quot;VM1&quot;</p><div class="codebox"><pre><code>cset proc -s VM1 -e -- qemu-system-x86_64 -enable-kvm -cpu host -smp 3,sockets=1,cores=3,threads=1 -m 6144 -mem-path /dev/hugepages/ (...) -qmp unix:./qmp-vm1,server,nowait</code></pre></div><div class="codebox"><pre><code>cset: --&gt; last message, executed args into cpuset &quot;/VM1&quot;, new pid is: 1950</code></pre></div><p>Query the vcpu thread ids</p><div class="codebox"><pre><code>echo &quot;{ \&quot;execute\&quot;: \&quot;qmp_capabilities\&quot; }&quot; &quot;{ \&quot;execute\&quot;: \&quot;query-cpus\&quot; }&quot; | socat UNIX-CONNECT:./qmp-vm1 STDIO | awk &#039;NR&gt;1{print $1}&#039; FS=} RS=&#039;&quot;thread_id&quot;: &#039;</code></pre></div><div class="codebox"><pre><code>2039 2040 2041</code></pre></div><p>Use taskset to pin vcpu-pcpu</p><div class="codebox"><pre><code>taskset -pc 5 2039 taskset -pc 6 2040 taskset -pc 7 2041</code></pre></div><p>Once we&#039;re done with our vm we destroy our VM1 cpuset </p><div class="codebox"><pre><code>cset set -d VM1</code></pre></div><div class="codebox"><pre><code>cset: --&gt; processing cpuset &quot;VM1&quot;, moving 0 tasks to parent &quot;/&quot;... cset: --&gt; deleting cpuset &quot;/VM1&quot; cset: done</code></pre></div><p>Modify the &quot;system&quot; cpuset back to [0-7] affinity</p><div class="codebox"><pre><code>cset set -c 0-7 -s system</code></pre></div><div class="codebox"><pre><code>cset: --&gt; modified cpuset &quot;system&quot;</code></pre></div><p>Do the same for VM2</p><p>Comments? Advice?</p> <p class="postedit"><em>Last edited by nbhs (2015-03-08 02:16:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508955">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508957" class="blockpost roweven"> <h2><span><span class="conr">#4406</span> <a href="viewtopic.php?pid=1508957#p1508957">2015-03-06 16:32:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You&#039;re supposed to get output on the monitor connected to your secondary gpu, that black console doesnt matter, make sure your hdmi/dvi cables are ok</p></div></blockquote></div><p>See that explains things. I had no clue that I had to had a display connected to my GPU. I thought it would just boot in the window that popped up. I guess i&#039;ll have to get an extra monitor then...<br />I&#039;ve plugged in an left-over screen for now in the HDMI port of my GTX 770 (which is want I want to use for the passthrough).</p><p>Now it gives me the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0: vfio: Error: Failed to setup INTx fd: Device or resource busy</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508958" class="blockpost rowodd"> <h2><span><span class="conr">#4407</span> <a href="viewtopic.php?pid=1508958#p1508958">2015-03-06 16:41:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You&#039;re supposed to get output on the monitor connected to your secondary gpu, that black console doesnt matter, make sure your hdmi/dvi cables are ok</p></div></blockquote></div><p>See that explains things. I had no clue that I had to had a display connected to my GPU. I thought it would just boot in the window that popped up. I guess i&#039;ll have to get an extra monitor then...<br />I&#039;ve plugged in an left-over screen for now in the HDMI port of my GTX 770 (which is want I want to use for the passthrough).</p><p>Now it gives me the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0: vfio: Error: Failed to setup INTx fd: Device or resource busy</code></pre></div></div></blockquote></div><p><a href="https://www.youtube.com/watch?v=p85xwZ_OLX0" rel="nofollow">https://www.youtube.com/watch?v=p85xwZ_OLX0</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508958">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508960" class="blockpost roweven"> <h2><span><span class="conr">#4408</span> <a href="viewtopic.php?pid=1508960#p1508960">2015-03-06 16:55:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You&#039;re supposed to get output on the monitor connected to your secondary gpu, that black console doesnt matter, make sure your hdmi/dvi cables are ok</p></div></blockquote></div><p>See that explains things. I had no clue that I had to had a display connected to my GPU. I thought it would just boot in the window that popped up. I guess i&#039;ll have to get an extra monitor then...<br />I&#039;ve plugged in an left-over screen for now in the HDMI port of my GTX 770 (which is want I want to use for the passthrough).</p><p>Now it gives me the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0: vfio: Error: Failed to setup INTx fd: Device or resource busy</code></pre></div></div></blockquote></div><p>You cannot assign individual video output ports on your graphics cards, it&#039;s all or none, the whole card or not. Also make sure your VM isn&#039;t actually running already.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508960">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508961" class="blockpost rowodd"> <h2><span><span class="conr">#4409</span> <a href="viewtopic.php?pid=1508961#p1508961">2015-03-06 16:56:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><a href="https://www.youtube.com/watch?v=p85xwZ_OLX0" rel="nofollow">https://www.youtube.com/watch?v=p85xwZ_OLX0</a></p></div></blockquote></div><p>Lol as much as I would love that to work, it didn&#039;t...<br />After rebooting, Arch wouldn&#039;t detect my second GPU at all anymore.<br />Not with PCI (dmesg | grep pci-stub), and not with lspci.<br />Unplugged the display from the secondary GPU and rebooted, it booted fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508961">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1508975" class="blockpost roweven"> <h2><span><span class="conr">#4410</span> <a href="viewtopic.php?pid=1508975#p1508975">2015-03-06 18:28:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><a href="https://www.youtube.com/watch?v=p85xwZ_OLX0" rel="nofollow">https://www.youtube.com/watch?v=p85xwZ_OLX0</a></p></div></blockquote></div><p>Lol as much as I would love that to work, it didn&#039;t...<br />After rebooting, Arch wouldn&#039;t detect my second GPU at all anymore.<br />Not with PCI (dmesg | grep pci-stub), and not with lspci.<br />Unplugged the display from the secondary GPU and rebooted, it booted fine.</p></div></blockquote></div><p>Do you really expect us to debug your hardware issues?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1508975">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509067" class="blockpost rowodd"> <h2><span><span class="conr">#4411</span> <a href="viewtopic.php?pid=1509067#p1509067">2015-03-07 00:14:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Do you really expect us to debug your hardware issues?</p></div></blockquote></div><p>What? No, of course not! Look you guys seem to get irritated with me,&#160; and I can understand that.<br /> However that is not what I want to do.</p><p>If this is a hardware issue then sorry, I had no clue. I have a fair bit of Linux and CLI knowledge but this is completely new to me. I&#039;m have been trying to make this work for a while now, and even replaced my CPU and motherboard so they both would support VT-d... I get irritated with it not working myself too. Even though i&#039;m faced with new errors each time I have a bit of progress, i&#039;m not giving up as it is something I want to learn and have working to get rid of the dual-boot.</p><p>If you guys are not interested in helping me anymore, then please say so, I will search for solutions myself. I&#039;m really sorry for bothering you guys with all of this, but like I said before, I really really want this to work.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509067">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509073" class="blockpost roweven"> <h2><span><span class="conr">#4412</span> <a href="viewtopic.php?pid=1509073#p1509073">2015-03-07 00:37:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Do you really expect us to debug your hardware issues?</p></div></blockquote></div><p>What? No, of course not! Look you guys seem to get irritated with me,&#160; and I can understand that.<br /> However that is not what I want to do.</p><p>If this is a hardware issue then sorry, I had no clue. I have a fair bit of Linux and CLI knowledge but this is completely new to me. I&#039;m have been trying to make this work for a while now, and even replaced my CPU and motherboard so they both would support VT-d... I get irritated with it not working myself too. Even though i&#039;m faced with new errors each time I have a bit of progress, i&#039;m not giving up as it is something I want to learn and have working to get rid of the dual-boot.</p><p>If you guys are not interested in helping me anymore, then please say so, I will search for solutions myself. I&#039;m really sorry for bothering you guys with all of this, but like I said before, I really really want this to work.</p></div></blockquote></div><p>Sorry, I kind of blew a gasket at seeing that you weren&#039;t even expecting output from the graphics card itself, which is covered in the first post here and should be evident from any of the videos you can find of this working.&#160; I suggest you actually try to understand the setup rather than blindly following your interpretation of the instructions and reporting the latest failures with minimal information.&#160; If you ask informed and direct questions, I&#039;ll be happy to try to help.&#160; If you don&#039;t understand something about the setup, ask rather than pushing forward with error reports.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509073">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509155" class="blockpost rowodd"> <h2><span><span class="conr">#4413</span> <a href="viewtopic.php?pid=1509155#p1509155">2015-03-07 13:42:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89165">terusus</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-27</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89165">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>I&#039;ve seen this too (no need to patch host drivers if you&#039;re using OVMF). Sadly I have no clue how to make it work though.<br />From what I&#039;ve read you should launch Qemu with</p><div class="codebox"><pre><code>qemu-system-x86_64 -L .</code></pre></div><p>This while being in the directory where the UEFI bios.bin is in.<br />Well tried that, it did nothing, not even give me an UEFI shell.</p><p>Is there a proper guide to OVMF in Qemu out there that we can use?</p></div></blockquote></div><p>You should first check if your card supports EFI: <a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.com/2014/08/does-m … t-efi.html</a><br />And assuming you have read this tread you will understand this guide: <a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">http://vfio.blogspot.com/2014/08/primar … t-vga.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509155">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509203" class="blockpost roweven"> <h2><span><span class="conr">#4414</span> <a href="viewtopic.php?pid=1509203#p1509203">2015-03-07 16:53:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just in case anyone has the same issue, I was running Win 7 under Slackware with qemu 2.1.0 using the command line and migrated to Arch.&#160; For some reason, the VM bluescreened on a HDD error only when passing through the graphics output.&#160; Finally got it working with a change in the script. Old version:</p><div class="codebox"><pre><code>-enable-kvm -M q35 -m 8192 \ -cpu host,hv-time,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 -smp 6,sockets=1,cores=6,thre$ -bios /usr/share/qemu/bios.bin -vga none -nographic \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \ -drive file=/dev/mapper/cryptvg2-win7,id=disk,if=virtio \ -device piix4-ide,bus=pcie.0,id=piix4-ide \ -drive file=/dev/cdrom,id=cddisk -device ide-cd,bus=piix4-ide.1,drive=cddisk \ -net vde,sock=/var/run/kvm0.ctl,vlan=0 -net nic,vlan=0,macaddr=XX:XX:XX:XX:00:01,model=virtio \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -rtc base=localtime \ -monitor unix:/home/user/monitor,server,nowait</code></pre></div><p>(Note that Slackware needs the sock=/var/run/kvm0.ctl,vlan=0, omitted for Arch)</p><div class="codebox"><pre><code>-enable-kvm -rtc base=localtime \ -m 8192 -mem-path /dev/hugepages -smp 6,sockets=1,cores=6,threads=1 \ -cpu host,hv-time,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 \ -vga none -nographic \ -monitor stdio -serial none -parallel none \ -nodefconfig \ -device intel-hda -device hda-output \ -drive file=/dev/mapper/cryptvg2-win7,cache=none,if=none,id=drive0,aio=threads \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device vfio-pci,host=0000:03:00.0,multifunction=on,addr=9.0,x-vga=on \ -device vfio-pci,host=0000:03:00.1,addr=9.1 -drive file=/dev/sr0,if=none,id=drive-ide0-0-0,readonly=on,format=raw -device ide-cd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0 \ -net vde -net nic,vlan=0,macaddr=XX:XX:XX:XX:00:01,model=virtio \ -monitor unix:/home/user/monitor,server,nowait \</code></pre></div><p>The extra parameters on the lines<br />-drive file=/dev/mapper/cryptvg2-win7,cache=none,if=none,id=drive0,aio=threads \<br />-drive file=/dev/sr0,if=none,id=drive-ide0-0-0,readonly=on,format=raw -device ide-cd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0 \<br />were absolutely necessary in order to get the CD/DVD drive and the HDD working.&#160; Oddly enough the change to 440fx required a reactivation but caused no other problems... but I lost my desktop background for some reason.</p> <p class="postedit"><em>Last edited by mostlyharmless (2015-03-07 19:10:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509203">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509254" class="blockpost rowodd"> <h2><span><span class="conr">#4415</span> <a href="viewtopic.php?pid=1509254#p1509254">2015-03-07 19:35:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89361">giantegg</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:leonlagodny@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is this the right place to ask questions? I cant really get it to run.<br />no errors up until I tried to run it the first time.</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>The binding process seems to work or at least, no errors.</p><p>dmesg output:</p><div class="codebox"><pre><code>[ 0.000000] Command line: initrd=\initramfs-linux-missingacs-i915arbiter.img cryptdevice=UUID=f68cbc3f-37b1-46a1-8214-9d38bdd55453:root root=UUID=d4a843e2-ee3b-4c3e-8369-10e96f2f8b30 rootflags=subvol=BTRFSROOT/root quiet ro rw i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6798,1002:aaa0 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 [ 0.000000] Kernel command line: initrd=\initramfs-linux-missingacs-i915arbiter.img cryptdevice=UUID=f68cbc3f-37b1-46a1-8214-9d38bdd55453:root root=UUID=d4a843e2-ee3b-4c3e-8369-10e96f2f8b30 rootflags=subvol=BTRFSROOT/root quiet ro rw i915.enable_hd_vgaarb=1 pci-stub.ids=1002:6798,1002:aaa0 intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pcie_acs_override=downstream [ 0.456140] pci-stub: add 1002:6798 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.456154] pci-stub 0000:01:00.0: claimed by stub [ 0.456162] pci-stub: add 1002:AAA0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.456170] pci-stub 0000:01:00.1: claimed by stub</code></pre></div><p>Hardware is:<br />i5 3570k<br />gigabyte z77 ud3h vt-d enabled<br />sapphire 7970 ghz edition</p><p>Has anyone got this working with the same or similar hardware and/or can help?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509254">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509258" class="blockpost roweven"> <h2><span><span class="conr">#4416</span> <a href="viewtopic.php?pid=1509258#p1509258">2015-03-07 19:41:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Your cpu = Intel® Virtualization Technology for Directed I/O (VT-d) = NO</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509258">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509260" class="blockpost rowodd"> <h2><span><span class="conr">#4417</span> <a href="viewtopic.php?pid=1509260#p1509260">2015-03-07 19:45:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Your cpu = Intel® Virtualization Technology for Directed I/O (VT-d) = NO</p></div></blockquote></div><p>Yup - <a href="http://ark.intel.com/products/65520/Intel-Core-i5-3570K-Processor-6M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/65520/Int … o-3_80-GHz</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509260">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509263" class="blockpost roweven"> <h2><span><span class="conr">#4418</span> <a href="viewtopic.php?pid=1509263#p1509263">2015-03-07 19:55:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89361">giantegg</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:leonlagodny@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hmmh thanks. I thought it supported it since it was in the bios options</p><p>EDIT: can someone please tell me why the 3570 supports vt-d but the 3570k doesnt ? How does this make any sense ?</p> <p class="postedit"><em>Last edited by giantegg (2015-03-07 20:02:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509309" class="blockpost rowodd"> <h2><span><span class="conr">#4419</span> <a href="viewtopic.php?pid=1509309#p1509309">2015-03-07 22:53:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sorry, I kind of blew a gasket at seeing that you weren&#039;t even expecting output from the graphics card itself, which is covered in the first post here and should be evident from any of the videos you can find of this working.</p></div></blockquote></div><p>Well I can understand that, however I have not read this anywhere in this thread. Looking back I can still not find where it says that, but i&#039;m probably just blind. Doesn&#039;t matter anyway, I know now.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I suggest you actually try to understand the setup rather than blindly following your interpretation of the instructions and reporting the latest failures with minimal information.</p></div></blockquote></div><p>The thing is, I am trying to understand it, and i&#039;m actually understanding it more and more.<br />This is my way of learning, I can&#039;t help it...</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If you ask informed and direct questions, I&#039;ll be happy to try to help.&#160; If you don&#039;t understand something about the setup, ask rather than pushing forward with error reports.</p></div></blockquote></div><p>I actually thought I was doing this, but clearly not. Sorry for that...</p><br /><p>Anyways you&#039;ll be happy to know I finally got it working. Not sure why but it now detected the GPU properly with the monitor plugged in. In the end I didn&#039;t need to use OVMF and/or the NVIDIA driver patch.<br />So for the one that makes that spreadsheet, I run the following:<br />Host: Arch Linux 3.18.5 kernel with the ACS patch (from the first post), NVIDIA GTX 980<br />Guest: Windows 8.1, NVIDIA GTX 770<br />Motherboard: Asrock Extreme 6/ac<br />CPU: i7 4790k</p><br /><p>One last question: is there any way to share the keyboard and mouse between the guest and host? I now just passthrough the specific usb devices, and although this works, I can&#039;t do anything in my host anymore until I turn off the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509309">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509313" class="blockpost roweven"> <h2><span><span class="conr">#4420</span> <a href="viewtopic.php?pid=1509313#p1509313">2015-03-07 23:13:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sorry, I kind of blew a gasket at seeing that you weren&#039;t even expecting output from the graphics card itself, which is covered in the first post here and should be evident from any of the videos you can find of this working.</p></div></blockquote></div><p>Well I can understand that, however I have not read this anywhere in this thread. Looking back I can still not find where it says that, but i&#039;m probably just blind. Doesn&#039;t matter anyway, I know now.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I suggest you actually try to understand the setup rather than blindly following your interpretation of the instructions and reporting the latest failures with minimal information.</p></div></blockquote></div><p>The thing is, I am trying to understand it, and i&#039;m actually understanding it more and more.<br />This is my way of learning, I can&#039;t help it...</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If you ask informed and direct questions, I&#039;ll be happy to try to help.&#160; If you don&#039;t understand something about the setup, ask rather than pushing forward with error reports.</p></div></blockquote></div><p>I actually thought I was doing this, but clearly not. Sorry for that...</p><br /><p>Anyways you&#039;ll be happy to know I finally got it working. Not sure why but it now detected the GPU properly with the monitor plugged in. In the end I didn&#039;t need to use OVMF and/or the NVIDIA driver patch.<br />So for the one that makes that spreadsheet, I run the following:<br />Host: Arch Linux 3.18.5 kernel with the ACS patch (from the first post), NVIDIA GTX 980<br />Guest: Windows 8.1, NVIDIA GTX 770<br />Motherboard: Asrock Extreme 6/ac<br />CPU: i7 4790k</p><br /><p>One last question: is there any way to share the keyboard and mouse between the guest and host? I now just passthrough the specific usb devices, and although this works, I can&#039;t do anything in my host anymore until I turn off the VM.</p></div></blockquote></div><br /><p>Try <a href="http://synergy-project.org/" rel="nofollow">Synergy</a>, alternatively you could passthrough one of your usb controllers,&#160; my Case has 2 frontal usb3 ports, and 2 usb2 ports, so i passthrough the usb3 controller to windows and i switch my KB/M by changing the ports they&#039;re connected to</p> <p class="postedit"><em>Last edited by nbhs (2015-03-07 23:13:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509313">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509319" class="blockpost rowodd"> <h2><span><span class="conr">#4421</span> <a href="viewtopic.php?pid=1509319#p1509319">2015-03-07 23:49:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try <a href="http://synergy-project.org/" rel="nofollow">Synergy</a>, alternatively you could passthrough one of your usb controllers,&#160; my Case has 2 frontal usb3 ports, and 2 usb2 ports, so i passthrough the usb3 controller to windows and i switch my KB/M by changing the ports they&#039;re connected to</p></div></blockquote></div><p>Well i&#039;m not going to pay for Synergy as good as it may be.<br />But your other solution is actually pretty smart, i&#039;m going to use that. Thanks for all your help guys!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509319">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509320" class="blockpost roweven"> <h2><span><span class="conr">#4422</span> <a href="viewtopic.php?pid=1509320#p1509320">2015-03-07 23:53:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try <a href="http://synergy-project.org/" rel="nofollow">Synergy</a>, alternatively you could passthrough one of your usb controllers,&#160; my Case has 2 frontal usb3 ports, and 2 usb2 ports, so i passthrough the usb3 controller to windows and i switch my KB/M by changing the ports they&#039;re connected to</p></div></blockquote></div><p>Well i&#039;m not going to pay for Synergy as good as it may be.<br />But your other solution is actually pretty smart, i&#039;m going to use that. Thanks for all your help guys!</p></div></blockquote></div><p>Synergy is free and libre afaik</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509320">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509321" class="blockpost rowodd"> <h2><span><span class="conr">#4423</span> <a href="viewtopic.php?pid=1509321#p1509321">2015-03-07 23:55:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84480">blu3bird</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-20</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84480">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Specifying a CPU topology with threads is generally only recommended in combination with pinning.&#160; Using 100% of the host CPU resources for a guest is also likely to cause glitches when the host needs some CPU resources.&#160; There&#039;s plenty of information online for vCPU pinning.&#160; libvirt can do this for you and is detailed on their site.</p></div></blockquote></div><p>Could you elaborate on that? I always assumed the point of cpu pinning was to reserve/restrict cpu usage, regardless of topology. For example to preventing a test vm from stealing resources from a production vm.</p><p>The reason I&#039;m asking is that I&#039;m also using threads without pinning. When I first tried kvm with vfio I did some benchmarks(cinebench) and threads=8,cores=1,sockets=1 gave me the best results for a quad-core cpu with ht.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509325" class="blockpost roweven"> <h2><span><span class="conr">#4424</span> <a href="viewtopic.php?pid=1509325#p1509325">2015-03-07 23:58:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try <a href="http://synergy-project.org/" rel="nofollow">Synergy</a>, alternatively you could passthrough one of your usb controllers,&#160; my Case has 2 frontal usb3 ports, and 2 usb2 ports, so i passthrough the usb3 controller to windows and i switch my KB/M by changing the ports they&#039;re connected to</p></div></blockquote></div><p>Well i&#039;m not going to pay for Synergy as good as it may be.<br />But your other solution is actually pretty smart, i&#039;m going to use that. Thanks for all your help guys!</p></div></blockquote></div><p>Synergy is free and libre afaik</p></div></blockquote></div><p>It changed recently, you can still get the source and build it yourself, or $10 for lifetime access to binaries.&#160; Worth it, IMHO.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509325">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1509330" class="blockpost rowodd"> <h2><span><span class="conr">#4425</span> <a href="viewtopic.php?pid=1509330#p1509330">2015-03-08 00:15:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blu3bird wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Specifying a CPU topology with threads is generally only recommended in combination with pinning.&#160; Using 100% of the host CPU resources for a guest is also likely to cause glitches when the host needs some CPU resources.&#160; There&#039;s plenty of information online for vCPU pinning.&#160; libvirt can do this for you and is detailed on their site.</p></div></blockquote></div><p>Could you elaborate on that? I always assumed the point of cpu pinning was to reserve/restrict cpu usage, regardless of topology. For example to preventing a test vm from stealing resources from a production vm.</p><p>The reason I&#039;m asking is that I&#039;m also using threads without pinning. When I first tried kvm with vfio I did some benchmarks(cinebench) and threads=8,cores=1,sockets=1 gave me the best results for a quad-core cpu with ht.</p></div></blockquote></div><p>Here&#039;s an article i found very interesting <a href="http://www-01.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaattunpinprocs.htm" rel="nofollow">http://www-01.ibm.com/support/knowledge … nprocs.htm</a>, to restrict or reserve cpu usage i believe you need something like cgroups, see my <a href="https://bbs.archlinux.org/viewtopic.php?pid=1508955#p1508955" rel="nofollow">previous post</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1509330">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=176">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=175">175</a> <a href="viewtopic.php?id=162768&amp;p=176">176</a> <strong>177</strong> <a href="viewtopic.php?id=162768&amp;p=178">178</a> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=178">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
