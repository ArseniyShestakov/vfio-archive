<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 165) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=165" title="Page 165" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=164" title="Page 164" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=166" title="Page 166" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=164">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <strong>165</strong> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=166">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1500452" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4101</span> <a href="viewtopic.php?pid=1500452#p1500452">2015-02-06 19:01:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88601">venim1103</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88601">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone tried using Oculus Rift (dk1 or 2) with any of the GPU passtrough setups? I&#039;m not sure how that device works exactly as if it only uses HDMI for communication and all the processing happens inside the GPU, I guess it&#039;s possible?</p><p>I just wanted to know if anyone has any experience or knowledge about this subject as I&#039;m really interested in all this vga passtrough stuff and virtual reality (but I don&#039;t have the equipment to test out yet).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500452">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500512" class="blockpost roweven"> <h2><span><span class="conr">#4102</span> <a href="viewtopic.php?pid=1500512#p1500512">2015-02-06 23:46:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71974">TcShadowWalker</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-04</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71974">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey,</p><p>I&#039;ve got VGA passthrough running with a windows 7 64 bit guest VM.<br />Apart from the PCI device, I&#039;m passing through three drives using virtio:</p><div class="codebox"><pre><code>-drive file=/home/janphilip/VMs/Win7.img,id=disk0,if=virtio,format=raw -drive file=/dev/disk/by-label/Drive1,id=disk1,if=virtio,format=raw -drive file=/dev/disk/by-label/Drive2_SSD,id=disk2,if=virtio,format=raw</code></pre></div><p>Everything works; However Windows messes up the device order.<br />The Win7.img contains the windows system partition; this one is always named &quot;C:&quot;.<br />Unfortunately, sometimes Drive1 ist called &quot;E:&quot; and Drive2_SSD &quot;F:&quot;, and after a reboot it&#039;s the other way around.</p><p>Windows offers a feature to assign drive letters in the control panel.<br />However, even these are not persistent; After a reboot, the guest acts as if it had never seen that disk before.</p><p>Did anyone else encounter this problem of non-persistent drive letters or has any suggestions?<br />I tried googling, but couldn&#039;t find anyone having the same problem. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500512">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500586" class="blockpost rowodd"> <h2><span><span class="conr">#4103</span> <a href="viewtopic.php?pid=1500586#p1500586">2015-02-07 10:47:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84538">mauorrizze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-22</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84538">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>If anyone wants to try combining Windows 7 with OVMF again:<br />Latest qemu git seems to enable hv_time by default, so at least I had to disable it explicitly (and un-enable all other hyper-v options). Apart from that all I had to do is create a UEFI-bootable Win7 USB drive to install from.</p><p>Also, I can confirm that <strong>cpu pinning</strong> does really help in combination with the kernel boot options <strong>isolcpus=[cpus, eg. 2-7]</strong> and <strong>nohz_full=[cpus]</strong>.<br />For the first time I could listen to music (via USB DAC connected to a passed-through USB-controller) continously in Windows 8, while both host and guest have quite a bit of cpu load (tested with prime95/mprime). <br />So thanks for that information!</p><p>Still, using <a href="http://www.resplendence.com/latencymon" rel="nofollow">http://www.resplendence.com/latencymon</a> results in a frozen guest, everytime. I thought Windows 7 was less sensitive in that matter but the latest test proved otherwise. Gonna stay with 8 and 10 as guests.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500586">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500625" class="blockpost roweven"> <h2><span><span class="conr">#4104</span> <a href="viewtopic.php?pid=1500625#p1500625">2015-02-07 13:56:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mauorrizze wrote:</cite><blockquote><div><p>If anyone wants to try combining Windows 7 with OVMF again:<br />Latest qemu git seems to enable hv_time by default, so at least I had to disable it explicitly (and un-enable all other hyper-v options). Apart from that all I had to do is create a UEFI-bootable Win7 USB drive to install from.</p><p>Also, I can confirm that <strong>cpu pinning</strong> does really help in combination with the kernel boot options <strong>isolcpus=[cpus, eg. 2-7]</strong> and <strong>nohz_full=[cpus]</strong>.<br />For the first time I could listen to music (via USB DAC connected to a passed-through USB-controller) continously in Windows 8, while both host and guest have quite a bit of cpu load (tested with prime95/mprime). <br />So thanks for that information!</p><p>Still, using <a href="http://www.resplendence.com/latencymon" rel="nofollow">http://www.resplendence.com/latencymon</a> results in a frozen guest, everytime. I thought Windows 7 was less sensitive in that matter but the latest test proved otherwise. Gonna stay with 8 and 10 as guests.</p></div></blockquote></div><br /><p>Wait, you got win7 booting in UEFI? And you have NVidia...<br />Something hints me that my GPUs have broken GOP for win7...<br />Time to dig the vbios again...</p> <p class="postedit"><em>Last edited by Duelist (2015-02-07 13:58:23)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500625">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500647" class="blockpost rowodd"> <h2><span><span class="conr">#4105</span> <a href="viewtopic.php?pid=1500647#p1500647">2015-02-07 15:08:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88627">Lederstrumpf</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-07</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone, </p><p>I&#039;ve been pushing to get GPU passthrough working for a while using the great info found in this forum and elsewhere, but have so far not been able to get past this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 6,sockets=1,cores=6,threads=1 -vga none -device vfio-pci,host=06:00.0,x-vga=on -device vfio-pci,host=06:00.1 qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I first suspected it might be openSuSE, but I subsequently installed Arch and compiled the kernel as provided by nbhs with all the following instructions, yielding the same result.</p><p>My system config:</p><p><strong>Motherboard</strong> HP ProLiant SE316M1<br /><strong>CPU</strong> 2 x Xeon X5650<br /><strong>Memory</strong> 24GB ECC DDR3 RAM<br /><strong>Primary GPU</strong> Nvidia 8800GT<br /><strong>Secondary GPU</strong> ATI R9 290X<br /><strong>Storage A</strong> Crucial 240GB SSD<br /><strong>Storage B</strong> Seagate 500GB HDD</p><p>A lot of digging led to the discovery that the 5520 chipset revision 0x13 has issues with interrupt remapping and is therefore disabled by the kernel.<br /><a href="http://www.intel.co.uk/content/dam/doc/specification-update/5520-and-5500-chipset-ioh-specification-update.pdf" rel="nofollow">http://www.intel.co.uk/content/dam/doc/ … update.pdf</a> (Errata 47 &amp; 53)</p><div class="codebox"><pre><code>[ 0.025776] This system BIOS has enabled interrupt remapping on a chipset that contains an erratum making that feature unstable. To maintain system stability interrupt remapping is being disabled. Please contact your BIOS vendor for an update </code></pre></div><p>Output of dmesg | grep -e DMAR -e IOMMU</p><div class="codebox"><pre><code>[ 0.000000] ACPI: DMAR 0x00000000AF632E80 000136 (v01 HP ProLiant 00000001 \xffffffd2? 0000162E) [ 0.000000] Intel-IOMMU: enabled [ 0.025667] dmar: IOMMU 0: reg_base_addr b7ffe000 ver 1:0 cap c90780106f0462 ecap f0207e </code></pre></div><p>For testing, I subsequently commented lines 212-213 in arch/x86/kernel/early-quirks.c to bypass disabling interrupt remapping.<br />New output of dmesg | grep -e DMAR -e IOMMU</p><div class="codebox"><pre><code>[ 0.000000] ACPI: DMAR 0x00000000AF632E80 000136 (v01 HP ProLiant 00000001 \xffffffd2? 0000162E) [ 0.000000] Intel-IOMMU: enabled [ 0.025667] dmar: IOMMU 0: reg_base_addr b7ffe000 ver 1:0 cap c90780106f0462 ecap f0207e [ 0.025772] IOAPIC id 8 under DRHD base 0xb7ffe000 IOMMU 0 [ 0.025774] IOAPIC id 0 under DRHD base 0xb7ffe000 IOMMU 0</code></pre></div><p>However, my qemu output remains the same, and &quot;find /sys/kernel/iommu_groups/ -type l&quot; still returns nothing.</p><p><a href="http://pastebin.com/2Hg0EEVh" rel="nofollow">Full output of dmesg</a><br /><a href="http://pastebin.com/cpDVkvHj" rel="nofollow">Full output of lspci</a></p><p>Before I proceed further, I wanted to check whether anyone has gotten GPU passthrough to work with the 5520 chipset and said revision, or whether this has been ruled impossible/unusable.<br />From the snippets I gathered across forums, it seems that the interrupt remapping does work, but can lead to system lockups at times, which is why it is prudently disabled. <br />My servers will not be used for commercial purposes, so stability is not the greatest concern.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500647">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500659" class="blockpost roweven"> <h2><span><span class="conr">#4106</span> <a href="viewtopic.php?pid=1500659#p1500659">2015-02-07 15:37:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lederstrumpf wrote:</cite><blockquote><div><p>Hi everyone, </p><p>I&#039;ve been pushing to get GPU passthrough working for a while using the great info found in this forum and elsewhere, but have so far not been able to get past this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host -smp 6,sockets=1,cores=6,threads=1 -vga none -device vfio-pci,host=06:00.0,x-vga=on -device vfio-pci,host=06:00.1 qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=06:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div></div></blockquote></div><p>Interrupt remapping is not the problem, VT-d is broken on your system and not being enabled for DMA:</p><div class="codebox"><pre><code>[ 0.960573] dmar: Device scope type does not match for 0000:00:14.0 [ 0.960576] dmar: Device scope type does not match for 0000:00:14.1 [ 0.960578] dmar: Device scope type does not match for 0000:00:14.2 [ 0.960621] PCI-DMA: Using software bounce buffering for IO (SWIOTLB)</code></pre></div><p>Check for a BIOS update for the system</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500777" class="blockpost rowodd"> <h2><span><span class="conr">#4107</span> <a href="viewtopic.php?pid=1500777#p1500777">2015-02-07 22:14:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84538">mauorrizze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-22</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84538">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Wait, you got win7 booting in UEFI? And you have NVidia...<br />Something hints me that my GPUs have broken GOP for win7...<br />Time to dig the vbios again...</p></div></blockquote></div><p>I&#039;m sorry but it seems all I&#039;ve accomplished was to find another reason why win7 + ovmf won&#039;t hamonize. As I struggled getting it to boot at all, I haven&#039;t had tested if the nvidia worked. I&quot;ve catched up on that and nope, doesn&#039;t work for me either.<br />To summarize the installation procedure:<br />- prepare Win7 UEFI medium (google for USB UEFI Win7, use diskpart and copy a bootx64.efi to EFI/boot/)<br />- generate xml for libvirt by virt-manager (Windows 7)<br />- add uefi-bits<br />==&gt; won&#039;t install (when boot animation should appear, it freezes with 1 cpu @ 100%)<br />- redhat bug report suggests that smp (&gt;=2) + hv-time is responsible, but using only 1 core and disabling hypervclock timer in xml didn&#039;t help<br />- remove everything hyperv-related, <strong>activly</strong> disable hv-time via &lt;qemu:arg value=&#039;-cpu&#039;/&gt;&lt;qemu:arg value=&#039;host,hv_time=off&#039;/&gt;<br />==&gt; will install and afterwards boot <strong>sometimes</strong> (or switches off instead of boot animation without noticable dmesg errors - if you see the 4 dots appear instead, it should boot fine)<br />- add nvidia card, install drivers<br />- remove default qxl graphics<br />- if nvidia drivers installed: image freezes at the last part of the boot animation, system seems to act normal otherwise (sound etc.)<br />- without nvidia drivers: hangs during boot, in secure mode @classpnp.sys </p><p>All in all, win7 + ovmf works <strong>theoretically</strong>, in my experiences it&#039;s broken at the moment, because of timing problems (hv_time-related) and nvidia card doesn&#039;t work.<br />As in contradiction to my own memory, interrupt handling (usb audio, latency) is as bad as with newer windows, so I have no reason to try any further. I still have student win8 keys and the Win10-experience after one day (same xml as Win8) is quite good!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500777">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500805" class="blockpost roweven"> <h2><span><span class="conr">#4108</span> <a href="viewtopic.php?pid=1500805#p1500805">2015-02-07 23:37:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88640">Tim_J</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone,</p><p>I have a Debian machine with 3 NVIDIA cards: two GTX 580s (EVGA Hydro Copper 2 FTW) and a 210 GT. I&#039;m trying to get VGA passthrough working with Windows 7 in QEMU.</p><p>The 580s are on 0000:01:00.0/0000:01:00.1 and 0000:03:00.0/0000:03:00.1, and the 210 is on 0000:04:00.0/0000:04:00.1. My ultimate goal is to passthrough both 580s while using the 210 for the host.</p><p>I can get VGA passthrough working fine with the 580 card on 03 or with the 210 on 04, but not the 580 on 01. When I attempt to do so, the QEMU machine never reaches SeaBIOS and it uses 100% CPU on one core (this is the same behavior as if the GPU ROM is invalid).</p><p>I think that this might have something to do with the host BIOS claiming the card in some way. With both 01 and 03 stubbed and 04 used by nouveau, there is interesting behavior on boot. The host BIOS appears on the monitor connected to the 01 580, and the text remains on the screen after the OS boots (with the initial dmesg output and a flashing cursor). Despite this, Debian shows that the card has been claimed by pci-stub and later by vfio. When I attempt to start QEMU with the card, the physical monitor connected to it goes blank and loses signal, never to return. The VM locks up as mentioned earlier. As I wrote before, if I do this exact same process with the 580 in port 03, all works well (it has no physical monitors attached). If I boot with no physical monitors attached to the 01 580, it still does not work.</p><p>My host BIOS has no way to change the primary adapter.</p><p>Does anyone have any thoughts about this issue? Sorry if this has been covered before -- this thread is getting a bit unwieldy <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500805">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500838" class="blockpost rowodd"> <h2><span><span class="conr">#4109</span> <a href="viewtopic.php?pid=1500838#p1500838">2015-02-08 02:21:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84538">mauorrizze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-22</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84538">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tim_J wrote:</cite><blockquote><div><p>Does anyone have any thoughts about this issue?</p></div></blockquote></div><p>The Mainboard BIOS/UEFI really musn&#039;t initialize any of the cards you want to pass through.<br />Try to swap the PCIe slots. Put the 210 in the first slot and the 580 in the lower ones. Downside might be that the 580 get less PCIe bandwidth, but if the mainboard doesn&#039;t offer any software setting to choose its primary card it might be the only way. There is no onboard GPU that could become primary? Or change your mainboard as a last resort, recommendations within this thread are Gigabyte boards, but I have no experiences myself.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500838">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500840" class="blockpost roweven"> <h2><span><span class="conr">#4110</span> <a href="viewtopic.php?pid=1500840#p1500840">2015-02-08 02:34:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88640">Tim_J</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mauorrizze wrote:</cite><blockquote><div><p>Try to swap the PCIe slots. Put the 210 in the first slot and the 580 in the lower ones.</p></div></blockquote></div><p>Ok, I assumed that this would work but I wanted to know if there was a software fix before going this route. Moving the cards to other PCIe slots will require draining the system and then refilling, which is a process that I&#039;d like to avoid if possible. <img src="https://bbs.archlinux.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /></p><p>The motherboard is an ASUS Rampage IV Extreme, which does not come with any onboard GPU (the rationale being that this board is meant to appeal to gamers who will have dedicated GPUs anyway). As you suspect, only the first PCIe slot is x16 while the others are x8, but I&#039;m pretty sure these cards aren&#039;t using x16 right now in Windows anyway. I&#039;ve checked the BIOS several times and I am quite certain there is no option for changing the primary adapter.</p><p>Sounds like it is time to go get the bucket and hose... <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500840">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500877" class="blockpost rowodd"> <h2><span><span class="conr">#4111</span> <a href="viewtopic.php?pid=1500877#p1500877">2015-02-08 06:51:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79899">winie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-01</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:alireza4051@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tim_J wrote:</cite><blockquote><div><p>Ok, I assumed that this would work but I wanted to know if there was a software fix before going this route. Moving the cards to other PCIe slots will require draining the system and then refilling, which is a process that I&#039;d like to avoid if possible. <img src="https://bbs.archlinux.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /></p></div></blockquote></div><p>The only other way is if there is an option in bios setup to change the primary gpu and set it to the slot where the 210 is.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500877">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500923" class="blockpost roweven"> <h2><span><span class="conr">#4112</span> <a href="viewtopic.php?pid=1500923#p1500923">2015-02-08 11:44:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mauorrizze wrote:</cite><blockquote><div><div class="quotebox"><cite>Tim_J wrote:</cite><blockquote><div><p>Does anyone have any thoughts about this issue?</p></div></blockquote></div><p>The Mainboard BIOS/UEFI really musn&#039;t initialize any of the cards you want to pass through.</p></div></blockquote></div><p>This is not true (in my case both Intel and AMD are initialized; furthermore, UEFI settings are accessible only using AMD card, no output on Intel). You can&#039;t let their video driver to initialize on specific devices you want to pass.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500923">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501071" class="blockpost rowodd"> <h2><span><span class="conr">#4113</span> <a href="viewtopic.php?pid=1501071#p1501071">2015-02-08 19:58:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tim_J wrote:</cite><blockquote><div><p>The 580s are on 0000:01:00.0/0000:01:00.1 and 0000:03:00.0/0000:03:00.1, and the 210 is on 0000:04:00.0/0000:04:00.1. My ultimate goal is to passthrough both 580s while using the 210 for the host.</p><p>I can get VGA passthrough working fine with the 580 card on 03 or with the 210 on 04, but not the 580 on 01. When I attempt to do so, the QEMU machine never reaches SeaBIOS and it uses 100% CPU on one core (this is the same behavior as if the GPU ROM is invalid).</p><p>I think that this might have something to do with the host BIOS claiming the card in some way. With both 01 and 03 stubbed and 04 used by nouveau, there is interesting behavior on boot. The host BIOS appears on the monitor connected to the 01 580, and the text remains on the screen after the OS boots (with the initial dmesg output and a flashing cursor). Despite this, Debian shows that the card has been claimed by pci-stub and later by vfio. When I attempt to start QEMU with the card, the physical monitor connected to it goes blank and loses signal, never to return. The VM locks up as mentioned earlier. As I wrote before, if I do this exact same process with the 580 in port 03, all works well (it has no physical monitors attached). If I boot with no physical monitors attached to the 01 580, it still does not work.</p><p>My host BIOS has no way to change the primary adapter.</p><p>Does anyone have any thoughts about this issue? Sorry if this has been covered before -- this thread is getting a bit unwieldy <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p></div></blockquote></div><p>Well..<br />Let me tell you my story:</p><p>I have ASUS F2A55(so i can&#039;t really change my primary gpu) HD7750 in PCI-E x16 first slot(01:00.[0-1]), HD7750 in PCI-E x8 second slot(02:00.[0-1]), AND GT610 in PCI-E x1 zero(the top one) slot(it gets mapped as 04:00.[0-1] when both AMDs are plugged).<br />And i&#039;ve got a signal out of every card connected that way:<br />01:00.0 - DVI 1st screen;<br />02:00.0 - D-SUB 1st screen;<br />04:00.0 - D-SUB 2nd screen.</p><p>So, what i get:<br />1. BIOS/UEFI setup menus and PCI Option ROMs get shown via 01:00.0 on the first screen AND i can&#039;t change it. That is normal.<br />2. Linux VTs are getting shown on 01:00.0 AND i can&#039;t change it. That is normal since it&#039;s using legacy VGA ports.<br />3. 01:00.0 and 02:00.0 are bound to pci-stub via kernel command line. And as the host boots - they get bound to vfio-pci by a simple script.<br />4. If there&#039;s another VT(like X) is activated - 1st will screen remain powered on, but empty. 02:00.0 is sleeping and not showing anything. It might not get cleared, AFAIR it depends on the distro. But if it isn&#039;t cleared - that&#039;s normal, VM boot up will clear it by resetting the device.<br />5. My distro(fedora) had plymouth installed, you have to <strong>check /proc/iomem for something like vesafb appearing on 01:00.0.</strong> Uninstalling plymouth and disabling KMS(kernel mode setting) via kernel command line helped, but i no longer have fancy console or a splash screen. Otherwise it won&#039;t work when booting the VM - check my very first posts for details.<br />6. I&#039;m using proprietary NVIDIA driver, and it has a neat option in xorg.conf available(actually, it will crash without it on my system):</p><div class="codebox"><pre><code>Section &quot;Device&quot; Identifier &quot;Device0&quot; Driver &quot;nvidia&quot; VendorName &quot;NVIDIA Corporation&quot; BoardName &quot;GeForce GT 610&quot; BusID &quot;PCI:04:00:00&quot; EndSection</code></pre></div><p><strong>BusID</strong>. That option clearly specifies which device nvidia driver should poke.</p><p>And now about your problems:<br />1. Give us your dmesg as the VM boots. Maybe there&#039;s something useful there.<br />2. You want to use nouveau, that&#039;s fine, but i don&#039;t know if there&#039;s BusID option available.<br />3. You&#039;re using nvidia host+nvidia guest. There was an ISSUES section in the op-post, but nbhs deleted it for some reason. I&#039;ve tried to remember why the hell and how i&#039;ve patched host nvidia drivers, but failed. I remember that there was something related to vgaarb. <strong>To nbhs:</strong>can you please bring that section back?</p><p>P.S.<br />Oh, and BTW, you might have some issues with pci-e bandwidth, like i have 02:00.[0-1] running on pci-e 2.0 x<strong>4</strong> (when 04:00.[0-1] is plugged in) while physically it&#039;s x8. That depends on the motherboard and pci-e controller design(i have athlon x4 750k and it works that weird way).<br />Since you&#039;re doing SLI(right?) - there shouldn&#039;t be any performance drawbacks(the cards are connected via an external bridge), but for me - this is an issue, my crossfire runs via XDMA.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501071">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501078" class="blockpost roweven"> <h2><span><span class="conr">#4114</span> <a href="viewtopic.php?pid=1501078#p1501078">2015-02-08 20:22:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>2. You want to use nouveau, that&#039;s fine, but i don&#039;t know if there&#039;s BusID option available.</p></div></blockquote></div><p>BusID is not nvidia specific, it should work for all drivers afaik.</p><div class="quotebox"><blockquote><div><p>3. You&#039;re using nvidia host+nvidia guest. There was an ISSUES section in the op-post, but nbhs deleted it for some reason. I&#039;ve tried to remember why the hell and how i&#039;ve patched host nvidia drivers, but failed. I remember that there was something related to vgaarb. <strong>To nbhs:</strong>can you please bring that section back?</p></div></blockquote></div><p>The issue was that using the proprietary nvidia driver on the host would take the vga arbiter lock and never release it.&#160; This would make the guest hang on its first VGA region access as it waits on a lock that will never be released.&#160; Maybe nvidia has fixed this in their driver now?</p> <p class="postedit"><em>Last edited by aw (2015-02-08 20:34:32)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501078">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501085" class="blockpost rowodd"> <h2><span><span class="conr">#4115</span> <a href="viewtopic.php?pid=1501085#p1501085">2015-02-08 20:33:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>3. You&#039;re using nvidia host+nvidia guest. There was an ISSUES section in the op-post, but nbhs deleted it for some reason. I&#039;ve tried to remember why the hell and how i&#039;ve patched host nvidia drivers, but failed. I remember that there was something related to vgaarb. <strong>To nbhs:</strong>can you please bring that section back?</p></div></blockquote></div><p>Im using an nvidia gpu on my host, and i havent had that problem in a long time now, but yes why not.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501085">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501100" class="blockpost roweven"> <h2><span><span class="conr">#4116</span> <a href="viewtopic.php?pid=1501100#p1501100">2015-02-08 21:33:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>BusID is not nvidia specific, it should work for all drivers afaik.</p></div></blockquote></div><p>If that&#039;s so - awesome. I recall seeing it in nvidia&#039;s docs somewhere.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The issue was that using the proprietary nvidia driver on the host would take the vga arbiter lock and never release it.&#160; This would make the guest hang on its first VGA region access as it waits on a lock that will never be released.&#160; Maybe nvidia has fixed this in their driver now?</p></div></blockquote></div><p>Well... yyeah, they&#039;ve fixed it. I&#039;ve had to patch 343.22, but it&#039;s </p><div class="codebox"><pre><code>[ 3.573430] vgaarb: device changed decodes: PCI:0000:03:00.0,olddecodes=io+mem,decodes=none:owns=none</code></pre></div><p>like that on 346.35.</p><p>Whatever, that&#039;s not the problem - i&#039;ve just shared my experience with non-primary-VGA being used with VFIO. I hope he didn&#039;t drain his system yet.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501100">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501105" class="blockpost rowodd"> <h2><span><span class="conr">#4117</span> <a href="viewtopic.php?pid=1501105#p1501105">2015-02-08 21:40:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88640">Tim_J</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>5. My distro(fedora) had plymouth installed, you have to check /proc/iomem for something like vesafb appearing on 01:00.0.</p></div></blockquote></div><p>I don&#039;t see anything like that. Here&#039;s my /proc/iomem:</p><div class="codebox"><pre class="vscroll"><code>00000000-00000fff : reserved 00001000-0009e7ff : System RAM 0009e800-0009ffff : reserved 000a0000-000bffff : PCI Bus 0000:00 000c0000-000dffff : PCI Bus 0000:00 000c0000-000c7fff : Video ROM 000e0000-000fffff : reserved 000f0000-000fffff : System ROM 00100000-9beb8fff : System RAM 01000000-015124cf : Kernel code 015124d0-018eb8ff : Kernel data 01a1f000-01af0fff : Kernel bss 9beb9000-9c49ffff : reserved 9c4a0000-9c5adfff : ACPI Tables 9c5ae000-9c7d4fff : ACPI Non-volatile Storage 9c7d5000-9d74afff : reserved 9d74b000-9d74bfff : System RAM 9d74c000-9d7d1fff : ACPI Non-volatile Storage 9d7d2000-9dc11fff : System RAM 9dc12000-9dff3fff : reserved 9dff4000-9dffffff : System RAM 9e000000-9fffffff : RAM buffer a0000000-ffffffff : PCI Bus 0000:00 a0000000-b1ffffff : PCI Bus 0000:04 a0000000-afffffff : 0000:04:00.0 b0000000-b1ffffff : 0000:04:00.0 b8000000-c1ffffff : PCI Bus 0000:03 b8000000-bfffffff : 0000:03:00.0 c0000000-c1ffffff : 0000:03:00.0 c8000000-d1ffffff : PCI Bus 0000:01 c8000000-cfffffff : 0000:01:00.0 d0000000-d1ffffff : 0000:01:00.0 e0000000-efffffff : PCI MMCONFIG 0000 [bus 00-ff] e0000000-efffffff : reserved f6000000-f70fffff : PCI Bus 0000:04 f6000000-f6ffffff : 0000:04:00.0 f7000000-f707ffff : 0000:04:00.0 f7080000-f7083fff : 0000:04:00.1 f7080000-f7083fff : ICH HD audio f7100000-f711ffff : 0000:00:19.0 f7100000-f711ffff : e1000e f7120000-f7123fff : 0000:00:1b.0 f7120000-f7123fff : ICH HD audio f7124000-f71240ff : 0000:00:1f.3 f7125000-f71257ff : 0000:00:1f.2 f7125000-f71257ff : ahci f7126000-f71263ff : 0000:00:1d.0 f7126000-f71263ff : ehci_hcd f7127000-f71273ff : 0000:00:1a.0 f7127000-f71273ff : ehci_hcd f7128000-f7128fff : 0000:00:19.0 f7128000-f7128fff : e1000e f7129000-f712900f : 0000:00:16.0 f7129000-f712900f : mei_me f712a000-f712afff : 0000:00:05.4 f8000000-f90fffff : PCI Bus 0000:03 f8000000-f8ffffff : 0000:03:00.0 f9000000-f907ffff : 0000:03:00.0 f9080000-f9083fff : 0000:03:00.1 fa000000-fb0fffff : PCI Bus 0000:01 fa000000-faffffff : 0000:01:00.0 fb000000-fb07ffff : 0000:01:00.0 fb080000-fb083fff : 0000:01:00.1 fb200000-fb2fffff : PCI Bus 0000:0c fb200000-fb2001ff : 0000:0c:00.0 fb200000-fb2001ff : ahci fb300000-fb3fffff : PCI Bus 0000:0b fb300000-fb3001ff : 0000:0b:00.0 fb300000-fb3001ff : ahci fb400000-fb4fffff : PCI Bus 0000:0a fb400000-fb407fff : 0000:0a:00.0 fb400000-fb407fff : xhci_hcd fb500000-fb5fffff : PCI Bus 0000:09 fb500000-fb507fff : 0000:09:00.0 fb500000-fb507fff : xhci_hcd fb600000-fb6fffff : PCI Bus 0000:08 fb600000-fb607fff : 0000:08:00.0 fb600000-fb607fff : xhci_hcd fb700000-fb7fffff : PCI Bus 0000:07 fb700000-fb707fff : 0000:07:00.0 fb700000-fb707fff : xhci_hcd fbffc000-fbffcfff : dmar0 fc000000-fcffffff : pnp 00:00 fd000000-fdffffff : pnp 00:00 fe000000-feafffff : pnp 00:00 feb00000-febfffff : pnp 00:00 fec00000-fec003ff : IOAPIC 0 fec01000-fec013ff : IOAPIC 1 fed00000-fed003ff : HPET 0 fed00000-fed003ff : PNP0103:00 fed1c000-fed1ffff : reserved fed1c000-fed1ffff : pnp 00:05 fed1f410-fed1f414 : iTCO_wdt fed1f410-fed1f414 : iTCO_wdt fed45000-fedfffff : pnp 00:00 fee00000-feefffff : pnp 00:00 fee00000-fee00fff : Local APIC ff000000-ffffffff : reserved ff000000-ffffffff : pnp 00:05 100000000-65fffffff : System RAM</code></pre></div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>1. Give us your dmesg as the VM boots. Maybe there&#039;s something useful there.</p></div></blockquote></div><p>After booting, 01 and 03 are bound to pci-stub. I run a script to rebind them to vfio, and this is the only addition to dmesg:</p><div class="codebox"><pre><code>VFIO - User Level meta-driver version: 0.3</code></pre></div><p>When I attempt to start the VM, no new messages are written.</p><p>Here&#039;s an excerpt of my entire dmesg log, from boot to running the VM:</p><div class="codebox"><pre class="vscroll"><code>... [ 0.000000] Linux version 3.16.0-4-amd64 (debian-kernel@lists.debian.org) (gcc version 4.8.3 (Debian 4.8.3-16) ) #1 SMP Debian 3.16.7-ckt2-1 (2014-12-08) ... [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.16.0-4-amd64 root=/dev/mapper/vg1-lv.root ro quiet intel_iommu=on ... [ 0.000000] DMI: System manufacturer System Product Name/RAMPAGE IV EXTREME, BIOS 4901 05/14/2014 ... [ 0.000000] Intel-IOMMU: enabled ... [ 0.000000] Memory: 24661772K/25102988K available (5192K kernel code, 942K rwdata, 1828K rodata, 1200K init, 840K bss, 441216K reserved) ... [ 0.053422] Freeing SMP alternatives memory: 20K (ffffffff81a19000 - ffffffff81a1e000) [ 0.054163] ftrace: allocating 21561 entries in 85 pages [ 0.060881] dmar: Host address width 46 [ 0.060883] dmar: DRHD base: 0x000000fbffc000 flags: 0x1 [ 0.060890] dmar: IOMMU 0: reg_base_addr fbffc000 ver 1:0 cap d2078c106f0466 ecap f020de [ 0.060891] dmar: RMRR base: 0x0000009c475000 end: 0x0000009c482fff [ 0.060892] dmar: ATSR flags: 0x0 [ 0.060893] dmar: RHSA base: 0x000000fbffc000 proximity domain: 0x0 [ 0.060982] IOAPIC id 0 under DRHD base 0xfbffc000 IOMMU 0 [ 0.060982] IOAPIC id 2 under DRHD base 0xfbffc000 IOMMU 0 [ 0.060983] HPET id 0 under DRHD base 0xfbffc000 [ 0.060984] Queued invalidation will be enabled to support x2apic and Intr-remapping. [ 0.061108] Enabled IRQ remapping in x2apic mode [ 0.061109] Enabling x2apic [ 0.061110] Enabled x2apic [ 0.061113] Switched APIC routing to cluster x2apic. [ 0.061610] ..TIMER: vector=0x30 apic1=0 pin1=2 apic2=-1 pin2=-1 [ 0.101249] smpboot: CPU0: Intel(R) Core(TM) i7-4960X CPU @ 3.60GHz (fam: 06, model: 3e, stepping: 04) [ 0.101254] TSC deadline timer enabled [ 0.101270] Performance Events: PEBS fmt1+, 16-deep LBR, IvyBridge events, full-width counters, Intel PMU driver. [ 0.101284] ... version: 3 [ 0.101285] ... bit width: 48 [ 0.101285] ... generic registers: 4 [ 0.101286] ... value mask: 0000ffffffffffff [ 0.101286] ... max period: 0000ffffffffffff [ 0.101287] ... fixed-purpose events: 3 [ 0.101287] ... event mask: 000000070000000f [ 0.102318] x86: Booting SMP configuration: [ 0.102319] .... node #0, CPUs: #1 [ 0.117314] NMI watchdog: enabled on all CPUs, permanently consumes one hw-PMU counter. [ 0.117394] #2 #3 #4 #5 #6 #7 #8 #9 #10 #11 [ 0.255363] x86: Booted up 1 node, 12 CPUs [ 0.255366] smpboot: Total of 12 processors activated (86439.09 BogoMIPS) ... [ 0.270631] ACPI: bus type PCI registered [ 0.270632] acpiphp: ACPI Hot Plug PCI Controller Driver version: 0.5 [ 0.270701] PCI: MMCONFIG for domain 0000 [bus 00-ff] at [mem 0xe0000000-0xefffffff] (base 0xe0000000) [ 0.270702] PCI: MMCONFIG at [mem 0xe0000000-0xefffffff] reserved in E820 [ 0.270903] PCI: Using configuration type 1 for base access [ 0.282954] ACPI: Added _OSI(Module Device) [ 0.282956] ACPI: Added _OSI(Processor Device) [ 0.282957] ACPI: Added _OSI(3.0 _SCP Extensions) [ 0.282957] ACPI: Added _OSI(Processor Aggregator Device) [ 0.291313] ACPI: Executed 1 blocks of module-level executable AML code [ 0.379221] ACPI: Interpreter enabled [ 0.379226] ACPI Exception: AE_NOT_FOUND, While evaluating Sleep State [\_S1_] (20140424/hwxface-580) [ 0.379228] ACPI Exception: AE_NOT_FOUND, While evaluating Sleep State [\_S2_] (20140424/hwxface-580) [ 0.379236] ACPI: (supports S0 S3 S4 S5) [ 0.379237] ACPI: Using IOAPIC for interrupt routing [ 0.379258] PCI: Using host bridge windows from ACPI; if necessary, use &quot;pci=nocrs&quot; and report a bug [ 0.388311] ACPI: PCI Root Bridge [PCI0] (domain 0000 [bus 00-fe]) [ 0.388315] acpi PNP0A08:00: _OSC: OS supports [ExtendedConfig ASPM ClockPM Segments MSI] [ 0.388417] acpi PNP0A08:00: _OSC: platform does not support [PCIeHotplug PME AER] [ 0.388510] acpi PNP0A08:00: _OSC: OS now controls [PCIeCapability] [ 0.388747] PCI host bridge to bus 0000:00 [ 0.388749] pci_bus 0000:00: root bus resource [bus 00-fe] [ 0.388751] pci_bus 0000:00: root bus resource [io 0x0000-0x03af] [ 0.388752] pci_bus 0000:00: root bus resource [io 0x03e0-0x0cf7] [ 0.388753] pci_bus 0000:00: root bus resource [io 0x03b0-0x03df] [ 0.388753] pci_bus 0000:00: root bus resource [io 0x0d00-0xffff] [ 0.388755] pci_bus 0000:00: root bus resource [mem 0x000a0000-0x000bffff] [ 0.388755] pci_bus 0000:00: root bus resource [mem 0x000c0000-0x000dffff] [ 0.388756] pci_bus 0000:00: root bus resource [mem 0xa0000000-0xffffffff] [ 0.388765] pci 0000:00:00.0: [8086:0e00] type 00 class 0x060000 [ 0.388820] pci 0000:00:00.0: PME# supported from D0 D3hot D3cold [ 0.388882] pci 0000:00:01.0: [8086:0e02] type 01 class 0x060400 [ 0.388947] pci 0000:00:01.0: PME# supported from D0 D3hot D3cold [ 0.388984] pci 0000:00:01.0: System wakeup disabled by ACPI [ 0.389015] pci 0000:00:02.0: [8086:0e04] type 01 class 0x060400 [ 0.389080] pci 0000:00:02.0: PME# supported from D0 D3hot D3cold [ 0.389116] pci 0000:00:02.0: System wakeup disabled by ACPI [ 0.389147] pci 0000:00:03.0: [8086:0e08] type 01 class 0x060400 [ 0.389213] pci 0000:00:03.0: PME# supported from D0 D3hot D3cold [ 0.389248] pci 0000:00:03.0: System wakeup disabled by ACPI [ 0.389277] pci 0000:00:03.2: [8086:0e0a] type 01 class 0x060400 [ 0.389341] pci 0000:00:03.2: PME# supported from D0 D3hot D3cold [ 0.389377] pci 0000:00:03.2: System wakeup disabled by ACPI [ 0.389403] pci 0000:00:05.0: [8086:0e28] type 00 class 0x088000 [ 0.389492] pci 0000:00:05.2: [8086:0e2a] type 00 class 0x088000 [ 0.389579] pci 0000:00:05.4: [8086:0e2c] type 00 class 0x080020 [ 0.389588] pci 0000:00:05.4: reg 0x10: [mem 0xf712a000-0xf712afff] [ 0.389691] pci 0000:00:11.0: [8086:1d3e] type 01 class 0x060400 [ 0.389776] pci 0000:00:11.0: PME# supported from D0 D3hot D3cold [ 0.389847] pci 0000:00:16.0: [8086:1d3a] type 00 class 0x078000 [ 0.389867] pci 0000:00:16.0: reg 0x10: [mem 0xf7129000-0xf712900f 64bit] [ 0.389934] pci 0000:00:16.0: PME# supported from D0 D3hot D3cold [ 0.389995] pci 0000:00:19.0: [8086:1503] type 00 class 0x020000 [ 0.390009] pci 0000:00:19.0: reg 0x10: [mem 0xf7100000-0xf711ffff] [ 0.390016] pci 0000:00:19.0: reg 0x14: [mem 0xf7128000-0xf7128fff] [ 0.390023] pci 0000:00:19.0: reg 0x18: [io 0xf040-0xf05f] [ 0.390076] pci 0000:00:19.0: PME# supported from D0 D3hot D3cold [ 0.390105] pci 0000:00:19.0: System wakeup disabled by ACPI [ 0.390136] pci 0000:00:1a.0: [8086:1d2d] type 00 class 0x0c0320 [ 0.390154] pci 0000:00:1a.0: reg 0x10: [mem 0xf7127000-0xf71273ff] [ 0.390233] pci 0000:00:1a.0: PME# supported from D0 D3hot D3cold [ 0.390264] pci 0000:00:1a.0: System wakeup disabled by ACPI [ 0.390293] pci 0000:00:1b.0: [8086:1d20] type 00 class 0x040300 [ 0.390307] pci 0000:00:1b.0: reg 0x10: [mem 0xf7120000-0xf7123fff 64bit] [ 0.390371] pci 0000:00:1b.0: PME# supported from D0 D3hot D3cold [ 0.390426] pci 0000:00:1c.0: [8086:1d10] type 01 class 0x060400 [ 0.390501] pci 0000:00:1c.0: PME# supported from D0 D3hot D3cold [ 0.390519] pci 0000:00:1c.0: Disabling UPDCR peer decodes [ 0.390523] pci 0000:00:1c.0: Enabling MPC IRBNCE [ 0.390525] pci 0000:00:1c.0: Intel PCH root port ACS workaround enabled [ 0.390548] pci 0000:00:1c.0: System wakeup disabled by ACPI [ 0.390576] pci 0000:00:1c.1: [8086:1d12] type 01 class 0x060400 [ 0.390648] pci 0000:00:1c.1: PME# supported from D0 D3hot D3cold [ 0.390667] pci 0000:00:1c.1: Enabling MPC IRBNCE [ 0.390669] pci 0000:00:1c.1: Intel PCH root port ACS workaround enabled [ 0.390691] pci 0000:00:1c.1: System wakeup disabled by ACPI [ 0.390718] pci 0000:00:1c.2: [8086:1d14] type 01 class 0x060400 [ 0.390790] pci 0000:00:1c.2: PME# supported from D0 D3hot D3cold [ 0.390808] pci 0000:00:1c.2: Enabling MPC IRBNCE [ 0.390810] pci 0000:00:1c.2: Intel PCH root port ACS workaround enabled [ 0.390831] pci 0000:00:1c.2: System wakeup disabled by ACPI [ 0.390860] pci 0000:00:1c.3: [8086:1d16] type 01 class 0x060400 [ 0.390932] pci 0000:00:1c.3: PME# supported from D0 D3hot D3cold [ 0.390950] pci 0000:00:1c.3: Enabling MPC IRBNCE [ 0.390951] pci 0000:00:1c.3: Intel PCH root port ACS workaround enabled [ 0.390973] pci 0000:00:1c.3: System wakeup disabled by ACPI [ 0.391000] pci 0000:00:1c.4: [8086:1d18] type 01 class 0x060400 [ 0.391072] pci 0000:00:1c.4: PME# supported from D0 D3hot D3cold [ 0.391090] pci 0000:00:1c.4: Enabling MPC IRBNCE [ 0.391092] pci 0000:00:1c.4: Intel PCH root port ACS workaround enabled [ 0.391113] pci 0000:00:1c.4: System wakeup disabled by ACPI [ 0.391140] pci 0000:00:1c.5: [8086:1d1a] type 01 class 0x060400 [ 0.391212] pci 0000:00:1c.5: PME# supported from D0 D3hot D3cold [ 0.391231] pci 0000:00:1c.5: Enabling MPC IRBNCE [ 0.391233] pci 0000:00:1c.5: Intel PCH root port ACS workaround enabled [ 0.391254] pci 0000:00:1c.5: System wakeup disabled by ACPI [ 0.391283] pci 0000:00:1c.7: [8086:1d1e] type 01 class 0x060400 [ 0.391355] pci 0000:00:1c.7: PME# supported from D0 D3hot D3cold [ 0.391373] pci 0000:00:1c.7: Enabling MPC IRBNCE [ 0.391375] pci 0000:00:1c.7: Intel PCH root port ACS workaround enabled [ 0.391396] pci 0000:00:1c.7: System wakeup disabled by ACPI [ 0.391427] pci 0000:00:1d.0: [8086:1d26] type 00 class 0x0c0320 [ 0.391445] pci 0000:00:1d.0: reg 0x10: [mem 0xf7126000-0xf71263ff] [ 0.391524] pci 0000:00:1d.0: PME# supported from D0 D3hot D3cold [ 0.391555] pci 0000:00:1d.0: System wakeup disabled by ACPI [ 0.391581] pci 0000:00:1e.0: [8086:244e] type 01 class 0x060401 [ 0.391645] pci 0000:00:1e.0: System wakeup disabled by ACPI [ 0.391675] pci 0000:00:1f.0: [8086:1d41] type 00 class 0x060100 [ 0.391818] pci 0000:00:1f.2: [8086:1d02] type 00 class 0x010601 [ 0.391833] pci 0000:00:1f.2: reg 0x10: [io 0xf090-0xf097] [ 0.391839] pci 0000:00:1f.2: reg 0x14: [io 0xf080-0xf083] [ 0.391845] pci 0000:00:1f.2: reg 0x18: [io 0xf070-0xf077] [ 0.391851] pci 0000:00:1f.2: reg 0x1c: [io 0xf060-0xf063] [ 0.391857] pci 0000:00:1f.2: reg 0x20: [io 0xf020-0xf03f] [ 0.391863] pci 0000:00:1f.2: reg 0x24: [mem 0xf7125000-0xf71257ff] [ 0.391900] pci 0000:00:1f.2: PME# supported from D3hot [ 0.391951] pci 0000:00:1f.3: [8086:1d22] type 00 class 0x0c0500 [ 0.391963] pci 0000:00:1f.3: reg 0x10: [mem 0xf7124000-0xf71240ff 64bit] [ 0.391981] pci 0000:00:1f.3: reg 0x20: [io 0xf000-0xf01f] [ 0.392074] pci 0000:00:01.0: PCI bridge to [bus 02] [ 0.392123] pci 0000:01:00.0: [10de:1080] type 00 class 0x030000 [ 0.392131] pci 0000:01:00.0: reg 0x10: [mem 0xfa000000-0xfaffffff] [ 0.392138] pci 0000:01:00.0: reg 0x14: [mem 0xc8000000-0xcfffffff 64bit pref] [ 0.392144] pci 0000:01:00.0: reg 0x1c: [mem 0xd0000000-0xd1ffffff 64bit pref] [ 0.392149] pci 0000:01:00.0: reg 0x24: [io 0xe000-0xe07f] [ 0.392154] pci 0000:01:00.0: reg 0x30: [mem 0xfb000000-0xfb07ffff pref] [ 0.392216] pci 0000:01:00.1: [10de:0e09] type 00 class 0x040300 [ 0.392223] pci 0000:01:00.1: reg 0x10: [mem 0xfb080000-0xfb083fff] [ 0.398491] pci 0000:00:02.0: PCI bridge to [bus 01] [ 0.398494] pci 0000:00:02.0: bridge window [io 0xe000-0xefff] [ 0.398496] pci 0000:00:02.0: bridge window [mem 0xfa000000-0xfb0fffff] [ 0.398500] pci 0000:00:02.0: bridge window [mem 0xc8000000-0xd1ffffff 64bit pref] [ 0.398546] pci 0000:03:00.0: [10de:1080] type 00 class 0x030000 [ 0.398553] pci 0000:03:00.0: reg 0x10: [mem 0xf8000000-0xf8ffffff] [ 0.398559] pci 0000:03:00.0: reg 0x14: [mem 0xb8000000-0xbfffffff 64bit pref] [ 0.398565] pci 0000:03:00.0: reg 0x1c: [mem 0xc0000000-0xc1ffffff 64bit pref] [ 0.398569] pci 0000:03:00.0: reg 0x24: [io 0xd000-0xd07f] [ 0.398573] pci 0000:03:00.0: reg 0x30: [mem 0xf9000000-0xf907ffff pref] [ 0.398640] pci 0000:03:00.1: [10de:0e09] type 00 class 0x040300 [ 0.398648] pci 0000:03:00.1: reg 0x10: [mem 0xf9080000-0xf9083fff] [ 0.406471] pci 0000:00:03.0: PCI bridge to [bus 03] [ 0.406477] pci 0000:00:03.0: bridge window [io 0xd000-0xdfff] [ 0.406482] pci 0000:00:03.0: bridge window [mem 0xf8000000-0xf90fffff] [ 0.406500] pci 0000:00:03.0: bridge window [mem 0xb8000000-0xc1ffffff 64bit pref] [ 0.406546] pci 0000:04:00.0: [10de:0a65] type 00 class 0x030000 [ 0.406553] pci 0000:04:00.0: reg 0x10: [mem 0xf6000000-0xf6ffffff] [ 0.406559] pci 0000:04:00.0: reg 0x14: [mem 0xa0000000-0xafffffff 64bit pref] [ 0.406565] pci 0000:04:00.0: reg 0x1c: [mem 0xb0000000-0xb1ffffff 64bit pref] [ 0.406569] pci 0000:04:00.0: reg 0x24: [io 0xc000-0xc07f] [ 0.406573] pci 0000:04:00.0: reg 0x30: [mem 0xf7000000-0xf707ffff pref] [ 0.406639] pci 0000:04:00.1: [10de:0be3] type 00 class 0x040300 [ 0.406647] pci 0000:04:00.1: reg 0x10: [mem 0xf7080000-0xf7083fff] [ 0.414468] pci 0000:00:03.2: PCI bridge to [bus 04] [ 0.414474] pci 0000:00:03.2: bridge window [io 0xc000-0xcfff] [ 0.414479] pci 0000:00:03.2: bridge window [mem 0xf6000000-0xf70fffff] [ 0.414498] pci 0000:00:03.2: bridge window [mem 0xa0000000-0xb1ffffff 64bit pref] [ 0.414548] pci 0000:00:11.0: PCI bridge to [bus 05] [ 0.414602] pci 0000:00:1c.0: PCI bridge to [bus 06] [ 0.414679] pci 0000:07:00.0: [1b21:1042] type 00 class 0x0c0330 [ 0.414709] pci 0000:07:00.0: reg 0x10: [mem 0xfb700000-0xfb707fff 64bit] [ 0.414858] pci 0000:07:00.0: PME# supported from D3hot D3cold [ 0.422467] pci 0000:00:1c.1: PCI bridge to [bus 07] [ 0.422475] pci 0000:00:1c.1: bridge window [mem 0xfb700000-0xfb7fffff] [ 0.422564] pci 0000:08:00.0: [1b21:1042] type 00 class 0x0c0330 [ 0.422594] pci 0000:08:00.0: reg 0x10: [mem 0xfb600000-0xfb607fff 64bit] [ 0.422742] pci 0000:08:00.0: PME# supported from D3hot D3cold [ 0.430463] pci 0000:00:1c.2: PCI bridge to [bus 08] [ 0.430471] pci 0000:00:1c.2: bridge window [mem 0xfb600000-0xfb6fffff] [ 0.430559] pci 0000:09:00.0: [1b21:1042] type 00 class 0x0c0330 [ 0.430589] pci 0000:09:00.0: reg 0x10: [mem 0xfb500000-0xfb507fff 64bit] [ 0.430738] pci 0000:09:00.0: PME# supported from D3hot D3cold [ 0.438460] pci 0000:00:1c.3: PCI bridge to [bus 09] [ 0.438469] pci 0000:00:1c.3: bridge window [mem 0xfb500000-0xfb5fffff] [ 0.438559] pci 0000:0a:00.0: [1b21:1042] type 00 class 0x0c0330 [ 0.438589] pci 0000:0a:00.0: reg 0x10: [mem 0xfb400000-0xfb407fff 64bit] [ 0.438737] pci 0000:0a:00.0: PME# supported from D3hot D3cold [ 0.446456] pci 0000:00:1c.4: PCI bridge to [bus 0a] [ 0.446465] pci 0000:00:1c.4: bridge window [mem 0xfb400000-0xfb4fffff] [ 0.446549] pci 0000:0b:00.0: [1b21:0612] type 00 class 0x010601 [ 0.446569] pci 0000:0b:00.0: reg 0x10: [io 0xb050-0xb057] [ 0.446581] pci 0000:0b:00.0: reg 0x14: [io 0xb040-0xb043] [ 0.446593] pci 0000:0b:00.0: reg 0x18: [io 0xb030-0xb037] [ 0.446605] pci 0000:0b:00.0: reg 0x1c: [io 0xb020-0xb023] [ 0.446617] pci 0000:0b:00.0: reg 0x20: [io 0xb000-0xb01f] [ 0.446629] pci 0000:0b:00.0: reg 0x24: [mem 0xfb300000-0xfb3001ff] [ 0.454453] pci 0000:00:1c.5: PCI bridge to [bus 0b] [ 0.454459] pci 0000:00:1c.5: bridge window [io 0xb000-0xbfff] [ 0.454464] pci 0000:00:1c.5: bridge window [mem 0xfb300000-0xfb3fffff] [ 0.454548] pci 0000:0c:00.0: [1b21:0612] type 00 class 0x010601 [ 0.454568] pci 0000:0c:00.0: reg 0x10: [io 0xa050-0xa057] [ 0.454580] pci 0000:0c:00.0: reg 0x14: [io 0xa040-0xa043] [ 0.454592] pci 0000:0c:00.0: reg 0x18: [io 0xa030-0xa037] [ 0.454604] pci 0000:0c:00.0: reg 0x1c: [io 0xa020-0xa023] [ 0.454616] pci 0000:0c:00.0: reg 0x20: [io 0xa000-0xa01f] [ 0.454628] pci 0000:0c:00.0: reg 0x24: [mem 0xfb200000-0xfb2001ff] [ 0.462450] pci 0000:00:1c.7: PCI bridge to [bus 0c] [ 0.462456] pci 0000:00:1c.7: bridge window [io 0xa000-0xafff] [ 0.462461] pci 0000:00:1c.7: bridge window [mem 0xfb200000-0xfb2fffff] [ 0.462536] pci 0000:00:1e.0: PCI bridge to [bus 0d] (subtractive decode) [ 0.462543] pci 0000:00:1e.0: bridge window [io 0x0000-0x03af] (subtractive decode) [ 0.462544] pci 0000:00:1e.0: bridge window [io 0x03e0-0x0cf7] (subtractive decode) [ 0.462545] pci 0000:00:1e.0: bridge window [io 0x03b0-0x03df] (subtractive decode) [ 0.462546] pci 0000:00:1e.0: bridge window [io 0x0d00-0xffff] (subtractive decode) [ 0.462547] pci 0000:00:1e.0: bridge window [mem 0x000a0000-0x000bffff] (subtractive decode) [ 0.462548] pci 0000:00:1e.0: bridge window [mem 0x000c0000-0x000dffff] (subtractive decode) [ 0.462549] pci 0000:00:1e.0: bridge window [mem 0xa0000000-0xffffffff] (subtractive decode) [ 0.462820] ACPI: PCI Root Bridge [UNC0] (domain 0000 [bus ff]) [ 0.462822] acpi PNP0A03:00: _OSC: OS supports [ExtendedConfig ASPM ClockPM Segments MSI] [ 0.462836] acpi PNP0A03:00: _OSC: OS now controls [PCIeHotplug PME AER PCIeCapability] [ 0.462869] PCI host bridge to bus 0000:ff [ 0.462870] pci_bus 0000:ff: root bus resource [bus ff] [ 0.462876] pci 0000:ff:08.0: [8086:0e80] type 00 class 0x088000 [ 0.462914] pci 0000:ff:09.0: [8086:0e90] type 00 class 0x088000 [ 0.462950] pci 0000:ff:0a.0: [8086:0ec0] type 00 class 0x088000 [ 0.462981] pci 0000:ff:0a.1: [8086:0ec1] type 00 class 0x088000 [ 0.463012] pci 0000:ff:0a.2: [8086:0ec2] type 00 class 0x088000 [ 0.463042] pci 0000:ff:0a.3: [8086:0ec3] type 00 class 0x088000 [ 0.463073] pci 0000:ff:0b.0: [8086:0e1e] type 00 class 0x088000 [ 0.463102] pci 0000:ff:0b.3: [8086:0e1f] type 00 class 0x088000 [ 0.463131] pci 0000:ff:0c.0: [8086:0ee0] type 00 class 0x088000 [ 0.463159] pci 0000:ff:0c.1: [8086:0ee2] type 00 class 0x088000 [ 0.463187] pci 0000:ff:0c.2: [8086:0ee4] type 00 class 0x088000 [ 0.463217] pci 0000:ff:0d.0: [8086:0ee1] type 00 class 0x088000 [ 0.463247] pci 0000:ff:0d.1: [8086:0ee3] type 00 class 0x088000 [ 0.463275] pci 0000:ff:0d.2: [8086:0ee5] type 00 class 0x088000 [ 0.463306] pci 0000:ff:0e.0: [8086:0ea0] type 00 class 0x088000 [ 0.463336] pci 0000:ff:0e.1: [8086:0e30] type 00 class 0x110100 [ 0.463371] pci 0000:ff:0f.0: [8086:0ea8] type 00 class 0x088000 [ 0.463412] pci 0000:ff:0f.1: [8086:0e71] type 00 class 0x088000 [ 0.463453] pci 0000:ff:0f.2: [8086:0eaa] type 00 class 0x088000 [ 0.463494] pci 0000:ff:0f.3: [8086:0eab] type 00 class 0x088000 [ 0.463534] pci 0000:ff:0f.4: [8086:0eac] type 00 class 0x088000 [ 0.463575] pci 0000:ff:0f.5: [8086:0ead] type 00 class 0x088000 [ 0.463616] pci 0000:ff:10.0: [8086:0eb0] type 00 class 0x088000 [ 0.463658] pci 0000:ff:10.1: [8086:0eb1] type 00 class 0x088000 [ 0.463701] pci 0000:ff:10.2: [8086:0eb2] type 00 class 0x088000 [ 0.463742] pci 0000:ff:10.3: [8086:0eb3] type 00 class 0x088000 [ 0.463784] pci 0000:ff:10.4: [8086:0eb4] type 00 class 0x088000 [ 0.463826] pci 0000:ff:10.5: [8086:0eb5] type 00 class 0x088000 [ 0.463868] pci 0000:ff:10.6: [8086:0eb6] type 00 class 0x088000 [ 0.463909] pci 0000:ff:10.7: [8086:0eb7] type 00 class 0x088000 [ 0.463950] pci 0000:ff:13.0: [8086:0e1d] type 00 class 0x088000 [ 0.463979] pci 0000:ff:13.1: [8086:0e34] type 00 class 0x110100 [ 0.464009] pci 0000:ff:13.4: [8086:0e81] type 00 class 0x088000 [ 0.464038] pci 0000:ff:13.5: [8086:0e36] type 00 class 0x110100 [ 0.464069] pci 0000:ff:16.0: [8086:0ec8] type 00 class 0x088000 [ 0.464098] pci 0000:ff:16.1: [8086:0ec9] type 00 class 0x088000 [ 0.464127] pci 0000:ff:16.2: [8086:0eca] type 00 class 0x088000 [ 0.464218] ACPI: PCI Interrupt Link [LNKA] (IRQs 3 4 5 6 7 10 *11 12 14 15) [ 0.464251] ACPI: PCI Interrupt Link [LNKB] (IRQs 3 4 5 6 7 *10 11 12 14 15) [ 0.464283] ACPI: PCI Interrupt Link [LNKC] (IRQs 3 4 5 6 11 12 14 *15) [ 0.464314] ACPI: PCI Interrupt Link [LNKD] (IRQs 3 *4 5 6 10 11 12 14 15) [ 0.464345] ACPI: PCI Interrupt Link [LNKE] (IRQs 3 4 5 6 7 10 11 12 *14 15) [ 0.464376] ACPI: PCI Interrupt Link [LNKF] (IRQs 3 4 *5 6 7 10 11 12 14 15) [ 0.464407] ACPI: PCI Interrupt Link [LNKG] (IRQs *3 4 5 6 7 10 11 12 14 15) [ 0.464438] ACPI: PCI Interrupt Link [LNKH] (IRQs 3 4 5 6 *7 10 11 12 14 15) [ 0.466723] ACPI: Enabled 3 GPEs in block 00 to 3F [ 0.466804] vgaarb: setting as boot device: PCI:0000:01:00.0 [ 0.466806] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.466808] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=none,locks=none [ 0.466810] vgaarb: device added: PCI:0000:04:00.0,decodes=io+mem,owns=none,locks=none [ 0.466814] vgaarb: loaded [ 0.466815] vgaarb: bridge control possible 0000:04:00.0 [ 0.466816] vgaarb: bridge control possible 0000:03:00.0 [ 0.466816] vgaarb: bridge control possible 0000:01:00.0 [ 0.466857] PCI: Using ACPI for IRQ routing [ 0.472217] PCI: pci_cache_line_size set to 64 bytes [ 0.472319] e820: reserve RAM buffer [mem 0x0009e800-0x0009ffff] [ 0.472320] e820: reserve RAM buffer [mem 0x9beb9000-0x9bffffff] [ 0.472321] e820: reserve RAM buffer [mem 0x9d74c000-0x9fffffff] [ 0.472322] e820: reserve RAM buffer [mem 0x9dc12000-0x9fffffff] [ 0.472323] e820: reserve RAM buffer [mem 0x9e000000-0x9fffffff] [ 0.472427] hpet0: at MMIO 0xfed00000, IRQs 2, 8, 0, 0, 0, 0, 0, 0 [ 0.472430] hpet0: 8 comparators, 64-bit 14.318180 MHz counter [ 0.474466] Switched to clocksource hpet [ 0.478098] pnp: PnP ACPI init [ 0.478106] ACPI: bus type PNP registered [ 0.478172] system 00:00: [mem 0xfc000000-0xfcffffff] has been reserved [ 0.478174] system 00:00: [mem 0xfd000000-0xfdffffff] has been reserved [ 0.478175] system 00:00: [mem 0xfe000000-0xfeafffff] has been reserved [ 0.478176] system 00:00: [mem 0xfeb00000-0xfebfffff] has been reserved [ 0.478177] system 00:00: [mem 0xfed00400-0xfed3ffff] could not be reserved [ 0.478179] system 00:00: [mem 0xfed45000-0xfedfffff] has been reserved [ 0.478180] system 00:00: [mem 0xfee00000-0xfeefffff] has been reserved [ 0.478182] system 00:00: Plug and Play ACPI device, IDs PNP0c01 (active) [ 0.478236] system 00:01: [mem 0xfbffc000-0xfbffdfff] could not be reserved [ 0.478237] system 00:01: Plug and Play ACPI device, IDs PNP0c02 (active) [ 0.478304] system 00:02: [io 0x0290-0x029f] has been reserved [ 0.478306] system 00:02: Plug and Play ACPI device, IDs PNP0c02 (active) [ 0.478329] pnp 00:03: Plug and Play ACPI device, IDs PNP0b00 (active) [ 0.478377] system 00:04: [io 0x04d0-0x04d1] has been reserved [ 0.478380] system 00:04: Plug and Play ACPI device, IDs PNP0c02 (active) [ 0.478538] system 00:05: [io 0x0400-0x0453] could not be reserved [ 0.478539] system 00:05: [io 0x0458-0x047f] has been reserved [ 0.478540] system 00:05: [io 0x1180-0x119f] has been reserved [ 0.478541] system 00:05: [io 0x0500-0x057f] has been reserved [ 0.478543] system 00:05: [mem 0xfed1c000-0xfed1ffff] has been reserved [ 0.478544] system 00:05: [mem 0xfec00000-0xfecfffff] could not be reserved [ 0.478546] system 00:05: [mem 0xff000000-0xffffffff] has been reserved [ 0.478547] system 00:05: Plug and Play ACPI device, IDs PNP0c01 (active) [ 0.478594] system 00:06: [io 0x0454-0x0457] has been reserved [ 0.478596] system 00:06: Plug and Play ACPI device, IDs INT3f0d PNP0c02 (active) [ 0.478764] pnp: PnP ACPI: found 7 devices [ 0.478764] ACPI: bus type PNP unregistered [ 0.484701] pci 0000:00:01.0: PCI bridge to [bus 02] [ 0.484709] pci 0000:00:02.0: PCI bridge to [bus 01] [ 0.484710] pci 0000:00:02.0: bridge window [io 0xe000-0xefff] [ 0.484714] pci 0000:00:02.0: bridge window [mem 0xfa000000-0xfb0fffff] [ 0.484716] pci 0000:00:02.0: bridge window [mem 0xc8000000-0xd1ffffff 64bit pref] [ 0.484720] pci 0000:00:03.0: PCI bridge to [bus 03] [ 0.484721] pci 0000:00:03.0: bridge window [io 0xd000-0xdfff] [ 0.484725] pci 0000:00:03.0: bridge window [mem 0xf8000000-0xf90fffff] [ 0.484727] pci 0000:00:03.0: bridge window [mem 0xb8000000-0xc1ffffff 64bit pref] [ 0.484731] pci 0000:00:03.2: PCI bridge to [bus 04] [ 0.484732] pci 0000:00:03.2: bridge window [io 0xc000-0xcfff] [ 0.484735] pci 0000:00:03.2: bridge window [mem 0xf6000000-0xf70fffff] [ 0.484738] pci 0000:00:03.2: bridge window [mem 0xa0000000-0xb1ffffff 64bit pref] [ 0.484741] pci 0000:00:11.0: PCI bridge to [bus 05] [ 0.484752] pci 0000:00:1c.0: PCI bridge to [bus 06] [ 0.484761] pci 0000:00:1c.1: PCI bridge to [bus 07] [ 0.484764] pci 0000:00:1c.1: bridge window [mem 0xfb700000-0xfb7fffff] [ 0.484770] pci 0000:00:1c.2: PCI bridge to [bus 08] [ 0.484774] pci 0000:00:1c.2: bridge window [mem 0xfb600000-0xfb6fffff] [ 0.484780] pci 0000:00:1c.3: PCI bridge to [bus 09] [ 0.484784] pci 0000:00:1c.3: bridge window [mem 0xfb500000-0xfb5fffff] [ 0.484790] pci 0000:00:1c.4: PCI bridge to [bus 0a] [ 0.484794] pci 0000:00:1c.4: bridge window [mem 0xfb400000-0xfb4fffff] [ 0.484800] pci 0000:00:1c.5: PCI bridge to [bus 0b] [ 0.484802] pci 0000:00:1c.5: bridge window [io 0xb000-0xbfff] [ 0.484805] pci 0000:00:1c.5: bridge window [mem 0xfb300000-0xfb3fffff] [ 0.484812] pci 0000:00:1c.7: PCI bridge to [bus 0c] [ 0.484813] pci 0000:00:1c.7: bridge window [io 0xa000-0xafff] [ 0.484817] pci 0000:00:1c.7: bridge window [mem 0xfb200000-0xfb2fffff] [ 0.484823] pci 0000:00:1e.0: PCI bridge to [bus 0d] [ 0.484831] pci_bus 0000:00: resource 4 [io 0x0000-0x03af] [ 0.484832] pci_bus 0000:00: resource 5 [io 0x03e0-0x0cf7] [ 0.484833] pci_bus 0000:00: resource 6 [io 0x03b0-0x03df] [ 0.484834] pci_bus 0000:00: resource 7 [io 0x0d00-0xffff] [ 0.484835] pci_bus 0000:00: resource 8 [mem 0x000a0000-0x000bffff] [ 0.484836] pci_bus 0000:00: resource 9 [mem 0x000c0000-0x000dffff] [ 0.484837] pci_bus 0000:00: resource 10 [mem 0xa0000000-0xffffffff] [ 0.484838] pci_bus 0000:01: resource 0 [io 0xe000-0xefff] [ 0.484839] pci_bus 0000:01: resource 1 [mem 0xfa000000-0xfb0fffff] [ 0.484840] pci_bus 0000:01: resource 2 [mem 0xc8000000-0xd1ffffff 64bit pref] [ 0.484841] pci_bus 0000:03: resource 0 [io 0xd000-0xdfff] [ 0.484842] pci_bus 0000:03: resource 1 [mem 0xf8000000-0xf90fffff] [ 0.484843] pci_bus 0000:03: resource 2 [mem 0xb8000000-0xc1ffffff 64bit pref] [ 0.484844] pci_bus 0000:04: resource 0 [io 0xc000-0xcfff] [ 0.484845] pci_bus 0000:04: resource 1 [mem 0xf6000000-0xf70fffff] [ 0.484846] pci_bus 0000:04: resource 2 [mem 0xa0000000-0xb1ffffff 64bit pref] [ 0.484847] pci_bus 0000:07: resource 1 [mem 0xfb700000-0xfb7fffff] [ 0.484848] pci_bus 0000:08: resource 1 [mem 0xfb600000-0xfb6fffff] [ 0.484849] pci_bus 0000:09: resource 1 [mem 0xfb500000-0xfb5fffff] [ 0.484850] pci_bus 0000:0a: resource 1 [mem 0xfb400000-0xfb4fffff] [ 0.484851] pci_bus 0000:0b: resource 0 [io 0xb000-0xbfff] [ 0.484852] pci_bus 0000:0b: resource 1 [mem 0xfb300000-0xfb3fffff] [ 0.484853] pci_bus 0000:0c: resource 0 [io 0xa000-0xafff] [ 0.484854] pci_bus 0000:0c: resource 1 [mem 0xfb200000-0xfb2fffff] [ 0.484855] pci_bus 0000:0d: resource 4 [io 0x0000-0x03af] [ 0.484856] pci_bus 0000:0d: resource 5 [io 0x03e0-0x0cf7] [ 0.484857] pci_bus 0000:0d: resource 6 [io 0x03b0-0x03df] [ 0.484858] pci_bus 0000:0d: resource 7 [io 0x0d00-0xffff] [ 0.484859] pci_bus 0000:0d: resource 8 [mem 0x000a0000-0x000bffff] [ 0.484860] pci_bus 0000:0d: resource 9 [mem 0x000c0000-0x000dffff] [ 0.484860] pci_bus 0000:0d: resource 10 [mem 0xa0000000-0xffffffff] ... [ 0.526512] pci 0000:01:00.0: Video device with shadowed ROM [ 0.526967] PCI: CLS 64 bytes, default 64 [ 0.526999] Unpacking initramfs... [ 0.715857] Freeing initrd memory: 16148K (ffff880036066000 - ffff88003702b000) [ 0.716025] IOMMU 0 0xfbffc000: using Queued invalidation [ 0.716028] IOMMU: Setting RMRR: [ 0.716038] IOMMU: Setting identity map for device 0000:00:1a.0 [0x9c475000 - 0x9c482fff] [ 0.716063] IOMMU: Setting identity map for device 0000:00:1d.0 [0x9c475000 - 0x9c482fff] [ 0.716077] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.716085] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 0.716098] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O ... [ 0.720581] ioapic: probe of 0000:00:05.4 failed with error -22 [ 0.720588] pci_hotplug: PCI Hot Plug PCI Core version: 0.5 [ 0.720598] pciehp: PCI Express Hot Plug Controller Driver version: 0.4 ... [ 0.725407] AMD IOMMUv2 driver by Joerg Roedel &lt;joerg.roedel@amd.com&gt; [ 0.725409] AMD IOMMUv2 functionality not available on this system ... [ 1.039938] ehci-pci 0000:00:1a.0: EHCI Host Controller [ 1.039942] ehci-pci 0000:00:1a.0: new USB bus registered, assigned bus number 9 [ 1.039953] ehci-pci 0000:00:1a.0: debug port 2 [ 1.043862] ehci-pci 0000:00:1a.0: cache line size of 64 is not supported [ 1.043874] ehci-pci 0000:00:1a.0: irq 21, io mem 0xf7127000 [ 1.053896] ehci-pci 0000:00:1a.0: USB 2.0 started, EHCI 1.00 ... [ 1.054233] ehci-pci 0000:00:1d.0: EHCI Host Controller [ 1.054237] ehci-pci 0000:00:1d.0: new USB bus registered, assigned bus number 10 [ 1.054247] ehci-pci 0000:00:1d.0: debug port 2 [ 1.058160] ehci-pci 0000:00:1d.0: cache line size of 64 is not supported [ 1.058172] ehci-pci 0000:00:1d.0: irq 23, io mem 0xf7126000 [ 1.069906] ehci-pci 0000:00:1d.0: USB 2.0 started, EHCI 1.00 ... [ 18.164918] pci-stub: add 10DE:1080 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 18.164926] pci-stub 0000:01:00.0: claimed by stub [ 18.164933] pci-stub 0000:03:00.0: claimed by stub [ 18.164938] pci-stub: add 10DE:0E09 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 18.164944] pci-stub 0000:01:00.1: claimed by stub [ 18.164950] pci-stub 0000:03:00.1: claimed by stub ... [ 18.235038] nouveau 0000:04:00.0: enabling device (0004 -&gt; 0007) ... [ 18.235444] nouveau [ DEVICE][0000:04:00.0] BOOT0 : 0x0a8280b1 [ 18.235447] nouveau [ DEVICE][0000:04:00.0] Chipset: GT218 (NVA8) [ 18.235448] nouveau [ DEVICE][0000:04:00.0] Family : NV50 [ 18.235470] nouveau [ VBIOS][0000:04:00.0] checking PRAMIN for image... [ 18.235474] nouveau [ VBIOS][0000:04:00.0] ... signature not found [ 18.235475] nouveau [ VBIOS][0000:04:00.0] checking PROM for image... ... [ 18.348136] nouveau [ VBIOS][0000:04:00.0] ... appears to be valid [ 18.348138] nouveau [ VBIOS][0000:04:00.0] using image from PROM [ 18.348211] nouveau [ VBIOS][0000:04:00.0] BIT signature found [ 18.348212] nouveau [ VBIOS][0000:04:00.0] version 70.18.64.00.05 [ 18.348385] nouveau [ DEVINIT][0000:04:00.0] adaptor not initialised [ 18.348390] nouveau [ VBIOS][0000:04:00.0] running init tables ... [ 18.416916] nouveau 0000:04:00.0: irq 103 for MSI/MSI-X [ 18.416924] nouveau [ PMC][0000:04:00.0] MSI interrupts enabled [ 18.416947] nouveau [ PFB][0000:04:00.0] RAM type: DDR3 [ 18.416948] nouveau [ PFB][0000:04:00.0] RAM size: 1024 MiB [ 18.416949] nouveau [ PFB][0000:04:00.0] ZCOMP: 960 tags [ 18.418379] nouveau [ VOLT][0000:04:00.0] GPU voltage: 900000uv ... [ 18.936188] input: HDA NVidia HDMI/DP,pcm=3 as /devices/pci0000:00/0000:00:03.2/0000:04:00.1/sound/card1/input24 [ 18.936307] input: HDA NVidia HDMI/DP,pcm=7 as /devices/pci0000:00/0000:00:03.2/0000:04:00.1/sound/card1/input25 [ 18.937044] input: HDA NVidia HDMI/DP,pcm=8 as /devices/pci0000:00/0000:00:03.2/0000:04:00.1/sound/card1/input26 [ 18.937126] input: HDA NVidia HDMI/DP,pcm=9 as /devices/pci0000:00/0000:00:03.2/0000:04:00.1/sound/card1/input27 [ 19.695122] nouveau [ PTHERM][0000:04:00.0] FAN control: none / external [ 19.695129] nouveau [ PTHERM][0000:04:00.0] fan management: automatic [ 19.695131] nouveau [ PTHERM][0000:04:00.0] internal sensor: yes [ 19.695144] nouveau [ CLK][0000:04:00.0] 03: core 135 MHz shader 270 MHz memory 135 MHz [ 19.695146] nouveau [ CLK][0000:04:00.0] 07: core 405 MHz shader 810 MHz memory 405 MHz [ 19.695147] nouveau [ CLK][0000:04:00.0] 0f: core 589 MHz shader 1402 MHz memory 600 MHz [ 19.695161] nouveau [ CLK][0000:04:00.0] --: core 405 MHz shader 810 MHz memory 405 MHz [ 19.695327] [TTM] Zone kernel: Available graphics memory: 12373126 kiB [ 19.695328] [TTM] Zone dma32: Available graphics memory: 2097152 kiB [ 19.695329] [TTM] Initializing pool allocator [ 19.695332] [TTM] Initializing DMA pool allocator [ 19.695338] nouveau [ DRM] VRAM: 1024 MiB [ 19.695339] nouveau [ DRM] GART: 1048576 MiB [ 19.695342] nouveau [ DRM] TMDS table version 2.0 [ 19.695343] nouveau [ DRM] DCB version 4.0 [ 19.695344] nouveau [ DRM] DCB outp 00: 01000302 00020030 [ 19.695345] nouveau [ DRM] DCB outp 01: 02000300 00000000 [ 19.695346] nouveau [ DRM] DCB outp 02: 02011362 00020010 [ 19.695347] nouveau [ DRM] DCB outp 03: 01022310 00000000 [ 19.695348] nouveau [ DRM] DCB conn 00: 00001030 [ 19.695349] nouveau [ DRM] DCB conn 01: 00002161 [ 19.695350] nouveau [ DRM] DCB conn 02: 00000200 [ 19.712678] [drm] Supports vblank timestamp caching Rev 2 (21.10.2013). [ 19.712679] [drm] Driver supports precise vblank timestamp query. [ 19.731746] nouveau [ DRM] MM: using COPY for buffer copies [ 19.803827] nouveau [ DRM] allocated 1920x1080 fb: 0x70000, bo ffff880641f6b800 [ 19.896487] Console: switching to colour frame buffer device 240x67 [ 19.899643] nouveau 0000:04:00.0: fb0: nouveaufb frame buffer device [ 19.899644] nouveau 0000:04:00.0: registered panic notifier [ 19.918915] [drm] Initialized nouveau 1.1.2 20120801 for 0000:04:00.0 on minor 0 ... [ 20.231080] vgaarb: device changed decodes: PCI:0000:04:00.0,olddecodes=io+mem,decodes=none:owns=none ... [ 23.484645] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready [ 262.576441] VFIO - User Level meta-driver version: 0.3</code></pre></div><p>The only difference between 01 and 03 is that 01 appears to be selected by vgaarb as the boot device and something about &quot;shadowed ROM&quot;. Here&#039;s a grep of the 01 card:</p><div class="codebox"><pre><code>[ 0.392123] pci 0000:01:00.0: [10de:1080] type 00 class 0x030000 [ 0.392131] pci 0000:01:00.0: reg 0x10: [mem 0xfa000000-0xfaffffff] [ 0.392138] pci 0000:01:00.0: reg 0x14: [mem 0xc8000000-0xcfffffff 64bit pref] [ 0.392144] pci 0000:01:00.0: reg 0x1c: [mem 0xd0000000-0xd1ffffff 64bit pref] [ 0.392149] pci 0000:01:00.0: reg 0x24: [io 0xe000-0xe07f] [ 0.392154] pci 0000:01:00.0: reg 0x30: [mem 0xfb000000-0xfb07ffff pref] [ 0.392216] pci 0000:01:00.1: [10de:0e09] type 00 class 0x040300 [ 0.392223] pci 0000:01:00.1: reg 0x10: [mem 0xfb080000-0xfb083fff] [ 0.466804] vgaarb: setting as boot device: PCI:0000:01:00.0 [ 0.466806] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.466816] vgaarb: bridge control possible 0000:01:00.0 [ 0.526512] pci 0000:01:00.0: Video device with shadowed ROM [ 18.164926] pci-stub 0000:01:00.0: claimed by stub [ 18.164944] pci-stub 0000:01:00.1: claimed by stub</code></pre></div><p>...vs a grep of the 03 card:</p><div class="codebox"><pre><code>[ 0.398546] pci 0000:03:00.0: [10de:1080] type 00 class 0x030000 [ 0.398553] pci 0000:03:00.0: reg 0x10: [mem 0xf8000000-0xf8ffffff] [ 0.398559] pci 0000:03:00.0: reg 0x14: [mem 0xb8000000-0xbfffffff 64bit pref] [ 0.398565] pci 0000:03:00.0: reg 0x1c: [mem 0xc0000000-0xc1ffffff 64bit pref] [ 0.398569] pci 0000:03:00.0: reg 0x24: [io 0xd000-0xd07f] [ 0.398573] pci 0000:03:00.0: reg 0x30: [mem 0xf9000000-0xf907ffff pref] [ 0.398640] pci 0000:03:00.1: [10de:0e09] type 00 class 0x040300 [ 0.398648] pci 0000:03:00.1: reg 0x10: [mem 0xf9080000-0xf9083fff] [ 0.466808] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=none,locks=none [ 0.466816] vgaarb: bridge control possible 0000:03:00.0 [ 18.164933] pci-stub 0000:03:00.0: claimed by stub [ 18.164950] pci-stub 0000:03:00.1: claimed by stub</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501105">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501111" class="blockpost roweven"> <h2><span><span class="conr">#4118</span> <a href="viewtopic.php?pid=1501111#p1501111">2015-02-08 22:15:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I updated the qemu package today to version 2.2.0-2 and my win7 vm refuses to start now. I browsed through the last couple of pages here, to find some hint for a change or problem..something like that - but there isn&#039;t.<br />I`m running kernel 3.18.5-1-mainline of the op and the vm was fine since my upgrade today.<br />Here is what the terminal says</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x0, 0x80000000, 0x7fb65c000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x100000000, 0x80000000, 0x7fb6dc000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Qemu complains about something related to vfio now. Can anyone give me some background about this and how to fix this?</p><p>Regards apex</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501111">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501117" class="blockpost rowodd"> <h2><span><span class="conr">#4119</span> <a href="viewtopic.php?pid=1501117#p1501117">2015-02-08 22:22:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi, I updated the qemu package today to version 2.2.0-2 and my win7 vm refuses to start now. I browsed through the last couple of pages here, to find some hint for a change or problem..something like that - but there isn&#039;t.<br />I`m running kernel 3.18.5-1-mainline of the op and the vm was fine since my upgrade today.<br />Here is what the terminal says</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x0, 0x80000000, 0x7fb65c000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x100000000, 0x80000000, 0x7fb6dc000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Qemu complains about something related to vfio now. Can anyone give me some background about this and how to fix this?</p></div></blockquote></div><p>Does dmesg show RLIMIT_MEMLOCK errors?</p> <p class="postedit"><em>Last edited by aw (2015-02-08 22:22:32)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501117">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501123" class="blockpost roweven"> <h2><span><span class="conr">#4120</span> <a href="viewtopic.php?pid=1501123#p1501123">2015-02-08 22:30:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi, I updated the qemu package today to version 2.2.0-2 and my win7 vm refuses to start now. I browsed through the last couple of pages here, to find some hint for a change or problem..something like that - but there isn&#039;t.<br />I`m running kernel 3.18.5-1-mainline of the op and the vm was fine since my upgrade today.<br />Here is what the terminal says</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x0, 0x80000000, 0x7fb65c000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fb78cf646e0, 0x100000000, 0x80000000, 0x7fb6dc000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Qemu complains about something related to vfio now. Can anyone give me some background about this and how to fix this?</p></div></blockquote></div><p>Does dmesg show RLIMIT_MEMLOCK errors?</p></div></blockquote></div><p>Yes, it does</p><div class="codebox"><pre><code>[ 1052.293809] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.293817] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.303814] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.303821] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501123">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501126" class="blockpost rowodd"> <h2><span><span class="conr">#4121</span> <a href="viewtopic.php?pid=1501126#p1501126">2015-02-08 22:36:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Does dmesg show RLIMIT_MEMLOCK errors?</p></div></blockquote></div><p>Yes, it does</p><div class="codebox"><pre><code>[ 1052.293809] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.293817] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.303814] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded [ 1052.303821] vfio_pin_pages: RLIMIT_MEMLOCK (40960000) exceeded</code></pre></div></div></blockquote></div><p>Nothing has changed here, the user always needs to be able to lock enough pages for the VM.&#160; You&#039;re not going to get very far with a locked memory limit of 40MB.&#160; If you use libvirt (and do not hide the vfio device in &lt;qemu:arg&gt;!) this happens automatically.&#160; If you run qemu by hand, the easiest solution is to run as root or use sudo.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501126">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501130" class="blockpost roweven"> <h2><span><span class="conr">#4122</span> <a href="viewtopic.php?pid=1501130#p1501130">2015-02-08 22:44:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Nothing has changed here, the user always needs to be able to lock enough pages for the VM.&#160; You&#039;re not going to get very far with a locked memory limit of 40MB.&#160; If you use libvirt (and do not hide the vfio device in &lt;qemu:arg&gt;!) this happens automatically.&#160; If you run qemu by hand, the easiest solution is to run as root or use sudo.</p></div></blockquote></div><p>Ah I remember that. I think I adjusted this via </p><div class="codebox"><pre><code>cat /etc/security/limits.conf | grep @users @users soft memlock 4301000 @users hard memlock 4301000</code></pre></div><p>This was fine to run qemu as non root until now..</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501130">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501203" class="blockpost rowodd"> <h2><span><span class="conr">#4123</span> <a href="viewtopic.php?pid=1501203#p1501203">2015-02-09 07:20:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88564">hotfunction</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-05</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone, i&#039;ve been reading a lot of posts here, and i wanted to try the passthrough by myself, but seemed that i got some error here, and firstly according to the steps of the guide, i have been doing step by steps, and here&#039;s my build :</p><p>Processor : Xeon E3-1200 (VT-d Enabled in BIOS)<br />ubuntu display GPU : Radeon HD4870<br />Passthrough GPU : GeForce GTX 560 Ti Hawx</p><p>So steps i&#039;ve been done so far :<br />1. Ubuntu Server 12.04, then do-release-upgrade to 14.04<br />2. Downloaded Kernel 3.18-5 from Linux homepage<br />3. Downloaded 3.18-5 linux-mainline from nhbs&#039;s first post<br />4. Patched ACS and i915_317 patch from linux-mainline from nbhs&#039;s post<br />5. Qemu 2.2.0, also Seabios standard and no patches<br />6. lspci | grep NVIDIA :<br />&#160; </p><div class="quotebox"><blockquote><div><p>05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1)<br />05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1)</p></div></blockquote></div><p>7. edited /etc/default/grub : <br />&#160; </p><div class="quotebox"><blockquote><div><p>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c&quot;</p></div></blockquote></div><p>&#160; &#160; and our /proc/cmdline :<br />&#160; </p><div class="quotebox"><blockquote><div><p>BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7</p></div></blockquote></div><p>8. also blacklisted radeon on /etc/modprobe.d/blacklist.conf<br />9. dmesg pci-stub : </p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7<br />[&#160; &#160; 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787587] pci-stub 0000:05:00.0: claimed by stub<br />[&#160; &#160; 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787597] pci-stub 0000:05:00.1: claimed by stub</p></div></blockquote></div><p>10. i checked lspci -vnn for the graphics cards in the device :</p><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441] (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:0284]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at d0000000 (64-bit, prefetchable) [size=256M]<br />&#160; &#160; &#160; &#160; Memory at f6220000 (64-bit, non-prefetchable) [size=64K]<br />&#160; &#160; &#160; &#160; I/O ports at b000 [size=256]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6200000 [disabled] [size=128K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;</p><p>03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] [1002:aa30]<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:aa30]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 36<br />&#160; &#160; &#160; &#160; Memory at f6230000 (64-bit, non-prefetchable) [size=16K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Kernel driver in use: snd_hda_intel</p><p>04:00.0 Display controller [0380]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441]<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:0284]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at c0000000 (64-bit, prefetchable) [size=256M]<br />&#160; &#160; &#160; &#160; Memory at f6120000 (64-bit, non-prefetchable) [size=64K]<br />&#160; &#160; &#160; &#160; I/O ports at a000 [size=256]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6100000 [disabled] [size=128K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;</p><p>05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1) (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601]<br />&#160; &#160; &#160; &#160; Flags: fast devsel, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at f4000000 (32-bit, non-prefetchable) [disabled] [size=32M]<br />&#160; &#160; &#160; &#160; Memory at e0000000 (64-bit, prefetchable) [disabled] [size=128M]<br />&#160; &#160; &#160; &#160; Memory at e8000000 (64-bit, prefetchable) [disabled] [size=64M]<br />&#160; &#160; &#160; &#160; I/O ports at e000 [disabled] [size=128]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6000000 [disabled] [size=512K]<br />&#160; &#160; &#160; &#160; Capabilities: [60] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [78] Express Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Capabilities: [100] Virtual Channel<br />&#160; &#160; &#160; &#160; Capabilities: [128] Power Budgeting &lt;?&gt;<br />&#160; &#160; &#160; &#160; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Kernel driver in use: pci-stub</p><p>05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1)<br />&#160; &#160; &#160; &#160; Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 10<br />&#160; &#160; &#160; &#160; Memory at f6080000 (32-bit, non-prefetchable) [size=16K]<br />&#160; &#160; &#160; &#160; Capabilities: [60] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [78] Express Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Kernel driver in use: pci-stub</p></div></blockquote></div><p>11. after all went good, i create vfio-pci1.cfg in /etc/vfio-pci1.cfg :</p><div class="quotebox"><blockquote><div><p>0000:05:00.0<br />0000:05:00.1</p></div></blockquote></div><p>12. Booting VM&#039;s Script : </p><div class="quotebox"><blockquote><div><p>#!/bin/bash</p><p>configfile=/etc/vfio-pci1.cfg</p><p>vfiobind() {<br />&#160; &#160; dev=&quot;$1&quot;<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id</p><p>}</p><p>modprobe vfio-pci</p><p>cat $configfile | while read line;do<br />&#160; &#160; echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue<br />&#160; &#160; &#160; &#160; vfiobind $line<br />done</p><p>sudo qemu-system-x86_64 -vga none -M q35 -hda /home/sslab719/VMimages/VM.img -enable-kvm -m 2048 -cpu host,kvm=off \<br />-smp 2,sockets=1,cores=2,threads=1 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-drive file=/home/sslab719/VMimages/VM.img,id=disk,format=qcow2 \<br />-device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/sslab719/MSI.GTX560Ti.1024.110825.rom \<br />-device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \<br />-net user,hostfwd=tcp::10022-:22 -net nic<br />#-boot menu=on</p><p>exit 0</p></div></blockquote></div><p>Here at this point, i am always having black QEMU Monitor with &quot;compat_monitor0 console&quot;<br />Qemu 2.2.0 monitor - type help for more information -- when i&#039;m using -vga none right over here.</p><p>If i remove -vga none there, i can boot to the VMs normally, and i can see the lspci went in correctly, but it does seem like it doesn&#039;t have the real GPU power... the passthrough went there and it shows up in lspci but i am guessing that theres no GPU clock, shader, and memory power.. I tried to install heaven engine benchmark in linux, and i tried to run it on, and it fails, and here i am guessing that perhaps the problem might be the GPU doesn&#039;t really passthrough successfully, but instead its just a name showup on the VMs, and i can still see 00:01.0 VGA compatible Controller: Device 1234:1111, and the others are our passthrough&#039;d GPU 01:00.0..</p><p>Here by reading i know that we should add -vga none in order to passthrough it normally, but it seemed that -vga none didn&#039;t bring a help for me, and instead its just gave me a weird black qemu monitor which i can type some commands of qemu itself.</p><p>i tried -vga std and others, but those didn&#039;t worked too..</p><p>so i checked my dmesg when turning my VM to see whether vfio works correctly, here are some important points at my dmesg:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.210689] vgaarb: setting as boot device: PCI:0000:03:00.0<br />[&#160; &#160; 0.210691] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=io+mem,locks=none<br />[&#160; &#160; 0.210695] vgaarb: device added: PCI:0000:05:00.0,decodes=io+mem,owns=none,locks=none<br />[&#160; &#160; 0.210696] vgaarb: loaded<br />[&#160; &#160; 0.210697] vgaarb: bridge control possible 0000:05:00.0<br />[&#160; &#160; 0.210697] vgaarb: bridge control possible 0000:03:00.0<br />[&#160; &#160; 0.210846] SCSI subsystem initialized<br />[&#160; &#160; 0.210873] libata version 3.00 loaded.<br />[&#160; &#160; 0.210889] ACPI: bus type USB registered<br />[&#160; &#160; 0.210902] usbcore: registered new interface driver usbfs<br />[&#160; &#160; 0.210908] usbcore: registered new interface driver hub<br />[&#160; &#160; 0.210919] usbcore: registered new device driver usb<br />[&#160; &#160; 0.211004] PCI: Using ACPI for IRQ routing<br />[&#160; &#160; 0.212320] PCI: pci_cache_line_size set to 64 bytes<br />[&#160; &#160; 0.212378] e820: reserve RAM buffer [mem 0x0009ec00-0x0009ffff]<br />[&#160; &#160; 0.212380] e820: reserve RAM buffer [mem 0xbdf9c000-0xbfffffff]<br />[&#160; &#160; 0.212381] e820: reserve RAM buffer [mem 0xbdfa3000-0xbfffffff]<br />[&#160; &#160; 0.212382] e820: reserve RAM buffer [mem 0xbec81000-0xbfffffff]<br />[&#160; &#160; 0.212383] e820: reserve RAM buffer [mem 0xbf000000-0xbfffffff]<br />[&#160; &#160; 0.212384] e820: reserve RAM buffer [mem 0x83e000000-0x83fffffff]<br />[&#160; &#160; 0.266687] pci 0000:03:00.0: Video device with shadowed ROM<br />[&#160; &#160; 0.266730] PCI: CLS 64 bytes, default 64<br />[&#160; &#160; 0.266768] Trying to unpack rootfs image as initramfs...<br />[&#160; &#160; 2.132383] Freeing initrd memory: 156660K (ffff880024df6000 - ffff88002e6f3000)<br />[&#160; &#160; 2.132421] DMAR: No ATSR found<br />[&#160; &#160; 2.132438] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 2.132439] IOMMU: Setting RMRR:<br />[&#160; &#160; 2.132450] IOMMU: Setting identity map for device 0000:00:14.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132468] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132481] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132489] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 2.132494] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]<br />[&#160; &#160; 2.132571] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O<br />[&#160; &#160; 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787587] pci-stub 0000:05:00.0: claimed by stub<br />[&#160; &#160; 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787597] pci-stub 0000:05:00.1: claimed by stub<br />[&#160; &#160; 3.495732] VFIO - User Level meta-driver version: 0.3<br />[&#160; &#160; 3.529871] FS-Cache: Loaded<br />[&#160; &#160; 3.692679] RPC: Registered named UNIX socket transport module.<br />[&#160; &#160; 3.692682] RPC: Registered udp transport module.<br />[&#160; &#160; 3.692683] RPC: Registered tcp transport module.<br />[&#160; &#160; 3.692684] RPC: Registered tcp NFSv4.1 backchannel transport module.<br />[&#160; &#160; 3.722255] ppdev: user-space parallel port driver<br />[&#160; &#160; 3.731469] parport_pc 00:05: reported by Plug and Play ACPI<br />[&#160; &#160; 3.731516] parport0: PC-style at 0x378, irq 5 [PCSPP]<br />[&#160; &#160; 3.816825] lp0: using parport0 (interrupt-driven).<br />[&#160; &#160; 3.821640] wmi: Mapper loaded<br />[&#160; &#160; 3.866631] init: avahi-cups-reload main process (565) terminated with status 1<br />[&#160; &#160; 3.878995] ACPI Warning: SystemIO range 0x0000000000000428-0x000000000000042f conflicts with OpRegion 0x0000000000000400-0x000000000000047f (\PMIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879000] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879003] ACPI Warning: SystemIO range 0x0000000000000540-0x000000000000054f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879005] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879006] ACPI Warning: SystemIO range 0x0000000000000530-0x000000000000053f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879007] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879008] ACPI Warning: SystemIO range 0x0000000000000500-0x000000000000052f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879010] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879010] lpc_ich: Resource conflict(s) found affecting gpio_ich<br />[&#160; &#160; 3.962690] device-mapper: multipath: version 1.7.0 loaded<br />[&#160; &#160; 3.962999] mei_me 0000:00:16.0: irq 34 for MSI/MSI-X<br />[&#160; &#160; 3.977288] AVX version of gcm_enc/dec engaged.<br />[&#160; &#160; 3.977290] AES CTR mode by8 optimization enabled<br />[&#160; &#160; 4.182963] snd_hda_intel 0000:00:1b.0: irq 35 for MSI/MSI-X<br />[&#160; &#160; 4.183050] snd_hda_intel 0000:03:00.1: Handle VGA-switcheroo audio client<br />[&#160; &#160; 4.183071] snd_hda_intel 0000:03:00.1: irq 36 for MSI/MSI-X<br />[&#160; &#160; 4.202764] input: HDA ATI HDMI HDMI/DP,pcm=3 as /devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:04.0/0000:03:00.1/sound/card1/input5<br />[&#160; &#160; 4.221910] sound hdaudioC0D0: autoconfig: line_outs=1 (0x14/0x0/0x0/0x0/0x0) type:line<br />[&#160; &#160; 4.221914] sound hdaudioC0D0:&#160; &#160; speaker_outs=0 (0x0/0x0/0x0/0x0/0x0)<br />[&#160; &#160; 4.221915] sound hdaudioC0D0:&#160; &#160; hp_outs=1 (0x1b/0x0/0x0/0x0/0x0)<br />[&#160; &#160; 4.221916] sound hdaudioC0D0:&#160; &#160; mono: mono_out=0x0<br />[&#160; &#160; 4.221917] sound hdaudioC0D0:&#160; &#160; dig-out=0x11/0x0<br />[&#160; &#160; 4.221918] sound hdaudioC0D0:&#160; &#160; inputs:<br />[&#160; &#160; 4.221919] sound hdaudioC0D0:&#160; &#160; &#160; Front Mic=0x19<br />[&#160; &#160; 4.221921] sound hdaudioC0D0:&#160; &#160; &#160; Rear Mic=0x18<br />[&#160; &#160; 4.221922] sound hdaudioC0D0:&#160; &#160; &#160; Line=0x1a<br />[&#160; &#160; 4.234307] input: HDA Intel PCH Front Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input6<br />[&#160; &#160; 4.234879] input: HDA Intel PCH Rear Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input7<br />[&#160; &#160; 4.234930] input: HDA Intel PCH Line as /devices/pci0000:00/0000:00:1b.0/sound/card0/input8<br />[&#160; &#160; 4.235658] input: HDA Intel PCH Line Out as /devices/pci0000:00/0000:00:1b.0/sound/card0/input9<br />[&#160; &#160; 4.236186] input: HDA Intel PCH Front Headphone as /devices/pci0000:00/0000:00:1b.0/sound/card0/input10<br />[&#160; &#160; 4.237295] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).<br />[&#160; &#160; 4.258359] init: Failed to obtain startpar-bridge instance: Unknown parameter: INSTANCE<br />[&#160; &#160; 4.291101] r8169 0000:06:00.0 eth0: link down<br />[&#160; &#160; 4.291120] r8169 0000:06:00.0 eth0: link down<br />[&#160; &#160; 4.291144] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready<br />[&#160; &#160; 6.646476] r8169 0000:06:00.0 eth0: link up<br />[&#160; &#160; 6.646484] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready<br />[&#160; &#160; 9.469643] init: failsafe main process (690) killed by TERM signal<br />[&#160; &#160; 9.511040] audit_printk_skb: 21 callbacks suppressed<br />[&#160; &#160;10.109377] init: plymouth-upstart-bridge main process ended, respawning<br />[&#160; &#160;10.278910] cgroup: systemd-logind (574) created nested cgroup for controller &quot;memory&quot; which has incomplete hierarchy support. Nested cgroups may change behavior in the future.<br />[&#160; &#160;10.278913] cgroup: &quot;memory&quot; requires setting use_hierarchy to 1 on the root<br />[&#160; &#160;10.676638] random: nonblocking pool is initialized<br />[&#160; 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003)<br />[&#160; 166.777854] kvm: zapping shadow pages for mmio generation wraparound</p></div></blockquote></div><p>i saw some kvm zapping shadow pages here, and these dmesg show up when its on -vga none..</p><p>and when i removed -vga none, and i can enter the VM heres the dmesg :</p><div class="quotebox"><blockquote><div><p>[&#160; 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003)<br />[&#160; 166.777854] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; 262.768505] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; 269.342192] kvm [2329]: vcpu0 ignored rdmsr: 0x345<br />[&#160; 269.342216] kvm [2329]: vcpu0 ignored wrmsr: 0x680 data 0<br />[&#160; 269.342218] kvm [2329]: vcpu0 ignored wrmsr: 0x681 data 0<br />[&#160; 269.342219] kvm [2329]: vcpu0 ignored wrmsr: 0x682 data 0<br />[&#160; 269.342220] kvm [2329]: vcpu0 ignored wrmsr: 0x683 data 0<br />[&#160; 269.342222] kvm [2329]: vcpu0 ignored wrmsr: 0x684 data 0<br />[&#160; 269.342223] kvm [2329]: vcpu0 ignored wrmsr: 0x685 data 0<br />[&#160; 269.342224] kvm [2329]: vcpu0 ignored wrmsr: 0x686 data 0<br />[&#160; 269.342225] kvm [2329]: vcpu0 ignored wrmsr: 0x687 data 0<br />[&#160; 269.342227] kvm [2329]: vcpu0 ignored wrmsr: 0x688 data 0<br />[&#160; 269.342228] kvm [2329]: vcpu0 ignored wrmsr: 0x689 data 0</p></div></blockquote></div><p>Right over here i am stuck in order to try a GPU passthrough.. did i miss anything? or did my dmesg shows any incorrect steps that i&#039;ve been through? And also, why would the -vga none goes black instead of going to the VMs directly.. </p><p>So would someone help about this case? i&#039;ve been stuck for two weeks and nothing came up with any good.. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Thanks before !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501203">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501217" class="blockpost roweven"> <h2><span><span class="conr">#4124</span> <a href="viewtopic.php?pid=1501217#p1501217">2015-02-09 08:47:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>NVIDIA GRID K2 passthrough successful, but with code 43 after install nvidia driver.</p><p>driver info: 347.25-quadro-grid-desktop-notebook-win8-win7-64bit-international-whql</p><p>here is my qemu commandline:</p><p>#!/bin/sh</p><p>qemu-system-x86_64 -cpu host,kvm=off -smp 4,sockets=2,cores=2,threads=1 \<br />-m 8192 -M q35 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/var/lib/libvirt/images/LENOVO-TC-90-MSFT-2.1.BIN \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/var/lib/libvirt/images/win7_nvidia_k2_clean.img,cache=writeback,\<br />if=none,format=qcow2,aio=native,id=virtio-scsi-disk0 \<br />-device scsi-hd,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=52:54:00:1a:2b:3c \<br />-net tap,ifname=tap0,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown \<br />-vga none -nographic \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-monitor stdio</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501217">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501239" class="blockpost rowodd"> <h2><span><span class="conr">#4125</span> <a href="viewtopic.php?pid=1501239#p1501239">2015-02-09 11:38:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Pin vCPUs and don&#039;t oversubscribe physical CPUs if you expect the guest to handle latency sensitive tasks.&#160; You may also need to move host device interrupts to other CPUs.&#160; Use isolcpus if you really want to have vCPU isolation guarantees.</p></div></blockquote></div><p>Thank you aw.</p><p>I&#039;m already using isolcpus=2-7 and pinning vcpus for my guest.<br />The only thing I&#039;m not doing is moving my host device interrups. Do you have any script to do it?</p></div></blockquote></div><p>I don&#039;t have anything, but you want to manipulate /proc/irq/*/smp_affinity.&#160; You probably want to be careful only to do this for device interrupts (ie. things with IO-APIC or PCI-MSI in the type from /proc/interrupts).&#160; You&#039;ll also want to make sure irqbalance doesn&#039;t move interrutps back to your isolated CPUs, there&#039;s a IRQBALANCE_BANNED_CPUS environment variable that can be used to do that.</p><p>EDIT: I doubt an E3 v3 has it, but if /sys/module/kvm_intel/parameters/enable_apicv reports &#039;Y&#039; then by making sure assigned device interrupts come to a CPU not running the guest, KVM can inject the interrupt into the guest with forcing a VM exit.&#160; I also recall someone was using (I think) the nohz_full= boot option to stop timer ticks on the isolated CPUs.</p></div></blockquote></div><p>Thank you aw,</p><p>I did everything you suggested but in the end, disabling ASMedia SATA Controller did end my audio lag problems.</p><p>Now I have another little problem, I successfully installed openelec and passed through my GT 630, but shutdowns and restarts of the guest results in no video output.</p><p>The only solution I&#039;ve found so far to this problem is to reboot the host.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501239">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=164">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <strong>165</strong> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=166">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
