<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 7) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=7" title="Page 7" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=6" title="Page 6" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=8" title="Page 8" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=6">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=5">5</a> <a href="viewtopic.php?id=162768&amp;p=6">6</a> <strong>7</strong> <a href="viewtopic.php?id=162768&amp;p=8">8</a> <a href="viewtopic.php?id=162768&amp;p=9">9</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=8">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1290847" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#151</span> <a href="viewtopic.php?pid=1290847#p1290847">2013-06-22 04:49:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you for your help, it unfortunately however gave me the exact same error again. so i tried replacing my dtc with dtc-git, and again got the exact same error again. I uninstalled dtc and it compiles just fine.(thanks to you i knew dtc was the problem)</p><p>I initially tried to install qemu-git from aur like you suggested in your guide, which then lead me to the conflict with seabios (which i assume started with v 1.6 of qemu). one of the dependencies for qemu-git was dtc, that&#039;s how i got it. (i didn&#039;t install dtc-git, but just dtc. I in fact don&#039;t know the difference between git and not git, do you have a link to somewhere that can explain that to me? i try to avoid git builds because i just don&#039;t know what they are nor if to handle them differently than any other packages)</p><p>I like this fileswap thing you&#039;re using, so much better to download from than that filesend thing, since you don&#039;t have to wait for a download button <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Anyway, i&#039;ll try to use that last qemu build you sent me (without dtc installed) and the seabios files you sent as-well, tomorrow i&#039;ll try to learn how to use qemu to begin with since i never have (only virtualbox, vmware and microsofts thing) and after that we&#039;ll see how my attempt to passthrough will go! i&#039;ll get back to you when i get that far. Before i try though, i have a quick question or 2, do i need two monitors to do this? will it run windows 8? (i want to use it for it&#039;s performance over 7, otherwise i hate it&#039;s very existance, i&#039;ve heard reports of it not working with qemu)</p> <p class="postedit"><em>Last edited by rabcor (2013-06-22 05:49:26)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1290847">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1290858" class="blockpost roweven"> <h2><span><span class="conr">#152</span> <a href="viewtopic.php?pid=1290858#p1290858">2013-06-22 06:35:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Thank you for your help, it unfortunately however gave me the exact same error again. so i tried replacing my dtc with dtc-git, and again got the exact same error again. I uninstalled dtc and it compiles just fine.(thanks to you i knew dtc was the problem)</p><p>I initially tried to install qemu-git from aur like you suggested in your guide, which then lead me to the conflict with seabios (which i assume started with v 1.6 of qemu). one of the dependencies for qemu-git was dtc, that&#039;s how i got it. (i didn&#039;t install dtc-git, but just dtc. I in fact don&#039;t know the difference between git and not git, do you have a link to somewhere that can explain that to me? i try to avoid git builds because i just don&#039;t know what they are nor if to handle them differently than any other packages)</p><p>I like this fileswap thing you&#039;re using, so much better to download from than that filesend thing, since you don&#039;t have to wait for a download button <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Anyway, i&#039;ll try to use that last qemu build you sent me (without dtc installed) and the seabios files you sent as-well, tomorrow i&#039;ll try to learn how to use qemu to begin with since i never have (only virtualbox, vmware and microsofts thing) and after that we&#039;ll see how my attempt to passthrough will go! i&#039;ll get back to you when i get that far. Before i try though, i have a quick question or 2, do i need two monitors to do this? will it run windows 8? (i want to use it for it&#039;s performance over 7, otherwise i hate it&#039;s very existance, i&#039;ve heard reports of it not working with qemu)</p></div></blockquote></div><p>yes it will run windows 8, im using it atm</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1290858">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291270" class="blockpost rowodd"> <h2><span><span class="conr">#153</span> <a href="viewtopic.php?pid=1291270#p1291270">2013-06-23 05:23:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I don&#039;t know how to be able to tell if my board supports Interrupt Remapping</p><p>but when i try to run vfio-bind it says</p><div class="codebox"><pre><code># vfio-bind 0000:01:00.0 ls: cannot access /sys/bus/pci/devices/0000:01:00.0/iommu_group/devices: No such file or directory</code></pre></div><p>if i run</p><div class="codebox"><pre><code># ls /sys/bus/pci/devices/0000\:01\:00.0/</code></pre></div><p>(yes it requests &quot;\&quot;s like as if there are spaces between, i don&#039;t know why)<br />it doesn&#039;t give me any iommu directory so i assume this is because i didn&#039;t know how to add</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>to my grub.cfg, i did some googling but didn&#039;t find out how, i tried to add it myself in a place that looked about right but it did nothing</p><div class="codebox"><pre><code># cat /proc/cmdline BOOT_IMAGE=/vmlinuz-linux root=UUID=876f6b61-7387-489e-b980-d42deb194c34 ro quiet</code></pre></div><p>where am i supposed to add the line?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291289" class="blockpost roweven"> <h2><span><span class="conr">#154</span> <a href="viewtopic.php?pid=1291289#p1291289">2013-06-23 07:14:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I don&#039;t know how to be able to tell if my board supports Interrupt Remapping</p><p>but when i try to run vfio-bind it says</p><div class="codebox"><pre><code># vfio-bind 0000:01:00.0 ls: cannot access /sys/bus/pci/devices/0000:01:00.0/iommu_group/devices: No such file or directory</code></pre></div><p>if i run</p><div class="codebox"><pre><code># ls /sys/bus/pci/devices/0000\:01\:00.0/</code></pre></div><p>(yes it requests &quot;\&quot;s like as if there are spaces between, i don&#039;t know why)<br />it doesn&#039;t give me any iommu directory so i assume this is because i didn&#039;t know how to add</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>to my grub.cfg, i did some googling but didn&#039;t find out how, i tried to add it myself in a place that looked about right but it did nothing</p><div class="codebox"><pre><code># cat /proc/cmdline BOOT_IMAGE=/vmlinuz-linux root=UUID=876f6b61-7387-489e-b980-d42deb194c34 ro quiet</code></pre></div><p>where am i supposed to add the line?</p></div></blockquote></div><div class="codebox"><pre><code>echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/vfio_iommu_type1.conf</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291532" class="blockpost rowodd"> <h2><span><span class="conr">#155</span> <a href="viewtopic.php?pid=1291532#p1291532">2013-06-23 20:04:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I had already done that, and the kvm thing too. think the problem might be that my proprietary nvidia drivers are running? (should i uninstall them?)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291532">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291542" class="blockpost roweven"> <h2><span><span class="conr">#156</span> <a href="viewtopic.php?pid=1291542#p1291542">2013-06-23 20:11:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I had already done that, and the kvm thing too. think the problem might be that my proprietary nvidia drivers are running? (should i uninstall them?)</p></div></blockquote></div><p>There&#039;s a <a href="http://bpaste.net/show/109185/" rel="nofollow">patch</a> for them, but using nouveau works too.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291542">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291592" class="blockpost rowodd"> <h2><span><span class="conr">#157</span> <a href="viewtopic.php?pid=1291592#p1291592">2013-06-23 22:23:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72586">dogblue</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-23</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dogblue@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>EDIT: This issue was fixed by blacklisting the nouveau module.</p><p>Hi all,</p><p>I have spent most of the last couple of days trying to get this to work, with no luck so far.<br />As soon as I launch the virtual machine my entire computer will freeze and require a cold reboot.</p><p>Hardware is ASRock 970 Extreme3 motherboard, AMD FX CPU, NVidia GT 520 GPU (Primary, nouveau), AMD HD 7750 GPU (Secondary, passthrough).</p><p>I am using the AUR/ABS packages that nbhs posted a page or two ago.</p><p>I get an error on boot regarding the ivrs_ioapic lines</p><div class="codebox"><pre><code>/bin/init: eval: line 1: ivrs_ioapic[9]=00:14.0: not found /bin/init: eval: line 1: ivrs_ioapic[10]=00:00.1: not found</code></pre></div><p>I&#039;ve attached as much additional information to this post as I can in the hope that someone will be able to offer a suggestion as to how I should proceed, as I am completely out of ideas.</p><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=8ff5d0cb-77d4-403f-9387-e04405a329e7 ro iommu=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1 acpi_sleep=s3_bios,s3_mode pci-stub.ids=1002:683f,1002:aab0 vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>lspci -v (abridged output)</p><div class="codebox"><pre class="vscroll"><code>01:00.0 VGA compatible controller: NVIDIA Corporation GF119 [GeForce GT 520] (rev a1) (prog-if 00 [VGA controller]) Subsystem: Gigabyte Technology Co., Ltd Device 352f Flags: bus master, fast devsel, latency 0, IRQ 24 Memory at fd000000 (32-bit, non-prefetchable) [size=16M] Memory at d0000000 (64-bit, prefetchable) [size=128M] Memory at d8000000 (64-bit, prefetchable) [size=32M] I/O ports at e000 [size=128] Expansion ROM at fe000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: nouveau Kernel modules: nouveau 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750] (prog-if 00 [VGA controller]) Subsystem: Hightech Information System Ltd. Device 2318 Flags: fast devsel, IRQ 10 Memory at c0000000 (64-bit, prefetchable) [disabled] [size=256M] Memory at fe200000 (64-bit, non-prefetchable) [disabled] [size=256K] I/O ports at d000 [disabled] [size=256] Expansion ROM at fe240000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [270] #19 Kernel driver in use: pci-stub Kernel modules: radeon 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] Subsystem: Hightech Information System Ltd. Device aab0 Flags: bus master, fast devsel, latency 0, IRQ 11 Memory at fe260000 (64-bit, non-prefetchable) [size=16K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Kernel driver in use: pci-stub Kernel modules: snd_hda_intel</code></pre></div><p>I am attempting to start the VM with the following script. The machine displays a black qemu window and then halts (the whole computer, not just the VM) as soon as I run it.</p><div class="codebox"><pre><code>#!/bin/sh #DEVICES=&quot;0000:00:11.0 0000:04:00.0 0000:05:00.0 0000:06:00.0 0000:07:00.0 000:07:00.1&quot; DEVICES=&quot;0000:02:00.0 0000:02:00.1&quot; ./vfio-bind $DEVICES qemu-system-x86_64 --enable-kvm -M q35 -m 512 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1</code></pre></div><p>I would really appreciate any help that you all can offer. I actually purchased this machine a few days ago specifically to follow this guide, so I&#039;m really looking forward to getting it all working!</p><p>Thanks in advance.</p> <p class="postedit"><em>Last edited by dogblue (2013-06-24 21:35:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291592">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291661" class="blockpost roweven"> <h2><span><span class="conr">#158</span> <a href="viewtopic.php?pid=1291661#p1291661">2013-06-24 03:16:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dogblue wrote:</cite><blockquote><div><p>Hi all,</p><p>I have spent most of the last couple of days trying to get this to work, with no luck so far.<br />As soon as I launch the virtual machine my entire computer will freeze and require a cold reboot.</p><p>Hardware is ASRock 970 Extreme3 motherboard, AMD FX CPU, NVidia GT 520 GPU (Primary, nouveau), AMD HD 7750 GPU (Secondary, passthrough).</p><p>I am using the AUR/ABS packages that nbhs posted a page or two ago.</p><p>I get an error on boot regarding the ivrs_ioapic lines</p><div class="codebox"><pre><code>/bin/init: eval: line 1: ivrs_ioapic[9]=00:14.0: not found /bin/init: eval: line 1: ivrs_ioapic[10]=00:00.1: not found</code></pre></div><p>I&#039;ve attached as much additional information to this post as I can in the hope that someone will be able to offer a suggestion as to how I should proceed, as I am completely out of ideas.</p><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=8ff5d0cb-77d4-403f-9387-e04405a329e7 ro iommu=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1 acpi_sleep=s3_bios,s3_mode pci-stub.ids=1002:683f,1002:aab0 vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>lspci -v (abridged output)</p><div class="codebox"><pre class="vscroll"><code>01:00.0 VGA compatible controller: NVIDIA Corporation GF119 [GeForce GT 520] (rev a1) (prog-if 00 [VGA controller]) Subsystem: Gigabyte Technology Co., Ltd Device 352f Flags: bus master, fast devsel, latency 0, IRQ 24 Memory at fd000000 (32-bit, non-prefetchable) [size=16M] Memory at d0000000 (64-bit, prefetchable) [size=128M] Memory at d8000000 (64-bit, prefetchable) [size=32M] I/O ports at e000 [size=128] Expansion ROM at fe000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: nouveau Kernel modules: nouveau 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750] (prog-if 00 [VGA controller]) Subsystem: Hightech Information System Ltd. Device 2318 Flags: fast devsel, IRQ 10 Memory at c0000000 (64-bit, prefetchable) [disabled] [size=256M] Memory at fe200000 (64-bit, non-prefetchable) [disabled] [size=256K] I/O ports at d000 [disabled] [size=256] Expansion ROM at fe240000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [270] #19 Kernel driver in use: pci-stub Kernel modules: radeon 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] Subsystem: Hightech Information System Ltd. Device aab0 Flags: bus master, fast devsel, latency 0, IRQ 11 Memory at fe260000 (64-bit, non-prefetchable) [size=16K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Kernel driver in use: pci-stub Kernel modules: snd_hda_intel</code></pre></div><p>I am attempting to start the VM with the following script. The machine displays a black qemu window and then halts (the whole computer, not just the VM) as soon as I run it.</p><div class="codebox"><pre><code>#!/bin/sh #DEVICES=&quot;0000:00:11.0 0000:04:00.0 0000:05:00.0 0000:06:00.0 0000:07:00.0 000:07:00.1&quot; DEVICES=&quot;0000:02:00.0 0000:02:00.1&quot; ./vfio-bind $DEVICES qemu-system-x86_64 --enable-kvm -M q35 -m 512 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1</code></pre></div><p>I would really appreciate any help that you all can offer. I actually purchased this machine a few days ago specifically to follow this guide, so I&#039;m really looking forward to getting it all working!</p><p>Thanks in advance.</p></div></blockquote></div><p>Those eval errors are normal dont worry about it. If you&#039;re overriding the ivrs table to enable intremap you dont need this line</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>Could you post your dmesg output?</p><p>Have you blacklisted the radeon or fglrx driver first? Also if you&#039;re using nvidia proprietary drivers you&#039;ll need to patch it (see andy123 post above). I would suggest uninstalling/blacklisting all the drivers first, and try to bind the devices with the script manually, then launch qemu.</p> <p class="postedit"><em>Last edited by nbhs (2013-06-24 03:18:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291661">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291663" class="blockpost rowodd"> <h2><span><span class="conr">#159</span> <a href="viewtopic.php?pid=1291663#p1291663">2013-06-24 03:20:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I had already done that, and the kvm thing too. think the problem might be that my proprietary nvidia drivers are running? (should i uninstall them?)</p></div></blockquote></div><p>Just to make sure can you build/rebuild the linux-mainline package i posted with:</p><div class="codebox"><pre><code>CONFIG_VFIO_IOMMU_TYPE1=y CONFIG_VFIO=y CONFIG_VFIO_PCI=y CONFIG_VFIO_PCI_VGA=y</code></pre></div><p>Could you be a little more specific about your hardware?, If your primary display is nvidia, and you&#039;re using nvidia proprietary drivers see andy123 post above.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291663">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291810" class="blockpost roweven"> <h2><span><span class="conr">#160</span> <a href="viewtopic.php?pid=1291810#p1291810">2013-06-24 12:16:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72586">dogblue</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-23</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dogblue@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi nbhs, thanks for the suggestions (and the guide!)</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Those eval errors are normal dont worry about it. If you&#039;re overriding the ivrs table to enable intremap you dont need this line</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div></div></blockquote></div><p>Understood, I&#039;ve removed that kernel option and tried again.</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Could you post your dmesg output?</p></div></blockquote></div><p>Absolutely. <a href="http://pastebin.com/iqmLCsqq" rel="nofollow">http://pastebin.com/iqmLCsqq</a></p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Have you blacklisted the radeon or fglrx driver first? Also if you&#039;re using nvidia proprietary drivers you&#039;ll need to patch it (see andy123 post above).</p></div></blockquote></div><p>I have blacklisted the radeon driver as well as added the id&#039;s to pci-stub. I am also using the nouveau driver for the nvidia card, so that shouldn&#039;t be an issue at least.</p><div class="quotebox"><blockquote><div><p>I would suggest uninstalling/blacklisting all the drivers first, and try to bind the devices with the script manually, then launch qemu.</p></div></blockquote></div><p>As far as I can tell the radeon module is blacklisted, and fglrx and the binary nvidia drivers have never been installed.</p><p>Here is what the drivers look like just prior to running the qemu command (after binding the devices with the vfio-bind script)</p><div class="codebox"><pre><code># ls /sys/bus/pci/drivers/vfio-pci/ 0000:02:00.0 0000:02:00.1 bind module new_id remove_id uevent unbind # ls /sys/bus/pci/drivers/nouveau/ 0000:01:00.0 bind module new_id remove_id uevent unbind # cat /etc/modprobe.d/kvm.conf options kvm ignore_msrs=1 # cat /etc/modprobe.d/blacklist.conf blacklist radeon</code></pre></div><p>I was also able to retrieve the following output by running &#039;cat /proc/kmsg&#039; during the crash</p><div class="codebox"><pre><code>&lt;6&gt;[ 996.181525] vfio-pci 0000:02:00.0: enabling device (0000 -&gt; 0003) &lt;6&gt;[ 996.207159] vfio_ecap_init: 0000:02:00.0 hiding ecap 0x19@0x270 &lt;6&gt;[ 998.065072] vgaarb: device changed decodes: PCI:0000:01:00.0,olddecodes=io+mem,decodes=none:owns=io+mem &lt;6&gt;[ 998.065076] vgaarb: transferring owner from PCI:0000:01:00.0 to PCI:0000:02:00.0 &lt;3&gt;[ 998.095398] ata3: illegal qc_active transition (00000001-&gt;97b282a8) &lt;3&gt;[ 998.095540] ata3.00: exception Emask 0x2 SAct 0x0 SErr 0xd0000000 action 0x6 frozen &lt;3&gt;[ 998.095567] ata3: SError: { } &lt;3&gt;[ 998.095580] ata3.00: failed command: FLUSH CACHE EXT &lt;3&gt;[ 998.095607] ata3.00: cmd ea/00:00:00:00:00/00:00:00:00:00/a0 tag 0 &lt;3&gt;[ 998.095607] res 40/00:00:00:00:00/00:00:00:00:00/a0 Emask 0x2 (HSM violation) &lt;3&gt;[ 998.095637] ata3.00: status: { DRDY } &lt;6&gt;[ 998.095653] ata3: hard resetting link &lt;4&gt;[ 998.103575] Clocksource tsc unstable (delta = -147227892866 ns)</code></pre></div><p>Thanks again for your help!</p> <p class="postedit"><em>Last edited by dogblue (2013-06-24 12:18:50)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291810">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1291899" class="blockpost rowodd"> <h2><span><span class="conr">#161</span> <a href="viewtopic.php?pid=1291899#p1291899">2013-06-24 15:16:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dogblue wrote:</cite><blockquote><div><p>Hi nbhs, thanks for the suggestions (and the guide!)</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Those eval errors are normal dont worry about it. If you&#039;re overriding the ivrs table to enable intremap you dont need this line</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div></div></blockquote></div><p>Understood, I&#039;ve removed that kernel option and tried again.</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Could you post your dmesg output?</p></div></blockquote></div><p>Absolutely. <a href="http://pastebin.com/iqmLCsqq" rel="nofollow">http://pastebin.com/iqmLCsqq</a></p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Have you blacklisted the radeon or fglrx driver first? Also if you&#039;re using nvidia proprietary drivers you&#039;ll need to patch it (see andy123 post above).</p></div></blockquote></div><p>I have blacklisted the radeon driver as well as added the id&#039;s to pci-stub. I am also using the nouveau driver for the nvidia card, so that shouldn&#039;t be an issue at least.</p><div class="quotebox"><blockquote><div><p>I would suggest uninstalling/blacklisting all the drivers first, and try to bind the devices with the script manually, then launch qemu.</p></div></blockquote></div><p>As far as I can tell the radeon module is blacklisted, and fglrx and the binary nvidia drivers have never been installed.</p><p>Here is what the drivers look like just prior to running the qemu command (after binding the devices with the vfio-bind script)</p><div class="codebox"><pre><code># ls /sys/bus/pci/drivers/vfio-pci/ 0000:02:00.0 0000:02:00.1 bind module new_id remove_id uevent unbind # ls /sys/bus/pci/drivers/nouveau/ 0000:01:00.0 bind module new_id remove_id uevent unbind # cat /etc/modprobe.d/kvm.conf options kvm ignore_msrs=1 # cat /etc/modprobe.d/blacklist.conf blacklist radeon</code></pre></div><p>I was also able to retrieve the following output by running &#039;cat /proc/kmsg&#039; during the crash</p><div class="codebox"><pre><code>&lt;6&gt;[ 996.181525] vfio-pci 0000:02:00.0: enabling device (0000 -&gt; 0003) &lt;6&gt;[ 996.207159] vfio_ecap_init: 0000:02:00.0 hiding ecap 0x19@0x270 &lt;6&gt;[ 998.065072] vgaarb: device changed decodes: PCI:0000:01:00.0,olddecodes=io+mem,decodes=none:owns=io+mem &lt;6&gt;[ 998.065076] vgaarb: transferring owner from PCI:0000:01:00.0 to PCI:0000:02:00.0 &lt;3&gt;[ 998.095398] ata3: illegal qc_active transition (00000001-&gt;97b282a8) &lt;3&gt;[ 998.095540] ata3.00: exception Emask 0x2 SAct 0x0 SErr 0xd0000000 action 0x6 frozen &lt;3&gt;[ 998.095567] ata3: SError: { } &lt;3&gt;[ 998.095580] ata3.00: failed command: FLUSH CACHE EXT &lt;3&gt;[ 998.095607] ata3.00: cmd ea/00:00:00:00:00/00:00:00:00:00/a0 tag 0 &lt;3&gt;[ 998.095607] res 40/00:00:00:00:00/00:00:00:00:00/a0 Emask 0x2 (HSM violation) &lt;3&gt;[ 998.095637] ata3.00: status: { DRDY } &lt;6&gt;[ 998.095653] ata3: hard resetting link &lt;4&gt;[ 998.103575] Clocksource tsc unstable (delta = -147227892866 ns)</code></pre></div><p>Thanks again for your help!</p></div></blockquote></div><br /><p>Have you tried to blacklist the nouveau module and start without X? take a look at this post, it seems to describe your problem: <a href="http://www.mail-archive.com/qemu-devel@nongnu.org/msg173628.html" rel="nofollow">http://www.mail-archive.com/qemu-devel@ … 73628.html</a>,</p><div class="quotebox"><blockquote><div><p>2) If the &#039;nouveau.ko&#039; driver is loaded it is even more strange. As soon<br />as I start qemu all my SATA links get a hard reset and kernel freezes.<br />No SysRQs are working anymore and only reboot helps. If needed I can<br />look if I can get some dumps from this freeze because it writes nothing<br />more to the disks.</p></div></blockquote></div><p>It seems he solved the problem using patched nvidia proprietary drivers as described here: <a href="http://www.mail-archive.com/qemu-devel@nongnu.org/msg174066.html" rel="nofollow">http://www.mail-archive.com/qemu-devel@ … 74066.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1291899">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292051" class="blockpost roweven"> <h2><span><span class="conr">#162</span> <a href="viewtopic.php?pid=1292051#p1292051">2013-06-24 21:34:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72586">dogblue</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-23</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:dogblue@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Have you tried to blacklist the nouveau module and start without X? take a look at this post, it seems to describe your problem: <a href="http://www.mail-archive.com/qemu-devel@nongnu.org/msg173628.html" rel="nofollow">http://www.mail-archive.com/qemu-devel@ … 73628.html</a>,</p></div></blockquote></div><p>That was it!<br />Blacklisting nouveau fixed it. No more crashes on starting the VM.</p><p>Thank you so much for all your help!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292143" class="blockpost rowodd"> <h2><span><span class="conr">#163</span> <a href="viewtopic.php?pid=1292143#p1292143">2013-06-25 03:20:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dogblue wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Have you tried to blacklist the nouveau module and start without X? take a look at this post, it seems to describe your problem: <a href="http://www.mail-archive.com/qemu-devel@nongnu.org/msg173628.html" rel="nofollow">http://www.mail-archive.com/qemu-devel@ … 73628.html</a>,</p></div></blockquote></div><p>That was it!<br />Blacklisting nouveau fixed it. No more crashes on starting the VM.</p><p>Thank you so much for all your help!!</p></div></blockquote></div><p>NIce! have you tried the patched nvidia drivers yet?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292143">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292236" class="blockpost roweven"> <h2><span><span class="conr">#164</span> <a href="viewtopic.php?pid=1292236#p1292236">2013-06-25 11:16:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=54325">blackout23</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/54325.jpg?m=1329225999" width="80" height="75" alt="" /></dd> <dd><span>Registered: 2011-11-16</span></dd> <dd><span>Posts: 765</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=54325">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just wanted to thank you for this great thread and all the effort you put into it!</p><p>I have looked at VGA-Passthrough with Xen in the past but this Wiki article <a href="http://wiki.xen.org/wiki/Xen_VGA_Passthrough_Tested_Adapters#Nvidia_display_adapters" rel="nofollow">here</a> has diminished my hopes a bit. What makes me wonder is why it says &quot;400 Series and 600 Series should work&quot; after some hacking and only on Windows XP. Since I have a GTX 580 OC I wonder why the 500 series was excluded in this wiki. Maybe this means I can&#039;t use it with your KVM tutorial, too?</p><p>My rig currently consists of a Intel i7 2600K @ 4.5 Ghz, 8 GB RAM, ASUS P8Z86-V Pro and GTX 580 @ 900 Mhz. If no one has ever tried a 500 series card I might have to do that and report back.</p> <p class="postedit"><em>Last edited by blackout23 (2013-06-25 11:30:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292236">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292240" class="blockpost rowodd"> <h2><span><span class="conr">#165</span> <a href="viewtopic.php?pid=1292240#p1292240">2013-06-25 11:31:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Just to make sure can you build/rebuild the linux-mainline package i posted with:...</p><p>Could you be a little more specific about your hardware?, If your primary display is nvidia, and you&#039;re using nvidia proprietary drivers see andy123 post above.</p></div></blockquote></div><p>Yosh! i got it right!</p><p>My hardware setup is intel igpu for linux and nvidia gtx 670 for passthrough, my motherboard supports this and it&#039;s turned on, and i assume my i7 does as-well.</p><p>I don&#039;t know if it was setting these settings to Y or if it was setting</p><p>CONFIG_INTEL_IOMMU_DEFAULT_ON=y</p><p>that did it. but it worked and vfio-bind worked on 0000:01:00.0 and 1</p><div class="codebox"><pre><code>#lspci ... 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 670] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) ...</code></pre></div><p>now my next problem is</p><div class="codebox"><pre><code># qemu-system-x86_64 --enable-kvm -M q35 -m 1024 -cpu host \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci, host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Gives me</p><div class="codebox"><pre><code>qemu-system-x86_64: -cpu host: could not open disk image -smp: No such file or directory</code></pre></div> <p class="postedit"><em>Last edited by rabcor (2013-06-26 05:45:54)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292240">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292310" class="blockpost roweven"> <h2><span><span class="conr">#166</span> <a href="viewtopic.php?pid=1292310#p1292310">2013-06-25 15:32:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Just to make sure can you build/rebuild the linux-mainline package i posted with:...</p><p>Could you be a little more specific about your hardware?, If your primary display is nvidia, and you&#039;re using nvidia proprietary drivers see andy123 post above.</p></div></blockquote></div><p>Yosh! i got it right!</p><p>My hardware setup is intel igpu for linux and nvidia gtx 670 for passthrough, my motherboard supports this and it&#039;s turned on, and i assume my i7 does as-well.</p><p>I don&#039;t know if it was setting these settings to Y or if it was setting</p><p>CONFIG_INTEL_IOMMU_DEFAULT_ON=y</p><p>that did it. but it worked and vfio-bind worked on 0000:01:00.0 and 1</p><div class="codebox"><pre><code>#lspci ... 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 670] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) ...</code></pre></div><p>now my next problem is</p><div class="codebox"><pre><code># qemu-system-x86_64 --enable-kvm -M q35 -m 1024 -cpu host \ -smp 6, sockets=1, cores=6, threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci, host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Gives me</p><div class="codebox"><pre><code>qemu-system-x86_64: -cpu host: could not open disk image -smp: No such file or directory</code></pre></div></div></blockquote></div><p>i think it is this line</p><div class="codebox"><pre><code>-smp 6, sockets=1, cores=6, threads=1</code></pre></div><p>to:</p><div class="codebox"><pre><code>-smp 6,sockets=1,cores=6,threads=1 </code></pre></div><p>You should know that, from previous users, using the igp as primary might not work</p> <p class="postedit"><em>Last edited by nbhs (2013-06-25 15:33:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292310">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292313" class="blockpost rowodd"> <h2><span><span class="conr">#167</span> <a href="viewtopic.php?pid=1292313#p1292313">2013-06-25 15:36:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>blackout23 wrote:</cite><blockquote><div><p>I just wanted to thank you for this great thread and all the effort you put into it!</p><p>I have looked at VGA-Passthrough with Xen in the past but this Wiki article <a href="http://wiki.xen.org/wiki/Xen_VGA_Passthrough_Tested_Adapters#Nvidia_display_adapters" rel="nofollow">here</a> has diminished my hopes a bit. What makes me wonder is why it says &quot;400 Series and 600 Series should work&quot; after some hacking and only on Windows XP. Since I have a GTX 580 OC I wonder why the 500 series was excluded in this wiki. Maybe this means I can&#039;t use it with your KVM tutorial, too?</p><p>My rig currently consists of a Intel i7 2600K @ 4.5 Ghz, 8 GB RAM, ASUS P8Z86-V Pro and GTX 580 @ 900 Mhz. If no one has ever tried a 500 series card I might have to do that and report back.</p></div></blockquote></div><p>I think it means no one has tried it yet since this is experimental.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292313">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292326" class="blockpost roweven"> <h2><span><span class="conr">#168</span> <a href="viewtopic.php?pid=1292326#p1292326">2013-06-25 16:05:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>i think it is this line</p><div class="codebox"><pre><code>-smp 6, sockets=1, cores=6, threads=1</code></pre></div><p>to:</p><div class="codebox"><pre><code>-smp 6,sockets=1,cores=6,threads=1 </code></pre></div><p>You should know that, from previous users, using the igp as primary might not work</p></div></blockquote></div><p>I tried that, it made no difference, i got the same error. </p><p>Even if it may not work with igp as primary, i&#039;m sure it should be possible to make it past an error like that (if we can figure out the cause). I have no idea how to troubleshoot this, i don&#039;t even know what the error means to tell the truth. But if it&#039;s caused by the igp i will probably just buy another gpu later for this.</p> <p class="postedit"><em>Last edited by rabcor (2013-06-25 18:05:21)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292326">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292533" class="blockpost rowodd"> <h2><span><span class="conr">#169</span> <a href="viewtopic.php?pid=1292533#p1292533">2013-06-26 00:15:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72641">alpha_one_x86</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-26</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72641">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,<br />My kernel line used:<br />/kernel-genkernel-x86_64-3.9.6-gentoo root=/dev/sda2 ro radeon.audio=1 debug kvm-intel.nested=1 iommu=1 pci-stub.ids=1002:68f9,1002:aa68 ivrs_ioapic[9]=00:14.0<br />(You don&#039;t say how/why you use ivrs_ioapic, isn&#039;t it?).<br />I have an intel card (for my host), and an ATI 5450 for windows. I have uninstall all the radeon kernel module, but I have:<br />-device vfio-pci,host=01:00.0,addr=00.0,multifunction=on: PCI: slot 0 function 0 not available for vfio-pci, in use by i440FX<br />If you can help me, cheer,</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292533">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292570" class="blockpost roweven"> <h2><span><span class="conr">#170</span> <a href="viewtopic.php?pid=1292570#p1292570">2013-06-26 03:01:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>i think it is this line</p><div class="codebox"><pre><code>-smp 6, sockets=1, cores=6, threads=1</code></pre></div><p>to:</p><div class="codebox"><pre><code>-smp 6,sockets=1,cores=6,threads=1 </code></pre></div><p>You should know that, from previous users, using the igp as primary might not work</p></div></blockquote></div><p>I tried that, it made no difference, i got the same error. </p><p>Even if it may not work with igp as primary, i&#039;m sure it should be possible to make it past an error like that (if we can figure out the cause). I have no idea how to troubleshoot this, i don&#039;t even know what the error means to tell the truth. But if it&#039;s caused by the igp i will probably just buy another gpu later for this.</p></div></blockquote></div><p>I think its this typo i overlooked before</p><div class="codebox"><pre><code>--enable-kvm</code></pre></div><p>change to:</p><div class="codebox"><pre><code>-enable-kvm</code></pre></div><p>Right now AMD mobo/cpu users have like 90% chance of getting this to work, even mixing nvidia/amd cards and with broken ivrs tables, remember this is work in progress, so i wouldn&#039;t waste money yet only to find it doesn&#039;t work, but im prety sure it will in the near future.</p> <p class="postedit"><em>Last edited by nbhs (2013-06-26 03:24:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292570">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292574" class="blockpost rowodd"> <h2><span><span class="conr">#171</span> <a href="viewtopic.php?pid=1292574#p1292574">2013-06-26 03:07:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alpha_one_x86 wrote:</cite><blockquote><div><p>Hello,<br />My kernel line used:<br />/kernel-genkernel-x86_64-3.9.6-gentoo root=/dev/sda2 ro radeon.audio=1 debug kvm-intel.nested=1 iommu=1 pci-stub.ids=1002:68f9,1002:aa68 ivrs_ioapic[9]=00:14.0<br />(You don&#039;t say how/why you use ivrs_ioapic, isn&#039;t it?).</p></div></blockquote></div><p>If you&#039;re using an intel board you shouldnt be using ivrs_ioapic override, this is a workarround for amd boards</p><div class="quotebox"><cite>alpha_one_x86 wrote:</cite><blockquote><div><p>I have an intel card (for my host), and an ATI 5450 for windows. I have uninstall all the radeon kernel module, but I have:<br />-device vfio-pci,host=01:00.0,addr=00.0,multifunction=on: PCI: slot 0 function 0 not available for vfio-pci, in use by i440FX<br />If you can help me, cheer,</p></div></blockquote></div><p>Yeah change this:</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.0,addr=00.0,multifunction=on</code></pre></div><p>to this:</p><div class="codebox"><pre><code>-device vfio-pci,host=01:00.0,multifunction=on</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292574">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292590" class="blockpost roweven"> <h2><span><span class="conr">#172</span> <a href="viewtopic.php?pid=1292590#p1292590">2013-06-26 05:53:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I think its this typo i overlooked before</p><div class="codebox"><pre><code>--enable-kvm</code></pre></div><p>change to:</p><div class="codebox"><pre><code>-enable-kvm</code></pre></div><p>Right now AMD mobo/cpu users have like 90% chance of getting this to work, even mixing nvidia/amd cards and with broken ivrs tables, remember this is work in progress, so i wouldn&#039;t waste money yet only to find it doesn&#039;t work, but im prety sure it will in the near future.</p></div></blockquote></div><p>still nothing, i figured it seems to think that&#160; &quot;-cpu host&quot; should be a disk image (which it cannot find) and that &quot;-smp&quot; should be a directory, which it also cannot find</p><p>if i remove &quot;-cpu host \ -smp ....&quot; it will give me the same error</p><div class="codebox"><pre><code># qemu-system-x86_64 -enable-kvm -M q35 -m 1024 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci, host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64: -m 1024: could not open disk image -bios: No such file or directory</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292590">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292629" class="blockpost rowodd"> <h2><span><span class="conr">#173</span> <a href="viewtopic.php?pid=1292629#p1292629">2013-06-26 08:58:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72641">alpha_one_x86</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-26</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72641">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I have:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: vfio_dma_map(0x7fc3e881f800, 0xfffe0000, 0x20000, 0x7fc3e0a00000) = -12 (Cannot allocate memory)<br />qemu-system-x86_64: vfio_dma_map(0x7fc3e881f800, 0xc8000, 0x18000, 0x7fc3e0808000) = -12 (Cannot allocate memory)<br />I have checked all into the web (right problem, iommu, ...)<br />I&#039;m with intel haswell + linux 3.9.<br />What I should test?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292629">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292637" class="blockpost roweven"> <h2><span><span class="conr">#174</span> <a href="viewtopic.php?pid=1292637#p1292637">2013-06-26 09:11:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alpha_one_x86 wrote:</cite><blockquote><div><p>qemu-system-x86_64: -device vfio-pci,host=01:00.0,multifunction=on: vfio_dma_map(0x7fc3e881f800, 0xfffe0000, 0x20000, 0x7fc3e0a00000) = -12 (Cannot allocate memory)<br />qemu-system-x86_64: vfio_dma_map(0x7fc3e881f800, 0xc8000, 0x18000, 0x7fc3e0808000) = -12 (Cannot allocate memory)<br />[…]<br />What I should test?</p></div></blockquote></div><p>Sounds to me like mem-path/hugepages issues. You should probably read some things about hugepages, remove the mem-path option or lower the memory (-m parameter).</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292637">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1292639" class="blockpost rowodd"> <h2><span><span class="conr">#175</span> <a href="viewtopic.php?pid=1292639#p1292639">2013-06-26 09:19:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72641">alpha_one_x86</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-26</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72641">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>remove the mem-path option</p></div></blockquote></div><p>How? I have not this options.<br />Already checked for the rest, tested with 512, I can&#039;t do less.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1292639">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=6">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=5">5</a> <a href="viewtopic.php?id=162768&amp;p=6">6</a> <strong>7</strong> <a href="viewtopic.php?id=162768&amp;p=8">8</a> <a href="viewtopic.php?id=162768&amp;p=9">9</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=8">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
