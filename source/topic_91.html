<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 91) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=91" title="Page 91" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=90" title="Page 90" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=92" title="Page 92" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=90">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=89">89</a> <a href="viewtopic.php?id=162768&amp;p=90">90</a> <strong>91</strong> <a href="viewtopic.php?id=162768&amp;p=92">92</a> <a href="viewtopic.php?id=162768&amp;p=93">93</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=92">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1431654" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2251</span> <a href="viewtopic.php?pid=1431654#p1431654">2014-06-30 19:27:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am sure that I havn&#039;t seen this parameter ever and it was working.</p><p>Nevertheless I have added it with no success.</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ dmesg | grep BOOT_IMAGE [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431654">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431655" class="blockpost roweven"> <h2><span><span class="conr">#2252</span> <a href="viewtopic.php?pid=1431655#p1431655">2014-06-30 19:31:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>I am sure that I havn&#039;t seen this parameter ever and it was working.</p><p>Nevertheless I have added it with no success.</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ dmesg | grep BOOT_IMAGE [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2</code></pre></div></div></blockquote></div><p>Perhaps you should report what&#039;s in group 1 (ll /sys/kernel/iommu_groups/1/devices/) and what those devices are bound to (lspci -k) so we have a remote shot at helping.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431655">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431659" class="blockpost rowodd"> <h2><span><span class="conr">#2253</span> <a href="viewtopic.php?pid=1431659#p1431659">2014-06-30 19:49:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>yes of course</p><div class="codebox"><pre><code>[pheinrich@ARCH bin]$ ls -l -a --color=auto /sys/kernel/iommu_groups/1/devices/ total 0 drwxr-xr-x 2 root root 0 Jun 30 21:47 . drwxr-xr-x 3 root root 0 Jun 30 21:47 .. lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:00:01.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:00:01.1 -&gt; ../../../../devices/pci0000:00/0000:00:01.1 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:01:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:02:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0</code></pre></div><div class="codebox"><pre class="vscroll"><code>[pheinrich@ARCH bin]$ lspci -k 00:00.0 Host bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor DRAM Controller (rev 09) Subsystem: ASUSTeK Computer Inc. Device 844d 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port (rev 09) Kernel driver in use: pcieport Kernel modules: shpchp 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port (rev 09) Kernel driver in use: pcieport Kernel modules: shpchp 00:16.0 Communication controller: Intel Corporation 6 Series/C200 Series Chipset Family MEI Controller #1 (rev 04) Subsystem: ASUSTeK Computer Inc. P8 series motherboard Kernel driver in use: mei_me Kernel modules: mei_me 00:19.0 Ethernet controller: Intel Corporation 82579V Gigabit Network Connection (rev 05) Subsystem: ASUSTeK Computer Inc. P8P67 Deluxe Motherboard Kernel driver in use: e1000e Kernel modules: e1000e 00:1a.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #2 (rev 05) Subsystem: ASUSTeK Computer Inc. P8 series motherboard Kernel driver in use: ehci-pci Kernel modules: ehci_pci 00:1b.0 Audio device: Intel Corporation 6 Series/C200 Series Chipset Family High Definition Audio Controller (rev 05) Subsystem: ASUSTeK Computer Inc. Device 8469 Kernel driver in use: snd_hda_intel Kernel modules: snd_hda_intel 00:1c.0 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 1 (rev b5) Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.1 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 2 (rev b5) Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.4 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 5 (rev b5) Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.6 PCI bridge: Intel Corporation 82801 PCI Bridge (rev b5) 00:1d.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #1 (rev 05) Subsystem: ASUSTeK Computer Inc. P8 series motherboard Kernel driver in use: ehci-pci Kernel modules: ehci_pci 00:1f.0 ISA bridge: Intel Corporation P67 Express Chipset Family LPC Controller (rev 05) Subsystem: ASUSTeK Computer Inc. P8P67 Deluxe Motherboard Kernel driver in use: lpc_ich Kernel modules: lpc_ich 00:1f.2 SATA controller: Intel Corporation 6 Series/C200 Series Chipset Family SATA AHCI Controller (rev 05) Subsystem: ASUSTeK Computer Inc. P8 series motherboard Kernel driver in use: ahci Kernel modules: ahci 00:1f.3 SMBus: Intel Corporation 6 Series/C200 Series Chipset Family SMBus Controller (rev 05) Subsystem: ASUSTeK Computer Inc. P8 series motherboard Kernel modules: i2c_i801 01:00.0 VGA compatible controller: NVIDIA Corporation NV43 [GeForce 6600 GT] (rev a2) Kernel driver in use: nvidia Kernel modules: nouveau, nvidia 02:00.0 VGA compatible controller: NVIDIA Corporation GT200 [GeForce GTX 260] (rev a1) Subsystem: NVIDIA Corporation Device 0585 Kernel driver in use: vfio-pci Kernel modules: nouveau, nvidia 04:00.0 USB controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 04) Subsystem: ASUSTeK Computer Inc. P8P67 Deluxe Motherboard Kernel driver in use: xhci_hcd Kernel modules: xhci_hcd 05:00.0 USB controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 04) Subsystem: ASUSTeK Computer Inc. P8P67 Deluxe Motherboard Kernel driver in use: xhci_hcd Kernel modules: xhci_hcd 06:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 01) 07:00.0 Multimedia controller: Twinhan Technology Co. Ltd Mantis DTV PCI Bridge Controller [Ver 1.0] (rev 01) Subsystem: TERRATEC Electronic GmbH Device 1178 Kernel driver in use: Mantis Kernel modules: mantis 07:02.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL-8110SC/8169SC Gigabit Ethernet (rev 10) Subsystem: ASUSTeK Computer Inc. Device 820d Kernel driver in use: r8169 Kernel modules: r8169 07:03.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6306/7/8 [Fire II(M)] IEEE 1394 OHCI Controller (rev c0) Subsystem: ASUSTeK Computer Inc. Motherboard Kernel driver in use: firewire_ohci Kernel modules: firewire_ohci</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431740" class="blockpost roweven"> <h2><span><span class="conr">#2254</span> <a href="viewtopic.php?pid=1431740#p1431740">2014-07-01 02:57:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>yes of course</p><div class="codebox"><pre><code>[pheinrich@ARCH bin]$ ls -l -a --color=auto /sys/kernel/iommu_groups/1/devices/ total 0 drwxr-xr-x 2 root root 0 Jun 30 21:47 . drwxr-xr-x 3 root root 0 Jun 30 21:47 .. lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:00:01.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:00:01.1 -&gt; ../../../../devices/pci0000:00/0000:00:01.1 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:01:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0 lrwxrwxrwx 1 root root 0 Jun 30 21:47 0000:02:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0</code></pre></div></div></blockquote></div><p>You certainly need the ACS patch applied and enabled in this configuration, or you could move one of the cards to the other x16 slot on the motherboard as I suggested previously.&#160; Since the ACS override doesn&#039;t seem to be working for you, I&#039;d double check that it&#039;s actually applied and that you&#039;re booting the kernel you think you&#039;re booting.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431754" class="blockpost rowodd"> <h2><span><span class="conr">#2255</span> <a href="viewtopic.php?pid=1431754#p1431754">2014-07-01 03:47:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, everyone, nice to see you again!<br />Now I got a lot of time to investigate because summer vacation.</p><p>Now I updated kernel to 3.16.0-rc2, but I found that I can&#039;t execute CUDA application on VM.<br />I set CPU function with</p><div class="codebox"><pre><code>-cpu host,hv-time,kvm=off</code></pre></div><p>This is no use.<br />But if I take kvm=off out, and only edit kvm.c, it worked but still got some problem when execute other CUDA applications.</p><p>Maybe I should downgrade the NVIDIA driver version on guest.<br />But I guess I should use vgaarb patch because my host GPU is AMD.</p><p>I know how to patch it, but what command should I type into GRUB?</p><p>Many thanks,<br />AK.</p> <p class="postedit"><em>Last edited by AKSN74 (2014-07-01 04:05:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431754">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431781" class="blockpost roweven"> <h2><span><span class="conr">#2256</span> <a href="viewtopic.php?pid=1431781#p1431781">2014-07-01 07:00:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OK, after doing some tests, maybe I found a reason why guest Ubuntu can&#039;t run CUDA very well.</p><p>Few weeks ago, after found that NVIDIA limit KVM to use GPU, I can run CUDA with KVM sign changed. But still got some problem.<br />Run some CUDA samples will get this kernel message.</p><div class="codebox"><pre><code>NVRM: os_pci_init_handle: invalid context!</code></pre></div><p>And the same application can run at first time when boot in. After that, it can&#039;t run again.</p><p>But when I running a CUDA sample called &#039;vectorAdd&#039;, I found that it get error when application try to copy data from GPU memory to RAM.<br />So I check both dmesg (host and guest.), and I found that when I execute. Guest OS got a same IRQ number, but host is not a same.</p><p>For example, when I execute application first time in guest, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.0: irq 88 for MSI/MSI-X</code></pre></div><p>But when I execute second time or run other application, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.0: irq 89 for MSI/MSI-X</code></pre></div><p>This is my guess, maybe the MSI IRQ address changed cause GPU can&#039;t send data back to RAM.<br />But it just a guess, I&#039;m not sure.<br />Maybe it can run CUDA very well when guest OS is Windows or Ubuntu Desktop, because they have GUI (X-server), so they need MSI IRQ at beginning and always the same IRQ.<br />And both my host and guest OS are Ubuntu Server.</p><br /><p>I have to do more tests so that can figure out what&#039;s a real problem.</p> <p class="postedit"><em>Last edited by AKSN74 (2014-07-04 01:19:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431806" class="blockpost rowodd"> <h2><span><span class="conr">#2257</span> <a href="viewtopic.php?pid=1431806#p1431806">2014-07-01 10:14:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83118">random_user9547</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-27</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>random_user9547 wrote:</cite><blockquote><div><p>Hello,</p><p>I have tried VGA-Passthrough on my system but it fails.</p><p>My specifications are:<br />Motherboard: gigabyte ga 970 UD3<br />CPU: AMD FX 6300<br />VGA1: AMD HD 7790 on 01:00.0 01:00.01<br />VGA2: AMD HD 6450 on 06:00.0 06:00.01</p><p>The host OS uses HD 6450, I am trying to pass HD 7790 to a guest OS.</p><p>Qemu version:<br />qemu-x86_64 version 2.0.0, Copyright (c) 2003-2008 Fabrice Bellard</p><p>kernel version:<br />3.14.1-3-mainline #1 SMP PREEMPT (the one nbhs posted)</p><p>Added this to grub:<br />vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1002:665c,1002:0002</p><p>binded the devices.</p><p>And got the Seabios output on the screen.</p><p>But after attachin something bootable to qemu, like this:<br />-drive file=/home/nbhs/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd</p><p>I get:<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: VFIO 0000:01:00.0 BAR 0 mmap unsupported. Performance may be slow<br />qemu-system-x86_64: vfio_bar_write(,0x0, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x4, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x8, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0xc, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x10, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x14, 0x0, 4) failed: Device or resource busy<br />qemu-system-x86_64: vfio_bar_write(,0x18, 0x0, 4) failed: Device or resource busy<br />...</p><p>and a load of vfio_bar_write fails.</p><p>Any idea how to solve this one?</p></div></blockquote></div><p>I solved the problem.<br />It seems that the graphic card on 01:00.0 is the primary on boot, meaning before the kernel loads this is the main card.<br />Because of this the os sees it is already used, and gives resource busy error.<br />I solved it by swapping the GPUs, so the other GPU is now on 01:00.0.</p><br /><p>But now when I start the virtual machine it is very slow like 1/100 of the speed it should be or ti freezes. QEMU shows no error on the screen.<br />Any idea how to solve this one?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431806">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431849" class="blockpost roweven"> <h2><span><span class="conr">#2258</span> <a href="viewtopic.php?pid=1431849#p1431849">2014-07-01 14:32:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I tried to apply the acs overrice patch mentioned in the first post.</p><p>The first hunk (/Documentation/kernel-parameters.txt) is sucessful.<br />The second (/drivers/pci/quirks.c) not.</p><p>I copied the involved file to a tmp location and tried to fix the patched line but without success.</p><p>The mentioned header &quot;struct pci_dev *pci_get_dma_source(struct pci_dev *dev)&quot; is not the line 3292 ... it has moved to line 3372.</p><p>changing this ...</p><div class="codebox"><pre><code>@@ -3292,11 +3292,113 @@ struct pci_dev *pci_get_dma_source(struct pci_dev *dev) ....</code></pre></div><div class="codebox"><pre><code>@@ -3372,11 +3372,113 @@ struct pci_dev *pci_get_dma_source(struct pci_dev *dev) ....</code></pre></div><p>had no effect <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>#########<br />Edit 1</p><p>Also -F3 doesn&#039;t help</p><p>#########<br />Edit 2</p><p>succeeded with -F3 ... (typo)<br />hopefully it has done its job well <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by _pheinrich_ (2014-07-01 14:48:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431849">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431850" class="blockpost rowodd"> <h2><span><span class="conr">#2259</span> <a href="viewtopic.php?pid=1431850#p1431850">2014-07-01 14:33:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>So I check both dmesg (host and guest.), and I found that when I execute. Guest OS got a same IRQ number, but host is not a same.</p><p>For example, when I execute application first time in guest, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.0: irq 88 for MSI/MSI-X</code></pre></div><p>But when I execute second time or run other application, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.1: irq 89 for MSI/MSI-X</code></pre></div></div></blockquote></div><p>These IRQs are on different functions, GPU vs audio</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431850">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431889" class="blockpost roweven"> <h2><span><span class="conr">#2260</span> <a href="viewtopic.php?pid=1431889#p1431889">2014-07-01 16:29:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok I have compiled the new kernel with the acs patch and enabled it</p><div class="codebox"><pre><code>[ 0.000000] Linux version 3.15.2-1-acs (pheinrich@ARCH) (gcc version 4.9.0 20140604 (prerelease) (GCC) ) #1 SMP PREEMPT Tue Jul 1 17:58:41 CEST 2014 [ 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2 [ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux-acs root=UUID=bd845dd5-0a31-4cd0-ae57-875c43f15c30 rw intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:05e2</code></pre></div><p>binding my 0000:02:00.0 device creates an iommu_group 14 so I think the acs patch was successful</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ ls -l -a --color=auto /sys/kernel/iommu_groups/1/devices/ total 0 drwxr-xr-x 2 root root 0 Jul 1 18:26 . drwxr-xr-x 3 root root 0 Jul 1 18:26 .. lrwxrwxrwx 1 root root 0 Jul 1 18:26 0000:00:01.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0 [pheinrich@ARCH ~]$ ls -l -a --color=auto /sys/kernel/iommu_groups/14/devices/ total 0 drwxr-xr-x 2 root root 0 Jul 1 18:26 . drwxr-xr-x 3 root root 0 Jul 1 18:26 .. lrwxrwxrwx 1 root root 0 Jul 1 18:26 0000:02:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.1/0000:02:00.0</code></pre></div><p>But now if I start up the vm, the qemu control window is comming up, no output on 0000:02:00.0 and after 5 seconds everything is black also the host.</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/srv/media/Data/qemu/win8/win8.qcow2,id=windisk -device ide-hd,bus=ide.0,drive=windisk \ -drive file=/srv/media/Data/OperatingSystem/en_windows_8_1_x64_dvd_2707217.iso,id=winiso -device ide-cd,bus=ide.1,drive=winiso</code></pre></div><p>###########<br />Edit 1</p><p>ACS seems to be fine</p><div class="codebox"><pre><code>[pheinrich@ARCH ~]$ dmesg | grep ACS [ 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA [ 0.000000] ACPI: FACS 0x00000000CF3BEF80 000040 [ 0.300365] pci 0000:00:1c.0: Intel PCH root port ACS workaround enabled [ 0.300515] pci 0000:00:1c.1: Intel PCH root port ACS workaround enabled [ 0.300666] pci 0000:00:1c.4: Intel PCH root port ACS workaround enabled</code></pre></div><p>I do not get any error. The whole system is freezing, not only X because ssh sessions die too.</p> <p class="postedit"><em>Last edited by _pheinrich_ (2014-07-01 21:18:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431889">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1431986" class="blockpost rowodd"> <h2><span><span class="conr">#2261</span> <a href="viewtopic.php?pid=1431986#p1431986">2014-07-01 22:15:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi guys, following this guide I got windows 8.1 installed and was able to pass through a nvidia 670 gpu, with a nvidia titan on the host side. The drivers that come with windows 8 work, however when I try to install the latest drivers from nvidia I either get a blank screen on reboot in the guest os, or non-functioning drivers in the guest os. Anyone else experience this?</p> <p class="postedit"><em>Last edited by kristopher004 (2014-07-01 22:16:02)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1431986">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432013" class="blockpost roweven"> <h2><span><span class="conr">#2262</span> <a href="viewtopic.php?pid=1432013#p1432013">2014-07-02 00:24:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83145">kameloc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-28</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83145">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>kameloc wrote:</cite><blockquote><div><div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>This is not the right patch (it doesn&#039;t hurt tho).</p></div></blockquote></div><p>Could you link me to the right patch? I tried both VGA patches from the OP with the same errors.</p></div></blockquote></div><p>Along with patches, you need to add &#039;i915.enable_hd_vgaarb=1&#039; to kernel params. Also, you prob need to aquire vbios file for your gpu and pass it with romfile arg during the vm boot.</p></div></blockquote></div><p>The kernel parameter is what I was missing, thank you.</p><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>kameloc wrote:</cite><blockquote><div><div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>This is not the right patch (it doesn&#039;t hurt tho).</p></div></blockquote></div><p>Could you link me to the right patch? I tried both VGA patches from the OP with the same errors.</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1420298#p1420298" rel="nofollow">this</a> is what works for me (vga arbioter patch link inlcuded)</p></div></blockquote></div><p>This post was also very helpful, thank you.</p><p>Another success story. To reiterate my setup is:</p><p>CPU: Intel i7-4790<br />Motherboard: GA-Z97N-WIFI<br />Host GPU: Intel HD Graphics 4600<br />Passthrough GPU: EVGA NVIDIA GTX 550Ti</p><p>Tried installing Windows 8.1 but couldn&#039;t get the sound to not sound extremely distorted. Moved to Windows 7 with the ac97 soundcard which runs really nice except it&#039;s a little off when playing games or video (like it&#039;s slowed down). I&#039;m going to be messing with the audio settings to try to clean it up a bit. Also the video card persists through reboots only with the NVIDIA Drivers installed on Windows 7 (persists being not freezing at the shutdown screen even with the VM powered off). </p><p>Also I&#039;m a little confused by the networking section of their documentation. I was using -net user at first but wanted to setup synergy so opted for a bridge. Bridge works fine but was thinking of adding two NICs so I could have one externally facing and the other inside QEMU&#039;s virtual networking (primarily for access to other VMs I&#039;ll create). I tried just adding two -nic devices but only one would appear, even with setting different VLANs. Anyone have experience adding two NICs? So to the documentation, <a href="http://wiki.qemu.org/Documentation/Networking" rel="nofollow">here</a> they say that -net is obsolete but I can&#039;t find an alternative for bridged devices in the documentation. I see <a href="http://wiki.qemu.org/Documentation/Networking/NAT" rel="nofollow">this page</a> on bridges but it also uses -net nic.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432013">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432054" class="blockpost rowodd"> <h2><span><span class="conr">#2263</span> <a href="viewtopic.php?pid=1432054#p1432054">2014-07-02 03:36:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kristopher004 wrote:</cite><blockquote><div><p>Hi guys, following this guide I got windows 8.1 installed and was able to pass through a nvidia 670 gpu, with a nvidia titan on the host side. The drivers that come with windows 8 work, however when I try to install the latest drivers from nvidia I either get a blank screen on reboot in the guest os, or non-functioning drivers in the guest os. Anyone else experience this?</p></div></blockquote></div><p>You need latest qemu (option kvm=off) with 340 driver...</p><p>or u can patch it yourself, with help of this topic <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by slis (2014-07-02 03:38:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432054">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432060" class="blockpost roweven"> <h2><span><span class="conr">#2264</span> <a href="viewtopic.php?pid=1432060#p1432060">2014-07-02 04:27:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>You need latest qemu (option kvm=off) with 340 driver...<br />or u can patch it yourself, with help of this topic</p></div></blockquote></div><p>Thanks slis, I have a few questions though. Do you mean the nvidia 340 driver for the host or for the guest or for both? Also when you say patch it do you mean to patch the 340 driver on the host side with the patch mentioned under the issues section of this guide?</p><p>Thanks!</p> <p class="postedit"><em>Last edited by kristopher004 (2014-07-02 04:27:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432060">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432093" class="blockpost rowodd"> <h2><span><span class="conr">#2265</span> <a href="viewtopic.php?pid=1432093#p1432093">2014-07-02 07:52:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>you can use qemu-git from AUR or patching qemu.</p><p>I would say using qemu-git is the easier option <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432093">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432132" class="blockpost roweven"> <h2><span><span class="conr">#2266</span> <a href="viewtopic.php?pid=1432132#p1432132">2014-07-02 12:06:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok i found the issue.</p><p>nvidia-304xx module is the problem. <br />Removing all nvidia specific modules/packages and do not start X server, so both cards aren&#039;t really in use (then I do not need the ACS override), the vm is starting.</p><p>Maybe I try nouveau for the host now.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432132">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432155" class="blockpost rowodd"> <h2><span><span class="conr">#2267</span> <a href="viewtopic.php?pid=1432155#p1432155">2014-07-02 13:31:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><p>So I check both dmesg (host and guest.), and I found that when I execute. Guest OS got a same IRQ number, but host is not a same.</p><p>For example, when I execute application first time in guest, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.0: irq 88 for MSI/MSI-X</code></pre></div><p>But when I execute second time or run other application, the host dmesg is:</p><div class="codebox"><pre><code>vfio-pci 0000:03:00.1: irq 89 for MSI/MSI-X</code></pre></div></div></blockquote></div><p>These IRQs are on different functions, GPU vs audio</p></div></blockquote></div><p>I&#039;m sorry that I key the wrong message <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>The second message is not 0000:03:00.1, it&#039;s same as first message. Just different IRQ number.</p> <p class="postedit"><em>Last edited by AKSN74 (2014-07-02 13:35:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432155">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432263" class="blockpost roweven"> <h2><span><span class="conr">#2268</span> <a href="viewtopic.php?pid=1432263#p1432263">2014-07-02 20:29:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How do I go about adding the kvm=off flag when using virt-manager? I presumed I could add it to the XML file for the guest, but I don&#039;t know what format it should take. I don&#039;t seem to be having much luck with this: </p><div class="codebox"><pre><code> &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039; kvm=off/&gt;</code></pre></div> <p class="postedit"><em>Last edited by MCMjolnir (2014-07-03 00:17:55)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432264" class="blockpost rowodd"> <h2><span><span class="conr">#2269</span> <a href="viewtopic.php?pid=1432264#p1432264">2014-07-02 20:30:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>nouveau produces a warped window and is not usable. My N43 chip should be supported but it does not work.<br />Now I am using vesa for playing with qemu passthrough.</p><p>As I asked some post before I would like to redirect the gpu output.</p><p>First I tried the vnc option. with &quot;-vnc :0&quot; but the mouse pointer is lagging and has an big offset.</p><p>So I decided to use a rdp connection.<br />To connect one option would be to start up a tun tap device so I can access my guest from the host.<br />I have this option working on my laptop but I do not get it to work on my desktop pc.</p><p>However &quot;-redir tcp:5555::3389&quot; should work too.<br />After I see the SeaBios and windows 8 is going to start everything is freezing, also the host <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Anyone experienced something like that before?</p><p>Third and last option whould be to passthrough my second network card <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432264">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432276" class="blockpost roweven"> <h2><span><span class="conr">#2270</span> <a href="viewtopic.php?pid=1432276#p1432276">2014-07-02 21:45:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Using two nvidia cards, latest qemu and nvidia 340.17 on host the nvidia driver on guest says: &quot;Windows has stopped this device because it has reported problem. (code 43)&quot;&#160; Anyone else have this problem?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432278" class="blockpost rowodd"> <h2><span><span class="conr">#2271</span> <a href="viewtopic.php?pid=1432278#p1432278">2014-07-02 21:53:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82900">MCMjolnir</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-19</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Are you using <em>-cpu kvm=off</em> in the launch arguments?</p> <p class="postedit"><em>Last edited by MCMjolnir (2014-07-02 21:57:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432278">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432289" class="blockpost roweven"> <h2><span><span class="conr">#2272</span> <a href="viewtopic.php?pid=1432289#p1432289">2014-07-02 23:00:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>no I&#039;ll give that a try</p> <p class="postedit"><em>Last edited by kristopher004 (2014-07-02 23:11:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432359" class="blockpost rowodd"> <h2><span><span class="conr">#2273</span> <a href="viewtopic.php?pid=1432359#p1432359">2014-07-03 06:15:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>MCMjolnir wrote:</cite><blockquote><div><p>How do I go about adding the kvm=off flag when using virt-manager? I presumed I could add it to the XML file for the guest, but I don&#039;t know what format it should take. I don&#039;t seem to be having much luck with this: </p><div class="codebox"><pre><code> &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039; kvm=off/&gt;</code></pre></div></div></blockquote></div><p>I belive it&#039;s not implemented yet.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432359">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432594" class="blockpost roweven"> <h2><span><span class="conr">#2274</span> <a href="viewtopic.php?pid=1432594#p1432594">2014-07-04 01:28:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I installed Windows 7 VM again and run CUDA to see if host got a same message in post #2256.<br />But after the test, there is no message and CUDA still run perfectly on Windows. </p><p>So maybe my theory is right, GPU can&#039;t send data back to main memory because IRQ changed when execute CUDA application on Ubuntu VM.<br />But now I have to test driver because maybe NVIDIA Linux driver still have a problem. (Linux Driver is earlier to limit VM use GRID only than Windows.) Even changed KVM signature.<br />Maybe I should try the previous driver before NVIDIA released GRID. Or different Linux OS.</p> <p class="postedit"><em>Last edited by AKSN74 (2014-07-04 14:01:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432594">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1432817" class="blockpost rowodd"> <h2><span><span class="conr">#2275</span> <a href="viewtopic.php?pid=1432817#p1432817">2014-07-04 20:11:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83289">rafalcieslak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-04</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone, thanks for this guide and other useful info in this thread!</p><p>I have been mostly successful with my passthrough setup, but I got stuck at a particular problem that I do not know how to trouleshoot.</p><p>I have managed to run qemu with what appears to be a working passthrough of my nvidia 770, but it seems the drivers fail to comunicate with the device itself.<br />If my guest system is a Linux, I can run lspci -v there, and apparently the dedicated graphics card is indeed exposed to the guest system, as lspci lists it. The `lspci -vmm` entry for the guest system is same as for the host.. On a windows, the device is also detected as a VGA display, with detailed information being also correct. So I assume up to this point I did everything right, and that the card got passed through.</p><p>However, whenever I try to install the drivers, something gets messed up.<br />In case of a linux system, the installation succeeds, but the X server fails to start, the logs say that nvidia xorg module complained that &quot;The NVIDIA device on PCI:1:0:0 is not supported by this driver&quot;, which is wrong, because I have used the save driver with the very same piece of software with absolutelly no problems (and the driver manual says it does support that card).<br />In case of a windows, the driver installation suceeds, but the system fails to use the card afterwards, first two reboot are always a blue screen on the boot, and any subsequent will suceed, but windows will never use the card, there is nothing displayed. If the emulated vga is available, windows will use it instead (this is where I saw these blue screens too).</p><p>This feels like there is some complication with the drivers communicating with the hardware. I have no clue on how to troubleshoot that.<br />I will be very thankful for any hints!</p><p>PS. I have also just noticed, that I cannot even get seabios to display using the passthrough&#039;d display. BUT the lspci of the guest system lists the device, so it is there! What am I missing? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1432817">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=90">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=89">89</a> <a href="viewtopic.php?id=162768&amp;p=90">90</a> <strong>91</strong> <a href="viewtopic.php?id=162768&amp;p=92">92</a> <a href="viewtopic.php?id=162768&amp;p=93">93</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=92">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
