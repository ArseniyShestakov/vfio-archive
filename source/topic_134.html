<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 134) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=134" title="Page 134" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=133" title="Page 133" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=135" title="Page 135" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=133">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=132">132</a> <a href="viewtopic.php?id=162768&amp;p=133">133</a> <strong>134</strong> <a href="viewtopic.php?id=162768&amp;p=135">135</a> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=135">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1477276" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3326</span> <a href="viewtopic.php?pid=1477276#p1477276">2014-11-19 22:42:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok with<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0 </p><p>the error is gone. dmesg says only <br />[21593.742734] kvm: zapping shadow pages for mmio generation wraparound</p><br /><p>But there is still no output on the monitor on the 480GTX.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477277" class="blockpost roweven"> <h2><span><span class="conr">#3327</span> <a href="viewtopic.php?pid=1477277#p1477277">2014-11-19 22:55:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Ok with<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0 </p><p>the error is gone. dmesg says only <br />[21593.742734] kvm: zapping shadow pages for mmio generation wraparound</p><br /><p>But there is still no output on the monitor on the 480GTX.</p></div></blockquote></div><p>You need a ROM to use VGA assignment.&#160; If we can&#039;t read it from the card, you can try to download one from the TechPowerUp <a href="http://www.techpowerup.com/vgabios/index.php?model=GTX+480" rel="nofollow">database</a>.&#160; However, not being able to get the ROM from the card itself probably means that the host drivers aren&#039;t properly blacklisted or the assigned device is actually the boot VGA device.&#160; Using pci-stub.ids=$VENDOR:$DEVICE is the preferred way to make sure no host drivers attach to the device.&#160; Replace $VENDOR and $DEVICE with the PCI IDs for your card found from lspci -nn.</p><p>EDIT, I see you&#039;re using pci-stub:</p><div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Here is my cmdline</p><div class="codebox"><pre><code>pci-stub.ids=10de:06c0,10de:0be5</code></pre></div></div></blockquote></div><p>So make sure your BIOS is set to initialize the IGD, not the PCIe graphics card.</p> <p class="postedit"><em>Last edited by aw (2014-11-19 23:03:06)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477277">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477278" class="blockpost rowodd"> <h2><span><span class="conr">#3328</span> <a href="viewtopic.php?pid=1477278#p1477278">2014-11-19 22:59:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>At boot I get the following error, i don&#039;t know if it has to do something with it:</p><div class="codebox"><pre><code>[ 28.354419] [drm:ilk_display_irq_handler] *ERROR* Pipe B FIFO underrun [ 28.354429] [drm:cpt_set_fifo_underrun_reporting] *ERROR* uncleared pch fifo underrun on pch transcoder B [ 28.354430] [drm:cpt_serr_int_handler] *ERROR* PCH transcoder B FIFO underrun</code></pre></div></div></blockquote></div><p>BTW, this is a classic indication that the i915 arbiter patch is either not applied or not enabled.&#160; If you have Intel graphics and you get this, you&#039;ll never get VM boot output to the assigned VGA until it&#039;s fixed.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477278">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477284" class="blockpost roweven"> <h2><span><span class="conr">#3329</span> <a href="viewtopic.php?pid=1477284#p1477284">2014-11-19 23:17:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="http://sprunge.us/HWaY" rel="nofollow">http://sprunge.us/HWaY</a><br /><a href="http://sprunge.us/UiVa" rel="nofollow">http://sprunge.us/UiVa</a></p><p>I compiled the kernel with the two patches, because the patches linked in the first post does not patch against 3.17.3.<br />Here is the pkgbuild:<br /><a href="http://sprunge.us/ciHf" rel="nofollow">http://sprunge.us/ciHf</a></p><p>Where would be the perfect place for a printk to make sure all worked out?<br />After <br />+&#160; &#160; if (!i915.enable_hd_vgaarb || !HAS_PCH_SPLIT(dev)) {</p><p>Or add in this section <br />if (i915.enable_hd_vgaarb)<br />&#160; &#160; printk(&#160; ... );</p><p>Edit: Tomorrow I have time to compile again.</p> <p class="postedit"><em>Last edited by Rommy (2014-11-19 23:30:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477284">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477393" class="blockpost rowodd"> <h2><span><span class="conr">#3330</span> <a href="viewtopic.php?pid=1477393#p1477393">2014-11-20 08:48:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86620">dakabali</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m wondering if it&#039;s possible to to passthrough a video card to a Mac OS KVM guest using the described&#160; methods. I&#039;m not starting a legal discussion here, just considering it from a technical point of view. Has anybody tried such a configuration yet? It could be a cost effective competitor to any commercial external PCI over Thunderbolt solution.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477393">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477398" class="blockpost roweven"> <h2><span><span class="conr">#3331</span> <a href="viewtopic.php?pid=1477398#p1477398">2014-11-20 09:35:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><p>I&#039;m wondering if it&#039;s possible to to passthrough a video card to a Mac OS KVM guest using the described&#160; methods. I&#039;m not starting a legal discussion here, just considering it from a technical point of view. Has anybody tried such a configuration yet? It could be a cost effective competitor to any commercial external PCI over Thunderbolt solution.</p></div></blockquote></div><p>It&#039;s possible</p><p><a href="http://i.imgur.com/0D5JAhz.jpg" rel="nofollow"><span class="postimg"><img src="http://i.imgur.com/ydNpt5S.jpg" alt="ydNpt5S.jpg" /></span></a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477398">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477399" class="blockpost rowodd"> <h2><span><span class="conr">#3332</span> <a href="viewtopic.php?pid=1477399#p1477399">2014-11-20 09:43:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86620">dakabali</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><p>I&#039;m wondering if it&#039;s possible to to passthrough a video card to a Mac OS KVM guest using the described&#160; methods. I&#039;m not starting a legal discussion here, just considering it from a technical point of view. Has anybody tried such a configuration yet? It could be a cost effective competitor to any commercial external PCI over Thunderbolt solution.</p></div></blockquote></div><p>It&#039;s possible</p></div></blockquote></div><p>Cool. As your screenshot shows a delegated Quadro card: Is there any restriction to the Quadro series or would it work with any (Nvidia) card? Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477399">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477404" class="blockpost roweven"> <h2><span><span class="conr">#3333</span> <a href="viewtopic.php?pid=1477404#p1477404">2014-11-20 09:55:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>dakabali wrote:</cite><blockquote><div><p>I&#039;m wondering if it&#039;s possible to to passthrough a video card to a Mac OS KVM guest using the described&#160; methods. I&#039;m not starting a legal discussion here, just considering it from a technical point of view. Has anybody tried such a configuration yet? It could be a cost effective competitor to any commercial external PCI over Thunderbolt solution.</p></div></blockquote></div><p>It&#039;s possible</p></div></blockquote></div><p>Cool. As your screenshot shows a delegated Quadro card: Is there any restriction to the Quadro series or would it work with any (Nvidia) card? Thanks.</p></div></blockquote></div><p>It&#039;s a quadrified GTX470, and it did work on osx before i modded it, the problem i have with it (if i use it as primary) is that i have to reboot the host every time i restart the vm, i also have to boot with PciRoot=1 or i get no output. If you plan to do this i recommend checking out which cards work on &quot;hackintosh&quot;, for example im able to pass through my radeon 6950 but i get a white screen after it finishes booting, which also happens natively.</p> <p class="postedit"><em>Last edited by nbhs (2014-11-20 09:58:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477404">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477439" class="blockpost rowodd"> <h2><span><span class="conr">#3334</span> <a href="viewtopic.php?pid=1477439#p1477439">2014-11-20 12:51:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81133">janze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey all.<br />i&#039;m wondering why i got both kvm errors. Still i can run it..</p><div class="codebox"><pre><code>[ 516.117869] kvm: SMP vm created on host with unstable TSC; guest TSC will not be reliable [ 516.250273] pci-stub 0000:03:00.0: enabling device (0000 -&gt; 0003) [ 517.403936] pci-stub 0000:03:00.0: kvm assign device [ 517.878698] pci-stub 0000:03:00.1: enabling device (0000 -&gt; 0002) [ 517.878781] pci-stub 0000:03:00.1: kvm assign device [ 517.980035] pci-stub 0000:00:1d.0: kvm assign device [ 522.078331] kvm: zapping shadow pages for mmio generation wraparound [ 531.279711] pci-stub 0000:03:00.0: irq 51 for MSI/MSI-X </code></pre></div><p>My hardware:<br />&#160; &#160; &#160; intel i7 4820k<br />&#160; &#160; &#160; Msi X79A-GD65-8D<br />&#160; &#160; &#160; Radeon R9 290x (for windows)<br />&#160; &#160; &#160; Nvidia gtx480 -&gt; Quadro 6000 (for host)</p><p>&#160; &#160; &#160; Kernel: 3.17.3-1-ARCH<br />&#160; &#160; &#160; Qemu build from AUR&#160; [installed: 2.2.r36230.gaf3ff19-1]</p><p>VMstart script </p><div class="codebox"><pre><code>#!/bin/bash sudo qemu-system-x86_64 --enable-kvm -m 8192 -localtime \ -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -monitor stdio -pflash /usr/share/ovmf/x64/ovmf_x64.bin \ -usbdevice tablet -vga qxl \ -drive file=/samssd/janze/virtualpc/qemu-img/titan8 \ -device pci-assign,host=03:00.0 \ -device pci-assign,host=03:00.1 \ -device pci-assign,host=00:1d.0 \ -drive file=/tilaa/data/virtimgdata</code></pre></div><p>Host boot </p><div class="codebox"><pre><code>[ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=c92efce4-a1ee-4b8b-9d49-ab570fdf7546 rw intel_iommu=on pci-stub.ids=1002:67b0,1002:aac8,8086:1d26</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477439">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477452" class="blockpost roweven"> <h2><span><span class="conr">#3335</span> <a href="viewtopic.php?pid=1477452#p1477452">2014-11-20 14:02:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>janze wrote:</cite><blockquote><div><p>Hey all.<br />i&#039;m wondering why i got both kvm errors. Still i can run it..</p><div class="codebox"><pre><code>[ 516.117869] kvm: SMP vm created on host with unstable TSC; guest TSC will not be reliable [ 516.250273] pci-stub 0000:03:00.0: enabling device (0000 -&gt; 0003) [ 517.403936] pci-stub 0000:03:00.0: kvm assign device [ 517.878698] pci-stub 0000:03:00.1: enabling device (0000 -&gt; 0002) [ 517.878781] pci-stub 0000:03:00.1: kvm assign device [ 517.980035] pci-stub 0000:00:1d.0: kvm assign device [ 522.078331] kvm: zapping shadow pages for mmio generation wraparound [ 531.279711] pci-stub 0000:03:00.0: irq 51 for MSI/MSI-X </code></pre></div></div></blockquote></div><p>What errors?&#160; Nothing here indicates an error other than you&#039;re using legacy KVM device assignment, not VFIO.</p><div class="quotebox"><blockquote><div><p>My hardware:<br />&#160; &#160; &#160; intel i7 4820k<br />&#160; &#160; &#160; Msi X79A-GD65-8D<br />&#160; &#160; &#160; Radeon R9 290x (for windows)<br />&#160; &#160; &#160; Nvidia gtx480 -&gt; Quadro 6000 (for host)</p><p>&#160; &#160; &#160; Kernel: 3.17.3-1-ARCH<br />&#160; &#160; &#160; Qemu build from AUR&#160; [installed: 2.2.r36230.gaf3ff19-1]</p></div></blockquote></div><p>Is this a hardware mod&#039;d Nvidia card?&#160; EDIT:&#160; Doesn&#039;t matter, host</p><div class="quotebox"><blockquote><div><p>VMstart script </p><div class="codebox"><pre><code>#!/bin/bash sudo qemu-system-x86_64 --enable-kvm -m 8192 -localtime \ -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -monitor stdio -pflash /usr/share/ovmf/x64/ovmf_x64.bin \ -usbdevice tablet -vga qxl \ -drive file=/samssd/janze/virtualpc/qemu-img/titan8 \ -device pci-assign,host=03:00.0 \ -device pci-assign,host=03:00.1 \ -device pci-assign,host=00:1d.0 \ -drive file=/tilaa/data/virtimgdata</code></pre></div><p>Host boot </p><div class="codebox"><pre><code>[ 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=c92efce4-a1ee-4b8b-9d49-ab570fdf7546 rw intel_iommu=on pci-stub.ids=1002:67b0,1002:aac8,8086:1d26</code></pre></div></div></blockquote></div><p>You haven&#039;t actually shown an error, but using pci-assign you&#039;re not going to be able to reset the bus like vfio-pci will do.&#160; You also seem to be specifying -drive options with no interface, is the problem that the VM has no disk?</p><p>EDIT: There&#039;s no guarantee that a Radeon card will work as a secondary graphics adapter for the VM.&#160; Some people report it works, in other cases it doesn&#039;t.&#160; It depends on the driver in the guest and is not the focus of this forum thread.</p> <p class="postedit"><em>Last edited by aw (2014-11-20 14:05:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477452">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477456" class="blockpost rowodd"> <h2><span><span class="conr">#3336</span> <a href="viewtopic.php?pid=1477456#p1477456">2014-11-20 14:09:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>BTW, this is a classic indication that the i915 arbiter patch is either not applied or not enabled.&#160; If you have Intel graphics and you get this, you&#039;ll never get VM boot output to the assigned VGA until it&#039;s fixed.</p></div></blockquote></div><p>Omg? Overworked? To tired? I don&#039;t know. I am sorry for wasting your time.</p><p>I compiled the kernel again with the patches and edited the arbiter patch.<br />I didnt want to edit the diff file so I used the same line. (For every one not knowing if the patch is working: <a href="http://sprunge.us/WfOe" rel="nofollow">http://sprunge.us/WfOe</a> )</p><p>dmesg says:<br />[&#160; &#160;26.297580] vgaarb: enable_hd_vgaarb = 1</p><p>But the error is NOT gone</p><div class="codebox"><pre><code>[ 26.498934] [drm:ilk_display_irq_handler] *ERROR* Pipe B FIFO underrun [ 26.498950] [drm:cpt_set_fifo_underrun_reporting] *ERROR* uncleared pch fifo underrun on pch transcoder B [ 26.498950] [drm:cpt_serr_int_handler] *ERROR* PCH transcoder B FIFO underrun</code></pre></div><p>But now I get an output at the monitor and the qemu error is gone. I dont know what happed, I did makepkg and pacman -U paket, sorry <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><br /><p>Edit: Is there an easy way I do not have to be root in X?<br />Edit2: Ok, I found a pdf file you linked to this topic <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by Rommy (2014-11-20 14:18:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477456">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477464" class="blockpost roweven"> <h2><span><span class="conr">#3337</span> <a href="viewtopic.php?pid=1477464#p1477464">2014-11-20 14:24:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81133">janze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code>kvm: SMP vm created on host with unstable TSC; guest TSC will not be reliable kvm: zapping shadow pages for mmio generation wraparound </code></pre></div><p>Those are what i&#039;m wondering.. why i get those warns?<br />I did try whit VFIO, but after radeon driver install i got BSoD.<br />Pci-assing is working for me.</p><p>Thing why i wonder this is my windows 8.1 quest system interrupt process is eating CPU usage sometimes. And host cpu usage have one thread 100% usage peak same time.</p> <p class="postedit"><em>Last edited by janze (2014-11-20 14:36:31)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477464">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477496" class="blockpost rowodd"> <h2><span><span class="conr">#3338</span> <a href="viewtopic.php?pid=1477496#p1477496">2014-11-20 18:03:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello all,</p><p>I have my kernel patched (downloaded from the first post) and installed.</p><p>my kernel options are:</p><div class="codebox"><pre><code>pcie_aspm=force acpi_osi=Linux acpi=force acpi_enforce_resources=lax i915.enable_rc6=1 i915.enable_fbc=1 i915.lvds_downclock=1 i915.semaphores=1 drm.vblankoffdelay=1 acpi_backlight=vendor intel_pstate=disable pci-stub.ids=10de:1184,10de:030a intel_iommu=on,igfx_off rdblacklist=nouveau nouveau.modeset=0 elevator=noop intremap=no_x2apic_optout libata.force=noncq quiet loglevel=3 i915.enable_hd_vgaarb=1 libata.noacpi=1 pcie_acs_override=downstream</code></pre></div><p>Running the test part works perfect:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>Adding the Virtio Controller works perfect as well:</p><div class="codebox"><pre><code>-device virtio-scsi-pci,id=scsi</code></pre></div><p>Problems?? Yes... when I attach the hard drive / cdrom...</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/VM/win7.img,id=disk,format=raw -device scsi-hd,drive=disk qemu-system-x86_64: -device scsi-hd,drive=disk: Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use</code></pre></div><p>What I would like, if possible?<br />To have the hard drive with Virtio and two cdroms, one with virtio for Windows 7.iso and the other one with SATA / IDE with the Virtio drivers...</p><p>I did it before but I do not know why is giving me this error with &quot;Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use&quot;.</p><p>Please, can someone bring me some light on this?</p><p>Thanks a lot in advance.</p><p>Best regards,</p><p>TheArcher</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477496">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477499" class="blockpost roweven"> <h2><span><span class="conr">#3339</span> <a href="viewtopic.php?pid=1477499#p1477499">2014-11-20 18:35:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Hello all,</p><p>I have my kernel patched (downloaded from the first post) and installed.</p><p>my kernel options are:</p><div class="codebox"><pre><code>pcie_aspm=force acpi_osi=Linux acpi=force acpi_enforce_resources=lax i915.enable_rc6=1 i915.enable_fbc=1 i915.lvds_downclock=1 i915.semaphores=1 drm.vblankoffdelay=1 acpi_backlight=vendor intel_pstate=disable pci-stub.ids=10de:1184,10de:030a intel_iommu=on,igfx_off rdblacklist=nouveau nouveau.modeset=0 elevator=noop intremap=no_x2apic_optout libata.force=noncq quiet loglevel=3 i915.enable_hd_vgaarb=1 libata.noacpi=1 pcie_acs_override=downstream</code></pre></div></div></blockquote></div><p>Oh dear, does it also run faster if you <a href="http://lwn.net/Articles/621999/" rel="nofollow">stand on your head</a>?&#160; <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>EDIT: The ironic part is that the i915 maintainer won&#039;t take the enable_hd_vgaarb patch because he doesn&#039;t want users to need to specify module options.&#160; BTW, with all these tuning options, you do know that enable_hd_vgaarb=1 disables host DRI, right?</p><div class="quotebox"><blockquote><div><p>Running the test part works perfect:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>What was this meant to test?&#160; You&#039;re using <em>-vga cirrus</em> and <em>x-vga=off</em>...&#160; so you&#039;ve successfully attached a secondary GPU?&#160; The test that I&#039;m aware of would be to use <em>-vga none</em> and <em>x-vga=on</em> in order to see if the monitor connected to the assigned GPU lights up from seabios running the VGA ROM.</p><div class="quotebox"><blockquote><div><p>Adding the Virtio Controller works perfect as well:</p><div class="codebox"><pre><code>-device virtio-scsi-pci,id=scsi</code></pre></div><p>Problems?? Yes... when I attach the hard drive / cdrom...</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/VM/win7.img,id=disk,format=raw -device scsi-hd,drive=disk qemu-system-x86_64: -device scsi-hd,drive=disk: Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use</code></pre></div><p>What I would like, if possible?<br />To have the hard drive with Virtio and two cdroms, one with virtio for Windows 7.iso and the other one with SATA / IDE with the Virtio drivers...</p><p>I did it before but I do not know why is giving me this error with &quot;Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use&quot;.</p></div></blockquote></div><p><em>disk</em> might be a reserved word, maybe use <em>disk0</em></p> <p class="postedit"><em>Last edited by aw (2014-11-20 19:05:25)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477499">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477517" class="blockpost rowodd"> <h2><span><span class="conr">#3340</span> <a href="viewtopic.php?pid=1477517#p1477517">2014-11-20 19:59:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79398">Borg8401</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-11</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:borg8401@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I was wondering what options people are recommending when compiling QEMU, currently I have:</p><div class="codebox"><pre><code>./configure \ --prefix=/usr \ --enable-xen \ --enable-xen-pci-passthrough \ --enable-kvm</code></pre></div><p>Anything else I should be using for stability/performance?</p><p>I&#039;m currently using Ubuntu 14.04 and 2.2.0-rc2 off of the QEMU wiki since the included package on Ubuntu doesn&#039;t have the kvm=off option to kill code 43.</p><p>Asus Rampage IV Extreme (x79) and 3930K<br />ATI 4890 (host) and GTX 780 (passthrough)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477517">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477519" class="blockpost roweven"> <h2><span><span class="conr">#3341</span> <a href="viewtopic.php?pid=1477519#p1477519">2014-11-20 20:02:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Borg8401 wrote:</cite><blockquote><div><p>I was wondering what options people are recommending when compiling QEMU</p></div></blockquote></div><p>I typically only use --prefix for local builds.&#160; Why do you need the xen options?&#160; KVM support should be enabled automatically.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477519">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477613" class="blockpost rowodd"> <h2><span><span class="conr">#3342</span> <a href="viewtopic.php?pid=1477613#p1477613">2014-11-21 01:05:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Did you do something special to get the VGA Card working in the guest? I am not a windows pro, but I thought, I only have to install the nvidia blob. Debuging is not easy in Windows 8 :-(</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477613">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477631" class="blockpost roweven"> <h2><span><span class="conr">#3343</span> <a href="viewtopic.php?pid=1477631#p1477631">2014-11-21 04:42:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Hello all,</p><p>I have my kernel patched (downloaded from the first post) and installed.</p><p>my kernel options are:</p><div class="codebox"><pre><code>pcie_aspm=force acpi_osi=Linux acpi=force acpi_enforce_resources=lax i915.enable_rc6=1 i915.enable_fbc=1 i915.lvds_downclock=1 i915.semaphores=1 drm.vblankoffdelay=1 acpi_backlight=vendor intel_pstate=disable pci-stub.ids=10de:1184,10de:030a intel_iommu=on,igfx_off rdblacklist=nouveau nouveau.modeset=0 elevator=noop intremap=no_x2apic_optout libata.force=noncq quiet loglevel=3 i915.enable_hd_vgaarb=1 libata.noacpi=1 pcie_acs_override=downstream</code></pre></div></div></blockquote></div><p>Oh dear, does it also run faster if you <a href="http://lwn.net/Articles/621999/" rel="nofollow">stand on your head</a>?&#160; <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>EDIT: The ironic part is that the i915 maintainer won&#039;t take the enable_hd_vgaarb patch because he doesn&#039;t want users to need to specify module options.&#160; BTW, with all these tuning options, you do know that enable_hd_vgaarb=1 disables host DRI, right?</p><p>About all those options is because I was checking one by one all the error on journalctl when I installed arch and found solutions for all the messages and other problems (vsync, power control,...)</p><p>Yes, I know that disables the DRI inside but I do not care if works fine <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><blockquote><div><p>Running the test part works perfect:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>What was this meant to test?&#160; You&#039;re using <em>-vga cirrus</em> and <em>x-vga=off</em>...&#160; so you&#039;ve successfully attached a secondary GPU?&#160; The test that I&#039;m aware of would be to use <em>-vga none</em> and <em>x-vga=on</em> in order to see if the monitor connected to the assigned GPU lights up from seabios running the VGA ROM.</p><p>Sorry, that was my fault, I tested it with vga none and x-vga=on and working fine (later I disabled it for not changing to HDMI2 on my TV all time)</p><div class="quotebox"><blockquote><div><p>Adding the Virtio Controller works perfect as well:</p><div class="codebox"><pre><code>-device virtio-scsi-pci,id=scsi</code></pre></div><p>Problems?? Yes... when I attach the hard drive / cdrom...</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -bios /usr/share/qemu/bios.bin -vga cirrus -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=off -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/VM/win7.img,id=disk,format=raw -device scsi-hd,drive=disk qemu-system-x86_64: -device scsi-hd,drive=disk: Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use</code></pre></div><p>What I would like, if possible?<br />To have the hard drive with Virtio and two cdroms, one with virtio for Windows 7.iso and the other one with SATA / IDE with the Virtio drivers...</p><p>I did it before but I do not know why is giving me this error with &quot;Property &#039;scsi-hd.drive&#039; can&#039;t take value &#039;disk&#039;, it&#039;s in use&quot;.</p></div></blockquote></div><p><em>disk</em> might be a reserved word, maybe use <em>disk0</em></p></div></blockquote></div><p>I tested with different words there but still the same result...</p><p>Anyway... thanks a lot for your quick reply!!</p><p>Regards,</p><br /><p>TheArcher</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477631">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477632" class="blockpost rowodd"> <h2><span><span class="conr">#3344</span> <a href="viewtopic.php?pid=1477632#p1477632">2014-11-21 04:42:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Did you do something special to get the VGA Card working in the guest? I am not a windows pro, but I thought, I only have to install the nvidia blob. Debuging is not easy in Windows 8 :-(</p></div></blockquote></div><p>Sorry for stepping in , but I didn&#039;t need any special configuration to make both of my Windows 8.1 VMs work . I Just installed Nvidia&#039;s drivers and they were good to go . Also Windows 10 TP worked good (although I didn&#039;t install any drivers , because I was just testing the OS itself) .</p><p>I will do a full Windows 10 installation today if only OVMF would recognize my USB controller for my keyboard to work <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> . Oh wellz .</p> <p class="postedit"><em>Last edited by Denso (2014-11-21 04:43:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477632">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477738" class="blockpost roweven"> <h2><span><span class="conr">#3345</span> <a href="viewtopic.php?pid=1477738#p1477738">2014-11-21 15:48:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you for your answer. I deltetd my drive and installed Win8 again in a new drive. This time I let Windows search for VGA driver. Now the device manager says error code: 43. I dont really know how to proceed.<br />I know, why I use linux -.-</p><p>Little question: How can I eject the card in a Linux guest?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477738">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477790" class="blockpost rowodd"> <h2><span><span class="conr">#3346</span> <a href="viewtopic.php?pid=1477790#p1477790">2014-11-21 18:40:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Thank you for your answer. I deltetd my drive and installed Win8 again in a new drive. This time I let Windows search for VGA driver. Now the device manager says error code: 43. I dont really know how to proceed.<br />I know, why I use linux -.-</p><p>Little question: How can I eject the card in a Linux guest?</p></div></blockquote></div><p>1. You just don&#039;t tell windowns &quot;search for drivers yourself, you filthy slave!&quot;, you feed it with the GUI installer DL&#039;ed from vendor&#039;s site. And if it likes it - everything will work. It might dislike the &quot;food&quot; or the feeding process and randomly throw up BSOD, sometimes the driver install may get completed, but after a reboot it will go BSOD all over your screen and stuff.</p><p>2.Try rmmod(or any other way you like) to unload the modules that claim the card, and you&#039;re good to go &quot;physically&quot; unplugging it, afair. Maybe the device needs to be powered down via sysfs or something.</p><p>EDIT:http://www.linux-kvm.org/page/Hotadd_pci_devices<br />You&#039;ll also need appropriate modules loaded to get pci hotplug working.</p> <p class="postedit"><em>Last edited by Duelist (2014-11-21 19:02:20)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477790">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477798" class="blockpost roweven"> <h2><span><span class="conr">#3347</span> <a href="viewtopic.php?pid=1477798#p1477798">2014-11-21 19:02:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Rommy wrote:</cite><blockquote><div><p>Thank you for your answer. I deltetd my drive and installed Win8 again in a new drive. This time I let Windows search for VGA driver. Now the device manager says error code: 43. I dont really know how to proceed.<br />I know, why I use linux -.-</p></div></blockquote></div><p><a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">VFIO VGA FAQ</a> question 10</p><div class="quotebox"><blockquote><div><p>Little question: How can I eject the card in a Linux guest?</p></div></blockquote></div><p>Something in /sys I&#039;m sure... you were saying about linux...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477798">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477810" class="blockpost rowodd"> <h2><span><span class="conr">#3348</span> <a href="viewtopic.php?pid=1477810#p1477810">2014-11-21 19:46:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Any suggestion to my &quot;it&#039;s in use&quot; issue?</p><p>I really do not know what else to try...</p><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477810">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477812" class="blockpost roweven"> <h2><span><span class="conr">#3349</span> <a href="viewtopic.php?pid=1477812#p1477812">2014-11-21 19:54:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Any suggestion to my &quot;it&#039;s in use&quot; issue?</p><p>I really do not know what else to try...</p><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Add</p><div class="codebox"><pre><code>,if=none</code></pre></div><p>to your disk option, otherwise I think it&#039;s automatically getting added to the vfio-scsi-pci device before the scsi-hd device is being parsed.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477812">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1477817" class="blockpost rowodd"> <h2><span><span class="conr">#3350</span> <a href="viewtopic.php?pid=1477817#p1477817">2014-11-21 20:15:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Any suggestion to my &quot;it&#039;s in use&quot; issue?</p><p>I really do not know what else to try...</p><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Add</p><div class="codebox"><pre><code>,if=none</code></pre></div><p>to your disk option, otherwise I think it&#039;s automatically getting added to the vfio-scsi-pci device before the scsi-hd device is being parsed.</p></div></blockquote></div><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>With that seems to load the fine the hard drive but how can I attach both cdroms (one virtio and one IDE/SATA) if all are giving me the same error?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1477817">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=133">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=132">132</a> <a href="viewtopic.php?id=162768&amp;p=133">133</a> <strong>134</strong> <a href="viewtopic.php?id=162768&amp;p=135">135</a> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=135">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
