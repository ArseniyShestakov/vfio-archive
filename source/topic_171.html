<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 171) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=171" title="Page 171" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=170" title="Page 170" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=172" title="Page 172" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=170">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=169">169</a> <a href="viewtopic.php?id=162768&amp;p=170">170</a> <strong>171</strong> <a href="viewtopic.php?id=162768&amp;p=172">172</a> <a href="viewtopic.php?id=162768&amp;p=173">173</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=172">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1504640" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4251</span> <a href="viewtopic.php?pid=1504640#p1504640">2015-02-20 08:57:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=8908">SchaduwBlink</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2007-01-07</span></dd> <dd><span>Posts: 59</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=8908">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>You should be using &#039;file&#039;&#160; as the disk type for &#039;/dev/mordor/EmmaPC&#039;. This does not look like a valid block device, like /dev/sda2. Also you will want to change the target bus from SATA to IDE, and SCSI to IDE. Here is mine:</p><div class="codebox"><pre><code> &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;source file=&#039;/home/user/virtual_machines/disks/GamingMachineOS.img&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/user/Disk_Images/Windows10_TechnicalPreview_x64_EN-US_9926.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt;</code></pre></div></div></blockquote></div><p>It&#039;s a ZFS ZVol, so I&#039;m installing to a real hard drive partition, with the extras that come along with ZFS. <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> The drives are mapped to /dez/zd*, but I don&#039;t know what numbers and I was afraid they&#039;d change on reboot, but I guess they don&#039;t.</p><p>I&#039;ll make the other changes you said and see if that works.</p><p>But I heard you can use virtio disks to install and OVMF was supposed to pick them up.</p><p>Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504640">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504668" class="blockpost roweven"> <h2><span><span class="conr">#4252</span> <a href="viewtopic.php?pid=1504668#p1504668">2015-02-20 12:23:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Jcrash wrote:</cite><blockquote><div><p>I&#039;ve used roms from other manufacturers (equal hardware specs; gpu/#core&#039;s/clock)</p><p>My process: <br />1. new win7 VM (base, sytem updates) for every rom file<br />2. shutdown; make copy of VM on host<br />3. boot copy; install video drivers (start with most recent, work back)<br />4. working? rename and file</p><p>I threw in the towel because I couldn&#039;t take advantage of any power saving features; VM&#039;s wouldn&#039;t recover from sleep or monitor wake. Force close through host, reboot to a corrupted VM image (every time, unrecoverable), and rollback to step 3.</p><p>Careful though: I have a wireless hdmi 460ti that lost it&#039;s wireless hdmi capability through this type of tinkering (i think). Can&#039;t find the card-specific rom for it so I gambled</p><p>Haven&#039;t tried with win8</p></div></blockquote></div><br /><p>You have been playing with fire. If you have to use romfile, use the one which is for your specific card, even better which you have read yourself from your card. But most of the time you do not need romfile anyway, if the card can actually work with GPU passthrough.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504668">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504670" class="blockpost rowodd"> <h2><span><span class="conr">#4253</span> <a href="viewtopic.php?pid=1504670#p1504670">2015-02-20 12:26:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SchaduwBlink wrote:</cite><blockquote><div><p>My OVMF q35 booting is going strait to the UEFI command line. It doesn&#039;t see my drives. This is part of the libvirt xml:</p><div class="codebox"><pre><code> &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/mordor/EmmaPC&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/media/Storage/OS/en-gb_windows_8.1_enterprise_with_update_x64_dvd_4048611.iso&#039;/&gt; &lt;target dev=&#039;sdb&#039; bus=&#039;scsi&#039;/&gt; &lt;readonly/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt;</code></pre></div><p>This is with me trying the most basic of settings for the drive. I&#039;m using the latest git source for virt-manager and libvirt.</p><p>Hope you can help because I really want to get this set up with q35 because of the better handling of AMD cards.</p></div></blockquote></div><p>whut??? AMD cards have no problem with FX440 at all, unless you are unlucky to own a model which is not suited for GPU passthrough at all. In which case Q35 is not going to help you anyway.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504670">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504683" class="blockpost roweven"> <h2><span><span class="conr">#4254</span> <a href="viewtopic.php?pid=1504683#p1504683">2015-02-20 13:14:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>100% cpu load, nothing on any output.<br />..deep OVMF problems..</p></div></blockquote></div><p>Seems like GPU&#039;s UEFI oprom is broken. Deep debugging to be done... or not. Maybe i&#039;ll just sack the cards and buy something MORE working. Or try poking ASUS. Or something else. But seems like i&#039;m damned with those cards and shall continue digging.</p></div></blockquote></div><p><a href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/" rel="nofollow">http://www.insanelymac.com/forum/topic/ … ati-cards/</a><br />Based on this thread, i&#039;ve created my own, handmade ROM from legacy HD7750&#039;s ROM and HD6450&#039;s GOP EFI part.<br />And it boots with OVMF. Creepy stuff.</p><p>UPD: Win7 installer froze after boot logo animation, win8 goes fine.</p><p>UPD2: Driver install went well. Benchmarking time!<br />If you want my ROM - I can send it.</p> <p class="postedit"><em>Last edited by Duelist (2015-02-20 15:56:48)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504683">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504693" class="blockpost rowodd"> <h2><span><span class="conr">#4255</span> <a href="viewtopic.php?pid=1504693#p1504693">2015-02-20 14:00:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88564">hotfunction</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-05</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>hotfunction wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>If 440fx and -nographic don&#039;t help and you&#039;re looking at the right output from the GPU, I&#039;d next be suspicious of the ROM file.&#160; It looks like one from techpowerup.&#160; Does it actually match your card?&#160; Can you dump the ROM from your card instead?&#160; Do you even need a dump of the ROM?</p></div></blockquote></div><p>hi sir aw.. i tried downloading various ROMs from other sites too, but none of them seems to get me working, they still gave me black screen output on the sscreen... and it seemed to be hard to find nvidia&#039;s ROM corresponding on that... so is it okay if i change into another GPU card? will it help me to work?</p><div class="quotebox"><blockquote><div><p>That black window is the sdl graphics head for the VM which appears because you haven&#039;t used the -nographic option.&#160; The GPU output should be on a monitor connected to the assigned GPU.&#160; I&#039;d also recommend, like I almost always do, using 440fx rather than q35 for the VM.&#160; It looks like you&#039;re using a Linux guest, but afaik, the nvidia driver does not have an issue with PCIe topology in Linux (until you get to lots of GPUs and that may already be fixed too).</p></div></blockquote></div><p>and also about this part... i actually still confused, after some reading and stuff, i redone the steps from nbhs&#039;s page one, after making the single script and others.. i still see the black qemu command line window when adding -vga none... and also without a rom setting, i also tried rombar=0 option and -nographic still didnt give me output.. can you give me further explanation on this.. ?? i am very confused about the black qemu command line, and how does people use -vga none without -nographics to go straight to the VMS without the black qemu command line?</p><p>Edit : i tried adding -curses instead of -nographics, and its still giving me blank output, which i can type &quot;quit&quot; and i can go back to the qemu, which is that i am guessing that is still the black qemu command line output again.. removing that -vga none boots -curses to the VM.. so is the black qemu command line from the -vga none output is showing because of my GPU rom incorrect? or am i missing something..?</p></div></blockquote></div><p>Any help on this anyone? <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504693">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504725" class="blockpost roweven"> <h2><span><span class="conr">#4256</span> <a href="viewtopic.php?pid=1504725#p1504725">2015-02-20 16:57:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>100% cpu load, nothing on any output.<br />..deep OVMF problems..</p></div></blockquote></div><p>Seems like GPU&#039;s UEFI oprom is broken. Deep debugging to be done... or not. Maybe i&#039;ll just sack the cards and buy something MORE working. Or try poking ASUS. Or something else. But seems like i&#039;m damned with those cards and shall continue digging.</p></div></blockquote></div><p><a href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/" rel="nofollow">http://www.insanelymac.com/forum/topic/ … ati-cards/</a><br />Based on this thread, i&#039;ve created my own, handmade ROM from legacy HD7750&#039;s ROM and HD6450&#039;s GOP EFI part.<br />And it boots with OVMF. Creepy stuff.</p><p>UPD: Win7 installer froze after boot logo animation, win8 goes fine.</p><p>UPD2: Driver install went well. Benchmarking time!<br />If you want my ROM - I can send it.</p></div></blockquote></div><p>Congratulations. You can call your GPU &quot;Frankenstein&quot;</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504746" class="blockpost rowodd"> <h2><span><span class="conr">#4257</span> <a href="viewtopic.php?pid=1504746#p1504746">2015-02-20 17:58:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Congratulations. You can call your GPU &quot;Frankenstein&quot;</p></div></blockquote></div><p>I can call my whole system a &quot;Frankenstein&quot; now, my host gpu is tied to the case in front of the CPU cooler, connected via riser card. There&#039;s 1-1.5cm of space between steel brace and 1800rpm 120mm fan.</p><p>BTW, check out my virtual disk subsystem, it&#039;s awesome.<br /><span class="postimg"><img src="http://i.imgur.com/5ABVGyJ.png" alt="yep, that&#039;s GIGABYTES PER SECOND" /></span><br />It&#039;s a raw image residing on now-six-years-old-750gb-wd-black-louder-than-a-CNC-mill connected to the VM via virtio-blk-pci.</p><p>Astonishing read results. I assume there&#039;s some hardcore caching involved.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504746">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504839" class="blockpost roweven"> <h2><span><span class="conr">#4258</span> <a href="viewtopic.php?pid=1504839#p1504839">2015-02-21 00:20:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88886">jaeger</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-16</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88886">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I tested some more today with Fedora 21 and everything works fine there. When I boot back into the CRUX installation I still can&#039;t get things working. I even tried dumping the exact qemu command line from the working libvirt and I see the same results, these same errors:</p><div class="quotebox"><cite>jaeger wrote:</cite><blockquote><div><div class="codebox"><pre><code>qemu-system-x86_64: vfio_pci_read_config(0000:01:00.0, 0x41c, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_write_config(0000:01:00.0, 0x624, 0x0, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_write_config(0000:01:00.0, 0x62c, 0x0, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_write_config(0000:01:00.0, 0x634, 0x0, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_write_config(0000:01:00.0, 0x63c, 0x0, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_read_config(0000:01:00.0, 0x41c, 0x4) failed: Bad address qemu-system-x86_64: vfio_pci_write_config(0000:01:00.0, 0x484, 0x0, 0x4) failed: Bad address</code></pre></div></div></blockquote></div><p>At this point I&#039;m thinking it has to be a kernel configuration issue but I haven&#039;t been able to pinpoint it so far. Searching online hasn&#039;t revealed the answer, there aren&#039;t many hits for these particular errors. Does anyone at all have an idea where I should be looking? It&#039;s getting pretty frustrating at this point, not making any progress.</p><p>For reference, my kernel config already contains these:</p><p>CONFIG_VFIO=m<br />CONFIG_VFIO_PCI=m<br />CONFIG_VFIO_PCI_VGA=y<br />CONFIG_IOMMU_SUPPORT=y<br />CONFIG_INTEL_IOMMU=y<br /># CONFIG_INTEL_IOMMU_DEFAULT_ON is not set<br />CONFIG_KVM_VFIO=y</p><p>pci-stub.ids and intel_iommu=on are passed on the grub2 command line.</p><p>-----</p><p>EDIT: After this bit of whining I decided to try Fedora 21&#039;s kernel config on my CRUX install. Lo and behold, the GTX 970 works properly in the VM after that! So now I have to figure out exactly which option I&#039;m missing, since the Fedora kernel includes a LOT more stuff than mine.</p><p>Now that I know I can make it work in CRUX I feel a lot better, sorry for the downer tone in the post.</p> <p class="postedit"><em>Last edited by jaeger (2015-02-21 00:59:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504839">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504876" class="blockpost rowodd"> <h2><span><span class="conr">#4259</span> <a href="viewtopic.php?pid=1504876#p1504876">2015-02-21 02:15:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88939">Mysingen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-18</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88939">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jaeger wrote:</cite><blockquote><div><p>EDIT: After this bit of whining I decided to try Fedora 21&#039;s kernel config on my CRUX install. Lo and behold, the GTX 970 works properly in the VM after that! So now I have to figure out exactly which option I&#039;m missing, since the Fedora kernel includes a LOT more stuff than mine.</p><p>Now that I know I can make it work in CRUX I feel a lot better, sorry for the downer tone in the post.</p></div></blockquote></div><p>Have you diffed the .config files for both kernels? If that doesn&#039;t reveal anything of interest, you should check for distribution specific kernel patches. At least you shouldn&#039;t have to look anywhere else in the systems since the &quot;adopted&quot; Fedora kernel worked for you in CRUX.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504876">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1504882" class="blockpost roweven"> <h2><span><span class="conr">#4260</span> <a href="viewtopic.php?pid=1504882#p1504882">2015-02-21 03:41:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88886">jaeger</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-16</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88886">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Mysingen wrote:</cite><blockquote><div><p>Have you diffed the .config files for both kernels? If that doesn&#039;t reveal anything of interest, you should check for distribution specific kernel patches. At least you shouldn&#039;t have to look anywhere else in the systems since the &quot;adopted&quot; Fedora kernel worked for you in CRUX.</p></div></blockquote></div><p>That&#039;s what I&#039;ll be doing next, got distracted by trying to pass a usb gamepad into the VM, which is failing. For some reason I can&#039;t get it to play nicely with either my Logitech F710 or Sony DualShock 3. One thing at a time, I guess. :) As far as the kernel config goes, I didn&#039;t apply any of the Fedora patches, just used the .config with vanilla 3.18.7 and things work. So yeah, I&#039;ll be combing through that to figure out which option is the magic one.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1504882">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505053" class="blockpost rowodd"> <h2><span><span class="conr">#4261</span> <a href="viewtopic.php?pid=1505053#p1505053">2015-02-21 18:31:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p><a href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/" rel="nofollow">http://www.insanelymac.com/forum/topic/ … ati-cards/</a><br />Based on this thread, i&#039;ve created my own, handmade ROM from legacy HD7750&#039;s ROM and HD6450&#039;s GOP EFI part.<br />And it boots with OVMF. Creepy stuff.</p><p>UPD: Win7 installer froze after boot logo animation, win8 goes fine.</p><p>UPD2: Driver install went well. Benchmarking time!<br />If you want my ROM - I can send it.</p></div></blockquote></div><p>Thanks a lot for this message! I&#039;ve managed to make my own rom. Since I liked the latest vbios for my 7750, which is a bit overclocked compared to the original, I decided to replace only the buggy GOP part. And it even works! I can boot systemrescuecd in pure EFI mode. Using DRI freezes the VM, though (not that I care at this moment).</p><p>The biggest issue now is that I can&#039;t run windows install. OVMF doesn&#039;t support UDF filesystem that is used by the install image. It refuses to detect an actual USB pendrive created by rufus. My last resort is a fat32 partition. OVMF detects it, and even starts (I get, &quot;Press any key to boot from CD/DVD...&quot;), just to die the moment I press a key. So I&#039;ve turned on the debug console. It looks like the problem is here:</p><div class="codebox"><pre><code>Booting EFI USB Device BlockSize : 512 LastBlock : 7FFFFF Valid efi partition table header Valid efi partition table header Valid primary and Valid backup partition table Partition entries read block success Number of partition entries: 128 start check partition entries End check partition entries Index : 0 Start LBA : 800 End LBA : 7FFFDE Partition size: 7FF7DF Start : 100000 End : FFFFBC00 Prepare to Free Pool InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B 7F307A40 Loading driver at 0x00010000000 EntryPoint=0x000100061C0 cdboot.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF 7EFD8A18 Error: Image at 00010000000 start failed: No mapping Image Return Status = No mapping PlatformBdsBootFail</code></pre></div><p>Wish I knew what &quot;no mapping&quot; means. Can somebody help me? </p><p>P.S. Installing Windows on UEFI is such a pain. :x</p> <p class="postedit"><em>Last edited by deniv (2015-02-21 18:40:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505053">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505061" class="blockpost roweven"> <h2><span><span class="conr">#4262</span> <a href="viewtopic.php?pid=1505061#p1505061">2015-02-21 19:00:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm can someone help me, with <strong>running my windows 8 rootless, using virsh (libvirt)?</strong><br />I&#039;m in libvirt group, still it can&#039;t attach my vfio-pci devices.<br />Also I don&#039;t know how can I handle mounting /dev/sda /dev/sda1 /dev/sdb /dev/sdb2 /dev/sdb5 /dev/sdc /dev/sdc1 /dev/sdd /dev/sdd1 disks on normal user.</p><p>Btw, there is fully working XML (on root, Windows 8 + GTX 970 + SSD as primary + 2 x HDD + mouse, keyboard + some other devices),<br />But maybe someone have any hints, to <span class="bbu">tune performance?</span> My CPU is lacking on guest, don&#039;t have HT on i5-4690K, and 3 cores on host is not good enough for me : /</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;Win81&lt;/name&gt; &lt;uuid&gt;df602579-a4f2-41b9-bb2f-6e23d65a24bd&lt;/uuid&gt; &lt;title&gt;Windows 8.1&lt;/title&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/home/len/win/bios/ovmf_code_x64.bin&lt;/loader&gt; &lt;nvram template=&#039;/home/len/win/bios/ovmf_vars_x64.bin&#039;&gt;/var/lib/libvirt/qemu/nvram/Win81_VARS.fd&lt;/nvram&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;pmu state=&#039;on&#039;/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;on_lockfailure&gt;poweroff&lt;/on_lockfailure&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdb&#039;/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdc&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sdd&#039;/&gt; &lt;target dev=&#039;vdc&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;33:45:1c:fc:6d:cd&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x1&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1b&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc317&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc068&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;rng model=&#039;virtio&#039;&gt; &lt;backend model=&#039;random&#039;&gt;/dev/random&lt;/backend&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/rng&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-cpu&#039;/&gt; &lt;qemu:arg value=&#039;Haswell,kvm=off&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>And some minor case, I have Sound Card, but I can&#039;t attach it using vfio-pci, don&#039;t know why...</p><div class="codebox"><pre><code>05:00.0 Multimedia audio controller [0401]: Creative Labs CA0106 Soundblaster [1102:0007] Subsystem: Creative Labs SB0570 [SB Audigy SE] [1102:100a] Flags: bus master, medium devsel, latency 32, IRQ 19 I/O ports at c000 [size=32] Capabilities: [dc] Power Management version 2 Kernel driver in use: snd_ca0106 Kernel modules: snd_ca0106</code></pre></div><p>Any clues?</p><br /><br /><br /><p>If there is someone whos trying to install Windows 8, there are working qemu args for this XML</p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;virtio-scsi-pci,id=scsi&#039;/&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;file=/home/len/win/win81.iso,id=cd0,if=none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;scsi-cd,drive=cd0&#039;/&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;file=/home/len/win/virtio-win-0.1-100.iso,id=virtiocd,if=none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ide-cd,bus=ide.1,drive=virtiocd&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><br /><p>Also weird case, I have new versions of qemu and libvirt, but </p><div class="codebox"><pre><code> &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt;</code></pre></div><p> is not working for me, so I have use </p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-cpu&#039;/&gt; &lt;qemu:arg value=&#039;Haswell,kvm=off&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><br /><p>Oh, and thanks for help!</p> <p class="postedit"><em>Last edited by Len (2015-02-21 19:03:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505061">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505110" class="blockpost rowodd"> <h2><span><span class="conr">#4263</span> <a href="viewtopic.php?pid=1505110#p1505110">2015-02-21 22:26:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>But maybe someone have any hints, to <span class="bbu">tune performance?</span> My CPU is lacking on guest, don&#039;t have HT on i5-4690K, and 3 cores on host is not good enough for me : /</p></div></blockquote></div><p>Hugepages, vcpu pinning, iothreads for virtio-blk, and virtio for network. AFAIK, io=&#039;native&#039; is good if you want the best latency, otherwise cache=&#039;writeback&#039; is better because it uses the host RAM for caching.<br />Another option is to install Windows on baremetal and use Linux in a VM. Seriously, you want all cores and 3 full disks in your Windows VM. Again, three full disks! It looks like you&#039;re planning to use the Windows VM as your primary machine.</p><div class="quotebox"><cite>Len wrote:</cite><blockquote><div><div class="codebox"><pre><code> &lt;rng model=&#039;virtio&#039;&gt; &lt;backend model=&#039;random&#039;&gt;/dev/random&lt;/backend&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/rng&gt;</code></pre></div></div></blockquote></div><p>AFAIK, there are no virtio-rng drivers for Windows. That device is not used.</p><div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>And some minor case, I have Sound Card, but I can&#039;t attach it using vfio-pci, don&#039;t know why...</p><div class="codebox"><pre><code>05:00.0 Multimedia audio controller [0401]: Creative Labs CA0106 Soundblaster [1102:0007] Subsystem: Creative Labs SB0570 [SB Audigy SE] [1102:100a] Flags: bus master, medium devsel, latency 32, IRQ 19 I/O ports at c000 [size=32] Capabilities: [dc] Power Management version 2 Kernel driver in use: snd_ca0106 Kernel modules: snd_ca0106</code></pre></div><p>Any clues?</p></div></blockquote></div><p>Post logs and how you attach it.</p><div class="quotebox"><cite>Len wrote:</cite><blockquote><div><p>If there is someone whos trying to install Windows 8, there are working qemu args for this XML</p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;virtio-scsi-pci,id=scsi&#039;/&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;file=/home/len/win/win81.iso,id=cd0,if=none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;scsi-cd,drive=cd0&#039;/&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;file=/home/len/win/virtio-win-0.1-100.iso,id=virtiocd,if=none&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ide-cd,bus=ide.1,drive=virtiocd&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div></div></blockquote></div><p>One question. Why? Why do you use qemu:arg to add disks? It&#039;s so much better to use libvirt defines if you&#039;re using libvirt in the first place.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505110">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505116" class="blockpost roweven"> <h2><span><span class="conr">#4264</span> <a href="viewtopic.php?pid=1505116#p1505116">2015-02-21 22:51:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>For your testing consideration: <a href="https://github.com/awilliam/linux-vfio.git" rel="nofollow">https://github.com/awilliam/linux-vfio.git</a> tags/vfio-misc-test-20150221</p><p>A few vfio-pci things I&#039;ve been playing with over the last couple days:</p><p> - Add an <em>ids</em> module option like pci-stub, hopefully self explanatory<br /> - Add a <em>vgaoptout=1</em> module option, also enabled by disabling CONFIG_VFIO_PCI_VGA.&#160; This is useful if you&#039;re using OVMF because it disables VGA region access to devices bound to vfio-pci and marks them as not participating in VGA arbitration.&#160; If you have a config like me (i915 + nvidia + amd) then i915 opts-out of VGA arbitration on the host (but not really), but DRI2 still gets disabled because there are 2 other VGA arbitration participants.&#160; With this and OVMF, there are none and DRI2 works in the host (seems to fix a screensaver bug in the host failing to render the unlock dialog too).<br /> - Put unused devices bound to vfio-pci in D3 power state.&#160; This seems to save 5-10 watts on my system.&#160; If you have a kill-a-watt or other means to measure power, please provide before/after figures.&#160; Anecdotal fan noise might be interesting too.</p><p>This is for testing only, I intend to try to get these upstream, so please don&#039;t ask for refreshes of this series for newer/older kernels.&#160; Thanks.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505116">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505123" class="blockpost rowodd"> <h2><span><span class="conr">#4265</span> <a href="viewtopic.php?pid=1505123#p1505123">2015-02-21 23:23:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for reply so...</p><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>Hugepages, vcpu pinning, iothreads for virtio-blk, and virtio for network. AFAIK, io=&#039;native&#039; is good if you want the best latency, otherwise cache=&#039;writeback&#039; is better because it uses the host RAM for caching.</p></div></blockquote></div><p>Right now, I don&#039;t have much RAM (only 8GB), so I&#039;ll stay with native io.<br />Should I use hugepages, or it&#039;s not needed right now?<br />Disks performance is very good in my opinion, so I&#039;ll stay with this configuration.<br />I have switched my driver for network, thanks for hint!<br />Thanks for info about rnd.</p><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>Another option is to install Windows on baremetal and use Linux in a VM. Seriously, you want all cores and 3 full disks in your Windows VM. Again, three full disks! It looks like you&#039;re planning to use the Windows VM as your primary machine.</p></div></blockquote></div><p>This option is not for me, don&#039;t get me wrong.. I&#039;m trying to switch FROM Windows TO Linux+Windows. I was using very long time windows, and linux for servers (only). So those 3 disks are still using NTFS partitions, but it gonna change later.</p><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>Post logs and how you attach it.</p></div></blockquote></div><p>Group 8 is added to /etc/libvirt/qemu.conf.<br />Stubbed &#039;1102:0007&#039;, binded 0000:05:00.0 to vfio-pci and this is log</p><div class="codebox"><pre><code>2015-02-22 00:10:14.074+0000: starting up LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=none /usr/bin/qemu-system-x86_64 -name Win81 -S -machine pc-i440fx-2.2,accel=kvm,usb=off -cpu Haswell,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff,kvm=off,pmu=on -drive file=/home/len/win/bios/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/Win81_VARS.fd,if=pflash,format=raw,unit=1 -m 6144 -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1 -uuid df602579-a4f2-41b9-bb2f-6e23d65a24bd -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/Win81.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -device lsi,id=scsi0,bus=pci.0,addr=0x2 -drive file=/dev/sdb,if=none,id=drive-virtio-disk0,format=raw,cache=none,aio=native -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x6,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/dev/sdc,if=none,id=drive-virtio-disk1,format=raw,aio=native -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x9,drive=drive-virtio-disk1,id=virtio-disk1 -drive file=/dev/sdd,if=none,id=drive-virtio-disk2,format=raw,aio=native -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0xa,drive=drive-virtio-disk2,id=virtio-disk2 -netdev tap,fd=21,id=hostnet0,vhost=on,vhostfd=22 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=52:54:00:fc:a7:cd,bus=pci.0,addr=0xb -device vfio-pci,host=01:00.0,id=hostdev0,bus=pci.0,multifunction=on,addr=0x4 -device vfio-pci,host=01:00.1,id=hostdev1,bus=pci.0,addr=0x4.0x1 -device vfio-pci,host=00:1b.0,id=hostdev2,bus=pci.0,addr=0x5 -device vfio-pci,host=05:00.0,id=hostdev3,bus=pci.0,addr=0x7 -device usb-host,hostbus=3,hostaddr=3,id=hostdev4 -device usb-host,hostbus=3,hostaddr=2,id=hostdev5 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x3 -cpu Haswell,kvm=off -device virtio-scsi-pci,id=scsi -drive file=/home/len/win/win81.iso,id=cd0,if=none -device scsi-cd,drive=cd0 -drive file=/home/len/win/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd -msg timestamp=on Domain id=3 is tainted: high-privileges Domain id=3 is tainted: custom-argv 2015-02-22T00:10:14.975176Z qemu-system-x86_64: -device vfio-pci,host=05:00.0,id=hostdev3,bus=pci.0,addr=0x7: vfio: error, group 8 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. 2015-02-22T00:10:14.975208Z qemu-system-x86_64: -device vfio-pci,host=05:00.0,id=hostdev3,bus=pci.0,addr=0x7: vfio: failed to get group 8 2015-02-22T00:10:14.975219Z qemu-system-x86_64: -device vfio-pci,host=05:00.0,id=hostdev3,bus=pci.0,addr=0x7: Device initialization failed. 2015-02-22T00:10:14.975232Z qemu-system-x86_64: -device vfio-pci,host=05:00.0,id=hostdev3,bus=pci.0,addr=0x7: Device &#039;vfio-pci&#039; could not be initialized 2015-02-22 00:10:15.096+0000: shutting down</code></pre></div><div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><p>One question. Why? Why do you use qemu:arg to add disks? It&#039;s so much better to use libvirt defines if you&#039;re using libvirt in the first place.</p></div></blockquote></div><p>Got many problems witch &#039;translating&#039; this commands to libvirt XML format, so I just leaved it like that.<br />And if you guess about -cpu host,kvm=off... I have to, otherwise that hidden=on from libvirt, is not working for me</p><p>Oh, and what should I do to run it as normal user, any hints? Right now I have...</p><div class="codebox"><pre><code>virsh start Win81u error: Failed to start domain Win81u error: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505123">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505128" class="blockpost roweven"> <h2><span><span class="conr">#4266</span> <a href="viewtopic.php?pid=1505128#p1505128">2015-02-21 23:45:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Len, what version of libvirt are you using?&#160; You should not need to touch /etc/libvirt/qemu.conf and &lt;qemu:arg&gt; options are nothing but trouble.&#160; They&#039;re often a prime cause of not being able to run a VM w/o screwing with permissions.&#160; Requiring &lt;qemu:arg&gt; for kvm=off is a good indication that something is wrong there.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505128">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505130" class="blockpost rowodd"> <h2><span><span class="conr">#4267</span> <a href="viewtopic.php?pid=1505130#p1505130">2015-02-21 23:50:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Len, what version of libvirt are you using?&#160; You should not need to touch /etc/libvirt/qemu.conf and &lt;qemu:arg&gt; options are nothing but trouble.&#160; They&#039;re often a prime cause of not being able to run a VM w/o screwing with permissions.&#160; Requiring &lt;qemu:arg&gt; for kvm=off is a good indication that something is wrong there.</p></div></blockquote></div><p>Hello aw,</p><div class="codebox"><pre><code>libvirtd (libvirt) 1.2.12 QEMU emulator version 2.2.0, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><p>Ops, I was going through this: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1438076#p1438076" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 6#p1438076</a><br />How should I fix it?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505130">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505131" class="blockpost roweven"> <h2><span><span class="conr">#4268</span> <a href="viewtopic.php?pid=1505131#p1505131">2015-02-21 23:56:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Len, what version of libvirt are you using?&#160; You should not need to touch /etc/libvirt/qemu.conf and &lt;qemu:arg&gt; options are nothing but trouble.&#160; They&#039;re often a prime cause of not being able to run a VM w/o screwing with permissions.&#160; Requiring &lt;qemu:arg&gt; for kvm=off is a good indication that something is wrong there.</p></div></blockquote></div><p>Hello aw,</p><div class="codebox"><pre><code>libvirtd (libvirt) 1.2.12 QEMU emulator version 2.2.0, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><p>Ops, I was going through this: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1438076#p1438076" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 6#p1438076</a><br />How should I fix it?</p></div></blockquote></div><p>Your libvirt version looks ok.&#160; How are you determining that the hidden=&#039;true&#039; option isn&#039;t working?&#160; You should just be able to look at <em>ps aux | grep qemu</em>.&#160; All of the modifications to qemu.conf in that link are <strong>wrong</strong>.&#160; Practically all uses of &lt;qemu:args&gt; is also wrong.&#160; Maybe you want to reset to a default qemu.conf, you might have broken something trying to follow those instructions.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505131">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505136" class="blockpost rowodd"> <h2><span><span class="conr">#4269</span> <a href="viewtopic.php?pid=1505136#p1505136">2015-02-22 00:11:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Your libvirt version looks ok.&#160; How are you determining that the hidden=&#039;true&#039; option isn&#039;t working?&#160; You should just be able to look at <em>ps aux | grep qemu</em>.&#160; All of the modifications to qemu.conf in that link are <strong>wrong</strong>.&#160; Practically all uses of &lt;qemu:args&gt; is also wrong.&#160; Maybe you want to reset to a default qemu.conf, you might have broken something trying to follow those instructions.</p></div></blockquote></div><p>I have removed all qemu args from xml, except kvm=off.</p><p>I have run my vm without qemu:arg kvm=off, and I&#039;m getting Error Code 43.<br />After checking logs for qemu command, one difference is <a href="https://www.diffchecker.com/an4xdivl" rel="nofollow">https://www.diffchecker.com/an4xdivl</a> this, and yet it&#039;s declared before... still don&#039;t know why it&#039;s not working.</p><p>My old qemu.conf: <a href="http://wklej.org/id/1642973/" rel="nofollow">http://wklej.org/id/1642973/</a><br />and libvirtd.conf: <a href="http://wklej.org/id/1642974/" rel="nofollow">http://wklej.org/id/1642974/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505136">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505137" class="blockpost roweven"> <h2><span><span class="conr">#4270</span> <a href="viewtopic.php?pid=1505137#p1505137">2015-02-22 00:15:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Your libvirt version looks ok.&#160; How are you determining that the hidden=&#039;true&#039; option isn&#039;t working?&#160; You should just be able to look at <em>ps aux | grep qemu</em>.&#160; All of the modifications to qemu.conf in that link are <strong>wrong</strong>.&#160; Practically all uses of &lt;qemu:args&gt; is also wrong.&#160; Maybe you want to reset to a default qemu.conf, you might have broken something trying to follow those instructions.</p></div></blockquote></div><p>I have removed all qemu args from xml, except kvm=off.</p><p>I have run my vm without qemu:arg kvm=off, and I&#039;m getting Error Code 43.<br />After checking logs for qemu command, one difference is <a href="https://www.diffchecker.com/an4xdivl" rel="nofollow">https://www.diffchecker.com/an4xdivl</a> this, and yet it&#039;s declared before... still don&#039;t know why it&#039;s not working.</p><p>My old qemu.conf: <a href="http://wklej.org/id/1642973/" rel="nofollow">http://wklej.org/id/1642973/</a><br />and libvirtd.conf: <a href="http://wklej.org/id/1642974/" rel="nofollow">http://wklej.org/id/1642974/</a></p></div></blockquote></div><p>From your diff:</p><div class="codebox"><pre><code>-cpu Haswell,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff,kvm=off,pmu=on ... -cpu Haswell,kvm=off</code></pre></div><p>Tell me again how hidden=&#039;on&#039; isn&#039;t working...&#160; Of course you&#039;re still getting code 43, you still have hyperv extensions enabled.&#160; This is covered in the <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">faq</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505137">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505140" class="blockpost rowodd"> <h2><span><span class="conr">#4271</span> <a href="viewtopic.php?pid=1505140#p1505140">2015-02-22 00:23:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Tell me again how hidden=&#039;on&#039; isn&#039;t working...&#160; Of course you&#039;re still getting code 43, you still have hyperv extensions enabled.&#160; This is covered in the <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">faq</a></p></div></blockquote></div><p>I guess, my first cpu declaration </p><div class="codebox"><pre><code>-cpu Haswell,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff,kvm=off,pmu=on</code></pre></div><p>was ignored due to second</p><div class="codebox"><pre><code>-cpu Haswell,kvm=off</code></pre></div><p>Okay, it&#039;s working with hidden=on, sorry for problems.</p><br /><p>About running libvirt on normal user, I&#039;m doing something wrong?</p><div class="codebox"><pre><code>[len@holo ~]$ virsh start Win81 error: Failed to start domain Win81 error: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable</code></pre></div><p>libvirtd.conf: <a href="http://wklej.org/id/1642998/" rel="nofollow">http://wklej.org/id/1642998/</a><br />qemu.conf: <a href="http://wklej.org/id/1643001/" rel="nofollow">http://wklej.org/id/1643001/</a><br />xml: <a href="http://wklej.org/id/1643004/" rel="nofollow">http://wklej.org/id/1643004/</a></p> <p class="postedit"><em>Last edited by Len (2015-02-22 01:32:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505140">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505157" class="blockpost roweven"> <h2><span><span class="conr">#4272</span> <a href="viewtopic.php?pid=1505157#p1505157">2015-02-22 02:47:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Len wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Tell me again how hidden=&#039;on&#039; isn&#039;t working...&#160; Of course you&#039;re still getting code 43, you still have hyperv extensions enabled.&#160; This is covered in the <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow">faq</a></p></div></blockquote></div><p>I guess, my first cpu declaration </p><div class="codebox"><pre><code>-cpu Haswell,hv_time,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff,kvm=off,pmu=on</code></pre></div><p>was ignored due to second</p><div class="codebox"><pre><code>-cpu Haswell,kvm=off</code></pre></div><p>Okay, it&#039;s working with hidden=on, sorry for problems.</p><br /><p>About running libvirt on normal user, I&#039;m doing something wrong?</p><div class="codebox"><pre><code>[len@holo ~]$ virsh start Win81 error: Failed to start domain Win81 error: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable</code></pre></div><p>libvirtd.conf: <a href="http://wklej.org/id/1642998/" rel="nofollow">http://wklej.org/id/1642998/</a><br />qemu.conf: <a href="http://wklej.org/id/1643001/" rel="nofollow">http://wklej.org/id/1643001/</a><br />xml: <a href="http://wklej.org/id/1643004/" rel="nofollow">http://wklej.org/id/1643004/</a></p></div></blockquote></div><p>You can find a default qemu.conf here: <a href="http://libvirt.org/git/?p=libvirt.git;a=blob_plain;f=src/qemu/qemu.conf;h=1c589a232ee5f849e9a18a26a867ab4212c9efe3;hb=HEAD" rel="nofollow">http://libvirt.org/git/?p=libvirt.git;a … e3;hb=HEAD</a></p><p>Reboot to make sure it takes effect.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505157">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505162" class="blockpost rowodd"> <h2><span><span class="conr">#4273</span> <a href="viewtopic.php?pid=1505162#p1505162">2015-02-22 02:57:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You can find a default qemu.conf here: <a href="http://libvirt.org/git/?p=libvirt.git;a=blob_plain;f=src/qemu/qemu.conf;h=1c589a232ee5f849e9a18a26a867ab4212c9efe3;hb=HEAD" rel="nofollow">http://libvirt.org/git/?p=libvirt.git;a … e3;hb=HEAD</a></p><p>Reboot to make sure it takes effect.</p></div></blockquote></div><p>Okay got it, so safely what should I change?</p><p>My old qemu.conf </p><div class="codebox"><pre><code>security_driver = &quot;none&quot; security_default_confined = 0 user = &quot;+0&quot; group = &quot;+0&quot; dynamic_ownership = 1 cgroup_device_acl = [ &quot;/dev/null&quot;, &quot;/dev/full&quot;, &quot;/dev/zero&quot;, &quot;/dev/random&quot;, &quot;/dev/urandom&quot;, &quot;/dev/ptmx&quot;, &quot;/dev/kvm&quot;, &quot;/dev/kqemu&quot;, &quot;/dev/rtc&quot;,&quot;/dev/hpet&quot;, &quot;/dev/vfio/vfio&quot;, &quot;/dev/vfio/1&quot;, &quot;/dev/vfio/7&quot;, &quot;/dev/vfio/8&quot; ] hugetlbfs_mount = &quot;/dev/hugepages&quot; clear_emulator_capabilities = 0 relaxed_acs_check = 1</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505162">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505163" class="blockpost roweven"> <h2><span><span class="conr">#4274</span> <a href="viewtopic.php?pid=1505163#p1505163">2015-02-22 03:02:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><strong>You should not need to touch /etc/libvirt/qemu.conf</strong></p></div></blockquote></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505163">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1505165" class="blockpost rowodd"> <h2><span><span class="conr">#4275</span> <a href="viewtopic.php?pid=1505165#p1505165">2015-02-22 03:05:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87813">Len</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/87813.png?m=1420509844" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87813">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><strong>You should not need to touch /etc/libvirt/qemu.conf</strong></p></div></blockquote></div></div></blockquote></div><p>Without touching user, group:</p><div class="codebox"><pre><code>$ virsh start Win81 error: Failed to start domain Win81 error: Requested operation is not valid: PCI device 0000:01:00.0 is not assignable # virsh start Win81 error: Failed to start domain Win81 error: internal error: process exited while connecting to monitor: Could not access KVM kernel module: Permission denied failed to initialize KVM: Permission denied</code></pre></div><p>After changing user and group to root, I can use my vm as root, on user still same error.</p><p>Btw, forgot to ask... I have &#039;The drivers for this device are not installed.&#039; on SCSI Controller in Windows 8, all the time...<br />PCI\VEN_1000&amp;DEV_0012&amp;SUBSYS_10000000&amp;REV_00<br />Where can I get this drivers?</p><p>Can I catch you somewhere on IRC, aw?</p> <p class="postedit"><em>Last edited by Len (2015-02-22 03:32:34)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1505165">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=170">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=169">169</a> <a href="viewtopic.php?id=162768&amp;p=170">170</a> <strong>171</strong> <a href="viewtopic.php?id=162768&amp;p=172">172</a> <a href="viewtopic.php?id=162768&amp;p=173">173</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=172">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
