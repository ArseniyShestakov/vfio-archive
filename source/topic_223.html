<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 223) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=223" title="Page 223" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=222" title="Page 222" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=224" title="Page 224" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=222">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <strong>223</strong> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=224">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1543607" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5551</span> <a href="viewtopic.php?pid=1543607#p1543607">2015-07-10 19:47:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="codebox"><pre><code>ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1</code></pre></div></div></blockquote></div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><div class="codebox"><pre><code>/init/ line 1 = ivrs_ioapic[9]=00:14.0 : Command not found /init/ line 1 = ivrs_ioapic[10]=00:00.1 : Command not found</code></pre></div><p>or something like that.</p></div></blockquote></div><p>Wait, how could i miss that part of his message?&gt;_&lt;<br />Sorry for bothering guys.</p><p>@Zeorymer:<br />Are you sure you&#039;ve put that command line switches into the right... place?<br />Cause if you&#039;re running kernel newer than 3.19(where there&#039;s a patch for that) - that line is your only solution apart from aw&#039;s ultimate one.</p></div></blockquote></div><p>Kernel was posted several posts ago: 4.0.7<br />Processor is an 8350.</p><div class="codebox"><pre class="vscroll"><code>GRUB_DEFAULT=0 GRUB_TIMEOUT=5 GRUB_DISTRIBUTOR=&quot;Arch&quot; GRUB_CMDLINE_LINUX_DEFAULT=&quot;iommu=debug,verbose amd_iommu_dump=1 ivrs_ioapic[9]=00:14.0 ivrs_ioapic[10]=00:00.1&quot; GRUB_CMDLINE_LINUX=&quot;&quot; # # Preload both GPT and MBR modules so that they are not missed GRUB_PRELOAD_MODULES=&quot;part_gpt part_msdos&quot; # Uncomment to enable Hidden Menu, and optionally hide the timeout count #GRUB_HIDDEN_TIMEOUT=5 #GRUB_HIDDEN_TIMEOUT_QUIET=true # Uncomment to use basic console GRUB_TERMINAL_INPUT=console # Uncomment to disable graphical terminal #GRUB_TERMINAL_OUTPUT=console # The resolution used on graphical terminal # note that you can use only modes which your graphic card supports via VBE # you can see them in real GRUB with the command `vbeinfo&#039; GRUB_GFXMODE=auto # Uncomment to allow the kernel use the same resolution used by grub GRUB_GFXPAYLOAD_LINUX=keep # Uncomment if you want GRUB to pass to the Linux kernel the old parameter # format &quot;root=/dev/xxx&quot; instead of &quot;root=/dev/disk/by-uuid/xxx&quot; #GRUB_DISABLE_LINUX_UUID=true # Uncomment to disable generation of recovery mode menu entries #GRUB_DISABLE_RECOVERY=true # Uncomment and set to the desired menu colors. Used by normal and wallpaper # modes only. Entries specified as foreground/background. GRUB_COLOR_NORMAL=&quot;light-blue/black&quot; GRUB_COLOR_HIGHLIGHT=&quot;light-cyan/blue&quot; # Uncomment one of them for the gfx desired, a image background or a gfxtheme #GRUB_BACKGROUND=&quot;/path/to/wallpaper&quot; #GRUB_THEME=&quot;/path/to/gfxtheme&quot; # Uncomment to get a beep at GRUB start #GRUB_INIT_TUNE=&quot;480 440 1&quot; #GRUB_SAVEDEFAULT=&quot;true&quot;</code></pre></div><p>This is where I put it, is this wrong?&#160; I know there are other things in there that I recently added to see if I can get other information (first one doesn&#039;t seem to do anything new).</p><p>What I find odd id that I get the command not found messages but I don&#039;t get the IVRS messages being mapped wrong...which leads me to believe that the kernel THINKS the command is being passed(?)</p><p>So...a new board is the only solution?&#160; Damn you Asus.</p></div></blockquote></div><div class="codebox"><pre><code>/init/ line 1 = ivrs_ioapic[9]=00:14.0 : Command not found /init/ line 1 = ivrs_ioapic[10]=00:00.1 : Command not found</code></pre></div><p>Those lines mean nothing, i get them too, the kernel arguments get passed you can check by doing cat /proc/cmdline, it has something to do with the mknitcpio script parsing the kernel parameters, but its nothing to worry about</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543607">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543619" class="blockpost roweven"> <h2><span><span class="conr">#5552</span> <a href="viewtopic.php?pid=1543619#p1543619">2015-07-10 21:28:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I hit a brick wall trying to add SATA passthrough to my setup. Passing through the seconday onboard controller, a Marvell 6121 if I remember correctly, locked everything up, and I mean everything. Even the hardware reset button did nothing. WTF? Obviously I could not get any error messages out of this. I purchased a PCIe SATA addon card. That one&#039;s a Marvell 91xx. The thought of using something else than Marvell crossed my mind but I couldn&#039;t find anything reasonable at the moment. </p><p>I connected one of my SSDs to the device. My grub is actually on that SSD but the drive is not needed afterwards and my system boots fine with the controller pci-stubbed. Of course I wouldn&#039;t be able to install anything on it without breaking my host OS but this is just a proof of concept to see if it works before I rearrange things.</p><p>Now I don&#039;t get the hard crash but the SATA passthrough still does not work. For one thing, SeaBIOS takes long, maybe almost a minute before anything else than the SeaBIOS version string appears every time I pass through the devices on the addon card. When it gets going, I can&#039;t get any bootable devices, not even the virtualised ones defined with the -drive option. No install media or disk images show up. Enabling the boot menu shows only the virtualised floppy drive, PXE boot and such. I tried starting a very minimalistic setup to rule out everything else but the result is the same.</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 10240 -cpu host,kvm=off -smp 8,sockets=1,cores=4,threads=2 -cdrom windows_7.iso -device vfio-pci,host=07:00.0 -device vfio-pci,host=07:00.1</code></pre></div><p>where 7:00.0 is the SATA device and 7:00.1 is an IDE device on the same card. They share the same IOMMU group so I&#039;m passing both of them. The install medium is an untouched Windows 7 SP1 image. I also tried installing the guest to a virtualised image and adding the SATA controller on the next boot. Everything gone again. I cannot understand why even the virtualised drives disappear. Am I doing something obviously wrong? As for providing debug output, I haven&#039;t found anything to provide. Nothing appears in dmesg when things go haywire. I initially got &quot;nobody cared about IRQ&quot; messages but moving the SATA card to another PCIe slot with its own IRQ fixed those. I see libvirt is the common way nowadays. I tried the SeaBIOS way with virt-manager but it behaved exactly the same as with using qemu directly.</p><p>I also tried using OVMF instead of SeaBIOS but I had even less success with that. The Windows installer always froze at the animated Win logo. I tried with an old OVMF version (r15214) and the latest build from <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">https://www.kraxel.org/repos/jenkins/edk2/</a>. My very minimalistic VM, without even any drives attached:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 10240 -cpu host,kvm=off -smp 8,sockets=1,cores=4,threads=2 -cdrom windows_7.iso -drive file=OVMF_CODE-pure-efi.fd,if=pflash,format=raw,unit=0,readonly=on -drive file=OVMF_VARS-pure-efi.fd,if=pflash,format=raw,unit=1</code></pre></div><p>Interestingly, passing through the SATA controller does not hinder the boot when using OVMF but I cannot see if it would actually work since I can&#039;t get anywhere in installing the guest.<br />So frustrating when everything else than the SATA matter is falling into place so nicely.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543619">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543621" class="blockpost rowodd"> <h2><span><span class="conr">#5553</span> <a href="viewtopic.php?pid=1543621#p1543621">2015-07-10 21:33:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>impulse_255 wrote:</cite><blockquote><div><p>I also tried using OVMF instead of SeaBIOS but I had even less success with that. The Windows installer always froze at the animated Win logo. I tried with an old OVMF version (r15214) and the latest build from <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">https://www.kraxel.org/repos/jenkins/edk2/</a>. My very minimalistic VM, without even any drives attached:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 10240 -cpu host,kvm=off -smp 8,sockets=1,cores=4,threads=2 -cdrom windows_7.iso -drive file=OVMF_CODE-pure-efi.fd,if=pflash,format=raw,unit=0,readonly=on -drive file=OVMF_VARS-pure-efi.fd,if=pflash,format=raw,unit=1</code></pre></div><p>Interestingly, passing through the SATA controller does not hinder the boot when using OVMF but I cannot see if it would actually work since I can&#039;t get anywhere in installing the guest.<br />So frustrating when everything else than the SATA matter is falling into place so nicely.</p></div></blockquote></div><p>i dont think OVMF is able to boot from a sata controller right now, i posted a patched binary like 50 pages back, theres also <a href="https://aur.archlinux.org/packages/ovmf-fishman-git/" rel="nofollow">ovmf-fishman-git</a> on aur</p> <p class="postedit"><em>Last edited by nbhs (2015-07-10 21:34:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543621">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543627" class="blockpost roweven"> <h2><span><span class="conr">#5554</span> <a href="viewtopic.php?pid=1543627#p1543627">2015-07-10 22:29:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>impulse_255 wrote:</cite><blockquote><div><p>I also tried using OVMF instead of SeaBIOS but I had even less success with that. The Windows installer always froze at the animated Win logo. I tried with an old OVMF version (r15214) and the latest build from <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">https://www.kraxel.org/repos/jenkins/edk2/</a>. My very minimalistic VM, without even any drives attached:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 10240 -cpu host,kvm=off -smp 8,sockets=1,cores=4,threads=2 -cdrom windows_7.iso -drive file=OVMF_CODE-pure-efi.fd,if=pflash,format=raw,unit=0,readonly=on -drive file=OVMF_VARS-pure-efi.fd,if=pflash,format=raw,unit=1</code></pre></div><p>Interestingly, passing through the SATA controller does not hinder the boot when using OVMF but I cannot see if it would actually work since I can&#039;t get anywhere in installing the guest.<br />So frustrating when everything else than the SATA matter is falling into place so nicely.</p></div></blockquote></div><p>i dont think OVMF is able to boot from a sata controller right now, i posted a patched binary like 50 pages back, theres also <a href="https://aur.archlinux.org/packages/ovmf-fishman-git/" rel="nofollow">ovmf-fishman-git</a> on aur</p></div></blockquote></div><p>Good to know, thank you. I also just noticed Alex (thank you as well for all the materials on VFIO and passthrough) has said Windows 8+ is needed for OVMF, my bad. From what I have read, the 64-bit version of 7 should work with UEFI so I thought I would be fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543634" class="blockpost rowodd"> <h2><span><span class="conr">#5555</span> <a href="viewtopic.php?pid=1543634#p1543634">2015-07-10 23:03:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@impulse_255</p><p>It is possible to use OVMF with win7, I haven&#039;t gone back to add that blog post yet.&#160; Seems like I ran into libvirt issues that made me back-burner it for a while.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543634">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543640" class="blockpost roweven"> <h2><span><span class="conr">#5556</span> <a href="viewtopic.php?pid=1543640#p1543640">2015-07-11 00:30:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@impulse_255</p><p>It is possible to use OVMF with win7, I haven&#039;t gone back to add that blog post yet.&#160; Seems like I ran into libvirt issues that made me back-burner it for a while.</p></div></blockquote></div><p>Off-topic:<br />#5555<br />Could you please explain what...<br />&quot;made me back-burner it&quot; meant? My foolish mind only finds associations with butthurt.<br />On-topic:<br />Win7 with OVMF requires some special hacks - you should add QXL graphics device for the duration of install, otherwise you won&#039;t be able to see anything.<br />This is covered in <a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a>.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543640">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543641" class="blockpost rowodd"> <h2><span><span class="conr">#5557</span> <a href="viewtopic.php?pid=1543641#p1543641">2015-07-11 00:32:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Duelist</p><p><a href="http://idioms.thefreedictionary.com/on+the+back+burner" rel="nofollow">http://idioms.thefreedictionary.com/on+the+back+burner</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543641">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543642" class="blockpost roweven"> <h2><span><span class="conr">#5558</span> <a href="viewtopic.php?pid=1543642#p1543642">2015-07-11 00:42:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@Duelist</p><p><a href="http://idioms.thefreedictionary.com/on+the+back+burner" rel="nofollow">http://idioms.thefreedictionary.com/on+the+back+burner</a></p></div></blockquote></div><p>Well...<br />Seems like it&#039;s the different cultures - if not the same size, all the big burners on the stove are located farther away from the edge. I guess it has to do something with fire safety. And usually that burners are used for some long-term powerful cooking, like a 10L of some soup. So yeah, it kinda makes sense.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543642">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543646" class="blockpost rowodd"> <h2><span><span class="conr">#5559</span> <a href="viewtopic.php?pid=1543646#p1543646">2015-07-11 01:18:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>Great, everything works; even the PCI wifi card. Oh, except the Code 43.</p><p>I&#039;m using a GTX 980, is it too new for the workarounds? Was all this for nothing?</p></div></blockquote></div><p>Sorry, no data, no help.&#160; I&#039;m not going to guess whether you followed the instructions to edit the domain xml to remove the hyper-v extensions.</p></div></blockquote></div><p>Yeah, I did, to the letter. Guest is running 344.11 drivers, connected via DVI; no output. Code 43 at all times, and Windows doesnt recognize it without drivers, not even as a generic display device. <strong>All</strong> hyper-v extentions, the clock entry, the lot, have been removed from the xml config. Is there anything else that can trigger it?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543646">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543649" class="blockpost roweven"> <h2><span><span class="conr">#5560</span> <a href="viewtopic.php?pid=1543649#p1543649">2015-07-11 02:54:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>Great, everything works; even the PCI wifi card. Oh, except the Code 43.</p><p>I&#039;m using a GTX 980, is it too new for the workarounds? Was all this for nothing?</p></div></blockquote></div><p>Sorry, no data, no help.&#160; I&#039;m not going to guess whether you followed the instructions to edit the domain xml to remove the hyper-v extensions.</p></div></blockquote></div><p>Yeah, I did, to the letter. Guest is running 344.11 drivers, connected via DVI; no output. Code 43 at all times, and Windows doesnt recognize it without drivers, not even as a generic display device. <strong>All</strong> hyper-v extentions, the clock entry, the lot, have been removed from the xml config. Is there anything else that can trigger it?</p></div></blockquote></div><p>&quot;Removed&quot;?<br />Correct me if i&#039;m wrong, but check again, i think some of them were default on.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543649">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543651" class="blockpost rowodd"> <h2><span><span class="conr">#5561</span> <a href="viewtopic.php?pid=1543651#p1543651">2015-07-11 03:05:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sorry, no data, no help.&#160; I&#039;m not going to guess whether you followed the instructions to edit the domain xml to remove the hyper-v extensions.</p></div></blockquote></div><p>Yeah, I did, to the letter. Guest is running 344.11 drivers, connected via DVI; no output. Code 43 at all times, and Windows doesnt recognize it without drivers, not even as a generic display device. <strong>All</strong> hyper-v extentions, the clock entry, the lot, have been removed from the xml config. Is there anything else that can trigger it?</p></div></blockquote></div><p>&quot;Removed&quot;?<br />Correct me if i&#039;m wrong, but check again, i think some of them were default on.</p></div></blockquote></div><p>As in, I removed them.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543651">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543652" class="blockpost roweven"> <h2><span><span class="conr">#5562</span> <a href="viewtopic.php?pid=1543652#p1543652">2015-07-11 03:07:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Don&#039;t tell us what you did, show us</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543652">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543653" class="blockpost rowodd"> <h2><span><span class="conr">#5563</span> <a href="viewtopic.php?pid=1543653#p1543653">2015-07-11 03:19:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>When I get home I&#039;ll upload the domain XML, is there anything else you need to see?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543653">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543757" class="blockpost roweven"> <h2><span><span class="conr">#5564</span> <a href="viewtopic.php?pid=1543757#p1543757">2015-07-11 14:41:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OT</p><div class="quotebox"><blockquote><div><p>I guess it has to do something with fire safety. And usually that burners are used for some long-term powerful cooking, like a 10L of some soup. So yeah, it kinda makes sense.</p></div></blockquote></div><p>Don&#039;t any of you cook? Or do you just sit at the computer all day until food magically appears courtesy of some long neglected spouse? :roll eyes:</p> <p class="postedit"><em>Last edited by mostlyharmless (2015-07-11 14:41:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543757">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543877" class="blockpost rowodd"> <h2><span><span class="conr">#5565</span> <a href="viewtopic.php?pid=1543877#p1543877">2015-07-11 22:57:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><strong>Upgraded to 4.2-rc1 :</strong></p><p>All of the VMs with GPUs passed through to them suffer from no output on their respective screens , checking htop , these VMs are stuck on 100% CPU load on their threads .</p><p>dmesg shows no errors or warnings . QEMU command line doesn&#039;t return any errors or warnings either . </p><p>Reverting back to 4.1-rc7 , and everything is working like it should . (No config or script files changes were done , just upgrading &amp; downgrading the kernel) .</p> <p class="postedit"><em>Last edited by Denso (2015-07-11 22:59:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543877">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543881" class="blockpost roweven"> <h2><span><span class="conr">#5566</span> <a href="viewtopic.php?pid=1543881#p1543881">2015-07-11 23:39:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Success at last! Though not without lots of setbacks and cursing at my computer.</p><p>With OVMF and Windows 8 I managed to pass through my add-on Marvell controller. However, with the latest OVMF build I could not install Windows. At the point the installer starts copying files to the new system partition, I got a BSOD (or is it a frowny face these days?) with a KMODE_EXCEPTION_NOT_HANDLED error code. This only occurred when running on OVMF, not on SeaBIOS. In UEFI mode, Windows also seems to be VERY pissy about showing disk drives that are not exactly the way it wants (GPT and such), even with drive images that should be empty. I recall it was just as terrible when I tried without success to install Win 7 in UEFI mode on this hardware back in 2011 so no surprises there.</p><p>I dug up the SATA patched OVMF binaries as hinted by nbhs. With them, the installer finished without problems! I have not tried installing on a passed-through drive or booting from one yet. The system drive is on VirtIO and the drive on the passed controller is a secondary one that I added after installation. During the first boot with the controller passed through I got a BSOD related to viostor (VirtIO). It also froze my host, but at least the reset button still worked <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />. Next boot went smoothly. Don&#039;t know what went wrong there.</p><p>Even if this is as far as I&#039;ll manage to get, it should already be helpful if the games are installed on the passed drive and load their stuff from there. On a side note, the Marvell controller&#039;s performance is shoddy. I get 180MB/90MB R/W sequential. Googling revealed that it seems to be on par with what can be expected. Access times are down to 0.3-0.5 ms though, which is nice. I have not tried games on the passed drive yet but I&#039;m hoping the IO related stuttering isn&#039;t there anymore. Lots of other optimisations such as cpu pinning still to do, anyway.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543881">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543913" class="blockpost rowodd"> <h2><span><span class="conr">#5567</span> <a href="viewtopic.php?pid=1543913#p1543913">2015-07-12 05:04:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87349">sunmast</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87349">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is it possible to run OSX with OVMF method?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543913">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543923" class="blockpost roweven"> <h2><span><span class="conr">#5568</span> <a href="viewtopic.php?pid=1543923#p1543923">2015-07-12 06:16:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75548">Schlunze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-03</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ts_reload@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@impulse_255</p><p>It is possible to use OVMF with win7, I haven&#039;t gone back to add that blog post yet.&#160; Seems like I ran into libvirt issues that made me back-burner it for a while.</p></div></blockquote></div><p>Yes, like others here mentioned all disks reconized by win7uefi need gpt. For dual boot you need to add legacy ide drivers in win registry if virtio drivers are used in libvirt/qemu.<br />On my machine sata controller-passtrough never worked the expected way, also with marvell-sata-controller. Others got it running with Asrock Z97 Extreme6. One time i´ve seen the disk during win7 ovmf installation, after installation reboot, it also hung up. Maybe it was the graphic-card like mentioned. </p><p>I took the route without sata-controller passthrough since i´ve read in several posts, performance is comparable and system-stability without is better. <br />Don´t know exactly if this is right.</p><p>Good luck @Impulse_255</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543923">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1543938" class="blockpost rowodd"> <h2><span><span class="conr">#5569</span> <a href="viewtopic.php?pid=1543938#p1543938">2015-07-12 09:05:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><span class="postimg"><img src="http://i.imgur.com/fkl8JlE.jpg" alt="fkl8JlE.jpg" /></span><br />Aww, going from Catalyst 14.12 to Catalyst 15.7 on Win7 wasn&#039;t as easy as I had hoped <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1543938">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544056" class="blockpost roweven"> <h2><span><span class="conr">#5570</span> <a href="viewtopic.php?pid=1544056#p1544056">2015-07-12 17:43:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p><strong>Upgraded to 4.2-rc1 :</strong></p><p>All of the VMs with GPUs passed through to them suffer from no output on their respective screens , checking htop , these VMs are stuck on 100% CPU load on their threads .</p><p>dmesg shows no errors or warnings . QEMU command line doesn&#039;t return any errors or warnings either . </p><p>Reverting back to 4.1-rc7 , and everything is working like it should . (No config or script files changes were done , just upgrading &amp; downgrading the kernel) .</p></div></blockquote></div><p>Thanks for the report!&#160; I&#039;ve bisected it back to <a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=d69afbc6b1b5d0579f13d1a6339d952c4f60a9f4" rel="nofollow">this commit</a>.</p><p>In my testing, the VM is not hung, but it does take over 90 seconds to get the OVMF splash screen (Seabios is less affected but still noticeable).&#160; I&#039;ve <a href="https://lkml.org/lkml/2015/7/12/115" rel="nofollow">reported the problem upstream</a>.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544056">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544063" class="blockpost rowodd"> <h2><span><span class="conr">#5571</span> <a href="viewtopic.php?pid=1544063#p1544063">2015-07-12 17:55:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Thanks ! Actually it takes around 5 minutes for me , and the VM operates in Slow motion mode . (When a key stroke is sent the actual response happens 5 seconds later) .</p><p>Hopefully it will be fixed for -rc2 or 3 .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544063">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544064" class="blockpost roweven"> <h2><span><span class="conr">#5572</span> <a href="viewtopic.php?pid=1544064#p1544064">2015-07-12 17:58:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@aw :</p><p>Thanks ! Actually it takes around 5 minutes for me , and the VM operates in Slow motion mode . (When a key stroke is sent the actual response happens 5 seconds later) .</p><p>Hopefully it will be fixed for -rc2 or 3 .</p></div></blockquote></div><p>The only issue I see is pre-boot, once the guest OS is running, performance is normal.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544064">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544095" class="blockpost rowodd"> <h2><span><span class="conr">#5573</span> <a href="viewtopic.php?pid=1544095#p1544095">2015-07-12 20:29:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sunmast wrote:</cite><blockquote><div><p>Is it possible to run OSX with OVMF method?</p></div></blockquote></div><p>Yes. I have a proof-picture, if you&#039;re curious.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544095">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544097" class="blockpost roweven"> <h2><span><span class="conr">#5574</span> <a href="viewtopic.php?pid=1544097#p1544097">2015-07-12 20:31:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="http://lists.nongnu.org/archive/html/qemu-discuss/2015-07/msg00021.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00021.html</a><br />Isn&#039;t that&#039;s just what VFIO was made for? I mean, Virtual Function...</p><p>ALSO:<br /><a href="https://support.microsoft.com/en-us/kb/314082/en-us" rel="nofollow">https://support.microsoft.com/en-us/kb/314082/en-us</a><br />Finally found an article for those of you who experiment with various hard drive controllers, like virtio, bare metal and stuff.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-12 20:40:34)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544097">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544109" class="blockpost rowodd"> <h2><span><span class="conr">#5575</span> <a href="viewtopic.php?pid=1544109#p1544109">2015-07-12 21:21:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92145">Peetipablo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-26</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92145">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So my VM is pretty stable and games are playable, however I&#039;m having some serious problems with audio.</p><p>Passing through host audio with -soundhw hda gives me verybad DPC latency, spiking up to 8000 microseconds regularly and never drops below 1000.&#160; Running the process using round robin scheduler as reccomended on page 6 works helps, DPC latency is stable at 1000 and never spiking however whenever I quit the VM, qemu process redlines all my processor cores and my computer becomes very unresponsive unless I am able to tab to a terminal and killall qemu-system-x86_64.</p><p>I also have a USB razer kraken headset, however passing it using -usbdevice there is much audio cracking and nothing I try reduces that at all.</p><p>I&#039;ve tried using both alsa and pulse for audio and neither work better than the other... anyone have any suggestions on how I can reduce my DPC latency to normal values?</p><p>Edit:</p><p>Specifications:<br />Processor - Intel i5 4690k<br />Memory - 16GB<br />VM GPU - Radeon R9 290<br />Host GPU - Intel iGPU<br />Guest OS - Windows 8.1 64bit</p><p>qemu startup script:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash #Start synergy client systemctl start synergyc@peetipablo #Screen setup xrandr --output DP1 --off xrandr --output HDMI1 --off xrandr --output HDMI3 --primary --auto sleep 1 #start QEMU emulation QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64 -name win8 -machine pc-i440fx-utopic,accel=kvm,usb=off -cpu Haswell,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time \ -bios OVMF.fd -m 8192 -mem-path /dev/hugepages -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1 \ -localtime -nographic \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/OVMF.fd \ -drive if=pflash,format=raw,file=/usr/share/ovmf/OVMF_VARS-pure-efi.fd \ -device virtio-scsi-pci,id=scsi \ -device vfio-pci,host=01:00.0,multifunction=on \ -device vfio-pci,host=01:00.1 \ -drive file=/dev/mapper/sdb1_crypt,cache=none,id=hdd,format=raw,if=none -device scsi-hd,drive=hdd \ -drive file=/home/peetipablo/VMs/virtio-win-0.1.96.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -device virtio-net,netdev=net0,mac=DE:AD:BE:EF:EB:B7 -netdev tap,ifname=tap0,id=net0 \ -soundhw hda \ -vga none #Restore screen xrandr --output HDMI1 --off xrandr --output DP1 --primary --mode 1920x1080 --rate 144 --left-of HDMI3 xrandr --output HDMI3 --auto --right-of DP1 #Stop synergy client systemctl stop synergyc@peetipablo</code></pre></div><p><span class="postimg"><img src="http://i.imgur.com/oRMFMae.jpg" alt="oRMFMae.jpg" /></span></p> <p class="postedit"><em>Last edited by Peetipablo (2015-07-12 21:29:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544109">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=222">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <strong>223</strong> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=224">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
