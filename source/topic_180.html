<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 180) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=180" title="Page 180" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=179" title="Page 179" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=181" title="Page 181" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=179">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=178">178</a> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <strong>180</strong> <a href="viewtopic.php?id=162768&amp;p=181">181</a> <a href="viewtopic.php?id=162768&amp;p=182">182</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=181">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1511481" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4476</span> <a href="viewtopic.php?pid=1511481#p1511481">2015-03-15 19:48:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have windows 8.1 working under kvm using bios. I had passed R9 270 and it is working fine. I was able to pass my video card using ovfm and I can install win 8.1 bu it freezes on first boot. Does anyone know any work around ?<br />I have ati 6540 that i am trying to pass to second guest and the sound portion is not in the same group as video. I have compiled custom kernel with acs overwrite. How I can force my audio part to be in same group with video?<br />I am geting this /sys/bus/pci/devices/000:02:00.1/vendor: No such file or device for my hdmi portion of video card both are in group 15 I am using script and servie to bind devices<br />Rebidding solved the issue I wonder why it does not work at boot.</p><p>I can use ovmf with default chipset no q35</p> <p class="postedit"><em>Last edited by tritron4 (2015-03-15 21:22:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511481">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511512" class="blockpost roweven"> <h2><span><span class="conr">#4477</span> <a href="viewtopic.php?pid=1511512#p1511512">2015-03-15 21:43:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p>There&#039;s one small hiccup in step 5: as soon as the pass-through GPU&#039;s driver was installed and the guest was rebooted, the QXL display stopped working (exclamation mark in device manager, code 43). However, at that point the passthrough display worked fine, so I didn&#039;t bother trying to figure out why I could not have *dual* display. I was satisfied with the one passthrough display. IOW, step 5 became mandatory / automatic, effectively.</p></div></blockquote></div><p>I guess some conflict arises. Like, interrupts or memory ranges. You know better. As i said, we can ditch that temporary stuff later.</p><p>I guess, if QXL now(btw since which version or date?) works with int 10h, we don&#039;t even need to install drivers for it, just do the setup and install GPU&#039;s drivers.<br />We need to install QXL&#039;s drivers only to get rid of that int 10h wizardry. That&#039;s the right way, but we don&#039;t always need it.</p><p>Is there any way to make QEMU &quot;emulate&quot; or make work int 10h for the physical GPU <span class="bbu">temporarily</span>? Something hints me that won&#039;t work for some reason..<br />Like, we have &quot;-win2k-hack&#160; &#160; &#160;use it when installing Windows 2000 to avoid a disk full bug&quot;, maybe there&#039;s possibility to make a similar switch -srv2k8uefi-hack or something?</p><p>P.S.<br />Hail something, as it always hints me stuff.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-15 21:54:20)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511512">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511515" class="blockpost rowodd"> <h2><span><span class="conr">#4478</span> <a href="viewtopic.php?pid=1511515#p1511515">2015-03-15 21:52:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I have windows 8.1 working under kvm using bios. I had passed R9 270 and it is working fine. I was able to pass my video card using ovfm and I can install win 8.1 bu it freezes on first boot. Does anyone know any work around ?<br />I have ati 6540 that i am trying to pass to second guest and the sound portion is not in the same group as video. I have compiled custom kernel with acs overwrite. How I can force my audio part to be in same group with video?<br />I am geting this /sys/bus/pci/devices/000:02:00.1/vendor: No such file or device for my hdmi portion of video card both are in group 15 I am using script and servie to bind devices<br />Rebidding solved the issue I wonder why it does not work at boot.</p><p>I can use ovmf with default chipset no q35</p></div></blockquote></div><p>Errr... So your windows8.1 VM with R9 270 works or freezes at the first boot?</p><p>Maybe you have a broken GPU ROM(vbios). Try adding</p><div class="codebox"><pre><code>-debugcon file:debug.log -global isa-debugcon.iobase=0x402</code></pre></div><p>into your qemu startup script and show us the end of debug.log</p><p>Regarding your HD6450 card... I think if there&#039;s no other devices in the same group as it&#039;s HDMI audio device - it will work fine.<br />ACS <span class="bbu">override</span> patch will 100% work without errors only on some selected motherboards, where there is granted that there is device isolation. Provide us motherboard make/model.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-15 22:05:36)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511515">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511553" class="blockpost roweven"> <h2><span><span class="conr">#4479</span> <a href="viewtopic.php?pid=1511553#p1511553">2015-03-16 01:07:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ovmf works fine without q35 chip set. I wonder if I can use same ovmf files for second guest config or do I need setup custom location ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511553">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511561" class="blockpost rowodd"> <h2><span><span class="conr">#4480</span> <a href="viewtopic.php?pid=1511561#p1511561">2015-03-16 02:23:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I have windows 8.1 working under kvm using bios. I had passed R9 270 and it is working fine. I was able to pass my video card using ovfm and I can install win 8.1 bu it freezes on first boot. Does anyone know any work around ?<br />I have ati 6540 that i am trying to pass to second guest and the sound portion is not in the same group as video. I have compiled custom kernel with acs overwrite. How I can force my audio part to be in same group with video?<br />I am geting this /sys/bus/pci/devices/000:02:00.1/vendor: No such file or device for my hdmi portion of video card both are in group 15 I am using script and servie to bind devices<br />Rebidding solved the issue I wonder why it does not work at boot.</p><p>I can use ovmf with default chipset no q35</p></div></blockquote></div><p>Errr... So your windows8.1 VM with R9 270 works or freezes at the first boot?</p><p>Maybe you have a broken GPU ROM(vbios). Try adding</p><div class="codebox"><pre><code>-debugcon file:debug.log -global isa-debugcon.iobase=0x402</code></pre></div><p>into your qemu startup script and show us the end of debug.log</p><p>Regarding your HD6450 card... I think if there&#039;s no other devices in the same group as it&#039;s HDMI audio device - it will work fine.<br />ACS <span class="bbu">override</span> patch will 100% work without errors only on some selected motherboards, where there is granted that there is device isolation. Provide us motherboard make/model.</p></div></blockquote></div><p>I have to rebind both pci addresses for it to work. I have assus A88X pro I am using&#160; scripts from first page</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511561">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511585" class="blockpost roweven"> <h2><span><span class="conr">#4481</span> <a href="viewtopic.php?pid=1511585#p1511585">2015-03-16 09:23:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I guess, if QXL now(btw since which version or date?)</p></div></blockquote></div><p><a href="https://github.com/tianocore/edk2/commit/90803342" rel="nofollow">https://github.com/tianocore/edk2/commit/90803342</a></p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p> works with int 10h, we don&#039;t even need to install drivers for it, just do the setup and install GPU&#039;s drivers.</p></div></blockquote></div><p>Yes, that seems to make sense.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>We need to install QXL&#039;s drivers only to get rid of that int 10h wizardry. That&#039;s the right way, but we don&#039;t always need it.</p></div></blockquote></div><p>Well, the genuine QXL drivers (ie. those that are independent of Int10h) are necessary because they allow the user to take advantage of QXL&#039;s actual capabilities. The Int10h shim that OVMF installs is just a minimal service that isn&#039;t supposed to do anything beyond getting the user through the guest installation. After that you&#039;ll probably want something more than just 1 resolution, 1024x768x32. Normally that &quot;more&quot; means the QXL XDDM driver, but in this case, the passthru GPU and its drivers are just as fine, for &quot;more&quot;.</p><p>IOW, the Int10h shim is not &quot;harmful&quot; in any way, for which reason you&#039;d want to get rid of it; it simply has minimal functionality (== fill the gap for as long as the Win2k8r2 guest is being installed, and first booted).</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Is there any way to make QEMU &quot;emulate&quot; or make work int 10h for the physical GPU <span class="bbu">temporarily</span>?</p></div></blockquote></div><p>No. First, the Int10h shim is not provided by QEMU, it is provided by OVMF. Second, as you can read in the whitepaper and in the commit message I linked above, it is a <em>valid</em> implementation of a very small set of VBE services, as far as it comes to the underlying video card (ie. QXL). See the subroutine-like labels under the &quot;Handler:&quot; label in the source. Importantly, the code under &quot;SetMode:&quot; and &quot;KnownMode2:&quot; actually implement a graphics mode switch on the QXL card.</p><p>(The reason for providing the Int10h shim only on stdvga and QXL is exactly because they are simple (and identical, on this level) to program. And of those two -- I&#039;ll digress a bit --, we recommend QXL over stdvga only because QXL has full-featured guest drivers. But, if you&#039;re going to install the passthru GPU driver anyway, and not install the QXL guest driver, then you can just as well use </p><div class="codebox"><pre><code>-device VGA</code></pre></div><p> (ie. stdvga) with the Int10h shim.)</p><p>Back to your question: in order to provide an Int10h shim for any other card than stdvga &amp; QXL, that shim whould have to program that card for real.</p><p>So, just to reiterate: the fake thing about the Int10h shim is not the video card programming; that&#039;s real. The fake thing is that</p><ul><li><p>it provides just a minimal set of services, just enough for the win7 family installation to succeed, and</p></li><li><p>said VBE services and related descriptor structures are not placed in the C segment, and similarly the Int10h vector is not pointed to the handler in the C segment, by way of <em>posting</em> an actual legacy PCI oprom (which the CSM would do). Instead, they are put into place by OVMF just because we figured out that the legacy vga driver of win2k8r2 will look for them there <em>as data</em>, and it will <em>emulate</em> the VBE code (ie. not directly execute it on the CPU) in an internal real-mode (16-bit) emulator.</p></li></ul><p>So, the &quot;external interface&quot; of the shim is fake (because it doesn&#039;t have to work in any other environment than with win2k8r2&#039;s real-mode emulator), but its internal (hardware facing) code is valid (because hardware accesses like ioport writes encountered in the internal emulator are replayed for real), and those would have to be implemented for any other card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511585">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511586" class="blockpost rowodd"> <h2><span><span class="conr">#4482</span> <a href="viewtopic.php?pid=1511586#p1511586">2015-03-16 09:35:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I wonder if I can use same ovmf files for second guest config or do I need setup custom location ?</p></div></blockquote></div><p>The OVMF_CODE.fd file is mapped read-only and it is supposed to be shared by all guests. This allows central (host-wide) firmware binary upgrades that affect all guests at once, similarly to SeaBIOS upgrades.</p><p>The OVMF_VARS.fd file is not mapped by any guest; it is a varstore <em>template</em>. Whenever you create a new guest, it must start out with a private copy of this pristine (empty) varstore template. Then the guest will keep its non-volatile UEFI variables in this private variable store. That&#039;s why varstore files are VM-private.</p><p>When you use libvirt, libvirtd takes care of instantiating a private varstore from OVMF_VARS.fd for each new VM you create. (Look under /var/lib/libvirt/qemu/nvram.) In fact libvirt can accommodate several use cases (the domain XML is really flexible), but this is the main use case that virt-manager and virt-install generate a domain XML for.</p><p>However, if you use the qemu command line manually, you must copy OVMF_VARS.fd first, and pass the <em>copy</em> to the VM as the second pflash chip. See here (I fixed the wiki yesterday):</p><p><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#Test" rel="nofollow">https://wiki.archlinux.org/index.php/PC … _OVMF#Test</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511586">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511595" class="blockpost roweven"> <h2><span><span class="conr">#4483</span> <a href="viewtopic.php?pid=1511595#p1511595">2015-03-16 10:43:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So , GT610 reboot issue remains . It happens after hours though , meaning if I rebooted the VM when the host is freshly booted it reboots fine . Checking dmesg , the only thing that happens after hours of host being up are these type of messages :</p><div class="codebox"><pre><code>perf samples too long (2502 &gt; 2500), lowering kernel.perf_event_max_sample_rate to 50100</code></pre></div><p>Using :</p><div class="codebox"><pre><code>echo 0 &gt; /proc/sys/kernel/perf_cpu_time_max_percent</code></pre></div><p>as soon as the host boots up disables that mechanism , and the GT610&#039;s VM is now rebooting fine after 10 hours of operation .</p><p>I don&#039;t know why they are related though .</p><p>Edit : Correcting the time periods . lol</p> <p class="postedit"><em>Last edited by Denso (2015-03-16 11:10:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511595">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511633" class="blockpost rowodd"> <h2><span><span class="conr">#4484</span> <a href="viewtopic.php?pid=1511633#p1511633">2015-03-16 14:08:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I wonder if I can use same ovmf files for second guest config or do I need setup custom location ?</p></div></blockquote></div><p>The OVMF_CODE.fd file is mapped read-only and it is supposed to be shared by all guests. This allows central (host-wide) firmware binary upgrades that affect all guests at once, similarly to SeaBIOS upgrades.</p><p>The OVMF_VARS.fd file is not mapped by any guest; it is a varstore <em>template</em>. Whenever you create a new guest, it must start out with a private copy of this pristine (empty) varstore template. Then the guest will keep its non-volatile UEFI variables in this private variable store. That&#039;s why varstore files are VM-private.</p><p>When you use libvirt, libvirtd takes care of instantiating a private varstore from OVMF_VARS.fd for each new VM you create. (Look under /var/lib/libvirt/qemu/nvram.) In fact libvirt can accommodate several use cases (the domain XML is really flexible), but this is the main use case that virt-manager and virt-install generate a domain XML for.</p><p>However, if you use the qemu command line manually, you must copy OVMF_VARS.fd first, and pass the <em>copy</em> to the VM as the second pflash chip. See here (I fixed the wiki yesterday):</p><p><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#Test" rel="nofollow">https://wiki.archlinux.org/index.php/PC … _OVMF#Test</a></p></div></blockquote></div><p>I created new folders for OVMF_VARS.fd. I wonder if there is a version of virt manager that will allow me to turnoff vga ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511633">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511651" class="blockpost roweven"> <h2><span><span class="conr">#4485</span> <a href="viewtopic.php?pid=1511651#p1511651">2015-03-16 15:19:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I wonder if there is a version of virt manager that will allow me to turnoff vga ?</p></div></blockquote></div><p>virt-manager does not provide access to low-level knobs, on purpose. (Unless of course I&#039;m misunderstanding you. If you simply mean &quot;removing the VGA device from the VM config&quot;, that&#039;s certainly doable, but I don&#039;t think you would ask about that, because it&#039;s obvious.) So virt-install / virt-manager should be used to install an OVMF-based guest the easy way (covering even the PCI and USB device assignments), then you can shut down the guest, and use &quot;virsh edit&quot; to customize the finer bits for GPU passthrough (vcpu pinning, cpuid massaging etc).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511651">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511666" class="blockpost rowodd"> <h2><span><span class="conr">#4486</span> <a href="viewtopic.php?pid=1511666#p1511666">2015-03-16 16:19:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I had compiled virt-manger git aur and installed it but it cant find uefi ? Does anyone know the location and name of files virt-manager is looking.<br />Well I edited /etc/libvirt/qemu.conf end enabled nvram</p> <p class="postedit"><em>Last edited by tritron4 (2015-03-16 16:29:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511666">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511670" class="blockpost roweven"> <h2><span><span class="conr">#4487</span> <a href="viewtopic.php?pid=1511670#p1511670">2015-03-16 16:33:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I had compiled virt-manger git aur and installed it but it cant find uefi ? Does anyone know the location and name of files virt-manager is looking.<br />Well I edited /etc/libvirt/qemu.conf end enabled nvram</p></div></blockquote></div><p>Assuming you are using recent enough libvirtd and virt-manager / virt-install, see &quot;Installation of OVMF guests with virt-manager and virt-install&quot; in <a href="http://people.redhat.com/~lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">http://people.redhat.com/~lersek/ovmf-w … 770f8c.txt</a> , especially point (5) there.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511670">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511676" class="blockpost rowodd"> <h2><span><span class="conr">#4488</span> <a href="viewtopic.php?pid=1511676#p1511676">2015-03-16 16:52:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53503">VOT Productions</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-22</span></dd> <dd><span>Posts: 47</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:votproductions@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, I am confused, and I&#039;m not sure where I went wrong.</p><p>My system setup: <br />GPU #1: AMD Radeon HD 7750 (VM)<br />GPU #2: Terrible Intel Graphics (Host)<br />CPU: Intel i5 4460 <br />Motherboard: Asus H81M-C</p><p>As you can see, my setup isn&#039;t the most complicated in the world, yet it confused me much frustation. I managed to get pci-stub and vfio-bind working, however I am having massive issues with running QEMU.</p><p>My first question is, should I be running Intel as bootup graphics in the BIOS? Or, should it be AMD that boots first?<br />Secondly, on both occasions in QEMU my GPU fan spins up, but this yields two different results. When running with AMD as boot-up, I have a lot of issues, such as not being to access X without nomodeset and doing all kinds of hacks to get in (no acceleration either), and while it does display an image with QEMU, it is artifacted and crashes when I mount an ISO or access any of the TTYs. When I use Intel as boot-up, I can actually get 3D acceleration, but QEMU shows nothing.</p><p>Thirdly, does this display in a small window, or does it show on a different monitor? On AMD, it seemed to have taken over the screen, however I&#039;ve seen screenshots showing that it should be windowed.</p><p>I am very confused but I&#039;ve almost got it hopefully working <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511676">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511677" class="blockpost roweven"> <h2><span><span class="conr">#4489</span> <a href="viewtopic.php?pid=1511677#p1511677">2015-03-16 17:02:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I had compiled virt-manger git aur and installed it but it cant find uefi ? Does anyone know the location and name of files virt-manager is looking.<br />Well I edited /etc/libvirt/qemu.conf end enabled nvram</p></div></blockquote></div><p>get ovmf-svn from aur</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511677">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511679" class="blockpost rowodd"> <h2><span><span class="conr">#4490</span> <a href="viewtopic.php?pid=1511679#p1511679">2015-03-16 17:04:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>If you are assigning ati video card I would boot intel first there is option in bios to select build in video card as first. This works for me you can setup vga to cirrus to get output in spice </p><div class="codebox"><pre><code>#/bin/sh! QEMU_AUDIO_DRV=alsa \ /usr/bin/qemu-system-x86_64 -enable-kvm -m 8196 -cpu host \ -smp 4,sockets=2,cores=2,threads=1 -vga none -spice port=5910,addr=0.0.0.0,disable-ticketing \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/OVMF_CODE-pure-efi.fd -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/OVMF_VARS-pure-efi.fd \ -device virtio-scsi-pci,id=scsi \ -net nic,model=e1000,macaddr=64:C5:63:4D:A4:44 -net bridge,br=xenbr0 \ -usb -device usb-host,hostbus=9,hostaddr=2 \ -soundhw hda \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -device vfio-pci,host=04:00.0 \ -drive file=/data/kvm/win.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/home/kvm/iso/en_windows_8_1.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/home/kvm/iso/virtio-win-0.1-100.iso,id=isocd2,if=none -device ide-cd,drive=isocd2</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511679">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511680" class="blockpost roweven"> <h2><span><span class="conr">#4491</span> <a href="viewtopic.php?pid=1511680#p1511680">2015-03-16 17:04:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>VOT Productions wrote:</cite><blockquote><div><p>Hello, I am confused, and I&#039;m not sure where I went wrong.</p><p>My system setup: <br />GPU #1: AMD Radeon HD 7750 (VM)<br />GPU #2: Terrible Intel Graphics (Host)<br />CPU: Intel i5 4460 <br />Motherboard: Asus H81M-C</p><p>As you can see, my setup isn&#039;t the most complicated in the world, yet it confused me much frustation. I managed to get pci-stub and vfio-bind working, however I am having massive issues with running QEMU.</p><p>My first question is, should I be running Intel as bootup graphics in the BIOS? Or, should it be AMD that boots first?<br />Secondly, on both occasions in QEMU my GPU fan spins up, but this yields two different results. When running with AMD as boot-up, I have a lot of issues, such as not being to access X without nomodeset and doing all kinds of hacks to get in (no acceleration either), and while it does display an image with QEMU, it is artifacted and crashes when I mount an ISO or access any of the TTYs. When I use Intel as boot-up, I can actually get 3D acceleration, but QEMU shows nothing.</p><p>Thirdly, does this display in a small window, or does it show on a different monitor? On AMD, it seemed to have taken over the screen, however I&#039;ve seen screenshots showing that it should be windowed.</p><p>I am very confused but I&#039;ve almost got it hopefully working <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p></div></blockquote></div><p>Re-read the first post carefully</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511680">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511684" class="blockpost rowodd"> <h2><span><span class="conr">#4492</span> <a href="viewtopic.php?pid=1511684#p1511684">2015-03-16 17:17:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am running into issue where efi-e1000.rom is not found. Ho to tell libvirt proper location ? I have the files in /usr/share/qemu</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511684">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511687" class="blockpost roweven"> <h2><span><span class="conr">#4493</span> <a href="viewtopic.php?pid=1511687#p1511687">2015-03-16 17:29:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53503">VOT Productions</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-22</span></dd> <dd><span>Posts: 47</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:votproductions@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m a knob, I forgot to enable the i915 patch. Also, is there a way of not losing DRI and making it run? (using i440fx instead of OVMF as apparently that doesn&#039;t work with non-UEFI graphic cards)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511689" class="blockpost rowodd"> <h2><span><span class="conr">#4494</span> <a href="viewtopic.php?pid=1511689#p1511689">2015-03-16 17:39:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>VOT Productions wrote:</cite><blockquote><div><p>I&#039;m a knob, I forgot to enable the i915 patch. Also, is there a way of not losing DRI and making it run? (using i440fx instead of OVMF as apparently that doesn&#039;t work with non-UEFI graphic cards)</p></div></blockquote></div><p>Yes, using OVMF, there&#039;s also a post by duelist <a href="https://bbs.archlinux.org/viewtopic.php?pid=1504683#p1504683" rel="nofollow">here</a> on how create an uefi rom for you amd card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511689">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511715" class="blockpost roweven"> <h2><span><span class="conr">#4495</span> <a href="viewtopic.php?pid=1511715#p1511715">2015-03-16 19:30:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p> After that you&#039;ll probably want something more than just 1 resolution, 1024x768x32. Normally that &quot;more&quot; means the QXL XDDM driver, but in this case, the passthru GPU and its drivers are just as fine, for &quot;more&quot;.</p></div></blockquote></div><p>HA! I&#039;ve tried setting up windows 8 on a hardware UEFI platform, and i burst out laughing when..</p><p>1.It boots into 1024x768x32.<br />2.I try to download drivers(or, at least, a browser), starting Internet exploder..<br />3.<strong>And it says &quot;Screen resolution is too small, internet will not be exploded for today&quot;</strong><br />4.No drivers - no resolution change.<br />5.No resolution change - no drivers.</p><p>So you&#039;ve <span class="bbu">got</span> to have some CD with drivers when you try installing windows 8 or some other UEFI-compatible windowns. Or you can&#039;t download drivers.</p><br /><p>BTW, i&#039;ve got my second GPU back, but i have my NTFS partition with a hybrid ROM in it trashed by windows 8 VM(apparently, you have to do shutdown -t 0 -h everytime you want to save your filesystem from trashing).</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511718" class="blockpost rowodd"> <h2><span><span class="conr">#4496</span> <a href="viewtopic.php?pid=1511718#p1511718">2015-03-16 19:32:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have setup windows 8.1 and windows 10 using ovmf libvirt. How I can use virsh to remove emulated vga cards ? How I can get my sound to work with alsa and my windows guest. Both windows guest have functioning emulated sound cards and I can hear sound in Linux.<br />Is there a way to hotswap vga cards between guests ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511718">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511722" class="blockpost roweven"> <h2><span><span class="conr">#4497</span> <a href="viewtopic.php?pid=1511722#p1511722">2015-03-16 19:40:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>Is there a way to hotswap vga cards between guests ?</p></div></blockquote></div><p>There is kind of way.<br />Basically, all you need to do is to <span class="bbu">eject</span> the card from windows. Then it becomes bound to vfio-pci and not used by anyone. And you can attach it to some other VM via various methods, including starting a new VM for example.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511916" class="blockpost rowodd"> <h2><span><span class="conr">#4498</span> <a href="viewtopic.php?pid=1511916#p1511916">2015-03-17 18:24:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53503">VOT Productions</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-22</span></dd> <dd><span>Posts: 47</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:votproductions@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you so much for your help guys <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>I have hopefully the final two questions:<br />1. Windows hangs on &quot;Loading Windows&quot;, any ideas why that might be caused?<br />2. Is there a way of making it on the Intel screen (hopefully windowed), or/and sharing the mouse/keyboard? I don&#039;t really want to plug in two keyboards and mice to operate 2 OS <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Thanks again,<br />VOT.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511916">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511919" class="blockpost roweven"> <h2><span><span class="conr">#4499</span> <a href="viewtopic.php?pid=1511919#p1511919">2015-03-17 18:33:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>You can assign usb receiver for mouse/keyboard to guest or you can assign whole usb controller. I assign whole usb controller to windows 8 guest, with scripts you can return usb controller back to linux. If you want to use guest in windows why not to use spice client ? You can assign usb device to it and you can share mouse keyboard from client.<br />Did anyone install osx on amd cpu under ovmf kv ?</p> <p class="postedit"><em>Last edited by tritron4 (2015-03-17 18:39:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511919">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511920" class="blockpost rowodd"> <h2><span><span class="conr">#4500</span> <a href="viewtopic.php?pid=1511920#p1511920">2015-03-17 18:40:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89614">tholin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve been struggling with VGA passthrough for a few days and finally got something that works but unfortunately not in an optimal way. My plan was to use a radeon juniper card in guest and a radeon cedar card on host. The problem is that the hardware manufacturer for my cpu decided in their wisdom to not support ACS on the pcie root port.<br />Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01]<br />Both graphic card therefore show up in the same iommu group. What options do I have for working around that problem?</p><p>Option 1: Use the ACS override patch and hope for the best.<br />Not a good idea in my opinion. I&#039;m pretty sure the root port do per-to-per without any way of disabling that. Using the override patch is asking for problems.</p><p>Options 2: Rearrange the card to break apart the iommu group.<br />Unfortunately all 16X lanes go to the cpu through that root port. The 1X ports go through the chipset but I don&#039;t have any 1X graphics card. I could buy one but the selection is VERY limited. The only one I found only supports 2 monitors. I could do surgery on the 1X mobo slot or my 16X cedar graphics card to force it in but that not something I want to do.<br /><a href="http://i.imgur.com/NxzaK6L.png" rel="nofollow">http://i.imgur.com/NxzaK6L.png</a> block diagram of my mobo. (Let&#039;s see if I&#039;m allowed to post a link in my first post to this forum)</p><p>Option 3: Buy a new mobo<br />please no...</p><p>Option 4: Use the intel IGP for host graphics and non-legacy guest boot for working around the problems in IGP<br />My juniper card does not support EFI boot. I&#039;ve seen some people do Macgyver style mods involving copy paste in hexeditors with other card&#039;s vbios. That is something I would like to avoid if possible.</p><p>Option 5: Use the intel IGP with the vga arbiter patch<br />That is what I&#039;m using right now for testing but it&#039;s not a longterm solution. It&#039;s too inconvenient to apply a patch at every kernel update.</p><p>Strangely DRI is not disabled for me even with the vga arbiter patch. I assume I screwed up somewhere but I don&#039;t know where. The old patch submitted to the LKML doesn&#039;t apply on new kernels anymore. There is another patch named i915_317.patch that do apply to 3.19.1 with some fuss. I boot with the i915.enable_hd_vgaarb=1 argument and verify that argument is on with dmesg but I still get DRI.</p><div class="codebox"><pre><code># glxinfo |grep render direct rendering: Yes ... OpenGL renderer string: Mesa DRI Intel(R) Haswell Desktop # dmesg |grep vgaarb [ +0.000000] Command line: BOOT_IMAGE=/vmlinuz intel_iommu=on memtest=1 i915.enable_hd_vgaarb=1 pci-stub.ids=1002:68ba,1002:aa58,1002:68f9,1002:aa68 [ +0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz intel_iommu=on memtest=1 i915.enable_hd_vgaarb=1 pci-stub.ids=1002:68ba,1002:aa58,1002:68f9,1002:aa68 [ +0.000131] vgaarb: setting as boot device: PCI:0000:00:02.0 [ +0.000045] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none [ +0.000051] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=none,locks=none [ +0.000050] vgaarb: device added: PCI:0000:04:00.0,decodes=io+mem,owns=none,locks=none [ +0.000048] vgaarb: loaded [ +0.000040] vgaarb: bridge control possible 0000:04:00.0 [ +0.000044] vgaarb: bridge control possible 0000:03:00.0 [ +0.000043] vgaarb: no bridge control possible 0000:00:02.0 [ +0.073126] [drm:i915_disable_vga_mem] *ERROR* enable_hd_vgaarb is on at i915_disable_vga_mem [ +0.000002] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io+mem</code></pre></div><p>The error is a DRM_ERROR() call I added in i915_disable_vga_mem() just to make sure the patch loaded.</p><p>The forwarding appears to work. I can run the unigine benchmarks with good speed and I don&#039;t notice any other problems on the host.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511920">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=179">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=178">178</a> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <strong>180</strong> <a href="viewtopic.php?id=162768&amp;p=181">181</a> <a href="viewtopic.php?id=162768&amp;p=182">182</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=181">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
