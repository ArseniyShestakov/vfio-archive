<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 123) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=123" title="Page 123" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=122" title="Page 122" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=124" title="Page 124" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=122">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <strong>123</strong> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <a href="viewtopic.php?id=162768&amp;p=125">125</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=124">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1469173" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3051</span> <a href="viewtopic.php?pid=1469173#p1469173">2014-10-24 18:31:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>When you&#039;re trying OVMF, please make sure you&#039;re using the pure-EFI binary and not one that mentions the CSM.&#160; We explicitly do not want the CSM, which can run the VGA BIOS and brings back all the issues with VGA arbitration.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469173">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469242" class="blockpost roweven"> <h2><span><span class="conr">#3052</span> <a href="viewtopic.php?pid=1469242#p1469242">2014-10-24 21:14:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Suddenly, i can not boot OVMF&#039;s built-in shell or start Windows8.1 installation CD in UEFI mode. There is just blank screen and a cursor on serial0, and nothing on any VGA or video output. I need OVMF to avoid IO_PAGE_FAULTS referring to my first GPU. The windows ISO checked to be correct and it does boot on real hardware.</p></div></blockquote></div><p>I think I&#039;m hitting the same bug as you. I&#039;ve tried some combinations of qemu/ovmf versions and qemu options but still got blank screen whenever OVMF touches the EFI part of the vbios (vga works as I mentioned before). So what&#039;s left? I compared EfiRom output:</p><div class="codebox"><pre><code>Image 2 -- Offset 0x10000 ROM header contents Signature 0xAA55 PCIR offset 0x001C Signature PCIR Vendor ID 0x1002 Device ID 0x683F Length 0x0018 Revision 0x0000 DeviceListOffset 0x00 Class Code 0x030000 Image size 0xEE00 Code revision: 0x0000 MaxRuntimeImageLength 0x00 ConfigUtilityCodeHeaderOffset 0x4F47 DMTFCLPEntryPointOffset 0x2050 Indicator 0x80 (last image) Code type 0x03 (EFI image) EFI ROM header contents EFI Signature 0x0EF1 Compression Type 0x0001 (compressed) Machine type 0x8664 (unknown) Subsystem 0x000B (EFI boot service driver) EFI image offset 0x005C (@0x1005C)</code></pre></div><p>with some vbioses from TechPowerUp. The result: there are no striking differences. The only lines that change between different vbioses: Device ID (obviously), Image Size, EFI image offset, and Image offset (the first line). I&#039;m no expert, but judging from this I belive my vbios isn&#039;t broken. I can only assume it&#039;s a bug in OVMF. I&#039;ve noticed aw&#039;s GT635 has &quot;Image 2 -- Offset 0xF400&quot; while my rom&#039;s &quot;Image 2 -- Offset 0x10000&quot; Could that additional digit make a difference for OVMF? In any case, 0x10000 isn&#039;t rare. Many R290 use the same offset.</p><p>P.S. Yes, I&#039;m using pure-efi.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469242">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469255" class="blockpost rowodd"> <h2><span><span class="conr">#3053</span> <a href="viewtopic.php?pid=1469255#p1469255">2014-10-24 21:58:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Another sad fact of EFI is that vendors ship broken ROMs.&#160; The XFX R7790 is one such card.&#160; I thought I was lucky finding an EFI ROM on a 7700-series card, but it doesn&#039;t work.&#160; If I install it as the primary graphics in my system and configure the BIOS to prefer the EFI BIOS, the system won&#039;t boot.&#160; It behaves the same way in an OVMF VM.&#160; I&#039;ve contacted XFX support but they seem unable to do anything other than repackage a ROM provided by AMD and indicate that AMD has not provided EFI support for this card.&#160; They seem unable to comprehend that they&#039;ve shipped a card that not only doesn&#039;t support EFI, but in fact prevents using it since executing the EFI ROM seems to be the cause of the hang.&#160; It would be interesting to trace the execution in the emulator and see where it breaks, maybe it could be patched.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469255">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469264" class="blockpost roweven"> <h2><span><span class="conr">#3054</span> <a href="viewtopic.php?pid=1469264#p1469264">2014-10-24 22:39:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85506">gyrfalco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-30</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hello, guys.</p><p>My spec: AMD A10-6700 with integrated Radeon HD 8670D (host GPU) + Radeon HD 7870 (GV-R787OC-2GD - guest GPU).</p><p>I have problems with Catalyst driver (13.*, 14.4, 14.7, 14.8, 14.9) install: system (win 8.1) crashes during driver installation, with or without CCC + display driver installation, or just updading default win display driver in device manager.&#160; </p><p>I tried both seabios and OVMF with same result.</p><p>qemu-2.1.50, kernel 3.17.1:</p><div class="codebox"><pre><code>iommu=pt pci-stub.ids=1002:6818,1002:aab0</code></pre></div><p>Machine starts as:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 4096 -cpu host,hv_time,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 -vga none -boot menu=on -rtc base=localtime \ -device vfio-pci,host=01:00.0,multifunction=on \ -drive file=windows.img,id=disk,format=raw,if=none -device ide-hd,bus=ide.0,drive=disk \ -drive if=pflash,format=raw,readonly,file=/usr/share/qemu/efi-bios.bin</code></pre></div><p>Is it possible (actually only drivers installation, because without driver VM runs smooth and fine, through second monitor) when host gpu is integrated Radeon and guest gpu is 7870?</p><p>Thanks, sorry for my English.</p> <p class="postedit"><em>Last edited by gyrfalco (2014-10-26 11:28:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469264">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469343" class="blockpost rowodd"> <h2><span><span class="conr">#3055</span> <a href="viewtopic.php?pid=1469343#p1469343">2014-10-25 06:36:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78023">doubledr</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-26</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>doubledr wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.&#160; However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Hi, aw.</p><p>I tried it today. Passing a real(not modded) Nvidia Grid k2 results in code 12 in my windows 2008 vm... Same as a Quadro 400... Look&#039;s like &quot;x-vga&quot; is a must...</p></div></blockquote></div><p>Use 440FX not Q35</p><div class="quotebox"><blockquote><div><p>l have some difficulty with libvirt. No matter what I did, if I start my vm with libvirt, I always get the &quot;Cannot allocate memory&quot; error. &quot;ulimit -l unlimited&quot; doesn&#039;t help at all... Is anyone have similar issue? Now I can only start my vm manually with a long qemu command <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>If libvirt doesn&#039;t know you&#039;re doing device assignment it won&#039;t set your limits correctly.&#160; If you use 440FX instead of Q35 you don&#039;t need any qemu:commandline sections and should be allowing libvirt to manage everything.</p></div></blockquote></div><p>Thx, aw. It works!</p><p>I found that my libvirt used cgroup to control memory limit, maybe that is the reason why ulimit command doesn&#039;t work.</p><div class="codebox"><pre><code>Nov 24 20:19:42 cave-lin kernel: [ 368.001538] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Nov 24 20:19:42 cave-lin kernel: [ 368.001719] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Nov 24 20:20:20 cave-lin kernel: [ 405.590323] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469343">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469358" class="blockpost roweven"> <h2><span><span class="conr">#3056</span> <a href="viewtopic.php?pid=1469358#p1469358">2014-10-25 08:25:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Another sad fact of EFI is that vendors ship broken ROMs.</p></div></blockquote></div><p>That&#039;s sad indeed. How can they screw such an easy-to-test feature? At least vgaarb patches still work.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It would be interesting to trace the execution in the emulator and see where it breaks, maybe it could be patched.</p></div></blockquote></div><p>Wish I could help, but it&#039;s beyond me. Please inform us if you manage to get any HD77xx card work in EFI mode.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469358">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469386" class="blockpost rowodd"> <h2><span><span class="conr">#3057</span> <a href="viewtopic.php?pid=1469386#p1469386">2014-10-25 09:59:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>First of all: my hard disk exploded (it was a bit old), so ATM I&#039;m unable to proceed with further tests. However I managed to do a last test before it broke.</p><br /><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>One way to at least reduce that is to use hardware en- and decoding. To enable hardware encoding you need to install Geforce experience, click on the &quot;shadow play&quot; button in its GUI and flip the left-positioned virtual switch that they show in the new popup windows: Turn it on once, then off again. After that you will need to access the Inhome-Streaming options in Steam&#039;s settings (on the client), open up the advanced host settings, and enable hardware encoding (You might also want to set the same option on the VM&#039;s steam installation for good measure, but it shouldn&#039;t be necessary).</p><p>You might also try to set the client options to &quot;fast&quot; and set the bandwidth limit in the advanced client options to automatic (should it not already be set to it).</p></div></blockquote></div><p>I will try those settings after buying a new hard disk.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>I&#039;ve found that even with hardware en- and decoding I could still detect a slight difference between host and guest while inside an FPS, because the camera didn&#039;t rotate completely smoothly on the guest. Just enough that it would get me killed in multiplayer. The only way I could rid of any noticeable latency when Inhome-streaming through an emulated VirtIO network card was to limit the bandwith manually to 3Mbit, at which 1080p looks like someone threw several buckets full of different-coloured paint at my screen from the inside (and 720p is unacceptable to me).</p></div></blockquote></div><p>Really not a good deal.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>I do not own one, but I&#039;m going to try that out when I have enough time to make an informed decision about picking one.</p></div></blockquote></div><p>Informed decision:<br />- go on an e-commerce website<br />- click &quot;networking&quot; section<br />- click &quot;pci ethernet&quot; section<br />- sort items by &quot;ascending price&quot;<br />- close you eyes an choose one card<br />I really don&#039;t know if there is one card better than others.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>It should. Just to be sure: You are able to stream regardless of whether your VM gets an emulated card or not (so both &quot;-vga none&quot; and &quot;-vga std&quot; work)?</p></div></blockquote></div><p>Last test done: yes, I can stream regardless of &quot;-vga std&quot; or &quot;-vga none&quot; is passed to qemu.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469386">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469416" class="blockpost roweven"> <h2><span><span class="conr">#3058</span> <a href="viewtopic.php?pid=1469416#p1469416">2014-10-25 11:50:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Please, mark if you manage to get that cards doing something more useful than powering down when passing the ROM via romfile=.</p></div></blockquote></div><p>Well, I can confirm that this rom works in vga mode. I used it to load my standard Win7 VM. <br />EFI, on the other hand, is a pain. First I tried to install Win8.1 just with QXL, but OVMF can&#039;t load the installation DVD (no drivers for the UDF filesystem?). I copied the DVD to a fat32 partition and managed to get the loader running, but it still fails quite soon with &quot;can&#039;t find the media&quot; error (maybe the installation process looks for UDF and dies because there is fat32?). Anyway, just to test EFI vbios I tried connecting the GPU annnnnd... nothing. I get a black screen and 100% one core utilisation, can&#039;t see OVMF, can&#039;t get to Windows installer.</p><p>P.S. I noticed in gpuz that this new bios (ver 015.032) bumps the default core clock to 900MHz while the original bios (ver 015.014) sets default to 820MHz.</p></div></blockquote></div><p>Try installing windows 8.1 via USB flash drive. There was an official way of doing this. That should solve all controller-related issues, however, i&#039;ve managed to install windows8 from virtio-scsi-pci scsi-cd to virtio-blk-pci using the virtio.iso image connected through ide-cd..<br />And the clock difference - that&#039;s why i warned you - my cards have 800MHz and they&#039;re pretty hot, so getting them work any faster would be dangerous.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>We explicitly do not want the CSM</p></div></blockquote></div><p>That&#039;s an interesting remark.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If I install it as the primary graphics in my system and configure the BIOS to prefer the EFI BIOS, the system won&#039;t boot.</p></div></blockquote></div><p>Well, i&#039;m going to visit my friend with ASUS-AMD-Windows system somewhere near wednesday and hopefully, i&#039;ll provide some testing information from the real hardware combination.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> They seem unable to comprehend that they&#039;ve shipped a card that not only doesn&#039;t support EFI, but in fact prevents using it since executing the EFI ROM seems to be the cause of the hang.&#160; It would be interesting to trace the execution in the emulator and see where it breaks, maybe it could be patched.</p></div></blockquote></div><p>Well, after i get some testing information, if the VBIOS is really broken - that would be extremely fun. ASUS support seem to actually understand what the hell i am trying to ask them - last time i&#039;ve asked if it&#039;s possible to combine three HD7750 with Richland or Trinity-based CPU(not APU) on one of their motherboards, and suddenly, i&#039;ve got an answer. </p><p>And i&#039;ve finally managed to boot windows7(not 8!) installation ISO from OVMF. Let&#039;s see what will happen.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-25 12:14:58)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469416">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469513" class="blockpost rowodd"> <h2><span><span class="conr">#3059</span> <a href="viewtopic.php?pid=1469513#p1469513">2014-10-25 17:02:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85506">gyrfalco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-30</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And i&#039;ve finally managed to boot windows7(not 8!) installation ISO from OVMF.</p></div></blockquote></div><p>can you explain how? thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469513">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469589" class="blockpost roweven"> <h2><span><span class="conr">#3060</span> <a href="viewtopic.php?pid=1469589#p1469589">2014-10-25 21:25:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I decided to reinstall my whole PC, this time in UEFI mode instead of the old BIOS.<br />Got everything up and running and was following this tutorial again but ran into some problems (again...).</p><p>This time i&#039;m stuck at the following (again...):</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I&#039;m 100% sure I binded the devices, by both using systemd at boot, and manually running <em>vfio-bind 0000:02:00.0 0000:02:00.1</em>.<br />I get no errors so I just assume it works, but it clearly doesn&#039;t...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469592" class="blockpost rowodd"> <h2><span><span class="conr">#3061</span> <a href="viewtopic.php?pid=1469592#p1469592">2014-10-25 21:27:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>So I decided to reinstall my whole PC, this time in UEFI mode instead of the old BIOS.<br />Got everything up and running and was following this tutorial again but ran into some problems (again...).</p><p>This time i&#039;m stuck at the following (again...):</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I&#039;m 100% sure I binded the devices, by both using systemd at boot, and manually running <em>vfio-bind 0000:02:00.0 0000:02:00.1</em>.<br />I get no errors so I just assume it works, but it clearly doesn&#039;t...</p></div></blockquote></div><p>Intel_iommu=on boot option</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469592">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469597" class="blockpost roweven"> <h2><span><span class="conr">#3062</span> <a href="viewtopic.php?pid=1469597#p1469597">2014-10-25 21:45:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>So I decided to reinstall my whole PC, this time in UEFI mode instead of the old BIOS.<br />Got everything up and running and was following this tutorial again but ran into some problems (again...).</p><p>This time i&#039;m stuck at the following (again...):</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I&#039;m 100% sure I binded the devices, by both using systemd at boot, and manually running <em>vfio-bind 0000:02:00.0 0000:02:00.1</em>.<br />I get no errors so I just assume it works, but it clearly doesn&#039;t...</p></div></blockquote></div><p>Intel_iommu=on boot option</p></div></blockquote></div><p>Aah, knew I forgot something, thanks!</p><p>Now i&#039;m back to the initial problem: qemu only giving me a console, unless I remove the <em>-vga none</em> option.<br />I&#039;ve read that several others have this problem too, but I haven&#039;t found a solution yet.</p> <p class="postedit"><em>Last edited by PureTryOut (2014-10-25 21:48:45)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469597">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469656" class="blockpost rowodd"> <h2><span><span class="conr">#3063</span> <a href="viewtopic.php?pid=1469656#p1469656">2014-10-26 03:27:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Please, mark if you manage to get that cards doing something more useful than powering down when passing the ROM via romfile=.</p></div></blockquote></div><p>Well, I can confirm that this rom works in vga mode. I used it to load my standard Win7 VM. <br />EFI, on the other hand, is a pain. First I tried to install Win8.1 just with QXL, but OVMF can&#039;t load the installation DVD (no drivers for the UDF filesystem?). I copied the DVD to a fat32 partition and managed to get the loader running, but it still fails quite soon with &quot;can&#039;t find the media&quot; error (maybe the installation process looks for UDF and dies because there is fat32?). Anyway, just to test EFI vbios I tried connecting the GPU annnnnd... nothing. I get a black screen and 100% one core utilisation, can&#039;t see OVMF, can&#039;t get to Windows installer.</p><p>P.S. I noticed in gpuz that this new bios (ver 015.032) bumps the default core clock to 900MHz while the original bios (ver 015.014) sets default to 820MHz.</p></div></blockquote></div><p>Make sure you&#039;re not using ovmf from repo, it&#039;s useless.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469656">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469673" class="blockpost roweven"> <h2><span><span class="conr">#3064</span> <a href="viewtopic.php?pid=1469673#p1469673">2014-10-26 06:50:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>which ovmf are you using?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469673">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469722" class="blockpost rowodd"> <h2><span><span class="conr">#3065</span> <a href="viewtopic.php?pid=1469722#p1469722">2014-10-26 11:09:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77255">dave558</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-28</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:sophal.lee@live.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi</p><p>I&#039;ve just compiled a kernel (3.10) with vfio support (CONFIG_VFIO_PCI_VGA=y). </p><p>I have installed qemu-kvm through yum but it appears that this RPM has not been compiled for VFIO. When trying assign the graphic card to guests there is no option to assign device to vfio-pci.</p><p>I have read also that qemu 2.0+ supports VFIO and I am thinking of compiling qemu from the QEMU website. Although Qemu can run as a stand-alone emulator, I am assumming it will use the kernel-module automatically if available. Is this the case?</p><p>Also will there be any difference in performance between qemu compiled from source and qemu-kvm? Or is there anything else you can recommend? Thank yoo.</p><p>NOTE: This is a CentOS system, that is why I have installed the default RPM install qemu-kvm rather than QEMU.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469757" class="blockpost roweven"> <h2><span><span class="conr">#3066</span> <a href="viewtopic.php?pid=1469757#p1469757">2014-10-26 13:55:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>which ovmf are you using?</p></div></blockquote></div><p>ovmf-svn from AUR.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469757">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469785" class="blockpost rowodd"> <h2><span><span class="conr">#3067</span> <a href="viewtopic.php?pid=1469785#p1469785">2014-10-26 15:35:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kristopher004 wrote:</cite><blockquote><div><p> Updated from 3.16 to&#160; 3.17.1-1 and now the vm skips. When I move the mouse or drag a window the mouse or window will freeze for a sec every few seconds. This happen to anyone else when they went to kernel 3.17?</p></div></blockquote></div><p>My problem ended up being that I recompiled 3.17 and didn&#039;t recompile my nvidia driver, if anyone else has a similar problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469785">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469825" class="blockpost roweven"> <h2><span><span class="conr">#3068</span> <a href="viewtopic.php?pid=1469825#p1469825">2014-10-26 17:25:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gyrfalco wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And i&#039;ve finally managed to boot windows7(not 8!) installation ISO from OVMF.</p></div></blockquote></div><p>can you explain how? thanks.</p></div></blockquote></div><p>Actually windows 7 supports GPT and UEFI natibely, you just have to force it.<br /><a href="http://technet.microsoft.com/en-gb/library/cc749064%28v=ws.10%29.aspx" rel="nofollow">http://technet.microsoft.com/en-gb/libr … 10%29.aspx</a><br />You can use the shell, or you can type exit and navigate yourself through menus.<br />You have to use pure-efi OVMF image.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-26 21:28:18)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469825">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469916" class="blockpost rowodd"> <h2><span><span class="conr">#3069</span> <a href="viewtopic.php?pid=1469916#p1469916">2014-10-27 01:51:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79899">winie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-01</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:alireza4051@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there a way to fix the new nvidia drivers looking for hyper-v parameters? possibly in future releases of qemu or from inside windows?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469916">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469957" class="blockpost roweven"> <h2><span><span class="conr">#3070</span> <a href="viewtopic.php?pid=1469957#p1469957">2014-10-27 07:43:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85506">gyrfalco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-30</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Actually windows 7 supports GPT and UEFI natibely, you just have to force it.<br />...<br />You have to use pure-efi OVMF image.</p></div></blockquote></div><p>Thanks, this <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a> image is pure-efi? If not, can you share link of pure-efi image.</p><p>Also, can you show qemu start command, which you run win7 with ovmf, thanks.</p> <p class="postedit"><em>Last edited by gyrfalco (2014-10-27 08:41:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469983" class="blockpost rowodd"> <h2><span><span class="conr">#3071</span> <a href="viewtopic.php?pid=1469983#p1469983">2014-10-27 10:26:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gyrfalco wrote:</cite><blockquote><div><p>Thanks, this <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a> image is pure-efi? If not, can you share link of pure-efi image.</p></div></blockquote></div><p>Yes, it is.</p><p>EDIT: ovmf qemu args</p><div class="codebox"><pre><code>-drive file=/usr/share/ovmf/x64/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/windows_VARS.fd,if=pflash,format=raw,unit=1</code></pre></div> <p class="postedit"><em>Last edited by dwe11er (2014-10-27 10:33:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469983">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469989" class="blockpost roweven"> <h2><span><span class="conr">#3072</span> <a href="viewtopic.php?pid=1469989#p1469989">2014-10-27 10:53:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>gyrfalco wrote:</cite><blockquote><div><p>Thanks, this <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a> image is pure-efi? If not, can you share link of pure-efi image.</p></div></blockquote></div><p>Yes, it is.</p><p>EDIT: ovmf qemu args</p><div class="codebox"><pre><code>-drive file=/usr/share/ovmf/x64/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/windows_VARS.fd,if=pflash,format=raw,unit=1</code></pre></div></div></blockquote></div><p>Hmm, do you explicitly need that unit=int64 parameter set if using if=pflash? It seem to be working without it, but i can&#039;t test it properly by changing some setting in UEFI setup menu - there is no settings.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469989">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470053" class="blockpost rowodd"> <h2><span><span class="conr">#3073</span> <a href="viewtopic.php?pid=1470053#p1470053">2014-10-27 15:41:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>gyrfalco wrote:</cite><blockquote><div><p>Thanks, this <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a> image is pure-efi? If not, can you share link of pure-efi image.</p></div></blockquote></div><p>Yes, it is.</p><p>EDIT: ovmf qemu args</p><div class="codebox"><pre><code>-drive file=/usr/share/ovmf/x64/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/windows_VARS.fd,if=pflash,format=raw,unit=1</code></pre></div></div></blockquote></div><p>Hmm, do you explicitly need that unit=int64 parameter set if using if=pflash? It seem to be working without it, but i can&#039;t test it properly by changing some setting in UEFI setup menu - there is no settings.</p></div></blockquote></div><p>No idea, probably not. It might be used to order pflash drives (I&#039;m using libvirt).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470053">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470055" class="blockpost roweven"> <h2><span><span class="conr">#3074</span> <a href="viewtopic.php?pid=1470055#p1470055">2014-10-27 15:49:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>winie wrote:</cite><blockquote><div><p>Is there a way to fix the new nvidia drivers looking for hyper-v parameters? possibly in future releases of qemu or from inside windows?</p></div></blockquote></div><p>Are you asking for a solution beyond simply not using hyper-v extensions?&#160; You might want to revert back to an old nvidia driver and test whether it would be worthwhile.&#160; I don&#039;t know of anyone looking a further solutions.&#160; If you need hyper-v extensions, nvidia professional series cards or AMD cards might be a better option.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470279" class="blockpost rowodd"> <h2><span><span class="conr">#3075</span> <a href="viewtopic.php?pid=1470279#p1470279">2014-10-28 09:01:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys, been watching this thread for some time.<br />So I recently have set up a pass through and passed a 5450 to a Windows 7 Guest. This was easy but I had a BSOD issue caused by device reset which I worked round by not passing HDMI audio through. (BSOD 116)<br />From here I then tried to pass a GTX 750 through. Everything went fine, Qemu starts and gives me the warning &quot;Bar 3 mmap unsupported&quot; and the card is not outputting anything. I boot Qemu a second time without -vga none to see if I can find a problem and find the device is passed through, it is and I get the latest stable nvidia drivers installed to see if that fixes anything. The card is currently throwing code 12 in windows.</p><p>From what I found over the last few hours, I will check PCI-stub binding to the device tomorrow. Also thinking about trying pci-assign to see if it works.</p><p>The code I am using is;</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 12288 -cpu host \ -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=04:00.1,bus=root.1,addr=00.1 \ -drive file=/home/server/window_nvidia750.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -boot menu=on </code></pre></div><p>Any advice on the issue would be awesome <br />I can&#039;t post anything more now as the computer is not on hand</p><p>Cheers<br />Casper</p> <p class="postedit"><em>Last edited by Casperian (2014-10-28 09:05:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=122">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <strong>123</strong> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <a href="viewtopic.php?id=162768&amp;p=125">125</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=124">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
