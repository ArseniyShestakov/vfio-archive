<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 45) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=45" title="Page 45" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=44" title="Page 44" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=46" title="Page 46" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=44">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <a href="viewtopic.php?id=162768&amp;p=44">44</a> <strong>45</strong> <a href="viewtopic.php?id=162768&amp;p=46">46</a> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=46">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1378063" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1101</span> <a href="viewtopic.php?pid=1378063#p1378063">2014-02-04 00:18:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79137">tecnologic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79137">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok stupid question, how do i pull the patch? Clone Kernel repo and then?</p><p>sry i&#039;am not used to such deep linux things, but wanna get in to it. i&#039;am more at home on embedded microprocessors.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378063">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378065" class="blockpost roweven"> <h2><span><span class="conr">#1102</span> <a href="viewtopic.php?pid=1378065#p1378065">2014-02-04 00:21:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79137">tecnologic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79137">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok found a discription for git apply.</p><p>are there any problems with the 3.14rc1? if not i&#039;ll take that to try my luck on this one</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378065">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378075" class="blockpost rowodd"> <h2><span><span class="conr">#1103</span> <a href="viewtopic.php?pid=1378075#p1378075">2014-02-04 00:37:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tecnologic wrote:</cite><blockquote><div><p>ok found a discription for git apply.</p><p>are there any problems with the 3.14rc1? if not i&#039;ll take that to try my luck on this one</p></div></blockquote></div><p>v3.13 is likely a more stable target</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378075">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378078" class="blockpost roweven"> <h2><span><span class="conr">#1104</span> <a href="viewtopic.php?pid=1378078#p1378078">2014-02-04 00:44:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79137">tecnologic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79137">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok i&#039;ll use that. but this will take some time i need to read about this patching. how to apply your links to a branch</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378078">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378212" class="blockpost rowodd"> <h2><span><span class="conr">#1105</span> <a href="viewtopic.php?pid=1378212#p1378212">2014-02-04 12:59:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone found a way to reliably rebind usb devices to the host after the VM is shut down?<br />I tried to</p><div class="codebox"><pre><code>echo $bus-$port &gt; /sys/bus/usb/drivers_probe</code></pre></div><p>but it does not seem work. Any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378212">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378256" class="blockpost roweven"> <h2><span><span class="conr">#1106</span> <a href="viewtopic.php?pid=1378256#p1378256">2014-02-04 16:09:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79137">tecnologic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79137">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Maybe it helps to eject the devices when shutting down the VM? some pages before there was an .exe mentiont to eject GPU maybe it works for USB parts to.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378256">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378286" class="blockpost rowodd"> <h2><span><span class="conr">#1107</span> <a href="viewtopic.php?pid=1378286#p1378286">2014-02-04 17:15:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I can&#039;t test it right now, but I don&#039;t think one can eject a usb keyboard?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378286">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378297" class="blockpost roweven"> <h2><span><span class="conr">#1108</span> <a href="viewtopic.php?pid=1378297#p1378297">2014-02-04 17:39:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=10978">toma222</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: France</span></dd> <dd><span>Registered: 2007-05-17</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=10978">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>toma222 wrote:</cite><blockquote><div><p>Hello,</p><p>I used my Radeon 7850 in a Windows 7/8/8.1 guest with pci-assign for months (with the only issue of the host crash in case of guest reboot).</p><p>Now, I want to use it with a Linux guest (Ubuntu) with vfio-pci, to make a kind of virtual Steam Machine + XBMC. </p><p>I have tried :<br />- secondary pasthrough (with a cirrus emulated graphic card) with vfio-pci : the guest start, the Radeon is detected and I have the display on the HDMI output, Unity start, I can play video, but when I try to use 3D (for example with fglrxinfo or Steam), I have only segmentation fault.<br />- primary passtrough with x-vga=on : I have built the 3.13 kernel (with options and patches from first post) and qemu from git, but I have exactly the same behaviour.</p><p>I have also tried with an old Radeon 6850 in secondary passthrough and vfio-pci, and it work quite well (except&#160; some strange performance in Serious Sam 3).</p><p>Do you have an idea why I can&#039;t get the Radeon 7850 working normally ?</p><p>My host use a Core i7 4770S and is on Debian.</p><p>Thanks.</p></div></blockquote></div><p>Just to let you know, with the latest commits in qemu.git, I now have my Radeon 7850 working normally in my Linux guest.<br />It seems that the issue was that before I can&#039;t start the guest with CPU model other than qemu64. Now it works with host model and the 3D is Ok.<br />I have tested secondary passthrough with unpatched kernel 3.13 from Debian and primary passthrough with patched one, and it work great for both (except for the memory not releases when the guest shutdown without the fix_memleak patch).</p><p>So thank you Alex for your work and all others for all the information in this thread.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378297">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378695" class="blockpost rowodd"> <h2><span><span class="conr">#1109</span> <a href="viewtopic.php?pid=1378695#p1378695">2014-02-05 19:46:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I&#039;ve read this thread now for 8 months or so and I&#039;m the guy who created this crude fix for the NVIDIA binary driver. Just to follow-up. I&#039;ve already informed NVIDIA in their DevTalk Forum about this issue and it looks that there is some progress since January this year. You can follow it here:</p><p><a href="https://devtalk.nvidia.com/default/topic/545560/vfio-vga-arbitration-lock" rel="nofollow">https://devtalk.nvidia.com/default/topi … ation-lock</a></p><p>Anybody who needs this fixed should reply to it so that NVIDIA sees importance for it. Another thing that somebody here might observed and found a solution already is multi GPU passthrough to a single VM. I&#039;ve asked already on qemu-devel and maybe Alex is reading it soon. I got multi GPU passthrough only working with Linux VMs for now but not with Windows. You can follow it here:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00753.html</a></p><p>Any help or investigation to get it working is much appreciated. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>--Maik</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378695">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378700" class="blockpost roweven"> <h2><span><span class="conr">#1110</span> <a href="viewtopic.php?pid=1378700#p1378700">2014-02-05 20:06:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mbroemme wrote:</cite><blockquote><div><p>Hi,</p><p>I&#039;ve read this thread now for 8 months or so and I&#039;m the guy who created this crude fix for the NVIDIA binary driver. Just to follow-up. I&#039;ve already informed NVIDIA in their DevTalk Forum about this issue and it looks that there is some progress since January this year. You can follow it here:</p><p><a href="https://devtalk.nvidia.com/default/topic/545560/vfio-vga-arbitration-lock" rel="nofollow">https://devtalk.nvidia.com/default/topi … ation-lock</a></p><p>Anybody who needs this fixed should reply to it so that NVIDIA sees importance for it. Another thing that somebody here might observed and found a solution already is multi GPU passthrough to a single VM. I&#039;ve asked already on qemu-devel and maybe Alex is reading it soon. I got multi GPU passthrough only working with Linux VMs for now but not with Windows. You can follow it here:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2014-02/msg00753.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00753.html</a></p><p>Any help or investigation to get it working is much appreciated. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>--Maik</p></div></blockquote></div><p>Hi, thanks for creating this patch. I&#039;m ajs124 on the nvidia forum. Seems like you failed to respond to the Nvidia guy, too. They have a strange notification system over there, so it took me months to follow up on his request for the nvidia-bug-report.log.gz and steps to reproduce the issue.</p><p>More replies/traffic over at nvidia devtalk from the people using the patch seems like a good idea to increase visibilty and maybe have this fixed upstream at some point.</p><p>I think I was credited for this patch in the original post for some reason. Maybe nbhs should change my name there to yours ^^</p> <p class="postedit"><em>Last edited by andy123 (2014-02-05 20:07:20)</em></p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378700">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378717" class="blockpost rowodd"> <h2><span><span class="conr">#1111</span> <a href="viewtopic.php?pid=1378717#p1378717">2014-02-05 21:36:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@mbroemme: responded there. Thanks a hundret times for the patch. W/o it my setup wouldn&#039;t work.</p><p>@andy123: something completely different. I rember you also have a Gigabyte board with funny Marvell 88SE91xx controller(s). See <a href="https://bugzilla.kernel.org/show_bug.cgi?id=42679#c30" rel="nofollow">https://bugzilla.kernel.org/show_bug.cgi?id=42679#c30</a> for a patch and check if it helps. Andrew needs some more AMD testers. With that patch my controllers are fully usable on the host itself, and passthrough also works fine (though I meanwhile use a ZFS ZVOL for the VM rootfs).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378722" class="blockpost roweven"> <h2><span><span class="conr">#1112</span> <a href="viewtopic.php?pid=1378722#p1378722">2014-02-05 21:53:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>teekay wrote:</cite><blockquote><div><p>@mbroemme: responded there. Thanks a hundret times for the patch. W/o it my setup wouldn&#039;t work.</p></div></blockquote></div><p>Thanks, but honestly most thanks go to aw who points me to the right direction on what to do. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378725" class="blockpost rowodd"> <h2><span><span class="conr">#1113</span> <a href="viewtopic.php?pid=1378725#p1378725">2014-02-05 22:00:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I was also able to retrieve the following output by running &#039;cat /proc/kmsg&#039; during the crash</p><div class="codebox"><pre><code>&lt;6&gt;[ 996.181525] vfio-pci 0000:02:00.0: enabling device (0000 -&gt; 0003) &lt;6&gt;[ 996.207159] vfio_ecap_init: 0000:02:00.0 hiding ecap 0x19@0x270 &lt;6&gt;[ 998.065072] vgaarb: device changed decodes: PCI:0000:01:00.0,olddecodes=io+mem,decodes=none:owns=io+mem &lt;6&gt;[ 998.065076] vgaarb: transferring owner from PCI:0000:01:00.0 to PCI:0000:02:00.0 &lt;3&gt;[ 998.095398] ata3: illegal qc_active transition (00000001-&gt;97b282a8) &lt;3&gt;[ 998.095540] ata3.00: exception Emask 0x2 SAct 0x0 SErr 0xd0000000 action 0x6 frozen &lt;3&gt;[ 998.095567] ata3: SError: { } &lt;3&gt;[ 998.095580] ata3.00: failed command: FLUSH CACHE EXT &lt;3&gt;[ 998.095607] ata3.00: cmd ea/00:00:00:00:00/00:00:00:00:00/a0 tag 0 &lt;3&gt;[ 998.095607] res 40/00:00:00:00:00/00:00:00:00:00/a0 Emask 0x2 (HSM violation) &lt;3&gt;[ 998.095637] ata3.00: status: { DRDY } &lt;6&gt;[ 998.095653] ata3: hard resetting link &lt;4&gt;[ 998.103575] Clocksource tsc unstable (delta = -147227892866 ns)</code></pre></div><p>Thanks again for your help!</p></div></blockquote></div><p>I had the exact same issue and I observed the same if I changed the NVIDIA card with an AMD using radeon driver. The solution for me was very simple but took me a couple of days to figure out.</p><p>After changing the default VGA device to use in BIOS of my GA-990FX-UD3 to the device which will be assigned to the VM later it started to work. So currently I do the following: I boot system via VGA on AMD Radeon card, bind it during boot via udev (before loading nouveau or radeon module) to VFIO and if nouveau or radeon is loaded it enables my secondary device which will be used for host system. After that I&#039;m able to passthrough the AMD card (used for booting host) to a VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378753" class="blockpost roweven"> <h2><span><span class="conr">#1114</span> <a href="viewtopic.php?pid=1378753#p1378753">2014-02-05 23:54:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>...<br />I think I was credited for this patch in the original post for some reason. Maybe nbhs should change my name there to yours ^^</p></div></blockquote></div><p>Actually i was crediting you for the link, but i also linked the original conversation on qemu-devel, and mbroemme thank you a lot for this patch <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378753">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378757" class="blockpost rowodd"> <h2><span><span class="conr">#1115</span> <a href="viewtopic.php?pid=1378757#p1378757">2014-02-06 00:02:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79244">Tom_B</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for this awesome topic, I&#039;ve been following this thread for a while and and I&#039;m planning a system build that allows VGA passthrough but I have some questions:</p><p>1) Can you pass through an nvidia 770 or 780, there seems to be contradictory information on this as most places say you need to mod it into a quadro yet the front of this topic suggests otherwise<br />2) Can you run gpus from the same manufacturer in both the host and the guest OS? e.g. 2 radeons or 2 geforce cards? As I understand it there is a limitation on the catalyst drivers which means you cant use the official driver in the host, which isn&#039;t ideal</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378757">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378761" class="blockpost roweven"> <h2><span><span class="conr">#1116</span> <a href="viewtopic.php?pid=1378761#p1378761">2014-02-06 00:10:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tom_B wrote:</cite><blockquote><div><p>Thanks for this awesome topic, I&#039;ve been following this thread for a while and and I&#039;m planning a system build that allows VGA passthrough but I have some questions:</p><p>1) Can you pass through an nvidia 770 or 780, there seems to be contradictory information on this as most places say you need to mod it into a quadro yet the front of this topic suggests otherwise<br />2) Can you run gpus from the same manufacturer in both the host and the guest OS? e.g. 2 radeons or 2 geforce cards? As I understand it there is a limitation on the catalyst drivers which means you cant use the official driver in the host, which isn&#039;t ideal</p></div></blockquote></div><p>1) <a href="https://bbs.archlinux.org/viewtopic.php?pid=1373705#p1373705" rel="nofollow">iamtakingiteasy</a> got a geforce 780 GTX working on a vm, also if you look back on the thread there&#039;s been a lot of nvidia cards reported working<br />2) I&#039;m using 2 radeon cards myself, different models though using the open-source drivers, i havent tried the catalyst drivers but some people have reported problems using them on the host</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378761">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378849" class="blockpost rowodd"> <h2><span><span class="conr">#1117</span> <a href="viewtopic.php?pid=1378849#p1378849">2014-02-06 10:19:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tom_B wrote:</cite><blockquote><div><p>1) Can you pass through an nvidia 770 or 780, there seems to be contradictory information on this as most places say you need to mod it into a quadro yet the front of this topic suggests otherwise</p></div></blockquote></div><p>The modding info is (or was?) only true for Xen VGA Passthrough as far as I know.</p><div class="quotebox"><cite>Tom_B wrote:</cite><blockquote><div><p>2) Can you run gpus from the same manufacturer in both the host and the guest OS? e.g. 2 radeons or 2 geforce cards? As I understand it there is a limitation on the catalyst drivers which means you cant use the official driver in the host, which isn&#039;t ideal</p></div></blockquote></div><p>A friend of mine runs two different nvidia cards and it seems to work. An advantage is that you would not need the i915 patch in that case.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378849">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378873" class="blockpost roweven"> <h2><span><span class="conr">#1118</span> <a href="viewtopic.php?pid=1378873#p1378873">2014-02-06 11:40:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79137">tecnologic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79137">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>i made some progress, i saw my first bios screen on the passthrough Geforce. Thanks to aw for the i915 kernel patches. But when i kill qemu due to no boot device, and start it a second time the card does not respond and the host freezes. When i use vrit-manager the passthrough does not funktion, but it resets the card properly. </p><p>so I need to look back in the thread i think the reset problem was mentioned before.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378873">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1378957" class="blockpost rowodd"> <h2><span><span class="conr">#1119</span> <a href="viewtopic.php?pid=1378957#p1378957">2014-02-06 16:25:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>teekay wrote:</cite><blockquote><div><p>@mbroemme: responded there. Thanks a hundret times for the patch. W/o it my setup wouldn&#039;t work.</p><p>@andy123: something completely different. I rember you also have a Gigabyte board with funny Marvell 88SE91xx controller(s). See <a href="https://bugzilla.kernel.org/show_bug.cgi?id=42679#c30" rel="nofollow">https://bugzilla.kernel.org/show_bug.cgi?id=42679#c30</a> for a patch and check if it helps. Andrew needs some more AMD testers. With that patch my controllers are fully usable on the host itself, and passthrough also works fine (though I meanwhile use a ZFS ZVOL for the VM rootfs).</p></div></blockquote></div><p>Hey teekay! Thanks for the link, I have an ASRock board, but this patch works for it after adding the PCI-ID of my controller. Once I&#039;ve done more testing I&#039;ll report back to the upstream report.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1378957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379278" class="blockpost roweven"> <h2><span><span class="conr">#1120</span> <a href="viewtopic.php?pid=1379278#p1379278">2014-02-07 14:29:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,<br />thank you for your time spent to create a working configuration.</p><p>I&#039;m following the thread for more than 6 month and I hope, like you, to have a stable passthrough.</p><p>On my hardware Intel DQ67SW, i5 2400 I have succeeded to passthrough a radeon 7790 recently.<br />I also have a LSI 1068E HBA which I want to assign it to a FreeNAS VM.<br />I tried to load the HBA ROM from file and the card still will not be initialized in the VM.</p><p>In ESXi is working ok, but only when the device reset method is D3D0.<br />Can this be done using KVM ?</p><p>In ESXi possible values for the reset method include flr, d3d0, link, bridge, or default.<br /><a href="http://www.vmware.com/files/pdf/techpaper/vsp_4_vmdirectpath_host.pdf" rel="nofollow">http://www.vmware.com/files/pdf/techpap … h_host.pdf</a>.</p><p>The default setting is described as follows. If a device supports function level reset (FLR), ESXi always uses FLR. If the device does not support FLR, ESXi next defaults to link reset and bus reset in that order. Link reset and bus reset might prevent some devices from being assigned to different virtual machines, or from being assigned between the VMkernel and virtual machines. In the absence of FLR, it is possible to use PCI Power Management capability (D3 to D0 transitions) to trigger a reset. Most of the Intel NICs and various other HBAs support this mode.</p><p>I&#039;m thinking to change my motherboard with an Asrock Z77 Professional Fatal1ty.<br />Does anyone had any luck with this board ?</p><p>Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379278">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379387" class="blockpost rowodd"> <h2><span><span class="conr">#1121</span> <a href="viewtopic.php?pid=1379387#p1379387">2014-02-07 19:39:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73114">noctavian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-11</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73114">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tom_B wrote:</cite><blockquote><div><p>1) Can you pass through an nvidia 770 or 780, there seems to be contradictory information on this as most places say you need to mod it into a quadro yet the front of this topic suggests otherwise</p></div></blockquote></div><p>noobman reported that GTX 770 works with secondary passthrough<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1364674#p1364674" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 4#p1364674</a></p><div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><p>I&#039;m thinking to change my motherboard with an Asrock Z77 Professional Fatal1ty.<br />Does anyone had any luck with this board ?</p></div></blockquote></div><p>cmdr managed to passthrough a Nvidia GTX 470 on this motherboard<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1348932#p1348932" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 2#p1348932</a></p><p>Also you might want to take a look at<br /><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">VGA-Passthrough configs</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379781" class="blockpost roweven"> <h2><span><span class="conr">#1122</span> <a href="viewtopic.php?pid=1379781#p1379781">2014-02-09 09:56:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After some time I wanted to give it another try, but still no luck. I`m running Core i5 3470 on Z68 chipset, Debian x64 with compiled 3.12.0 kernel, built qemu &amp; seabios myself with few patches from original post applied ( patches seem to work as intended ). Trying to run GTX680 hardmodded into GRID K2 as a secondary adapter to an emulated vga, still getting Error code 43. </p><p>Only new thing i see in kern. log is :</p><div class="codebox"><pre><code>Feb 9 13:45:45 cave-lin kernel: [19833.025719] vfio-pci 0000:01:00.0: irq 57 for MSI/MSI-X</code></pre></div><p>Starting VM like this:</p><div class="codebox"><pre><code>$ sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu SandyBridge -smp 3,sockets=1,cores=3,threads=1 -bios /opt/kalujny/kernel/seabios/out/bios.bin -device vfio-pci,host=01:00.0,addr=07.0,multifunction=on,romfile=/opt/kalujny/thrash/PNYGTX6802GB_GRIDK2.rom -device vfio-pci,host=01:00.1,addr=07.1 -drive file=/opt/kalujny/thrash/windows.img,if=none,id=disk,format=raw -device ide-hd,bus=ide.0,unit=0,drive=disk -usbdevice tablet</code></pre></div><p>My next steps would be building a fresh kernel / qemu and probably give up afterwards. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> <p class="postedit"><em>Last edited by ilya80 (2014-02-09 10:00:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379813" class="blockpost rowodd"> <h2><span><span class="conr">#1123</span> <a href="viewtopic.php?pid=1379813#p1379813">2014-02-09 12:58:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79333">Kaidax</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79333.png?m=1391951511" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2014-02-09</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:kudahkukarek@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there any way to increase KVM performance? Right now I experience atrocious framerates in Borderlands 2 under KVM, it runs at most at 55 fps and drops badly to 25. Dropping resolution to 640x480 and disabling every graphics option doesn&#039;t affect FPS at all. But under Xen I easily get 200 fps with the same Windows image! Pinning vcpus and hugepages increases FPS by 1-2, but nowhere near playable. Benchmarks indicate no problems, Cinebench CPU score is 766, 3DMark 11 Physics 9300, WEI 7.8.</p><p>I launch mainly with this script on Arch qemu-git, linux 3.13 with memleak and arbiter patches, but I&#039;ve also tried secondary passthrough with pci-assign and vfio both on Arch and on stock Ubuntu 13.04 libvirt to no avail.</p><div class="codebox"><pre><code>#!/bin/bash # i440fx QEMU_AUDIO_DRV=alsa sudo qemu-system-x86_64 -enable-kvm \ -m 3072 -mem-prealloc -mem-path /dev/hugepages \ -cpu host -smp 8,sockets=1,cores=4,threads=8 \ -bios /usr/share/qemu/bios.bin -vga none \ -device vfio-pci,host=01:00.0,bus=pci.0,x-vga=on \ -device vfio-pci,host=01:00.1,bus=pci.0 \ -drive file=/run/media/abc/7582fbde-8935-4dd7-a6e4-42440830672e/home/nya/w-1.img,id=hd,format=raw,index=0 \ -drive file=/dev/disk/by-label/windowsgames,id=hd2,format=raw,index=1 \ -device ich9-intel-hda,bus=pci.0,addr=1b.0,id=sound0 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -netdev bridge,br=virbr0,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:f7:26:8a,bus=pci.0 \ -usb -usbdevice host:093a:2510 \ &quot;$@&quot;</code></pre></div><p>My specs are:<br />Intel Core i7-4771<br />Asrock Z87 Extreme4<br />8GB RAM<br />AMD Radeon HD 7870<br />guest OS - Windows 7 x64</p><p>Can anyone post their framerates for comparison? Borderlands 2 is free on steam for today.</p> <p class="postedit"><em>Last edited by Kaidax (2014-02-09 13:12:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379813">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379827" class="blockpost roweven"> <h2><span><span class="conr">#1124</span> <a href="viewtopic.php?pid=1379827#p1379827">2014-02-09 13:51:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Kaidax wrote:</cite><blockquote><div><p>-cpu host -smp 8,sockets=1,cores=4,threads=8</p></div></blockquote></div><p>That might be your problem. You should use -cpu host -smp 8,sockets=1,cores=4,threads=2 for your CPU.<br />Maybe using i440fx is slower as well? Why don&#039;t you use -machine type=q35,accel=kvm?</p><br /><div class="quotebox"><cite>Kaidax wrote:</cite><blockquote><div><p>-drive file=/run/media/abc/7582fbde-8935-4dd7-a6e4-42440830672e/home/nya/w-1.img,id=hd,format=raw,index=0 \<br />-drive file=/dev/disk/by-label/windowsgames,id=hd2,format=raw,index=1 \<br />-netdev bridge,br=virbr0,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:f7:26:8a,bus=pci.0 \</p></div></blockquote></div><p>Any reason you don&#039;t use virtual device drivers? e.g. like so:</p><div class="codebox"><pre><code>-netdev tap,id=net.0,vhost=on,ifname=tap0,script=no,downscript=no -device virtio-net-pci,netdev=net.0 \ -drive id=disk1,file=/dev/sdg,if=none,index=0,media=disk -device virtio-blk-pci,drive=disk1,bootindex=1</code></pre></div><p>It should not boost fps that much, but it should generally be a bit snappier.</p><div class="quotebox"><cite>Kaidax wrote:</cite><blockquote><div><p>Can anyone post their framerates for comparison? Borderlands 2 is free on steam for today.</p></div></blockquote></div><p>I didn&#039;t measure FPS in detail, but steam in-house streaming reported 20fps at 1080p and highest details on <a href="https://bbs.archlinux.org/viewtopic.php?pid=1365018#p1365018" rel="nofollow">my system</a>.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379827">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1379833" class="blockpost rowodd"> <h2><span><span class="conr">#1125</span> <a href="viewtopic.php?pid=1379833#p1379833">2014-02-09 14:35:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79333">Kaidax</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79333.png?m=1391951511" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2014-02-09</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:kudahkukarek@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>That might be your problem. You should use -cpu host -smp 8,sockets=1,cores=4,threads=2 for your CPU.</p></div></blockquote></div><p>No difference. I&#039;ve already tried passing arbitrary number of cores, 2, 4, 3, 6, 8. No real difference.</p><div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>Maybe using i440fx is slower as well? Why don&#039;t you use -machine type=q35,accel=kvm?</p></div></blockquote></div><p>q35 memory access is generally slower than i440fx. I&#039;ve tried q35, no difference in FPS, except q35 doesn&#039;t even load textures properly, so they stay blurred. Graphics performance is the same between KVM and Xen, unigine heaven scores are perfectly identical, but the game still lags on KVM.</p><div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>Any reason you don&#039;t use virtual device drivers? e.g. like so:</p><div class="codebox"><pre><code>-netdev tap,id=net.0,vhost=on,ifname=tap0,script=no,downscript=no -device virtio-net-pci,netdev=net.0 \ -drive id=disk1,file=/dev/sdg,if=none,index=0,media=disk -device virtio-blk-pci,drive=disk1,bootindex=1</code></pre></div><p>It should not boost fps that much, but it should generally be a bit snappier.</p></div></blockquote></div><p>I&#039;ve used virtio drivers on Ubuntu&#039;s virt-manager. No difference. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>I didn&#039;t measure FPS in detail, but steam in-house streaming reported 20fps at 1080p and highest details on <a href="https://bbs.archlinux.org/viewtopic.php?pid=1365018#p1365018" rel="nofollow">my system</a>.</p></div></blockquote></div><p>20 fps? Ouch, that&#039;s bad. gtx 660 is capable of much-much more.</p> <p class="postedit"><em>Last edited by Kaidax (2014-02-09 15:34:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1379833">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=44">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <a href="viewtopic.php?id=162768&amp;p=44">44</a> <strong>45</strong> <a href="viewtopic.php?id=162768&amp;p=46">46</a> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=46">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
