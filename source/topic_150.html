<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 150) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=150" title="Page 150" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=149" title="Page 149" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=151" title="Page 151" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=149">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=148">148</a> <a href="viewtopic.php?id=162768&amp;p=149">149</a> <strong>150</strong> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=151">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1489957" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3726</span> <a href="viewtopic.php?pid=1489957#p1489957">2015-01-03 22:44:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=43339">TwosComplement</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-10-16</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=43339">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks to everyone who contributed to this thread, but I need a bit of assistance. I&#039;ve been trying to get this working for hours, but I can&#039;t get this setup working no matter which modules or options I use. There&#039;s no errors when I bind the card using the script in the OP or when I run QEMU, but I get no signal.</p><p>Hardware:<br />Motherboard: Intel DB85FL<br />Processor: Intel i7-4770<br />Graphics (guest):&#160; EVGA GeForce GTX 760<br />Graphics (host): Intel</p><p>I&#039;m using the latest kernel in the repo at the moment (3.17.6), as I am under the impression that the patches in the OP are now included in the official arch kernel. Is this correct, or did I skip the most important step?</p><p>Here&#039;s some command outputs.</p><div class="codebox"><pre><code>$ zcat /proc/config | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y</code></pre></div><div class="codebox"><pre><code>$ cat /proc/cmdline \boot\vmlinuz-linux root=/dev/sda2 rootfstype=ext4 rw intel_iommu=on i915.enable_hd_vgaarb=1 initrd=boot\initramfs-linux.img</code></pre></div><div class="codebox"><pre><code>$ cat /etc/modprobe.d/vgapassthru.conf blacklist nouveau blacklist nvidia options kvm ignore_msrs=1 options pci-stub ids=10de:1187,10de:0e0a options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><div class="codebox"><pre><code>$ lsmod | grep vfio vfio_iommu_type1 17118 0 vfio_pci 35525 0 vfio 18477 2 vfio_iommu_type1,vfio_pci</code></pre></div><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -enable-kvm -M q35 -m 8G -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -cpu kvm=off \ -mem-prealloc \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>The monitor is connected to the graphics card via a DVI cable, if that&#039;s relevant.</p><p>Anyone have any ideas on how to get my card working? I would very much appreciate it as I would like to finally boot Arch full-time.</p> <p class="postedit"><em>Last edited by TwosComplement (2015-01-03 22:47:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489958" class="blockpost roweven"> <h2><span><span class="conr">#3727</span> <a href="viewtopic.php?pid=1489958#p1489958">2015-01-03 22:52:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TwosComplement wrote:</cite><blockquote><div><p>Thanks to everyone who contributed to this thread, but I need a bit of assistance. I&#039;ve been trying to get this working for hours, but I can&#039;t get this setup working no matter which modules or options I use. There&#039;s no errors when I bind the card using the script in the OP or when I run QEMU, but I get no signal.</p><p>Hardware:<br />Motherboard: Intel DB85FL<br />Processor: Intel i7-4770<br />Graphics (guest):&#160; EVGA GeForce GTX 760<br />Graphics (host): Intel</p><p>I&#039;m using the latest kernel in the repo at the moment (3.17.6), as I am under the impression that the patches in the OP are now included in the official arch kernel. Is this correct, or did I skip the most important step?</p></div></blockquote></div><p>&lt;ding, ding, ding&gt; We have a winner!&#160; The i915 patch is not upstream and is not destined to ever be upstream.&#160; If you want to use an unmodified kernel, you either need to get rid of Intel graphics on the host or use OVMF in the guest, which your video card should support.</p><div class="quotebox"><blockquote><div><p>Here&#039;s some command outputs.</p><div class="codebox"><pre><code>$ zcat /proc/config | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y</code></pre></div><div class="codebox"><pre><code>$ cat /proc/cmdline \boot\vmlinuz-linux root=/dev/sda2 rootfstype=ext4 rw intel_iommu=on i915.enable_hd_vgaarb=1 initrd=boot\initramfs-linux.img</code></pre></div><div class="codebox"><pre><code>$ cat /etc/modprobe.d/vgapassthru.conf blacklist nouveau blacklist nvidia options kvm ignore_msrs=1 options pci-stub ids=10de:1187,10de:0e0a options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div></div></blockquote></div><p>This vfio option is probably not needed.&#160; pci-stub is a poor choice to make a module, you generally want it builtin so that it can claim devices before host drivers.&#160; Shouldn&#039;t be an issue in this case since you&#039;re blacklisting the relevant host drivers.</p><div class="quotebox"><blockquote><div><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -enable-kvm -M q35 -m 8G -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -cpu kvm=off \ -mem-prealloc \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>You don&#039;t specify your guest OS, but I&#039;ll repeat for the billionth time, if it&#039;s Windows, don&#039;t bother with q35, just use 440fx.&#160; You also don&#039;t need to specify a bios and -mem-prealloc does nothing in this case.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489958">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489965" class="blockpost rowodd"> <h2><span><span class="conr">#3728</span> <a href="viewtopic.php?pid=1489965#p1489965">2015-01-03 23:18:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=43339">TwosComplement</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-10-16</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=43339">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you so much for your help! I really need to be more careful about reading, sorry about the misunderstanding. I finally have it working with OVMF and 440fx. Do you accept tips?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489965">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490013" class="blockpost roweven"> <h2><span><span class="conr">#3729</span> <a href="viewtopic.php?pid=1490013#p1490013">2015-01-04 03:42:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw: I&#039;m curious if you have any feedback on my <a href="https://bbs.archlinux.org/viewtopic.php?pid=1487806#p1487806" rel="nofollow">post</a>, with the setup I&#039;m using. I&#039;ve made a few edits since I originally posted it, based on more reading and some suggestions relating to the changes others have made.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490013">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490019" class="blockpost rowodd"> <h2><span><span class="conr">#3730</span> <a href="viewtopic.php?pid=1490019#p1490019">2015-01-04 05:39:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Myranti wrote:</cite><blockquote><div><p>@aw: I&#039;m curious if you have any feedback on my <a href="https://bbs.archlinux.org/viewtopic.php?pid=1487806#p1487806" rel="nofollow">post</a>, with the setup I&#039;m using. I&#039;ve made a few edits since I originally posted it, based on more reading and some suggestions relating to the changes others have made.</p></div></blockquote></div><p>The vfio-bind script is unnecessary in your configuration.&#160; With <em>managed=&quot;yes&quot;</em> libvirt should automatically bind the devices to vfio-pci when you start the VM.</p><p>It looks like you motherboard has 4 x16 slots, the top 3 sourced from the CPU, the bottom (and the x1 slot and PCI slots via the crappy ASM1083) sourced from the PCH.&#160; If that&#039;s true, then the top 3 x16 slots will always be grouped together because Intel doesn&#039;t feel like supporting ACS on Xeon E3-1200 series.&#160; If you could find a GPU that can fit in that bottom slot for the host, then you could at least run a test w/o needing the ACS override hackery.&#160; Asus boards are pretty poor about letting you pick the primary graphics though.&#160; I wouldn&#039;t rule out lack of isolation between GPUs as a source of the black lines, there is a reason the ACS patch is not upstream.&#160; Maybe there are Crossfire settings in the BIOS that can be disabled.&#160; Trying a non-Radeon card for host or guest would also be a good experiment.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490019">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490024" class="blockpost roweven"> <h2><span><span class="conr">#3731</span> <a href="viewtopic.php?pid=1490024#p1490024">2015-01-04 06:52:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The vfio-bind script is unnecessary in your configuration.&#160; With <em>managed=&quot;yes&quot;</em> libvirt should automatically bind the devices to vfio-pci when you start the VM.</p></div></blockquote></div><p>Ah, that&#039;s easier if I don&#039;t need to do the extra to bind it as well since I&#039;ve already done the unbinding and binding over to pci-stub.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It looks like you motherboard has 4 x16 slots, the top 3 sourced from the CPU, the bottom (and the x1 slot and PCI slots via the crappy ASM1083) sourced from the PCH.&#160; If that&#039;s true, then the top 3 x16 slots will always be grouped together because Intel doesn&#039;t feel like supporting ACS on Xeon E3-1200 series. If you could find a GPU that can fit in that bottom slot for the host, then you could at least run a test w/o needing the ACS override hackery.&#160; Asus boards are pretty poor about letting you pick the primary graphics though.&#160; I wouldn&#039;t rule out lack of isolation between GPUs as a source of the black lines, there is a reason the ACS patch is not upstream.&#160; Maybe there are Crossfire settings in the BIOS that can be disabled.&#160; Trying a non-Radeon card for host or guest would also be a good experiment.</p></div></blockquote></div><p>Yeah, I found there was a large IOMMU group with the PCIe slots and would require too many devices to be passed through. What are Asrock boards like as an alternative, at least from the perspective of picking primary graphics? I&#039;ve considered replacing the board with the Asrock C226-WS. I&#039;ll see if I can find a better setup/arrangement in bios, but another issue was that the cooler I&#039;m using goes ever so slightly into the first x16 slot, so I ended up using it for the USB 3 card. Perhaps a different board with different layout would give me flexibility to move the cards elsewhere without needing to use the ACS patch.</p><p>As for the black lines, I tested a GTX 460 and an R7 250 and didn&#039;t have any issues with lines, only with the R5 230, so I&#039;m not entirely sure what the issue is there.</p><p>Thanks for the feedback though, it gives me some stuff to work with and see what I can change or what might work better!</p> <p class="postedit"><em>Last edited by Myranti (2015-01-04 06:53:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490024">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490078" class="blockpost rowodd"> <h2><span><span class="conr">#3732</span> <a href="viewtopic.php?pid=1490078#p1490078">2015-01-04 12:58:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I tried installing windows 7 using ovmf but i could never get it to work, i believe it needs the csm present, so i gave up and installed windows 8 with a patched ovmf to allow it to boot directly from the amd sata controller.<br /><a href="https://drive.google.com/open?id=0Bxp_MsrVrNnENVdsMGtVbTNDYkk&amp;authuser=0" rel="nofollow">OVMF-sata.tar.gz</a> <br />Also, once you&#039;re done installing windows 8 <a href="http://winaero.com/blog/how-to-disable-or-enable-fast-startup-in-windows-8-1/" rel="nofollow">disable fast boot</a></p></div></blockquote></div><br /><p>Hi, I found your post from early December. Can you tell me how you patched the ovmf file with the amd sata controller? I have 3 Sata Controllers available and I&#039;d like to try the Intel one and boot from it. How can I patch the ovmf myself with the Intel sata controller drivers? Is this easy? </p><p>Thank you very much for your help!</p> <p class="postedit"><em>Last edited by 4kGamer (2015-01-04 13:34:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490078">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490085" class="blockpost roweven"> <h2><span><span class="conr">#3733</span> <a href="viewtopic.php?pid=1490085#p1490085">2015-01-04 13:57:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I tried installing windows 7 using ovmf but i could never get it to work, i believe it needs the csm present, so i gave up and installed windows 8 with a patched ovmf to allow it to boot directly from the amd sata controller.<br /><a href="https://drive.google.com/open?id=0Bxp_MsrVrNnENVdsMGtVbTNDYkk&amp;authuser=0" rel="nofollow">OVMF-sata.tar.gz</a> <br />Also, once you&#039;re done installing windows 8 <a href="http://winaero.com/blog/how-to-disable-or-enable-fast-startup-in-windows-8-1/" rel="nofollow">disable fast boot</a></p></div></blockquote></div><br /><p>Hi, I found your post from early December. Can you tell me how you patched the ovmf file with the amd sata controller? I have 3 Sata Controllers available and I&#039;d like to try the Intel one and boot from it. How can I patch the ovmf myself with the Intel sata controller drivers? Is this easy? </p><p>Thank you very much for your help!</p></div></blockquote></div><p>Just google reza sata patch v3, and it&#039;s not just for amd controllers, you can also use qemu&#039;s emulated one, and no it not that easy, you could use the binaries i provided</p> <p class="postedit"><em>Last edited by nbhs (2015-01-04 13:59:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490085">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490091" class="blockpost rowodd"> <h2><span><span class="conr">#3734</span> <a href="viewtopic.php?pid=1490091#p1490091">2015-01-04 14:11:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thank you!</p><p>one question: since it&#039;s not that easy, can I just use the patched ovmf you provided and boot to Windows with it and afterwards install the Intel sata drivers? I am not sure if I&#039;d lose performance that way.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490091">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490119" class="blockpost roweven"> <h2><span><span class="conr">#3735</span> <a href="viewtopic.php?pid=1490119#p1490119">2015-01-04 15:07:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>thank you!</p><p>one question: since it&#039;s not that easy, can I just use the patched ovmf you provided and boot to Windows with it and afterwards install the Intel sata drivers? I am not sure if I&#039;d lose performance that way.</p></div></blockquote></div><p>You need to use the patched binaries if you plan on booting from the controller, without the patch ovmf wont see your drives and you simply cant boot from it unless you dump/get an intel UEFI (not the windows driver) driver for your controller</p><p>Here&#039;s a guide on how to dump and uefi driver from memory: <a href="https://cs.nyu.edu/~gazzillo/xeniac/extract_efi_driver.html" rel="nofollow">https://cs.nyu.edu/~gazzillo/xeniac/ext … river.html</a></p><p>But you wont need to do this if you&#039;re using my binaries</p> <p class="postedit"><em>Last edited by nbhs (2015-01-04 15:13:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490119">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490127" class="blockpost rowodd"> <h2><span><span class="conr">#3736</span> <a href="viewtopic.php?pid=1490127#p1490127">2015-01-04 15:26:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I guess it just doesn&#039;t Impact performance if I use those binaries and update SATA Drivers in Windows... Thank you for the link. But I will just use yours. And it worked! Thank you!</p><p>Now what I realised is that the only issue I am having are low IOPS (30.000+ compared to bare metal 90.000+). </p><p>Is there something I can do about it or is SATA passthrough simply not good enough?</p> <p class="postedit"><em>Last edited by 4kGamer (2015-01-04 16:59:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490127">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490139" class="blockpost roweven"> <h2><span><span class="conr">#3737</span> <a href="viewtopic.php?pid=1490139#p1490139">2015-01-04 15:59:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Myranti wrote:</cite><blockquote><div><p>Yeah, I found there was a large IOMMU group with the PCIe slots and would require too many devices to be passed through. What are Asrock boards like as an alternative, at least from the perspective of picking primary graphics? I&#039;ve considered replacing the board with the Asrock C226-WS. I&#039;ll see if I can find a better setup/arrangement in bios, but another issue was that the cooler I&#039;m using goes ever so slightly into the first x16 slot, so I ended up using it for the USB 3 card. Perhaps a different board with different layout would give me flexibility to move the cards elsewhere without needing to use the ACS patch.</p></div></blockquote></div><p>Gigabyte boards seem to be the most configurable for setting primary graphics in the BIOS.&#160; Asrock annoyed me by being more eager to tell me they don&#039;t support Linux than to answer my technical question back when I was looking for an AMD-Vi system, so I don&#039;t have any experience with them.&#160; I doubt the USB3 card in the top slot is really hurting anything, it&#039;s just not making very good use of the bandwidth available in that slot.&#160; Are you currently ordering the cards to make the host GPU the primary graphics?</p><div class="quotebox"><blockquote><div><p>As for the black lines, I tested a GTX 460 and an R7 250 and didn&#039;t have any issues with lines, only with the R5 230, so I&#039;m not entirely sure what the issue is there.</p></div></blockquote></div><p>Could certainly be some peer-to-peer enabled when multiple Radeon cards are installed.&#160; Good for enabling Crossfire, bad for isolation with a VM.&#160; Maybe this is why Intel won&#039;t support isolation on &quot;client&quot; CPU root ports.&#160; You might look at motherboards that would allow you to install the guest GPU in a PCH root port.&#160; These are often identifiable as the PCIe2.0 slots rather than PCIe3.0.&#160; Assigning the onboard USB3 card to the guest and using the plugin card for the host may also provide more flexibility.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490139">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490302" class="blockpost rowodd"> <h2><span><span class="conr">#3738</span> <a href="viewtopic.php?pid=1490302#p1490302">2015-01-05 09:36:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Gigabyte boards seem to be the most configurable for setting primary graphics in the BIOS.&#160; Asrock annoyed me by being more eager to tell me they don&#039;t support Linux than to answer my technical question back when I was looking for an AMD-Vi system, so I don&#039;t have any experience with them.&#160; I doubt the USB3 card in the top slot is really hurting anything, it&#039;s just not making very good use of the bandwidth available in that slot.&#160; Are you currently ordering the cards to make the host GPU the primary graphics?</p></div></blockquote></div><p>Yeah, the cards are ordered so that the host GPU (The R5 230) is primary graphics in the next usable slot after the one being taken up by the USB 3 card.</p><div class="quotebox"><blockquote><div><p>Could certainly be some peer-to-peer enabled when multiple Radeon cards are installed.&#160; Good for enabling Crossfire, bad for isolation with a VM.&#160; Maybe this is why Intel won&#039;t support isolation on &quot;client&quot; CPU root ports.&#160; You might look at motherboards that would allow you to install the guest GPU in a PCH root port.&#160; These are often identifiable as the PCIe2.0 slots rather than PCIe3.0.&#160; Assigning the onboard USB3 card to the guest and using the plugin card for the host may also provide more flexibility.</p></div></blockquote></div><p>I think it might be worth seeing what alternatives there are for motherboards. The main concern is still getting enough PCIe slots, seeing as I&#039;ll have no use for PCI slots with my setup.</p><p><strong>Edit:</strong> It looks like Supermicro have some workable boards with Primary Display selection (looking at the X10SAT), although I from what I can see there may very well be the same sort of issue with IOMMU groups as what I have now.</p> <p class="postedit"><em>Last edited by Myranti (2015-01-06 13:27:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490302">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490650" class="blockpost roweven"> <h2><span><span class="conr">#3739</span> <a href="viewtopic.php?pid=1490650#p1490650">2015-01-06 10:41:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82709">flack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82709">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all i want to ask. Are there some performance benefits when i use kernel 3.18 instead my 3.15? or another reasons?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490650">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490709" class="blockpost rowodd"> <h2><span><span class="conr">#3740</span> <a href="viewtopic.php?pid=1490709#p1490709">2015-01-06 15:21:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>If followed the guide, installed windows 8, and it kinda worked, execept the nividia driver. I enabled &quot;kvm=off&quot; on the cpu parameter, and installed the driver (from a cirrus vga adapter, with the card passthroug as secondary). It installed fine, but now i&#039;m getting BSOD&#039;s from the VM. The error is &quot;SYSTEM_SERVICE_EXCEPTION&quot; and it&#039;s originating from the nvidia driver.</p><p>I then tried installing windows 7, but that&#039;s just giving me this whenever i try to boot. the installation went fine (this is without any passthrough).</p><div class="codebox"><pre><code>KVM internal error. Suberror: 1 emulation failure EAX=00000010 EBX=00000080 ECX=00000000 EDX=00000080 ESI=0025db2a EDI=0007db2a EBP=00007c00 ESP=00000200 EIP=000000ca EFL=00010002 [-------] CPL=0 II=0 A20=1 SMM=0 HLT=0 ES =0020 00000200 0000ffff 00009300 CS =b000 000b0000 0000ffff 00009f00 SS =0020 00000200 0000ffff 00009300 DS =0020 00000200 0000ffff 00009300 FS =0020 00000200 0000ffff 00009300 GS =0020 00000200 0000ffff 00009300 LDT=0000 00000000 0000ffff 00008200 TR =0000 00000000 0000ffff 00008b00 GDT= 002b0000 0000001f IDT= 00000000 000003ff CR0=00000010 CR2=00000000 CR3=00000000 CR4=00000000 DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 DR6=00000000ffff0ff0 DR7=0000000000000400 EFER=0000000000000000 Code=ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff &lt;ff&gt; ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff</code></pre></div><p>Here&#039;s my script for launching the vm:</p><div class="codebox"><pre><code>vfio-bind 0000:03:00.0 0000:03:00.1 qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host,kvm=off \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga cirrus \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \ -drive file=/home/delusional/vm/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -drive file=/home/delusional/vm/install.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -usb -usbdevice host:1038:1361 -usbdevice host:1532:010d \ -net nic -net bridge,br=br0 \ -boot menu=on</code></pre></div><p>I am aware that this would not enable the passthrough anyway (seeing as the nividia card is secondary) but at least it should boot right?</p></div></blockquote></div><br /><p>I was having the same error before I patched the kernel.</p></div></blockquote></div><br /><p>Which patch fixed it? I can&#039;t see the VGA arbiter patch having much effect since I&#039;m not using the i915 driver. Also what OS are you running in the VM?</p> <p class="postedit"><em>Last edited by DelusionalLogic (2015-01-06 15:22:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490709">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490741" class="blockpost roweven"> <h2><span><span class="conr">#3741</span> <a href="viewtopic.php?pid=1490741#p1490741">2015-01-06 16:54:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve got my Win10 guest to boot with my GTX 760 passed through, though I am unable to get USB working:</p><div class="codebox"><pre><code>qemu-system-x86_64: util/qemu-option.c:387: qemu_opt_get_bool_helper: Assertion `opt-&gt;desc &amp;&amp; opt-&gt;desc-&gt;type == QEMU_OPT_BOOL&#039; failed.</code></pre></div><p>Searching for this error, it appears the latest commit of QEMU introduced this error - recent results from Google in last two weeks. Originally my host was setup for XEN, but I disabled those features and booted off your linux-mainline kernel. On installing QEMU-GIT it had to unisntall regular QEMU. Does pulling down QEMU-GIT also grab the latest QEMU source? Could this issue be from an unknown failure of the uninstall?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490741">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490763" class="blockpost rowodd"> <h2><span><span class="conr">#3742</span> <a href="viewtopic.php?pid=1490763#p1490763">2015-01-06 18:01:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>I&#039;ve got my Win10 guest to boot with my GTX 760 passed through, though I am unable to get USB working:</p><div class="codebox"><pre><code>qemu-system-x86_64: util/qemu-option.c:387: qemu_opt_get_bool_helper: Assertion `opt-&gt;desc &amp;&amp; opt-&gt;desc-&gt;type == QEMU_OPT_BOOL&#039; failed.</code></pre></div><p>Searching for this error, it appears the latest commit of QEMU introduced this error - recent results from Google in last two weeks. Originally my host was setup for XEN, but I disabled those features and booted off your linux-mainline kernel. On installing QEMU-GIT it had to unisntall regular QEMU. Does pulling down QEMU-GIT also grab the latest QEMU source? Could this issue be from an unknown failure of the uninstall?</p></div></blockquote></div><p>If you&#039;re unwilling to deal with breakages, you should probably be building from a released tag in qemu.git and not just the current development head.&#160; <em>git checkout v2.2.0</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490763">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490779" class="blockpost roweven"> <h2><span><span class="conr">#3743</span> <a href="viewtopic.php?pid=1490779#p1490779">2015-01-06 18:43:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How did you all compile the modified kernel? The &quot;acs override&quot; patch doesn&#039;t seem to be compatible with the 3.17 &quot;quirks.c&quot;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490779">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490785" class="blockpost rowodd"> <h2><span><span class="conr">#3744</span> <a href="viewtopic.php?pid=1490785#p1490785">2015-01-06 18:50:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>I&#039;ve got my Win10 guest to boot with my GTX 760 passed through, though I am unable to get USB working:</p><div class="codebox"><pre><code>qemu-system-x86_64: util/qemu-option.c:387: qemu_opt_get_bool_helper: Assertion `opt-&gt;desc &amp;&amp; opt-&gt;desc-&gt;type == QEMU_OPT_BOOL&#039; failed.</code></pre></div><p>Searching for this error, it appears the latest commit of QEMU introduced this error - recent results from Google in last two weeks. Originally my host was setup for XEN, but I disabled those features and booted off your linux-mainline kernel. On installing QEMU-GIT it had to unisntall regular QEMU. Does pulling down QEMU-GIT also grab the latest QEMU source? Could this issue be from an unknown failure of the uninstall?</p></div></blockquote></div><p>If you&#039;re unwilling to deal with breakages, you should probably be building from a released tag in qemu.git and not just the current development head.&#160; <em>git checkout v2.2.0</em></p></div></blockquote></div><p>Yeah, that makes sense. I&#039;ll need to recompile with the correct build. I&#039;ve only been using Arch for three days now and it is a lot different from what i&#039;m used to, RHEL 5/6 Solaris AIX. I&#039;m actually liking it quite a lot.</p><p>I assume i&#039;m supposed to do v2.2.0, but how do I pull that specific version instead of automatically getting the latest and greatest?</p> <p class="postedit"><em>Last edited by The_Moves (2015-01-06 18:50:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490785">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490788" class="blockpost roweven"> <h2><span><span class="conr">#3745</span> <a href="viewtopic.php?pid=1490788#p1490788">2015-01-06 18:52:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>I&#039;ve got my Win10 guest to boot with my GTX 760 passed through, though I am unable to get USB working:</p><div class="codebox"><pre><code>qemu-system-x86_64: util/qemu-option.c:387: qemu_opt_get_bool_helper: Assertion `opt-&gt;desc &amp;&amp; opt-&gt;desc-&gt;type == QEMU_OPT_BOOL&#039; failed.</code></pre></div><p>Searching for this error, it appears the latest commit of QEMU introduced this error - recent results from Google in last two weeks. Originally my host was setup for XEN, but I disabled those features and booted off your linux-mainline kernel. On installing QEMU-GIT it had to unisntall regular QEMU. Does pulling down QEMU-GIT also grab the latest QEMU source? Could this issue be from an unknown failure of the uninstall?</p></div></blockquote></div><p>If you&#039;re unwilling to deal with breakages, you should probably be building from a released tag in qemu.git and not just the current development head.&#160; <em>git checkout v2.2.0</em></p></div></blockquote></div><p>Yeah, that makes sense. I&#039;ll need to recompile with the correct build. I&#039;ve only been using Arch for three days now and it is a lot different from what i&#039;m used to, RHEL 5/6 Solaris AIX. I&#039;m actually liking it quite a lot.</p><p>I assume i&#039;m supposed to do v2.2.0, but how do I pull that specific version instead of automatically getting the latest and greatest?</p></div></blockquote></div><p>Maybe you shouldn&#039;t be using git.&#160; <a href="http://wiki.qemu.org/Download" rel="nofollow">http://wiki.qemu.org/Download</a>&#160; I assume there are ways to get what you need from arch too.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490788">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490791" class="blockpost rowodd"> <h2><span><span class="conr">#3746</span> <a href="viewtopic.php?pid=1490791#p1490791">2015-01-06 18:55:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks, you are correct. I was making it harder than it was supposed to be</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490791">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490847" class="blockpost roweven"> <h2><span><span class="conr">#3747</span> <a href="viewtopic.php?pid=1490847#p1490847">2015-01-06 22:24:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So i applied the &quot;ACS override&quot; patch and tried running it again (That was a lot of work). Sadly it changed nothing.</p><p>To reiterate the issue:<br />I installed windows 8 and the nvidia drivers using the cirrus drivers with my nvidia card as a secondary passthrough. That part works. The problem occurs when I start the VM with the nvidia drivers installed (the card is still passed through as secondary). It just immediately causes a BSOD with a &quot;SYSTEM_SERVICE_EXCEPTION&quot;.</p><p>I have the ACS override patch applied and IOMMU enables (with some custom patches to the bios)</p><p>My hardware is:<br />Intel I7 920<br />Asus P6T deluxe V2 (Yes, i know it&#039;s broken. I patched the bios, and it IOMMU does enable)<br />Nvidia GTX 460 (Passthrough)<br />Nvidia GTX 660ti (Main)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490847">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490852" class="blockpost rowodd"> <h2><span><span class="conr">#3748</span> <a href="viewtopic.php?pid=1490852#p1490852">2015-01-06 22:30:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>So i applied the &quot;ACS override&quot; patch and tried running it again (That was a lot of work). Sadly it changed nothing.</p><p>To reiterate the issue:<br />I installed windows 8 and the nvidia drivers using the cirrus drivers with my nvidia card as a secondary passthrough. That part works. The problem occurs when I start the VM with the nvidia drivers installed (the card is still passed through as secondary). It just immediately causes a BSOD with a &quot;SYSTEM_SERVICE_EXCEPTION&quot;.</p><p>I have the ACS override patch applied and IOMMU enables (with some custom patches to the bios)</p><p>My hardware is:<br />Intel I7 920<br />Asus P6T deluxe V2 (Yes, i know it&#039;s broken. I patched the bios, and it IOMMU does enable)<br />Nvidia GTX 460 (Passthrough)<br />Nvidia GTX 660ti (Main)</p></div></blockquote></div><p>Where is it claimed that GeForce cards work as secondary in the guest?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490852">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490856" class="blockpost roweven"> <h2><span><span class="conr">#3749</span> <a href="viewtopic.php?pid=1490856#p1490856">2015-01-06 22:59:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>So i applied the &quot;ACS override&quot; patch and tried running it again (That was a lot of work). Sadly it changed nothing.</p><p>To reiterate the issue:<br />I installed windows 8 and the nvidia drivers using the cirrus drivers with my nvidia card as a secondary passthrough. That part works. The problem occurs when I start the VM with the nvidia drivers installed (the card is still passed through as secondary). It just immediately causes a BSOD with a &quot;SYSTEM_SERVICE_EXCEPTION&quot;.</p><p>I have the ACS override patch applied and IOMMU enables (with some custom patches to the bios)</p><p>My hardware is:<br />Intel I7 920<br />Asus P6T deluxe V2 (Yes, i know it&#039;s broken. I patched the bios, and it IOMMU does enable)<br />Nvidia GTX 460 (Passthrough)<br />Nvidia GTX 660ti (Main)</p></div></blockquote></div><p>Where is it claimed that GeForce cards work as secondary in the guest?</p></div></blockquote></div><p>Ohh, so I&#039;m an idiot... The good news is that it actually works. I got the long unsupported nonworking asus board to work.</p><p>Thanks.</p><p>EDIT:</p><p>I was a bit too quick. It boots fine, but the graphics performance is absolutely abysmal. GPU-Z reports that the driver is installed and loaded (forceware 347), it&#039;s also reporting the right card (Gefore 460). The problem is that it&#039;s reporting 0 MHz clock rate, and 0 MB memory. This obviously means that it&#039;s not communicating correctly with the card. What could cause that?</p><p>EDIT2: Indeed, even the control panel wont launch. I guess the driver is completely borked. (Exception code 0x40000015)</p> <p class="postedit"><em>Last edited by DelusionalLogic (2015-01-07 00:37:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490856">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1490946" class="blockpost rowodd"> <h2><span><span class="conr">#3750</span> <a href="viewtopic.php?pid=1490946#p1490946">2015-01-07 09:50:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Also, if you&#039;re sure that your host disks are okay, try preparing your windows to migrating on virtio-blk-pci instead of scsi-way. That involves creating a dummy-drive on virtio-blk-pci device and feeding windows with drivers from virtio.iso and then &quot;reconnecting&quot; the drive.</p></div></blockquote></div><p>The disk seems good to me, which qemu options I need to use virtio-blk-pci?</p></div></blockquote></div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>First - you&#039;ve got to create a -device entry with virtio-blk-pci and drive=null, where -drive=/dev/null,id=null,if=none,format=raw .<br />Second - you boot windows with virtio.iso plugged into it, load the drivers for that disk controller.<br />Third - you change the drive of given virtio-blk-pci device to your windows drive and it should boot. If it gets BSOD 7B during startup - drivers for disk controller aren&#039;t installed.</p></div></blockquote></div><div class="quotebox"><cite>JohnyPea wrote:</cite><blockquote><div><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>PS: what are the benefits of using virtio-blk instead of virtio-scsi?</p></div></blockquote></div><p>With virtio-blk you can use x-data-plane=on, which increases IOPS in guest and lowers overhead in host. In windows guest I wasn&#039;t able to pass trim operations through virtio-blk as opposed to virtio-scsi. Later I found a workaround to this by using detect-zeroes=on with discard=&#039;unmap&#039; and writing zeros to desired sectors (zero out unused disk space inside guest).</p></div></blockquote></div><p>Can someone please share with me how I can enable virtio-blk-data-plane for the Libvirt Domain XML?</p><p>I couldn&#039;t transform these posts into my XML.</p><p>I also found some slides from redhat, but they don&#039;t work either. How does the relevant code look like in XML?</p><p>I am trying for some days now without luck.</p><p>thank you very much.</p> <p class="postedit"><em>Last edited by 4kGamer (2015-01-07 10:27:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1490946">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=149">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=148">148</a> <a href="viewtopic.php?id=162768&amp;p=149">149</a> <strong>150</strong> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=151">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
