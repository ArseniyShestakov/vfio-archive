<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 224) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=224" title="Page 224" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=223" title="Page 223" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=225" title="Page 225" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=223">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <strong>224</strong> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=225">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1544133" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5576</span> <a href="viewtopic.php?pid=1544133#p1544133">2015-07-13 02:12:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Mouse response is normal , but the key strokes are delayed by ~5 seconds .</p><p>@Duelist :</p><p>&quot;I would like to be able to provide access to the PCIe devices to the VMs while simultaneously allowing the host OS to still access the PCIe devices.&quot;</p> <p class="postedit"><em>Last edited by Denso (2015-07-13 02:13:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544133">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544151" class="blockpost roweven"> <h2><span><span class="conr">#5577</span> <a href="viewtopic.php?pid=1544151#p1544151">2015-07-13 04:32:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p> <p class="postedit"><em>Last edited by morat (2015-07-13 05:29:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544151">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544154" class="blockpost rowodd"> <h2><span><span class="conr">#5578</span> <a href="viewtopic.php?pid=1544154#p1544154">2015-07-13 05:34:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@Duelist :</p><p>&quot;I would like to be able to provide access to the PCIe devices to the VMs while simultaneously allowing the host OS to still access the PCIe devices.&quot;</p></div></blockquote></div><p>As far as I know, that isn&#039;t possible, and even if it were, it would be unwise; data corruption etc. GPUs, network cards etc. are built to handle multiple <em>outputs</em>, but there&#039;s a reason a PCIe card can only fit in one slot.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544154">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544179" class="blockpost roweven"> <h2><span><span class="conr">#5579</span> <a href="viewtopic.php?pid=1544179#p1544179">2015-07-13 07:36:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I currently have a working setup using Q35 + SeaBIOS, but am trying to change over to using i440fx + OVMF. The VBIOS for the card I&#039;m attempting to pass-through does not appear to have an EFI section according to rom-parser, but the manufacturer has provided an updated version that does. </p><p>I&#039;ve gotten a working VM without the card passed through, but adding the card and specifying the updated VBIOS with a &lt;rom file=&quot;...&quot; /&gt; segment appears to just hang after boot -- there&#039;s no output on the physical monitor attached to the card, the VM consumes an absolutely constant amount of CPU time, and it never comes up on the network. Remove the card from the VM, and it boots just fine and I can reach it over VNC.</p><p>Any idea on how to troubleshoot further? Do I need to try flashing the updated vbios to the card? If so, how do I do this under Linux? I&#039;ve tried atiflash, but it just returns &#039;Adapter not found&#039; when I ask it to list current adapters...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544179">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544181" class="blockpost rowodd"> <h2><span><span class="conr">#5580</span> <a href="viewtopic.php?pid=1544181#p1544181">2015-07-13 07:38:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>The UEFI shell didn&#039;t recognize your Windows 8.1 ISO because it&#039;s in UDF format, not iso9660 -- I had this issue initially myself.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544181">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544190" class="blockpost roweven"> <h2><span><span class="conr">#5581</span> <a href="viewtopic.php?pid=1544190#p1544190">2015-07-13 08:15:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><p>So I currently have a working setup using Q35 + SeaBIOS, but am trying to change over to using i440fx + OVMF. The VBIOS for the card I&#039;m attempting to pass-through does not appear to have an EFI section according to rom-parser, but the manufacturer has provided an updated version that does. </p><p>I&#039;ve gotten a working VM without the card passed through, but adding the card and specifying the updated VBIOS with a &lt;rom file=&quot;...&quot; /&gt; segment appears to just hang after boot -- there&#039;s no output on the physical monitor attached to the card, the VM consumes an absolutely constant amount of CPU time, and it never comes up on the network. Remove the card from the VM, and it boots just fine and I can reach it over VNC.</p><p>Any idea on how to troubleshoot further? Do I need to try flashing the updated vbios to the card? If so, how do I do this under Linux? I&#039;ve tried atiflash, but it just returns &#039;Adapter not found&#039; when I ask it to list current adapters...</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1541532#p1541532" rel="nofollow">I&#039;ve </a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1513281#p1513281" rel="nofollow">had that</a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1504683#p1504683" rel="nofollow">problem</a> and <strong>solved</strong> it.<br />If you have an ASUS HD7750 Silent - i can give you a working ROM.<br />You don&#039;t need to flash anything, just append as romfile option.</p><br /><p>Hmmm.. finally a thing to put in my signature.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-13 08:17:54)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544190">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544195" class="blockpost rowodd"> <h2><span><span class="conr">#5582</span> <a href="viewtopic.php?pid=1544195#p1544195">2015-07-13 09:11:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>The UEFI shell didn&#039;t recognize your Windows 8.1 ISO because it&#039;s in UDF format, not iso9660 -- I had this issue initially myself.</p></div></blockquote></div><p>I got hopeful for a sec, but supposedly not:</p><div class="codebox"><pre><code>[lain@navi .vm]$ file Windows7.iso Windows7.iso: ISO 9660 CD-ROM filesystem data &#039;GSP1RMCPRXFREO_EN_DVD&#039; (bootable) [lain@navi .vm]$ file Windows81.iso Windows81.iso: ISO 9660 CD-ROM filesystem data &#039;IRM_CCSA_X64FRE_EN-US_DV5&#039; (bootable)</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544195">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544196" class="blockpost roweven"> <h2><span><span class="conr">#5583</span> <a href="viewtopic.php?pid=1544196#p1544196">2015-07-13 09:14:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1541532#p1541532" rel="nofollow">I&#039;ve </a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1513281#p1513281" rel="nofollow">had that</a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1504683#p1504683" rel="nofollow">problem</a> and <strong>solved</strong> it.<br />If you have an ASUS HD7750 Silent - i can give you a working ROM.<br />You don&#039;t need to flash anything, just append as romfile option.</p><br /><p>Hmmm.. finally a thing to put in my signature.</p></div></blockquote></div><br /><p>That was a fairly confusing series of links, but I ended up following the stuff on the <a href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/" rel="nofollow">insanelymac</a> link you gave and was able to create a version of my current VBIOS with the EFI GOP added, and rom-parser reports it contains a valid EFI ROM signature... I still get the same issues when trying to boot, however <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" />.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544196">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544197" class="blockpost rowodd"> <h2><span><span class="conr">#5584</span> <a href="viewtopic.php?pid=1544197#p1544197">2015-07-13 09:28:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>The UEFI shell didn&#039;t recognize your Windows 8.1 ISO because it&#039;s in UDF format, not iso9660 -- I had this issue initially myself.</p></div></blockquote></div><p>I got hopeful for a sec, but supposedly not:</p><div class="codebox"><pre><code>[lain@navi .vm]$ file Windows7.iso Windows7.iso: ISO 9660 CD-ROM filesystem data &#039;GSP1RMCPRXFREO_EN_DVD&#039; (bootable) [lain@navi .vm]$ file Windows81.iso Windows81.iso: ISO 9660 CD-ROM filesystem data &#039;IRM_CCSA_X64FRE_EN-US_DV5&#039; (bootable)</code></pre></div></div></blockquote></div><p>Get the &#039;disktype&#039; utility and run it on the images, confirm that they have an El Torito boot record entry that points to a FAT file system, relevant section of the output will look something like this if it does:</p><div class="codebox"><pre><code> El Torito boot record, catalog at 22 Bootable non-emulated image, starts at 2828, preloads 4 KiB Platform 0x00 (x86), System Type 0x00 (Empty) Bootable non-emulated image, starts at 2830, preloads 512 bytes Platform 0xEF (EFI), System Type 0x00 (Empty) Windows / MS-DOS boot loader FAT12 file system (hints score 5 of 5) Volume size 1.390 MiB (1457664 bytes, 2847 clusters of 512 bytes) Volume name &quot;EFISECTOR&quot;</code></pre></div><p>If it doesn&#039;t... get another image, I guess?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544197">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544231" class="blockpost roweven"> <h2><span><span class="conr">#5585</span> <a href="viewtopic.php?pid=1544231#p1544231">2015-07-13 12:43:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>You didn&#039;t hide kvm, this needs to appear within the &lt;features&gt; secions:</p><div class="codebox"><pre><code> &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt;</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544231">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544233" class="blockpost rowodd"> <h2><span><span class="conr">#5586</span> <a href="viewtopic.php?pid=1544233#p1544233">2015-07-13 13:01:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1541532#p1541532" rel="nofollow">I&#039;ve </a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1513281#p1513281" rel="nofollow">had that</a> <a href="https://bbs.archlinux.org/viewtopic.php?pid=1504683#p1504683" rel="nofollow">problem</a> and <strong>solved</strong> it.<br />If you have an ASUS HD7750 Silent - i can give you a working ROM.<br />You don&#039;t need to flash anything, just append as romfile option.</p><br /><p>Hmmm.. finally a thing to put in my signature.</p></div></blockquote></div><br /><p>That was a fairly confusing series of links, but I ended up following the stuff on the <a href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/" rel="nofollow">insanelymac</a> link you gave and was able to create a version of my current VBIOS with the EFI GOP added, and rom-parser reports it contains a valid EFI ROM signature... I still get the same issues when trying to boot, however <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" />.</p></div></blockquote></div><p>Scratch that, I built a git copy of ovmf and the VBIOS I built is working using that. Installing drivers now... will report back on whether or not this works out <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. Thanks for your help either way, Duelist.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544233">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544235" class="blockpost roweven"> <h2><span><span class="conr">#5587</span> <a href="viewtopic.php?pid=1544235#p1544235">2015-07-13 13:07:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>You didn&#039;t hide kvm, this needs to appear within the &lt;features&gt; secions:</p><div class="codebox"><pre><code> &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt;</code></pre></div></div></blockquote></div><p><a href="https://gist.github.com/678c5f6147cd4b3e64cd" rel="nofollow">Fixed.</a><br />Still code 43.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544235">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544246" class="blockpost rowodd"> <h2><span><span class="conr">#5588</span> <a href="viewtopic.php?pid=1544246#p1544246">2015-07-13 13:50:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Strangely, although I am getting output on the physical card it isn&#039;t listed in device manager. Despite this, the AMD Catalyst installer detects the graphics hardware and tries (unsuccessfully) to install it. It gets up to installing the actual driver, the screen flickers once, then the physical display loses signal, the VM goes offline and ramps up to a constant 100% CPU usage with no disk activity. Happens using both the modified copy of my existing VBIOS and the vendor-provided updated one.</p><p>My hardware:<br />Motherboard: Gigabyte 990FXA-UD3<br />CPU: FX-8350<br />Host GPU: Gigabyte GTX 750 Ti OC<br />Guest GPU: Gigabyte R9 290 (initial reference cooler release)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544246">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544255" class="blockpost roweven"> <h2><span><span class="conr">#5589</span> <a href="viewtopic.php?pid=1544255#p1544255">2015-07-13 14:32:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@aw<br /><span class="bbs">I won&#039;t be uploading that xml, I&#039;m trying now to run it on Win7</span>, <a href="https://gist.github.com/ea10f5c8eb69d5acfc35" rel="nofollow">I&#039;ll be uploading this XML</a>.<br />I tried OVMF, thinking it may make a difference, but Windows won&#039;t install at all using UEFI. With a Win8.1 ISO, the UEFI shell doesn&#039;t recognize the image, and with Win7, the screen goes black when the file copy begins, and the CPU maxes out. I&#039;ll update this post with whether the passthrough works with non-UEFI Win7.</p><p>Update:<br />Still doesn&#039;t work, OVMF was no success, and Win7 also has a code 43. If any more info is needed for a diagnosis, let me know.</p></div></blockquote></div><p>You didn&#039;t hide kvm, this needs to appear within the &lt;features&gt; secions:</p><div class="codebox"><pre><code> &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt;</code></pre></div></div></blockquote></div><p><a href="https://gist.github.com/678c5f6147cd4b3e64cd" rel="nofollow">Fixed.</a><br />Still code 43.</p></div></blockquote></div><p>You&#039;ve also still got the emulated graphics attached.&#160; Perhaps you could take a more thorough read of part4 of my guide?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544255">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544258" class="blockpost rowodd"> <h2><span><span class="conr">#5590</span> <a href="viewtopic.php?pid=1544258#p1544258">2015-07-13 14:52:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You didn&#039;t hide kvm, this needs to appear within the &lt;features&gt; secions:</p><div class="codebox"><pre><code> &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt;</code></pre></div></div></blockquote></div><p><a href="https://gist.github.com/678c5f6147cd4b3e64cd" rel="nofollow">Fixed.</a><br />Still code 43.</p></div></blockquote></div><p>You&#039;ve also still got the emulated graphics attached.&#160; Perhaps you could take a more thorough read of part4 of my guide?</p></div></blockquote></div><p>When I detatch the displays from the VM, starting it puts the CPU at exactly 25%, and the memory at 32MiB, with 0 I/O or other activity. Does not respond to VNC or pings. As soon as I re-attach the virtual displays, works a charm. This has got me absolutely stumped, thanks for not just giving a RTFM response.</p><p>Edit:<br />@aw, is any of this likely to be caused by running Win 7 / SeaBIOS? My Win 8 image lacks a FAT boot for UEFI, meaning OVMF was a no go; do I need to source a valid one, or find a way to fix this image?</p> <p class="postedit"><em>Last edited by morat (2015-07-13 15:00:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544258">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544260" class="blockpost roweven"> <h2><span><span class="conr">#5591</span> <a href="viewtopic.php?pid=1544260#p1544260">2015-07-13 14:58:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p><a href="https://gist.github.com/678c5f6147cd4b3e64cd" rel="nofollow">Fixed.</a><br />Still code 43.</p></div></blockquote></div><p>You&#039;ve also still got the emulated graphics attached.&#160; Perhaps you could take a more thorough read of part4 of my guide?</p></div></blockquote></div><p>When I detatch the displays from the VM, starting it puts the CPU at exactly 25%, and the memory at 32MiB, with 0 I/O or other activity. Does not respond to VNC or pings. As soon as I re-attach the virtual displays, works a charm. This has got me absolutely stumped, thanks for not just giving a RTFM response.</p></div></blockquote></div><p>I don&#039;t see a &lt;loader&gt; line in your xml, so you&#039;re using Seabios with Intel host graphics.&#160; That means you need to patch your host kernel or else any VGA region access done by the VGA ROM is going to go to the Intel GPU instead of the assigned GPU.&#160; Have you patched the host kernel and enabled i915 VGA arbitration?&#160; The OVMF approach doesn&#039;t require this.</p> <p class="postedit"><em>Last edited by aw (2015-07-13 14:58:31)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544260">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544267" class="blockpost rowodd"> <h2><span><span class="conr">#5592</span> <a href="viewtopic.php?pid=1544267#p1544267">2015-07-13 15:13:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;ve also still got the emulated graphics attached.&#160; Perhaps you could take a more thorough read of part4 of my guide?</p></div></blockquote></div><p>When I detatch the displays from the VM, starting it puts the CPU at exactly 25%, and the memory at 32MiB, with 0 I/O or other activity. Does not respond to VNC or pings. As soon as I re-attach the virtual displays, works a charm. This has got me absolutely stumped, thanks for not just giving a RTFM response.</p></div></blockquote></div><p>I don&#039;t see a &lt;loader&gt; line in your xml, so you&#039;re using Seabios with Intel host graphics.&#160; That means you need to patch your host kernel or else any VGA region access done by the VGA ROM is going to go to the Intel GPU instead of the assigned GPU.&#160; Have you patched the host kernel and enabled i915 VGA arbitration?&#160; The OVMF approach doesn&#039;t require this.</p></div></blockquote></div><p>The instructions in part 5 of your guide arent working for me, so I&#039;ll just find a Win8.1 image that works with UEFI; tomorrow.<br />FYI I get</p><div class="codebox"><pre><code>error: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm.vga -help) unexpected exit status 126: libvirt: error : cannot execute binary /usr/libexec/qemu-kvm.vga: Exec format error</code></pre></div><p>on virsh-ing the vga=on script. Apparently my kernel doesnt have SELinux enforced, or enabled, so that shouldn&#039;t be the issue.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544267">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544269" class="blockpost roweven"> <h2><span><span class="conr">#5593</span> <a href="viewtopic.php?pid=1544269#p1544269">2015-07-13 15:23:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>When I detatch the displays from the VM, starting it puts the CPU at exactly 25%, and the memory at 32MiB, with 0 I/O or other activity. Does not respond to VNC or pings. As soon as I re-attach the virtual displays, works a charm. This has got me absolutely stumped, thanks for not just giving a RTFM response.</p></div></blockquote></div><p>I don&#039;t see a &lt;loader&gt; line in your xml, so you&#039;re using Seabios with Intel host graphics.&#160; That means you need to patch your host kernel or else any VGA region access done by the VGA ROM is going to go to the Intel GPU instead of the assigned GPU.&#160; Have you patched the host kernel and enabled i915 VGA arbitration?&#160; The OVMF approach doesn&#039;t require this.</p></div></blockquote></div><p>The instructions in part 5 of your guide arent working for me, so I&#039;ll just find a Win8.1 image that works with UEFI; tomorrow.<br />FYI I get</p><div class="codebox"><pre><code>error: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm.vga -help) unexpected exit status 126: libvirt: error : cannot execute binary /usr/libexec/qemu-kvm.vga: Exec format error</code></pre></div><p>on virsh-ing the vga=on script. Apparently my kernel doesnt have SELinux enforced, or enabled, so that shouldn&#039;t be the issue.</p></div></blockquote></div><p>As always, no data help.&#160; I can&#039;t fix your script without seeing it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544269">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544270" class="blockpost rowodd"> <h2><span><span class="conr">#5594</span> <a href="viewtopic.php?pid=1544270#p1544270">2015-07-13 15:26:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I don&#039;t see a &lt;loader&gt; line in your xml, so you&#039;re using Seabios with Intel host graphics.&#160; That means you need to patch your host kernel or else any VGA region access done by the VGA ROM is going to go to the Intel GPU instead of the assigned GPU.&#160; Have you patched the host kernel and enabled i915 VGA arbitration?&#160; The OVMF approach doesn&#039;t require this.</p></div></blockquote></div><p>The instructions in part 5 of your guide arent working for me, so I&#039;ll just find a Win8.1 image that works with UEFI; tomorrow.<br />FYI I get</p><div class="codebox"><pre><code>error: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm.vga -help) unexpected exit status 126: libvirt: error : cannot execute binary /usr/libexec/qemu-kvm.vga: Exec format error</code></pre></div><p>on virsh-ing the vga=on script. Apparently my kernel doesnt have SELinux enforced, or enabled, so that shouldn&#039;t be the issue.</p></div></blockquote></div><p>As always, no data help.&#160; I can&#039;t fix your script without seeing it.</p></div></blockquote></div><p>It&#039;s your script, instructions followed to the letter.<br />EDIT:<br />I&#039;ve removed the other gpu option, and changed qemu-kvm to qemu-system-x86_64:</p><div class="codebox"><pre><code> #!/bin/sh exec qemu-system-x86_64 \ `echo &quot;\$@&quot; | \ sed &#039;s|01:00.0|01:00.0,x-vga=on|g&#039;`</code></pre></div> <p class="postedit"><em>Last edited by morat (2015-07-13 15:37:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544275" class="blockpost roweven"> <h2><span><span class="conr">#5595</span> <a href="viewtopic.php?pid=1544275#p1544275">2015-07-13 15:37:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>The instructions in part 5 of your guide arent working for me, so I&#039;ll just find a Win8.1 image that works with UEFI; tomorrow.<br />FYI I get</p><div class="codebox"><pre><code>error: internal error: Child process (LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin /usr/libexec/qemu-kvm.vga -help) unexpected exit status 126: libvirt: error : cannot execute binary /usr/libexec/qemu-kvm.vga: Exec format error</code></pre></div><p>on virsh-ing the vga=on script. Apparently my kernel doesnt have SELinux enforced, or enabled, so that shouldn&#039;t be the issue.</p></div></blockquote></div><p>As always, no data help.&#160; I can&#039;t fix your script without seeing it.</p></div></blockquote></div><p>It&#039;s your script, instructions followed to the letter.</p></div></blockquote></div><p>Shall we talk about last time you followed the instructions &quot;to the letter&quot; and failed to include kvm state hidden?&#160; If you can&#039;t be bothered to show your work, then I can&#039;t be bothered to help.&#160; Sorry.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544275">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544277" class="blockpost rowodd"> <h2><span><span class="conr">#5596</span> <a href="viewtopic.php?pid=1544277#p1544277">2015-07-13 15:39:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Always seconds between. If it isn&#039;t too much trouble, could you be bothered to read my work?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544277">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544280" class="blockpost roweven"> <h2><span><span class="conr">#5597</span> <a href="viewtopic.php?pid=1544280#p1544280">2015-07-13 15:40:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Did you: &quot;Be sure to chmod 755 the file before proceeding.&quot;</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544280">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544281" class="blockpost rowodd"> <h2><span><span class="conr">#5598</span> <a href="viewtopic.php?pid=1544281#p1544281">2015-07-13 15:42:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code># ls -lvm.vga -rwxr-xr-x 1 root root 94 Jul 14 01:35 /usr/libexec/qemu-kvm.vga</code></pre></div><p>Yes, without permissions it returns a permissions error.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544283" class="blockpost roweven"> <h2><span><span class="conr">#5599</span> <a href="viewtopic.php?pid=1544283#p1544283">2015-07-13 15:46:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Make the first like</p><div class="codebox"><pre><code>#!/bin/sh -x</code></pre></div><p>And run it by hand as:</p><div class="codebox"><pre><code>/usr/libexec/qemu-kvm.vga -help</code></pre></div><p>What does it output?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544283">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544286" class="blockpost rowodd"> <h2><span><span class="conr">#5600</span> <a href="viewtopic.php?pid=1544286#p1544286">2015-07-13 15:51:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Make the first like</p><div class="codebox"><pre><code>#!/bin/sh -x</code></pre></div><p>And run it by hand as:</p><div class="codebox"><pre><code>/usr/libexec/qemu-kvm.vga -help</code></pre></div><p>What does it output?</p></div></blockquote></div><p>Outputs the full qemu-system-x86_64 help, but virsh still fails.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544286">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=223">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <strong>224</strong> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=225">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
