<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 111) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=111" title="Page 111" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=110" title="Page 110" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=112" title="Page 112" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=110">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <strong>111</strong> <a href="viewtopic.php?id=162768&amp;p=112">112</a> <a href="viewtopic.php?id=162768&amp;p=113">113</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=112">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1457738" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2751</span> <a href="viewtopic.php?pid=1457738#p1457738">2014-09-17 18:03:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1455955#p1455955" rel="nofollow">My problem</a> usually results in black screen, not in BSOD. Unfortunately, i still can&#039;t fix it.</p><p><strong>Are there any users who were able to do a successful AMD R7 260x setup with Catalyst drivers?</strong> The <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a> contains some mentions about this GPU. How can i find that people?</p></div></blockquote></div><p>Based on <a href="http://wiki.x.org/wiki/RadeonFeature/" rel="nofollow">http://wiki.x.org/wiki/RadeonFeature/</a> , it looks like R7 260(x) is a Sea Islands card (Bonaire), like my R9 290 (Hawaii).&#160; </p><p>Assuming your passthrough is set up propely in terms of VGA arbitration, perhaps your video issue is the same device-reset failure.</p><p>In my case, the OS loads, but the desktop is black.&#160; I can tell the desktop is actually alive by enabling Narrator: press win+u, and press space when the voice says &quot;hear text read out loud&quot;.&#160; I seem to recall even being able to open Catalyst Control Center.</p><p>If that&#039;s what&#039;s happening to you, the workaround is to shut down the guest, suspend and resume the host, then start the guest again.&#160; You&#039;ll have to do this every time the guest restarts for any reason.</p><p>The spreadsheet entries for R7-260(x) include notes to reboot the host for guest reboot to work, but suspend/resume should have the same effect.</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-09-17 18:05:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457738">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457747" class="blockpost roweven"> <h2><span><span class="conr">#2752</span> <a href="viewtopic.php?pid=1457747#p1457747">2014-09-17 18:30:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1455955#p1455955" rel="nofollow">My problem</a> usually results in black screen, not in BSOD. Unfortunately, i still can&#039;t fix it.</p><p><strong>Are there any users who were able to do a successful AMD R7 260x setup with Catalyst drivers?</strong> The <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">report sheet</a> contains some mentions about this GPU. How can i find that people?</p></div></blockquote></div><p>Based on <a href="http://wiki.x.org/wiki/RadeonFeature/" rel="nofollow">http://wiki.x.org/wiki/RadeonFeature/</a> , it looks like R7 260(x) is a Sea Islands card (Bonaire), like my R9 290 (Hawaii).</p></div></blockquote></div><p>I was researching that too, if anyone can confirm that the HD7790 has the reset problem, it might be affordable enough that I could pick one up for testing.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457824" class="blockpost rowodd"> <h2><span><span class="conr">#2753</span> <a href="viewtopic.php?pid=1457824#p1457824">2014-09-17 21:06:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I was researching that too, if anyone can confirm that the HD7790 has the reset problem, it might be affordable enough that I could pick one up for testing.</p></div></blockquote></div><p>Yes, the HD7790 has the reset problem.</p><p>My card is :<br /><a href="http://www.sapphiretech.com/presentation/product/?cid=1&amp;gid=3&amp;sgid=1159&amp;pid=1875&amp;psn=&amp;lid=1&amp;leg=0" rel="nofollow">http://www.sapphiretech.com/presentatio … id=1&amp;leg=0</a></p><div class="codebox"><pre><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Bonaire XT [Radeon HD 7790/8770 / R9 260 OEM] (prog-if 00 [VGA controller]) Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 7790 Dual-X OC Flags: bus master, fast devsel, latency 0, IRQ 51 Memory at c0000000 (64-bit, prefetchable) [size=256M] Memory at d0000000 (64-bit, prefetchable) [size=8M] I/O ports at e000 [size=256] Memory at f6100000 (32-bit, non-prefetchable) [size=256K] Expansion ROM at f6140000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Capabilities: [270] #19 Capabilities: [2b0] Address Translation Service (ATS) Capabilities: [2c0] #13 Capabilities: [2d0] #1b Kernel driver in use: vfio-pci Kernel modules: radeon</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457824">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457890" class="blockpost roweven"> <h2><span><span class="conr">#2754</span> <a href="viewtopic.php?pid=1457890#p1457890">2014-09-18 02:41:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I was researching that too, if anyone can confirm that the HD7790 has the reset problem, it might be affordable enough that I could pick one up for testing.</p></div></blockquote></div><p>Yes, the HD7790 has the reset problem.</p></div></blockquote></div><p>Ok, I&#039;ll try to keep an eye out for a cheap one on ebay</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457890">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457893" class="blockpost rowodd"> <h2><span><span class="conr">#2755</span> <a href="viewtopic.php?pid=1457893#p1457893">2014-09-18 02:50:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am not sure what the reset problem ppls talk about R9. I had success with Sapphire Radeon R9 270 Dual-X OC 2GB DDR5 256Bit, but i recall having some issues with the audio part complaining about a power state, and i think it worked when was assigned with a secondary port explicitly for the audio. So anybody willing to try something like this:</p><div class="codebox"><pre><code>-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,addr=00.0,multifunction=on,bus=root.1,x-vga=on \ -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2 \ -device vfio-pci,host=01:00.1,addr=00.1,multifunction=on,bus=root.2 \</code></pre></div><p>Ofc with the host=...0X:00.0/1 part changed if necessary. To test if its the same problem i had, copy-paste the qemu command line in a terminal, and if its the same problem upon first run it gives no error message, but only upon shutdown and next subsequent vm start, only then it complains something related to the power state of the audio address. Sry cant recall the exact msg. But i think the above approach might just solve that, again, if its the same problem. Best of luck.</p> <p class="postedit"><em>Last edited by noobman (2014-09-18 03:01:02)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457893">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457895" class="blockpost roweven"> <h2><span><span class="conr">#2756</span> <a href="viewtopic.php?pid=1457895#p1457895">2014-09-18 02:54:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>I am not sure what the reset problem ppls talk about R9. I had success with Sapphire Radeon R9 270 Dual-X OC 2GB DDR5 256Bit, but i recall having some issues with the audio part complaining about a power state, and i think it worked when was assigned with a secondary port explicitly for the audio. So anybody willing to try something like this:</p><div class="codebox"><pre><code>-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,addr=00.0,multifunction=on,bus=root.1,x-vga=on \ -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2 \ -device vfio-pci,host=01:00.1,addr=00.1,multifunction=on,bus=root.2 \</code></pre></div><p>Ofc with the host=...0x:00.x part changed if necessary. To test if its the same problem i had, copy-paste the qemu command line in a terminal, and if its the same problem upon first run it gives no error message, but only upon shutdown and next subsequent vm start, only then it complains something about something related to the power state of the audio address. Sry cant recall the exact msg. But i think the above approach might just solve that, again, if its the same problem. Best of luck.</p></div></blockquote></div><p>As I understand it, the reset problem prevents users with these cards from even rebooting the VM without going through contortions with host suspend/resume or reboot.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457895">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457900" class="blockpost rowodd"> <h2><span><span class="conr">#2757</span> <a href="viewtopic.php?pid=1457900#p1457900">2014-09-18 03:09:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>As I understand it, the reset problem prevents users with these cards from even rebooting the VM without going through contortions with host suspend/resume or reboot.</p></div></blockquote></div><p>Dunno, what others had tbh. I just described my own experience. The error message i had was upon follow-up attempt of starting the vm, and was something like &quot;stuck in suspend&quot; or &quot;stuck in D3&quot; or something like that, and was pointing not to the video of 00.0, but was instead pointing to the ...00.1 which was the audio. I first tried passing only the video card, that particular message was gone but i still had problems with the driver instalation in guest. When i passed both like that, with different port for the audio, then it stopped throwing errors upon subsequent start(s) and also drivers installed right away. Again just to be clear, that just my eperience and may not fix the others issues, i just thought its worth mentioning and maybe somebody can give it a try.</p><p>Edit: Oh i didnt meant the user would suspend/resume the vm, no that was just qemu complaining when the vm was re-started. It would restart the vm, it would just throw that error message right before starting. I mean just like those messages of &quot;iommu group not viable&quot; etc. Tho this time somebody needs to see that exact message, so has to copy-paste in terminal otherwise it would be missed because qemu just keeps going after it. <br />Edit2: Also i think the reason warning is not there at first vm start (after a host boot), maybe because the passed card is just being initialized first time. Only at subseqent vm starts the warning appears, as if the previous improper reset left the device in a bad power state. This is how it looks like at least. Again, just to say, this is my experience, not necesarily what others have. Anyway my issue was gone with that allocation of secondary port for audio. Maybe that way it results in guest doing two resets, one distinct for each device. Or maybe the driver just expects the audio to be in a port right near. No clue why it worked like that.</p> <p class="postedit"><em>Last edited by noobman (2014-09-18 03:45:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457926" class="blockpost roweven"> <h2><span><span class="conr">#2758</span> <a href="viewtopic.php?pid=1457926#p1457926">2014-09-18 04:28:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>I am not sure what the reset problem ppls talk about R9. I had success with Sapphire Radeon R9 270 Dual-X OC 2GB DDR5 256Bit, ...</p></div></blockquote></div><p>The R9 270 is not a Sea Islands card.&#160; See <a href="http://xorg.freedesktop.org/wiki/RadeonFeature/#decoderringforengineeringvsmarketingnames" rel="nofollow">http://xorg.freedesktop.org/wiki/Radeon … etingnames</a></p><p>Southern Islands:<br />CAPE VERDE, PITCAIRN, TAHITI, OLAND, HAINAN<br />HD7750 - HD7970, R9 270, R9-280, R7 240, R7 250</p><p>Sea Islands:<br />BONAIRE, KABINI, KAVERI, HAWAII<br />HD7790, R7 260, R9 290</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457926">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1457990" class="blockpost rowodd"> <h2><span><span class="conr">#2759</span> <a href="viewtopic.php?pid=1457990#p1457990">2014-09-18 11:06:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Bummer. I could report success wtih the R9 270 and with R7 240 which i&#039;m using now, too bad its beyond the point. But another idea, if issues reflect on host, could you check <em>$dmesg | grep -i hotplug</em> if it reports back something like hotplug for pcie and pci. Cant guess something else about why host would be in trouble.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1457990">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458159" class="blockpost roweven"> <h2><span><span class="conr">#2760</span> <a href="viewtopic.php?pid=1458159#p1458159">2014-09-18 18:50:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>Bummer. I could report success wtih the R9 270 and with R7 240 which i&#039;m using now, too bad its beyond the point. But another idea, if issues reflect on host, could you check <em>$dmesg | grep -i hotplug</em> if it reports back something like hotplug for pcie and pci. Cant guess something else about why host would be in trouble.</p></div></blockquote></div><p>qemu? kernel? mobo? parameters?</p><p>just to see if I&#039;m missing something. I can0t passthrough my r9 270</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458159">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458224" class="blockpost rowodd"> <h2><span><span class="conr">#2761</span> <a href="viewtopic.php?pid=1458224#p1458224">2014-09-19 00:15:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>qemu? kernel? mobo? parameters? just to see if I&#039;m missing something. I can0t passthrough my r9 270</p></div></blockquote></div><p>I edited the spreadsheet posted by mr noctavian, the R9 270 config is on row no 276. Cpu i7-4790 and no intel graphics bs (disabled in bios), just 2 plain cards instead. Really no patches of any sort, stock kernel, and the module loading as i described a few posts before. The grub cmd line still needs intel_iommu=on and pci-stub.ids=.... but otherwise the modules are loaded via /etc/modules-load.d/... one module per line of conf file, and options if needed via the other folder, but in case of Z97 chipset i think should need no special options. <br />Kernels can work starting with 3.13 but recommending up to date 3.17-rc5 (or at least rc3). If you are using latest this might not be the case, but otherwise for older kernel and stuff, can use cli $ ll /sys/kernel/iommu_groups/1/devices/ and play with the 2 cards slot combination to make sure the iommu group with the passed gpu is clean and does not contain other devices. <br />About R9 270 i had that issue i also described a few posts above, with qemu complaining/warning &quot;stuck in D3&quot;, which dissapeared when putting the hdmi audio on secondary ioh3420 port. You could also describe your configuration.</p> <p class="postedit"><em>Last edited by noobman (2014-09-19 00:21:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458224">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458245" class="blockpost roweven"> <h2><span><span class="conr">#2762</span> <a href="viewtopic.php?pid=1458245#p1458245">2014-09-19 04:24:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So... just happened to get an update for Nvidia 344.11... Code 43 again <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I have no words...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458245">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458246" class="blockpost rowodd"> <h2><span><span class="conr">#2763</span> <a href="viewtopic.php?pid=1458246#p1458246">2014-09-19 04:30:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>just installed new nvidia driver 344.11 and got error code 43 <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" />(((</p> <p class="postedit"><em>Last edited by slis (2014-09-19 04:31:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458246">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458252" class="blockpost roweven"> <h2><span><span class="conr">#2764</span> <a href="viewtopic.php?pid=1458252#p1458252">2014-09-19 05:56:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>So... just happened to get an update for Nvidia 344.11... Code 43 again <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I have no words...</p></div></blockquote></div><p>Lol, you guys should just be grateful you got your cards working - why try to update? <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p><p>Haven&#039;t read this for a bit (my nvidia failure killed my enthusiasm somewhat), but great to see that spreadsheet with results - well done whoever did it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458252">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458291" class="blockpost rowodd"> <h2><span><span class="conr">#2765</span> <a href="viewtopic.php?pid=1458291#p1458291">2014-09-19 10:12:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>So... just happened to get an update for Nvidia 344.11... Code 43 again <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I have no words...</p></div></blockquote></div><p>Silly nVidia <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I&#039;m glad I bought AMD R9 <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458291">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458311" class="blockpost roweven"> <h2><span><span class="conr">#2766</span> <a href="viewtopic.php?pid=1458311#p1458311">2014-09-19 11:41:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>Bummer. I could report success wtih the R9 270 and with R7 240 which i&#039;m using now, too bad its beyond the point. But another idea, if issues reflect on host, could you check <em>$dmesg | grep -i hotplug</em> if it reports back something like hotplug for pcie and pci. Cant guess something else about why host would be in trouble.</p></div></blockquote></div><p>would it be too much of a trouble to ask you some more details on r7 240?<br />some points of special interest (r7 240 as passed gpu, not host one):<br /> - any problems with it so far? reboots or anything else<br /> - vendor/model/memory?<br /> - does it support UEFI boot (just firmware check would be enough in fact)?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458311">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458344" class="blockpost rowodd"> <h2><span><span class="conr">#2767</span> <a href="viewtopic.php?pid=1458344#p1458344">2014-09-19 14:27:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I was researching that too, if anyone can confirm that the HD7790 has the reset problem, it might be affordable enough that I could pick one up for testing.</p></div></blockquote></div><p>Yes, the HD7790 has the reset problem.</p><p>My card is :<br /><a href="http://www.sapphiretech.com/presentation/product/?cid=1&amp;gid=3&amp;sgid=1159&amp;pid=1875&amp;psn=&amp;lid=1&amp;leg=0" rel="nofollow">http://www.sapphiretech.com/presentatio … id=1&amp;leg=0</a></p></div></blockquote></div><p>Does the Sapphire card have an EFI BIOS?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458344">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458348" class="blockpost roweven"> <h2><span><span class="conr">#2768</span> <a href="viewtopic.php?pid=1458348#p1458348">2014-09-19 14:37:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>would it be too much of a trouble to ask you some more details on r7 240?<br />some points of special interest (r7 240 as passed gpu, not host one): [...]</p></div></blockquote></div><p>Ups i am very sry i think that was innacurate from my part, R7 240 was host card. Anyway I tried to do a &quot;quickie&quot; passthrough now to see how it is, and i got lots errors like these:</p><div class="codebox"><pre><code>[...]VFIO 0000:03:00.0 BAR 0 mmap unsupported. Performance may be slow [...]vfio_bar_read(,0x9080, 4) failed: Device or resource busy&quot; and &quot;vfio_bar_write(,0x9084, 0xffffff, 4) failed: Device or resource busy [...]vfio_bar_write(,0x9084, 0xffffff, 4) failed: Device or resource busy [dmesg:] [ 57.855348] systemd-journald[183]: /dev/kmsg buffer overrun, some messages lost. [ 57.855359] vfio-pci 0000:03:00.0: BAR 0: can&#039;t reserve [mem 0xd0000000-0xdfffffff 64bit pref] [ 57.857534] vfio-pci 0000:03:00.0: BAR 0: can&#039;t reserve [mem 0xd0000000-0xdfffffff 64bit pref]</code></pre></div><p>Sry have not investigated any further. Maybe i was doing something wrong. And/or this mobo i have (dx79to) has bios revisions which are total crap, all of them. <br />On this system i pass the nvidia and i dont do driver updates. On the other system with Z97 chipset the R9 270 is passed and i could say i am happier with that instead, costed ~50% less and benchmarks ~20% better, tho this is a subjective opinion.</p> <p class="postedit"><em>Last edited by noobman (2014-09-19 14:38:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458348">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458349" class="blockpost rowodd"> <h2><span><span class="conr">#2769</span> <a href="viewtopic.php?pid=1458349#p1458349">2014-09-19 14:44:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>So... just happened to get an update for Nvidia 344.11... Code 43 again <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I have no words...</p></div></blockquote></div><p>Then it looks like they are doing this on purpose? Couldnt be a coincidence could it?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458349">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458353" class="blockpost roweven"> <h2><span><span class="conr">#2770</span> <a href="viewtopic.php?pid=1458353#p1458353">2014-09-19 14:57:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>would it be too much of a trouble to ask you some more details on r7 240?<br />some points of special interest (r7 240 as passed gpu, not host one):<br /> - any problems with it so far? reboots or anything else<br /> - vendor/model/memory?<br /> - does it support UEFI boot (just firmware check would be enough in fact)?</p></div></blockquote></div><p>I have an HD8570 OEM card, which I think is effectively the same as the r7 240.&#160; It works well for me, no reset problem.&#160; It does report NoSoftRst-, which makes the vfio code attempting to reset the device on release not activate, even though PM reset itself doesn&#039;t seem to do anything.&#160; That just means if the VM is stopped rather than doing a clean shutdown, the last image on the screen remains (for now).&#160; The OEM card is not the highest quality, a little noisy, but I found that the fanless CoolViva Z1 can take care of that problem if you&#039;ve got the room.&#160; Yes, the OEM HD8570 supports UEFI.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458353">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458366" class="blockpost rowodd"> <h2><span><span class="conr">#2771</span> <a href="viewtopic.php?pid=1458366#p1458366">2014-09-19 15:51:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw, noobman:<br />thanks for the info.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>would it be too much of a trouble to ask you some more details on r7 240?<br />some points of special interest (r7 240 as passed gpu, not host one):<br /> - any problems with it so far? reboots or anything else<br /> - vendor/model/memory?<br /> - does it support UEFI boot (just firmware check would be enough in fact)?</p></div></blockquote></div><p>I have an HD8570 OEM card, which I think is effectively the same as the r7 240.&#160; It works well for me, no reset problem.&#160; It does report NoSoftRst-, which makes the vfio code attempting to reset the device on release not activate, even though PM reset itself doesn&#039;t seem to do anything.&#160; That just means if the VM is stopped rather than doing a clean shutdown, the last image on the screen remains (for now).&#160; The OEM card is not the highest quality, a little noisy, but I found that the fanless CoolViva Z1 can take care of that problem if you&#039;ve got the room.&#160; Yes, the OEM HD8570 supports UEFI.</p></div></blockquote></div><p>well, seems like i&#039;ll have to bet a bit and blindly try r7 240 of some vendor (no 8570 at my place at all)<br />was initially looking at nvidia cards, but all this driver absurd (not to mention that i never had success trying to passthrough gt 430)... &quot;nvidia, .uck you!&quot; (c) linus</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458366">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458369" class="blockpost roweven"> <h2><span><span class="conr">#2772</span> <a href="viewtopic.php?pid=1458369#p1458369">2014-09-19 16:07:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>@aw, noobman:<br />thanks for the info.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>would it be too much of a trouble to ask you some more details on r7 240?<br />some points of special interest (r7 240 as passed gpu, not host one):<br /> - any problems with it so far? reboots or anything else<br /> - vendor/model/memory?<br /> - does it support UEFI boot (just firmware check would be enough in fact)?</p></div></blockquote></div><p>I have an HD8570 OEM card, which I think is effectively the same as the r7 240.&#160; It works well for me, no reset problem.&#160; It does report NoSoftRst-, which makes the vfio code attempting to reset the device on release not activate, even though PM reset itself doesn&#039;t seem to do anything.&#160; That just means if the VM is stopped rather than doing a clean shutdown, the last image on the screen remains (for now).&#160; The OEM card is not the highest quality, a little noisy, but I found that the fanless CoolViva Z1 can take care of that problem if you&#039;ve got the room.&#160; Yes, the OEM HD8570 supports UEFI.</p></div></blockquote></div><p>well, seems like i&#039;ll have to bet a bit and blindly try r7 240 of some vendor (no 8570 at my place at all)<br />was initially looking at nvidia cards, but all this driver absurd (not to mention that i never had success trying to passthrough gt 430)... &quot;nvidia, .uck you!&quot; (c) linus</p></div></blockquote></div><p>Don&#039;t forget you can download ROMs from the TechPowerUp database and test them for UEFI support.&#160; This can at least provide some indication of which vendor to pick.</p><p>EDIT: to save you the trouble, there are only 3 ROMs listed for the R7 240 and only the VTX3D includes EFI support.&#160; That&#039;s certainly not definitive of the other vendors though.</p> <p class="postedit"><em>Last edited by aw (2014-09-19 16:09:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458369">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458430" class="blockpost rowodd"> <h2><span><span class="conr">#2773</span> <a href="viewtopic.php?pid=1458430#p1458430">2014-09-19 19:16:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I was researching that too, if anyone can confirm that the HD7790 has the reset problem, it might be affordable enough that I could pick one up for testing.</p></div></blockquote></div><p>Yes, the HD7790 has the reset problem.</p><p>My card is :<br /><a href="http://www.sapphiretech.com/presentation/product/?cid=1&amp;gid=3&amp;sgid=1159&amp;pid=1875&amp;psn=&amp;lid=1&amp;leg=0" rel="nofollow">http://www.sapphiretech.com/presentatio … id=1&amp;leg=0</a></p></div></blockquote></div><p>Does the Sapphire card have an EFI BIOS?</p></div></blockquote></div><p>No EFI BIOS.</p><p>See :</p><p><a href="https://www.sendspace.com/file/2mjmw8" rel="nofollow">https://www.sendspace.com/file/2mjmw8</a></p><div class="codebox"><pre class="vscroll"><code>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Bonaire XT [Radeon HD 7790/8770 / R9 260 OEM] (prog-if 00 [VGA controller]) Subsystem: PC Partner Limited / Sapphire Technology Radeon HD 7790 Dual-X OC Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B- DisINTx+ Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Interrupt: pin A routed to IRQ 51 Region 0: Memory at c0000000 (64-bit, prefetchable) [size=256M] Region 2: Memory at d0000000 (64-bit, prefetchable) [size=8M] Region 4: I/O ports at e000 [size=256] Region 5: Memory at f6100000 (32-bit, non-prefetchable) [size=256K] Expansion ROM at f6140000 [disabled] [size=128K] Capabilities: [48] Vendor Specific Information: Len=08 &lt;?&gt; Capabilities: [50] Power Management version 3 Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1+,D2+,D3hot+,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [58] Express (v2) Legacy Endpoint, MSI 00 DevCap: MaxPayload 256 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 unlimited ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable+ Non-Fatal+ Fatal+ Unsupported- RlxdOrd- ExtTag+ PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #0, Speed 8GT/s, Width x16, ASPM L0s L1, Exit Latency L0s &lt;64ns, L1 &lt;1us ClockPM- Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Not Supported, TimeoutDis-, LTR-, OBFF Not Supported DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled LnkCtl2: Target Link Speed: 8GT/s, EnterCompliance- SpeedDis- Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS- Compliance De-emphasis: -6dB LnkSta2: Current De-emphasis Level: -3.5dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Address: 00000000fee00718 Data: 0000 Capabilities: [100 v1] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150 v2] Advanced Error Reporting UESta: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UEMsk: DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol- UESvrt: DLP+ SDES+ TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol- CESta: RxErr- BadTLP- BadDLLP- Rollover+ Timeout+ NonFatalErr- CEMsk: RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr- AERCap: First Error Pointer: 00, GenCap+ CGenEn- ChkCap+ ChkEn- Capabilities: [270 v1] #19 Capabilities: [2b0 v1] Address Translation Service (ATS) ATSCap: Invalidate Queue Depth: 00 ATSCtl: Enable-, Smallest Translation Unit: 00 Capabilities: [2c0 v1] #13 Capabilities: [2d0 v1] #1b Kernel driver in use: vfio-pci Kernel modules: radeon</code></pre></div> <p class="postedit"><em>Last edited by anickname (2014-09-19 19:25:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458430">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458552" class="blockpost roweven"> <h2><span><span class="conr">#2774</span> <a href="viewtopic.php?pid=1458552#p1458552">2014-09-20 00:56:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>So... just happened to get an update for Nvidia 344.11... Code 43 again <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I have no words...</p></div></blockquote></div><p>&quot;bluebird&quot; reported on oftc/#qemu that 344.11 is now checking hyper-v extensions, so if you remove all those hv-foo cpu parameters and leave kvm=off, 344.11 works.&#160; I&#039;ve confirmed this on my VM.&#160; Unfortunately some of those hypver-v extensions are fairly useful and have shown to help performance, so NVIDIA appears to be intentionally crippling GeForce, possibly to make Quadro appear to be a better choice for a VM (as if official support isn&#039;t enough).&#160; NVIDIA already seems to disable MSI on GeForce, so it&#039;s not the first time GeForce has been intentionally crippled to boost the professional cards.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458552">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1458654" class="blockpost rowodd"> <h2><span><span class="conr">#2775</span> <a href="viewtopic.php?pid=1458654#p1458654">2014-09-20 12:37:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85250">stokbaek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-20</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:stokbaek@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I have been trying to get this VGA Passthrough to work now for some time but seems like I am stuck now <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>When I try to start the VM will it open in a QEMU window and the terminal will say:</p><div class="codebox"><pre><code>qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.1, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.1, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.0, no available reset mechanism.</code></pre></div><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.9.3-030903-generic root=UUID=8c0763f7-e4c0-4b58-80e3-6db2416ea751 ro quiet splash intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>lspci -nn | grep NVIDIA</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 760] [10de:1187] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK106 [GeForce GTX 660] [10de:11c0] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK106 HDMI Audio Controller [10de:0e0b] (rev a1)</code></pre></div><p>dmesg | grep pci-stub</p><div class="codebox"><pre><code>[ 0.500541] pci-stub: add 10DE:1187 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.500549] pci-stub 0000:01:00.0: claimed by stub [ 0.500556] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.500559] pci-stub 0000:01:00.1: claimed by stub</code></pre></div><p>Any help would be greatly appreciated</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1458654">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=110">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <strong>111</strong> <a href="viewtopic.php?id=162768&amp;p=112">112</a> <a href="viewtopic.php?id=162768&amp;p=113">113</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=112">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
