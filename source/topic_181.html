<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 181) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=181" title="Page 181" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=180" title="Page 180" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=182" title="Page 182" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=180">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <a href="viewtopic.php?id=162768&amp;p=180">180</a> <strong>181</strong> <a href="viewtopic.php?id=162768&amp;p=182">182</a> <a href="viewtopic.php?id=162768&amp;p=183">183</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=182">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1511922" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4501</span> <a href="viewtopic.php?pid=1511922#p1511922">2015-03-17 18:48:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I think you have few options. You could use intel gpu for host and bind both cards and use them with guest. You can also use xen i guess xen 4.5 package will be out in aur soon. xen does not care about acs as much as kvm does.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511922">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511924" class="blockpost roweven"> <h2><span><span class="conr">#4502</span> <a href="viewtopic.php?pid=1511924#p1511924">2015-03-17 18:53:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>I&#039;ve been struggling with VGA passthrough for a few days and finally got something that works but unfortunately not in an optimal way. My plan was to use a radeon juniper card in guest and a radeon cedar card on host. The problem is that the hardware manufacturer for my cpu decided in their wisdom to not support ACS on the pcie root port.<br />Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01]<br />Both graphic card therefore show up in the same iommu group. What options do I have for working around that problem?</p><p>Option 1: Use the ACS override patch and hope for the best.<br />Not a good idea in my opinion. I&#039;m pretty sure the root port do per-to-per without any way of disabling that. Using the override patch is asking for problems.</p><p>Options 2: Rearrange the card to break apart the iommu group.<br />Unfortunately all 16X lanes go to the cpu through that root port. The 1X ports go through the chipset but I don&#039;t have any 1X graphics card. I could buy one but the selection is VERY limited. The only one I found only supports 2 monitors. I could do surgery on the 1X mobo slot or my 16X cedar graphics card to force it in but that not something I want to do.<br /><a href="http://i.imgur.com/NxzaK6L.png" rel="nofollow">http://i.imgur.com/NxzaK6L.png</a> block diagram of my mobo. (Let&#039;s see if I&#039;m allowed to post a link in my first post to this forum)</p><p>Option 3: Buy a new mobo<br />please no...</p><p>Option 4: Use the intel IGP for host graphics and non-legacy guest boot for working around the problems in IGP<br />My juniper card does not support EFI boot. I&#039;ve seen some people do Macgyver style mods involving copy paste in hexeditors with other card&#039;s vbios. That is something I would like to avoid if possible.</p><p>Option 5: Use the intel IGP with the vga arbiter patch<br />That is what I&#039;m using right now for testing but it&#039;s not a longterm solution. It&#039;s too inconvenient to apply a patch at every kernel update.</p><p>Strangely DRI is not disabled for me even with the vga arbiter patch. I assume I screwed up somewhere but I don&#039;t know where. The old patch submitted to the LKML doesn&#039;t apply on new kernels anymore. There is another patch named i915_317.patch that do apply to 3.19.1 with some fuss. I boot with the i915.enable_hd_vgaarb=1 argument and verify that argument is on with dmesg but I still get DRI.</p></div></blockquote></div><p>You seem to have a good grasp of the options.&#160; Personally I&#039;d opt for using IGD for the host and replacing your guest card with one that supports UEFI.&#160; You seem to be averse to the VGA BIOS hacking route, but that&#039;s actually one that&#039;s likely to continue working once you figure it out, with no future i915 kernel patching.&#160; Remember you don&#039;t need to flash the card with the new ROM, you can use an external file as the ROM for the VM.&#160; If you&#039;re willing to settle for a x1 graphics card, you can find x1-to-x16 adapters that will allow you to plug any low-profile x16 card into the x1 slot.&#160; Double check your Xorg.0.log for DRI, DRI3 may still be enabled, but DRI2 has arbiter issues... don&#039;t ask me what the difference is, I don&#039;t know.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511924">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511940" class="blockpost rowodd"> <h2><span><span class="conr">#4503</span> <a href="viewtopic.php?pid=1511940#p1511940">2015-03-17 20:33:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53503">VOT Productions</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-22</span></dd> <dd><span>Posts: 47</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:votproductions@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, I&#039;m still stuck with the Starting Windows screen when loading the installer, is my QEMU command right? (the paths are correct)</p><div class="codebox"><pre><code>env QEMU_PA_SAMPLES=128 env QEMU_AUDIO_DRV=pa sudo qemu-system-x86_64 \ -enable-kvm -m 4096 -cpu host,kvm=off -smp cores=4,threads=1 \ -pflash /usr/share/ovmf/x64/ovmf_x64.bin \ -vga none \ -soundhw hda \ -device vfio-pci,host=01:00.0,multifunction=on \ -device vfio-pci,host=01:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/mnt/1TB_LinuxMedia/windows.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/mnt/1TB_LinuxMedia/windows.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/mnt/1TB_LinuxMedia/virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -usb -usbdevice host:04d9:a055 -usbdevice host:04d9:a04a \ -boot menu=on</code></pre></div> <p class="postedit"><em>Last edited by VOT Productions (2015-03-17 20:49:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511940">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511963" class="blockpost roweven"> <h2><span><span class="conr">#4504</span> <a href="viewtopic.php?pid=1511963#p1511963">2015-03-17 21:40:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I found out that my quests run better under libvirt. I had my system freeze when left unattended. No I can leave it unattended&#160; for days without single lockup.<br />I think options help&#160; <br />&lt;hyperv&gt;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;vapic state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt;<br />&#160; &#160; &lt;/hyperv&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt;<br />&#160; &#160; &lt;model fallback=&#039;allow&#039;&gt;Opteron_G5&lt;/model&gt;<br />&#160; &lt;/cpu&gt;<br />&#160; &lt;clock offset=&#039;localtime&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;<br />&#160; &lt;/clock&gt;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511963">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511964" class="blockpost rowodd"> <h2><span><span class="conr">#4505</span> <a href="viewtopic.php?pid=1511964#p1511964">2015-03-17 21:41:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How do I ssetup secure boot for windows 8.1 ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511964">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1511997" class="blockpost roweven"> <h2><span><span class="conr">#4506</span> <a href="viewtopic.php?pid=1511997#p1511997">2015-03-17 23:30:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89622">Draizer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone.</p><p>I followed the first part of this (excellent) guide thoroughly up to the part where I have to test output in bios, unfortunately it yielded no results. Repo QEMU shows a console, qemu-git only shows a menubar and nothing else. The vga arbiter is activated (before I activated it, I had a blank QEMU and glitchy graphics on the host once I started QEMU, after I activated it ... QEMU was still blank but at least my host didn&#039;t have glitches anymore), as is ACS override (tried both with and without). I tried rebuilding the kernel multiple times, with different Linux versions (3.9, 3.7, neither worked, I&#039;m currently back to the kernel made by the OP). Triple checked if VT-d was activated on the motherboard, it is. Bindings seems correct as well. I uninstalled the radeon drivers, but still kept them blacklisted and bound the devices to stub just to be sure. I tried both with the i440fx and Q35 chipset. I tried to use the manipulation suggested if nothing happened. I browsed this thread and others on the web through and through, and the only mentions of troubles that remotely looked like mine were because the vga arbiter wasn&#039;t activated, which isn&#039;t my case. I&#039;m basically at my wits ends, which is why I&#039;m finally posting here.</p><p>My hardware : <br />-Intel Core i7 3770<br />-ASrock Z77 Extreme6<br />-Host GPU : Intel IGD<br />-Guest GPU : ATI Radeon 7970</p><br /><p>I&#039;m not sure if it is related, but dmesg brings the following error messages: </p><div class="codebox"><pre><code>[drm:ivybridge_set_fifo_underrun_reporting] *ERROR* uncleared fifo underrun on pipe B [drm:ivb_err_int_handler] *ERROR* Pipe B FIFO underrun [drm:cpt_set_fifo_underrun_reporting] *ERROR* uncleared pch fifo underrun on pch transcoder A [drm:cpt_serr_int_handler] *ERROR* PCH transcoder A FIFO underrun [drm:cpt_set_fifo_underrun_reporting] *ERROR* uncleared pch fifo underrun on pch transcoder B [drm:cpt_serr_int_handler] *ERROR* PCH transcoder B FIFO underrun</code></pre></div><p>Didn&#039;t find anything helpful on this, either.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1511997">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512040" class="blockpost rowodd"> <h2><span><span class="conr">#4507</span> <a href="viewtopic.php?pid=1512040#p1512040">2015-03-18 04:44:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73469">Evonat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-24</span></dd> <dd><span>Posts: 12</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>One year and a half after I abandoned <a href="https://bbs.archlinux.org/viewtopic.php?pid=1310511#p1310511" rel="nofollow">my attempt</a> I&#039;m back at it again, and of course it still doesn&#039;t fully work!<br />Or actually, everything seems to work fine once, then if the VM reboots/closes and opens again, the screen stays black.<br />In other words it looks like that old VFIO VGA reset problem for which there used to be some patches, now gone because it was supposed to be solved(?).</p><p>I&#039;m using a linux-3.18 kernel patched with override_for_missing_acs_capabilities.patch (pci-stub.ids=1002:94b3,1002:aa38 pcie_acs_override=downstream) and QEMU 2.2.1.<br />I get no errors with QEMU or dmesg. The thing simply works the first time and the first time only, then I have to restart the host to get it to work again.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512040">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512051" class="blockpost roweven"> <h2><span><span class="conr">#4508</span> <a href="viewtopic.php?pid=1512051#p1512051">2015-03-18 07:22:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75818">ceri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 44</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just found out there&#039;s now a wiki page for this, however it&#039;s incomplete and requires more contributors (if you have time):</p><p><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF" rel="nofollow">https://wiki.archlinux.org/index.php/PC … h_via_OVMF</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512065" class="blockpost rowodd"> <h2><span><span class="conr">#4509</span> <a href="viewtopic.php?pid=1512065#p1512065">2015-03-18 10:08:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87484">kainet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-22</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:bart47@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Again experiencing sound stuttering when gpu is pretty loaded <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> MSI GTX 760</p><br /><p>Some times waiting for some times helps to get back normal sound but i usually disable and enable audio device in Windows guest. Anybody knows which part of software is responsible for that ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512065">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512192" class="blockpost roweven"> <h2><span><span class="conr">#4510</span> <a href="viewtopic.php?pid=1512192#p1512192">2015-03-18 17:43:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How I can get sound using libvirt. I can hear sound if I use spice client but there is no sound from guest to alsa.</p><p>I see option like this:<br />The VM definition xml contains the following <br />&lt;qemu:commandline&gt;<br />&lt;qemu:env name=&#039;QEMU_ALSA_DAC_BUFFER_SIZE&#039; value=&#039;512&#039;/&gt;<br />&lt;qemu:env name=&#039;QEMU_ALSA_DAC_PERIOD_SIZE&#039; value=&#039;170&#039;/&gt;<br />&lt;qemu:env name=&#039;QEMU_AUDIO_DRV&#039; value=&#039;alsa&#039;/&gt;<br />&lt;/qemu:commandline&gt;</p> <p class="postedit"><em>Last edited by tritron4 (2015-03-18 18:23:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512192">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512224" class="blockpost rowodd"> <h2><span><span class="conr">#4511</span> <a href="viewtopic.php?pid=1512224#p1512224">2015-03-18 19:04:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Try my theory - fetching the drivers for GPU before the install. Some OEMs do that, so there&#039;s definitely a way to do this. But it seems like windowns 7 can not into UEFI at all.</p></div></blockquote></div><p>Thinking about that, the first approach I would try is figuring out if a driver is making that call during the install step, then replacing that driver with something that didn&#039;t make that call. On one of my notes I remember CLASSPNP.SYS causing lots of hangs when trying safe modes and such... I&#039;ll dig in a bit more.</p></div></blockquote></div><p>Nothing came up as far as patching win7&#039;s graphics system, maybe next I could try ripping win8&#039;s graphics system and force it into win7?</p><p>On a side note, I have a working win8 now. It hangs at shutdown, I have to issue &#039;quit&#039; in the qemu terminal, but windows doesn&#039;t complain about getting a bad shutdown.&#160; I&#039;ve tried disabling the power service in windows but that didn&#039;t do anything. Anyone else have experience with that?</p><p>Also, it was recommended I post this here: <a href="https://bbs.archlinux.org/viewtopic.php?id=194060" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=194060</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512224">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512235" class="blockpost roweven"> <h2><span><span class="conr">#4512</span> <a href="viewtopic.php?pid=1512235#p1512235">2015-03-18 19:31:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>How do I ssetup secure boot for windows 8.1 ?</p></div></blockquote></div><p><a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">http://www.linux-kvm.org/downloads/lers … 770f8c.txt</a></p><div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p>(6) Additionally, the &quot;edk2.git-ovmf-x64&quot; package seeks to simplify the<br />&#160; &#160; enablement of Secure Boot in a virtual machine (strictly for development<br />&#160; &#160; and testing purposes)</p><p>&#160; &#160; - Boot the virtual machine off the CD-ROM image called<br />&#160; &#160; &#160; &quot;/usr/share/edk2.git/ovmf-x64/UefiShell.iso&quot;; before or after installing<br />&#160; &#160; &#160; the main guest operating system.</p><p>&#160; &#160; - When the UEFI shell appears, issue the following commands:</p><p>&#160; &#160; &#160; EnrollDefaultKeys.efi<br />&#160; &#160; &#160; reset -s</p></div></blockquote></div> <p class="postedit"><em>Last edited by Duelist (2015-03-18 19:31:57)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512235">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512239" class="blockpost rowodd"> <h2><span><span class="conr">#4513</span> <a href="viewtopic.php?pid=1512239#p1512239">2015-03-18 19:42:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Try my theory - fetching the drivers for GPU before the install. Some OEMs do that, so there&#039;s definitely a way to do this. But it seems like windowns 7 can not into UEFI at all.</p></div></blockquote></div><p>Thinking about that, the first approach I would try is figuring out if a driver is making that call during the install step, then replacing that driver with something that didn&#039;t make that call. On one of my notes I remember CLASSPNP.SYS causing lots of hangs when trying safe modes and such... I&#039;ll dig in a bit more.</p></div></blockquote></div><p>Nothing came up as far as patching win7&#039;s graphics system, maybe next I could try ripping win8&#039;s graphics system and force it into win7?</p><p>Also, it was recommended I post this here: <a href="https://bbs.archlinux.org/viewtopic.php?id=194060" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=194060</a></p></div></blockquote></div><p>Seems like you&#039;ve missed some recent news about windows7:<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1511290#p1511290" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1511290</a><br />lersek has joined us and said that there&#039;s a FIX for win7 VM.<br />There&#039;s a whitepaper published here:<br /><a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">http://www.linux-kvm.org/downloads/lers … 770f8c.txt</a></p><p>And he also edited the wiki page of yours.</p><p>BTW: originally i&#039;ve meant some way of tearing and ripping of win8&#039;s video drivers and shove them up win7. Yes, that sounds awful. That&#039;s the idea.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-18 22:39:54)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512239">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512335" class="blockpost roweven"> <h2><span><span class="conr">#4514</span> <a href="viewtopic.php?pid=1512335#p1512335">2015-03-19 05:14:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Any possible way to &quot;inject&quot; UEFI support inside non-UEFI ROMs ?</p><p>I have a GT630 , which has a non-UEFI ROM , yet I found some ROMs from other vendors that have UEFI ROMs (techpowerup) which don&#039;t work directly on my GPU .</p><p>It is possible to insert the UEFI partition for some Radeons using a hex editor . How about NVIDIA ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512335">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512359" class="blockpost rowodd"> <h2><span><span class="conr">#4515</span> <a href="viewtopic.php?pid=1512359#p1512359">2015-03-19 10:00:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p> How about NVIDIA ?</p></div></blockquote></div><p>Weird. I have gigabyte GT610 which supports UEFI perfectly..<br />Anyway, try searching for NVidia&#039;s GOP technical presentations and etc - i&#039;ve found one for AMD dating back to 2010, i think, saying &quot;there will be an universal GOP for all cards&quot;. That presentation just proved the idea of copying GOP from one&#039;s GPU to another.</p><p>Also, try writing a support ticket to your hardware&#039;s vendor - in my ASUS case it just cleared up some things. But actually, they have an official update tool(which requires windowns installed..).</p><p>Also, maybe you just haven&#039;t got enough luck, since some nvidia cards may be converted to quadro just by firmware change.</p><p>You can also dump all UEFI-compatible ROMs from DB and try ripping uncompressed EFI driver same way we did it for AMD, it may suddenly be universal for all vendors and containing only GOP without any important bits. Supplying it as romfile= option will be a safe way of testing it out. The resulting file from firmware should be .efi image, you glue it with your normal vbios same way as AMD, using EfiRom(a tool from EDK2 btw). I don&#039;t recall properly, but i think EfiRom utility could decompress that efi image from ROM..</p><p>P.S. it wasn&#039;t a hex editor, it&#039;s an Elegant Weapon for a More Civilized Age of UEFI.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-19 10:02:48)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512359">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512378" class="blockpost roweven"> <h2><span><span class="conr">#4516</span> <a href="viewtopic.php?pid=1512378#p1512378">2015-03-19 11:58:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89614">tholin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You seem to have a good grasp of the options.&#160; Personally I&#039;d opt for using IGD for the host and replacing your guest card with one that supports UEFI.&#160; You seem to be averse to the VGA BIOS hacking route, but that&#039;s actually one that&#039;s likely to continue working once you figure it out, with no future i915 kernel patching.&#160; Remember you don&#039;t need to flash the card with the new ROM, you can use an external file as the ROM for the VM.&#160; If you&#039;re willing to settle for a x1 graphics card, you can find x1-to-x16 adapters that will allow you to plug any low-profile x16 card into the x1 slot.&#160; Double check your Xorg.0.log for DRI, DRI3 may still be enabled, but DRI2 has arbiter issues... don&#039;t ask me what the difference is, I don&#039;t know.</p></div></blockquote></div><p>I&#039;ve been using the IGD for a few days and realized the drivers are too buggy for daily use. Maybe it&#039;s related to the i915 patch but many other people have the same problems. To be fair the open radeon drivers also got a lot of problems but I&#039;m used to them and know how to work around the problems. I ordered that 1X radeon card instead.</p><p>It looks like dri2 is enabled. Here are some parts of Xorg.log</p><div class="codebox"><pre class="vscroll"><code>[ 188.603] (II) xfree86: Adding drm device (/dev/dri/card0) [ 188.604] (--) PCI:*(0:0:2:0) 8086:0412:1458:d000 rev 6, Mem @ 0xf7400000/4194304, 0xc0000000/268435456, I/O @ 0x0000f000/64 [ 188.604] (--) PCI: (0:3:0:0) 1002:68f9:174b:e153 rev 0, Mem @ 0xe0000000/268435456, 0xf7920000/131072, I/O @ 0x0000a000/256, BIOS @ 0x????????/131072 [ 188.604] (--) PCI: (0:4:0:0) 1002:68ba:1458:220c rev 0, Mem @ 0xd0000000/268435456, 0xf7820000/131072, I/O @ 0x00009000/256, BIOS @ 0x????????/131072 ... [ 188.618] (II) LoadModule: &quot;intel&quot; [ 188.618] (II) Loading /usr/lib64/xorg/modules/drivers/intel_drv.so [ 188.620] (II) Module intel: vendor=&quot;X.Org Foundation&quot; [ 188.620] compiled for 1.16.4, module version = 2.99.917 [ 188.620] Module class: X.Org Video Driver [ 188.620] ABI class: X.Org Video Driver, version 18.0 [ 188.620] (II) intel: Driver for Intel(R) Integrated Graphics Chipsets: i810, i810-dc100, i810e, i815, i830M, 845G, 854, 852GM/855GM, 865G, 915G, E7221 (i915), 915GM, 945G, 945GM, 945GME, Pineview GM, Pineview G, 965G, G35, 965Q, 946GZ, 965GM, 965GME/GLE, G33, Q35, Q33, GM45, 4 Series, G45/G43, Q45/Q43, G41, B43 [ 188.620] (II) intel: Driver for Intel(R) HD Graphics: 2000-6000 [ 188.620] (II) intel: Driver for Intel(R) Iris(TM) Graphics: 5100, 6100 [ 188.620] (II) intel: Driver for Intel(R) Iris(TM) Pro Graphics: 5200, 6200, P6300 [ 188.620] (++) using VT number 7 [ 188.626] (II) intel(0): Using Kernel Mode Setting driver: i915, version 1.6.0 20141121 [ 188.627] (--) intel(0): Integrated Graphics Chipset: Intel(R) HD Graphics 4600 [ 188.627] (--) intel(0): CPU: x86-64, sse2, sse3, ssse3, sse4.1, sse4.2, avx, avx2 [ 188.627] (II) intel(0): Creating default Display subsection in Screen section &quot;Default Screen Section&quot; for depth/fbbpp 24/32 [ 188.628] (==) intel(0): Depth 24, (--) framebuffer bpp 32 [ 188.628] (==) intel(0): RGB weight 888 [ 188.628] (==) intel(0): Default visual is TrueColor [ 188.628] (**) intel(0): Option &quot;TearFree&quot; &quot;true&quot; [ 188.628] (II) intel(0): Output VGA1 has no monitor section [ 188.628] (II) intel(0): Enabled output VGA1 [ 188.628] (II) intel(0): Output HDMI1 has no monitor section [ 188.628] (II) intel(0): Enabled output HDMI1 [ 188.628] (II) intel(0): Output HDMI2 has no monitor section [ 188.628] (II) intel(0): Enabled output HDMI2 [ 188.628] (II) intel(0): Output DP1 has no monitor section [ 188.628] (II) intel(0): Enabled output DP1 [ 188.628] (II) intel(0): Output HDMI3 has no monitor section [ 188.628] (II) intel(0): Enabled output HDMI3 [ 188.628] (--) intel(0): Using a maximum size of 256x256 for hardware cursors [ 188.628] (II) intel(0): Output VIRTUAL1 has no monitor section [ 188.628] (II) intel(0): Enabled output VIRTUAL1 [ 188.628] (--) intel(0): Output HDMI2 using initial mode 1920x1200 on pipe 0 [ 188.628] (--) intel(0): Output DP1 using initial mode 1920x1200 on pipe 1 [ 188.628] (**) intel(0): TearFree enabled [ 188.628] (==) intel(0): DPI set to (96, 96) [ 188.628] (II) Loading sub module &quot;dri2&quot; [ 188.628] (II) LoadModule: &quot;dri2&quot; [ 188.628] (II) Module &quot;dri2&quot; already built-in [ 188.628] (II) Loading sub module &quot;present&quot; [ 188.628] (II) LoadModule: &quot;present&quot; [ 188.628] (II) Module &quot;present&quot; already built-in [ 188.628] (==) Depth 24 pixmap format is 32 bpp [ 188.630] (II) intel(0): SNA initialized with Haswell (gen7.5, gt2) backend [ 188.630] (==) intel(0): Backing store enabled [ 188.630] (==) intel(0): Silken mouse enabled [ 188.631] (II) intel(0): HW Cursor enabled [ 188.631] (II) intel(0): RandR 1.2 enabled, ignore the following RandR disabled message. [ 188.631] (==) intel(0): DPMS enabled [ 188.631] (==) intel(0): display hotplug detection enabled [ 188.631] (II) intel(0): [DRI2] Setup complete [ 188.631] (II) intel(0): [DRI2] DRI driver: i965 [ 188.631] (II) intel(0): [DRI2] VDPAU driver: i965 [ 188.631] (II) intel(0): direct rendering: DRI2 enabled [ 188.631] (II) intel(0): hardware support for Present enabled [ 188.631] (--) RandR disabled [ 188.631] (II) Found 3 VGA devices: arbiter wrapping enabled [ 188.651] (II) AIGLX: enabled GLX_MESA_copy_sub_buffer [ 188.651] (II) AIGLX: enabled GLX_ARB_create_context [ 188.651] (II) AIGLX: enabled GLX_ARB_create_context_profile [ 188.651] (II) AIGLX: enabled GLX_EXT_create_context_es2_profile [ 188.651] (II) AIGLX: enabled GLX_INTEL_swap_event [ 188.651] (II) AIGLX: enabled GLX_SGI_swap_control and GLX_MESA_swap_control [ 188.651] (II) AIGLX: enabled GLX_EXT_framebuffer_sRGB [ 188.651] (II) AIGLX: enabled GLX_ARB_fbconfig_float [ 188.651] (II) AIGLX: GLX_EXT_texture_from_pixmap backed by buffer objects [ 188.651] (II) AIGLX: enabled GLX_ARB_create_context_robustness [ 188.651] (II) AIGLX: Loaded and initialized i965 [ 188.651] (II) GLX: Initialized DRI2 GL provider for screen 0 [ 188.653] (II) intel(0): switch to mode 1920x1200@60.0 on HDMI2 using pipe 0, position (0, 0), rotation normal, reflection none [ 188.667] (II) intel(0): switch to mode 1920x1200@60.0 on DP1 using pipe 1, position (0, 0), rotation normal, reflection none [ 188.677] (II) intel(0): Setting screen physical size to 508 x 317</code></pre></div><br /><p>Like most people her I&#039;m having difficulty with sound. The hda hardware doesn&#039;t work at all and the ac79 got some crackling noise.<br />I&#039;ve tried to play around with the qemu options but it doesn&#039;t make any difference. Even the QEMU_AUDIO_DRV=wav backend crackle. There is no crackle when playing steam trailers or music with audio players. I&#039;m guessing games use a smaller audio buffer and are more susceptible.</p><p>I&#039;ve tried forwarding my onboard mobo audio but it was never even detected. Has anyone got that to work? Last resort would be to buy an usb soundcard and forward that but I don&#039;t want to buy hardware to work around bugs in qemu.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512378">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512407" class="blockpost rowodd"> <h2><span><span class="conr">#4517</span> <a href="viewtopic.php?pid=1512407#p1512407">2015-03-19 14:41:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p> How about NVIDIA ?</p></div></blockquote></div><p>Weird. I have gigabyte GT610 which supports UEFI perfectly..<br />Anyway, try searching for NVidia&#039;s GOP technical presentations and etc - i&#039;ve found one for AMD dating back to 2010, i think, saying &quot;there will be an universal GOP for all cards&quot;. That presentation just proved the idea of copying GOP from one&#039;s GPU to another.</p><p>Also, try writing a support ticket to your hardware&#039;s vendor - in my ASUS case it just cleared up some things. But actually, they have an official update tool(which requires windowns installed..).</p><p>Also, maybe you just haven&#039;t got enough luck, since some nvidia cards may be converted to quadro just by firmware change.</p><p>You can also dump all UEFI-compatible ROMs from DB and try ripping uncompressed EFI driver same way we did it for AMD, it may suddenly be universal for all vendors and containing only GOP without any important bits. Supplying it as romfile= option will be a safe way of testing it out. The resulting file from firmware should be .efi image, you glue it with your normal vbios same way as AMD, using EfiRom(a tool from EDK2 btw). I don&#039;t recall properly, but i think EfiRom utility could decompress that efi image from ROM..</p><p>P.S. it wasn&#039;t a hex editor, it&#039;s an Elegant Weapon for a More Civilized Age of UEFI.</p></div></blockquote></div><p>You are right , I have a GT610 too which has a UEFI ROM . But this new GT630 doesn&#039;t . </p><p>The card is from a vendor called &quot;Point of View&quot; , I&#039;ll try sending them a UEFI ROM request .</p><p>I did try ripping the UEFI partition from some ROMs I found in TPU , but that didn&#039;t succeed . Even AW&#039;s rom-parser didn&#039;t pick up the UEFI bits <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512407">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512435" class="blockpost roweven"> <h2><span><span class="conr">#4518</span> <a href="viewtopic.php?pid=1512435#p1512435">2015-03-19 16:19:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p> Even AW&#039;s rom-parser didn&#039;t pick up the UEFI bits <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>Well, EfiRom will tell you something very alike. If AW&#039;s parser doesn&#039;t recognise any EFI drivers in ROM - then there is no EFI support in this ROM. At all.<br />Only one detail applies: nvidia cards sometimes have &quot;pre-post rom&quot;. Adjust your plans accordingly.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512435">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512494" class="blockpost rowodd"> <h2><span><span class="conr">#4519</span> <a href="viewtopic.php?pid=1512494#p1512494">2015-03-19 19:28:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><strong>Duelist strikes a menacing pose.</strong></p><p>Laszlo, you are awesome. OVMF is awesome. Everything is awesome.</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; id=&#039;10&#039;&gt; &lt;name&gt;vm1&lt;/name&gt; &lt;uuid&gt;f6958833-174f-44e6-817b-2a6c73c6f041&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/loader&gt; &lt;nvram&gt;/var/lib/libvirt/qemu/nvram/vm1_VARS.fd&lt;/nvram&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/mnt/hdd/qemu/windows7.iso&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;alias name=&#039;ide0-0-1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/mnt/hdd/qemu/virtio.iso&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;alias name=&#039;ide0-1-0&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/usr/share/edk2.git/ovmf-x64/UefiShell.iso&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;alias name=&#039;ide0-1-1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sda&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;alias name=&#039;virtio-disk0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0c&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;&gt; &lt;alias name=&#039;pci.0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;ide0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;virtio-serial0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:f0:d5:39&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;target dev=&#039;vnet0&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;alias name=&#039;net0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;source path=&#039;/dev/pts/2&#039;/&gt; &lt;target port=&#039;0&#039;/&gt; &lt;alias name=&#039;serial0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039; tty=&#039;/dev/pts/2&#039;&gt; &lt;source path=&#039;/dev/pts/2&#039;/&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;alias name=&#039;serial0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;alias name=&#039;channel0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;mouse&#039; bus=&#039;usb&#039;&gt; &lt;alias name=&#039;input0&#039;/&gt; &lt;/input&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;5900&#039; autoport=&#039;yes&#039; listen=&#039;127.0.0.1&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;127.0.0.1&#039;/&gt; &lt;/graphics&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;alias name=&#039;sound0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; heads=&#039;1&#039;/&gt; &lt;alias name=&#039;video0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev0&#039;/&gt; &lt;rom bar=&#039;on&#039; file=&#039;/mnt/hdd/qemu/hybridmagic.rom&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev2&#039;/&gt; &lt;rom bar=&#039;on&#039; file=&#039;/mnt/hdd/qemu/hybridmagic.rom&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev3&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;alias name=&#039;redir0&#039;/&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;alias name=&#039;redir1&#039;/&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;alias name=&#039;balloon0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;dynamic&#039; model=&#039;selinux&#039; relabel=&#039;yes&#039;&gt; &lt;label&gt;system_u:system_r:svirt_t:s0:c624,c898&lt;/label&gt; &lt;imagelabel&gt;system_u:object_r:svirt_image_t:s0:c624,c898&lt;/imagelabel&gt; &lt;/seclabel&gt; &lt;/domain&gt;</code></pre></div><p>So, how did it go:<br />1. QXL graphics came online, i did all the installation tasks via QXL.<br />2. I tried to install AMD drivers for win8.1 on win7 and it didn&#039;t work, showing code 10 on both GPUs.<br />3. But then.. DL&#039;ed win7 drivers and after a bootup logo(which is dublicated on the physical screen alike tianocore logo and OVMF menus) QXL screen froze...<br />4. In the beginning there was silence and darkness all across the world; Then came the Cursor and a loading screen...<br />5. Windows popped up a message about turning QXL off, and QXL became code-10&#039;d, both GPUs code 0.<br />6. It&#039;s safe to get rid of QXL, <strong>but</strong> Spice won&#039;t work, libvirt won&#039;t provide a surface for input grabbing purposes.</p><p>Seems like finally libvirt+crossfire+windows7+vfio got along with each other. There&#039;s some issues left with the setup, namely disk performance(and safety too), cpu pinning and input, but otherwise it&#039;s fine. And there&#039;s a bunch of unneeded devices and disk attached.</p><p>UPD:<br />Benchmarks show negligible performance hit in furmark, otherwise system works as usual and very similar to bare metal setup. I wonder if i can actually boot this in bare metal, since i&#039;m using the most crazy way of managing disks: whole /dev/sda to the VM.</p><p>UPD2:<br />There&#039;s some sound issues, as my sound just falls off VM. It works, VM reboot and there&#039;s no sound device anymore. But i&#039;m more worried about strange shutdown behavior:<br />Windowns 7 starts shutting itself down, kills explorer and stuff, and stops. I have a wallpaper, a mouse cursor which i can move, but nothing else happens. And it also boots very slowly, i guess there&#039;s something to do with the disk access.<br />If i force it off, on next boot it stalls at boot, refusing to execute OVMF at least.<br />Only rebooting the host helps. There&#039;s nothing related to GPUs in dmesg, so i assume it&#039;s libvirt trickery that fails to work.<br />GPU reset problems? Huh? Why?.. It was working fine with that before when i used qemu without libvirt.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-20 17:13:44)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512494">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512694" class="blockpost roweven"> <h2><span><span class="conr">#4520</span> <a href="viewtopic.php?pid=1512694#p1512694">2015-03-20 13:39:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How did you get Win7 to even load with more than 1 CPU with EFI boot? What is QXL?</p><p>My install would just freeze when the initial Windows Logo would appear after loading all the setup files (Black screen and bar loading on bottom).</p><p>Edit: Went back one page and found the post by Lersek: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1511585#p1511585" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 5#p1511585</a></p> <p class="postedit"><em>Last edited by The_Moves (2015-03-20 14:11:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512694">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512750" class="blockpost rowodd"> <h2><span><span class="conr">#4521</span> <a href="viewtopic.php?pid=1512750#p1512750">2015-03-20 17:12:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><p>How did you get Win7 to even load with more than 1 CPU with EFI boot? What is QXL?</p><p>My install would just freeze when the initial Windows Logo would appear after loading all the setup files (Black screen and bar loading on bottom).</p><p>Edit: Went back one page and found the post by Lersek: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1511585#p1511585" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 5#p1511585</a></p></div></blockquote></div><p>Actually...<br /><a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">http://www.linux-kvm.org/downloads/lers … 770f8c.txt</a><br />Read all posts by lersek - he(and a bunch of other guys) develops OVMF. I mean, when we had initial troubles with VFIO, we asked alex(aw) for help, because he wrote it. Now we had problems with OVMF, and here he comes and explains it all.</p><p>I think, btw, his very first post and OVMF&#039;s whitepaper should be pinned into op-post, just for overall awareness.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512750">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512768" class="blockpost roweven"> <h2><span><span class="conr">#4522</span> <a href="viewtopic.php?pid=1512768#p1512768">2015-03-20 18:19:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Did anyone got sound working well using qemu emulation.<br />I removed spice display and vga emulated driver and I only use assigned video cards and my sound is send to alsa but it does not sound that great.<br />I was thinking about hot plugin sound card with virsh is that possible I see there is&#160; attach-device&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; attach device from an XML file option</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512768">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512773" class="blockpost rowodd"> <h2><span><span class="conr">#4523</span> <a href="viewtopic.php?pid=1512773#p1512773">2015-03-20 18:46:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I think, btw, his very first post and OVMF&#039;s whitepaper should be pinned into op-post, just for overall awareness.</p></div></blockquote></div><p>I agree! Thanks for posting this!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512773">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512811" class="blockpost roweven"> <h2><span><span class="conr">#4524</span> <a href="viewtopic.php?pid=1512811#p1512811">2015-03-20 22:24:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53503">VOT Productions</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-22</span></dd> <dd><span>Posts: 47</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:votproductions@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>To everyone having issues with &quot;Starting Windows&quot; screen and it not progressing further: <br />Do -vga qxl while installing Windows. Then, install your GPU driver. Then put it back to -vga none, worked for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>However, I have a problem. I am trying to get Synergy to work, and this is my full QEMU command.</p><div class="codebox"><pre><code>#!/bin/sh sudo brctl addbr br0 sudo ip addr add 172.20.0.1/16 dev br0 sudo ip link set br0 up sudo vfio-bind 0000:01:00.0 0000:01:00.1 cp /usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd /tmp/my_vars.fd QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170 QEMU_AUDIO_DRV=alsa sudo qemu-system-x86_64 \ -enable-kvm -m 4096 -cpu host,kvm=off -smp cores=4,threads=1 \ -drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \ -drive if=pflash,format=raw,file=/tmp/my_vars.fd \ -vga none \ -soundhw hda \ -device vfio-pci,host=01:00.0,multifunction=on \ -device vfio-pci,host=01:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/mnt/1TB_LinuxMedia/virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -drive file=/mnt/1TB_LinuxMedia/windows.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/mnt/1TB_LinuxMedia/windows2.img,id=disk2,format=raw,if=none -device scsi-hd,drive=disk2 \ -usb -usbdevice host:04d9:a055 -usbdevice host:04d9:a04a \ -netdev user,id=net0 -device e1000,netdev=net0,mac=52:54:00:12:34:56 \ -netdev bridge,br=br0,id=net1 -device e1000,netdev=net1,mac=52:54:00:12:34:57 \ -usbdevice tablet ip link set br0 down</code></pre></div><p>It makes two virtual networks on Windows, one which can access the internet, and one internal. The trouble is, having that internal network on slows down browsing on Windows MASSIVELY, to the point that some websites don&#039;t load. If I disable that adapter in Windows, the websites load instantly like they should. If anyone knows how to connect Qemu to the network with a wlan0 interface (so I can&#039;t bridge) or knows how to fix the slowdown, please help me <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512811">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1512833" class="blockpost rowodd"> <h2><span><span class="conr">#4525</span> <a href="viewtopic.php?pid=1512833#p1512833">2015-03-20 23:37:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>It makes two virtual networks on Windows, one which can access the internet, and one internal. The trouble is, having that internal network on slows down browsing on Windows MASSIVELY, to the point that some websites don&#039;t load. If I disable that adapter in Windows, the websites load instantly like they should. If anyone knows how to connect Qemu to the network with a wlan0 interface (so I can&#039;t bridge) or knows how to fix the slowdown, please help me</p></div></blockquote></div><p>I use the same scenario as you , my way for setting up the internal network is explained <a href="https://bbs.archlinux.org/viewtopic.php?pid=1496846#p1496846" rel="nofollow">here</a></p><p>No issues at all .</p> <p class="postedit"><em>Last edited by Denso (2015-03-20 23:37:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1512833">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=180">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=179">179</a> <a href="viewtopic.php?id=162768&amp;p=180">180</a> <strong>181</strong> <a href="viewtopic.php?id=162768&amp;p=182">182</a> <a href="viewtopic.php?id=162768&amp;p=183">183</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=182">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
