<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 193) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=193" title="Page 193" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=192" title="Page 192" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=194" title="Page 194" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=192">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <strong>193</strong> <a href="viewtopic.php?id=162768&amp;p=194">194</a> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=194">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1519537" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4801</span> <a href="viewtopic.php?pid=1519537#p1519537">2015-04-13 16:29:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90314">Iksf</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-13</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:sporious@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there any way to have two identical GPU&#039;s, one as pass-through one not. </p><div class="codebox"><pre><code>lspci | grep NVIDIA 01:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) 02:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) lspci -nn 01:00.0 0300: 10de:13c2 (rev a1) 01:00.1 0403: 10de:0fbb (rev a1) 02:00.0 0300: 10de:13c2 (rev a1) 02:00.1 0403: 10de:0fbb (rev a1)</code></pre></div><p>They have the same id&#039;s so I can&#039;t seem to separate them.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519537">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1519549" class="blockpost roweven"> <h2><span><span class="conr">#4802</span> <a href="viewtopic.php?pid=1519549#p1519549">2015-04-13 17:09:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Iksf wrote:</cite><blockquote><div><p>Is there any way to have two identical GPU&#039;s, one as pass-through one not. </p><div class="codebox"><pre><code>lspci | grep NVIDIA 01:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) 02:00.0 VGA compatible controller: NVIDIA Corporation GM204 [GeForce GTX 970] (rev a1) 02:00.1 Audio device: NVIDIA Corporation GM204 High Definition Audio Controller (rev a1) lspci -nn 01:00.0 0300: 10de:13c2 (rev a1) 01:00.1 0403: 10de:0fbb (rev a1) 02:00.0 0300: 10de:13c2 (rev a1) 02:00.1 0403: 10de:0fbb (rev a1)</code></pre></div><p>They have the same id&#039;s so I can&#039;t seem to separate them.</p></div></blockquote></div><p>Search the thread for xen-pciback.hide, which for our purposes is similar to pci-stub, but allows devices to be specified by address rather than vendor and device ID.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519549">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1519599" class="blockpost rowodd"> <h2><span><span class="conr">#4803</span> <a href="viewtopic.php?pid=1519599#p1519599">2015-04-13 19:41:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86398">zopilote</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-02</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:zopilote@ec-red.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Since my GT610 does support UEFI, it&#039;s very strange that your GTX680 doesn&#039;t.</p></div></blockquote></div><p>Hi, could you provide me detailed info about your GT 610? I&#039;m very interested about getting it cause my evga gt 630 doesn&#039;t support uefi, thank you so much in advance!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519599">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1519617" class="blockpost roweven"> <h2><span><span class="conr">#4804</span> <a href="viewtopic.php?pid=1519617#p1519617">2015-04-13 20:41:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zopilote wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Since my GT610 does support UEFI, it&#039;s very strange that your GTX680 doesn&#039;t.</p></div></blockquote></div><p>Hi, could you provide me detailed info about your GT 610? I&#039;m very interested about getting it cause my evga gt 630 doesn&#039;t support uefi, thank you so much in advance!</p></div></blockquote></div><p>Have you contacted EVGA support?&#160; My EVGA GTX660 didn&#039;t come with UEFI support either, but they sent me a new BIOS when I asked.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519617">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1519816" class="blockpost rowodd"> <h2><span><span class="conr">#4805</span> <a href="viewtopic.php?pid=1519816#p1519816">2015-04-14 14:59:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zopilote wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Since my GT610 does support UEFI, it&#039;s very strange that your GTX680 doesn&#039;t.</p></div></blockquote></div><p>Hi, could you provide me detailed info about your GT 610? I&#039;m very interested about getting it cause my evga gt 630 doesn&#039;t support uefi, thank you so much in advance!</p></div></blockquote></div><p>Looks like i&#039;ve got <a href="http://www.gigabyte.com/products/product-page.aspx?pid=4221#ov" rel="nofollow">this</a> piece of <span class="bbs">cra</span> hardware. I&#039;ve got it(somewhere a year ago) very cheap, for something like 20$ or so. It was used, but on a warranty. So far so good, it works despite being plugged into 16x-1x riser card. There&#039;s pci-e x1 version of that card available, but i couldn&#039;t get it.<br />But the performance is, well, worth the price - it&#039;s possible to play quake 3 or play full hd video on this, so i&#039;m satisfied.<br />If i could - i&#039;d swap my CPU with APU, that&#039;d give me one GPU less without losing host output.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-14 15:00:33)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519816">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1519853" class="blockpost roweven"> <h2><span><span class="conr">#4806</span> <a href="viewtopic.php?pid=1519853#p1519853">2015-04-14 17:26:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90340">paperinick</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-14</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90340">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><em>nevermind</em></p> <p class="postedit"><em>Last edited by paperinick (2015-04-14 18:12:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1519853">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520006" class="blockpost rowodd"> <h2><span><span class="conr">#4807</span> <a href="viewtopic.php?pid=1520006#p1520006">2015-04-15 03:21:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76557">logix</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-04</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ken@logic.fm">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I think I tracked down the source of my poor Windows guest performance. I noticed that whenever I move my mouse the CPU usage, as noted by task manager in the guest, shoots up to 30-40% usage (idle sits around 2-4%). </p><p>I&#039;m passing my USB controller though to the guest, which should give me the best performance. Possibly bad interrupt handling?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520006">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520033" class="blockpost roweven"> <h2><span><span class="conr">#4808</span> <a href="viewtopic.php?pid=1520033#p1520033">2015-04-15 07:52:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>A quick question - I need to downgrade my kernel from 3.18 to 3.14 (former does not play well with ZFS, due to changes in vfs, and the latter is second-best LTS kernel). Is there any patch I should apply on 3.14.38 (current 3.14) for full vfio functionality, as required for full GPU passthrough functionality and qemu 2.2.1 ? In particular I&#039;m thinking <a href="https://lkml.org/lkml/2014/5/25/94" rel="nofollow">https://lkml.org/lkml/2014/5/25/94</a> , is there anything else?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520033">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520207" class="blockpost rowodd"> <h2><span><span class="conr">#4809</span> <a href="viewtopic.php?pid=1520207#p1520207">2015-04-15 19:53:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>logix wrote:</cite><blockquote><div><p>Possibly bad interrupt handling?</p></div></blockquote></div><p>USB HID devices do <strong>not</strong> generate interrupts, instead, they&#039;re polled by the operating system every so often.<br />Try changing your display and pointing device in QEMU. I&#039;d try VNC as a 100% working solution, but you could just add -device qxl to your QEMU command-line startup script and have SDL graphics window which somehow passes your mouse input into VM.</p><p><span class="bbs">Aren&#039;t you the guy with 8 virtual cores on 4 real cores?..</span> Yes, you&#039;re that guy. Did you sort out your strange CPU configuration? Because, well, overallocating vCPUs is a major performance killer.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-15 19:55:12)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520207">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520271" class="blockpost roweven"> <h2><span><span class="conr">#4810</span> <a href="viewtopic.php?pid=1520271#p1520271">2015-04-15 23:25:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,<br />I&#039;ve been trying to get this working, but been running into some problems.<br />I have 2 differend Radeon HD cards, one plugged into the main PCIex16 slot, another in the PCIex4 slot.<br />The card I want to passthrough is the first one.<br />PCI-Stub claims the primary card and no radeon driver gets loaded for it, but video is still only output on this one.<br />How can i switch to the other card or boot with it to begin with? (To clarify: I want the arch host to use the graphics card in the second slot, which is currently not doing anything even though lspci -v shows a loaded radeon driver.)</p><p>(My MB doesn&#039;t allow me to choose the primary card.)</p><br /><p>Is what I&#039;m trying to do possible, or do I have to passthrough the second card? (Not ideal in this case, as I think the x4 slot would hinder the cards performance).</p> <p class="postedit"><em>Last edited by fseven (2015-04-16 00:12:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520271">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520337" class="blockpost rowodd"> <h2><span><span class="conr">#4811</span> <a href="viewtopic.php?pid=1520337#p1520337">2015-04-16 07:40:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>Hello,<br />Is what I&#039;m trying to do possible, or do I have to passthrough the second card? (Not ideal in this case, as I think the x4 slot would hinder the cards performance).</p></div></blockquote></div><p>Preferably you should switch BIOS (or UEFI) motherboard configuration option to select PCIe slot for primary VGA card, or to disable ROM of the card in 16x slot (which will have the same effect). In case you cannot do that, it is perfectly possible to passthrough primary GPU card, that&#039;s what I do (my host is running headless, both primary and secondary GPUs are for passed to two VMs).</p> <p class="postedit"><em>Last edited by Bronek (2015-04-16 07:42:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520337">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520338" class="blockpost roweven"> <h2><span><span class="conr">#4812</span> <a href="viewtopic.php?pid=1520338#p1520338">2015-04-16 07:43:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Preferably you should switch BIOS (or UEFI) motherboard configuration option to select PCIe slot for primary VGA card, or to disable ROM of the card in 16x slot (which will have the same effect).</p></div></blockquote></div><br /><p>As I said, I fear i don&#039;t have the option to switch the primary slot. (MB is a Gigabyte&#160; 970A DS3P). </p><p>Could you elaborate on the other thing? How would I disable the ROM?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520338">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520355" class="blockpost rowodd"> <h2><span><span class="conr">#4813</span> <a href="viewtopic.php?pid=1520355#p1520355">2015-04-16 09:17:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Preferably you should switch BIOS (or UEFI) motherboard configuration option to select PCIe slot for primary VGA card, or to disable ROM of the card in 16x slot (which will have the same effect).</p></div></blockquote></div><br /><p>As I said, I fear i don&#039;t have the option to switch the primary slot. (MB is a Gigabyte&#160; 970A DS3P). </p><p>Could you elaborate on the other thing? How would I disable the ROM?</p></div></blockquote></div><p>Usually gigabyte <strong>has</strong> that option. Whatever.<br />You can edit your xorg.conf to choose the device manually by busid, like</p><div class="codebox"><pre><code>Section &quot;Device&quot; Identifier &quot;Device0&quot; Driver &quot;YOUR DRIVER&quot; VendorName &quot;LIKE AMD OR SOMETHING&quot; BoardName &quot;MAY BE YOUR MODEL&quot; BusID &quot;PCI:02:00:00&quot; &lt;&lt;THAT&#039;S YOUR PCI BDF ADDRESS, AS FOUND IN LSPCI EndSectio</code></pre></div><p>You can use <a href="https://bbs.archlinux.org/viewtopic.php?pid=1273412#p1273412" rel="nofollow">fglrx and hope it&#039;s fixed now</a> or radeon. Just try and see if radeon ignores pci-stub like fglrx does. I think it shouldn&#039;t do that, and you don&#039;t have to explicitly blacklist it.</p><p>So, edit the xorg.conf, load a driver for your GPU and it should be fine. Or maybe you don&#039;t even need to add that BusID line at all.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-16 09:20:09)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520355">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520391" class="blockpost roweven"> <h2><span><span class="conr">#4814</span> <a href="viewtopic.php?pid=1520391#p1520391">2015-04-16 11:58:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90273">ughman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:chekwob@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>ughman wrote:</cite><blockquote><div><p>I will work on this then. Will this require me to get the guest OS UEFI-bootable? At the moment it is installed on an MBR-partitioned virtual drive.</p></div></blockquote></div><p>Yes, the OS will need to be UEFI-bootable. Using <a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a> you can get Windows 7 to boot.</p></div></blockquote></div><p>I believe I have the guest booting now with OVMF. This is my current qemu launch script:</p><div class="codebox"><pre><code>#!/bin/sh export QEMU_AUDIO_DRV=alsa export QEMU_ALSA_DAC_FIXED_FREQ=48000 export QEMU_ALSA_DAC_BUFFER_SIZE=11054 #export QEMU_ALSA_DAC_PERIOD_SIZE=170 qemu-system-x86_64 \ -enable-kvm \ -cpu host,kvm=off \ -m 4096 \ -smp cores=2,threads=1,sockets=1 \ -drive file=OVMF.fd,format=raw,if=pflash \ -drive file=/dev/mapper/mass-win--uefi,format=raw,if=virtio \ -usb \ -usbdevice host:13ba:0018 \ -usbdevice host:0810:0001 \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -soundhw hda \ -vga none \ $*</code></pre></div><p>Unfortunately, this hasn&#039;t fixed the problem either. I have once gotten what is I assume to be a bsod, but nothing came up on the screen after it went black and turned off, as well as freezes on the later attempts.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520391">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520429" class="blockpost rowodd"> <h2><span><span class="conr">#4815</span> <a href="viewtopic.php?pid=1520429#p1520429">2015-04-16 14:09:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone tried passing Radeon 295 X2 ? Asking because it apparently has builtin PLX chip, thus I&#039;m guessing that PCIe topology can be a little &quot;funky&quot;.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520429">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520494" class="blockpost roweven"> <h2><span><span class="conr">#4816</span> <a href="viewtopic.php?pid=1520494#p1520494">2015-04-16 17:01:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ughman wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>ughman wrote:</cite><blockquote><div><p>I will work on this then. Will this require me to get the guest OS UEFI-bootable? At the moment it is installed on an MBR-partitioned virtual drive.</p></div></blockquote></div><p>Yes, the OS will need to be UEFI-bootable. Using <a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a> you can get Windows 7 to boot.</p></div></blockquote></div><p>I believe I have the guest booting now with OVMF. This is my current qemu launch script:</p><div class="codebox"><pre><code>#!/bin/sh export QEMU_AUDIO_DRV=alsa export QEMU_ALSA_DAC_FIXED_FREQ=48000 export QEMU_ALSA_DAC_BUFFER_SIZE=11054 #export QEMU_ALSA_DAC_PERIOD_SIZE=170 qemu-system-x86_64 \ -enable-kvm \ -cpu host,kvm=off \ -m 4096 \ -smp cores=2,threads=1,sockets=1 \ -drive file=OVMF.fd,format=raw,if=pflash \ -drive file=/dev/mapper/mass-win--uefi,format=raw,if=virtio \ -usb \ -usbdevice host:13ba:0018 \ -usbdevice host:0810:0001 \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -soundhw hda \ -vga none \ $*</code></pre></div><p>Unfortunately, this hasn&#039;t fixed the problem either. I have once gotten what is I assume to be a bsod, but nothing came up on the screen after it went black and turned off, as well as freezes on the later attempts.</p></div></blockquote></div><p>What? Does the OS boots? Or you see a black screen?<br />What windows do you have? Have you added -device qxl-vga for win7/srv2008r2 as stated in the whitepaper?</p><p>You should see tianocore logo with memcheck in upper right corner, then a black screen, after some time &quot;starting windowns&quot; logo animation will show up.<br />Of course, OS should be installed from UEFI, because it overwrites ESP and UEFIVARS.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520494">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520502" class="blockpost rowodd"> <h2><span><span class="conr">#4817</span> <a href="viewtopic.php?pid=1520502#p1520502">2015-04-16 17:24:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90273">ughman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:chekwob@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>What? Does the OS boots? Or you see a black screen?</p></div></blockquote></div><p>Sorry, it does boot fine. Nothing appears on the screen at first but windows eventually appears with a login prompt.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>What windows do you have?</p></div></blockquote></div><p>Windows 7 Ultimate x64</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Have you added -device qxl-vga for win7/srv2008r2 as stated in the whitepaper?</p></div></blockquote></div><p>I was not using that when I posted, but after reading your post I have now tried it and eventually got a freeze regardless. This time it happened while I was scrolling through some text, which appeared to be corrupted once it froze. The display on the passed-through card went black after a few seconds, and then the qxl output went black a few seconds after that.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You should see tianocore logo with memcheck in upper right corner, then a black screen, after some time &quot;starting windowns&quot; logo animation will show up.</p></div></blockquote></div><p>That I do (when using -device qxl-vga). Afterwards, the qxl output stays at the logo animation, and the login screen appears on the display attached to the card.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Of course, OS should be installed from UEFI, because it overwrites ESP and UEFIVARS.</p></div></blockquote></div><p>Wait, I&#039;m supposed to reinstall the OS after switching to UEFI? That&#039;s rather annoying, I was hoping I could keep the same install, as this setup was previously running on bare metal for several months before I moved it into the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520522" class="blockpost roweven"> <h2><span><span class="conr">#4818</span> <a href="viewtopic.php?pid=1520522#p1520522">2015-04-16 18:46:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ughman wrote:</cite><blockquote><div><p>Windows 7 Ultimate x64</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Have you added -device qxl-vga for win7/srv2008r2 as stated in the whitepaper?</p></div></blockquote></div><p>I was not using that when I posted, but after reading your post I have now tried it and eventually got a freeze regardless. This time it happened while I was scrolling through some text, which appeared to be corrupted once it froze. The display on the passed-through card went black after a few seconds, and then the qxl output went black a few seconds after that.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You should see tianocore logo with memcheck in upper right corner, then a black screen, after some time &quot;starting windowns&quot; logo animation will show up.</p></div></blockquote></div><p>That I do (when using -device qxl-vga). Afterwards, the qxl output stays at the logo animation, and the login screen appears on the display attached to the card.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Of course, OS should be installed from UEFI, because it overwrites ESP and UEFIVARS.</p></div></blockquote></div><p>Wait, I&#039;m supposed to reinstall the OS after switching to UEFI? That&#039;s rather annoying, I was hoping I could keep the same install, as this setup was previously running on bare metal for several months before I moved it into the VM.</p></div></blockquote></div><p>Seeing a logo stuck on qxl-vga is 100% fine, you can drop the qxl-vga device once you&#039;ve installed the drivers.<br />Also, if it boots and works - you don&#039;t need to reinstall it. Maybe reinstall some device drivers, but nothing much. There may be a hidden windows &quot;hardware migration&quot; problem somewhere, but if it boots - i think it should work.</p><p>I don&#039;t know what causes the freeze, but here&#039;s my trinity-based system for general reference:</p><div class="codebox"><pre><code>options kvm-amd npt=1 nested=0 options kvm ignore_msrs=0 allow_unsafe_assigned_interrupts=0 options vfio_iommu_type1 disable_hugepages=1 allow_unsafe_interrupts=0</code></pre></div><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX=&quot;vconsole.font=latarcyrheb-sun16 $([ -x /usr/sbin/rhcrashkernel-param ] &amp;&amp; /usr/sbin/rhcrashkernel-param || :) nofb pci-stub.ids=1022:780d,1002:683f,1002:aab0 enable_mtrr_cleanup iommu=pt acpi_enforce_resources=lax&quot;</code></pre></div><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; id=&#039;2&#039;&gt; &lt;name&gt;vm1&lt;/name&gt; &lt;uuid&gt;f6958833-174f-44e6-817b-2a6c73c6f041&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/loader&gt; &lt;nvram&gt;/var/lib/libvirt/qemu/nvram/vm1_VARS.fd&lt;/nvram&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;directsync&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sda&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;alias name=&#039;virtio-disk0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0c&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;&gt; &lt;alias name=&#039;pci.0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;virtio-serial0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;ide0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:f0:d5:39&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;target dev=&#039;vnet0&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;alias name=&#039;net0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;source path=&#039;/dev/pts/2&#039;/&gt; &lt;target port=&#039;0&#039;/&gt; &lt;alias name=&#039;serial0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039; tty=&#039;/dev/pts/2&#039;&gt; &lt;source path=&#039;/dev/pts/2&#039;/&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;alias name=&#039;serial0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;alias name=&#039;channel0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;mouse&#039; bus=&#039;usb&#039;&gt; &lt;alias name=&#039;input0&#039;/&gt; &lt;/input&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;5900&#039; autoport=&#039;yes&#039; listen=&#039;127.0.0.1&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;127.0.0.1&#039;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; heads=&#039;1&#039;/&gt; &lt;alias name=&#039;video0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev0&#039;/&gt; &lt;rom bar=&#039;on&#039; file=&#039;/mnt/hdd/qemu/hybridmagic.rom&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev2&#039;/&gt; &lt;rom bar=&#039;on&#039; file=&#039;/mnt/hdd/qemu/hybridmagic.rom&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev3&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;kvm&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x14&#039; function=&#039;0x2&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;alias name=&#039;redir0&#039;/&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;alias name=&#039;redir1&#039;/&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;alias name=&#039;balloon0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;dynamic&#039; model=&#039;selinux&#039; relabel=&#039;yes&#039;&gt; &lt;label&gt;system_u:system_r:svirt_t:s0:c127,c267&lt;/label&gt; &lt;imagelabel&gt;system_u:object_r:svirt_image_t:s0:c127,c267&lt;/imagelabel&gt; &lt;/seclabel&gt; &lt;/domain&gt;</code></pre></div><p>^^^^<br />that libvirt xml generates this<br />v v v v</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 -machine accel=kvm -name vm1 -S -machine pc-i440fx-2.1,accel=kvm,usb=off -cpu Opteron_G5,+bmi1,+perfctr_nb,+perfctr_core,+topoext,+nodeid_msr,+tce,+lwp,+wdt,+skinit,+ibs,+osvw,+cr8legacy,+extapic,+cmp_legacy,+fxsr_opt,+mmxext,+osxsave,+monitor,+ht,+vme -drive file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/vm1_VARS.fd,if=pflash,format=raw,unit=1 -m 4096 -realtime mlock=off -smp 4,sockets=1,cores=4,threads=1 -uuid f6958833-174f-44e6-817b-2a6c73c6f041 -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/vm1.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/dev/sda,if=none,id=drive-virtio-disk0,format=raw,cache=directsync,aio=native -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0xc,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -netdev tap,fd=23,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:f0:d5:39,bus=pci.0,addr=0x3 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -chardev spicevmc,id=charchannel0,name=vdagent -device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0 -device usb-mouse,id=input0 -vnc 127.0.0.1:0 -device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,bus=pci.0,addr=0x4 -chardev spicevmc,id=charredir0,name=usbredir -device usb-redir,chardev=charredir0,id=redir0 -chardev spicevmc,id=charredir1,name=usbredir -device usb-redir,chardev=charredir1,id=redir1 -device vfio-pci,host=01:00.0,id=hostdev0,bus=pci.0,addr=0x8,rombar=1,romfile=/mnt/hdd/qemu/hybridmagic.rom -device vfio-pci,host=01:00.1,id=hostdev1,bus=pci.0,addr=0x9 -device vfio-pci,host=02:00.0,id=hostdev2,bus=pci.0,addr=0xa,rombar=1,romfile=/mnt/hdd/qemu/hybridmagic.rom -device vfio-pci,host=02:00.1,id=hostdev3,bus=pci.0,addr=0xb -device pci-assign,configfd=24,host=00:14.2,id=hostdev4,bus=pci.0,addr=0x2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on</code></pre></div><div class="codebox"><pre><code>(qemu-2.1.3-5.fc21) Name : edk2.git-ovmf-x64 Release : 20150416.b962.ged6fde4 3.19.3-200.fc21.x86_64</code></pre></div><div class="codebox"><pre><code>Architecture: x86_64 CPU op-mode(s): 32-bit, 64-bit Byte Order: Little Endian CPU(s): 4 On-line CPU(s) list: 0-3 Thread(s) per core: 2 Core(s) per socket: 2 Socket(s): 1 NUMA node(s): 1 Vendor ID: AuthenticAMD CPU family: 21 Model: 16 Model name: AMD Athlon(tm) X4 750K Quad Core Processor Stepping: 1 CPU MHz: 1900.000 CPU max MHz: 3400.0000 CPU min MHz: 1400.0000 BogoMIPS: 6834.29 Virtualization: AMD-V L1d cache: 16K L1i cache: 64K L2 cache: 2048K NUMA node0 CPU(s): 0-3</code></pre></div><div class="codebox"><pre><code>-[0000:00]-+-00.0 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Root Complex [1022:1410] +-00.2 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) I/O Memory Management Unit [1022:1419] +-02.0-[01]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750 / R7 250E] [1002:683f] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] [1002:aab0] +-04.0-[02]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750 / R7 250E] [1002:683f] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] [1002:aab0] +-11.0 Advanced Micro Devices, Inc. [AMD] FCH SATA Controller [AHCI mode] [1022:7801] +-12.0 Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller [1022:7807] +-12.2 Advanced Micro Devices, Inc. [AMD] FCH USB EHCI Controller [1022:7808] +-13.0 Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller [1022:7807] +-13.2 Advanced Micro Devices, Inc. [AMD] FCH USB EHCI Controller [1022:7808] +-14.0 Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:780b] +-14.2 Advanced Micro Devices, Inc. [AMD] FCH Azalia Controller [1022:780d] +-14.3 Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:780e] +-14.4-[03]----05.0 Ensoniq 5880B [AudioPCI] [1274:5880] +-15.0-[04]--+-00.0 NVIDIA Corporation GF119 [GeForce GT 610] [10de:104a] | \-00.1 NVIDIA Corporation GF119 HDMI Audio Controller [10de:0e08] +-15.1-[05]----00.0 ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller [1b21:1042] +-15.2-[06]----00.0 Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] +-16.0 Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller [1022:7807] +-16.2 Advanced Micro Devices, Inc. [AMD] FCH USB EHCI Controller [1022:7808] +-18.0 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 0 [1022:1400] +-18.1 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 1 [1022:1401] +-18.2 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 2 [1022:1402] +-18.3 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 3 [1022:1403] +-18.4 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 4 [1022:1404] \-18.5 Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 5 [1022:1405]</code></pre></div><br /><p>Try running dmesg -w in some other window while trying to &quot;freeze&quot; the VM.<br />You can also plug in ISA debug console to check logs, like this:</p><div class="codebox"><pre><code>-debugcon file:debug.log -global isa-debugcon.iobase=0x402</code></pre></div> <p class="postedit"><em>Last edited by Duelist (2015-04-16 18:53:53)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520522">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520664" class="blockpost rowodd"> <h2><span><span class="conr">#4819</span> <a href="viewtopic.php?pid=1520664#p1520664">2015-04-17 07:25:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, aw<br />the AMD Firepro R5000 can passthrough successfully, but when I install vga driver, it restart with BSOD like atikmpag.sys error</p><p>my kernel:<br />linux-3.18.6<br />qemu:<br />qemu-2.1.3</p><p>commandline:<br />/usr/libexec/qemu-kvm-passthrough -cpu host -smp 1,sockets=1,cores=1,threads=1 \<br />-m 8192 -M q35 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/usr/share/qemu/win-pre-install-with-slic.bin \<br />-drive file=/var/lib/libvirt/images/fwq_clean_win7_64bit-patched.img,id=virtio-scsi-disk0 \<br />-device virtio-blk-pci,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=06:d8:e8:00:00:1b,addr=0x3 \<br />-net tap,ifname=tap0,script=/root/qemu-ifup \<br />-vga none -display none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=07:00.1,bus=root.1,addr=00.1 \<br />-device vfio-pci,host=06:00.0,bus=root.1,addr=00.2 \<br />-device vfio-pci,host=06:00.1,bus=root.1,addr=00.3 \<br />-device vfio-pci,host=06:00.2,bus=root.1,addr=00.4 \<br />-monitor stdio</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520664">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520679" class="blockpost roweven"> <h2><span><span class="conr">#4820</span> <a href="viewtopic.php?pid=1520679#p1520679">2015-04-17 08:40:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,<br />when I want to use a newer version of the ovmf-svn package in my VM, is it possible to keep the part where the settings are stored in from the old build?</p><p>Thanks<br />apex</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520679">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520687" class="blockpost rowodd"> <h2><span><span class="conr">#4821</span> <a href="viewtopic.php?pid=1520687#p1520687">2015-04-17 08:57:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m using a different board now and got it working fine, but I have another question:<br />Is it possible to passthrough a single SATA port? Or how would passing through the disk like in the first place not impact performance? (Because then it wouldn&#039;t be in AHCI mode.)<br />I can&#039;t passthrough an entire controller, since I only have one.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520695" class="blockpost roweven"> <h2><span><span class="conr">#4822</span> <a href="viewtopic.php?pid=1520695#p1520695">2015-04-17 09:19:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>I&#039;m using a different board now and got it working fine, but I have another question:<br />Is it possible to passthrough a single SATA port? Or how would passing through the disk like in the first place not impact performance? (Because then it wouldn&#039;t be in AHCI mode.)<br />I can&#039;t passthrough an entire controller, since I only have one.</p></div></blockquote></div><p>I don´t believe passing through a single port is possible. The best would be installing a separate controller, if that is an option for you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520695">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520701" class="blockpost rowodd"> <h2><span><span class="conr">#4823</span> <a href="viewtopic.php?pid=1520701#p1520701">2015-04-17 10:02:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi,<br />when I want to use a newer version of the ovmf-svn package in my VM, is it possible to keep the part where the settings are stored in from the old build?</p><p>Thanks<br />apex</p></div></blockquote></div><p>When using EDK2 GIT builds, you have the following files:</p><div class="codebox"><pre><code>/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF-with-csm.fd /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF_CODE-with-csm.fd /usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF_VARS-with-csm.fd</code></pre></div><p>If you will add both OVMF_CODE and OVMF_VARS, you can update only OVMF_CODE(just copy the file, or libvirt does it&#039;s stuff) without changing the VARS. lersek may provide more info on this.</p><br /><p>@fseven: you can achieve a similar effect when doing -device virtio-blk-pci with drive /dev/sda or even /dev/sda4(but that will bork the partition table, as the VM will think it&#039;s a whole disk). If you poke windows and it&#039;s EFI-loader the right way, you may even boot baremetal from that partitions.</p><p>I have /dev/sda1 as 500~GB junkyard FS mounted to linux, and windows knows about it(since it has full /dev/sda), but neither OS can mount other&#039;s FS. Linux prevents you, windows doesn&#039;t do ext4.<br />There are some caching and scheduling issues present, but they don&#039;t affect the performance much.</p><p>I haven&#039;t heard any success-stories about dedicating a single port to some VM.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-17 10:03:15)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520701">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520702" class="blockpost roweven"> <h2><span><span class="conr">#4824</span> <a href="viewtopic.php?pid=1520702#p1520702">2015-04-17 10:03:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>I&#039;m using a different board now and got it working fine, but I have another question:<br />Is it possible to passthrough a single SATA port? Or how would passing through the disk like in the first place not impact performance? (Because then it wouldn&#039;t be in AHCI mode.)<br />I can&#039;t passthrough an entire controller, since I only have one.</p></div></blockquote></div><p>I don´t believe passing through a single port is possible. The best would be installing a separate controller, if that is an option for you.</p></div></blockquote></div><p>I&#039;m looking into that, but they do seem to cost a fair bit, not sure if it&#039;s worth it.<br />I get about 90MB/s write on Guest and 380MB/s on host, which is quite a big difference. At this speed I might as well be using a normal HD.</p><p>Update: Just tried passing it through using the -hda option instead of using a virtio-scsi device like in the first post, performance seems to be within 10-15% which is completely acceptable.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520702">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520720" class="blockpost rowodd"> <h2><span><span class="conr">#4825</span> <a href="viewtopic.php?pid=1520720#p1520720">2015-04-17 11:58:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi,<br />when I want to use a newer version of the ovmf-svn package in my VM, is it possible to keep the part where the settings are stored in from the old build?</p><p>Thanks<br />apex</p></div></blockquote></div><p>When using EDK2 GIT builds, you have the following files:</p><div class="codebox"><pre><code>/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF-with-csm.fd /usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF_CODE-with-csm.fd /usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd /usr/share/edk2.git/ovmf-x64/OVMF_VARS-with-csm.fd</code></pre></div><p>@fseven: you can achieve a similar effect when doing -device virtio-blk-pci with drive /dev/sda or even /dev/sda4(but that will bork the partition table, as the VM will think it&#039;s a whole disk). If you poke windows and it&#039;s EFI-loader the right way, you may even boot baremetal from that partitions.</p></div></blockquote></div><p>Can you give some more details about &quot;poking windows and it´s EFI-loader the right way&quot;? <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Furthermore I would expect Windows to complain about changed chipset/driver mismatch and crashing, or is this an issue which doesn&#039;t exist in newer Windows versions?</p> <p class="postedit"><em>Last edited by apex8 (2015-04-17 12:07:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520720">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=192">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <strong>193</strong> <a href="viewtopic.php?id=162768&amp;p=194">194</a> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=194">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
