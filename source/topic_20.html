<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 20) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=20" title="Page 20" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=19" title="Page 19" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=21" title="Page 21" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=19">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=18">18</a> <a href="viewtopic.php?id=162768&amp;p=19">19</a> <strong>20</strong> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=21">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1325747" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#476</span> <a href="viewtopic.php?pid=1325747#p1325747">2013-09-17 17:23:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I need help.</p><p>I use this script to start VM, what I need to change to add another one graphics card to VM?</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div> <p class="postedit"><em>Last edited by chUpa (2013-09-17 17:28:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1325747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1325932" class="blockpost roweven"> <h2><span><span class="conr">#477</span> <a href="viewtopic.php?pid=1325932#p1325932">2013-09-17 23:01:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>While reading the Thread I`ve got another question:</p><p>Is it possible to pass the GPU in the first PCI Slot to the Guest System? If not, is this a performance issue since many Mainboards only have PCIe x4 in the second slot...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1325932">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326035" class="blockpost rowodd"> <h2><span><span class="conr">#478</span> <a href="viewtopic.php?pid=1326035#p1326035">2013-09-18 05:30:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>While reading the Thread I`ve got another question:</p><p>Is it possible to pass the GPU in the first PCI Slot to the Guest System? If not, is this a performance issue since many Mainboards only have PCIe x4 in the second slot...</p></div></blockquote></div><p>I do not see any problem in this. In my motherboard, I have 6 pcie ports. My host using card that which is in the lower slot. Its address 0000:05:00.0. Passthrough cards have addresses 0000:01:00.0/0000:02:00.0.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326035">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326135" class="blockpost roweven"> <h2><span><span class="conr">#479</span> <a href="viewtopic.php?pid=1326135#p1326135">2013-09-18 12:18:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>While reading the Thread I`ve got another question:</p><p>Is it possible to pass the GPU in the first PCI Slot to the Guest System? If not, is this a performance issue since many Mainboards only have PCIe x4 in the second slot...</p></div></blockquote></div><p>I do not see any problem in this. In my motherboard, I have 6 pcie ports. My host using card that which is in the lower slot. Its address 0000:05:00.0. Passthrough cards have addresses 0000:01:00.0/0000:02:00.0.</p></div></blockquote></div><p>Okay, thats nice, i think i just missunderstood some earlier post then.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326135">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326189" class="blockpost rowodd"> <h2><span><span class="conr">#480</span> <a href="viewtopic.php?pid=1326189#p1326189">2013-09-18 14:24:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>I need help.</p><p>I use this script to start VM, what I need to change to add another one graphics card to VM?</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div></div></blockquote></div><p>You could add a &quot;GPU2&quot;, &quot;GPU_SND2&quot;, and &quot;VBIOS2&quot; variable, then add this </p><div class="codebox"><pre><code>if [ -n &quot;$GPU2&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,rombar=0,romfile=$VBIOS2,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND2,addr=0.1,bus=root.2&quot; fi fi</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326189">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326190" class="blockpost roweven"> <h2><span><span class="conr">#481</span> <a href="viewtopic.php?pid=1326190#p1326190">2013-09-18 14:25:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>While reading the Thread I`ve got another question:</p><p>Is it possible to pass the GPU in the first PCI Slot to the Guest System? If not, is this a performance issue since many Mainboards only have PCIe x4 in the second slot...</p></div></blockquote></div><p>I do not see any problem in this. In my motherboard, I have 6 pcie ports. My host using card that which is in the lower slot. Its address 0000:05:00.0. Passthrough cards have addresses 0000:01:00.0/0000:02:00.0.</p></div></blockquote></div><p>Okay, thats nice, i think i just missunderstood some earlier post then.</p></div></blockquote></div><p>As long as its not your primary card you could use any slot you want</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326190">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326228" class="blockpost rowodd"> <h2><span><span class="conr">#482</span> <a href="viewtopic.php?pid=1326228#p1326228">2013-09-18 15:21:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>I need help.</p><p>I use this script to start VM, what I need to change to add another one graphics card to VM?</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div></div></blockquote></div><p>You could add a &quot;GPU2&quot;, &quot;GPU_SND2&quot;, and &quot;VBIOS2&quot; variable, then add this </p><div class="codebox"><pre><code>if [ -n &quot;$GPU2&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,rombar=0,romfile=$VBIOS2,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND2,addr=0.1,bus=root.2&quot; fi fi</code></pre></div></div></blockquote></div><p>I tried to do this, here is my edited script:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; SND=true SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;&quot; GPU0=&quot;01:00.0&quot; GPU_SND0=&quot;01:00.1&quot; GPU1=&quot;02:00.0&quot; GPU_SND1=&quot;02:00.1&quot; VBIOS0=&quot;/home/cd/rom0.rom&quot; VBIOS1=&quot;/home/cd/rom1.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU0&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,rombar=0,romfile=$VBIOS0,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND0,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$GPU1&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,rombar=0,romfile=$VBIOS1,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND1,addr=0.1,bus=root.2&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div><p>It starts without errors, but there is no output from the graphics card (from both I get - no signal detected).<br />When I comment the variables:</p><div class="codebox"><pre><code>GPU1=&quot;02:00.0&quot; GPU_SND1=&quot;02:00.1&quot; VBIOS1=&quot;/home/cd/rom1.rom&quot;</code></pre></div><p>works as before</p><p>Spasibo for the help, I hope we will find a solution (:</p><p>Russia and Uruguay 27 December 2011 signed a visa-free status. I travel much. We can have a beer or coffee. ((:</p> <p class="postedit"><em>Last edited by chUpa (2013-09-18 15:33:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326228">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326237" class="blockpost roweven"> <h2><span><span class="conr">#483</span> <a href="viewtopic.php?pid=1326237#p1326237">2013-09-18 15:42:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>I need help.</p><p>I use this script to start VM, what I need to change to add another one graphics card to VM?</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div></div></blockquote></div><p>You could add a &quot;GPU2&quot;, &quot;GPU_SND2&quot;, and &quot;VBIOS2&quot; variable, then add this </p><div class="codebox"><pre><code>if [ -n &quot;$GPU2&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,rombar=0,romfile=$VBIOS2,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND2,addr=0.1,bus=root.2&quot; fi fi</code></pre></div></div></blockquote></div><p>I tried to do this, here is my edited script:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; SND=true SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;&quot; GPU0=&quot;01:00.0&quot; GPU_SND0=&quot;01:00.1&quot; GPU1=&quot;02:00.0&quot; GPU_SND1=&quot;02:00.1&quot; VBIOS0=&quot;/home/cd/rom0.rom&quot; VBIOS1=&quot;/home/cd/rom1.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU0&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,rombar=0,romfile=$VBIOS0,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND0,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$GPU1&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,rombar=0,romfile=$VBIOS1,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND1,addr=0.1,bus=root.2&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div><p>It starts without errors, but there is no output from the graphics card (from both I get - no signal detected).<br />When I comment the variables:</p><div class="codebox"><pre><code>GPU1=&quot;02:00.0&quot; GPU_SND1=&quot;02:00.1&quot; VBIOS1=&quot;/home/cd/rom1.rom&quot;</code></pre></div><p>works as before</p><p>Spasibo for the help, I hope we will find a solution (:</p></div></blockquote></div><p>Are you using radeon cards?</p><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>Russia and Uruguay 27 December 2011 signed a visa-free status. I travel much. We can have a beer or coffee. ((:</p></div></blockquote></div><p>Sure man anytime <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326237">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326246" class="blockpost rowodd"> <h2><span><span class="conr">#484</span> <a href="viewtopic.php?pid=1326246#p1326246">2013-09-18 15:55:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You could add a &quot;GPU2&quot;, &quot;GPU_SND2&quot;, and &quot;VBIOS2&quot; variable, then add this </p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div></div></blockquote></div><p>I tried to do this, here is my edited script:</p><div class="codebox"><pre><code>if [ -n &quot;$GPU2&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,rombar=0,romfile=$VBIOS2,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND2,addr=0.1,bus=root.2&quot; fi fi</code></pre></div><p>It starts without errors, but there is no output from the graphics card (from both I get - no signal detected).<br />When I comment the variables:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; SND=true SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;&quot; GPU0=&quot;01:00.0&quot; GPU_SND0=&quot;01:00.1&quot; GPU1=&quot;02:00.0&quot; GPU_SND1=&quot;02:00.1&quot; VBIOS0=&quot;/home/cd/rom0.rom&quot; VBIOS1=&quot;/home/cd/rom1.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU0&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,rombar=0,romfile=$VBIOS0,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU0,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND0&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND0,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$GPU1&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,rombar=0,romfile=$VBIOS1,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU1,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND1&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND1,addr=0.1,bus=root.2&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div><p>works as before</p><p>Spasibo for the help, I hope we will find a solution (:</p></div></blockquote></div><p>Are you using radeon cards?</p><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>Russia and Uruguay 27 December 2011 signed a visa-free status. I travel much. We can have a beer or coffee. ((:</p></div></blockquote></div></div></blockquote></div><p>ATI Radeon (gigabyte HD 7970 gv-r7970c-3gd)</p><div class="quotebox"><blockquote><div><p>Sure man anytime <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>You have the summer there soon ... (:</p> <p class="postedit"><em>Last edited by chUpa (2013-09-18 15:55:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326246">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326249" class="blockpost roweven"> <h2><span><span class="conr">#485</span> <a href="viewtopic.php?pid=1326249#p1326249">2013-09-18 16:00:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>I tried to do this, here is my edited script:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) CPUSET=/sys/fs/cgroup/cpuset QEMU=/usr/bin/qemu-system-x86_64 VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm -nographic&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; #NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; NET=&quot;&quot; SND=&quot;&quot; #SND=true #SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; USB_DEVICES=&quot;tablet host:058f:6254 host:046d:c526 host:045e:0745&quot; PCI_DEVICES=&quot;06:06.0&quot; GPU=&quot;01:00.0&quot; GPU_SND=&quot;01:00.1&quot; VBIOS=&quot;/home/cd/rom.rom&quot; HDD=&quot;/home/cd/vhdd/win8x64.img&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,rombar=0,romfile=$VBIOS,addr=0.0,multifunction=on,bus=root.1&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEM=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEM+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi if [ ! -d $CPUSET/system ]; then mkdir $CPUSET/system fi if [ ! -d $CPUSET/qemu ]; then mkdir $CPUSET/qemu fi echo $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) &gt; $CPUSET/qemu/cpuset.cpus echo 1 &gt; $CPUSET/qemu/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/qemu/cpuset.mems echo 0-$((CPU_CORE_NR-VCPUS-1))&gt; $CPUSET/system/cpuset.cpus echo 1 &gt; $CPUSET/system/cpuset.cpu_exclusive echo 0 &gt; $CPUSET/system/cpuset.mems for t in `cat $CPUSET/tasks`; do echo $t &gt; $CPUSET/system/tasks done &gt; /dev/null 2&gt;&amp;1 set -m $QEMU $CONFIG $BIOS $CPU $MEM $DEV $USB_DEV $SND $NET $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then echo $t &gt; $CPUSET/qemu/tasks taskset -pc $i $t; let i++ fi fi done break fi done ) &amp; fg %1 wait for t in `cat $CPUSET/system/tasks`; do echo $t &gt; $CPUSET/tasks done &gt; /dev/null 2&gt;&amp;1 rmdir $CPUSET/system rmdir $CPUSET/qemu echo &quot;All Done!&quot;</code></pre></div><p>It starts without errors, but there is no output from the graphics card (from both I get - no signal detected).<br />When I comment the variables:</p><div class="codebox"><pre><code>if [ -n &quot;$GPU2&quot; ]; then DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.1,multifunction=on,port=2,chassis=2,id=root.2&quot; if [ -n &quot;$VBIOS2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,rombar=0,romfile=$VBIOS2,addr=0.0,multifunction=on,bus=root.2&quot; else DEV+=&quot; -device vfio-pci,host=$GPU2,x-vga=on,addr=0.0,multifunction=on,bus=root.2&quot; fi if [ -n &quot;$GPU_SND2&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND2,addr=0.1,bus=root.2&quot; fi fi</code></pre></div><p>works as before</p><p>Spasibo for the help, I hope we will find a solution (:</p></div></blockquote></div><p>Are you using radeon cards?</p><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>Russia and Uruguay 27 December 2011 signed a visa-free status. I travel much. We can have a beer or coffee. ((:</p></div></blockquote></div></div></blockquote></div><p>ATI Radeon (gigabyte HD 7970 gv-r7970c-3gd)</p><div class="quotebox"><blockquote><div><p>Sure man anytime <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>You have the summer there soon ... (:</p></div></blockquote></div><p>Try without &quot;x-vga=on&quot; on GPU1</p> <p class="postedit"><em>Last edited by nbhs (2013-09-18 16:00:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326249">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326253" class="blockpost rowodd"> <h2><span><span class="conr">#486</span> <a href="viewtopic.php?pid=1326253#p1326253">2013-09-18 16:05:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just uploaded qemu 1.6, kernel 3.11 and seabios 1.7.3 packages to the main guide, qemu 1.6 seems to require seabios 1.7.3</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326253">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326258" class="blockpost roweven"> <h2><span><span class="conr">#487</span> <a href="viewtopic.php?pid=1326258#p1326258">2013-09-18 16:10:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try without &quot;x-vga=on&quot; on GPU1</p></div></blockquote></div><p>still no signal</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326258">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326262" class="blockpost rowodd"> <h2><span><span class="conr">#488</span> <a href="viewtopic.php?pid=1326262#p1326262">2013-09-18 16:19:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try without &quot;x-vga=on&quot; on GPU1</p></div></blockquote></div><p>still no signal</p></div></blockquote></div><p>Im assuming its working ok with one card, but if you passthrough another card it doesnt work, right? Could you post your hardware specs? you can try to passthrough the secondary card as a regular pci device</p><div class="codebox"><pre><code>-device vfio-pci,host=02:00.0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326262">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326267" class="blockpost roweven"> <h2><span><span class="conr">#489</span> <a href="viewtopic.php?pid=1326267#p1326267">2013-09-18 16:33:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes, correctly. With one card Windows work fine, and i have to install Catalyst.</p><p>I have 2 radeon 01:00.0/1 and 02:00.0/1 and Nvidia 210 05:00.0/1 (open source driver), radeon and fglrx modules blacklisted.</p><p>I try add my second card in PCI_DEVICES=&quot;02:00.0&quot; its not working, shows no signal too.</p><p>just in case, i was add my ati cards in pci-stub, and try. Nothing has changed.</p><div class="codebox"><pre class="vscroll"><code>lspci 00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx0 port B) (rev 02) 00:00.2 IOMMU: Advanced Micro Devices, Inc. [AMD/ATI] RD990 I/O Memory Management Unit (IOMMU) 00:02.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port B) 00:03.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port C) 00:09.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port H) 00:0a.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx1 port A) 00:0c.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890S PCI Express bridge for GPP2 port 1 00:11.0 RAID bus controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [RAID5 mode] (rev 40) 00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 42) 00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40) 00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40) 00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40) 00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller 00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) 00:15.1 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 1) 00:15.2 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB900 PCI to PCI bridge (PCIE port 2) 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 0 00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 1 00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 2 00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 3 00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 4 00:18.5 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 5 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] 03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 04:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller (rev 11) 05:00.0 VGA compatible controller: NVIDIA Corporation GT218 [GeForce 210] (rev a2) 05:00.1 Audio device: NVIDIA Corporation High Definition Audio Controller (rev a1) 06:06.0 Multimedia audio controller: Creative Labs SB X-Fi 06:0e.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6306/7/8 [Fire II(M)] IEEE 1394 OHCI Controller (rev c0) 07:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168 PCI Express Gigabit Ethernet controller (rev 06) 08:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 09:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller (rev 11)</code></pre></div><div class="codebox"><pre class="vscroll"><code>lspci -n 00:00.0 0600: 1002:5a14 (rev 02) 00:00.2 0806: 1002:5a23 00:02.0 0604: 1002:5a16 00:03.0 0604: 1002:5a17 00:09.0 0604: 1002:5a1c 00:0a.0 0604: 1002:5a1d 00:0c.0 0604: 1002:5a20 00:11.0 0104: 1002:4393 (rev 40) 00:12.0 0c03: 1002:4397 00:12.2 0c03: 1002:4396 00:13.0 0c03: 1002:4397 00:13.2 0c03: 1002:4396 00:14.0 0c05: 1002:4385 (rev 42) 00:14.2 0403: 1002:4383 (rev 40) 00:14.3 0601: 1002:439d (rev 40) 00:14.4 0604: 1002:4384 (rev 40) 00:14.5 0c03: 1002:4399 00:15.0 0604: 1002:43a0 00:15.1 0604: 1002:43a1 00:15.2 0604: 1002:43a2 00:16.0 0c03: 1002:4397 00:16.2 0c03: 1002:4396 00:18.0 0600: 1022:1600 00:18.1 0600: 1022:1601 00:18.2 0600: 1022:1602 00:18.3 0600: 1022:1603 00:18.4 0600: 1022:1604 00:18.5 0600: 1022:1605 01:00.0 0300: 1002:6798 01:00.1 0403: 1002:aaa0 02:00.0 0300: 1002:6798 02:00.1 0403: 1002:aaa0 03:00.0 0c03: 1b6f:7023 (rev 01) 04:00.0 0106: 1b4b:9172 (rev 11) 05:00.0 0300: 10de:0a65 (rev a2) 05:00.1 0403: 10de:0be3 (rev a1) 06:06.0 0401: 1102:0005 06:0e.0 0c00: 1106:3044 (rev c0) 07:00.0 0200: 10ec:8168 (rev 06) 08:00.0 0c03: 1b6f:7023 (rev 01) 09:00.0 0106: 1b4b:9172 (rev 11)</code></pre></div> <p class="postedit"><em>Last edited by chUpa (2013-09-18 16:38:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326267">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326270" class="blockpost rowodd"> <h2><span><span class="conr">#490</span> <a href="viewtopic.php?pid=1326270#p1326270">2013-09-18 16:36:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>I do not see any problem in this. In my motherboard, I have 6 pcie ports. My host using card that which is in the lower slot. Its address 0000:05:00.0. Passthrough cards have addresses 0000:01:00.0/0000:02:00.0.</p></div></blockquote></div><p>Okay, thats nice, i think i just missunderstood some earlier post then.</p></div></blockquote></div><p>As long as its not your primary card you could use any slot you want</p></div></blockquote></div><p>When does a graphic card become my primary one?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326273" class="blockpost roweven"> <h2><span><span class="conr">#491</span> <a href="viewtopic.php?pid=1326273#p1326273">2013-09-18 16:39:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>Okay, thats nice, i think i just missunderstood some earlier post then.</p></div></blockquote></div><p>As long as its not your primary card you could use any slot you want</p></div></blockquote></div><p>When does a graphic card become my primary one?</p></div></blockquote></div><p>Its the one that you see the POST messages</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326276" class="blockpost rowodd"> <h2><span><span class="conr">#492</span> <a href="viewtopic.php?pid=1326276#p1326276">2013-09-18 16:41:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>Okay, thats nice, i think i just missunderstood some earlier post then.</p></div></blockquote></div><p>As long as its not your primary card you could use any slot you want</p></div></blockquote></div><p>When does a graphic card become my primary one?</p></div></blockquote></div><p>I think you should choose it in you BIOS. I boot from PEG3 card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326278" class="blockpost roweven"> <h2><span><span class="conr">#493</span> <a href="viewtopic.php?pid=1326278#p1326278">2013-09-18 16:44:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>Yes, correctly. With one card Windows work fine, and i have to install Catalyst.</p><p>I have 2 radeon 01:00.0/1 and 02:00.0/1 and Nvidia 210 05:00.0/1 (open source driver), radeon and fglrx modules blacklisted.</p><p>I try add my second card in PCI_DEVICES=&quot;02:00.0&quot; its not working, shows no signal too.</p><p>just in case, i was add my ati cards in pci-stub, and try. Nothing has changed.</p><div class="codebox"><pre class="vscroll"><code>lspci 00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx0 port B) (rev 02) 00:00.2 IOMMU: Advanced Micro Devices, Inc. [AMD/ATI] RD990 I/O Memory Management Unit (IOMMU) 00:02.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port B) 00:03.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port C) 00:09.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port H) 00:0a.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx1 port A) 00:0c.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890S PCI Express bridge for GPP2 port 1 00:11.0 RAID bus controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [RAID5 mode] (rev 40) 00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 42) 00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40) 00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40) 00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40) 00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller 00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) 00:15.1 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 1) 00:15.2 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB900 PCI to PCI bridge (PCIE port 2) 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 0 00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 1 00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 2 00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 3 00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 4 00:18.5 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 5 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] 02:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970] 02:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] 03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 04:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller (rev 11) 05:00.0 VGA compatible controller: NVIDIA Corporation GT218 [GeForce 210] (rev a2) 05:00.1 Audio device: NVIDIA Corporation High Definition Audio Controller (rev a1) 06:06.0 Multimedia audio controller: Creative Labs SB X-Fi 06:0e.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6306/7/8 [Fire II(M)] IEEE 1394 OHCI Controller (rev c0) 07:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168 PCI Express Gigabit Ethernet controller (rev 06) 08:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 09:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9172 SATA 6Gb/s Controller (rev 11)</code></pre></div><div class="codebox"><pre class="vscroll"><code>lspci -n 00:00.0 0600: 1002:5a14 (rev 02) 00:00.2 0806: 1002:5a23 00:02.0 0604: 1002:5a16 00:03.0 0604: 1002:5a17 00:09.0 0604: 1002:5a1c 00:0a.0 0604: 1002:5a1d 00:0c.0 0604: 1002:5a20 00:11.0 0104: 1002:4393 (rev 40) 00:12.0 0c03: 1002:4397 00:12.2 0c03: 1002:4396 00:13.0 0c03: 1002:4397 00:13.2 0c03: 1002:4396 00:14.0 0c05: 1002:4385 (rev 42) 00:14.2 0403: 1002:4383 (rev 40) 00:14.3 0601: 1002:439d (rev 40) 00:14.4 0604: 1002:4384 (rev 40) 00:14.5 0c03: 1002:4399 00:15.0 0604: 1002:43a0 00:15.1 0604: 1002:43a1 00:15.2 0604: 1002:43a2 00:16.0 0c03: 1002:4397 00:16.2 0c03: 1002:4396 00:18.0 0600: 1022:1600 00:18.1 0600: 1022:1601 00:18.2 0600: 1022:1602 00:18.3 0600: 1022:1603 00:18.4 0600: 1022:1604 00:18.5 0600: 1022:1605 01:00.0 0300: 1002:6798 01:00.1 0403: 1002:aaa0 02:00.0 0300: 1002:6798 02:00.1 0403: 1002:aaa0 03:00.0 0c03: 1b6f:7023 (rev 01) 04:00.0 0106: 1b4b:9172 (rev 11) 05:00.0 0300: 10de:0a65 (rev a2) 05:00.1 0403: 10de:0be3 (rev a1) 06:06.0 0401: 1102:0005 06:0e.0 0c00: 1106:3044 (rev c0) 07:00.0 0200: 10ec:8168 (rev 06) 08:00.0 0c03: 1b6f:7023 (rev 01) 09:00.0 0106: 1b4b:9172 (rev 11)</code></pre></div></div></blockquote></div><p>Are you sure the nvidia card is your primary card? have you tried to comment out the VBIOS variable?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326278">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326286" class="blockpost rowodd"> <h2><span><span class="conr">#494</span> <a href="viewtopic.php?pid=1326286#p1326286">2013-09-18 16:56:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Are you sure the nvidia card is your primary card? have you tried to comment out the VBIOS variable?</p></div></blockquote></div><p>I draw my conclusions from the fact that the bios and arch boot and work from my nvidia card, even if I turn off second HDMI cable from my PC.</p><p>when I did like this:</p><div class="codebox"><pre><code>#GPU1=&quot;02:00.0&quot; #GPU_SND1=&quot;02:00.1&quot; #VBIOS0=&quot;/home/cd/rom0.rom&quot; #VBIOS1=&quot;/home/cd/rom1.rom&quot;</code></pre></div><p>all working fine. The only difference is fan in my ati card is worked louder until not windows boot.</p> <p class="postedit"><em>Last edited by chUpa (2013-09-18 17:06:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326286">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326312" class="blockpost roweven"> <h2><span><span class="conr">#495</span> <a href="viewtopic.php?pid=1326312#p1326312">2013-09-18 17:48:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>and when i try this:</p><div class="codebox"><pre><code>PCI_DEVICES=&quot;02:00.0 02:00.1&quot; GPU0=&quot;01:00.0&quot; GPU_SND0=&quot;01:00.1&quot; #GPU1=&quot;02:00.0&quot; #GPU_SND1=&quot;02:00.1&quot; VBIOS0=&quot;/home/cd/rom0.rom&quot; (or #VBIOS0=&quot;/home/cd/rom0.rom&quot;) #VBIOS1=&quot;/home/cd/rom1.rom&quot;</code></pre></div><p>I have no effect. No signal as global result. (:<br />But my credo never give up, hold on to the result! (;</p> <p class="postedit"><em>Last edited by chUpa (2013-09-18 17:51:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326312">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326321" class="blockpost rowodd"> <h2><span><span class="conr">#496</span> <a href="viewtopic.php?pid=1326321#p1326321">2013-09-18 18:08:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>and when i try this:</p><div class="codebox"><pre><code>PCI_DEVICES=&quot;02:00.0 02:00.1&quot; GPU0=&quot;01:00.0&quot; GPU_SND0=&quot;01:00.1&quot; #GPU1=&quot;02:00.0&quot; #GPU_SND1=&quot;02:00.1&quot; VBIOS0=&quot;/home/cd/rom0.rom&quot; (or #VBIOS0=&quot;/home/cd/rom0.rom&quot;) #VBIOS1=&quot;/home/cd/rom1.rom&quot;</code></pre></div><p>I have no effect. No signal as global result. (:<br />But my credo never give up, hold on to the result! (;</p></div></blockquote></div><p>comment out the VBIOS line</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326325" class="blockpost roweven"> <h2><span><span class="conr">#497</span> <a href="viewtopic.php?pid=1326325#p1326325">2013-09-18 18:18:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>comment out the VBIOS line</p></div></blockquote></div><br /><p>Tried both variants</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326325">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326569" class="blockpost rowodd"> <h2><span><span class="conr">#498</span> <a href="viewtopic.php?pid=1326569#p1326569">2013-09-19 08:17:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Today has updated the system. Now i have</p><div class="codebox"><pre><code>Linux barby 3.11.1-1-ARCH #1 SMP PREEMPT Sat Sep 14 19:30:21 CEST 2013 x86_64 GNU/Linux</code></pre></div><p>and</p><div class="codebox"><pre><code>qemu-git 1.7.r28759.g6c2679f-1</code></pre></div><div class="codebox"><pre><code>cat /proc/cmdline BOOT_IMAGE=/vmlinuz-linux root=UUID=df9ed763-fa79-41fd-8314-ca4a108ee274 rw pci-stub.ids=1002:6798,1002:aaa0,1102:0005</code></pre></div><div class="codebox"><pre><code>ls /etc/modprobe.d/ blacklist.conf kvm.conf vfio_iommu_type1.conf</code></pre></div><div class="codebox"><pre><code>cat /etc/modprobe.d/blacklist.conf blacklist radeon blacklist fglrx</code></pre></div><div class="codebox"><pre><code>cat /etc/modprobe.d/kvm.conf options kvm ignore_msrs=1</code></pre></div><div class="codebox"><pre><code>cat /etc/modprobe.d/vfio_iommu_type1.conf options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><div class="codebox"><pre><code>ls /etc/modules-load.d/ kvm_amd.conf kvm.conf vfio.conf vfio_iommu_type1.conf vfio_pci.conf</code></pre></div><div class="codebox"><pre><code>cat /etc/modules-load.d/kvm_amd.conf kvm_amd</code></pre></div><div class="codebox"><pre><code>cat /etc/modules-load.d/kvm.conf kvm</code></pre></div><div class="codebox"><pre><code> cat /etc/modules-load.d/vfio.conf vfio</code></pre></div><div class="codebox"><pre><code>cat /etc/modules-load.d/vfio_iommu_type1.conf vfio_iommu_type1</code></pre></div><div class="codebox"><pre><code>cat /etc/modules-load.d/vfio_pci.conf vfio_pci</code></pre></div><p>Without any patches. Nothing has changed. Only one card working. When I try a second, I have no signal.</p> <p class="postedit"><em>Last edited by chUpa (2013-09-19 08:18:45)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326569">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326848" class="blockpost roweven"> <h2><span><span class="conr">#499</span> <a href="viewtopic.php?pid=1326848#p1326848">2013-09-19 19:44:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74747">gosheto</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:0xd3ad@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>i`m now here:<br /><span class="postimg"><img src="http://s15.postimg.org/ad6dnw2zv/Selection_001.png" alt="FluxBB bbcode test" /></span></p><p>Second monitor, connected to passthrough VGA - no output (black screen).</p><p>Boot guest using this script:</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 \ -enable-kvm \ -M q35 \ -m 4096 \ -cpu host \ -bios /home/gosheto/Downloads/bios.bin \ -vga cirrus \ -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,romfile=/home/gosheto/Downloads/Palit.GTX580.1536.101102.rom \ -device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/home/gosheto/VM/windowsq35.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \ -drive file=/home/gosheto/VM/windows7.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \ -boot menu=on</code></pre></div><p>If using<br />-vga none and x-vga=on get black QEMU windows and system freeze after 10 seconds (1 of cpu get 100% load).</p><p>In dmesg get this messages:</p><div class="codebox"><pre><code>vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:05:00.1 hiding ecap 0x0@0x100 kvm: zapping shadow pages for mmio generation wraparound assign device 0:5:0.0 assign device 0:5:0.1 etc</code></pre></div><br /><p>Any ideas?</p><p>PS: 0000:05:00.1 (NVIDIA HD Audio working properly)</p><p>Thank you in advance!</p> <p class="postedit"><em>Last edited by gosheto (2013-09-19 19:46:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326848">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1326852" class="blockpost rowodd"> <h2><span><span class="conr">#500</span> <a href="viewtopic.php?pid=1326852#p1326852">2013-09-19 19:52:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gosheto wrote:</cite><blockquote><div><p>Hello,</p><p>i`m now here:<br /><a href="http://s15.postimg.org/ad6dnw2zv/Selection_001.png" rel="nofollow">http://s15.postimg.org/ad6dnw2zv/Selection_001.png</a></p><p>Second monitor, connected to passthrough VGA - no output (black screen).</p><p>Boot guest using this script:</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 \ -enable-kvm \ -M q35 \ -m 4096 \ -cpu host \ -bios /home/gosheto/Downloads/bios.bin \ -vga cirrus \ -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,romfile=/home/gosheto/Downloads/Palit.GTX580.1536.101102.rom \ -device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/home/gosheto/VM/windowsq35.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \ -drive file=/home/gosheto/VM/windows7.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \ -boot menu=on</code></pre></div><p>If using<br />-vga none and x-vga=on get black QEMU windows and system freeze after 10 seconds (1 of cpu get 100% load).</p><p>In dmesg get this messages:</p><div class="codebox"><pre><code>vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) vfio_ecap_init: 0000:05:00.1 hiding ecap 0x0@0x100 kvm: zapping shadow pages for mmio generation wraparound assign device 0:5:0.0 assign device 0:5:0.1 etc</code></pre></div><br /><p>Any ideas?</p><p>PS: 0000:05:00.1 (NVIDIA HD Audio working properly)</p><p>Thank you in advance!</p></div></blockquote></div><p>Never seen that message before what kernel/qemu version are you using?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1326852">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=19">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=18">18</a> <a href="viewtopic.php?id=162768&amp;p=19">19</a> <strong>20</strong> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=21">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
