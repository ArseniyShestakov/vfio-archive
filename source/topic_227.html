<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 227) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=227" title="Page 227" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=226" title="Page 226" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=228" title="Page 228" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=226">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <strong>227</strong> <a href="viewtopic.php?id=162768&amp;p=228">228</a> <a href="viewtopic.php?id=162768&amp;p=229">229</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=228">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1545215" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5651</span> <a href="viewtopic.php?pid=1545215#p1545215">2015-07-16 23:45:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Seems like OVMF is storming today:<br />I am unable not only to run windows 7 with AMD, but i am trying to just install it without any attached devices - and it crashes and crashes and crashes and hangs with 4 cores 100% usage.</p><p>...i should plan a new build, this one is starting to drive me nuts.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-16 23:45:51)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545215">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545264" class="blockpost roweven"> <h2><span><span class="conr">#5652</span> <a href="viewtopic.php?pid=1545264#p1545264">2015-07-17 04:21:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Windows 10 + OVMF + virtio-blk-pci is a no-go .<br />...<br />Anyone using Windows 10 ?</p></div></blockquote></div><p>I have been using Windows 10 for many months now, and just last night updated to the latest 10240 Build (RTM Supposidlt). I don&#039;t know what virtio-blk-pci is though? Is it like mapping a disk to the VM? I use Raw images.</p><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Can someone with 980 try soft mod (with fake id patch on qemu) to quadro m5000 and try latest geforce driver with hyper-v on?</p></div></blockquote></div><p>Slis, can you please explain or link to where you can change the PCI IDs via Qemu? I have a GTX760 that i&#039;d like to soft-mod via Qemu. I also have a GTX465 which I soft-modded via rom hacks into a Quadro 5k. It worked fine with ESXi but the performance isn&#039;t near my GTX760 for gaming... I would love to have my 760 be represented as a Quadro so I can enable the HyperV Flags - assuming it will help performance.</p><p>Also, I have been using the latest Windows 10 NVIDIA Drivers provided by Windows Update without issue.</p></div></blockquote></div><p>Patch is there...<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1475170#p1475170" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1475170</a></p></div></blockquote></div><p>Is this patch still upstream? What versions of QEMU does it work with? I currently have qemu-2.3.0-5.fc22.x86_64 installed</p> <p class="postedit"><em>Last edited by The_Moves (2015-07-17 04:21:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545264">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545276" class="blockpost rowodd"> <h2><span><span class="conr">#5653</span> <a href="viewtopic.php?pid=1545276#p1545276">2015-07-17 06:29:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Can someone with 980 try soft mod (with fake id patch on qemu) to quadro m5000 and try latest geforce driver with hyper-v on?</p></div></blockquote></div><p>I&#039;ve got a 980, can you tell me what I need to do to try the soft-mod?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545279" class="blockpost roweven"> <h2><span><span class="conr">#5654</span> <a href="viewtopic.php?pid=1545279#p1545279">2015-07-17 07:00:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>That patch is aw&#039;s improvisation, i don&#039;t think it will be upstream ever....</p><p>Well you can patch qemu with this patch <a href="https://bbs.archlinux.org/viewtopic.php?pid=1475170#p1475170" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1475170</a></p><p>and change card id-s to quadro m5000, I guess its&#160; 10de:13f0, then try latest geforce driver with hyper-v on.</p> <p class="postedit"><em>Last edited by slis (2015-07-17 07:01:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545283" class="blockpost rowodd"> <h2><span><span class="conr">#5655</span> <a href="viewtopic.php?pid=1545283#p1545283">2015-07-17 07:15:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Don&#039;t you also need a rom file to pass along with the spoofed pciid? Unfortunately Maxwell Quadro rom dumps don&#039;t seem to be available anywhere. They are not in Techpowerup&#039;s VGA bios database either. I&#039;m very interested in trying to masquerade my Titan X as M6000.</p><p>Regarding OVMF problems, I think it&#039;s something to do with the latest versions. I got a BSOD in Windows 8 even with any configuration (no passthrough, just virtualised everything). An old build, in my case the sata patched binary, worked fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545283">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545285" class="blockpost roweven"> <h2><span><span class="conr">#5656</span> <a href="viewtopic.php?pid=1545285#p1545285">2015-07-17 07:17:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah, forgot about bios ... it should show up soon... you can try with no rom or with default one, it may work....</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545285">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545291" class="blockpost rowodd"> <h2><span><span class="conr">#5657</span> <a href="viewtopic.php?pid=1545291#p1545291">2015-07-17 07:41:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Yeah, forgot about bios ... it should show up soon... you can try with no rom or with default one, it may work....</p></div></blockquote></div><p>It won&#039;t, telling the VM that the hardware ID is different from what the GPU claims will only cause more problems.<br />@impulse_255<br />Do you know the last version of OVMF that worked for you? I think it&#039;s probably the best shot I have at the moment, besides surgery on the GPU.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545291">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545294" class="blockpost roweven"> <h2><span><span class="conr">#5658</span> <a href="viewtopic.php?pid=1545294#p1545294">2015-07-17 07:45:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well I just tried my 680 as grid k2 without grid k2 romfile, and it works....</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545294">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545298" class="blockpost rowodd"> <h2><span><span class="conr">#5659</span> <a href="viewtopic.php?pid=1545298#p1545298">2015-07-17 07:54:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Yeah, forgot about bios ... it should show up soon... you can try with no rom or with default one, it may work....</p></div></blockquote></div><p>It won&#039;t, telling the VM that the hardware ID is different from what the GPU claims will only cause more problems.<br />@impulse_255<br />Do you know the last version of OVMF that worked for you? I think it&#039;s probably the best shot I have at the moment, besides surgery on the GPU.</p></div></blockquote></div><p>I&#039;m using the one linked from this post: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1518188#p1518188" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1518188</a></p><p>I have not tried any other versions yet. I used SeaBIOS before and switched to OVMF a week ago. Sadly, the sata boot feature isn&#039;t working, probably because of the crappy Marvell controller.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545298">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545342" class="blockpost roweven"> <h2><span><span class="conr">#5660</span> <a href="viewtopic.php?pid=1545342#p1545342">2015-07-17 11:25:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71471">dRaiser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Poland</span></dd> <dd><span>Registered: 2013-05-20</span></dd> <dd><span>Posts: 49</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pw@draiser.net">Email</a></span> <span class="website"><a href="http://draiser.net/en" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve discovered that after launching (and powering off) Linux guest, I cannot later start Windows guest, need to restart host. Well, so long with Linux guest at this moment then.</p><p>Edit: It was different issue: machine was hanging when powering because it had problem to take integrated sound device. Pulseaudio kill is helpful here.</p> <p class="postedit"><em>Last edited by dRaiser (2015-07-18 03:40:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545342">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545368" class="blockpost rowodd"> <h2><span><span class="conr">#5661</span> <a href="viewtopic.php?pid=1545368#p1545368">2015-07-17 12:56:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Quadro cards operate as a secondary display, the GPU ROM isn&#039;t used.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545384" class="blockpost roweven"> <h2><span><span class="conr">#5662</span> <a href="viewtopic.php?pid=1545384#p1545384">2015-07-17 14:40:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I recently started using a M-Audio 1010lt PCI soundcard (via a ASMedia ASM1083 PCIe to PCI bridge) for my host audio. But ever since, I&#039;ve been getting this strange DMAR flood in my dmesg whenever the sound card is being used:</p><div class="codebox"><pre><code>[64721.567981] dmar: DRHD: handling fault status reg 3 [64721.567998] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [64721.568080] dmar: DRHD: handling fault status reg 3 [64721.568082] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [64721.716747] dmar: DRHD: handling fault status reg 3 [64721.716751] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set ...</code></pre></div><p>As I was originally only using just &quot;intel_iommu=on,igfx_off&quot;, I thought adding the &quot;iommu=pt&quot; would help to get rid of this problem, because it is supposed to disable the DMAR. However, it would appear that adding the &quot;iommu=pt&quot; changed nothing.</p><p>I haven&#039;t noticed any other ill effects than my dmesg being flooded. I was hoping perhaps <strong>aw</strong> knows something about this?</p><p><strong>The interesting bits from dmesg:</strong></p><div class="codebox"><pre class="vscroll"><code>[ 0.000000] Linux version 4.0.0-2-amd64 (debian-kernel@lists.debian.org) (gcc version 4.9.3 (Debian 4.9.3-1) ) #1 SMP Debian 4.0.8-1 (2015-07-11) [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-4.0.0-2-amd64 root=/dev/mapper/main-lvroot ro consoleblank=0 iommu=pt intel_iommu=on,igfx_off [ 0.000000] BIOS-e820: [mem 0x0000000000000000-0x0000000000057fff] usable [ 0.000000] BIOS-e820: [mem 0x0000000000058000-0x0000000000058fff] reserved [ 0.000000] BIOS-e820: [mem 0x0000000000059000-0x000000000009dfff] usable [ 0.000000] BIOS-e820: [mem 0x000000000009e000-0x000000000009ffff] reserved [ 0.000000] BIOS-e820: [mem 0x0000000000100000-0x000000006ea58fff] usable [ 0.000000] BIOS-e820: [mem 0x000000006ea59000-0x000000006ea5ffff] ACPI NVS [ 0.000000] BIOS-e820: [mem 0x000000006ea60000-0x000000006f672fff] usable [ 0.000000] BIOS-e820: [mem 0x000000006f673000-0x000000006fb7cfff] reserved [ 0.000000] BIOS-e820: [mem 0x000000006fb7d000-0x000000008be94fff] usable [ 0.000000] BIOS-e820: [mem 0x000000008be95000-0x000000008c09afff] reserved [ 0.000000] BIOS-e820: [mem 0x000000008c09b000-0x000000008c0dbfff] usable [ 0.000000] BIOS-e820: [mem 0x000000008c0dc000-0x000000008c187fff] ACPI NVS [ 0.000000] BIOS-e820: [mem 0x000000008c188000-0x000000008cf84fff] reserved [ 0.000000] BIOS-e820: [mem 0x000000008cf85000-0x000000008cffefff] type 20 [ 0.000000] BIOS-e820: [mem 0x000000008cfff000-0x000000008cffffff] usable [ 0.000000] BIOS-e820: [mem 0x000000008f800000-0x00000000cf9fffff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000f8000000-0x00000000fbffffff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000fec00000-0x00000000fec00fff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000fed00000-0x00000000fed03fff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000fed1c000-0x00000000fed1ffff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000fee00000-0x00000000fee00fff] reserved [ 0.000000] BIOS-e820: [mem 0x00000000ff000000-0x00000000ffffffff] reserved [ 0.000000] BIOS-e820: [mem 0x0000000100000000-0x000000042f5fffff] usable [ 0.000000] NX (Execute Disable) protection: active [ 0.000000] efi: EFI v2.31 by American Megatrends [ 0.000000] efi: ACPI=0x8c164000 ACPI 2.0=0x8c164000 SMBIOS=0x8cf83498 [ 0.000000] efi: mem00: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000000000000-0x0000000000058000) (0MB) [ 0.000000] efi: mem01: [Reserved | | | | | |WB|WT|WC|UC] range=[0x0000000000058000-0x0000000000059000) (0MB) [ 0.000000] efi: mem02: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000000059000-0x000000000009e000) (0MB) [ 0.000000] efi: mem03: [Reserved | | | | | |WB|WT|WC|UC] range=[0x000000000009e000-0x00000000000a0000) (0MB) [ 0.000000] efi: mem04: [Loader Data | | | | | |WB|WT|WC|UC] range=[0x0000000000100000-0x0000000000f6f000) (14MB) [ 0.000000] efi: mem05: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000000f6f000-0x00000000359c4000) (842MB) [ 0.000000] efi: mem06: [Loader Data | | | | | |WB|WT|WC|UC] range=[0x00000000359c4000-0x0000000036cda000) (19MB) [ 0.000000] efi: mem07: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000036cda000-0x0000000049afd000) (302MB) [ 0.000000] efi: mem08: [Loader Data | | | | | |WB|WT|WC|UC] range=[0x0000000049afd000-0x000000006bc9c000) (545MB) [ 0.000000] efi: mem09: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x000000006bc9c000-0x000000006ea3b000) (45MB) [ 0.000000] efi: mem10: [Loader Code | | | | | |WB|WT|WC|UC] range=[0x000000006ea3b000-0x000000006ea59000) (0MB) [ 0.000000] efi: mem11: [ACPI Memory NVS | | | | | |WB|WT|WC|UC] range=[0x000000006ea59000-0x000000006ea60000) (0MB) [ 0.000000] efi: mem12: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x000000006ea60000-0x000000006ebb5000) (1MB) [ 0.000000] efi: mem13: [Boot Code | | | | | |WB|WT|WC|UC] range=[0x000000006ebb5000-0x000000006f648000) (10MB) [ 0.000000] efi: mem14: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x000000006f648000-0x000000006f658000) (0MB) [ 0.000000] efi: mem15: [Boot Code | | | | | |WB|WT|WC|UC] range=[0x000000006f658000-0x000000006f66a000) (0MB) [ 0.000000] efi: mem16: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x000000006f66a000-0x000000006f673000) (0MB) [ 0.000000] efi: mem17: [Runtime Data |RUN| | | | |WB|WT|WC|UC] range=[0x000000006f673000-0x000000006fb7d000) (5MB) [ 0.000000] efi: mem18: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x000000006fb7d000-0x000000006fb8c000) (0MB) [ 0.000000] efi: mem19: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x000000006fb8c000-0x00000000885b4000) (394MB) [ 0.000000] efi: mem20: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x00000000885b4000-0x000000008894c000) (3MB) [ 0.000000] efi: mem21: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x000000008894c000-0x0000000088a41000) (0MB) [ 0.000000] efi: mem22: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088a41000-0x0000000088a62000) (0MB) [ 0.000000] efi: mem23: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088a62000-0x0000000088a65000) (0MB) [ 0.000000] efi: mem24: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088a65000-0x0000000088a6d000) (0MB) [ 0.000000] efi: mem25: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088a6d000-0x0000000088a7a000) (0MB) [ 0.000000] efi: mem26: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088a7a000-0x0000000088a8e000) (0MB) [ 0.000000] efi: mem27: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088a8e000-0x0000000088a92000) (0MB) [ 0.000000] efi: mem28: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088a92000-0x0000000088a99000) (0MB) [ 0.000000] efi: mem29: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088a99000-0x0000000088a9a000) (0MB) [ 0.000000] efi: mem30: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088a9a000-0x0000000088c2a000) (1MB) [ 0.000000] efi: mem31: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088c2a000-0x0000000088c2f000) (0MB) [ 0.000000] efi: mem32: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088c2f000-0x0000000088dcf000) (1MB) [ 0.000000] efi: mem33: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088dcf000-0x0000000088dd1000) (0MB) [ 0.000000] efi: mem34: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088dd1000-0x0000000088dd8000) (0MB) [ 0.000000] efi: mem35: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088dd8000-0x0000000088ddb000) (0MB) [ 0.000000] efi: mem36: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088ddb000-0x0000000088de5000) (0MB) [ 0.000000] efi: mem37: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088de5000-0x0000000088de8000) (0MB) [ 0.000000] efi: mem38: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088de8000-0x0000000088dfb000) (0MB) [ 0.000000] efi: mem39: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000088dfb000-0x0000000088dfc000) (0MB) [ 0.000000] efi: mem40: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x0000000088dfc000-0x000000008acdb000) (30MB) [ 0.000000] efi: mem41: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x000000008acdb000-0x000000008bba0000) (14MB) [ 0.000000] efi: mem42: [Boot Code | | | | | |WB|WT|WC|UC] range=[0x000000008bba0000-0x000000008be95000) (2MB) [ 0.000000] efi: mem43: [Reserved | | | | | |WB|WT|WC|UC] range=[0x000000008be95000-0x000000008bf0d000) (0MB) [ 0.000000] efi: mem44: [Reserved | | | | | |WB|WT|WC|UC] range=[0x000000008bf0d000-0x000000008c09b000) (1MB) [ 0.000000] efi: mem45: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x000000008c09b000-0x000000008c0d2000) (0MB) [ 0.000000] efi: mem46: [Loader Data | | | | | |WB|WT|WC|UC] range=[0x000000008c0d2000-0x000000008c0dc000) (0MB) [ 0.000000] efi: mem47: [ACPI Memory NVS | | | | | |WB|WT|WC|UC] range=[0x000000008c0dc000-0x000000008c178000) (0MB) [ 0.000000] efi: mem48: [ACPI Memory NVS | | | | | |WB|WT|WC|UC] range=[0x000000008c178000-0x000000008c17a000) (0MB) [ 0.000000] efi: mem49: [ACPI Memory NVS | | | | | |WB|WT|WC|UC] range=[0x000000008c17a000-0x000000008c188000) (0MB) [ 0.000000] efi: mem50: [Runtime Data |RUN| | | | |WB|WT|WC|UC] range=[0x000000008c188000-0x000000008ce7e000) (12MB) [ 0.000000] efi: mem51: [Runtime Data |RUN| | | | |WB|WT|WC|UC] range=[0x000000008ce7e000-0x000000008cee6000) (0MB) [ 0.000000] efi: mem52: [Runtime Data |RUN| | | | |WB|WT|WC|UC] range=[0x000000008cee6000-0x000000008cee8000) (0MB) [ 0.000000] efi: mem53: [Runtime Data |RUN| | | | |WB|WT|WC|UC] range=[0x000000008cee8000-0x000000008cf85000) (0MB) [ 0.000000] efi: mem54: [Runtime Code |RUN| | | | |WB|WT|WC|UC] range=[0x000000008cf85000-0x000000008cf9d000) (0MB) [ 0.000000] efi: mem55: [Runtime Code |RUN| | | | |WB|WT|WC|UC] range=[0x000000008cf9d000-0x000000008cfff000) (0MB) [ 0.000000] efi: mem56: [Boot Data | | | | | |WB|WT|WC|UC] range=[0x000000008cfff000-0x000000008d000000) (0MB) [ 0.000000] efi: mem57: [Conventional Memory| | | | | |WB|WT|WC|UC] range=[0x0000000100000000-0x000000042f600000) (13046MB) [ 0.000000] efi: mem58: [Reserved | | | | | | | | | ] range=[0x000000008f800000-0x00000000cfa00000) (1026MB) [ 0.000000] efi: mem59: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000f8000000-0x00000000fc000000) (64MB) [ 0.000000] efi: mem60: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000fec00000-0x00000000fec01000) (0MB) [ 0.000000] efi: mem61: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000fed00000-0x00000000fed04000) (0MB) [ 0.000000] efi: mem62: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000fed1c000-0x00000000fed20000) (0MB) [ 0.000000] efi: mem63: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000fee00000-0x00000000fee01000) (0MB) [ 0.000000] efi: mem64: [Memory Mapped I/O |RUN| | | | | | | |UC] range=[0x00000000ff000000-0x0000000100000000) (16MB) [ 0.000000] ACPI: Early table checksum verification disabled [ 0.000000] ACPI: RSDP 0x000000008C164000 000024 (v02 ALASKA) [ 0.000000] ACPI: XSDT 0x000000008C164088 00008C (v01 ALASKA A M I 01072009 AMI 00010013) [ 0.000000] ACPI: FACP 0x000000008C16EC08 00010C (v05 ALASKA A M I 01072009 AMI 00010013) [ 0.000000] ACPI: DSDT 0x000000008C1641A8 00AA59 (v02 ALASKA A M I 00000240 INTL 20091112) [ 0.000000] ACPI: FACS 0x000000008C186080 000040 [ 0.000000] ACPI: APIC 0x000000008C16ED18 000092 (v03 ALASKA A M I 01072009 AMI 00010013) [ 0.000000] ACPI: FPDT 0x000000008C16EDB0 000044 (v01 ALASKA A M I 01072009 AMI 00010013) [ 0.000000] ACPI: ASF! 0x000000008C16EDF8 0000A5 (v32 INTEL HCG 00000001 TFSM 000F4240) [ 0.000000] ACPI: SSDT 0x000000008C16EEA0 000539 (v01 PmRef Cpu0Ist 00003000 INTL 20051117) [ 0.000000] ACPI: SSDT 0x000000008C16F3E0 000AD8 (v01 PmRef CpuPm 00003000 INTL 20051117) [ 0.000000] ACPI: SSDT 0x000000008C16FEB8 0001C7 (v01 PmRef LakeTiny 00003000 INTL 20051117) [ 0.000000] ACPI: MCFG 0x000000008C170080 00003C (v01 ALASKA A M I 01072009 MSFT 00000097) [ 0.000000] ACPI: HPET 0x000000008C1700C0 000038 (v01 ALASKA A M I 01072009 AMI. 00000005) [ 0.000000] ACPI: SSDT 0x000000008C1700F8 00036D (v01 SataRe SataTabl 00001000 INTL 20091112) [ 0.000000] ACPI: SSDT 0x000000008C170468 003493 (v01 SaSsdt SaSsdt 00003000 INTL 20091112) [ 0.000000] ACPI: AAFT 0x000000008C173900 000235 (v01 ALASKA OEMAAFT 01072009 MSFT 00000097) [ 0.000000] ACPI: DMAR 0x000000008C173B38 0000B8 (v01 INTEL HSW 00000001 INTL 00000001) [ 0.000000] ACPI: Local APIC address 0xfee00000 [ 0.020185] dmar: Host address width 39 [ 0.020188] dmar: DRHD base: 0x000000fed90000 flags: 0x0 [ 0.020195] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a [ 0.020198] dmar: DRHD base: 0x000000fed91000 flags: 0x1 [ 0.020202] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008020660462 ecap f010da [ 0.020204] dmar: RMRR base: 0x0000008c032000 end: 0x0000008c03efff [ 0.020207] dmar: RMRR base: 0x000000cf800000 end: 0x000000cf9fffff [ 0.020373] dmar: DRHD: handling fault status reg 3 [ 0.020376] dmar: DMAR:[DMA Read] Request device [00:02.0] fault addr 8ff50000 DMAR:[fault reason 06] PTE Read access is not set [ 0.020381] Queued invalidation will be enabled to support x2apic and Intr-remapping. [ 0.020389] Enabled IRQ remapping in x2apic mode [ 0.020390] x2apic enabled [ 0.020395] Switched APIC routing to cluster x2apic. [ 0.324675] pci 0000:07:00.0: [1b21:1080] type 01 class 0x060401 [ 0.325104] pci 0000:07:00.0: System wakeup disabled by ACPI [ 0.325200] pci 0000:08:01.0: [1412:1712] type 00 class 0x040100 [ 0.325225] pci 0000:08:01.0: reg 0x10: [io 0xa040-0xa05f] [ 0.325237] pci 0000:08:01.0: reg 0x14: [io 0xa070-0xa07f] [ 0.325248] pci 0000:08:01.0: reg 0x18: [io 0xa060-0xa06f] [ 0.325259] pci 0000:08:01.0: reg 0x1c: [io 0xa000-0xa03f] [ 0.325344] pci 0000:08:01.0: supports D2 [ 0.325433] pci 0000:07:00.0: PCI bridge to [bus 08] (subtractive decode) [ 0.325441] pci 0000:07:00.0: bridge window [io 0xa000-0xafff] [ 0.325452] pci 0000:07:00.0: bridge window [io 0xa000-0xafff] (subtractive decode) [ 0.325452] pci 0000:07:00.0: bridge window [io 0x0000-0x0cf7 window] (subtractive decode) [ 0.325453] pci 0000:07:00.0: bridge window [io 0x0d00-0xffff window] (subtractive decode) [ 0.325454] pci 0000:07:00.0: bridge window [mem 0x000a0000-0x000bffff window] (subtractive decode) [ 0.325455] pci 0000:07:00.0: bridge window [mem 0x000c0000-0x000c3fff window] (subtractive decode) [ 0.325456] pci 0000:07:00.0: bridge window [mem 0x000c4000-0x000c7fff window] (subtractive decode) [ 0.325457] pci 0000:07:00.0: bridge window [mem 0x000c8000-0x000cbfff window] (subtractive decode) [ 0.325458] pci 0000:07:00.0: bridge window [mem 0x000cc000-0x000cffff window] (subtractive decode) [ 0.325459] pci 0000:07:00.0: bridge window [mem 0x000d0000-0x000d3fff window] (subtractive decode) [ 0.325459] pci 0000:07:00.0: bridge window [mem 0x000d4000-0x000d7fff window] (subtractive decode) [ 0.325460] pci 0000:07:00.0: bridge window [mem 0x000d8000-0x000dbfff window] (subtractive decode) [ 0.325461] pci 0000:07:00.0: bridge window [mem 0x000dc000-0x000dffff window] (subtractive decode) [ 0.325462] pci 0000:07:00.0: bridge window [mem 0x000e0000-0x000e3fff window] (subtractive decode) [ 0.325463] pci 0000:07:00.0: bridge window [mem 0x000e4000-0x000e7fff window] (subtractive decode) [ 0.325464] pci 0000:07:00.0: bridge window [mem 0x000e8000-0x000ebfff window] (subtractive decode) [ 0.325465] pci 0000:07:00.0: bridge window [mem 0x000ec000-0x000effff window] (subtractive decode) [ 0.325466] pci 0000:07:00.0: bridge window [mem 0xcfa00000-0xfeafffff window] (subtractive decode) [ 0.597344] DMAR: No ATSR found [ 0.597406] IOMMU: dmar1 using Queued invalidation [ 0.597421] IOMMU: hardware identity mapping for device 0000:00:00.0 [ 0.597423] IOMMU: hardware identity mapping for device 0000:00:01.0 [ 0.597426] IOMMU: hardware identity mapping for device 0000:00:03.0 [ 0.597428] IOMMU: hardware identity mapping for device 0000:00:14.0 [ 0.597430] IOMMU: hardware identity mapping for device 0000:00:16.0 [ 0.597432] IOMMU: hardware identity mapping for device 0000:00:19.0 [ 0.597434] IOMMU: hardware identity mapping for device 0000:00:1a.0 [ 0.597436] IOMMU: hardware identity mapping for device 0000:00:1b.0 [ 0.597438] IOMMU: hardware identity mapping for device 0000:00:1c.0 [ 0.597440] IOMMU: hardware identity mapping for device 0000:00:1c.2 [ 0.597442] IOMMU: hardware identity mapping for device 0000:00:1c.3 [ 0.597444] IOMMU: hardware identity mapping for device 0000:00:1c.4 [ 0.597446] IOMMU: hardware identity mapping for device 0000:00:1c.5 [ 0.597448] IOMMU: hardware identity mapping for device 0000:00:1c.6 [ 0.597450] IOMMU: hardware identity mapping for device 0000:00:1d.0 [ 0.597452] IOMMU: hardware identity mapping for device 0000:00:1f.0 [ 0.597455] IOMMU: hardware identity mapping for device 0000:00:1f.2 [ 0.597457] IOMMU: hardware identity mapping for device 0000:00:1f.3 [ 0.597462] IOMMU: hardware identity mapping for device 0000:01:00.0 [ 0.597464] IOMMU: hardware identity mapping for device 0000:01:00.1 [ 0.597469] IOMMU: hardware identity mapping for device 0000:03:00.0 [ 0.597475] IOMMU: hardware identity mapping for device 0000:04:00.0 [ 0.597480] IOMMU: hardware identity mapping for device 0000:05:00.0 [ 0.597485] IOMMU: hardware identity mapping for device 0000:06:00.0 [ 0.597487] IOMMU: Setting RMRR: [ 0.597489] Ignoring identity map for HW passthrough device 0000:00:14.0 [0x8c032000 - 0x8c03efff] [ 0.597492] Ignoring identity map for HW passthrough device 0000:00:1a.0 [0x8c032000 - 0x8c03efff] [ 0.597495] Ignoring identity map for HW passthrough device 0000:00:1d.0 [0x8c032000 - 0x8c03efff] [ 0.597498] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.597499] Ignoring identity map for HW passthrough device 0000:00:1f.0 [0x0 - 0xffffff] [ 0.597505] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O [ 34.346230] dmar: DRHD: handling fault status reg 3 [ 34.346244] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.494973] dmar: DRHD: handling fault status reg 3 [ 34.494976] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.643650] dmar: DRHD: handling fault status reg 3 [ 34.643653] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.643738] dmar: DRHD: handling fault status reg 3 [ 34.643740] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.792415] dmar: DRHD: handling fault status reg 3 [ 34.792423] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.792532] dmar: DRHD: handling fault status reg 3 [ 34.792534] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.941181] dmar: DRHD: handling fault status reg 3 [ 34.941185] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 34.941269] dmar: DRHD: handling fault status reg 3 [ 34.941272] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [ 35.089969] dmar: DRHD: handling fault status reg 3 [ 35.089983] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 ...</code></pre></div><p><strong>lsgroups.sh</strong></p><div class="codebox"><pre class="vscroll"><code>### Group 0 ### 00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) ### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770/8760 / R7 250X] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] ### Group 2 ### 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) ### Group 3 ### 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 05) ### Group 4 ### 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04) ### Group 5 ### 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-V (rev 05) ### Group 6 ### 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 05) ### Group 7 ### 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 05) ### Group 8 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d5) ### Group 9 ### 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d5) ### Group 10 ### 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d5) ### Group 11 ### 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d5) ### Group 12 ### 00:1c.5 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #6 (rev d5) ### Group 13 ### 00:1c.6 PCI bridge: Intel Corporation 82801 PCI Bridge (rev d5) 07:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) 08:01.0 Multimedia audio controller: VIA Technologies Inc. ICE1712 [Envy24] PCI Multi-Channel I/O Controller (rev 02) ### Group 14 ### 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 05) ### Group 15 ### 00:1f.0 ISA bridge: Intel Corporation Z87 Express LPC Controller (rev 05) 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 05) 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 05) ### Group 16 ### 03:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) ### Group 17 ### 04:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03) ### Group 18 ### 05:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) ### Group 19 ### 06:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03)</code></pre></div><p><strong>lspci -vv:</strong></p><div class="codebox"><pre><code>07:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) (prog-if 01 [Subtractive decode]) Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Bus: primary=07, secondary=08, subordinate=08, sec-latency=32 I/O behind bridge: 0000a000-0000afff Secondary status: 66MHz+ FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort+ &lt;SERR- &lt;PERR- BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- &gt;Reset- FastB2B- PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn- Capabilities: [c0] Subsystem: ASRock Incorporation Motherboard 08:01.0 Multimedia audio controller: VIA Technologies Inc. ICE1712 [Envy24] PCI Multi-Channel I/O Controller (rev 02) Subsystem: VIA Technologies Inc. M-Audio Delta 1010LT Control: I/O+ Mem- BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=medium &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 32 Interrupt: pin A routed to IRQ 19 Region 0: I/O ports at a040 [size=32] Region 1: I/O ports at a070 [size=16] Region 2: I/O ports at a060 [size=16] Region 3: I/O ports at a000 [size=64] Capabilities: [80] Power Management version 1 Flags: PMEClk- DSI- D1- D2+ AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst- PME-Enable- DSel=0 DScale=0 PME- Kernel driver in use: snd_ice1712</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545384">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545393" class="blockpost rowodd"> <h2><span><span class="conr">#5663</span> <a href="viewtopic.php?pid=1545393#p1545393">2015-07-17 15:03:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Quadro cards operate as a secondary display, the GPU ROM isn&#039;t used.</p></div></blockquote></div><br /><p>Interesting. Does that mean that they do not work as a primary VGA at all, or that the ROM isn&#039;t needed when the card is secondary?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545393">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545396" class="blockpost roweven"> <h2><span><span class="conr">#5664</span> <a href="viewtopic.php?pid=1545396#p1545396">2015-07-17 15:16:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>impulse_255 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Quadro cards operate as a secondary display, the GPU ROM isn&#039;t used.</p></div></blockquote></div><br /><p>Interesting. Does that mean that they do not work as a primary VGA at all, or that the ROM isn&#039;t needed when the card is secondary?</p></div></blockquote></div><p>Both.&#160; Nvidia does not support the primary graphics use case with Quadro (nor GeForce, but nothing VM related is supported on GeForce) and in secondary mode, with the Nvidia graphics drivers, the ROM is not used.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545396">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545402" class="blockpost rowodd"> <h2><span><span class="conr">#5665</span> <a href="viewtopic.php?pid=1545402#p1545402">2015-07-17 15:30:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>I recently started using a M-Audio 1010lt PCI soundcard (via a ASMedia ASM1083 PCIe to PCI bridge) for my host audio. But ever since, I&#039;ve been getting this strange DMAR flood in my dmesg whenever the sound card is being used:</p><div class="codebox"><pre><code>[64721.567981] dmar: DRHD: handling fault status reg 3 [64721.567998] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [64721.568080] dmar: DRHD: handling fault status reg 3 [64721.568082] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set [64721.716747] dmar: DRHD: handling fault status reg 3 [64721.716751] dmar: DMAR:[DMA Read] Request device [08:00.0] fault addr 10000000 DMAR:[fault reason 06] PTE Read access is not set ...</code></pre></div><p>As I was originally only using just &quot;intel_iommu=on,igfx_off&quot;, I thought adding the &quot;iommu=pt&quot; would help to get rid of this problem, because it is supposed to disable the DMAR. However, it would appear that adding the &quot;iommu=pt&quot; changed nothing.</p><p>I haven&#039;t noticed any other ill effects than my dmesg being flooded. I was hoping perhaps <strong>aw</strong> knows something about this?</p></div></blockquote></div><p>So you have a crappy Via sound card behind a crappy ASMedia bridge and it doesn&#039;t work with the IOMMU... <em>quelle surprise</em>.&#160; Actually it just seems like the audio card is buggy, it appears to be doing a DMA read at address 256MB, probably to force any previous DMA writes to memory, ie. a flush.&#160; Is this address consistent between boots?&#160; I&#039;m guessing it is.&#160; The hardware designers probably thought &quot;hey, there&#039;s always memory at 256MB, we can just read from that for a DMA flush, what could go wrong&quot;.&#160; Then along comes the IOMMU that restricts DMA from the device to only the regions the driver has mapped for the device and you get these sorts of errors.&#160; Maybe the driver could try to map a buffer at 256MB, but it apparently doesn&#039;t.&#160; All in all, the audio card isn&#039;t fit for use behind an IOMMU.</p><p>Now, why doesn&#039;t iommu=pt magically work?&#160; Well, it&#039;s a 32bit (or less) device and in order to support a 32bit device on a system with potentially more than 4G of RAM we&#039;d need to have bounce buffers.&#160; But wait, we have an IOMMU, why would we also want bounce buffers?&#160; So even though you requested passhrough mode, the sound card got demoted (you chopped this part out of the dmesg) and it&#039;s running with normal translation.</p><p>Get a better sound card.</p><p>EDIT: Oh, BTW in an interesting twist of technology, the sound card would probably work perfectly assigned to a VM because guest physical memory address 256MB will be DMA read-able.</p> <p class="postedit"><em>Last edited by aw (2015-07-17 15:35:43)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545402">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545477" class="blockpost roweven"> <h2><span><span class="conr">#5666</span> <a href="viewtopic.php?pid=1545477#p1545477">2015-07-17 19:29:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>impulse_255 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Quadro cards operate as a secondary display, the GPU ROM isn&#039;t used.</p></div></blockquote></div><br /><p>Interesting. Does that mean that they do not work as a primary VGA at all, or that the ROM isn&#039;t needed when the card is secondary?</p></div></blockquote></div><p>Both.&#160; Nvidia does not support the primary graphics use case with Quadro (nor GeForce, but nothing VM related is supported on GeForce) and in secondary mode, with the Nvidia graphics drivers, the ROM is not used.</p></div></blockquote></div><br /><p>Okay, thanks! </p><p>I&#039;ll be back home in a couple of days. Then I will try spoofing my card as an M6000 and tell how it went.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545477">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545589" class="blockpost rowodd"> <h2><span><span class="conr">#5667</span> <a href="viewtopic.php?pid=1545589#p1545589">2015-07-18 04:02:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92640">sofloantonio</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-18</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92640">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Anyone got this working with an a10-5800k or similar?</p><p>I have the a10 and a gtx750ti. I have a few potentially stupid questions.</p><p>So the aim is to have the host os (arch) be using the integrated graphics of the a10, and the windows installation to use the gtx 750. In bios, there is a setting which can switch between whether the pci graphics card is used by default or if the integrated graphics are used. Does this need to be changed? or does it have no effect?</p><p>also, im using two hdmi cords, both connected to a monitor which accepts two different inputs. one hdmi is connected to the graphics card, the other to the motherboard&#039;s hdmi slot. is this correct?</p><p>thanks</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545625" class="blockpost roweven"> <h2><span><span class="conr">#5668</span> <a href="viewtopic.php?pid=1545625#p1545625">2015-07-18 09:52:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>So you have a crappy Via sound card behind a crappy ASMedia bridge and it doesn&#039;t work with the IOMMU... <em>quelle surprise</em>.&#160; Actually it just seems like the audio card is buggy, it appears to be doing a DMA read at address 256MB, probably to force any previous DMA writes to memory, ie. a flush.</p></div></blockquote></div><p>Sounds very plausible.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Is this address consistent between boots?&#160; I&#039;m guessing it is.</p></div></blockquote></div><p>Right you are.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The hardware designers probably thought &quot;hey, there&#039;s always memory at 256MB, we can just read from that for a DMA flush, what could go wrong&quot;.&#160; Then along comes the IOMMU that restricts DMA from the device to only the regions the driver has mapped for the device and you get these sorts of errors.&#160; Maybe the driver could try to map a buffer at 256MB, but it apparently doesn&#039;t.</p></div></blockquote></div><p>So the the hardware doesn&#039;t define a memory BAR at 256M, even though it tries to read it. Could it be possible to hack the snd_ice1712 driver to reserve that memory? Or is it too late to try and &quot;fix&quot; it in the driver?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> All in all, the audio card isn&#039;t fit for use behind an IOMMU.</p></div></blockquote></div><p>Strange that the card still does appear to &quot;fully work&quot;. The act of doing a DMA Read at a fault address must still be achieving the flush?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Now, why doesn&#039;t iommu=pt magically work?&#160; Well, it&#039;s a 32bit (or less) device and in order to support a 32bit device on a system with potentially more than 4G of RAM we&#039;d need to have bounce buffers.&#160; But wait, we have an IOMMU, why would we also want bounce buffers?</p></div></blockquote></div><p>Then passthrough will only work for devices that support 64 bit addressing?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>&#160; So even though you requested passhrough mode, the sound card got demoted (you chopped this part out of the dmesg) and it&#039;s running with normal translation.</p></div></blockquote></div><p>Yeah, sorry about cutting away important stuff, I was trying to make it easier to read. Here is the full dmesg: <a href="http://paste.debian.net/hidden/f5743abd/" rel="nofollow">http://paste.debian.net/hidden/f5743abd/</a></p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Get a better sound card.</p></div></blockquote></div><p>Yeah, perhaps I&#039;ll get one of those simple USB sound cards. I&#039;m guessing they are fairly usable by now. Only reason I&#039;m still using the VIA sound card is because it can directly drive my headphones really nicely without any sort of background hiss or noise.</p><p>But in the meanwhile, I&#039;m thinking ill just figure out a way for syslog to suppress those DMAR messages. Since those messages filling up my log seem to be the only bad thing that is happening.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545625">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545661" class="blockpost rowodd"> <h2><span><span class="conr">#5669</span> <a href="viewtopic.php?pid=1545661#p1545661">2015-07-18 13:06:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72824">evujumenuk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-02</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evujumenuk wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Borderlands folks, I think this is the problem you&#039;re trying to describe:</p><p><a href="https://dl.dropboxusercontent.com/u/19831938/borderlands2-baremetal.jpg" rel="nofollow">https://dl.dropboxusercontent.com/u/198 … emetal.jpg</a></p><p><a href="https://dl.dropboxusercontent.com/u/19831938/borderlands2-vm.jpg" rel="nofollow">https://dl.dropboxusercontent.com/u/198 … ds2-vm.jpg</a></p><p>This vantage point in the training area seems to give me a consistently low FPS and high latency and seems invariant to the lighting.&#160; The VM shows about 1/3rd the FPS and 3x the latency.&#160; What is that latency actually measuring anyway?&#160; These are separate win7x64 installs on the same Haswell/GTX660 hardware with Nvidia Experience optimizing the game in both (highest settings for all).</p><p>I don&#039;t have any solutions yet, but it&#039;s good to understand the problem.&#160; I did run the VM with vfio debugging turned on and I&#039;m not seeing any excessive hits to the card, which means we&#039;re not bouncing out to userspace regularly as a result of the assigned devices (GPU + audio + NIC in this case).&#160; I see a write to 0x88154 at a rate of about 10/s.&#160; This is an area we must trap because it&#039;s an mmio mirror of PCI config space.&#160; That happens regardless of what&#039;s going on in the game and also happens at a basic desktop, so if it was causing any trouble I&#039;d expect it would be across the board and not select games.</p><p>I&#039;m suspicious of USB passthrough, but my only evidence is that hitting the escape key in the game is not as responsive as bare metal and often requires a second hit.&#160; Assignment of the USB controller might be an option, but didn&#039;t just work in my first attempt, maybe an issue with windows drivers.</p><p>EDIT: game reported latency appears to just be the inverse of FPS, so it&#039;s SPF (seconds per frame)</p><p>EDIT2: Further analysis (special thanks to Paolo Bonzini) shows two issues that are hurting performance here.&#160; First is a known issue with Windows that it pounds on the time source, whether it&#039;s ACPI PM timer or HPET.&#160; Code just recently went upstream (kernel and qemu) that enables a Hyper-V enlightened timer that can help to reduce this.&#160; To enable it add &quot;hv-time&quot; to your -cpu option, ex. -cpu Haswell,hv-time&#160; This gives me about 20% more FPS and is likely to help performance of any game running in a Windows guest.&#160; The second problem is that we see extensive use of the processor debug registers.&#160; Each move to or from these registers traps into the hypvervisor and they appear to be batched into a context switch function, so we have a burst of them all at once.&#160; I&#039;ve submitted a support ticket to gearbox software to see if they have any suggestions to avoid these registers.</p></div></blockquote></div><p>Hello performance!&#160; Patches were just posted upstream to do lazy tracking of the debug registers.&#160; With &quot;-cpu Haswell,hv-time&quot; and <a href="http://www.spinics.net/lists/kernel/msg1695823.html" rel="nofollow">these patches</a>, this is what I can get now (better than 80% of bare metal):</p><p><a href="https://dl.dropboxusercontent.com/u/19831938/borderlands2-vm-new.jpg" rel="nofollow">https://dl.dropboxusercontent.com/u/198 … vm-new.jpg</a></p><p>This initial implementation is Intel-only, but hopefully we can do the same for AMD.</p></div></blockquote></div><p>So, what is the best current alternative to hv-time? Can&#039;t really use that with Nvidia drivers.</p><p>/USE PMTIMER?</p></div></blockquote></div><p>I just thought of something.</p><p>Could one enable Invariant TSC on the -cpu flag and get a clock as good as hypervclock? The catch would be that savevm (and, by extension, migration) would not work. But I suspect that is already the case with VFIO.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545661">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545699" class="blockpost roweven"> <h2><span><span class="conr">#5670</span> <a href="viewtopic.php?pid=1545699#p1545699">2015-07-18 15:50:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>So the the hardware doesn&#039;t define a memory BAR at 256M, even though it tries to read it. Could it be possible to hack the snd_ice1712 driver to reserve that memory? Or is it too late to try and &quot;fix&quot; it in the driver?</p></div></blockquote></div><p>This isn&#039;t related to BARs, this is how the device accesses memory.&#160; It should be possible to hack the driver to create a coherent mapping at 256MB, it appears that dma_declare_coherent_memory() would be the mechanism to do such a thing.&#160; I also note this driver sets a coherent DMA mask of 28 bits, ie. 256MB, which is a bit at odds with declaring coherent memory starting at 256MB and an indication of just how outdated this hardware is.</p><div class="quotebox"><blockquote><div><p>Strange that the card still does appear to &quot;fully work&quot;. The act of doing a DMA Read at a fault address must still be achieving the flush?</p></div></blockquote></div><p>Potentially</p><div class="quotebox"><blockquote><div><p>Then passthrough will only work for devices that support 64 bit addressing?</p></div></blockquote></div><p>64bit is not strictly required, but the device must be capable of DMA&#039;ing to any physical memory in the system.&#160; However, conventional PCI devices like this are a special case.&#160; Only PCIe devices use a unique requester ID.&#160; For conventional PCI devices, the PCIe-to-PCI bridge provides the requester ID, this is why the error reports 08:00.0 rather than 08:01.0 because that&#039;s the requester ID for the entire secondary side of the bridge.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545699">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545791" class="blockpost rowodd"> <h2><span><span class="conr">#5671</span> <a href="viewtopic.php?pid=1545791#p1545791">2015-07-19 03:01:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, everything works now, which is nice; everything remaining is a matter of convenience. My problem was eventually solved by using the OVMF binaries linked by @impulse_255, so there must be an issue in the newest version included in the edk.<br />I do have a couple of questions though:<br /><span class="bbs">1. I&#039;m using a seperate physical interface for networking, a PCI wifi card, with the host using onboard Ethernet; but this means for slower and higher-latency transfer between the two, what is the simplest host-to-guest networking, without external connectivity? I thought it would be NAT, but documentation seems to suggest that it is for guest to guest connectivity. Bridging doesn&#039;t seem to make h-t-g networking a possibility, so how can I do it?</span> EDIT: I&#039;m terrible at reading.<br />2. Is there a better alternative than Synergy for gaming? Hitting the edges is a problem, and it seems to handle direct pointer captures very badly, so besides Steam Inhouse Streaming, is there a viable way to play D3D games?</p><p>Thanks for all your help getting me this far, and if anyone with similar issues to mine needs any help, I&#039;d be more than happy.</p> <p class="postedit"><em>Last edited by morat (2015-07-19 03:02:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545791">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545802" class="blockpost roweven"> <h2><span><span class="conr">#5672</span> <a href="viewtopic.php?pid=1545802#p1545802">2015-07-19 04:33:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90432">wmarler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Denver, CO</span></dd> <dd><span>Registered: 2015-04-18</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90432">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey forum,</p><p>I&#039;m running into a wall. I&#039;m using virt-manager to prepare a VM for VGA passthrough. When a VM is configured to use UEFI firmware, Windows will not install, but fails on &quot;Copying Windows files (0%)&quot;. In the case of Win8.1/10, Windows throws up the frowny-face blue-screen with a generic rebooting message and reboots, and Win 7 freezes with a black screen. On reboot &amp; trying to install Windows again, the disk has been partitioned (4 partitions with Win 8.1/10, 3 with 7), but the main/non-system partition cannot be installed to without formatting. The details reads &quot;... This hard disk space is formatted with an unsupported version of the NTFS file system.&quot; The disk can be re-formatted and selected as the install target, but doing so results in the same reboot/black screen. Creating/formatting partitions manually results in the crash/black screen too. I&#039;ve tried many, many iterations. I finally created 2 VM&#039;s identical to each other save for uuid, LVM storage location, and NIC MAC address, gave one the UEFI firmware (&quot;win10b&quot;) and the other the BIOS firmware (&quot;win10a&quot;), and installed the BIOS one just fine. </p><p>My conclusion: there&#039;s something up with the UEFI firmware and/or my motherboard. I have no insight into what, nor how to get any insight. Watching &#039;journalctl -f&#039; during the crash shows nothing, and I don&#039;t know how to get Windows to tell me anything.</p><p>I am using the UEFI firmware as provided by the Gerd Hoffman RPM repository. The version is edk2.git-ovmf-x64.noarch 0-20150716.b1120.g387e7c1<br />I&#039;m on Fedora 22, kernel 4.0.8-300, with an i5-4960 CPU, and an ASRock Z87 PRO3 motherboard (no successes and 1 failure reported in the spreadsheet; disheartening, but not conclusive). The motherboard BIOS is up to date, according to the motherboard update utility. </p><p>A dumpxml of the working VM is <a href="http://pastebin.com/Xs2GaB5d" rel="nofollow">here</a> (win10a.xml).<br />A dumpxml of the non-working VM is <a href="http://pastebin.com/rBZ9tQ4s" rel="nofollow">here</a> (win10b.xml).</p><p>The diff between these two dumps is here:</p><div class="codebox"><pre><code>% diff win10a.xml win10b.xml 2,4c2,4 &lt; &lt;name&gt;win10a&lt;/name&gt; &lt; &lt;uuid&gt;b80ea20a-5157-4afd-87f9-63b1e2a5b1bf&lt;/uuid&gt; &lt; &lt;description&gt;BIOS Firmware&lt;/description&gt; --- &gt; &lt;name&gt;win10b&lt;/name&gt; &gt; &lt;uuid&gt;c8c14fba-ecdd-4d91-ae7c-a9f52497d1b2&lt;/uuid&gt; &gt; &lt;description&gt;UEFI Firmware&lt;/description&gt; 9a10 &gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/loader&gt; 40c41 &lt; &lt;source dev=&#039;/dev/vgmain/win10_1&#039;/&gt; --- &gt; &lt;source dev=&#039;/dev/vgmain/win10_2&#039;/&gt; 86c87 &lt; &lt;mac address=&#039;52:54:00:e7:67:f7&#039;/&gt; --- &gt; &lt;mac address=&#039;52:54:00:c8:1b:45&#039;/&gt;</code></pre></div><p>The issue is easily reproducible.&#160; </p><p>Any suggestions other than &quot;buy a known-good motherboard&quot; or &quot;use the VGA arbitration patch&quot;? Those are obvious next steps, but neither are solutions I&#039;m particularly interested in without exhausting all of my options. </p><p>TIA</p> <p class="postedit"><em>Last edited by wmarler (2015-07-19 04:47:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545802">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545803" class="blockpost rowodd"> <h2><span><span class="conr">#5673</span> <a href="viewtopic.php?pid=1545803#p1545803">2015-07-19 04:43:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@wmarler, I just had this exact issue:<br />Use <a href="https://bbs.archlinux.org/viewtopic.php?pid=1518188#p1518188" rel="nofollow">this</a> set of binaries, as linked by @impulse_255<br />I&#039;d say this will probably work for you, as yours was my <em>exact</em> issue.<br />Win 7 will <strong>not</strong> work, it seems to have UEFI trouble.</p><p>Also, please code tag your diffs, and other code.</p> <p class="postedit"><em>Last edited by morat (2015-07-19 04:45:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545803">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545805" class="blockpost roweven"> <h2><span><span class="conr">#5674</span> <a href="viewtopic.php?pid=1545805#p1545805">2015-07-19 05:20:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90432">wmarler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Denver, CO</span></dd> <dd><span>Registered: 2015-04-18</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90432">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>@wmarler, I just had this exact issue:<br />Use <a href="https://bbs.archlinux.org/viewtopic.php?pid=1518188#p1518188" rel="nofollow">this</a> set of binaries, as linked by @impulse_255<br />I&#039;d say this will probably work for you, as yours was my <em>exact</em> issue.</p></div></blockquote></div><p>Thanks, that worked. And was very easy :-D.</p><div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>Win 7 will <strong>not</strong> work, it seems to have UEFI trouble.</p></div></blockquote></div><p>Bummer ... that&#039;s what I have a license for atm.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545805">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1545815" class="blockpost rowodd"> <h2><span><span class="conr">#5675</span> <a href="viewtopic.php?pid=1545815#p1545815">2015-07-19 06:48:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>morat wrote:</cite><blockquote><div><p>2. Is there a better alternative than Synergy for gaming? Hitting the edges is a problem, and it seems to handle direct pointer captures very badly, so besides Steam Inhouse Streaming, is there a viable way to play D3D games?</p><p>Thanks for all your help getting me this far, and if anyone with similar issues to mine needs any help, I&#039;d be more than happy.</p></div></blockquote></div><p>If what you&#039;re referring to by &quot;seems to handle direct pointer captures very badly&quot; is what I think, ensure you have &#039;relativeMouseMoves = true&#039; in your server config, bind a button to lockCursorToScreen(toggle), and then lock the cursor to the vm screen when you&#039;re playing, should solve that issue and also your edge problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1545815">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=226">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=225">225</a> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <strong>227</strong> <a href="viewtopic.php?id=162768&amp;p=228">228</a> <a href="viewtopic.php?id=162768&amp;p=229">229</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=228">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
