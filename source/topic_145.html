<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 145) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=145" title="Page 145" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=144" title="Page 144" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=146" title="Page 146" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=144">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=143">143</a> <a href="viewtopic.php?id=162768&amp;p=144">144</a> <strong>145</strong> <a href="viewtopic.php?id=162768&amp;p=146">146</a> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=146">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1485179" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3601</span> <a href="viewtopic.php?pid=1485179#p1485179">2014-12-17 05:41:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>This is the command I use to start the qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -rtc base=localtime -m 8192 -cpu host,kvm=off -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_x64.bin -drive if=pflash,format=raw,file=/home/jgomez/VM/ovmf_x64.bin -smp 4,sockets=1,cores=4 -serial none -parallel none -nodefconfig -drive file=/home/jgomez/VM/win7.img,cache=writeback,if=none,id=drive0,aio=native -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/Downloads/win8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install -cdrom /home/jgomez/Downloads/virtio.iso -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1 -device vfio-pci,host=00:19.0 -usb -usbdevice host:046d:c52e -net none -vga none -nographic</code></pre></div><p>Regards,</p><br /><p>TheArcher</p></div></blockquote></div><br /><p>I can&#039;t seem to get the PCI stub ID claimed, both interfaces have the same ID, do your IDs match as well?</p><p>05:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]<br />06:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]</p><br /><p>[anthony:/home/anthony] 7s $ dmesg |grep -i claim<br />[&#160; &#160; 0.332788] pci 0000:00:1f.0: quirk: [io&#160; 0x0500-0x053f] claimed by ICH6 GPIO<br />[&#160; &#160; 4.332685] pci-stub 0000:03:00.0: claimed by stub<br />[&#160; &#160; 4.332702] pci-stub 0000:03:00.1: claimed by stub</p></div></blockquote></div><br /><p>I got this working by using: echo 1 &gt; /sys/module/kvm/parameters/allow_unsafe_assigned_interrupts and using pci-assign (the NICs are in the same IOMMU group but I have disabled eth1 as much as possible on the host -- is this safe?)</p><p>Also, I&#039;m trying OVMF to see if I can improve reliability with boots -- what is &#039;OVMF_VARS-pure-efi.fd &#039; and why do I need it? Also how do I get my HDD booted -- I end up at the UEFI interactive shell each time:</p><p>QEMU_PA_SAMPLES=8192 QEMU_AUDIO_DRV=pa \<br />$QEMU \<br />-boot menu=on \<br />-drive if=pflash,format=raw,readonly,file=/home/anthony/ovmf-x64/OVMF-pure-efi.fd \<br />-enable-kvm -cpu host,kvm=off -rtc base=localtime \<br />-m $MEM $HUGE -smp 8,sockets=1,cores=4,threads=4 \<br />-vga std \<br />-device intel-hda -device hda-output \<br />-device vfio-pci,host=$GPU,addr=04.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=$AUDIO,addr=04.1 \<br />-device pci-assign,host=06:00.0 \<br />-drive file=$DISK,cache=none,if=none,id=drive0,aio=threads \<br />-device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \<br />-net none \<br />-vnc :0 -k en-us</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485179">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485181" class="blockpost roweven"> <h2><span><span class="conr">#3602</span> <a href="viewtopic.php?pid=1485181#p1485181">2014-12-17 06:00:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>This is the command I use to start the qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -rtc base=localtime -m 8192 -cpu host,kvm=off -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_x64.bin -drive if=pflash,format=raw,file=/home/jgomez/VM/ovmf_x64.bin -smp 4,sockets=1,cores=4 -serial none -parallel none -nodefconfig -drive file=/home/jgomez/VM/win7.img,cache=writeback,if=none,id=drive0,aio=native -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/Downloads/win8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install -cdrom /home/jgomez/Downloads/virtio.iso -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1 -device vfio-pci,host=00:19.0 -usb -usbdevice host:046d:c52e -net none -vga none -nographic</code></pre></div><p>Regards,</p><br /><p>TheArcher</p></div></blockquote></div><br /><p>I can&#039;t seem to get the PCI stub ID claimed, both interfaces have the same ID, do your IDs match as well?</p><p>05:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]<br />06:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]</p><br /><p>[anthony:/home/anthony] 7s $ dmesg |grep -i claim<br />[&#160; &#160; 0.332788] pci 0000:00:1f.0: quirk: [io&#160; 0x0500-0x053f] claimed by ICH6 GPIO<br />[&#160; &#160; 4.332685] pci-stub 0000:03:00.0: claimed by stub<br />[&#160; &#160; 4.332702] pci-stub 0000:03:00.1: claimed by stub</p></div></blockquote></div><p>Yes its normal for them to match, I use 82574Ls and they are independent controllers so it should work. I&#039;m a virsh user but this is all I do to bind an 82574L on 04:00.0 (It definitely works independently as the other controller is used by the host:<br />echo &quot;8086 10d3&quot; &gt; /sys/bus/pci/drivers/pci-stub/new_id<br />echo 0000:04:00.0 &gt; /sys/bus/pci/devices/0000:04:00.0/driver/unbind<br />echo 0000:04:00.0 &gt; /sys/bus/pci/drivers/pci-stub/bind<br />vfio-bind 0000:04:00.0<br />virsh create ~/VM/Router.xml</p><p>Router.xml:<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=04:00.0,bus=pcie.0&#039;/&gt;</p><p>For those who are interested I switched the GPU to an R5-230 Radeon and my reboot issue disappeared.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485181">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485182" class="blockpost rowodd"> <h2><span><span class="conr">#3603</span> <a href="viewtopic.php?pid=1485182#p1485182">2014-12-17 06:02:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>This is the command I use to start the qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -rtc base=localtime -m 8192 -cpu host,kvm=off -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_x64.bin -drive if=pflash,format=raw,file=/home/jgomez/VM/ovmf_x64.bin -smp 4,sockets=1,cores=4 -serial none -parallel none -nodefconfig -drive file=/home/jgomez/VM/win7.img,cache=writeback,if=none,id=drive0,aio=native -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 -device virtio-scsi-pci,id=scsi -drive file=/home/jgomez/Downloads/win8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install -cdrom /home/jgomez/Downloads/virtio.iso -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1 -device vfio-pci,host=00:19.0 -usb -usbdevice host:046d:c52e -net none -vga none -nographic</code></pre></div><p>Regards,</p><br /><p>TheArcher</p></div></blockquote></div><br /><p>I can&#039;t seem to get the PCI stub ID claimed, both interfaces have the same ID, do your IDs match as well?</p><p>05:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]<br />06:00.0 Ethernet controller [0200]: Intel Corporation 82574L Gigabit Network Connection [8086:10d3]</p><br /><p>[anthony:/home/anthony] 7s $ dmesg |grep -i claim<br />[&#160; &#160; 0.332788] pci 0000:00:1f.0: quirk: [io&#160; 0x0500-0x053f] claimed by ICH6 GPIO<br />[&#160; &#160; 4.332685] pci-stub 0000:03:00.0: claimed by stub<br />[&#160; &#160; 4.332702] pci-stub 0000:03:00.1: claimed by stub</p></div></blockquote></div><p>No, I have different ID&#039;s...</p><div class="codebox"><pre><code>[jgomez@mycolonialone ~]$ lspci | grep Eth 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection (2) I218-V 03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 11)</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485182">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485184" class="blockpost roweven"> <h2><span><span class="conr">#3604</span> <a href="viewtopic.php?pid=1485184#p1485184">2014-12-17 06:05:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><p>Someone else using with arch kernel?</p><p>uname -a</p><div class="codebox"><pre><code>Linux 3.17.6-1-ARCH #1 SMP PREEMPT Sun Dec 7 23:43:32 UTC 2014 x86_64 GNU/Linux</code></pre></div><br /><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux root=UUID=e9f18698-c70a-41f6-b5c6-c84a8e7eac85 rw quiet rdblacklist=nouveau nouveau.modeset=0 pci-stub.ids=10de:10c3,10de:0be3 intel_pstate=disable i915.enable_hd_vgaarb=1 intel_iommu=on,igfx_off quiet</code></pre></div><p>Tried this way,&#160; based on thearcherblog, gave me no error, but no screen</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -rtc base=localtime -cpu host,kvm=off -m 2048 -smp 2,sockets=1,cores=2 -serial none -parallel none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/ovmf_x64.bin \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/user/windows.img,cache=writeback,if=none,id=drive0,aio=native \ -drive file=/home/user/Win81.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /home/user/Downloads/virtio.iso \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -net none \ -vga none \ -boot menu=on \ -nographic</code></pre></div><br /><p>and this way, based on nbhs, gave me this error: KVM internal error. Suberror: 1 emulation failure</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>I also got the black screen but someone suggested me to have this (and works for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />):</p><div class="codebox"><pre><code>[jgomez@mycolonialone etc]$ cat /etc/modprobe.d/qemu_kvm.conf options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 #options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>Regards <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485184">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485187" class="blockpost rowodd"> <h2><span><span class="conr">#3605</span> <a href="viewtopic.php?pid=1485187#p1485187">2014-12-17 06:14:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference -- but I&#039;m really just posting to show off this: <span class="postimg"><img src="http://i.imgur.com/u4fJxyt.jpg" alt="u4fJxyt.jpg" /></span></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485187">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485189" class="blockpost roweven"> <h2><span><span class="conr">#3606</span> <a href="viewtopic.php?pid=1485189#p1485189">2014-12-17 06:26:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Glad to hear it works well. Sorry about the confusion I had gotten your config and posts muddled with anthonym52.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485189">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485190" class="blockpost rowodd"> <h2><span><span class="conr">#3607</span> <a href="viewtopic.php?pid=1485190#p1485190">2014-12-17 06:26:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference</p></div></blockquote></div><p>So now you&#039;re limiting your NIC bandwidth to the wire speed and going out to an external switch whereas you could have had 10s of gigabits through an internal bridge to have seamless window mode of your Windows VM onto your Linux desktop?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485190">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485191" class="blockpost roweven"> <h2><span><span class="conr">#3608</span> <a href="viewtopic.php?pid=1485191#p1485191">2014-12-17 06:30:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference</p></div></blockquote></div><p>So now you&#039;re limiting your NIC bandwidth to the wire speed and going out to an external switch whereas you could have had 10s of gigabits through an internal bridge to have seamless window mode of your Windows VM onto your Linux desktop?</p></div></blockquote></div><p>That is a good point, I just wanted to try it out -- seems to preform a bit better but I need to do more benchmarks. BTW, this isn&#039;t &#039;seamless window mode&#039; it&#039;s picture-by-picture (a hardware feature of my monitor).</p><p>Edit: (This is the reason for the off screen camera image)</p> <p class="postedit"><em>Last edited by anthonym52 (2014-12-17 06:33:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485191">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485217" class="blockpost rowodd"> <h2><span><span class="conr">#3609</span> <a href="viewtopic.php?pid=1485217#p1485217">2014-12-17 09:34:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference -- but I&#039;m really just posting to show off this: <a href="http://i.imgur.com/u4fJxyt.jpg" rel="nofollow">http://i.imgur.com/u4fJxyt.jpg</a></p></div></blockquote></div><p>Damn, this looks AWESOME!<br />Especially when you match the wallpaper.<br />What&#039;s the model number?<br />It&#039;s awesomely better than having two separate screens(1280x1024 and 1920x1080). Can you press a button and make that screen appear &quot;double-wide&quot; to the system, running windows(or linux) on native resolution?</p><p>Two full-featured(almost) PCs in one case and two screens in one. I think i need a two-in-one keyboard, with a hardware KVM switch built into:D</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485217">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485218" class="blockpost roweven"> <h2><span><span class="conr">#3610</span> <a href="viewtopic.php?pid=1485218#p1485218">2014-12-17 09:43:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference -- but I&#039;m really just posting to show off this: <a href="http://i.imgur.com/u4fJxyt.jpg" rel="nofollow">http://i.imgur.com/u4fJxyt.jpg</a></p></div></blockquote></div><p>Damn, this looks AWESOME!<br />Especially when you match the wallpaper.<br />What&#039;s the model number?<br />It&#039;s awesomely better than having two separate screens(1280x1024 and 1920x1080). Can you press a button and make that screen appear &quot;double-wide&quot; to the system, running windows(or linux) on native resolution?</p><p>Two full-featured(almost) PCs in one case and two screens in one. I think i need a two-in-one keyboard, with a hardware KVM switch built into:D</p></div></blockquote></div><p>Can be the new Philips Monitor presented this summer? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Looks pretty cool <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485218">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485231" class="blockpost rowodd"> <h2><span><span class="conr">#3611</span> <a href="viewtopic.php?pid=1485231#p1485231">2014-12-17 11:05:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>My geekbench results are near native after passing through my NIC controller.. not sure why it&#039;s making a difference -- but I&#039;m really just posting to show off this: <a href="http://i.imgur.com/u4fJxyt.jpg" rel="nofollow">http://i.imgur.com/u4fJxyt.jpg</a></p></div></blockquote></div><p>Damn, this looks AWESOME!<br />Especially when you match the wallpaper.<br />What&#039;s the model number?<br />It&#039;s awesomely better than having two separate screens(1280x1024 and 1920x1080). Can you press a button and make that screen appear &quot;double-wide&quot; to the system, running windows(or linux) on native resolution?</p><p>Two full-featured(almost) PCs in one case and two screens in one. I think i need a two-in-one keyboard, with a hardware KVM switch built into:D</p></div></blockquote></div><p>Can be the new Philips Monitor presented this summer? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Looks pretty cool <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>The photo clearly says LG on the screen&#039;s bottom.<br />In fact, it&#039;s no new feature - my old(somewhere around 2002, i think)philips CRT TV can do that with television channels, it&#039;s a variation of traditional picture-by-picture.<br />I&#039;m interested in that particular ultra-wide screen.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485231">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485237" class="blockpost roweven"> <h2><span><span class="conr">#3612</span> <a href="viewtopic.php?pid=1485237#p1485237">2014-12-17 11:59:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>The photo clearly says LG on the screen&#039;s bottom.<br />In fact, it&#039;s no new feature - my old(somewhere around 2002, i think)philips CRT TV can do that with television channels, it&#039;s a variation of traditional picture-by-picture.<br />I&#039;m interested in that particular ultra-wide screen.</p></div></blockquote></div><p><a href="http://www.lg.com/us/monitors/lg-34UM95-P-ultrawide-monitor" rel="nofollow">http://www.lg.com/us/monitors/lg-34UM95 … de-monitor</a></p><p>I knew you guys would appreciate how cool this looks -- I&#039;ve been lurking this thread for awhile and when I came across this monitor I thought it would be rather novel to give this setup a try (haven&#039;t been this excited about Linux since the compiz days!).</p><p>Now I have a few questions about OVMF:</p><p>Why doesn&#039;t it boot my virtual disk? Secondly, what is OVMF_varsxxx.fd for?</p><p>Here is my franken-fig (there are other bits to it, but this is the meat and potatoes):</p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=8192 QEMU_AUDIO_DRV=pa \ $QEMU \ -boot menu=on \ -drive if=pflash,format=raw,readonly,file=/home/anthony/ovmf-x64/OVMF-pure-efi.fd \ -drive if=pflash,format=raw,file=/home/anthony/ovmf-x64/OVMF_VARS-pure-efi.fd \ -enable-kvm -cpu host,kvm=off -rtc base=localtime \ -m $MEM $HUGE -smp 8,sockets=1,cores=4,threads=4 \ -vga std \ -device intel-hda -device hda-output \ -device vfio-pci,host=$GPU,addr=04.0,multifunction=on,x-vga=on \ -device vfio-pci,host=$AUDIO,addr=04.1 \ -device pci-assign,host=06:00.0 \ -drive file=$DISK,cache=none,if=none,id=drive0,aio=threads \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -net none \ -vnc :0 -k en-us</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485237">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485238" class="blockpost rowodd"> <h2><span><span class="conr">#3613</span> <a href="viewtopic.php?pid=1485238#p1485238">2014-12-17 12:15:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=44291">magemaster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Brasil</span></dd> <dd><span>Registered: 2010-11-24</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=44291">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><p>Someone else using with arch kernel?</p><p>uname -a</p><div class="codebox"><pre><code>Linux 3.17.6-1-ARCH #1 SMP PREEMPT Sun Dec 7 23:43:32 UTC 2014 x86_64 GNU/Linux</code></pre></div><br /><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux root=UUID=e9f18698-c70a-41f6-b5c6-c84a8e7eac85 rw quiet rdblacklist=nouveau nouveau.modeset=0 pci-stub.ids=10de:10c3,10de:0be3 intel_pstate=disable i915.enable_hd_vgaarb=1 intel_iommu=on,igfx_off quiet</code></pre></div><p>Tried this way,&#160; based on thearcherblog, gave me no error, but no screen</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -rtc base=localtime -cpu host,kvm=off -m 2048 -smp 2,sockets=1,cores=2 -serial none -parallel none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/ovmf_x64.bin \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/user/windows.img,cache=writeback,if=none,id=drive0,aio=native \ -drive file=/home/user/Win81.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /home/user/Downloads/virtio.iso \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -net none \ -vga none \ -boot menu=on \ -nographic</code></pre></div><br /><p>and this way, based on nbhs, gave me this error: KVM internal error. Suberror: 1 emulation failure</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>I also got the black screen but someone suggested me to have this (and works for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />):</p><div class="codebox"><pre><code>[jgomez@mycolonialone etc]$ cat /etc/modprobe.d/qemu_kvm.conf options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 #options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>Regards <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Thank you, I installed with the emulated vga as primary and the passthrough as secondary to see what happens, could install nvidia drivers but got Code 43 error, which appears to be fixed with a patch from the 1st post.</p><p>PS: your qemu_kvm.conf has &quot;intel_kvm&quot; but in my machine the module name is &quot;kvm_intel&quot;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485248" class="blockpost roweven"> <h2><span><span class="conr">#3614</span> <a href="viewtopic.php?pid=1485248#p1485248">2014-12-17 13:20:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><p>Someone else using with arch kernel?</p><p>uname -a</p><div class="codebox"><pre><code>Linux 3.17.6-1-ARCH #1 SMP PREEMPT Sun Dec 7 23:43:32 UTC 2014 x86_64 GNU/Linux</code></pre></div><br /><p>cat /proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux root=UUID=e9f18698-c70a-41f6-b5c6-c84a8e7eac85 rw quiet rdblacklist=nouveau nouveau.modeset=0 pci-stub.ids=10de:10c3,10de:0be3 intel_pstate=disable i915.enable_hd_vgaarb=1 intel_iommu=on,igfx_off quiet</code></pre></div><p>Tried this way,&#160; based on thearcherblog, gave me no error, but no screen</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -rtc base=localtime -cpu host,kvm=off -m 2048 -smp 2,sockets=1,cores=2 -serial none -parallel none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/ovmf_x64.bin \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/user/windows.img,cache=writeback,if=none,id=drive0,aio=native \ -drive file=/home/user/Win81.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /home/user/Downloads/virtio.iso \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1 \ -net none \ -vga none \ -boot menu=on \ -nographic</code></pre></div><br /><p>and this way, based on nbhs, gave me this error: KVM internal error. Suberror: 1 emulation failure</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div></div></blockquote></div><p>I also got the black screen but someone suggested me to have this (and works for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />):</p><div class="codebox"><pre><code>[jgomez@mycolonialone etc]$ cat /etc/modprobe.d/qemu_kvm.conf options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 #options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>Regards <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Thank you, I installed with the emulated vga as primary and the passthrough as secondary to see what happens, could install nvidia drivers but got Code 43 error, which appears to be fixed with a patch from the 1st post.</p><p>PS: your qemu_kvm.conf has &quot;intel_kvm&quot; but in my machine the module name is &quot;kvm_intel&quot;</p></div></blockquote></div><p>Happy that works for you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>To be honest, I do not know anything about the qemu_kvm.conf and, even, when I made a few tests, is a mess because sometimes I get the error 43 and then I need to remove the driver and install it again (because setting the options back does not help until reinstall drivers)... so.... I&#039;m not expert at all; probably some of the Gurus here can give you real information about what makes every option <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485248">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485264" class="blockpost rowodd"> <h2><span><span class="conr">#3615</span> <a href="viewtopic.php?pid=1485264#p1485264">2014-12-17 14:56:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Damn, this looks AWESOME!<br />Especially when you match the wallpaper.<br />What&#039;s the model number?<br />It&#039;s awesomely better than having two separate screens(1280x1024 and 1920x1080). Can you press a button and make that screen appear &quot;double-wide&quot; to the system, running windows(or linux) on native resolution?</p><p>Two full-featured(almost) PCs in one case and two screens in one. I think i need a two-in-one keyboard, with a hardware KVM switch built into:D</p></div></blockquote></div><p>Can be the new Philips Monitor presented this summer? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Looks pretty cool <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>The photo clearly says LG on the screen&#039;s bottom.<br />In fact, it&#039;s no new feature - my old(somewhere around 2002, i think)philips CRT TV can do that with television channels, it&#039;s a variation of traditional picture-by-picture.<br />I&#039;m interested in that particular ultra-wide screen.</p></div></blockquote></div><p>My Dell U2913WM can do this too, but I&#039;ve never used it.&#160; You have to ask yourself if two 1280x1080 desktops, side-by-side w/o a seam is really all that useful for you.&#160; In my case I do all my work on a Linux desktop and Windows is a test/toy.&#160; I wouldn&#039;t sacrifice primary real estate for Windows.&#160; Maybe the LG shown is 4k, but it still wouldn&#039;t make sense for my use case, no matter how pretty is is.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485264">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485309" class="blockpost roweven"> <h2><span><span class="conr">#3616</span> <a href="viewtopic.php?pid=1485309#p1485309">2014-12-17 16:58:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87380">ebol4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-17</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I spent most of yesterday getting QEMU with KVM set up on my system. I compiled an up-to-date version of QEMU on my own. I&#039;m getting Code 43 in Windows 7&#039;s device manager after installing the NVIDIA drivers (version 335.23, to avoid the KVM detection issues).</p><p>Specs:<br />ASUS z97-AR<br />i5 4690k<br />GTX 660</p><p>The HDMI audio device I passed through with the VGA device appears to work just fine! No yellow bang next to the audio device. IOMMU and Vt-d are supported by my motherboard and processor, so no issues there.</p><div class="codebox"><pre><code>sudo /home/ian/qemu/qemu/x86_64-softmmu/qemu-system-x86_64 -enable-kvm -M pc \ -m 4096 \ -cpu host,kvm=off \ -bios /usr/share/qemu/bios.bin -vga cirrus \ -smp cores=4,threads=1,sockets=1 \ -device pci-assign,host=01:00.0 \ -device pci-assign,host=01:00.1 \ -hda /home/ian/windows.img -cdrom /home/ian/windows.iso \ -boot menu=on</code></pre></div><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.13.0-32-generic root=UUID=db818228-48ec-49b8-997b-163fa46c6ea0 ro quiet splash i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:11c0,10de:0e0b vfio_iommu_type1.allow_unsafe_interrupts=1 vt.handoff=7</code></pre></div><p>Any ideas? Using QEMU 2.2.50.</p> <p class="postedit"><em>Last edited by ebol4 (2014-12-17 17:00:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485309">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485312" class="blockpost rowodd"> <h2><span><span class="conr">#3617</span> <a href="viewtopic.php?pid=1485312#p1485312">2014-12-17 17:01:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ebol4 wrote:</cite><blockquote><div><p>I spent most of yesterday getting QEMU with KVM set up on my system. I compiled an up-to-date version of QEMU on my own. I&#039;m getting Code 43 in Windows 7&#039;s device manager after installing the NVIDIA drivers (version 335.23, to avoid the KVM detection issues).</p><p>Specs:<br />ASUS z97-AR<br />i5 4690k<br />GTX 660</p><p>The HDMI audio device I passed through with the VGA device appears to work just fine! No yellow bang next to the audio device. IOMMU and Vt-d are supported by my motherboard and processor, so no issues there.</p><div class="codebox"><pre><code>sudo /home/ian/qemu/qemu/x86_64-softmmu/qemu-system-x86_64 -enable-kvm -M pc \ -m 4096 \ -cpu host,kvm=off \ -bios /usr/share/qemu/bios.bin -vga cirrus \ -smp cores=4,threads=1,sockets=1 \ -device pci-assign,host=01:00.0 \ -device pci-assign,host=01:00.1 \ -hda /home/ian/windows.img -cdrom /home/ian/windows.iso \ -boot menu=on</code></pre></div><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-3.13.0-32-generic root=UUID=db818228-48ec-49b8-997b-163fa46c6ea0 ro quiet splash i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:11c0,10de:0e0b vfio_iommu_type1.allow_unsafe_interrupts=1 vt.handoff=7</code></pre></div><p>Any ideas? Using QEMU 2.2.50.</p></div></blockquote></div><p>Why are you even expecting this to work?&#160; Where are the instructions that say ignore everything in this thread, and just assign GeForce cards as secondary graphics with legacy KVM device assignment?&#160; Has this ever worked?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485312">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485334" class="blockpost roweven"> <h2><span><span class="conr">#3618</span> <a href="viewtopic.php?pid=1485334#p1485334">2014-12-17 17:45:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=44291">magemaster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Brasil</span></dd> <dd><span>Registered: 2010-11-24</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=44291">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>magemaster wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>I also got the black screen but someone suggested me to have this (and works for me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />):</p><div class="codebox"><pre><code>Linux 3.17.6-1-ARCH #1 SMP PREEMPT Sun Dec 7 23:43:32 UTC 2014 x86_64 GNU/Linux</code></pre></div><p>Regards <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Thank you, I installed with the emulated vga as primary and the passthrough as secondary to see what happens, could install nvidia drivers but got Code 43 error, which appears to be fixed with a patch from the 1st post.</p><p>PS: your qemu_kvm.conf has &quot;intel_kvm&quot; but in my machine the module name is &quot;kvm_intel&quot;</p></div></blockquote></div><p>Happy that works for you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>To be honest, I do not know anything about the qemu_kvm.conf and, even, when I made a few tests, is a mess because sometimes I get the error 43 and then I need to remove the driver and install it again (because setting the options back does not help until reinstall drivers)... so.... I&#039;m not expert at all; probably some of the Gurus here can give you real information about what makes every option <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux root=UUID=e9f18698-c70a-41f6-b5c6-c84a8e7eac85 rw quiet rdblacklist=nouveau nouveau.modeset=0 pci-stub.ids=10de:10c3,10de:0be3 intel_pstate=disable i915.enable_hd_vgaarb=1 intel_iommu=on,igfx_off quiet</code></pre></div><p>Thank you, but It didn&#039;t work, <br />what I could do was boot using the cirrus emulated card and see the nvidia card as a secondary, then installed the latest driver and got a 43 error <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I will try the OP way, patching and compilling stuff</p> <p class="postedit"><em>Last edited by magemaster (2014-12-17 17:46:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485339" class="blockpost rowodd"> <h2><span><span class="conr">#3619</span> <a href="viewtopic.php?pid=1485339#p1485339">2014-12-17 17:51:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Can be the new Philips Monitor presented this summer? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Looks pretty cool <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>The photo clearly says LG on the screen&#039;s bottom.<br />In fact, it&#039;s no new feature - my old(somewhere around 2002, i think)philips CRT TV can do that with television channels, it&#039;s a variation of traditional picture-by-picture.<br />I&#039;m interested in that particular ultra-wide screen.</p></div></blockquote></div><p>My Dell U2913WM can do this too, but I&#039;ve never used it.&#160; You have to ask yourself if two 1280x1080 desktops, side-by-side w/o a seam is really all that useful for you.&#160; In my case I do all my work on a Linux desktop and Windows is a test/toy.&#160; I wouldn&#039;t sacrifice primary real estate for Windows.&#160; Maybe the LG shown is 4k, but it still wouldn&#039;t make sense for my use case, no matter how pretty is is.</p></div></blockquote></div><br /><p>The actual screen is 3440x1440. So it makes it 1720x1440. Well, despite the weird aspect ratio, it&#039;s almost fullHD.<br />Comparing to the current setup...<br />I have 1280x1024 D-SUB-Only attached to GT610 fitted inside my case using MAGIC, and 1920x1080 DVI and D-SUB compatible.<br />Some time ago i used fullhd&#039;s video inputs for testing both passed GPUs(i&#039;ve got two in crossfire, if you forgot), but it produced really weird glitches. So, right now my D-SUB input on fullhd is unplugged. I can&#039;t plug it to GT610 because... there is no damn space for it in the case. I can do some OTHER magic, but that would require a lot of mana.(changing the motherboard or designing and making a whole new case from scratch)<br />And so, i have my fullhd screen offline when there is no VM running, i can&#039;t watch some cinema or series or anime or youtube or whatever on it. Watching 1280x720p is fine for me, but it still makes me sad a little. And the other way, i can&#039;t plug my square screen into one of PT&#039;d CF&#039;d GPUs to have 3200x1080 &quot;eyefinity&quot; experience(i did it previously when i had real windows running on physical hardware, and it was fun).</p><p>Making two 1280x1080 screens and having the ability to quickly stretch them to the native resolution would be good. Having two 1720x1440 screens would be even more awesome, and having the ability to switch it to full 3440x1440 for cinema or work is totally awesome.</p><p>Also, it&#039;d fill up my desk completely, as there is about 5cm gap between the upper bezel and the upper &quot;deck&quot; or whatever it&#039;s called. I can&#039;t use the wall mount because the square screens lacks VESA(it&#039;s ~10 years old), and i&#039;ve got no proper wall behind them.</p><p>So, the question is: can you turn on/turn off that picture-by-picture feature quickly, switching the output to native resolution?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485339">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485350" class="blockpost roweven"> <h2><span><span class="conr">#3620</span> <a href="viewtopic.php?pid=1485350#p1485350">2014-12-17 18:08:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>So, the question is: can you turn on/turn off that picture-by-picture feature quickly, switching the output to native resolution?</p></div></blockquote></div><p>This seems to be pretty annoying on the Dell.&#160; You can change one of the buttons to PBP (Picture-By-Picture), but it enables it and allows you to switch inputs.&#160; AFAICT there&#039;s no way to turn it back off w/o going through the menu.&#160; It also doesn&#039;t seem to do anything automatic with the screen resolution.&#160; When I enable it my desktop just gets squashed to half the screen.&#160; I suppose it would need to appear more like a monitor disconnected+reconnect with different EDID to do anything automatic.&#160; No idea what the LG does obviously.&#160; That resolution certainly opens up the possibilities a bit though.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485350">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485363" class="blockpost rowodd"> <h2><span><span class="conr">#3621</span> <a href="viewtopic.php?pid=1485363#p1485363">2014-12-17 18:29:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>So, the question is: can you turn on/turn off that picture-by-picture feature quickly, switching the output to native resolution?</p></div></blockquote></div><p>This seems to be pretty annoying on the Dell.&#160; You can change one of the buttons to PBP (Picture-By-Picture), but it enables it and allows you to switch inputs.&#160; AFAICT there&#039;s no way to turn it back off w/o going through the menu.&#160; It also doesn&#039;t seem to do anything automatic with the screen resolution.&#160; When I enable it my desktop just gets squashed to half the screen.&#160; I suppose it would need to appear more like a monitor disconnected+reconnect with different EDID to do anything automatic.&#160; No idea what the LG does obviously.&#160; That resolution certainly opens up the possibilities a bit though.</p></div></blockquote></div><p>I expected exactly &quot;EDID Change&quot; behaviour. Well, sad thing that it doesn&#039;t work that way, just squishes.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485363">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485448" class="blockpost roweven"> <h2><span><span class="conr">#3622</span> <a href="viewtopic.php?pid=1485448#p1485448">2014-12-17 23:32:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87380">ebol4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-17</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does Code 12 in Device Manager for an Nvidia card have a fix? Or could that be caused by a lot of different things?</p><p>edit: I also don&#039;t see any output on the attached monitor, including seabios output, which leads me to believe that it&#039;s an issue with my configuration, not Windows.</p><p>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-device ahci,id=ahci0 \<br />-drive file=/home/ian/windows.img,id=disk,if=none -device ide-drive,bus=ahci0.0,drive=disk \<br />-drive file=/home/ian/windows.iso,id=isocd,if=none -device ide-cd,bus=ahci0.1,drive=isocd \<br />-boot menu=on</p> <p class="postedit"><em>Last edited by ebol4 (2014-12-17 23:45:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485448">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485465" class="blockpost rowodd"> <h2><span><span class="conr">#3623</span> <a href="viewtopic.php?pid=1485465#p1485465">2014-12-18 00:13:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ebol4 wrote:</cite><blockquote><div><p>Does Code 12 in Device Manager for an Nvidia card have a fix? Or could that be caused by a lot of different things?</p><p>edit: I also don&#039;t see any output on the attached monitor, including seabios output, which leads me to believe that it&#039;s an issue with my configuration, not Windows.</p><p>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-device ahci,id=ahci0 \<br />-drive file=/home/ian/windows.img,id=disk,if=none -device ide-drive,bus=ahci0.0,drive=disk \<br />-drive file=/home/ian/windows.iso,id=isocd,if=none -device ide-cd,bus=ahci0.1,drive=isocd \<br />-boot menu=on</p></div></blockquote></div><p>That&#039;s looking better, though personally I still discourage q35 for Windows guests.&#160; You showed in the first post that you&#039;re using the i915.enable_hd_vgaarb=1 option, did you actually patch your kernel to include that patch?&#160; Primary VGA assignment still doesn&#039;t work with Intel IGD as host without it.&#160; If you want to avoid patching anything, use a GPU and guest with UEFI support and go the OVMF route.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485465">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485469" class="blockpost roweven"> <h2><span><span class="conr">#3624</span> <a href="viewtopic.php?pid=1485469#p1485469">2014-12-18 00:24:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87380">ebol4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-17</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>That&#039;s looking better, though personally I still discourage q35 for Windows guests.&#160; You showed in the first post that you&#039;re using the i915.enable_hd_vgaarb=1 option, did you actually patch your kernel to include that patch?&#160; Primary VGA assignment still doesn&#039;t work with Intel IGD as host without it.&#160; If you want to avoid patching anything, use a GPU and guest with UEFI support and go the OVMF route.</p></div></blockquote></div><p>I did not patch my kernel. I&#039;m pretty sure my GPU doesn&#039;t support UEFI though, so it looks like I&#039;m going to have to go that way. This involves pulling the kernel source and rebuilding it completely, right? Or am I just rebuilding one module?<br />edit: I got it figured out. Building kernel now.</p><p>Also, you said you discourage q35 for Windows guests. Is there another one you recommend instead?</p> <p class="postedit"><em>Last edited by ebol4 (2014-12-18 01:10:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485469">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1485487" class="blockpost rowodd"> <h2><span><span class="conr">#3625</span> <a href="viewtopic.php?pid=1485487#p1485487">2014-12-18 01:18:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ebol4 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>That&#039;s looking better, though personally I still discourage q35 for Windows guests.&#160; You showed in the first post that you&#039;re using the i915.enable_hd_vgaarb=1 option, did you actually patch your kernel to include that patch?&#160; Primary VGA assignment still doesn&#039;t work with Intel IGD as host without it.&#160; If you want to avoid patching anything, use a GPU and guest with UEFI support and go the OVMF route.</p></div></blockquote></div><p>I did not patch my kernel. I&#039;m pretty sure my GPU doesn&#039;t support UEFI though, so it looks like I&#039;m going to have to go that way. This involves pulling the kernel source and rebuilding it completely, right? Or am I just rebuilding one module?<br />edit: I got it figured out. Building kernel now.</p><p>Also, you said you discourage q35 for Windows guests. Is there another one you recommend instead?</p></div></blockquote></div><p>The default machine type is 440FX, there&#039;s an example of using it here:</p><p><a href="http://vfio.blogspot.com/2014/08/dual-vga-assignment-geforce-radeon.html" rel="nofollow">http://vfio.blogspot.com/2014/08/dual-v … adeon.html</a></p><p>Q35 really buys you nothing but complication and poor disk performance with AHCI.&#160; Also, if you ever intend to migrate to using libvirt to manage the guest, it gets even worse.&#160; I think I gave an example within the last few weeks of a simple wrapper script for QEMU that can be used with libvirt if all you need to do is add the x-vga=on option to vfio-pci VGA device.&#160; With q35 people end up requiring &lt;qemu:arg&gt; extensions in the guest xml that hides the assigned device and setup of resources for it from libvirt.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1485487">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=144">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=143">143</a> <a href="viewtopic.php?id=162768&amp;p=144">144</a> <strong>145</strong> <a href="viewtopic.php?id=162768&amp;p=146">146</a> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=146">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
