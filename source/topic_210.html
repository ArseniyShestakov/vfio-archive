<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 210) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=210" title="Page 210" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=209" title="Page 209" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=211" title="Page 211" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=209">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=208">208</a> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <strong>210</strong> <a href="viewtopic.php?id=162768&amp;p=211">211</a> <a href="viewtopic.php?id=162768&amp;p=212">212</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=211">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1532471" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5226</span> <a href="viewtopic.php?pid=1532471#p1532471">2015-05-27 19:22:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><div class="quotebox"><cite>jack_boss wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Maybe your ovmf package isn&#039;t installing the files where libvirt/virt-manager looks for them?&#160; On my Fedora 21 system the binaries are installed in /usr/share/edk2.git/ovmf-x64/&#160; Your virt-manager would need to be pulled form the devel tree since last Wednesday to include the fix.&#160; AIUI = As I Understand It.</p></div></blockquote></div><p>I&#039;m stuck at this step too, since I started following your guide.<br />I found out that ovmf from the arch official repository installs its files to</p><div class="codebox"><pre><code>/usr/share/ovmf/ovmf_x64.bin</code></pre></div><p> vs ovmf-svn (installed today) </p><div class="codebox"><pre><code>/usr/share/ovmf/64/ovmf_x64.bin</code></pre></div><p>I made softlinks to point to the &quot;correct&quot; place. Didn&#039;t work.</p></div></blockquote></div><br /><p>You need to follow the instructions here:</p><p><a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#Installation" rel="nofollow">https://wiki.archlinux.org/index.php/PC … stallation</a></p><p>The packages on aur won&#039;t work.</p><p>Edit: And to make it appear in virtual manager add this to qemu.conf:</p><p> nvram = [<br />&#160; &#160; &quot;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd:/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd&quot;,<br />&#160; &#160; &quot;/usr/share/edk2.git/aarch64/QEMU_EFI-pflash.raw:/usr/share/edk2.git/aarch64/vars-template-pflash.raw&quot;,<br /> ]</p><p>Now this is where I am unclear, I only included the second aarch64 line because libvirt fails to start if it isn&#039;t in there, but there isn&#039;t anything at that location. I guess qemu.conf needs it defined even if you don&#039;t use it?</p></div></blockquote></div><p>This is the right answer, in general. In more detail:</p><p>* The AUR builds are probably not okay -- I assume they don&#039;t package the separate (split) OVMF_CODE.fd (firmware binary) and OVMF_VARS.fd (varstore template) files. Gerd&#039;s packages do.</p><p>* You should edit the nvram stanza in /etc/libvirt/qemu.conf as described above, and restart libvirtd. This is documented in the OVMF whitepaper, section&#160; &quot;Installation of OVMF guests with virt-manager and virt-install&quot;.</p><p>* Unless you give me the exact error message from libvirt, I won&#039;t know why it rejected the single-entry nvram stanza. (Refer to /var/log/messages or systemctl status libvirtd.) My guess is that you may have left a stray comma at the end of that sole entry. (OTOH, as Alex points out, your example now has a stray comma after the second entry, and apparently libvirt doesn&#039;t complain... So please provide the exact error message.)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532471">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532475" class="blockpost roweven"> <h2><span><span class="conr">#5227</span> <a href="viewtopic.php?pid=1532475#p1532475">2015-05-27 19:31:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, so it looks like my issue was that I was commenting out the line in the middle of the configuration block with a #. If I remove the line completely libvirtd restarts fine. My fault for being lazy.</p><p>This is what systemctl spits back at me with the # in the config block. </p><p>May 27 15:27:09 Desktop libvirtd[2264]: libvirt version: 1.2.15<br />May 27 15:27:09 Desktop libvirtd[2264]: internal error: Failed to find path for dmidecode binary<br />May 27 15:27:09 Desktop libvirtd[2264]: configuration file syntax error: /etc/libvirt/qemu.conf:516: expecting a value<br />May 27 15:27:09 Desktop libvirtd[2264]: Initialization of QEMU state driver failed: configuration file syntax error: /etc/libvirt/qemu.conf:516: expecting a value<br />May 27 15:27:09 Desktop libvirtd[2264]: Driver state initialization failed</p><p>Edit: And yeah the aur builds of ovmf just create one binary, so using gerd&#039;s package is the correct option to get it working with virt-manager.</p> <p class="postedit"><em>Last edited by Punkbob (2015-05-27 19:33:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532475">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532486" class="blockpost rowodd"> <h2><span><span class="conr">#5228</span> <a href="viewtopic.php?pid=1532486#p1532486">2015-05-27 20:15:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@lersek thanks a lot this is actually working :</p><p>1. Getting ovmf from Gerf Hoffman&#039;s repo ;<br />2. Editing qemu.conf.</p><p>I now can select OVMF from virt-manager GUI. Not sure about hyper-V extensions though. I will probably have to turn them off manually. I&#039;ll keep you posted.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532486">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532528" class="blockpost roweven"> <h2><span><span class="conr">#5229</span> <a href="viewtopic.php?pid=1532528#p1532528">2015-05-28 01:46:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>update on the laptop experiment:<br />when I&#039;ve tried to get more info on the BSOD, it just installed the driver fine. I&#039;ve not changed anything since the BSOD, no idea why it didn&#039;t crash now then ...<br />though I&#039;m still in state I was in previous install (the one where I installed drivers when cirrus was primary) - it boots, shows logo ans &quot;starting windows&quot;, then screen goes black and while after that I see the sound it does when finished booting and asks for password.<br />I don&#039;t see anything interesting in event log, nothing in dmesg at that time.<br />interesting thing is that windows lists the card as 7400M series (after installing amd driver). no idea if that&#039;s correct or not, I&#039;ve not installed windows on this machine in some time, so I don&#039;t have where to check, if that&#039;s correct. (6400 and 7400 are quite simmilar, linux lists it as 6400m/7400m)</p><p>the problem with not shutting down is still present, any ideas on that?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532528">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532543" class="blockpost rowodd"> <h2><span><span class="conr">#5230</span> <a href="viewtopic.php?pid=1532543#p1532543">2015-05-28 06:16:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is it possible to use cpu-passthrough mode with that 2 extra flags to make windows 10 boot/work with &quot;real&quot; cpu id?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532543">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532654" class="blockpost roweven"> <h2><span><span class="conr">#5231</span> <a href="viewtopic.php?pid=1532654#p1532654">2015-05-28 16:56:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Is it possible to use cpu-passthrough mode with that 2 extra flags to make windows 10 boot/work with &quot;real&quot; cpu id?</p></div></blockquote></div><p>It&#039;s a problem with kvm *itself* so it makes more sense to report a bug with upstream.</p><p>Edit: I am debugging it now, the error I see spit back at me in the log files is:</p><p>kvm [5953]: vcpu0 unhandled wrmsr: 0x38d data 0</p><p>Which when I search there are references on the kvm mailing list to processor functionality that the OS is trying to address, and kvm not having the extra code to properly use those features. </p><p>I am going to build a test box and turn serial debugging on inside windows, and go from there to see what it complains about.</p> <p class="postedit"><em>Last edited by Punkbob (2015-05-28 17:09:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532654">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532657" class="blockpost rowodd"> <h2><span><span class="conr">#5232</span> <a href="viewtopic.php?pid=1532657#p1532657">2015-05-28 17:09:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>AIUI Win7+OVMF+SMP is incompatible with hyper-v extensions, so you&#039;ll need to disable them even if you&#039;re not using Nvidia.</p></div></blockquote></div><p>Errr... I&#039;ve had this working some time ago, but... now the manually-added hyper-v enlightenments are gone from my domain xml... I should try adding them manually. Oh well. Yeah, not it hangs up on boot logo.</p><div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>though I&#039;m still in state I was in previous install (the one where I installed drivers when cirrus was primary) - it boots, shows logo ans &quot;starting windows&quot;, then screen goes black and while after that I see the sound it does when finished booting and asks for password.</p></div></blockquote></div><p>Can you plug a screen into some of that GPU&#039;s video outputs? Like, an HDMI port or VGA or whatever you have there? Chances are the GPU doesn&#039;t find where to output and starts working as a 3D accelerator. Maybe you&#039;ll need to research your laptop deeper.</p><div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><p>I am going to build a test box and turn serial debugging on inside windows, and go from there to see what it complains about.</p></div></blockquote></div><p>Am i misunderstanding something, or wouldn&#039;t you achieve the same using qemu&#039;s built-in GDB server?</p> <p class="postedit"><em>Last edited by Duelist (2015-05-28 18:57:31)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532657">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532702" class="blockpost roweven"> <h2><span><span class="conr">#5233</span> <a href="viewtopic.php?pid=1532702#p1532702">2015-05-28 19:59:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Duelist</p><p>From what I understand if I want to see what is going on inside windows I need to enable serial debugging and then connect to that from another windows machine as windows uses a special format. I also need to look at kvm to see what calls are being made to it, but I was starting from the inside out. </p><p>If I am wrong please feel free to correct me, as it&#039;d save me some time configuring windbg.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532702">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532760" class="blockpost rowodd"> <h2><span><span class="conr">#5234</span> <a href="viewtopic.php?pid=1532760#p1532760">2015-05-29 02:17:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So completely useless, but if you enable debug mode in Windows it will boot on haswell just fine.</p><p>It appears that it&#039;s an issue with setting a value on IA32_FIXED_CTR_CTRL which relates to CPU performance monitoring on processors Nethalhem or later.</p><p>A VMware article mentions things that you have to do to enable it in esx, might be something that kvm needs to address. <br /><a href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=2030221" rel="nofollow">http://kb.vmware.com/selfservice/micros … Id=2030221</a></p><p>Edit: Or I could be barking up the completely wrong tree, still need to debug the windows kernel.</p><p>Edit2: Solved it or at least got it to boot?</p><p>So I did 2 things, first I set the CPU to &quot;host-passthrough&quot; and then ran &quot;echo 1 &gt; /sys/module/kvm/parameters/ignore_msrs&quot; </p><p>It basically tells kvm to not send a fault when it can&#039;t access or set a msr value on the host CPU. The host-passthrough part is most likely not required, but something I tried that at least gave me a different msr error(vcpu0 ignored rdmsr: 0x639) and should also enable you to use Nvidia game-streaming as it will report your exact CPU.</p> <p class="postedit"><em>Last edited by Punkbob (2015-05-29 03:35:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532760">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532763" class="blockpost roweven"> <h2><span><span class="conr">#5235</span> <a href="viewtopic.php?pid=1532763#p1532763">2015-05-29 03:15:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Nice, I will try it later today after work.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532763">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532764" class="blockpost rowodd"> <h2><span><span class="conr">#5236</span> <a href="viewtopic.php?pid=1532764#p1532764">2015-05-29 03:19:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><p>Edit2: Solved it or at least got it to boot?</p><p>So I did 2 things, first I set the CPU to &quot;host-passthrough&quot; and then ran &quot;echo 1 &gt; /sys/module/kvm/parameters/ignore_msrs&quot; </p><p>It basically tells kvm to not send a fault when it can&#039;t access or set a msr value on the host CPU. The host-passthrough part is most likely not required, but something I tried that at least gave me a different msr error(vcpu0 ignored rdmsr: 0x639) and should enable you to use Nvidia game-streaming.</p></div></blockquote></div><p>This is also necessary to make the Passmark Performance Test work, so I&#039;ve typically got it enabled already FWIW</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532764">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532772" class="blockpost roweven"> <h2><span><span class="conr">#5237</span> <a href="viewtopic.php?pid=1532772#p1532772">2015-05-29 04:40:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Also, when using CPU-Z software, dmesg screams with unhandled rdmsr errors, i guess cpu-z tries to determine the frequency and a multiplier by accessing those MSRs, and since we have our CPUs virtual, it fails too.<br />I don&#039;t think that this detail is very worth noting, but let it be.</p><p>BTW:<br />What do you guys recommend for storage subsystem?<br />I&#039;ve added a small, 8GB raw file image located on old OCZ SSD to my VM, and connected it via virtio-blk-pci.</p><p>I&#039;ve tried using iothreads(which <a href="http://wiki.mikejung.biz/KVM_/_Xen#virtio-blk_iothreads_.28x-data-plane.29" rel="nofollow">are</a> related to x-data-plane, i guess) with virtio-blk-pci but i have huge host CPU usage in benchmarks and small freezes in some weird games when loading heavy parts of the scene(the game is poorly written, but it&#039;s almost 8 years old). ATTO disk benchmark also reports a decrease in linear write performance starting somewhere at 256k sector size.</p><p>That compares poorly with virtio-scsi with four queues enabled, it provides me a significant increase in linear write performance, but the freezes aren&#039;t gone and there&#039;s a huge host CPU usage while benchmarking(well, it&#039;s pushing 200-300MB/s).</p><p>I remember aw said that he has x-data-plane enabled, but... it&#039;s either i&#039;ve missed something in libvirt&#039;s domain xml or virtio-scsi is better.<br />And also, seems like cache=none performs better than cache=directsync when not using iothreads - redhat&#039;s optimization guide doesn&#039;t mention the second caching method or iothreads, maybe it&#039;s already outdated?..</p><p>But i definitely should determine a good method of measuring disk performance, as ATTO disk benchmark doesn&#039;t count IOPS.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-29 05:07:46)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532772">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532833" class="blockpost rowodd"> <h2><span><span class="conr">#5238</span> <a href="viewtopic.php?pid=1532833#p1532833">2015-05-29 12:48:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I remember aw said that he has x-data-plane enabled</p></div></blockquote></div><p>Nope, I use virtio-scsi w/ multiqueue</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532833">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533158" class="blockpost roweven"> <h2><span><span class="conr">#5239</span> <a href="viewtopic.php?pid=1533158#p1533158">2015-05-31 02:17:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75818">ceri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 44</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is it worth getting the i7-4790K over the i5-4690K for the extra vCPUs (hyperthreading)? What kind of benefits would I see?</p><p>My use case is simultaneous gaming on the VM, with moderate multitasking on the host (say 30-50 firefox tabs, etc).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533172" class="blockpost rowodd"> <h2><span><span class="conr">#5240</span> <a href="viewtopic.php?pid=1533172#p1533172">2015-05-31 03:59:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Could you please test this?&#160; <a href="http://paste.fedoraproject.org/225883/98048143/" rel="nofollow">http://paste.fedoraproject.org/225883/98048143/</a></p></div></blockquote></div><p>Now kernel doesn&#039;t panic or throw any error, but QEMU (stable) still hangs at shutting down, I will try the git version tomorrow</p><p>EDIT: Noticed that there is another version for upstream, I will test that one, sorry for confusion</p> <p class="postedit"><em>Last edited by Cubex (2015-06-01 01:24:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533172">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533337" class="blockpost roweven"> <h2><span><span class="conr">#5241</span> <a href="viewtopic.php?pid=1533337#p1533337">2015-05-31 21:56:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ceri wrote:</cite><blockquote><div><p>Is it worth getting the i7-4790K over the i5-4690K for the extra vCPUs (hyperthreading)? What kind of benefits would I see?</p><p>My use case is simultaneous gaming on the VM, with moderate multitasking on the host (say 30-50 firefox tabs, etc).</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>30-50 firefox tabs</p></div></blockquote></div><p>LOL!<br /><span class="postimg"><img src="http://i.imgur.com/FQYhiJS.png" alt="FQYhiJS.png" /></span><br />And that&#039;s only the QEMU group. As you can see, firefox is more memory-hungry.</p><p>And now seriously:<br />I have 4 cores in my cheap Athlon X4 750K, and i&#039;m assigning all the cores to the guest. Yeah, when either host or guest is loaded - the other system will stutter, lag and suffer from CPU starvation. But i&#039;m very rarely that &quot;productive&quot;.</p><p>You&#039;ll want additional cores to use cpu pinning.<br />So, for example, i could&#039;ve cut three cores from the host and dedicate(pin) them to the VM. That would give the guest a very good CPU performance(almost native/baremetal) and what is more important - reduce the latencies and that would theoretically fix the audio problems. But i don&#039;t like to leave my host with one core only, because... i feel sad for it.</p><p>So basically, more cores - more performance, obviously, and if getting an i7 isn&#039;t much a financial burden for you - it would be great to use it.</p><p><strong>BUT!</strong> Beware of VT-d, as some(4770K for example) K-series CPUs have disabled VT-d. That feature is crucial for the passthrough to work.</p><p>Also, you could get a Xeon E3-series, like aw does(read the first part of the guide on <a href="http://vfio.blogspot.com/" rel="nofollow">his blog</a>), or, better yet - take a Xeon E5. That&#039;d be an ultimate choice, but ultimately pricey.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-31 21:57:32)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533337">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533356" class="blockpost rowodd"> <h2><span><span class="conr">#5242</span> <a href="viewtopic.php?pid=1533356#p1533356">2015-05-31 23:40:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p> -Snip-<br />I have 4 cores in my cheap Athlon X4 750K, and i&#039;m assigning all the cores to the guest. Yeah, when either host or guest is loaded - the other system will stutter, lag and suffer from CPU starvation. But i&#039;m very rarely that &quot;productive&quot;.</p><p>You&#039;ll want additional cores to use cpu pinning.<br />So, for example, i could&#039;ve cut three cores from the host and dedicate(pin) them to the VM. That would give the guest a very good CPU performance(almost native/baremetal) and what is more important - reduce the latencies and that would theoretically fix the audio problems. But i don&#039;t like to leave my host with one core only, because... i feel sad for it.</p><p>So basically, more cores - more performance, obviously, and if getting an i7 isn&#039;t much a financial burden for you - it would be great to use it.<br />-Snip-</p></div></blockquote></div><p>How would i go about dedicating some cores to the VM? And could it be done dynamically? (while the system and VM is running). I already have the VCPU cores pinned, but the cores are still being used on the host.</p><p>I&#039;m having some problems, in the beginning it was with USB sound cards (it made the whole VM stutter when it was running). Now i&#039;m using a virtual soundcard and the whole system is just slightly slow.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533356">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533365" class="blockpost roweven"> <h2><span><span class="conr">#5243</span> <a href="viewtopic.php?pid=1533365#p1533365">2015-06-01 01:36:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>How would i go about dedicating some cores to the VM? And could it be done dynamically? (while the system and VM is running). I already have the VCPU cores pinned, but the cores are still being used on the host.</p><p>I&#039;m having some problems, in the beginning it was with USB sound cards (it made the whole VM stutter when it was running). Now i&#039;m using a virtual soundcard and the whole system is just slightly slow.</p></div></blockquote></div><p>There&#039;s a number of various ways of doing so, but... i haven&#039;t used any of these:</p><p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Resource_Management_Guide/sec-cpuset.html" rel="nofollow">cpuset</a><br /><a href="http://www.linux-kvm.com/content/tip-running-your-vm-specific-cpus" rel="nofollow">taskset</a><br /><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Tuning_and_Optimization_Guide/sect-Virtualization_Tuning_Optimization_Guide-Virt_Manager-CPU_Options.html#idp4270912" rel="nofollow">Libvirt&#039;s way</a> - similar to cpuset maybe?..</p><p>And there was a way of using isolcpus and switching the cores offline for host(NoHZ mode?) and only bringing them up for the guest system, but i can&#039;t find more info... But yeah, somewhere in the thread someone did that.</p><p>Dynamically... Well, dynamic allocation ruins the latencies, as i understand it. Using cpuset does exactly that you want - it only makes the process working on the specified core, without forcing all other process from that core.</p><br /><p>I&#039;m not so familiar with all this stuff, because i don&#039;t have &quot;enough&quot; CPU cores for experiments.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533365">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533370" class="blockpost rowodd"> <h2><span><span class="conr">#5244</span> <a href="viewtopic.php?pid=1533370#p1533370">2015-06-01 02:12:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75818">ceri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 44</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>*SNIP*<br />And that&#039;s only the QEMU group. As you can see, firefox is more memory-hungry.</p><p>And now seriously:<br />I have 4 cores in my cheap Athlon X4 750K, and i&#039;m assigning all the cores to the guest. Yeah, when either host or guest is loaded - the other system will stutter, lag and suffer from CPU starvation. But i&#039;m very rarely that &quot;productive&quot;.</p><p>You&#039;ll want additional cores to use cpu pinning.<br />So, for example, i could&#039;ve cut three cores from the host and dedicate(pin) them to the VM. That would give the guest a very good CPU performance(almost native/baremetal) and what is more important - reduce the latencies and that would theoretically fix the audio problems. But i don&#039;t like to leave my host with one core only, because... i feel sad for it.</p><p>So basically, more cores - more performance, obviously, and if getting an i7 isn&#039;t much a financial burden for you - it would be great to use it..</p></div></blockquote></div><p>Haha point taken.</p><p>(As a side note, you should consider using tree style tabs.)</p><p>I&#039;m planning on reusing my old ram (16GB) and using the savings to get an i7-4790K which does support VT-d: <a href="http://ark.intel.com/compare/80810,80811,80807,80806" rel="nofollow">http://ark.intel.com/compare/80810,80811,80807,80806</a></p><p>Given that this has 4 real cores and 8 threads, would I still have to worry about CPU pinning to avoid stuttering? If so, I think i would just allocate 50% to each side.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533370">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533378" class="blockpost roweven"> <h2><span><span class="conr">#5245</span> <a href="viewtopic.php?pid=1533378#p1533378">2015-06-01 03:45:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Both patches works for fixing the null pointer at shutdown, thanks.</p><p>EDIT:</p><p>&quot;dmar: DRHD: handling fault status reg 2&quot; <br />is caused by USB3 controller in MB when using qemu git version, but in stable works</p> <p class="postedit"><em>Last edited by Cubex (2015-06-01 04:05:47)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533378">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533529" class="blockpost rowodd"> <h2><span><span class="conr">#5246</span> <a href="viewtopic.php?pid=1533529#p1533529">2015-06-01 16:39:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Guys, some time ago i was told that UEFI GOP can&#039;t go beyond 1024x768 without device-specific drivers.</p><p>How does gigabyte Z87X-UD3H output 1920x1080 in UEFI setup? Intel-specific hacks?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533529">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533908" class="blockpost roweven"> <h2><span><span class="conr">#5247</span> <a href="viewtopic.php?pid=1533908#p1533908">2015-06-02 21:03:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey all,<br />I&#039;ve gone through some of the posts around pages 26-29 concerning running vga passthrough as a non-root user. Although I used `chown` on /dev/vfio for my user, I still got the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -device vfio-pci,host=03:00.0,x-vga=on -device vfio-pci,host=03:00.1 \ -vga none #--- it returns this: -smp 4,sockets=1,cores=4,threads=1 \ -device vfio-pci,host=03:00.0,x-vga=on -device vfio-pci,host=03:00.1 \ -vga noneqemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0x0, 0xc0000, 0x7f3fa0000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0xc0000, 0x20000, 0x7f3fee600000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0x100000, 0x3ff00000, 0x7f3fa0100000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to setup container for group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>The same command runs fine as root. I have also chown&#039;ed /dev/hugepages in addition -- to no avail. Does anyone have an answer to this problem? I apologize if an answer was earlier in the 200+ pages that I couldn&#039;t search well.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533908">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533912" class="blockpost rowodd"> <h2><span><span class="conr">#5248</span> <a href="viewtopic.php?pid=1533912#p1533912">2015-06-02 21:07:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noctlos wrote:</cite><blockquote><div><p>Hey all,<br />I&#039;ve gone through some of the posts around pages 26-29 concerning running vga passthrough as a non-root user. Although I used `chown` on /dev/vfio for my user, I still got the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -device vfio-pci,host=03:00.0,x-vga=on -device vfio-pci,host=03:00.1 \ -vga none #--- it returns this: -smp 4,sockets=1,cores=4,threads=1 \ -device vfio-pci,host=03:00.0,x-vga=on -device vfio-pci,host=03:00.1 \ -vga noneqemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0x0, 0xc0000, 0x7f3fa0000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0xc0000, 0x20000, 0x7f3fee600000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio_dma_map(0x7f400232e9d0, 0x100000, 0x3ff00000, 0x7f3fa0100000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to setup container for group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>The same command runs fine as root. I have also chown&#039;ed /dev/hugepages in addition -- to no avail. Does anyone have an answer to this problem? I apologize if an answer was earlier in the 200+ pages that I couldn&#039;t search well.</p></div></blockquote></div><p>In order to assign a PCI device to a VM, all of the guest memory needs to be pinned (ie. locked) into host memory and mapped through the IOMMU.&#160; A normal user only has the ability to lock 64KB of memory (see <em>ulimit</em>).&#160; Your VM is probably bigger than that, therefore you need to increase the locked memory limit for the user to run the VM.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533912">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533924" class="blockpost roweven"> <h2><span><span class="conr">#5249</span> <a href="viewtopic.php?pid=1533924#p1533924">2015-06-02 22:16:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74484">noctlos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-26</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74484">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>In order to assign a PCI device to a VM, all of the guest memory needs to be pinned (ie. locked) into host memory and mapped through the IOMMU.&#160; A normal user only has the ability to lock 64KB of memory (see <em>ulimit</em>).&#160; Your VM is probably bigger than that, therefore you need to increase the locked memory limit for the user to run the VM.</p></div></blockquote></div><p>Thanks for the tip! How do I increase the locked memory limit?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533924">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1533925" class="blockpost rowodd"> <h2><span><span class="conr">#5250</span> <a href="viewtopic.php?pid=1533925#p1533925">2015-06-02 22:19:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noctlos wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>In order to assign a PCI device to a VM, all of the guest memory needs to be pinned (ie. locked) into host memory and mapped through the IOMMU.&#160; A normal user only has the ability to lock 64KB of memory (see <em>ulimit</em>).&#160; Your VM is probably bigger than that, therefore you need to increase the locked memory limit for the user to run the VM.</p></div></blockquote></div><p>Thanks for the tip! How do I increase the locked memory limit?</p></div></blockquote></div><p>/etc/security/limits.d/ (see limits.conf it the parent directory)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1533925">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=209">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=208">208</a> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <strong>210</strong> <a href="viewtopic.php?id=162768&amp;p=211">211</a> <a href="viewtopic.php?id=162768&amp;p=212">212</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=211">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
