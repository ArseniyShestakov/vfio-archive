<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 109) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=109" title="Page 109" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=108" title="Page 108" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=110" title="Page 110" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=108">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <a href="viewtopic.php?id=162768&amp;p=108">108</a> <strong>109</strong> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <a href="viewtopic.php?id=162768&amp;p=111">111</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=110">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1455631" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2701</span> <a href="viewtopic.php?pid=1455631#p1455631">2014-09-11 16:57:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1451809#p1451809" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1451809</a><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1452530#p1452530" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1452530</a></p><p>Problem persists also with kernel 3.16.2.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455631">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455659" class="blockpost roweven"> <h2><span><span class="conr">#2702</span> <a href="viewtopic.php?pid=1455659#p1455659">2014-09-11 18:27:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1451809#p1451809" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1451809</a><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1452530#p1452530" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1452530</a></p><p>Problem persists also with kernel 3.16.2.</p></div></blockquote></div><p>If you&#039;re not getting monitor sync when the VM starts, then you have a problem with VGA arbitration or device ROM.&#160; Also, please stop specifying -bios, you don&#039;t need it.</p><p>You said you&#039;ve applied the i915 VGA arbiter patch and are using i915.enable_hd_vgaarb=1... Are you actually loading i915 in the host or is it perhaps blacklisted?</p><p>Pastebin of host dmesg might be the next step if you can confirm i915 is being used.&#160; There&#039;s also the non-VGA option with OVMF...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455794" class="blockpost rowodd"> <h2><span><span class="conr">#2703</span> <a href="viewtopic.php?pid=1455794#p1455794">2014-09-12 06:42:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You said you&#039;ve applied the i915 VGA arbiter patch and are using i915.enable_hd_vgaarb=1... Are you actually loading i915 in the host or is it perhaps blacklisted?</p><p>Pastebin of host dmesg might be the next step if you can confirm i915 is being used.</p></div></blockquote></div><p>I&#039;m sure the i915 is not blacklisted and it&#039;s loaded and used by the host.</p><br /><br /><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>There&#039;s also the non-VGA option with OVMF...</p></div></blockquote></div><p>I don&#039;t really know what is OVMF, but reading something on the web I understood it has something to do with UEFI.<br />Consider that I&#039;m not using UEFI on the host, nor no the guest.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455794">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455875" class="blockpost roweven"> <h2><span><span class="conr">#2704</span> <a href="viewtopic.php?pid=1455875#p1455875">2014-09-12 13:11:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>There&#039;s also the non-VGA option with OVMF...</p></div></blockquote></div><p>I don&#039;t really know what is OVMF, but reading something on the web I understood it has something to do with UEFI.<br />Consider that I&#039;m not using UEFI on the host, nor no the guest.</p></div></blockquote></div><p>Look down, hint, hint</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455875">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455955" class="blockpost rowodd"> <h2><span><span class="conr">#2705</span> <a href="viewtopic.php?pid=1455955#p1455955">2014-09-12 18:59:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85070">Arakatak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-12</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85070">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dear Forum,<br />I have some problems installing ATi drivers under Windows 8.1 Guest with passed through ASUS R7 260X videocard.</p><p>Basic Windows setup with default VGA driver works (the OS is able to output to the passed through videocard). Howewer, installation of drivers from the manufacturer or AMD support website results in black screen and &quot;No Signal&quot; error on passed through VGA port from the monitor. After host reboot I&#039;m able to start the Guest, but can&#039;t see anything except Seabios messages and initial logo startup screen.</p><p>If I&#039;ll detach VGA-adapter with a help of Windows clipboard icon, I&#039;ll get blank screen too, but simple reboot would solve the problem.</p><p>My Software:</p><ul><li><p>Linux 3.16.0-mainline (with patches from this guide)</p></li><li><p>qemu 2.1.0</p></li><li><p>Seabios 1.7.5</p></li><li><p>Weston with XWayland to handle SDL qemu windows</p></li><li><p>xf86-video-intel</p></li></ul><p>On host - UEFI without CSM</p><p>My Hardware:</p><ul><li><p>ASRock Z97 Extreme4 motherboard</p></li><li><p>Intel i7-4790K (supports vt-d)</p></li><li><p>HD4600 as primary host video adapter</p></li><li><p>ASUS R7260X-DC2OC-2GD5 passed through to Windows Guest</p></li></ul><div class="codebox"><pre><code>cat /proc/cmdline root=/dev/disk/by-uuid/*** rw initrd=/initramfs-linux-mainline.img resume=/dev/disk/by-uuid/*** quiet intel_iommu=on i915.enable_hd_vgaarb=1</code></pre></div><p>Additional kernel boot parameters &quot;vfio_iommu_type1.allow_unsafe_interrupts=1 kvm.ignore_msrs=1&quot; didn&#039;t help.</p><div class="codebox"><pre><code>cat /etc/mkinitcpio.conf ... MODULES=&quot;i915&quot; ...</code></pre></div><div class="codebox"><pre><code>cat /etc/modprobe.d/blacklist.conf blacklist radeon</code></pre></div><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU [ 0.000000] ACPI: DMAR 0x00000000BD341FF0 0000B8 (v01 INTEL BDW 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.021929] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a [ 0.021933] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da [ 0.021997] IOAPIC id 8 under DRHD base 0xfed91000 IOMMU 1 [ 0.465600] DMAR: No ATSR found [ 0.465618] IOMMU 0 0xfed90000: using Queued invalidation [ 0.465619] IOMMU 1 0xfed91000: using Queued invalidation [ 0.465620] IOMMU: Setting RMRR: [ 0.465628] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff] [ 0.466660] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdea8000 - 0xbdeb6fff] [ 0.466677] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdea8000 - 0xbdeb6fff] [ 0.466692] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdea8000 - 0xbdeb6fff] [ 0.466703] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.466708] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 0.532566] [drm] DMAR active, disabling use of stolen memory</code></pre></div><div class="codebox"><pre><code>cat qemu-win #!/bin/bash QEMU_AUDIO_DRV=alsa QEMU_ALSA_DAC_DEV=&quot;hw:1,0&quot; QEMU_ALSA_ADC_DEV=&quot;hw:1,0&quot; qemu-system-x86_64 -enable-kvm \ -M q35 \ -m 8G \ -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/System/Windows8Guest,id=disk,format=raw,discard=on -device scsi-hd,drive=disk \ -drive file=/mnt/data/win.iso,id=isocd -device scsi-cd,drive=isocd \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1,id=exthda \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:24ae:2000</code></pre></div><p>Please, provide me any suggestions. I&#039;ll post additional info if required.<br />Thanks in advance</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455955">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456090" class="blockpost roweven"> <h2><span><span class="conr">#2706</span> <a href="viewtopic.php?pid=1456090#p1456090">2014-09-13 01:57:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have dell laptop with i3 i3-4010U it comes with just hd4200 video card.&#160; I wonder if&#160; its possible to have have it working ?<br />I get this :<br />-device vfio-pci,host=00:02.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: VFIO 0000:00:02.0 BAR 2 mmap unsupported. Performance may be slow<br />qemu-system-x86_64: -device vfio-pci,host=00:03.0,bus=root.1,addr=00.1: vfio: Error: Failed to setup INTx fd: Device or resource busy<br />qemu-system-x86_64: -device vfio-pci,host=00:03.0,bus=root.1,addr=00.1: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=00:03.0,bus=root.1,addr=00.1: Device &#039;vfio-pci&#039; could not be initialized<br />[root@localhost ~]# winstart.sh<br />qemu-system-x86_64: -device vfio-pci,host=00:02.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: VFIO 0000:00:02.0 BAR 2 mmap unsupported. Performance may be slow</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456090">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456094" class="blockpost rowodd"> <h2><span><span class="conr">#2707</span> <a href="viewtopic.php?pid=1456094#p1456094">2014-09-13 02:13:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tritron4 wrote:</cite><blockquote><div><p>I have dell laptop with i3 i3-4010U it comes with just hd4200 video card.&#160; I wonder if&#160; its possible to have have it working ?</p></div></blockquote></div><p>Not with the current code</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456094">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456146" class="blockpost roweven"> <h2><span><span class="conr">#2708</span> <a href="viewtopic.php?pid=1456146#p1456146">2014-09-13 08:08:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just tried XenGT some other day, and it&#039;s working very well. Intel igpu can be passed/SHARED with XenGT (warning!!! they say all 4th gen core processors but mine i3-4130 hd 4400 doesn&#039;t work, while 4770k hd 4600 works).</p><p>Intel also said that they have been working on KVM and&#160; it should be soon (couple of months) supported.</p> <p class="postedit"><em>Last edited by slis (2014-09-13 08:16:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456146">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456171" class="blockpost rowodd"> <h2><span><span class="conr">#2709</span> <a href="viewtopic.php?pid=1456171#p1456171">2014-09-13 11:01:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to pass through a Sat card and it mostly works but I suffer occasional break ups in channel feeds (Signal is fine and card is OK when run on bare metal). The VM is Ubuntu and the problem appears to be made worse by higher bandwidth (HD channels). A windows VM on the same system showed a DPC latency of 2-4000, is this likely to be part of the cause? Does anyone know how I might fix this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456171">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456210" class="blockpost roweven"> <h2><span><span class="conr">#2710</span> <a href="viewtopic.php?pid=1456210#p1456210">2014-09-13 12:44:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ Arakatak,</p><p>try to go to device manager under windows, navigate to display adapter, click on it, now disable it ( Don&#039;t un install ), after displaying the adapter, windows should blink, now install the ATI drivers.</p><p>This problem comes from regular installations, not KVM/QEMU</p><br /><p>@EDIT:@</p><p>Q: I hate running sudo every time I want to boot a VM, is it not possible to assign the right groups to the Hardware access?</p> <p class="postedit"><em>Last edited by abdullah (2014-09-13 12:57:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456210">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456238" class="blockpost rowodd"> <h2><span><span class="conr">#2711</span> <a href="viewtopic.php?pid=1456238#p1456238">2014-09-13 14:03:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>Q: I hate running sudo every time I want to boot a VM, is it not possible to assign the right groups to the Hardware access?</p></div></blockquote></div><p>It is, you need to give the user access to the vfio group device file(s) and you need to set the locked memory limit sufficiently high enough to pin all of guest memory.&#160; The latter is the tricky part.&#160; libvirt does both of these for you, which is one of the reasons motivating many to move to libvirt managed VMs.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456272" class="blockpost roweven"> <h2><span><span class="conr">#2712</span> <a href="viewtopic.php?pid=1456272#p1456272">2014-09-13 15:45:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85066">fabian-z</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-12</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85066">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>In case someone may have use for it:<br />I adapted the i915 vgaarb patch to the current 3.17-rc4 linux-mainline kernel (failed to apply).<br />The VGA arbiter patch apparently got applied upstream &amp; the ACS override patch still applies cleanly.</p><p>You can find my 3.17-rc4 PKGBUILD tarball (adapted from AUR package) including patches here: <a href="https://cloud.nf-design.eu/f/d8445ddd67/" rel="nofollow">linux-mainline-3_17-vfio.tar.gz</a><br />Just extract and build with makepkg as usual.</p><div class="codebox"><pre><code>$ sha256sum linux-mainline-3_17-vfio.tar.gz b72350c959932516b39cb309e94abbe4a3b4f83bf238c9055859bccb3175d07f linux-mainline-3_17-vfio.tar.gz</code></pre></div><p>Kernel is working great for my setup (although I don&#039;t currently use libvirt, so I couldn&#039;t test this).</p> <p class="postedit"><em>Last edited by fabian-z (2014-09-13 15:48:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456272">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456387" class="blockpost rowodd"> <h2><span><span class="conr">#2713</span> <a href="viewtopic.php?pid=1456387#p1456387">2014-09-13 22:16:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85100">Tyrewt</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-13</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve got a Windows7 VM with PCI Pass-through. The PCI device is detected and drivers installed, though not in use with a Windows error: &quot;The device cannot find enough free resources that it can use (code 12)&quot;.&#160; &#160; Any suggestions on how to resolve this?</p><p><span class="postimg"><img src="http://i.imgur.com/Xw9KuNxl.png" alt="Xw9KuNxl.png" /></span></p><p>Full size image: <a href="http://i.imgur.com/Xw9KuNx.png" rel="nofollow">http://i.imgur.com/Xw9KuNx.png</a></p><p><em>Moderator edit [ewaller] Converted over size image tags to url tags&#160; <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Pasting_Pictures_and_Code" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … s_and_Code</a></em></p> <p class="postedit"><em>Last edited by Tyrewt (2014-09-13 22:31:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456438" class="blockpost roweven"> <h2><span><span class="conr">#2714</span> <a href="viewtopic.php?pid=1456438#p1456438">2014-09-14 02:48:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>I&#039;ve got a Windows7 VM with PCI Pass-through. The PCI device is detected and drivers installed, though not in use with a Windows error: &quot;The device cannot find enough free resources that it can use (code 12)&quot;.&#160; &#160; Any suggestions on how to resolve this?</p></div></blockquote></div><p>How about following any of the directions in the OP or the link below?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456438">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456440" class="blockpost rowodd"> <h2><span><span class="conr">#2715</span> <a href="viewtopic.php?pid=1456440#p1456440">2014-09-14 03:09:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85100">Tyrewt</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-13</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>I&#039;ve got a Windows7 VM with PCI Pass-through. The PCI device is detected and drivers installed, though not in use with a Windows error: &quot;The device cannot find enough free resources that it can use (code 12)&quot;.&#160; &#160; Any suggestions on how to resolve this?</p></div></blockquote></div><p>How about following any of the directions in the OP or the link below?</p></div></blockquote></div><p>That&#039;s not exactly being helpful. More specifically, on which of the 109 pages are you refering to?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456440">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456442" class="blockpost roweven"> <h2><span><span class="conr">#2716</span> <a href="viewtopic.php?pid=1456442#p1456442">2014-09-14 03:12:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>I&#039;ve got a Windows7 VM with PCI Pass-through. The PCI device is detected and drivers installed, though not in use with a Windows error: &quot;The device cannot find enough free resources that it can use (code 12)&quot;.&#160; &#160; Any suggestions on how to resolve this?</p></div></blockquote></div><p>How about following any of the directions in the OP or the link below?</p></div></blockquote></div><p>That&#039;s not exactly being helpful. More specifically, on which of the 109 pages are you refering to?</p></div></blockquote></div><p>OP = Original Post.&#160; Page 1, post 1.&#160; There are also only about 10 posts so far in the link below, all very helpful if I do say so myself.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456442">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456457" class="blockpost rowodd"> <h2><span><span class="conr">#2717</span> <a href="viewtopic.php?pid=1456457#p1456457">2014-09-14 04:38:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85100">Tyrewt</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-13</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>How about following any of the directions in the OP or the link below?</p></div></blockquote></div><p>That&#039;s not exactly being helpful. More specifically, on which of the 109 pages are you refering to?</p></div></blockquote></div><p>OP = Original Post.&#160; Page 1, post 1.&#160; There are also only about 10 posts so far in the link below, all very helpful if I do say so myself.</p></div></blockquote></div><p>Neither explicitly mention the issue I&#039;m addressing. Thanks anyway though.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456457">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456494" class="blockpost roweven"> <h2><span><span class="conr">#2718</span> <a href="viewtopic.php?pid=1456494#p1456494">2014-09-14 09:30:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Looks like the lastest ovmf git <a href="https://github.com/tianocore/edk2/commit/41f80fbd9905cdc9a457e3cdf8110539f948c6b9" rel="nofollow">works with the q35 chipset</a>.</p> <p class="postedit"><em>Last edited by nbhs (2014-09-14 09:35:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456494">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456558" class="blockpost rowodd"> <h2><span><span class="conr">#2719</span> <a href="viewtopic.php?pid=1456558#p1456558">2014-09-14 13:02:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>That&#039;s not exactly being helpful. More specifically, on which of the 109 pages are you refering to?</p></div></blockquote></div><p>OP = Original Post.&#160; Page 1, post 1.&#160; There are also only about 10 posts so far in the link below, all very helpful if I do say so myself.</p></div></blockquote></div><p>Neither explicitly mention the issue I&#039;m addressing. Thanks anyway though.</p></div></blockquote></div><p>You&#039;re right, neither explicitly mention a Code 12 error because if you&#039;ve configured things properly with your GPU as the primary VM graphics (hint, hint), a Code 12 error isn&#039;t something that happens.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456558">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456623" class="blockpost roweven"> <h2><span><span class="conr">#2720</span> <a href="viewtopic.php?pid=1456623#p1456623">2014-09-14 16:57:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85100">Tyrewt</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-13</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;re right, neither explicitly mention a Code 12 error because if you&#039;ve configured things properly with your GPU as the primary VM graphics (hint, hint), a Code 12 error isn&#039;t something that happens.</p></div></blockquote></div><p>Wonder how many of your other posts waste peoples time like this. Total poison to a community forum.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456623">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456631" class="blockpost rowodd"> <h2><span><span class="conr">#2721</span> <a href="viewtopic.php?pid=1456631#p1456631">2014-09-14 17:21:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=27289">ewaller</a></strong></dt> <dd class="usertitle"><strong>Forum Moderator</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/27289.jpg?m=1406180442" width="80" height="80" alt="" /></dd> <dd><span>From: Pasadena, CA</span></dd> <dd><span>Registered: 2009-07-13</span></dd> <dd><span>Posts: 10,547</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=27289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="https://wiki.archlinux.org/index.php/Forum_Etiquette#Respect_Other_Users" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … ther_Users</a><br /><a href="https://wiki.archlinux.org/index.php/Forum_Etiquette#Be_Responsible" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … esponsible</a><br /><a href="https://wiki.archlinux.org/index.php/Forum_Etiquette#Common_Sense_Introduction" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … troduction</a></p><p>I think the perception here is that the information is available for the reading.&#160; I also think that aw is trying to lead you to where you can find the answer.<br />I personally do not know id aw is correct, or not -- I do not have this configuration and have no experience with it.</p> <p class="postedit"><em>Last edited by ewaller (2014-09-14 17:21:56)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Nothing is too wonderful to be true, if it be consistent with the laws of nature -- <em>Michael Faraday</em><br />Like you, I have no idea what you are doing, but I am pretty sure it is wrong...<em>Jasonwryan</em><br />----<br /><a href="http://www.catb.org/~esr/faqs/smart-questions.html" rel="nofollow">How to Ask Questions the Smart Way</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456631">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456639" class="blockpost roweven"> <h2><span><span class="conr">#2722</span> <a href="viewtopic.php?pid=1456639#p1456639">2014-09-14 17:34:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;re right, neither explicitly mention a Code 12 error because if you&#039;ve configured things properly with your GPU as the primary VM graphics (hint, hint), a Code 12 error isn&#039;t something that happens.</p></div></blockquote></div><p>Wonder how many of your other posts waste peoples time like this. Total poison to a community forum.</p></div></blockquote></div><p>Here&#039;s how it works; if you show some effort that you&#039;ve researched how this is supposed to work, followed the guides to make it work, and still have a unique issue and provide sufficient information to attempt to start helping you, then I and others on this thread will go out of our way to help you.&#160; If you only drop a screenshot with an obviously broken setup (*), showing no evidence of attempting to understand the configuration or debug it yourself then yeah, you&#039;re going to get the same amount of effort from me as you&#039;re putting into the problem yourself.</p><p>(*) I tried to hint at this previously, but to be clear, your device manager shows two graphics devices and you&#039;re showing a screenshot of a QEMU SDL window.&#160; This means you&#039;re using using an emulated VGA device in addition to a assigned VGA device.&#160; There are some reports of Radeons working in this configuration, but they&#039;re typically one-offs.&#160; The method suggested in the original post is to configure the VM with only the assigned VGA device in the guest.&#160; There are also potentially patches required to make this work depending on your kernel version, QEMU version, and host configuration, none of which were shared with us.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456639">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456644" class="blockpost rowodd"> <h2><span><span class="conr">#2723</span> <a href="viewtopic.php?pid=1456644#p1456644">2014-09-14 17:48:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85070">Arakatak</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-12</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85070">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@ Arakatak,</p><p>try to go to device manager under windows, navigate to display adapter, click on it, now disable it ( Don&#039;t un install ), after displaying the adapter, windows should blink, now install the ATI drivers.</p><p>This problem comes from regular installations, not KVM/QEMU</p></div></blockquote></div><p>It didn&#039;t help. Why do you think it&#039;s not qemu/kvm? What means &quot;regular installations&quot;? Is it a Windows 8.1 Setup? If so, i also experimented with Windows 7.</p><p>At first Win7 showed some light on possible problems. I installed Catalyst drivers and on next reboot received BSOD (code 0x00000116 on first boot and 0x0000050 on sequential reboots). I followed the advice in <a href="https://bbs.archlinux.org/viewtopic.php?pid=1407618#p1407618" rel="nofollow">this post</a> and removed 01:00.1 audio device from passthrough, then reinstalled the drivers. Although tray icon device detach still worked wrong (resulting in still picture from the last moment before VGA detach), graphics device have functioned well with ATi driver.</p><p>Unfortunately, i wasn&#039;t able to make a fully functional fresh install of Win7 VM without audio 01:00.1 device passthrough. The problems were the same as i mentioned earlier (black screen after driver setup and reboot, but no &quot;No Signal&quot; error).</p><p>For the reference i provide my start scripts:</p><div class="codebox"><pre class="vscroll"><code>cat qemu-win7-setup qemu-win7 #!/bin/bash QEMU_AUDIO_DRV=alsa QEMU_ALSA_DAC_SIZE_IN_USEC=0 QEMU_ALSA_DAC_PERIOD_SIZE=256 QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_DEV=&quot;hw:1,0&quot; QEMU_ALSA_ADC_DEV=&quot;hw:1,0&quot; qemu-system-x86_64 -enable-kvm \ -M q35 \ -m 8G \ -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/System/Windows7Guest,id=disk,format=raw,discard=on -device scsi-hd,drive=disk \ -drive file=&quot;/mnt/data/win.iso&quot;,id=isocd -device scsi-cd,drive=isocd \ -drive file=/mnt/data/virtio-win-0.1-81.iso,id=virtiocd -device ide-cd,bus=ide.1,drive=virtiocd \ -boot once=d \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,id=extvga \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:046d:c328 \ -usbdevice host:046d:c247 #!/bin/bash QEMU_AUDIO_DRV=alsa QEMU_ALSA_DAC_SIZE_IN_USEC=0 QEMU_ALSA_DAC_PERIOD_SIZE=256 QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_DEV=&quot;hw:1,0&quot; QEMU_ALSA_ADC_DEV=&quot;hw:1,0&quot; qemu-system-x86_64 -enable-kvm \ -M q35 \ -m 8G \ -cpu host \ -smp 6,sockets=1,cores=3,threads=2 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/System/Windows7Guest,id=disk,format=raw,discard=on -device scsi-hd,drive=disk \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,id=extvga \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:046d:c328 \ -usbdevice host:046d:c247</code></pre></div><p>I welcome discussions on these problems, as it may help solve them.</p><div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>@EDIT:@</p><p>Q: I hate running sudo every time I want to boot a VM, is it not possible to assign the right groups to the Hardware access?</p></div></blockquote></div><p>Every additional layer of API complicates troubleshooting. Why should i use libvirt when i didn&#039;t even have minimalistic, but functional VM with 100% VGA passthrough support? As for complexity, i need proper documentation on VGA passthrough with libvirt (and possibly OVMF VGA passthrough, as my VGA functions well on native UEFI). So far i found neither.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456644">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456680" class="blockpost roweven"> <h2><span><span class="conr">#2724</span> <a href="viewtopic.php?pid=1456680#p1456680">2014-09-14 19:16:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Arakatak wrote:</cite><blockquote><div><p>As for complexity, i need proper documentation on VGA passthrough with libvirt (and possibly OVMF VGA passthrough, as my VGA functions well on native UEFI). So far i found neither.</p></div></blockquote></div><p>libvirt with VGA passthrough is difficult and usually results in using &lt;qemu:arg&gt; elements to hack around lack of support for the x-vga=on option of vfio.&#160; A better route would be to set the emulator in the VM xml to a wrapper script that adds the x-vga=on option so that libvirt can properly manage the vfio files and locked memory.&#160; An example of such a wrapper can be found here:</p><p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Technical_Notes/virt.html" rel="nofollow">https://access.redhat.com/documentation … /virt.html</a></p><p>In the example, the option &quot;,tx=time&quot; is added to every instance of a virtio-net-pci.&#160; A similar option for our application here might look something like &#039;s|host=01:00.0|host=01:00.0,x-vga=on|g&#039;</p><p>The benefit of OVMF is that VGA is not required.&#160; You can find a write-up of how to use it here:</p><p><a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">http://vfio.blogspot.com/2014/08/primar … t-vga.html</a><br /><a href="http://vfio.blogspot.com/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.com/2014/08/does-m … t-efi.html</a><br /><a href="http://vfio.blogspot.com/2014/09/libvirt-now-supports-ovmf.html" rel="nofollow">http://vfio.blogspot.com/2014/09/libvir … -ovmf.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456680">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1456789" class="blockpost rowodd"> <h2><span><span class="conr">#2725</span> <a href="viewtopic.php?pid=1456789#p1456789">2014-09-15 04:10:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>Wonder how many of your other posts waste peoples time like this. Total poison to a community forum.</p></div></blockquote></div><p>wow... is this some kind of appreciation for all the hard work AND great effort at keeping public well-informed about some really complex/experimental stuff?<br />truly, ignorance is a bliss...</p><p>@aw:<br />is there any way to track any kernel patches related to vga passthrough to know what (for people living far from kernel contribution realms)? some kind of newsgroup or any kind of filter on some website?<br />i mean, you mostly post about it on&#160; your blog, but just in case you &quot;miss&quot; something</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1456789">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=108">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <a href="viewtopic.php?id=162768&amp;p=108">108</a> <strong>109</strong> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <a href="viewtopic.php?id=162768&amp;p=111">111</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=110">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
