<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 125) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=125" title="Page 125" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=124" title="Page 124" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=126" title="Page 126" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=124">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <strong>125</strong> <a href="viewtopic.php?id=162768&amp;p=126">126</a> <a href="viewtopic.php?id=162768&amp;p=127">127</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=126">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1471010" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3101</span> <a href="viewtopic.php?pid=1471010#p1471010">2014-10-30 14:59:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>And I keep dis-recommending Q35, it&#039;s not needed for Windows guests</p></div></blockquote></div><p>Can you write a somewhat detailed answer about the reason why Q35 is bad? Or is it covered in your speech(which i haven&#039;t watched yet)?</p></div></blockquote></div><p>Q35 isn&#039;t necessarily bad, but it adds more complication for typically no gain.&#160; The default AHCI controller in the Q35 model has typically been horrible, both in performance and integrity.&#160; The PCIe topology becomes a problem for anyone wanting to migrate to libvirt because libvirt support for Q35 is very restrictive, which necessitates using of &lt;qemu:commandline&gt; blocks, which makes libvirt unaware of the assigned devices, which causes it to not setup file permissions and memory limits, etc.&#160; We also seem to have some unresolved Code 12 issues on Q35, for instance I cannot get a Quadro card to work on Q35 even though nvidia supports Quadro as a secondary device in a VM.&#160; I also wouldn&#039;t be surprised if there&#039;s some relation to Q35 for the Radeon BSODs.</p><p>Maybe the better question is what do you gain from Q35?&#160; Theoretically you gain access to extended PCI config space in the guest, but what does that get you?</p><p>There are cases with Linux guests where drivers blindly assume topology and may oops when a root port isn&#039;t present.&#160; Those cases certainly justify using Q35 today.</p><p>Someday Q35, or it&#039;s successor, will be a better option than 440FX for Windows guests, but I don&#039;t believe that day is today.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471010">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471093" class="blockpost roweven"> <h2><span><span class="conr">#3102</span> <a href="viewtopic.php?pid=1471093#p1471093">2014-10-30 19:17:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Awesome! thanks a lot for your help Alex! <strong>I can confirm that the brand new MSI GTX 980 Gaming has been successfully passed through Windows 8.1 with the latest NVidia drivers! </strong></p><p>Now, I will try to install it with virtio.</p><p>One question: do you recommend the use of libvirt for performance reasons? If so, is it enough to simply install it??</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471093">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471113" class="blockpost rowodd"> <h2><span><span class="conr">#3103</span> <a href="viewtopic.php?pid=1471113#p1471113">2014-10-30 20:10:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Awesome! thanks a lot for your help Alex! <strong>I can confirm that the brand new MSI GTX 980 Gaming has been successfully passed through Windows 8.1 with the latest NVidia drivers! </strong></p><p>Now, I will try to install it with virtio.</p><p>One question: do you recommend the use of libvirt for performance reasons? If so, is it enough to simply install it??</p></div></blockquote></div><p>libvirt makes some aspects of performance tuning easier, especially things like vCPU pinning, network configuration, and device tuning options, but it&#039;s not required.&#160; If you use VGA assignment you also need to deal with the lack of support for the x-vga option, which often leads people to use &lt;qemu:commandline&gt; blocks that hide the device assignment from libvirt and make lots of things more difficult.&#160; I recommend instead using a wrapper script around qemu to insert the option (I provided a link to some redhat documentation that could be adapted for this a while ago).&#160; The even better option is to use OVMF, which seems like it should be possible for you since you&#039;re running Win8.1 and have a new video card.&#160; There are no libvirt hacks required for GPU assignment with OVMF (but you do need very new libvirt).</p><p>libvirt needs to manage the VM, so it&#039;s a bit more than simply installing it, you&#039;ll need to create/import the VM to work from libvirt.&#160; virt-manager is a reasonable tool to get started for that, but for advanced tuning you&#039;ll likely need to edit the xml and refer to the excellent documentation on the libvirt website.&#160; My blog below hopefully also has some useful examples.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471113">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471201" class="blockpost roweven"> <h2><span><span class="conr">#3104</span> <a href="viewtopic.php?pid=1471201#p1471201">2014-10-31 01:10:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83606">Child_of_Sun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-16</span></dd> <dd><span>Posts: 8</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi @all</p><p>I have managed to passthrough my Primary Graphic Card (And the Secondary for CrossfireX).</p><p>I use a custom initramfs with a custom init script, which means that i don&#039;t know if it&#039;s important to setup this during boot.</p><p>My Computer:<br />CPU: Amd FX-8350<br />Mainboard: Asrock 970 Extreme4<br />Primary Graphics: PowerColor PCS+ HD7770 GHz Edition 1GB GDDR5&#160; &#160; &#160; (vfio-pci, Windows)<br />Secondary Graphics: PowerColor HD7770 GHz Edition 1GB GDDR5 (V2?)&#160; (vfio-pci, Windows)<br />Tertiary Graphics: PowerColor HD7750 1GB GDDR5&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;(Linux Host)<br />Memory: 16 GB Transcend 1333MHz Memory<br />Power Supply: Thermaltake Berlin 630W</p><p>I use Gentoo Linux ~amd64 with kernel 3.18.0-rc2 (Because of the OverlayFS :-), should work with 3.17.1 too) and Qemu-2.1.2 with Seabios-1.7.5 (Release)</p><p>My Kernel cmdline is:</p><div class="codebox"><pre><code>root=/dev/mapper/root rootfstype=btrfs rw iommu=pt video=radeondrmfb:1280x1024-24@75,mtrr:3,pmipal,ywrap kvm.ignore_msrs=1 vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1b21:1042,1002:4383,1002:4391,1002:4393,1002:439c vfio-bind=0000:02:00.0,0000:02:00.1,0000:01:00.0,0000:01:00.1,0000:00:14.2,0000:00:11.0,0000:04:00.0,0000:05:00.0 hugepagesz=1GB fbcon=map:1</code></pre></div><p>The vfio-bind Option is parsed by the custom init in my initramfs.</p><p>At boot i bind the devices (Like mentioned here) to the pci-stub driver, later to the vfio-pci driver. The Essential Lines from my init for this Proces are:</p><div class="codebox"><pre><code>/sbin/vfio-bind &quot;${vfiobond}&quot; echo 0000:03:00.1 &gt; /sys/bus/pci/devices/0000:03:00.1/driver/unbind # The Amd Audio device binds to pci-stub, since it has the same ids at the 7750 and the 7770, this fix this Problem. modprobe radeon # Here i Load the radeon kernel module for the framebuffer sleep 4 # Wait a little bit to be sure everything has enough time to switch echo 1 &gt; /sys/bus/pci/drivers/vfio-pci/0000:01:00.0/remove # Here i remove the Primary adapter from the PCI bus echo 1 &gt; /sys/bus/pci/drivers/vfio-pci/0000:01:00.1/remove echo 1 &gt; /sys/bus/pci/rescan # Here i rescan the Pci-Bus for new devices, it find the Primary radeon and binds it automatically to the vfio-pci driver</code></pre></div><p>The Last three Lines are Essential for this to work, with this config i can restart the VM, install newer Graphics Drivers, Play 3D Games (Elder Scrolls Online at the moment :-) ).</p><p>I use the rombios=/path/to/bios/file Option for the Primary Card, don&#039;t know if it is essential.</p><p>At Last here is the Qemu Startup Line from my script:</p><br /><div class="codebox"><pre><code>until /usr/bin/sudo /usr/bin/nice -n 10 /usr/bin/qemu-system-x86_64 -M q35 -enable-kvm -monitor stdio -nographic -balloon none -mem-path /dev/hugepages -mem-prealloc \ -m 10240 -k de -cpu host -smp 8,sockets=1,cores=8,threads=1 -bios /usr/share/qemu/bios.bin-1.7.5 -realtime mlock=on \ -vga none -D /var/log/qemu-out.log -boot menu=on -usb -usbdevice host:046d:c517 -usbdevice host:093a:2510 \ -device vfio-pci,host=00:11.0,bus=pcie.0,addr=1c.0,multifunction=on,bootindex=0 \ -device vfio-pci,host=00:14.2,bus=pcie.0,addr=1c.1,multifunction=on \ -device ioh3420,bus=pcie.0,addr=1c.2,multifunction=on,port=1,chassis=2,id=root.0 \ -device ioh3420,bus=pcie.0,addr=1c.3,multifunction=on,port=2,chassis=3,id=root.1 \ -device nec-usb-xhci,multifunction=on,addr=1c.4,bus=pcie.0,id=usb3 \ -device vfio-pci,host=01:00.0,bus=root.0,addr=00.0,multifunction=on,romfile=/etc/qemu/vbios/Powercolor.HD7770.1024.120418.rom,x-vga=on \ -device vfio-pci,host=01:00.1,bus=pcie.0,multifunction=on \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=pcie.0,multifunction=on \ -device vfio-pci,host=04:00.0,bus=pcie.0,addr=1c.6,multifunction=on \ -device vfio-pci,host=05:00.0,bus=pcie.0,addr=1c.7,multifunction=on \ -drive id=bitlocker_keys,file=/dev/loop0,if=none -device usb-storage,drive=bitlocker_keys,bus=usb3.0 \ -netdev type=tap,id=guest0,vhost=on,ifname=&quot;${IFACE}&quot; -device virtio-net-pci,netdev=guest0,mac=&quot;${macaddr}&quot; ${options} ; do echo &quot;Qemu crashed with exit code $?. Respawning..&quot; &gt;&amp;2 sleep 5 done</code></pre></div><p>I hope it helps somebody who tries the same :-)</p> <p class="postedit"><em>Last edited by Child_of_Sun (2014-11-01 00:11:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471201">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471202" class="blockpost rowodd"> <h2><span><span class="conr">#3105</span> <a href="viewtopic.php?pid=1471202#p1471202">2014-10-31 01:14:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Child_of_Sun wrote:</cite><blockquote><div><p>I use Gentoo Linux ~amd64 with kernel 3.18.0-rc2 (Because of the OverlayFS :-), should work with 3.17.1 too) and a Patched Qemu from here: <a href="https://github.com/awilliam/qemu-vfio/releases" rel="nofollow">https://github.com/awilliam/qemu-vfio/releases</a> with Seabios-1.7.5 (Release)</p></div></blockquote></div><p>Please don&#039;t use random tags (or even branches) from my tree.&#160; My tags are for pull requests to upstream and not intended to be any kind of release for general consumption.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471202">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471240" class="blockpost roweven"> <h2><span><span class="conr">#3106</span> <a href="viewtopic.php?pid=1471240#p1471240">2014-10-31 07:48:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79899">winie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-01</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:alireza4051@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have a dedicated monitor and keyboard and mouse for my windows guest.<br />i have a keyboard shortcut for starting the guest when its off.<br />is there a way that the host could ignore input from that mouse and keyboard except for that shortcut?<br />if not can you suggest other ideas so that each guest machine can be started from behind its dedicated desk and not interfere with host machine when its off?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471240">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471262" class="blockpost rowodd"> <h2><span><span class="conr">#3107</span> <a href="viewtopic.php?pid=1471262#p1471262">2014-10-31 10:17:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>The kernel file looks like is not available anymore and when I try to patch my kernel I get some errors.</p><p>What I made:</p><p>Created a folder kernelbuild<br />Get into that folder<br />Downloaded kernel mainline: linux-3.18-rc2.tar.xz<br />Extract it with tar -xvJf linux-3.18-rc2.tar.xz <br />make mrproper (clean up (according to <a href="https://wiki.archlinux.org/index.php/Kernels/Compilation/Traditional))" rel="nofollow">https://wiki.archlinux.org/index.php/Ke … ditional))</a><br />zcat /proc/config.gz &gt; .config (to have a good .config (VIRTIO ENABLED)</p><p>Downloaded the patches from <a href="https://lkml.org/lkml/diff/2013/5/30/513/1" rel="nofollow">https://lkml.org/lkml/diff/2013/5/30/513/1</a> and <a href="https://lkml.org/lkml/diff/2014/5/9/517/1" rel="nofollow">https://lkml.org/lkml/diff/2014/5/9/517/1</a></p><p>Saved first one as i915.patch and i915.2.patch the second one.</p><p>Then the errors:</p><div class="codebox"><pre><code>[root@arch linux-3.18-rc2]# patch -p1 &lt; i915.patch patching file Documentation/kernel-parameters.txt Hunk #1 succeeded at 2725 with fuzz 1 (offset 376 lines). patching file drivers/pci/quirks.c Hunk #1 FAILED at 3292. 1 out of 1 hunk FAILED -- saving rejects to file drivers/pci/quirks.c.rej [root@arch linux-3.18-rc2]# patch -p1 &lt; i915.2.patch patching file drivers/gpu/drm/i915/i915_dma.c Hunk #1 succeeded at 1318 (offset 12 lines). Hunk #2 succeeded at 1379 with fuzz 2. patching file drivers/gpu/drm/i915/i915_drv.h Hunk #1 FAILED at 2080. 1 out of 1 hunk FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_drv.h.rej patching file drivers/gpu/drm/i915/i915_params.c Hunk #1 FAILED at 47. Hunk #2 FAILED at 152. 2 out of 2 hunks FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_params.c.rej patching file drivers/gpu/drm/i915/intel_display.c Hunk #1 succeeded at 12936 (offset 1652 lines). Hunk #2 succeeded at 13301 (offset 1680 lines). Hunk #3 succeeded at 13553 (offset 1677 lines). patching file drivers/gpu/drm/i915/intel_drv.h Hunk #1 succeeded at 1125 (offset 191 lines). patching file include/linux/vgaarb.h [root@arch linux-3.18-rc2]# </code></pre></div><p>Can someone help me with that, please?</p><p>Thanks a lot.</p><p>Best regards,</p><br /><p>TheArcher</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471262">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471280" class="blockpost roweven"> <h2><span><span class="conr">#3108</span> <a href="viewtopic.php?pid=1471280#p1471280">2014-10-31 12:50:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Hello,</p><p>The kernel file looks like is not available anymore and when I try to patch my kernel I get some errors.</p><p>What I made:</p><p>Created a folder kernelbuild<br />Get into that folder<br />Downloaded kernel mainline: linux-3.18-rc2.tar.xz<br />Extract it with tar -xvJf linux-3.18-rc2.tar.xz <br />make mrproper (clean up (according to <a href="https://wiki.archlinux.org/index.php/Kernels/Compilation/Traditional))" rel="nofollow">https://wiki.archlinux.org/index.php/Ke … ditional))</a><br />zcat /proc/config.gz &gt; .config (to have a good .config (VIRTIO ENABLED)</p><p>Downloaded the patches from <a href="https://lkml.org/lkml/diff/2013/5/30/513/1" rel="nofollow">https://lkml.org/lkml/diff/2013/5/30/513/1</a> and <a href="https://lkml.org/lkml/diff/2014/5/9/517/1" rel="nofollow">https://lkml.org/lkml/diff/2014/5/9/517/1</a></p><p>Saved first one as i915.patch and i915.2.patch the second one.</p><p>Then the errors:</p><div class="codebox"><pre><code>[root@arch linux-3.18-rc2]# patch -p1 &lt; i915.patch patching file Documentation/kernel-parameters.txt Hunk #1 succeeded at 2725 with fuzz 1 (offset 376 lines). patching file drivers/pci/quirks.c Hunk #1 FAILED at 3292. 1 out of 1 hunk FAILED -- saving rejects to file drivers/pci/quirks.c.rej [root@arch linux-3.18-rc2]# patch -p1 &lt; i915.2.patch patching file drivers/gpu/drm/i915/i915_dma.c Hunk #1 succeeded at 1318 (offset 12 lines). Hunk #2 succeeded at 1379 with fuzz 2. patching file drivers/gpu/drm/i915/i915_drv.h Hunk #1 FAILED at 2080. 1 out of 1 hunk FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_drv.h.rej patching file drivers/gpu/drm/i915/i915_params.c Hunk #1 FAILED at 47. Hunk #2 FAILED at 152. 2 out of 2 hunks FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_params.c.rej patching file drivers/gpu/drm/i915/intel_display.c Hunk #1 succeeded at 12936 (offset 1652 lines). Hunk #2 succeeded at 13301 (offset 1680 lines). Hunk #3 succeeded at 13553 (offset 1677 lines). patching file drivers/gpu/drm/i915/intel_drv.h Hunk #1 succeeded at 1125 (offset 191 lines). patching file include/linux/vgaarb.h [root@arch linux-3.18-rc2]# </code></pre></div><p>Can someone help me with that, please?</p><p>Thanks a lot.</p><p>Best regards,</p><br /><p>TheArcher</p></div></blockquote></div><p>This is not the arch&#039;s way of building the kernel, and for arch users, i provided a kernel pkg with all the patches you need on page 1.</p><p>EDIT: the kernel pkg should be up now</p> <p class="postedit"><em>Last edited by nbhs (2014-10-31 13:48:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471280">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471284" class="blockpost rowodd"> <h2><span><span class="conr">#3109</span> <a href="viewtopic.php?pid=1471284#p1471284">2014-10-31 13:00:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>This is not the arch&#039;s way of building the kernel, and for arch users, i provided a kernel pkg with all the patches you need on page 1.</p></div></blockquote></div><p>While we appreciate the forum hosting, not everyone here runs arch.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471284">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471285" class="blockpost roweven"> <h2><span><span class="conr">#3110</span> <a href="viewtopic.php?pid=1471285#p1471285">2014-10-31 13:02:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>This is not the arch&#039;s way of building the kernel, and for arch users, i provided a kernel pkg with all the patches you need on page 1.</p></div></blockquote></div><p>While we appreciate the forum hosting, not everyone here runs arch.</p></div></blockquote></div><p>I know but it looks like he does</p> <p class="postedit"><em>Last edited by nbhs (2014-10-31 13:48:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471285">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471286" class="blockpost rowodd"> <h2><span><span class="conr">#3111</span> <a href="viewtopic.php?pid=1471286#p1471286">2014-10-31 13:04:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>This is not the arch&#039;s way of building the kernel, and for arch users, i provided a kernel pkg with all the patches you need on page 1.</p></div></blockquote></div><p>While we appreciate the forum hosting, not everyone here runs arch.</p></div></blockquote></div><p>I know but it looks like he does</p></div></blockquote></div><p>touché</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471286">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471302" class="blockpost roweven"> <h2><span><span class="conr">#3112</span> <a href="viewtopic.php?pid=1471302#p1471302">2014-10-31 14:00:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Child_of_Sun wrote:</cite><blockquote><div><p>Hi @all<br />I have managed to passthrough my Primary Graphic Card (And the Secondary for CrossfireX).</p><p>...post full of usefullness</p><p>I hope it helps somebody who tries the same :-)</p></div></blockquote></div><p>Maaaan, i wanted to talk to you a while ago, and now you&#039;re posting the whole setup. I just love that post of yours. <br />But there&#039;s few strange things...<br />Do you really need that romfile option? You&#039;re running BIOS-setup, so you won&#039;t need to pass some new, UEFI-compatible ROM image to get it working.</p><p>Do you really-really-really need that &quot;allow_unsafe_interrupts=1&quot; option? aw mentioned it&#039;s needed in somewhat rare case.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471302">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471305" class="blockpost rowodd"> <h2><span><span class="conr">#3113</span> <a href="viewtopic.php?pid=1471305#p1471305">2014-10-31 14:12:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Do you really-really-really need that &quot;allow_unsafe_interrupts=1&quot; option? aw mentioned it&#039;s needed in somewhat rare case.</p></div></blockquote></div><p>All AMD-Vi IOMMUs support interrupt remapping with CONFIG_IRQ_REMAP enabled, so no, they don&#039;t need it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471305">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471306" class="blockpost roweven"> <h2><span><span class="conr">#3114</span> <a href="viewtopic.php?pid=1471306#p1471306">2014-10-31 14:16:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Hello,</p><p>The kernel file looks like is not available anymore and when I try to patch my kernel I get some errors.</p><p>What I made:</p><p>Created a folder kernelbuild<br />Get into that folder<br />Downloaded kernel mainline: linux-3.18-rc2.tar.xz<br />Extract it with tar -xvJf linux-3.18-rc2.tar.xz <br />make mrproper (clean up (according to <a href="https://wiki.archlinux.org/index.php/Kernels/Compilation/Traditional))" rel="nofollow">https://wiki.archlinux.org/index.php/Ke … ditional))</a><br />zcat /proc/config.gz &gt; .config (to have a good .config (VIRTIO ENABLED)</p><p>Downloaded the patches from <a href="https://lkml.org/lkml/diff/2013/5/30/513/1" rel="nofollow">https://lkml.org/lkml/diff/2013/5/30/513/1</a> and <a href="https://lkml.org/lkml/diff/2014/5/9/517/1" rel="nofollow">https://lkml.org/lkml/diff/2014/5/9/517/1</a></p><p>Saved first one as i915.patch and i915.2.patch the second one.</p><p>Then the errors:</p><div class="codebox"><pre><code>[root@arch linux-3.18-rc2]# patch -p1 &lt; i915.patch patching file Documentation/kernel-parameters.txt Hunk #1 succeeded at 2725 with fuzz 1 (offset 376 lines). patching file drivers/pci/quirks.c Hunk #1 FAILED at 3292. 1 out of 1 hunk FAILED -- saving rejects to file drivers/pci/quirks.c.rej [root@arch linux-3.18-rc2]# patch -p1 &lt; i915.2.patch patching file drivers/gpu/drm/i915/i915_dma.c Hunk #1 succeeded at 1318 (offset 12 lines). Hunk #2 succeeded at 1379 with fuzz 2. patching file drivers/gpu/drm/i915/i915_drv.h Hunk #1 FAILED at 2080. 1 out of 1 hunk FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_drv.h.rej patching file drivers/gpu/drm/i915/i915_params.c Hunk #1 FAILED at 47. Hunk #2 FAILED at 152. 2 out of 2 hunks FAILED -- saving rejects to file drivers/gpu/drm/i915/i915_params.c.rej patching file drivers/gpu/drm/i915/intel_display.c Hunk #1 succeeded at 12936 (offset 1652 lines). Hunk #2 succeeded at 13301 (offset 1680 lines). Hunk #3 succeeded at 13553 (offset 1677 lines). patching file drivers/gpu/drm/i915/intel_drv.h Hunk #1 succeeded at 1125 (offset 191 lines). patching file include/linux/vgaarb.h [root@arch linux-3.18-rc2]# </code></pre></div><p>Can someone help me with that, please?</p><p>Thanks a lot.</p><p>Best regards,</p><br /><p>TheArcher</p></div></blockquote></div><p>This is not the arch&#039;s way of building the kernel, and for arch users, i provided a kernel pkg with all the patches you need on page 1.</p><p>EDIT: the kernel pkg should be up now</p></div></blockquote></div><p>Thanks a lot sir!!!</p><p>Sorry, I was trying to follow the right way and I was taking the information from the official guide.</p><p>One question: Can be done on my kernel? An in case that can be done... can you show me the right way to do it?</p><p>Thanks a lot!!!</p><p>Regards,</p><br /><p>TheArcher</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471306">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471311" class="blockpost rowodd"> <h2><span><span class="conr">#3115</span> <a href="viewtopic.php?pid=1471311#p1471311">2014-10-31 14:37:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>20-30 pages back someone explained it, so look for it....</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471311">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471313" class="blockpost roweven"> <h2><span><span class="conr">#3116</span> <a href="viewtopic.php?pid=1471313#p1471313">2014-10-31 14:44:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>20-30 pages back someone explained it, so look for it....</p></div></blockquote></div><p>Truth: <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=99" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=99</a></p><p>I will try later today <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>By the way... this is difficult now <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Maybe would be a good idea to edit post 1 an update relevant information for other users like an appendix <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Anyway... thanks a lot <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>Regards,</p><br /><br /><p>TheArcher</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471313">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471321" class="blockpost rowodd"> <h2><span><span class="conr">#3117</span> <a href="viewtopic.php?pid=1471321#p1471321">2014-10-31 15:03:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>20-30 pages back someone explained it, so look for it....</p></div></blockquote></div><p>Truth: <a href="https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=99" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=162768&amp;p=99</a></p><p>I will try later today <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>By the way... this is difficult now <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Maybe would be a good idea to edit post 1 an update relevant information for other users like an appendix <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Anyway... thanks a lot <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><br /><p>Regards,</p><br /><br /><p>TheArcher</p></div></blockquote></div><div class="codebox"><pre><code>tar xvzf linux-mainline-3.17.2.tar.gz cd linux-mainline makepkg -s sudo pacman -U linux-mainline-*</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471324" class="blockpost roweven"> <h2><span><span class="conr">#3118</span> <a href="viewtopic.php?pid=1471324#p1471324">2014-10-31 15:39:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks a lot sir <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> </p><p>I will let you all know how it goes this weekend!!! </p><p>Thanks for your help <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471324">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471338" class="blockpost rowodd"> <h2><span><span class="conr">#3119</span> <a href="viewtopic.php?pid=1471338#p1471338">2014-10-31 16:37:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Strange fact: i need to enable that<br /><a href="http://technet.microsoft.com/en-us/library/cc978411.aspx" rel="nofollow">http://technet.microsoft.com/en-us/libr … 78411.aspx</a><br />registry parameter to stop my VM&#039;s keyboard lagging. When i press more than two buttons in sequence, system is having small freeze-and-go cycle.</p><p>I am using Q35 and i have -device qxl to get me a surface in qemu&#039;s graphical window, where qemu could grab host input.<br />I&#039;ve tried using synergy but it doesn&#039;t work without a client and it doesn&#039;t get input working when windows displays you another context(like UAC).</p><p>But that is a minor problem. I typed that post while having my freshly-installed WIN7 VM without drivers installed, and got BSOD IRQL_NOT_LESS_OR_EQUAL. That was funny. I love windowns. Dmesg reports the usual io-page-faults on hdmi audio device.</p><p>EDIT: Now i&#039;m using 440fx, and the problem is still present - bsod 116 after drivers install, with or without HDMI-audio. Oh well, back to the flashing ROM quest.</p><p>EDIT: -realtime mlock=on seemed to help address IO-PAGE-FAULTs. Benchmarking to test... Second GPU is still code 12.</p><p><strong>EDIT: THAT. WAS. THE END! IT FINALLY WORKS! CHILD_OF_SUN, YOU ARE TRULY GODLIKE FOR YOUR SETUP, MANY THANKS!</strong></p><p>I&#039;ve got my HD7750 working on F2A55, all asus. Crossfire left. IO_PAGE_FAULTs are fixed by -realtime mlock=on switch.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-31 18:34:17)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471338">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471373" class="blockpost roweven"> <h2><span><span class="conr">#3120</span> <a href="viewtopic.php?pid=1471373#p1471373">2014-10-31 18:51:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...<br /><strong>EDIT: THAT. WAS. THE END! IT FINALLY WORKS! CHILD_OF_SUN, YOU ARE TRULY GODLIKE FOR YOUR SETUP, MANY THANKS!</strong><br />...</p></div></blockquote></div><p>The hero we deserve.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471373">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471375" class="blockpost rowodd"> <h2><span><span class="conr">#3121</span> <a href="viewtopic.php?pid=1471375#p1471375">2014-10-31 19:00:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...<br /><strong>EDIT: THAT. WAS. THE END! IT FINALLY WORKS! CHILD_OF_SUN, YOU ARE TRULY GODLIKE FOR YOUR SETUP, MANY THANKS!</strong><br />...</p></div></blockquote></div><p>The hero we deserve.</p></div></blockquote></div><p>Well, i&#039;ve been digging this system for two months, spending last two-three weeks on the quest of getting OVMF working. But he came and enlightened me.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471375">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471380" class="blockpost roweven"> <h2><span><span class="conr">#3122</span> <a href="viewtopic.php?pid=1471380#p1471380">2014-10-31 19:05:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...<br /><strong>EDIT: THAT. WAS. THE END! IT FINALLY WORKS! CHILD_OF_SUN, YOU ARE TRULY GODLIKE FOR YOUR SETUP, MANY THANKS!</strong><br />...</p></div></blockquote></div><p>The hero we deserve.</p></div></blockquote></div><p>Well, i&#039;ve been digging this system for two months, spending last two-three weeks on the quest of getting OVMF working. But he came and enlightened me.</p></div></blockquote></div><p>I wasn&#039;t being sarcastic, this is actually the first time i see someone getting this working.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471380">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471381" class="blockpost rowodd"> <h2><span><span class="conr">#3123</span> <a href="viewtopic.php?pid=1471381#p1471381">2014-10-31 19:09:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>The hero we deserve.</p></div></blockquote></div><p>Well, i&#039;ve been digging this system for two months, spending last two-three weeks on the quest of getting OVMF working. But he came and enlightened me.</p></div></blockquote></div><p>I wasn&#039;t being sarcastic, this is actually the first time i see someone getting this working.</p></div></blockquote></div><p>You mean crossfire? There are some entries in the google-doc list. Child_Of_Sun is one of the three. I hope i may be the fourth guy with crossfire. But not yet - second gets code12.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471381">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471383" class="blockpost roweven"> <h2><span><span class="conr">#3124</span> <a href="viewtopic.php?pid=1471383#p1471383">2014-10-31 19:13:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve got my HD7750 working on F2A55, all asus. Crossfire left. IO_PAGE_FAULTs are fixed by -realtime mlock=on switch.</p></div></blockquote></div><p>This would be surprising, mlock=on should do nothing when a device is assigned.&#160; The memory is already pinned for the IOMMU, so mlock&#039;ing it is redundant.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471383">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471387" class="blockpost rowodd"> <h2><span><span class="conr">#3125</span> <a href="viewtopic.php?pid=1471387#p1471387">2014-10-31 19:17:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve got my HD7750 working on F2A55, all asus. Crossfire left. IO_PAGE_FAULTs are fixed by -realtime mlock=on switch.</p></div></blockquote></div><p>This would be surprising, mlock=on should do nothing when a device is assigned.&#160; The memory is already pinned for the IOMMU, so mlock&#039;ing it is redundant.</p></div></blockquote></div><p>Well, there may be some quirks. But the io page faults were pointing into system ram area of /proc/iomem. <span class="bbs">And also, may be not the mlock, but allow-unsafe-interrupt thing did the job, that&#039;s to pin down for me.</span> Definitely, it&#039;s mlock that does the trick. When i remove it - it gets BSOD 116. <span class="bbs">Or maybe i&#039;m just hell of extremely lucky, getting memory locked in a ~safe area and not messing up anything(but HD7750 needs at least 256M as noted by lspci).</span> Not a case either - i&#039;ve survived a reboot.</p><p>UPD: putting two gpus on one root port was an interesting idea - i&#039;ve got a message in DMESG about msi\msi-X mapping for the second gpu, the screen flashed a bit(messy guest drivers) and i&#039;ve got bsod 7E. Changed the model back to -M pc btw, i observe no difference yet.</p><p>UPD2:Now something bizarre and exotic! My screen has VGA and DVI inputs. They can be used concurelly. !!FUN!! part is i&#039;ve connected both inputs to both gpus. so my DVI output is from GPU1 and vga(via dvi-vga adapter) is from GPU2. When i turn x-vga=on on both cards sitting on one pci-e root port, i&#039;ve got VGA output. When i enable only the first one, i get DVI output. That means the second card is actually working and initialised first. But in any way of interconnection, i get code 10 on the second one(which is showing me output) in devmgmt.msc. I think a driver install would do something fun. But the VGA output isn&#039;t showing me all 1920x1080, just 1440x1050.<br />After installing the drivers, i&#039;ve got something showed up on both outputs at once(like, loading windowns on one gpu, desktop-ey loading thing on the other), and then... *gasps* my pc turned itself off. MCE? Dmesg -w was clear that moment. Glitches in virtual machine(talking to the real hardware, though) got the host shutdown itself?.. </p><p>P.S. sorry for the &quot;live&quot; posting and many edits.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-31 20:29:29)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=124">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <strong>125</strong> <a href="viewtopic.php?id=162768&amp;p=126">126</a> <a href="viewtopic.php?id=162768&amp;p=127">127</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=126">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
