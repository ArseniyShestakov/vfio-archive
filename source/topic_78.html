<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 78) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=78" title="Page 78" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=77" title="Page 77" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=79" title="Page 79" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=77">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=76">76</a> <a href="viewtopic.php?id=162768&amp;p=77">77</a> <strong>78</strong> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <a href="viewtopic.php?id=162768&amp;p=80">80</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=79">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1421257" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1926</span> <a href="viewtopic.php?pid=1421257#p1421257">2014-06-01 15:32:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I finally figured out why OVMF isn&#039;t booting, it&#039;s because of q35!<br />Question is, how do I get it working with q35? Do I even need q35, do I have any advantages with q35 over i440fx? (sorry I&#039;m quite new to qemu and I&#039;m like Jon Snow.. I know nothing.)</p> <p class="postedit"><em>Last edited by shawly (2014-06-01 15:32:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421257">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421267" class="blockpost roweven"> <h2><span><span class="conr">#1927</span> <a href="viewtopic.php?pid=1421267#p1421267">2014-06-01 16:10:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Quoting OP:</p><div class="quotebox"><blockquote><div><p>NOTE: -m q35 | Enable the new q35 emulated chipset, qemu defaults to the old i440fx chipset.<br />You should see a black qemu window on your main display, and seabios ouput on your monitor from your passthru&#039;d card saying it cant find anything to boot.<br />Its important to use -M q35 which is the new qemu emulated intel chipset with pcie support,</p></div></blockquote></div><p>Also, not sure how this is better but I posted the vfio-bind script elsewhere and someone told me I should improve it by making it like so:</p><div class="codebox"><pre><code>#!/bin/sh modprobe vfio-pci for dev in &quot;$@&quot;; do read -r vendor &lt;/sys/bus/pci/devices/$dev/vendor read -r device &lt;/sys/bus/pci/devices/$dev/device if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done</code></pre></div> <p class="postedit"><em>Last edited by rabcor (2014-06-01 16:11:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421267">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421318" class="blockpost rowodd"> <h2><span><span class="conr">#1928</span> <a href="viewtopic.php?pid=1421318#p1421318">2014-06-01 20:53:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81673">djbdayong</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-01</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81673">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I am yet another lurker that has found this thread invaluable in getting my setup working, a big thank you to nbhs, aw and indeed everyone!</p><p>Some details should they be useful to someone:</p><p><strong>Motherboard:</strong> ASRock Fatal1ty z87 Killer<br /><strong>CPU:</strong> Intel Xeon E3-1245v3<br /><strong>Passthrough GPU:</strong> XFX Radeon R9 270X<br /><strong>Kernel:</strong> 3.14.4 <br /><strong>Qemu:</strong> 2.0.0<br /><strong>Guest Firmware:</strong> Seabios, 1.7.5<br /><strong>Guest OS:</strong> Windows 8</p><p>Main motivations, aside from curiosity, were running my preferred OpenCL accelerated RAW converter and photo processing software without sacrificing the Linux desktop with dual boot. As well as some light gaming. For these purposes the setup runs wonderfully.</p><p>I installed more or less as per OP instructions and it went smoothly thanks to all of you trail blazers on this thread (Excuse any ignorance, I am still far from grasping the finer details of the moving parts):</p><p>1. Blacklisted passed GPU drivers on the host since it is only used when I run the guest.<br />2. Reproduced the colourful VGA arbitration issue and applying the OP i915 patch immediately solved it.<br />3. Was able to install virtio guest drivers during Windows 8 setup. Had to omit the OP qemu virtio controller for Windows to match the Red Hat drivers to the unknown virtio disk device. See the qemu command below for what I ended up with. <br />4. Windows 8 activated without any problems (wondering how sensitive it will be to future qemu/seabios upgrades ???)<br />5. Since I have all of my audio equipment connected to my host sound device + remote PA server and due to accounts of <a href="https://bbs.archlinux.org/viewtopic.php?pid=1363181#p1363181" rel="nofollow">BSOD due to HDMI audio funny business</a>, I decided to just install the AMD video driver and avoid as much extra Catalyst fluff as possible. So I did a custom install with HDMI audio device not passed to the guest. This went smoothly and no BSOD on reboot. For guest sound, I use an emulated sound device and qemu PA driver as per OP.<br />6. Installed synergy for keyboard/mouse sharing.</p><p>Qemu command line:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -enable-kvm \ -M q35 \ -cpu host \ -m 12288 \ -smp 6,sockets=1,cores=3,threads=2 \ -bios ${PATH_BIOS} \ -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive if=virtio,id=disk,file=${PATH_DISK_IMAGE},format=raw \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0</code></pre></div><p>I&#039;m happy to test new patches and otherwise provide more info.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421318">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421339" class="blockpost roweven"> <h2><span><span class="conr">#1929</span> <a href="viewtopic.php?pid=1421339#p1421339">2014-06-01 22:29:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81948">thehighhat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-12</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I had a working vga passthrough of nvidia gtx470 with a windows 8 guest.&#160; I let the windows store upgrade to windows 8.1 update.&#160; now, the guest will not start correct.&#160; it always goes into automatic system repair and fails.&#160; the refresh pc, reset pc options ask for windwos cd, but cannot detect it.&#160; if i just let windows try to start, it shows nohing but a black screen.&#160; then i have reboot the host becaues i cannot shutdown the guest cleanly.</p><p>any ideas why the 8.1 update breaks everything?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421339">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421402" class="blockpost rowodd"> <h2><span><span class="conr">#1930</span> <a href="viewtopic.php?pid=1421402#p1421402">2014-06-02 05:12:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>When I do </p><div class="codebox"><pre><code>sudo chown rabcor /dev/vfio/13</code></pre></div><p>In a desperate attempt to run the VM as user, I get a new error</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7f4b3a2cced0, 0x0, 0x80000000, 0x7f4a08000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7f4b3a2cced0, 0x100000000, 0x80000000, 0x7f4a88000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I tried running</p><div class="codebox"><pre><code>#ulimit -l 10485760</code></pre></div><p>As root to allow the user to allocate that amount of memory to the VM as suggested somewhere on the net, but it had no effect on the error <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Do I really just have to run it as root?</p><p>PS: Still can&#039;t solve that qemu is not finding the ahci.0 bus</p><div class="codebox"><pre><code>#lspci | grep SATA 00:1f.2 SATA controller: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode]</code></pre></div> <p class="postedit"><em>Last edited by rabcor (2014-06-02 05:15:36)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421402">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421411" class="blockpost roweven"> <h2><span><span class="conr">#1931</span> <a href="viewtopic.php?pid=1421411#p1421411">2014-06-02 05:34:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="http://www.linux-kvm.org/wiki/images/b/b4/2012-forum-VFIO.pdf" rel="nofollow">http://www.linux-kvm.org/wiki/images/b/ … m-VFIO.pdf</a></p><p>Start on slide 21</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421417" class="blockpost rowodd"> <h2><span><span class="conr">#1932</span> <a href="viewtopic.php?pid=1421417#p1421417">2014-06-02 06:38:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks, but still not working</p><div class="codebox"><pre><code>chown rabcor /dev/vfio/13 chmod 660 /dev/vfio/vfio chown rabcor /dev/vfio/vfio ulimit -l 8409088</code></pre></div><p>Note: I had to do chown user on vfio because it denied me permission after running chmod 660 on it.</p><p>Ran ulimit -l 8409088 for 8gigs ((8192 + 20) 1.sh topic_10.html topic_11.html topic_12.html topic_13.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_7.html topic_8.html topic_9.html 1024 as the pdf you linked suggested)</p><p>Still get </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fe886977d80, 0x0, 0x80000000, 0x7fe750000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fe886977d80, 0x100000000, 0x80000000, 0x7fe7d0000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div> <p class="postedit"><em>Last edited by rabcor (2014-06-02 06:38:52)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421417">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421433" class="blockpost roweven"> <h2><span><span class="conr">#1933</span> <a href="viewtopic.php?pid=1421433#p1421433">2014-06-02 08:32:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80028">trimm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-06</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80028">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Nvidia has filed a bug now regarding the hypervisor check.<br /><a href="https://forums.geforce.com/default/topic/746026/geforce-drivers/official-nvidia-337-88-whql-performance-display-driver-feedback-thread-5-26-14-/36/" rel="nofollow">https://forums.geforce.com/default/topi … 26-14-/36/</a></p><p>Hopefully they will fix it, I have some doubts though!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421433">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421446" class="blockpost rowodd"> <h2><span><span class="conr">#1934</span> <a href="viewtopic.php?pid=1421446#p1421446">2014-06-02 10:01:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>At least they know now that they&#039;re going to have to pick a side, with us or against us, and they know siding with their users is only going to make them look more cool.</p><p>From their perspective they should try to see that no workarounds (like the VGA_ARB patch) are needed to make this just work on AMD hardware (hell xen has been capable of it for a long time but when it comes to nvidia cards it was always a pain to make them work there) meaning this is a feature AMD is already offering and not fighting against like they are.</p><p>I guess we&#039;ll see in one of the next few nvidia driver updates what their reply is (i.e. they will either fix it or they will do something else to make our lives miserable)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421446">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421453" class="blockpost roweven"> <h2><span><span class="conr">#1935</span> <a href="viewtopic.php?pid=1421453#p1421453">2014-06-02 10:40:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hello there</p><p>amazin and long topic <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>hope someone can help me...</p><p>i got some problems... yesterday i managed to get passthrough running but performance was low... (DOTA2 native 120fps, in kvm 40-50fps, drops to 20fps sometimes jumps to 90fps</p><p>my config<br />i72600<br />Z77X-UD3H<br />host igpu<br />guest 560ti <br />jessie 13.4.4 + i915patch, acs and debug register</p><br /><p>i am also interested in getting SLI running since i have 2 same cards, and is it possible to pass IGPU? so i can have hw video (quicksync) encode since 5xx series lack that and i can&#039;t stream 60fps </p><br /><br /><p>P.S. <br />what are proper patches,grub commands and kernel needed for my system? <br />do i need pci-stub, and vfio-bind, both?<br />can i pass it with pci-assign?</p><p>i can only reboot vm, after shutdown i must reboot host? is that normal?&#160; <br />Thank you</p> <p class="postedit"><em>Last edited by slis (2014-06-02 13:20:34)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421453">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421489" class="blockpost rowodd"> <h2><span><span class="conr">#1936</span> <a href="viewtopic.php?pid=1421489#p1421489">2014-06-02 12:57:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Thanks, but still not working</p><div class="codebox"><pre><code>chown rabcor /dev/vfio/13 chmod 660 /dev/vfio/vfio chown rabcor /dev/vfio/vfio ulimit -l 8409088</code></pre></div><p>Note: I had to do chown user on vfio because it denied me permission after running chmod 660 on it.</p><p>Ran ulimit -l 8409088 for 8gigs ((8192 + 20) 1.sh topic_10.html topic_11.html topic_12.html topic_13.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_7.html topic_8.html topic_9.html 1024 as the pdf you linked suggested)</p><p>Still get </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fe886977d80, 0x0, 0x80000000, 0x7fe750000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7fe886977d80, 0x100000000, 0x80000000, 0x7fe7d0000000) = -12 (Cannot allocate memory) qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: memory listener initialization failed for container qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 13 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div></div></blockquote></div><p>As noted in the slides, an additional 20MB was sufficient for that example config, with an assigned NIC that has much, much less MMIO space.&#160; If you want to make sure things are covered, add an extra 1G.&#160; Also make sure you&#039;re setting ulimit in a way that transfers to the user process, &#039;sudo ulimit ...&#039; is not sufficient.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421489">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421536" class="blockpost roweven"> <h2><span><span class="conr">#1937</span> <a href="viewtopic.php?pid=1421536#p1421536">2014-06-02 15:58:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82341">buraktamturk</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-28</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:burak@tamturk.in">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>shawly wrote:</cite><blockquote><div><p>I finally figured out why OVMF isn&#039;t booting, it&#039;s because of q35!<br />Question is, how do I get it working with q35? Do I even need q35, do I have any advantages with q35 over i440fx? (sorry I&#039;m quite new to qemu and I&#039;m like Jon Snow.. I know nothing.)</p></div></blockquote></div><p>I changed my virtual machine configuration to q35 (had to change everything including pci, usb bus configs). Still OVMF does not come up to the monitor, thanks to you, i am now using seabios and q35 :-)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421536">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421587" class="blockpost rowodd"> <h2><span><span class="conr">#1938</span> <a href="viewtopic.php?pid=1421587#p1421587">2014-06-02 18:09:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Regarding Nvidia 337.88:</p><p><a href="https://forums.geforce.com/default/topic/746026/geforce-drivers/official-nvidia-337-88-whql-performance-display-driver-feedback-thread-5-26-14-/post/4232923/#4232923" rel="nofollow">https://forums.geforce.com/default/topi … 3/#4232923</a></p><div class="quotebox"><blockquote><div><p>We fixed some hypervisor detection code that was breaking Hyper-V. It&#039;s possible that fix may be preventing GeForce cards from working in passthrough, but because it is not officially supported for GeForce cards, this will not be fixed.</p></div></blockquote></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421587">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421590" class="blockpost roweven"> <h2><span><span class="conr">#1939</span> <a href="viewtopic.php?pid=1421590#p1421590">2014-06-02 18:28:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Urks... <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421590">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421631" class="blockpost rowodd"> <h2><span><span class="conr">#1940</span> <a href="viewtopic.php?pid=1421631#p1421631">2014-06-02 19:49:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82109">daxcore</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>syndtr wrote:</cite><blockquote><div><p>I think I found ultimate fix for code 43 on windows and RmInitAdapter failed on linux with nvidia devices with newer driver.<br />What I did was masking hypervisor cpuid signature and voala!!! </p><p>Apparently the driver checking for hypervisor cpuid signature and bail if detecting presence of those signature unless the gpu is nvidia GRID.<br />After 2 frustrating weeks at last.<br />F*ck you nvidia!!!</p></div></blockquote></div><p>Wow, I was suspicious, but didn&#039;t actually think nvidia would sink this low to try it.&#160; I suppose there&#039;s still a chance that it was an oversight and not an attempt to be malicious.&#160; Maybe we can make a runtime option for qemu to hide the hypervisor.</p></div></blockquote></div><p>It&#039;s also sufficient to just change the signature, for instance:</p><div class="codebox"><pre><code>--- a/target-i386/kvm.c +++ b/target-i386/kvm.c @@ -528,7 +528,7 @@ int kvm_arch_init_vcpu(CPUState *cs) has_msr_hv_hypercall = true; } - memcpy(signature, &quot;KVMKVMKVM\0\0\0&quot;, 12); + memcpy(signature, &quot;kvmkvmkvm\0\0\0&quot;, 12); c = &amp;cpuid_data.entries[cpuid_i++]; c-&gt;function = KVM_CPUID_SIGNATURE | kvm_base; c-&gt;eax = 0;</code></pre></div></div></blockquote></div><p> Thanks, working great!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421631">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421759" class="blockpost roweven"> <h2><span><span class="conr">#1941</span> <a href="viewtopic.php?pid=1421759#p1421759">2014-06-03 02:25:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mbroemme wrote:</cite><blockquote><div><p>Alex, so anymore ideas to my lcpsi output at post #1849 and #1850?</p></div></blockquote></div><p>None yet.&#160; I was going to suggest that we should save/restore ATS support as part of bus reset path since that&#039;s the only notable difference in #1849, but then I found that we already do that, so I don&#039;t know why it&#039;s showing up disabled.&#160; For #1850, does a host suspend/resume make it work or is that just another failing case?&#160; The differences in the correctable error status registers don&#039;t seem like they should make a difference.</p></div></blockquote></div><p>mbroemme, ok, here&#039;s an idea.&#160; I think your non-working R9 290X reports NoSoftRst-, right?&#160; IOW, it does claim to support a PM reset.&#160; Maybe we shouldn&#039;t be trusting that PM reset is not horribly broken on this device.&#160; We can make a device specific reset that will supersede and invalidate the standard reset mechanisms, leaving us with only bus reset.&#160; Let&#039;s try something like this:</p><div class="codebox"><pre><code>diff --git a/drivers/pci/quirks.c b/drivers/pci/quirks.c index e729206..946f8d8 100644 --- a/drivers/pci/quirks.c +++ b/drivers/pci/quirks.c @@ -3295,6 +3295,12 @@ static int reset_chelsio_generic_dev(struct pci_dev *dev, return 0; } +static int reset_no_reset(struct pci_dev *dev, int probe) +{ + printk(&quot;%s(%s, %d)\n&quot;, __func__, dev_name(&amp;dev-&gt;dev), probe); + return -EINVAL; +} + #define PCI_DEVICE_ID_INTEL_82599_SFP_VF 0x10ed #define PCI_DEVICE_ID_INTEL_IVB_M_VGA 0x0156 #define PCI_DEVICE_ID_INTEL_IVB_M2_VGA 0x0166 @@ -3310,6 +3316,8 @@ static const struct pci_dev_reset_methods pci_dev_reset_me reset_intel_generic_dev }, { PCI_VENDOR_ID_CHELSIO, PCI_ANY_ID, reset_chelsio_generic_dev }, + { PCI_VENDOR_ID_AMD, $GPU_DEVICE_ID, reset_no_reset }, + { PCI_VENDOR_ID_AMD, $AUDIO_DEVICE_ID, reset_no_reset }, { 0 } }; </code></pre></div><p>Replace the $GPU_DEVICE_ID and $AUDIO_DEVICE_ID with the ones for your R9 290X in standard hex notation.&#160; Let us know what happens.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421759">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421817" class="blockpost rowodd"> <h2><span><span class="conr">#1942</span> <a href="viewtopic.php?pid=1421817#p1421817">2014-06-03 09:57:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mbroemme wrote:</cite><blockquote><div><p>Alex, so anymore ideas to my lcpsi output at post #1849 and #1850?</p></div></blockquote></div><p>None yet.&#160; I was going to suggest that we should save/restore ATS support as part of bus reset path since that&#039;s the only notable difference in #1849, but then I found that we already do that, so I don&#039;t know why it&#039;s showing up disabled.&#160; For #1850, does a host suspend/resume make it work or is that just another failing case?&#160; The differences in the correctable error status registers don&#039;t seem like they should make a difference.</p></div></blockquote></div><p>mbroemme, ok, here&#039;s an idea.&#160; I think your non-working R9 290X reports NoSoftRst-, right?&#160; IOW, it does claim to support a PM reset.&#160; Maybe we shouldn&#039;t be trusting that PM reset is not horribly broken on this device.&#160; We can make a device specific reset that will supersede and invalidate the standard reset mechanisms, leaving us with only bus reset.&#160; Let&#039;s try something like this:</p></div></blockquote></div><p>Unfortunately no.</p><div class="codebox"><pre><code> Capabilities: [50] Power Management version 3 Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1+,D2+,D3hot+,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421817">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421819" class="blockpost roweven"> <h2><span><span class="conr">#1943</span> <a href="viewtopic.php?pid=1421819#p1421819">2014-06-03 10:14:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79069">sonnet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-30</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have one monitor with only a single dvi-d connection (no vga, no hdmi, no second dvi-d).<br />I have 2 vga though (integrated hd 4600 which i intended to use as main vga, and a radeon r9 270 to use for the vm)<br />Also my cpu and motherboard both support vt-d extension.</p><p>Can I take advantage of vga-passthrough for my vm, without attaching the second vga (R9 270) to the monitor? (since having only one connection I have no other choice).</p><p>I&#039;m asking because I saw this video:<br />[YOUTUBE]Qi1LdFkRzIs[/YOUTUBE]</p><p>You can see the guy is running the vm in windowed mode, with vga passthrough enabled. Being the vm in windowed mode (rather than controlling the whole monitor)<br />makes me think like only is main vga (the vga that is used by the host) is controlling and attached to the monitor.</p><p>Can please anyone clarify?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421819">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421889" class="blockpost rowodd"> <h2><span><span class="conr">#1944</span> <a href="viewtopic.php?pid=1421889#p1421889">2014-06-03 14:41:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sonnet wrote:</cite><blockquote><div><p>I have one monitor with only a single dvi-d connection (no vga, no hdmi, no second dvi-d).<br />I have 2 vga though (integrated hd 4600 which i intended to use as main vga, and a radeon r9 270 to use for the vm)<br />Also my cpu and motherboard both support vt-d extension.</p><p>Can I take advantage of vga-passthrough for my vm, without attaching the second vga (R9 270) to the monitor? (since having only one connection I have no other choice).</p><p>I&#039;m asking because I saw this video:<br />[YOUTUBE]Qi1LdFkRzIs[/YOUTUBE]</p><p>You can see the guy is running the vm in windowed mode, with vga passthrough enabled. Being the vm in windowed mode (rather than controlling the whole monitor)<br />makes me think like only is main vga (the vga that is used by the host) is controlling and attached to the monitor.</p><p>Can please anyone clarify?</p></div></blockquote></div><p>The video is using a VNC server running inside the guest and a VNC client on the desktop.&#160; You have all the same remote graphics tricks at your disposal with VGA assignment as you do with physically separate systems.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421889">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421891" class="blockpost roweven"> <h2><span><span class="conr">#1945</span> <a href="viewtopic.php?pid=1421891#p1421891">2014-06-03 14:41:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mbroemme wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>None yet.&#160; I was going to suggest that we should save/restore ATS support as part of bus reset path since that&#039;s the only notable difference in #1849, but then I found that we already do that, so I don&#039;t know why it&#039;s showing up disabled.&#160; For #1850, does a host suspend/resume make it work or is that just another failing case?&#160; The differences in the correctable error status registers don&#039;t seem like they should make a difference.</p></div></blockquote></div><p>mbroemme, ok, here&#039;s an idea.&#160; I think your non-working R9 290X reports NoSoftRst-, right?&#160; IOW, it does claim to support a PM reset.&#160; Maybe we shouldn&#039;t be trusting that PM reset is not horribly broken on this device.&#160; We can make a device specific reset that will supersede and invalidate the standard reset mechanisms, leaving us with only bus reset.&#160; Let&#039;s try something like this:</p></div></blockquote></div><p>Unfortunately no.</p><div class="codebox"><pre><code> Capabilities: [50] Power Management version 3 Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1+,D2+,D3hot+,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-</code></pre></div></div></blockquote></div><p>/me goes back to beating head against desk</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421891">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421907" class="blockpost rowodd"> <h2><span><span class="conr">#1946</span> <a href="viewtopic.php?pid=1421907#p1421907">2014-06-03 15:28:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>/me goes back to beating head against desk</p></div></blockquote></div><p>aw, this card is a &quot;real&quot; beast. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> All my other AMD cards are working fine (HD 7870 GHz, HD 5450 and HD 6670), but as time comes we might find a solution which will be helpful for other cards too I believe.</p> <p class="postedit"><em>Last edited by mbroemme (2014-06-03 22:01:51)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421907">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421916" class="blockpost roweven"> <h2><span><span class="conr">#1947</span> <a href="viewtopic.php?pid=1421916#p1421916">2014-06-03 16:21:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79069">sonnet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-30</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The video is using a VNC server running inside the guest and a VNC client on the desktop.&#160; You have all the same remote graphics tricks at your disposal with VGA assignment as you do with physically separate systems.</p></div></blockquote></div><p>Thanks for your reply.<br />So do I need to have both the vga connected to the monitors or this escamotage with VNC would allow me to not connect the guest os card to the monitor?<br />Because my monitor allows only one connection (so there&#039;s no way I can attach 2 vga to the monitor)</p> <p class="postedit"><em>Last edited by sonnet (2014-06-03 17:38:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421916">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421952" class="blockpost rowodd"> <h2><span><span class="conr">#1948</span> <a href="viewtopic.php?pid=1421952#p1421952">2014-06-03 18:22:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@sonnet <br />You only need the physical monitor connection to the vm for the vnc server setup in the vm. Once this is done you can connect to the vnc desktop from your host using a vnc client.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421952">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421953" class="blockpost roweven"> <h2><span><span class="conr">#1949</span> <a href="viewtopic.php?pid=1421953#p1421953">2014-06-03 18:24:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Or you can setup everything with emulated VGA and switch over to the assigned VGA only after you have VNC access</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421953">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1421979" class="blockpost rowodd"> <h2><span><span class="conr">#1950</span> <a href="viewtopic.php?pid=1421979#p1421979">2014-06-03 20:34:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79069">sonnet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-30</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks guys for your advices!<br />Does anybody have an idea about the overhead (in partiular % of cpu resources, considering I have a quadcore haswell) caused by this method with vnc?</p> <p class="postedit"><em>Last edited by sonnet (2014-06-03 20:36:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1421979">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=77">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=76">76</a> <a href="viewtopic.php?id=162768&amp;p=77">77</a> <strong>78</strong> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <a href="viewtopic.php?id=162768&amp;p=80">80</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=79">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
