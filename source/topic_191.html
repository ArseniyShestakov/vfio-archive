<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 191) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=191" title="Page 191" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=190" title="Page 190" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=192" title="Page 192" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=190">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <strong>191</strong> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <a href="viewtopic.php?id=162768&amp;p=193">193</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=192">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1518180" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4751</span> <a href="viewtopic.php?pid=1518180#p1518180">2015-04-09 16:12:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek :</p><p>I am passing my primary GPU to a Windows VM successfully . I boot the host with UEFI , and also use OVMF for booting VM (Complete EFI setup) . What I did :</p><p>1 - Boot the host with&#160; </p><div class="codebox"><pre><code>video=efifb:off</code></pre></div><p>2 - The GPU you want to passthrough must be first installed as a seconday GPU on the host , then use nvagetbios to dump the ROM from it .<br />3 - Edit your VM to use the ROM you just dumped .<br />4 - Shutdown the system and move the card to the first slot to become primary (In case your motherboard doesn&#039;t allow you to set which card to use as a primary) .<br />5 - Boot the host and test the VM .</p><p>I passed my GTX770 to a VM thus making my host headless .</p><p>Good luck .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518180">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518188" class="blockpost roweven"> <h2><span><span class="conr">#4752</span> <a href="viewtopic.php?pid=1518188#p1518188">2015-04-09 17:01:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mutiny wrote:</cite><blockquote><div><p>...</p></div></blockquote></div><br /><p>OVMF doesn&#039;t boot from sata controllers yet,&#160; there are some patches posted on the edk2 mailing list where you can find them, I also posted a link to a patched binary a few pages back, there&#039;s also ovmf-fishman-git on AUR which contains said patches</p><p>EDIT: <a href="https://drive.google.com/open?id=0Bxp_MsrVrNnENVdsMGtVbTNDYkk&amp;authuser=0" rel="nofollow">OVMF-sata.tar.gz</a></p> <p class="postedit"><em>Last edited by nbhs (2015-04-09 19:09:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518188">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518231" class="blockpost rowodd"> <h2><span><span class="conr">#4753</span> <a href="viewtopic.php?pid=1518231#p1518231">2015-04-09 20:31:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@Bronek :<br />I am passing my primary GPU to a Windows VM successfully . I boot the host with UEFI , and also use OVMF for booting VM (Complete EFI setup) . What I did :</p><p>1 - Boot the host with&#160; </p><div class="codebox"><pre><code>video=efifb:off</code></pre></div></div></blockquote></div><p>that&#039;s a good hint. I am not using EFI, but I will try all of </p><div class="codebox"><pre><code>nofb nomodeset video=vesafb:off</code></pre></div><p> and see if any of those make any difference. As for the other points, I found that my card works just fine with its own ROM as initialised by computer BIOS, thus no need to fiddle.</p><p>Basically my problem is <strong>not</strong> that passthrough does not work on primary GPU (it does work, most of the time), but that despite this </p><div class="codebox"><pre><code> pci-stub.ids=. . .,1002:6749,1002:aa90,1002:6707,1002:aa80</code></pre></div><p> the card is not claimed by pci-stub at boot, thus allowing other modules to claim it which caused me some trouble.</p><p>My dmesg says</p><div class="codebox"><pre><code>[ 0.963355] pci 0000:03:00.0: [1002:6707] type 00 class 0x030000 [ 0.963367] pci 0000:03:00.0: reg 0x10: [mem 0xc0000000-0xcfffffff 64bit pref] [ 0.963376] pci 0000:03:00.0: reg 0x18: [mem 0xdfd20000-0xdfd3ffff 64bit] [ 0.963382] pci 0000:03:00.0: reg 0x20: [io 0x7000-0x70ff] [ 0.963393] pci 0000:03:00.0: reg 0x30: [mem 0xdfd00000-0xdfd1ffff pref] [ 0.963426] pci 0000:03:00.0: supports D1 D2 [ 0.963468] pci 0000:03:00.1: [1002:aa80] type 00 class 0x040300 [ 0.963479] pci 0000:03:00.1: reg 0x10: [mem 0xdfd40000-0xdfd43fff 64bit] [ 0.963534] pci 0000:03:00.1: supports D1 D2 . . . [ 1.024920] vgaarb: setting as boot device: PCI:0000:03:00.0 [ 1.024922] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=io+mem,locks=none [ 1.024933] vgaarb: device added: PCI:0000:82:00.0,decodes=io+mem,owns=none,locks=none [ 1.024938] vgaarb: loaded [ 1.024939] vgaarb: bridge control possible 0000:82:00.0 [ 1.024940] vgaarb: bridge control possible 0000:03:00.0 . . . [ 1.082113] pci 0000:03:00.0: Video device with shadowed ROM . . . [ 1.185892] pci-stub: add 1002:6749 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.185917] pci-stub 0000:82:00.0: claimed by stub [ 1.185929] pci-stub: add 1002:AA90 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.185947] pci-stub 0000:82:00.1: claimed by stub</code></pre></div><p>Note that 1002:6707,1002:aa80 are <strong>not</strong> claimed. I assumed its vgaarb preventing pci-stub from claiming the card. Incorrectly as it turns out, but now I do not know what does it.</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Good luck .</p></div></blockquote></div><p>Thanks</p> <p class="postedit"><em>Last edited by Bronek (2015-04-09 20:31:22)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518231">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518239" class="blockpost roweven"> <h2><span><span class="conr">#4754</span> <a href="viewtopic.php?pid=1518239#p1518239">2015-04-09 21:10:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek:<br />Can you give us lspci -v output?</p><p>Because...</p><div class="codebox"><pre><code>[ 0.373329] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.373447] vgaarb: device added: PCI:0000:02:00.0,decodes=io+mem,owns=none,locks=none [ 0.373563] vgaarb: device added: PCI:0000:04:00.0,decodes=io+mem,owns=none,locks=none [ 0.373677] vgaarb: loaded [ 0.373751] vgaarb: bridge control possible 0000:04:00.0 [ 0.373825] vgaarb: bridge control possible 0000:02:00.0 [ 0.373900] vgaarb: bridge control possible 0000:01:00.0</code></pre></div><p>and then...</p><div class="codebox"><pre><code>[ 0.914831] pci-stub: add 1022:780D sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.914951] pci-stub 0000:00:14.2: claimed by stub [ 0.915030] pci-stub: add 1002:683F sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.915156] pci-stub 0000:01:00.0: claimed by stub [ 0.915236] pci-stub 0000:02:00.0: claimed by stub [ 0.915312] pci-stub: add 1002:AAB0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.915432] pci-stub 0000:01:00.1: claimed by stub [ 0.915511] pci-stub 0000:02:00.1: claimed by stub [ 0.915588] pci-stub: add 1002:683F sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.915703] pci-stub: add 1002:683F sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000</code></pre></div><p>is what i see in logs on my system.<br />And it gets bound to pci-stub fine. Then vfio-bind systemd service starts, binding the devices to vfio-pci</p><div class="codebox"><pre><code>pci-stub.ids=1022:780d,1002:683f,1002:aab0,1002:683f,1002:683f</code></pre></div><p>Note: I have 2 identical cards, BUT, as you can see, i&#039;ve made a typo(just noted, lol), you don&#039;t need to enter it multiple times. It&#039;s not possible to passthrough one of two identical cards without using a special pci-stub version which binds by PCI BDF address rather than ven_id:dev_id pair. Even if it didn&#039;t bind for the first time for some weird reason, pci-stub tries to bind it again.</p><p>Therefore, i&#039;m not sure that your devices aren&#039;t bound to pci-stub or vfio-pci. Maybe they are?</p><p>BTW:</p><div class="codebox"><pre><code>01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] Subsystem: ASUSTeK Computer Inc. Device aab0 Flags: bus master, fast devsel, latency 0, IRQ 15 Memory at fe360000 (64-bit, non-prefetchable) [size=16K] Capabilities: &lt;access denied&gt; Kernel driver in use: vfio-pci Kernel modules: snd_hda_intel</code></pre></div><p>As you can see, i&#039;ve got audio device bound as well.</p><p>EDIT:<br />An idea struck me suddenly.<br />Maybe you didn&#039;t update your grub config, containing the new kernel command-line?</p><div class="codebox"><pre><code>su -c &quot;grub2-mkconfig &gt; /boot/grub/grub.cfg&quot;</code></pre></div><p>Try doing cat /proc/cmdline to find out what&#039;s your current kernel commandline.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-09 21:25:58)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518239">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518249" class="blockpost rowodd"> <h2><span><span class="conr">#4755</span> <a href="viewtopic.php?pid=1518249#p1518249">2015-04-09 21:35:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90118">Marius_Linux</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90118">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, after a full week of trying to get this working, I don&#039;t know what to do anymore right now.<br />I&#039;m running Fedora 21(latest Updates, Kernel 3.19.3-200.fc21.x86_64, QEMU qemu-2.1.3-3.fc21), trying to passthrough my two NVIDIA GTX 680(one is a Palit Jetstream, the other one a normal Gainward) to a VM, and I&#039;m using OVMF.<br />My CPU is an Intel i7 4770 (without K). supporting VT-d/x.<br />Now, the problem is, I can boot and install Windows 8.1, it detects the GPU, I then install driver version 314.xx (so without the hypervisor detection), but after reboot of the VM, Windows reports them with Code 43, and they are not working without NVIDIA drivers.<br />This is my lspci -nn:</p><div class="codebox"><pre><code>00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor DRAM Controller [8086:0150] (rev 09) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0151] (rev 09) 00:01.1 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port [8086:0155] (rev 09) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller [8086:0162] (rev 09) 00:14.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller [8086:1e31] (rev 04) 00:16.0 Communication controller [0780]: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 [8086:1e3a] (rev 04) 00:1a.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 [8086:1e2d] (rev 04) 00:1c.0 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 [8086:1e10] (rev c4) 00:1c.3 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 4 [8086:1e16] (rev c4) 00:1c.4 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 5 [8086:1e18] (rev c4) 00:1c.5 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 6 [8086:1e1a] (rev c4) 00:1c.6 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 7 [8086:1e1c] (rev c4) 00:1c.7 PCI bridge [0604]: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 8 [8086:1e1e] (rev c4) 00:1d.0 USB controller [0c03]: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 [8086:1e26] (rev 04) 00:1f.0 ISA bridge [0601]: Intel Corporation Z77 Express Chipset LPC Controller [8086:1e44] (rev 04) 00:1f.2 SATA controller [0106]: Intel Corporation 7 Series/C210 Series Chipset Family 6-port SATA Controller [AHCI mode] [8086:1e02] (rev 04) 00:1f.3 SMBus [0c05]: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller [8086:1e22] (rev 04) 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 04:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 05:00.0 Ethernet controller [0200]: Broadcom Corporation NetLink BCM57781 Gigabit Ethernet PCIe [14e4:16b1] (rev 10) 06:00.0 PCI bridge [0604]: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge [1b21:1080] (rev 01) 08:00.0 PCI bridge [0604]: PLX Technology, Inc. PEX8112 x1 Lane PCI Express-to-PCI Bridge [10b5:8112] (rev aa) 09:04.0 Multimedia audio controller [0401]: C-Media Electronics Inc CMI8788 [Oxygen HD Audio] [13f6:8788] 0a:00.0 USB controller [0c03]: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller [1b21:1042] </code></pre></div><p>I&#039;m using virt-manager, so this is my config XML:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;win8.1&lt;/name&gt; &lt;uuid&gt;e7d551c9-a77e-4a90-8974-9c881f7662ad&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;8&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039;&gt;/var/lib/libvirt/images/win81-OVMF.fd&lt;/loader&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win8.1.qcow2&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/marius/Downloads/de_windows_8_1_x64_dvd_2707227.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win81-OVMF.fd&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;usb&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>It produces this command:</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 -machine accel=kvm -name win8.1 -S -machine pc-i440fx-2.1,accel=kvm,usb=off -cpu SandyBridge,+erms,+smep,+fsgsbase,+rdrand,+f16c,+osxsave,+pcid,+pdcm,+xtpr,+tm2,+est,+smx,+vmx,+ds_cpl,+monitor,+dtes64,+pbe,+tm,+ht,+ss,+acpi,+ds,+vme,kvm=off -drive file=/var/lib/libvirt/images/win81-OVMF.fd,if=pflash,format=raw,unit=0 -m 4096 -realtime mlock=off -smp 8,sockets=8,cores=1,threads=1 -uuid e7d551c9-a77e-4a90-8974-9c881f7662ad -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/win8.1.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/var/lib/libvirt/images/win8.1.qcow2,if=none,id=drive-ide0-0-0,format=qcow2 -device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive file=/home/marius/Downloads/de_windows_8_1_x64_dvd_2707227.iso,if=none,id=drive-ide0-0-1,readonly=on,format=raw -device ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1 -drive file=/var/lib/libvirt/images/win81-OVMF.fd,if=none,id=drive-usb-disk0,format=raw -device usb-storage,drive=drive-usb-disk0,id=usb-disk0,removable=off -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -device usb-tablet,id=input0 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev spicevmc,id=charredir0,name=usbredir -device usb-redir,chardev=charredir0,id=redir0 -chardev spicevmc,id=charredir1,name=usbredir -device usb-redir,chardev=charredir1,id=redir1 -device vfio-pci,host=01:00.0,id=hostdev0,bus=pci.0,addr=0x7 -device vfio-pci,host=01:00.1,id=hostdev1,bus=pci.0,addr=0x8 -device vfio-pci,host=02:00.0,id=hostdev2,bus=pci.0,addr=0x9 -device vfio-pci,host=02:00.1,id=hostdev3,bus=pci.0,addr=0xa -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0xb -vga none -msg timestamp=on </code></pre></div><p>Anybody who could help me please?<br />Many thanks in advance<br />Marius</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518249">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518251" class="blockpost roweven"> <h2><span><span class="conr">#4756</span> <a href="viewtopic.php?pid=1518251#p1518251">2015-04-09 21:40:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@Bronek:<br />Can you give us lspci -v output?</p></div></blockquote></div><p>Here</p><div class="codebox"><pre><code># lspci -vn -s 0000:03:00.0 03:00.0 0300: 1002:6707 (prog-if 00 [VGA controller]) Subsystem: 1002:0b06 Flags: bus master, fast devsel, latency 0, IRQ 162 Memory at c0000000 (64-bit, prefetchable) [size=256M] Memory at dfd20000 (64-bit, non-prefetchable) [size=128K] I/O ports at 7000 [size=256] Expansion ROM at dfd00000 [disabled] [size=128K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Kernel driver in use: vfio-pci Kernel modules: radeon</code></pre></div><p>as you can see, I&#039;m running guest at this moment which is why module in use is vfio-pci. Before I started guest there was <strong>no</strong> driver (any) in use for primary card (radeon is blacklisted), while for the other card it was &quot;Kernel driver in use: pci-stub&quot; (consistent with dmesg)</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Because...</p><div class="codebox"><pre><code>[ 0.373329] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.373447] vgaarb: device added: PCI:0000:02:00.0,decodes=io+mem,owns=none,locks=none [ 0.373563] vgaarb: device added: PCI:0000:04:00.0,decodes=io+mem,owns=none,locks=none [ 0.373677] vgaarb: loaded [ 0.373751] vgaarb: bridge control possible 0000:04:00.0 [ 0.373825] vgaarb: bridge control possible 0000:02:00.0 [ 0.373900] vgaarb: bridge control possible 0000:01:00.0</code></pre></div></div></blockquote></div><p>that interesting, you do not have &quot; vgaarb: setting as boot device&quot;. I <strong>guess</strong> that&#039;s because booting from EFI does not need vgaarb.</p><p>As for audio, I do not use HDMI (I dont even passthrough function .1), I have USB ODAC instead attached to one of USB cards passed through to guest. I like this sound much better <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>EDIT:<br />An idea struck me suddenly.<br />Maybe you didn&#039;t update your grub config, containing the new kernel command-line?</p></div></blockquote></div><p>that&#039;s exactly why I&#039;m not using GRUB <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> Syslinux here, much simpler.</p> <p class="postedit"><em>Last edited by Bronek (2015-04-09 21:40:59)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518251">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518263" class="blockpost rowodd"> <h2><span><span class="conr">#4757</span> <a href="viewtopic.php?pid=1518263#p1518263">2015-04-09 22:11:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@Bronek:<br />Can you give us lspci -v output?</p></div></blockquote></div><p>Here</p><div class="codebox"><pre><code># lspci -vn -s 0000:03:00.0 03:00.0 0300: 1002:6707 (prog-if 00 [VGA controller]) Subsystem: 1002:0b06 Flags: bus master, fast devsel, latency 0, IRQ 162 Memory at c0000000 (64-bit, prefetchable) [size=256M] Memory at dfd20000 (64-bit, non-prefetchable) [size=128K] I/O ports at 7000 [size=256] Expansion ROM at dfd00000 [disabled] [size=128K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Capabilities: [150] Advanced Error Reporting Kernel driver in use: vfio-pci Kernel modules: radeon</code></pre></div><p>as you can see, I&#039;m running guest at this moment which is why module in use is vfio-pci. Before I started guest there was <strong>no</strong> driver (any) in use for primary card (radeon is blacklisted), while for the other card it was &quot;Kernel driver in use: pci-stub&quot; (consistent with dmesg)</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Because...</p><div class="codebox"><pre><code>[ 0.373329] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.373447] vgaarb: device added: PCI:0000:02:00.0,decodes=io+mem,owns=none,locks=none [ 0.373563] vgaarb: device added: PCI:0000:04:00.0,decodes=io+mem,owns=none,locks=none [ 0.373677] vgaarb: loaded [ 0.373751] vgaarb: bridge control possible 0000:04:00.0 [ 0.373825] vgaarb: bridge control possible 0000:02:00.0 [ 0.373900] vgaarb: bridge control possible 0000:01:00.0</code></pre></div></div></blockquote></div><p>that interesting, you do not have &quot; vgaarb: setting as boot device&quot;. I <strong>guess</strong> that&#039;s because booting from EFI does not need vgaarb.</p><p>As for audio, I do not use HDMI (I dont even passthrough function .1), I have USB ODAC instead attached to one of USB cards passed through to guest. I like this sound much better <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>EDIT:<br />An idea struck me suddenly.<br />Maybe you didn&#039;t update your grub config, containing the new kernel command-line?</p></div></blockquote></div><p>that&#039;s exactly why I&#039;m not using GRUB <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> Syslinux here, much simpler.</p></div></blockquote></div><div class="codebox"><pre><code>[ 0.373252] vgaarb: setting as boot device: PCI:0000:01:00.0</code></pre></div><p>Apparently, it got clipped. I do have vgaarb and i&#039;m booting host with csm. Too lazy to redo.</p><p>Do cat /proc/cmdline. Maybe it&#039;s syslinux&#039;s fault. Also, i think, you can make a file in /etc/modprobe.d/ and put pci-stub options there.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518267" class="blockpost roweven"> <h2><span><span class="conr">#4758</span> <a href="viewtopic.php?pid=1518267#p1518267">2015-04-09 22:24:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Marius_Linux wrote:</cite><blockquote><div><p>Hi, after a full week of trying to get this working, I don&#039;t know what to do anymore right now.<br />I&#039;m running Fedora 21(latest Updates, Kernel 3.19.3-200.fc21.x86_64, QEMU qemu-2.1.3-3.fc21), trying to passthrough my two NVIDIA GTX 680(one is a Palit Jetstream, the other one a normal Gainward) to a VM, and I&#039;m using OVMF.<br />My CPU is an Intel i7 4770 (without K). supporting VT-d/x.<br />Now, the problem is, I can boot and install Windows 8.1, it detects the GPU, I then install driver version 314.xx (so without the hypervisor detection), but after reboot of the VM, Windows reports them with Code 43, and they are not working without NVIDIA drivers.<br />This is my lspci -nn:</p><div class="codebox"><pre><code>..snip.. 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) ..snip..</code></pre></div><p>I&#039;m using virt-manager, so this is my config XML:<br />..snip..</p><p>It produces this command:<br />..snip..</p><p>Anybody who could help me please?<br />Many thanks in advance<br />Marius</p></div></blockquote></div><p>First of all - if you&#039;re going to try using SLI - there may be problems with 440fx being &quot;compatible&quot; with SLI. In the real, hardware world you must have &quot;SLI-compatible&quot; certified motherboard for SLI to work. Moreover, back in the day, you must&#039;ve use HyperSLI (based on VT-d) third party software to make SLI work on non-SLI-certified motherboards. The software is outdated, but still available, i wonder if it will work inside a VM using nested virtualization. That would be crazy.<br />List of things you can do:<br />1. Try Q35 chipset model.<br />2. Provide us dmesg to see if there&#039;s correct interrupt assigning messages and all the needed stuff.<br />3. Feed GTX680s with ROMs dumped from them in case of &quot;Invalid ROM contents&quot; messages. Also you could get the needed ROMs <a href="http://www.techpowerup.com/vgabios/index.php" rel="nofollow">here</a>.<br />4. &quot;Quadrify&quot; your GPUs using modified vfio-pci with fake PCI IDs and (maybe) ROMs. You could quadrify it hardware-way, but that&#039;s too hardcore and pointless if the culprit is somewhere else. That&#039;ll make all the problems with drivers detecting hypervisor go away, as it&#039;s 100% legit to passthrough a Quadro device. That way you could use more fresh drivers.<br />5. As i can see, you have Z77 chipset. Lurk a few pages back, there was some guy with that chipset and some problems with nvidia. I don&#039;t remember what the problem was, actually.<br />6. Try using legacy KVM pci passthrough: <a href="http://libvirt.org/formatdomain.html#elementsHostDev" rel="nofollow">here</a>&#039;s an example of using it(driver option). It doesn&#039;t work with VGA, but since you&#039;re using OVMF anyway...<br />7. Wait for aw to come, heh.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-09 22:26:38)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518267">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518273" class="blockpost rowodd"> <h2><span><span class="conr">#4759</span> <a href="viewtopic.php?pid=1518273#p1518273">2015-04-09 22:47:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Do cat /proc/cmdline.</p></div></blockquote></div><p>Thanks, that was a <strong>very good</strong> advice. It turns out I am an idiot (don&#039;t tell my family, they already know), I wrote new boot parameters in the wrong file.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518275" class="blockpost roweven"> <h2><span><span class="conr">#4760</span> <a href="viewtopic.php?pid=1518275#p1518275">2015-04-09 22:55:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>I wrote new boot parameters in the wrong file.</p></div></blockquote></div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>that&#039;s exactly why I&#039;m not using GRUB <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> Syslinux here, much simpler.</p></div></blockquote></div><p>Kek.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518275">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518288" class="blockpost rowodd"> <h2><span><span class="conr">#4761</span> <a href="viewtopic.php?pid=1518288#p1518288">2015-04-10 00:11:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Marius_Linux wrote:</cite><blockquote><div><p>Now, the problem is, I can boot and install Windows 8.1, it detects the GPU, I then install driver version 314.xx (so without the hypervisor detection), ...</p></div></blockquote></div><p>Is this a typo?&#160; You only need pre-338.77 to avoid all hypervisor detection and pre-344.11 for the hyper-v stuff.&#160; Try a newer driver.&#160; Start with a single card for the guest.&#160; Dump your &lt;qemu:args&gt; section, you don&#039;t need it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518288">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518314" class="blockpost roweven"> <h2><span><span class="conr">#4762</span> <a href="viewtopic.php?pid=1518314#p1518314">2015-04-10 03:42:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78080">Slabity</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-29</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:tslabinski@mygsc.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I managed to successfully pass through my GPU using the OVMF method, but I&#039;m struggling to get audio to work over ALSA. I am using libvirt, and have added the following to my VM config:</p><div class="codebox"><pre><code>&lt;qemu:commandline&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DRV&#039; value=&#039;alsa&#039;/&gt; &lt;qemu:env name=&#039;QEMU_ALSA_DAC_PERIOD_SIZE&#039; value=&#039;170&#039;/&gt; &lt;qemu:env name=&#039;QEMU_ALSA_DAC_BUFFER_SIZE&#039; value=&#039;512&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>But my host does not show any ALSA client appearing. Any ideas where I should look?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518314">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518483" class="blockpost rowodd"> <h2><span><span class="conr">#4763</span> <a href="viewtopic.php?pid=1518483#p1518483">2015-04-10 14:44:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90118">Marius_Linux</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90118">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Marius_Linux wrote:</cite><blockquote><div><p>Hi, after a full week of trying to get this working, I don&#039;t know what to do anymore right now.<br />I&#039;m running Fedora 21(latest Updates, Kernel 3.19.3-200.fc21.x86_64, QEMU qemu-2.1.3-3.fc21), trying to passthrough my two NVIDIA GTX 680(one is a Palit Jetstream, the other one a normal Gainward) to a VM, and I&#039;m using OVMF.<br />My CPU is an Intel i7 4770 (without K). supporting VT-d/x.<br />Now, the problem is, I can boot and install Windows 8.1, it detects the GPU, I then install driver version 314.xx (so without the hypervisor detection), but after reboot of the VM, Windows reports them with Code 43, and they are not working without NVIDIA drivers.<br />This is my lspci -nn:</p><div class="codebox"><pre><code>..snip.. 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 680] [10de:1180] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) ..snip..</code></pre></div><p>I&#039;m using virt-manager, so this is my config XML:<br />..snip..</p><p>It produces this command:<br />..snip..</p><p>Anybody who could help me please?<br />Many thanks in advance<br />Marius</p></div></blockquote></div><p>First of all - if you&#039;re going to try using SLI - there may be problems with 440fx being &quot;compatible&quot; with SLI. In the real, hardware world you must have &quot;SLI-compatible&quot; certified motherboard for SLI to work. Moreover, back in the day, you must&#039;ve use HyperSLI (based on VT-d) third party software to make SLI work on non-SLI-certified motherboards. The software is outdated, but still available, i wonder if it will work inside a VM using nested virtualization. That would be crazy.<br />List of things you can do:<br />1. Try Q35 chipset model.<br />2. Provide us dmesg to see if there&#039;s correct interrupt assigning messages and all the needed stuff.<br />3. Feed GTX680s with ROMs dumped from them in case of &quot;Invalid ROM contents&quot; messages. Also you could get the needed ROMs <a href="http://www.techpowerup.com/vgabios/index.php" rel="nofollow">here</a>.<br />4. &quot;Quadrify&quot; your GPUs using modified vfio-pci with fake PCI IDs and (maybe) ROMs. You could quadrify it hardware-way, but that&#039;s too hardcore and pointless if the culprit is somewhere else. That&#039;ll make all the problems with drivers detecting hypervisor go away, as it&#039;s 100% legit to passthrough a Quadro device. That way you could use more fresh drivers.<br />5. As i can see, you have Z77 chipset. Lurk a few pages back, there was some guy with that chipset and some problems with nvidia. I don&#039;t remember what the problem was, actually.<br />6. Try using legacy KVM pci passthrough: <a href="http://libvirt.org/formatdomain.html#elementsHostDev" rel="nofollow">here</a>&#039;s an example of using it(driver option). It doesn&#039;t work with VGA, but since you&#039;re using OVMF anyway...<br />7. Wait for aw to come, heh.</p></div></blockquote></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Marius_Linux wrote:</cite><blockquote><div><p>Now, the problem is, I can boot and install Windows 8.1, it detects the GPU, I then install driver version 314.xx (so without the hypervisor detection), ...</p></div></blockquote></div><p>Is this a typo?&#160; You only need pre-338.77 to avoid all hypervisor detection and pre-344.11 for the hyper-v stuff.&#160; Try a newer driver.&#160; Start with a single card for the guest.&#160; Dump your &lt;qemu:args&gt; section, you don&#039;t need it.</p></div></blockquote></div><p>Thanks for your help you two, I was surprised how quick you answered :-)<br />I&#039;ve just checked my Palit card using your tool, and as it seems, it doesn&#039;t have EFI support:</p><div class="codebox"><pre><code>Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 1180, class: 030000 PCIR: revision 0, vendor revision: 1 Last image </code></pre></div><p>Currently, I am looking for a BIOS for this Card(and my Gainward GTX 680), which support EFI. Does anybody know where to look, or how to check if the ROM is compatible with my card?</p> <p class="postedit"><em>Last edited by Marius_Linux (2015-04-10 14:45:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518483">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518537" class="blockpost roweven"> <h2><span><span class="conr">#4764</span> <a href="viewtopic.php?pid=1518537#p1518537">2015-04-10 17:04:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Marius_Linux wrote:</cite><blockquote><div><p>Currently, I am looking for a BIOS for this Card(and my Gainward GTX 680), which support EFI. Does anybody know where to look, or how to check if the ROM is compatible with my card?</p></div></blockquote></div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>3. Feed GTX680s with ROMs dumped from them in case of &quot;Invalid ROM contents&quot; messages. Also you could get the needed ROMs <strong><a href="http://www.techpowerup.com/vgabios/index.php" rel="nofollow">here.</a></strong></p></div></blockquote></div><p><strong>TechPowerUp GPU BIOS database</strong>.<br />Official site of your GPU vendor is also a good place to look for GPU bios updates. Since my GT610 does support UEFI, it&#039;s very strange that your GTX680 doesn&#039;t.<br />Something hints me that all 680 are alike to each other being reference designs, and they all can be quadrified and/or their VBIOS images are compatible.<br />Of course, vendor may change the reference design, ruining compatibility, but i haven&#039;t heard of that for 680s.</p><p>How to check.. Well, add it and observe. If the card will(for some weird and unlikely reason) start smoking - quick CTRL-C will save it. If you see Tianocore boot splash - everything&#039;s working fine.</p><div class="codebox"><pre><code>&lt;rom bar=&#039;on&#039; file=&#039;/path/to/your/romfile.rom&#039;/&gt;</code></pre></div><p>P.S.<br />AFAIR, SLI won&#039;t double your video memory, but XDMA CF will.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-10 17:06:08)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518537">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518687" class="blockpost rowodd"> <h2><span><span class="conr">#4765</span> <a href="viewtopic.php?pid=1518687#p1518687">2015-04-10 23:55:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Child_of_Sun wrote:</cite><blockquote><div><div class="quotebox"><cite>mutiny wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yes, you can theoretically pass through any PCI endpoint device.&#160; How well it works depends on the device.&#160; Whether it&#039;s supported as a pre-boot device depends on whether there&#039;s a boot ROM for the device or built-in support or standard compatibility in the VM firmware.&#160; IOW, try it and find out.&#160; OTOH, my personal opinion is that assigning PCI HBAs often provides a marginal performance improvement and significantly more headaches vs paravirtual solutions.</p></div></blockquote></div><p>I gave this a shot today just to experiment. I connected a spare 1TB SATA drive to the motherboard&#039;s Marvell SATA controller (non-chipset 2nd controller) and passed that through qemu to play around with. OVMF shows no signs of seeing a drive/controller (not sure if I should even be seeing anything really), but booting off a Windows install ISO shows the hard drive perfectly fine, and allows me to install to it. However, after the install completes and the guest system reboots, OVMF just dumps back at the Shell&gt; prompt. OVMF&#039;s Boot Manager shows a &quot;Windows Boot Manager&quot; entry with device path: HD(2,GPT,UUID#)/\EFI\Microsoft\Boot\bootmgfw.efi so it seems like Windows at least installed boot information to the drive and to the firmware VARS I think? Not sure what to do from here or if it is a dead end. Maybe others have experimented with trying something like this (this is just all out of curiosity&#039;s sake). Probably has something to do with HD index showing as being at 2, wonder if this could be manually edited.</p></div></blockquote></div><p>I try the &quot;same&quot; thing with my Motherbord Sata Controller it&#039;s a SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode]. The Windows 8.1 DVD won&#039;t boot and the Windows 10 Tech Preview freezes.</p><p>Ovmf has no boot option for this controller, even when i use uefi-raid mode.</p><p>I hope someone can help with that.</p></div></blockquote></div><p>Try virtio-scsi block passthrough. I found a concise (libvirt based) example here: <a href="https://blueprints.launchpad.net/nova/+spec/support-for-raw-device-mapping" rel="nofollow">https://blueprints.launchpad.net/nova/+ … ce-mapping</a></p><p>From <a href="http://libvirt.org/formatdomain.html" rel="nofollow">http://libvirt.org/formatdomain.html</a>, &quot;... generic SCSI commands from the guest are accepted and passed through to the physical device ...&quot;. This can be used for CD-ROM/DVD burning passthrough etc (<a href="http://wiki.qemu.org/Features/VirtioSCSI" rel="nofollow">http://wiki.qemu.org/Features/VirtioSCSI</a>).</p><p>Also, OVMF&#039;s builtin virtio-scsi driver will be able to handle &amp; boot off such devices. The qemu command line is:</p><div class="codebox"><pre><code> -device virtio-scsi-pci,id=scsi0 \ -drive file=/dev/disk/by-id/...,if=none,id=virtio-scsi-passthrough0,format=raw \ -device scsi-block,bus=scsi0.0,drive=virtio-scsi-passthrough0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518747" class="blockpost roweven"> <h2><span><span class="conr">#4766</span> <a href="viewtopic.php?pid=1518747#p1518747">2015-04-11 06:01:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=65869">Helios747</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-11-17</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, I&#039;m on ubuntu 14.10 x64 and I&#039;m trying to get this to work. So far I run the qemu script and I get a small console where I can input commands to qemu, but no output on my display hooked up to my guest GPU, nor any errors.</p><p>My specs:</p><p>Gigabyte GA-Z97-HD3 (VT-d enabled)<br />Intel Core i7-4790K (intel ark says VT-d compatible)<br />Host GPU: Intel HD Graphics 4600<br />Guest GPU: MSI TwinFrozr GTX 770</p><p>output of &quot;lspci -nn | grep NVIDIA&quot;</p><div class="quotebox"><blockquote><div><p>01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1)<br />01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1)</p></div></blockquote></div><br /><p>This is my grub command line options</p><div class="quotebox"><blockquote><div><p>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash pcie_acs_override=downstream intel_iommu=on,igfx_on i915.enable_hd_vgaarb=1&quot;</p></div></blockquote></div><p>I have nouveau blacklisted, I have the following in /etc/initramfs-tools/modules (And I updated initramfs after)</p><div class="quotebox"><blockquote><div><p>pci_stub ids=10de:1184,10de:0e0a</p></div></blockquote></div><p>I ran the vfio-bind script with no errors. I ran it with</p><div class="quotebox"><blockquote><div><p>sudo ./vfio-bind 0000:01:00.0 0000:01:00.1</p></div></blockquote></div><p>These are the contents of it</p><div class="quotebox"><blockquote><div><p>#!/bin/bash</p><p>modprobe vfio-pci</p><p>for dev in &quot;$@&quot;; do<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id<br />done</p></div></blockquote></div><p>I run qemu with this script</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-device vfio-pci,host=01:00.0,x-vga=on -device vfio-pci,host=01:00.1 \<br />-vga none -device virtio-scsi-pci,id=scsi -drive file=/home/anthony/windows.img,id=disk,format=raw,if=none \ <br />-device scsi-hd,drive=disk -drive file=/home/anthony/win8.iso,id=isocd,if=none -device scsi-cd,drive=isocd \<br />-drive file=/home/anthony/virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd</p></div></blockquote></div><p>I don&#039;t get any visible errors. Just a blank, usable qemu console and no output at all on the display hooked up to the guest GPU.</p><p>Am I missing something?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518802" class="blockpost rowodd"> <h2><span><span class="conr">#4767</span> <a href="viewtopic.php?pid=1518802#p1518802">2015-04-11 10:55:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Helios747 wrote:</cite><blockquote><div><p>Hello, I&#039;m on ubuntu 14.10 x64 and I&#039;m trying to get this to work. So far I run the qemu script and I get a small console where I can input commands to qemu, but no output on my display hooked up to my guest GPU, nor any errors.</p><p>My specs:</p><p>Gigabyte GA-Z97-HD3 (VT-d enabled)<br />Intel Core i7-4790K (intel ark says VT-d compatible)<br />Host GPU: Intel HD Graphics 4600<br />Guest GPU: MSI TwinFrozr GTX 770</p><p>output of &quot;lspci -nn | grep NVIDIA&quot;</p><div class="quotebox"><blockquote><div><p>01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1)<br />01:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1)</p></div></blockquote></div><p>This is my grub command line options</p><div class="quotebox"><blockquote><div><p>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash pcie_acs_override=downstream intel_iommu=on,igfx_on i915.enable_hd_vgaarb=1&quot;</p></div></blockquote></div><p>..snip..<br />I run qemu with this script</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-device vfio-pci,host=01:00.0,x-vga=on -device vfio-pci,host=01:00.1 \<br />-vga none -device virtio-scsi-pci,id=scsi -drive file=/home/anthony/windows.img,id=disk,format=raw,if=none \ <br />-device scsi-hd,drive=disk -drive file=/home/anthony/win8.iso,id=isocd,if=none -device scsi-cd,drive=isocd \<br />-drive file=/home/anthony/virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd</p></div></blockquote></div><p>I don&#039;t get any visible errors. Just a blank, usable qemu console and no output at all on the display hooked up to the guest GPU.</p><p>Am I missing something?</p></div></blockquote></div><p>Try checking dmesg. If there are any errors in KVM or VFIO work - it&#039;ll be there.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518802">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518853" class="blockpost roweven"> <h2><span><span class="conr">#4768</span> <a href="viewtopic.php?pid=1518853#p1518853">2015-04-11 13:20:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Helios747 wrote:</cite><blockquote><div><p>Am I missing something?</p></div></blockquote></div><p>Whenever it&#039;s not explicitly mentioned, my first suspicion is whether the i915 patch is actually applied to the kernel.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518853">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518859" class="blockpost rowodd"> <h2><span><span class="conr">#4769</span> <a href="viewtopic.php?pid=1518859#p1518859">2015-04-11 13:43:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>These keep piling in dmesg :</p><div class="codebox"><pre><code>[Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: AER: Multiple Corrected error received: id=0018 [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: PCIe Bus Error: severity=Corrected, type=Data Link Layer, id=0018(Receiver ID) [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: device [8086:2f08] error status/mask=00000040/00002000 [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: [ 6] Bad TLP</code></pre></div><p>Using 4.0-rc5 and also happened on previous kernels . When it starts appearing , any VM rebooting or even host rebooting causes the host to hard crash . This is on X99 platform , where 00:03.0 is a :</p><div class="codebox"><pre><code>00:03.0 PCI bridge [0604]: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 3 [8086:2f08] (rev 02) (prog-if 00 [Normal decode])</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518859">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518861" class="blockpost roweven"> <h2><span><span class="conr">#4770</span> <a href="viewtopic.php?pid=1518861#p1518861">2015-04-11 13:50:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>These keep piling in dmesg :</p><div class="codebox"><pre><code>[Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: AER: Multiple Corrected error received: id=0018 [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: PCIe Bus Error: severity=Corrected, type=Data Link Layer, id=0018(Receiver ID) [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: device [8086:2f08] error status/mask=00000040/00002000 [Fri Apr 10 05:53:03 2015] pcieport 0000:00:03.0: [ 6] Bad TLP</code></pre></div></div></blockquote></div><p>You&#039;re getting bad packets on the link, the root port is the receiver of the packet.&#160; This could indicate some sort of hardware problem.&#160; Are you overclocking?&#160; If you move the device behind this root port to another slot, do the errors follow it?&#160; It could be a bad endpoint device.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518861">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518879" class="blockpost rowodd"> <h2><span><span class="conr">#4771</span> <a href="viewtopic.php?pid=1518879#p1518879">2015-04-11 14:38:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;re getting bad packets on the link, the root port is the receiver of the packet.&#160; This could indicate some sort of hardware problem.&#160; Are you overclocking?&#160; If you move the device behind this root port to another slot, do the errors follow it?&#160; It could be a bad endpoint device.</p></div></blockquote></div><p>So it is the GPU and not the port itself that causes the problem .</p><p>Let me understand this correctly . I have these root ports :</p><div class="codebox"><pre><code>00:01.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 1 (rev 02) 00:01.1 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 1 (rev 02) 00:02.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 2 (rev 02) 00:03.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 3 (rev 02)</code></pre></div><p>Are they numbered in a relative way to their physical position on the motherboard ? If that&#039;s the case , then 00:03.0 is the fourth slot from the top which is occupied by my GT610 (the card of legendary headaches thus far) .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518879">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518881" class="blockpost roweven"> <h2><span><span class="conr">#4772</span> <a href="viewtopic.php?pid=1518881#p1518881">2015-04-11 14:43:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;re getting bad packets on the link, the root port is the receiver of the packet.&#160; This could indicate some sort of hardware problem.&#160; Are you overclocking?&#160; If you move the device behind this root port to another slot, do the errors follow it?&#160; It could be a bad endpoint device.</p></div></blockquote></div><p>So it is the GPU and not the port itself that causes the problem .</p><p>Let me understand this correctly . I have these root ports :</p><div class="codebox"><pre><code>00:01.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 1 (rev 02) 00:01.1 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 1 (rev 02) 00:02.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 2 (rev 02) 00:03.0 PCI bridge: Intel Corporation Xeon E5 v3/Core i7 PCI Express Root Port 3 (rev 02)</code></pre></div><p>Are they numbered in a relative way to their physical position on the motherboard ? If that&#039;s the case , then 00:03.0 is the fourth slot from the top which is occupied by my GT610 (the card of legendary headaches thus far) .</p></div></blockquote></div><p>The slot to root port mapping depends on how your motherboard is wired.&#160; There are ways that the firmware can provide more human readable slot names via ACPI, but they&#039;re often not used on desktop boards.&#160; <em>lspci -t</em> is useful for seeing a tree view of the hardware for more easily mapping which endpoint address is behind which root port.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518881">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518884" class="blockpost rowodd"> <h2><span><span class="conr">#4773</span> <a href="viewtopic.php?pid=1518884#p1518884">2015-04-11 14:49:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The slot to root port mapping depends on how your motherboard is wired.&#160; There are ways that the firmware can provide more human readable slot names via ACPI, but they&#039;re often not used on desktop boards.&#160; <em>lspci -t</em> is useful for seeing a tree view of the hardware for more easily mapping which endpoint address is behind which root port.</p></div></blockquote></div><p>Forgive me , but I couldn&#039;t make sense of this output :</p><div class="codebox"><pre class="vscroll"><code>-+-[0000:ff]-+-0b.0 | +-0b.1 | +-0b.2 | +-0c.0 | +-0c.1 | +-0c.2 | +-0c.3 | +-0c.4 | +-0c.5 | +-0f.0 | +-0f.1 | +-0f.4 | +-0f.5 | +-0f.6 | +-10.0 | +-10.1 | +-10.5 | +-10.6 | +-10.7 | +-12.0 | +-12.1 | +-13.0 | +-13.1 | +-13.2 | +-13.3 | +-13.4 | +-13.5 | +-13.6 | +-13.7 | +-14.0 | +-14.1 | +-14.2 | +-14.3 | +-14.6 | +-14.7 | +-15.0 | +-15.1 | +-15.2 | +-15.3 | +-16.0 | +-16.6 | +-16.7 | +-17.0 | +-17.4 | +-17.5 | +-17.6 | +-17.7 | +-1e.0 | +-1e.1 | +-1e.2 | +-1e.3 | +-1e.4 | +-1f.0 | \-1f.2 \-[0000:00]-+-00.0 +-01.0-[03-08]----00.0-[04-08]--+-01.0-[05]----00.0 | +-05.0-[06]----00.0 | +-07.0-[07]----00.0 | \-09.0-[08]----00.0 +-01.1-[09]-- +-02.0-[02]--+-00.0 | \-00.1 +-03.0-[01]--+-00.0 | \-00.1 +-05.0 +-05.1 +-05.2 +-05.4 +-11.0 +-11.4 +-14.0 +-16.0 +-19.0 +-1a.0 +-1b.0 +-1c.0-[0a]-- +-1c.3-[0b-10]----00.0-[0c-10]--+-01.0-[0d]----00.0 | +-02.0-[0e]----00.0 | +-03.0-[0f]-- | \-04.0-[10]-- +-1c.4-[11]----00.0 +-1c.6-[12]----00.0 +-1d.0 +-1f.0 +-1f.2 \-1f.3</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518884">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518890" class="blockpost roweven"> <h2><span><span class="conr">#4774</span> <a href="viewtopic.php?pid=1518890#p1518890">2015-04-11 14:56:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="codebox"><pre><code> \-[0000:00]-+-00.0 +-01.0-[03-08]----00.0-[04-08]--+-01.0-[05]----00.0 | +-05.0-[06]----00.0 | +-07.0-[07]----00.0 | \-09.0-[08]----00.0 +-01.1-[09]-- +-02.0-[02]--+-00.0 | \-00.1 +-03.0-[01]--+-00.0 | \-00.1 ... +-1c.0-[0a]-- +-1c.3-[0b-10]----00.0-[0c-10]--+-01.0-[0d]----00.0 | +-02.0-[0e]----00.0 | +-03.0-[0f]-- | \-04.0-[10]-- +-1c.4-[11]----00.0 +-1c.6-[12]----00.0</code></pre></div></div></blockquote></div><p>Devices 01:00.0 and 01:00.1 are behind root port 00:03.0</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518890">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1518898" class="blockpost rowodd"> <h2><span><span class="conr">#4775</span> <a href="viewtopic.php?pid=1518898#p1518898">2015-04-11 15:02:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Ohhh I get it now ! The first number is the Port number , the numbers after it are the devices numbers . So devices 02:00.0 , 02:00.1 are behind Port 00:02.0 . Device 11:00.0 is behind 00:1c.4 , and so on .</p><p>Thanks Alex ! It is GTX770 then , which is the host&#039;s primary GPU . I&#039;ll try to troubleshoot it and post my findings if I ever got it fixed hopefully .</p><p>EDIT :</p><p>Rebooted the host , entered BIOS and loaded optimized defaults , also I added &quot;nomodeset&quot; &amp;&#160; &quot;nofb&quot; to the boot parameters . Uptil now , no errors in dmesg . Will see if it can survive overnight .</p> <p class="postedit"><em>Last edited by Denso (2015-04-11 16:13:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1518898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=190">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <strong>191</strong> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <a href="viewtopic.php?id=162768&amp;p=193">193</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=192">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
