<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 35) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=35" title="Page 35" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=34" title="Page 34" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=36" title="Page 36" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=34">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=33">33</a> <a href="viewtopic.php?id=162768&amp;p=34">34</a> <strong>35</strong> <a href="viewtopic.php?id=162768&amp;p=36">36</a> <a href="viewtopic.php?id=162768&amp;p=37">37</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=36">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1356298" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#851</span> <a href="viewtopic.php?pid=1356298#p1356298">2013-12-03 16:26:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=36563">abarahc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/36563.jpg?m=1333804461" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2010-04-30</span></dd> <dd><span>Posts: 118</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=36563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi! sorry if all this questio below are already answered and i didnt get them, but!</p><br /><br /><div class="quotebox"><blockquote><div><p>Question - 01 - How can i check it?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><strong>Setting up vfio and kvm modules</strong></p><p>If your board doesn&#039;t enable interrupt remapping, you need to add this to your grub cfg:</p></div></blockquote></div><br /><p>i&#039;ve read this <a href="http://www.linux-kvm.org/page/How_to_assign_devices_with_VT-d_in_KVM" rel="nofollow">http://www.linux-kvm.org/page/How_to_as … T-d_in_KVM</a> <br />and on step 3 we have this command </p><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU</code></pre></div><p> which i think is the answer for my question! True?</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>Question - 02 - I got only one line on command&#039;s output<br />the command </p><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU</code></pre></div><p>must have a positive returning like this</p><div class="codebox"><pre><code>DMAR:DRHD base: 0x000000feb03000 flags: 0x0 IOMMU feb03000: ver 1:0 cap c9008020e30260 ecap 1000</code></pre></div><p>but in my case i got this</p><div class="codebox"><pre><code>[ 0.000000] Intel-IOMMU: enabled</code></pre></div><p>so this is mean i dont have remapping support? or is something else?</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>Question - 03 - Why vfio?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><strong>Binding a device to vfio-pci</strong></p><p>Assuming the kernel, qemu and seabios are built and working, lets bind some devices.<br />You can use this script to make life easier:</p><div class="codebox"><pre><code>#!/bin/bash modprobe vfio-pci for dev in &quot;$@&quot;; do vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done</code></pre></div><p>Save it as /usr/bin/vfio-bind</p><div class="codebox"><pre><code>chmod 755 /usr/bin/vfio-bind</code></pre></div></div></blockquote></div><p>on the tutorial link is mentioned another path to make this procedures. so whats the real difference between pci-stub and vfio-stub?</p><p>on my case both solution do not work correctly. every time a try </p><div class="codebox"><pre><code>echo XX:XXX:XX &gt; /sys/bus/pci/drivers/vfio-pci/new_id</code></pre></div><p>or </p><div class="codebox"><pre><code>echo XX:XXX:XX &gt; /sys/bus/pci/drivers/pci-stub/new_id</code></pre></div><p> i got permission issues.</p><p>those files are on write mode only! and even after i changing the modes to read/write or read/write/execute nothing change error message about i can write nothing </p><p>1. yes i was making this instructions as root<br />2. yes, i tried &quot;su&quot; and &quot;su -&quot;. no changes</p><div class="quotebox"><blockquote><div><p>Question - 04 So whats the problem with this files?</p></div></blockquote></div></div></blockquote></div><div class="quotebox"><blockquote><div><p>Question - 05 - Where is this BUS id?</p><p>in a few lines of this tuto when you have to pass a devices to qemu you write the correct bus for them. But i really dont know where i can find this info.</p><p>sometimes is &quot;bus=root.1&quot; other times are &quot;bus=pcie.0&quot;</p><p>so how can i determine?</p></div></blockquote></div> </div> <div class="postsignature postmsg"><hr /><p><em>&quot;...dear cinnamon tear...&quot;</em></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356298">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356306" class="blockpost roweven"> <h2><span><span class="conr">#852</span> <a href="viewtopic.php?pid=1356306#p1356306">2013-12-03 16:49:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abarahc wrote:</cite><blockquote><div><p>Hi! sorry if all this questio below are already answered and i didnt get them, but!</p><br /><br /><div class="quotebox"><blockquote><div><p>Question - 01 - How can i check it?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><strong>Setting up vfio and kvm modules</strong></p><p>If your board doesn&#039;t enable interrupt remapping, you need to add this to your grub cfg:</p></div></blockquote></div><br /><p>i&#039;ve read this <a href="http://www.linux-kvm.org/page/How_to_assign_devices_with_VT-d_in_KVM" rel="nofollow">http://www.linux-kvm.org/page/How_to_as … T-d_in_KVM</a> <br />and on step 3 we have this command </p><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU</code></pre></div><p> which i think is the answer for my question! True?</p></div></blockquote></div></div></blockquote></div><p>Interrupt remapping depends on IOMMU support, but having IOMMU support doesn&#039;t imply interrupt remapping.&#160; You can look for something like &quot;Enabled IRQ remapping in ...... mode&quot;, or you can just try it.&#160; vfio won&#039;t let you assign a device without it or the option to bypass it, so if it doesn&#039;t work, look in dmesg and you&#039;ll see a message about how to enable it if that&#039;s the problem.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>Question - 02 - I got only one line on command&#039;s output<br />the command </p><div class="codebox"><pre><code>dmesg | grep -e DMAR -e IOMMU</code></pre></div><p>must have a positive returning like this</p><div class="codebox"><pre><code>DMAR:DRHD base: 0x000000feb03000 flags: 0x0 IOMMU feb03000: ver 1:0 cap c9008020e30260 ecap 1000</code></pre></div><p>but in my case i got this</p><div class="codebox"><pre><code>[ 0.000000] Intel-IOMMU: enabled</code></pre></div><p>so this is mean i dont have remapping support? or is something else?</p></div></blockquote></div></div></blockquote></div><p>It means you don&#039;t have VT-d support.&#160; Make sure it&#039;s enabled in you BIOS and make sure you&#039;re booting with intel_iommu=on</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>Question - 03 - Why vfio?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p><strong>Binding a device to vfio-pci</strong></p><p>Assuming the kernel, qemu and seabios are built and working, lets bind some devices.<br />You can use this script to make life easier:</p><div class="codebox"><pre><code>#!/bin/bash modprobe vfio-pci for dev in &quot;$@&quot;; do vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done</code></pre></div><p>Save it as /usr/bin/vfio-bind</p><div class="codebox"><pre><code>chmod 755 /usr/bin/vfio-bind</code></pre></div></div></blockquote></div><p>on the tutorial link is mentioned another path to make this procedures. so whats the real difference between pci-stub and vfio-stub?</p><p>on my case both solution do not work correctly. every time a try </p><div class="codebox"><pre><code>echo XX:XXX:XX &gt; /sys/bus/pci/drivers/vfio-pci/new_id</code></pre></div><p>or </p><div class="codebox"><pre><code>echo XX:XXX:XX &gt; /sys/bus/pci/drivers/pci-stub/new_id</code></pre></div><p> i got permission issues.</p><p>those files are on write mode only! and even after i changing the modes to read/write or read/write/execute nothing change error message about i can write nothing </p><p>1. yes i was making this instructions as root<br />2. yes, i tried &quot;su&quot; and &quot;su -&quot;. no changes</p><div class="quotebox"><blockquote><div><p>Question - 04 So whats the problem with this files?</p></div></blockquote></div></div></blockquote></div></div></blockquote></div><p>You&#039;re using them incorrectly.&#160; Note that the script echos $vendor and $device to the new_id file while you&#039;re trying to use the (incomplete) PCI address.&#160; You&#039;re getting permission denied because of what you&#039;re trying to echo, not because of file permissions.&#160; As to why vfio-pci vs pci-stub, vfio is a new userspace driver interface where qemu is just a userspace driver using it for device assignment.&#160; Legacy kvm device assignment with pci-stub is effectively deprecated.&#160; Also, if you want to do VGA, vfio is the only device assignment interface with this support.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>Question - 05 - Where is this BUS id?</p><p>in a few lines of this tuto when you have to pass a devices to qemu you write the correct bus for them. But i really dont know where i can find this info.</p><p>sometimes is &quot;bus=root.1&quot; other times are &quot;bus=pcie.0&quot;</p><p>so how can i determine?</p></div></blockquote></div></div></blockquote></div></div></blockquote></div><p>bus= addresses are qemu defined identifiers.&#160; When using the q35 model there is an implicit id=pcie.0 on the root bus.&#160; That means any devices placed there using bus=pcie.0 will appear on the PCIe root complex.&#160; When root ports are added to the topology they create a new bus.&#160; You&#039;re able to name that bus with the id= option.&#160; root.1 is just a name some people use, it could just as easily be named bob.&#160; To place a device on that bus, use the bus=bob option.</p><p>When specifying a device to be assigned, it&#039;s the host= option.&#160; This always takes the form of bus:device.function (ex. 01:00.0) or segment:bus:device.function (ex. 0000:01:00.0).&#160; These match your physical device layout.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356306">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356314" class="blockpost rowodd"> <h2><span><span class="conr">#853</span> <a href="viewtopic.php?pid=1356314#p1356314">2013-12-03 17:08:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=36563">abarahc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/36563.jpg?m=1333804461" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2010-04-30</span></dd> <dd><span>Posts: 118</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=36563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw</p><p>Thanks so much to reply so fast!</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It means you don&#039;t have VT-d support.&#160; Make sure it&#039;s enabled in you BIOS and make sure you&#039;re booting with intel_iommu=on</p></div></blockquote></div><p>the &quot;intel_iommu=on&quot; is set as parameter on kernel boot line!</p><div class="codebox"><pre><code>linux /boot/vmlinuz-linux root=UUID=aaed6a49-c921-463c-bc9b-a22b74a6ee4e rw quiet intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0de9,8086:1e20</code></pre></div><p>but i cant find anything about this on my notebook BIOS! (Asus K45VM). This probably means i dont have support to remapping, right? <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>The pci.stub.ids are based on this output</p><p>lspci</p><div class="codebox"><pre><code>00:00.0 Host bridge: Intel Corporation 3rd Gen Core processor DRAM Controller (rev 09) 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor PCI Express Root Port (rev 09) 00:02.0 VGA compatible controller: Intel Corporation 3rd Gen Core processor Graphics Controller (rev 09) 00:14.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller (rev 04) 00:16.0 Communication controller: Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 (rev 04) 00:1a.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 (rev 04) 00:1b.0 Audio device: Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller (rev 04) 00:1c.0 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 1 (rev c4) 00:1c.1 PCI bridge: Intel Corporation 7 Series/C210 Series Chipset Family PCI Express Root Port 2 (rev c4) 00:1d.0 USB controller: Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #1 (rev 04) 00:1f.0 ISA bridge: Intel Corporation HM76 Express Chipset LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 7 Series Chipset Family 6-port SATA Controller [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 7 Series/C210 Series Chipset Family SMBus Controller (rev 04) 01:00.0 VGA compatible controller: NVIDIA Corporation GF108M [GeForce GT 630M] (rev a1) 02:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168 PCI Express Gigabit Ethernet controller (rev 07) 03:00.0 Network controller: Qualcomm Atheros AR9485 Wireless Network Adapter (rev 01)</code></pre></div><p>lspci -n</p><div class="codebox"><pre><code>00:00.0 0600: 8086:0154 (rev 09) 00:01.0 0604: 8086:0151 (rev 09) 00:02.0 0300: 8086:0166 (rev 09) 00:14.0 0c03: 8086:1e31 (rev 04) 00:16.0 0780: 8086:1e3a (rev 04) 00:1a.0 0c03: 8086:1e2d (rev 04) 00:1b.0 0403: 8086:1e20 (rev 04) 00:1c.0 0604: 8086:1e10 (rev c4) 00:1c.1 0604: 8086:1e12 (rev c4) 00:1d.0 0c03: 8086:1e26 (rev 04) 00:1f.0 0601: 8086:1e59 (rev 04) 00:1f.2 0106: 8086:1e03 (rev 04) 00:1f.3 0c05: 8086:1e22 (rev 04) 01:00.0 0300: 10de:0de9 (rev a1) 02:00.0 0200: 10ec:8168 (rev 07) 03:00.0 0280: 168c:0032 (rev 01)</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><em>&quot;...dear cinnamon tear...&quot;</em></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356314">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356322" class="blockpost roweven"> <h2><span><span class="conr">#854</span> <a href="viewtopic.php?pid=1356322#p1356322">2013-12-03 17:21:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abarahc wrote:</cite><blockquote><div><p>@aw</p><p>Thanks so much to reply so fast!</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It means you don&#039;t have VT-d support.&#160; Make sure it&#039;s enabled in you BIOS and make sure you&#039;re booting with intel_iommu=on</p></div></blockquote></div><p>the &quot;intel_iommu=on&quot; is set as parameter on kernel boot line!</p><div class="codebox"><pre><code>linux /boot/vmlinuz-linux root=UUID=aaed6a49-c921-463c-bc9b-a22b74a6ee4e rw quiet intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0de9,8086:1e20</code></pre></div><p>but i cant find anything about this on my notebook BIOS! (Asus K45VM). This probably means i dont have support to remapping, right? <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p></div></blockquote></div><p>According to Asus, the CPUs available for this laptop are:</p><p>Intel® Core™ i7 3610QM Processor<br />Intel® Core™ i5 3210M Processor<br />Intel® Core™ i3 3110M Processor</p><p>Cross referencing these to <a href="http://ark.intel.com" rel="nofollow">http://ark.intel.com</a>, you do not have VT-d (assuming the rPGA version of 3210M).&#160; Full stop, you can&#039;t do device assignment.&#160; But the good news is that it probably would not have worked anyway.&#160; Secondary graphics devices built into laptops are extremely customized to the device, often requiring vendor specific drivers.&#160; I have not heard of any cases of these working when assigned to a VM.&#160; Folks here that are having success are using fully independent discrete graphics cards.&#160; Sorry.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356322">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356324" class="blockpost rowodd"> <h2><span><span class="conr">#855</span> <a href="viewtopic.php?pid=1356324#p1356324">2013-12-03 17:23:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=36563">abarahc</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/36563.jpg?m=1333804461" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2010-04-30</span></dd> <dd><span>Posts: 118</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=36563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>abarahc wrote:</cite><blockquote><div><p>@aw</p><p>Thanks so much to reply so fast!</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It means you don&#039;t have VT-d support.&#160; Make sure it&#039;s enabled in you BIOS and make sure you&#039;re booting with intel_iommu=on</p></div></blockquote></div><p>the &quot;intel_iommu=on&quot; is set as parameter on kernel boot line!</p><div class="codebox"><pre><code>linux /boot/vmlinuz-linux root=UUID=aaed6a49-c921-463c-bc9b-a22b74a6ee4e rw quiet intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:0de9,8086:1e20</code></pre></div><p>but i cant find anything about this on my notebook BIOS! (Asus K45VM). This probably means i dont have support to remapping, right? <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p></div></blockquote></div><p>According to Asus, the CPUs available for this laptop are:</p><p>Intel® Core™ i7 3610QM Processor<br />Intel® Core™ i5 3210M Processor<br />Intel® Core™ i3 3110M Processor</p><p>Cross referencing these to <a href="http://ark.intel.com" rel="nofollow">http://ark.intel.com</a>, you do not have VT-d (assuming the rPGA version of 3210M).&#160; Full stop, you can&#039;t do device assignment.&#160; But the good news is that it probably would not have worked anyway.&#160; Secondary graphics devices built into laptops are extremely customized to the device, often requiring vendor specific drivers.&#160; I have not heard of any cases of these working when assigned to a VM.&#160; Folks here that are having success are using fully independent discrete graphics cards.&#160; Sorry.</p></div></blockquote></div><p>Ok buddy :&#039;/<br />Thank you very much for the explanatiion.</p> </div> <div class="postsignature postmsg"><hr /><p><em>&quot;...dear cinnamon tear...&quot;</em></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356324">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356326" class="blockpost roweven"> <h2><span><span class="conr">#856</span> <a href="viewtopic.php?pid=1356326#p1356326">2013-12-03 17:30:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>AW thank you for your replies. You actually answered one of my questions as well in this. I have also an Opteron system Tyan S8225 with dual 4234 CPUs on it. From what I have been reading it appears to support IOMMU (and the option also called SVVM) is enabled in the bios. I presume this would support VGA passthrough? Its obvious my intel setup doesnt :*( But least there is hope. Can you confirm if this is the case?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356326">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356329" class="blockpost rowodd"> <h2><span><span class="conr">#857</span> <a href="viewtopic.php?pid=1356329#p1356329">2013-12-03 17:36:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>AW thank you for your replies. You actually answered one of my questions as well in this. I have also an Opteron system Tyan S8225 with dual 4234 CPUs on it. From what I have been reading it appears to support IOMMU (and the option also called SVVM) is enabled in the bios. I presume this would support VGA passthrough? Its obvious my intel setup doesnt :*( But least there is hope. Can you confirm if this is the case?</p></div></blockquote></div><p>The DMAR and intel_iommu=on tips are Intel specific.&#160; On AMD the IOMMU is described by the IVRS table in ACPI instead of the DMAR, AMD calls this AMD-Vi.&#160; The equivalent boot option is amd_iommu=on.&#160; SVM is the processor level virtualization technology, you can verify this with &#039;grep svm /proc/cpuinfo&#039; (vmx is the equivalent Intel flag).&#160; Unfortunately AMD doesn&#039;t have a convenient reference page for checking CPU and chipset features like Intel does with ark.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356329">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356330" class="blockpost roweven"> <h2><span><span class="conr">#858</span> <a href="viewtopic.php?pid=1356330#p1356330">2013-12-03 17:39:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Real GRID cards report the same Code 12 on the q35 chipset model, try 440fx instead.&#160; I can&#039;t figure out what resources it&#039;s missing, nor have I had time to experiment.&#160; Linux guests will work fine on the q35 model.&#160; Again, you&#039;re not going to get pre-boot VGA output unless the VBIOS matches the hardware.&#160; Also, Nvidia does not support GRID in a VGA mode, it&#039;s only supported as a secondary device to emulated VGA.&#160; The professional version of the drivers detect that they&#039;re running on a VM and behave differently.&#160; The quirks enabled with x-vga=on do not work correctly with those drivers.</p></div></blockquote></div><p>Thanks for the suggestions!</p><p>I downloaded BIOS from GPU using GPU-Z, patched device ID, updated the CRC, added romfile=/path/to/rom/file to options for VGA portion of GPU, still no luck with output to monitors on VM start. All I get in kern.log is:</p><div class="codebox"><pre><code>Dec 3 21:29:33 cave-lin kernel: [ 286.128960] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Dec 3 21:30:10 cave-lin kernel: [ 324.069324] kvm: zapping shadow pages for mmio generation wraparound Dec 3 21:30:10 cave-lin kernel: [ 324.106954] vfio-pci 0000:01:00.0: irq 57 for MSI/MSI-X</code></pre></div><p>Also I have tried running VM with FX440 chipset, but it doesnt seem to have pcie bus, so no luck starting VM at all:</p><div class="codebox"><pre><code>kalujny@cave-lin:~$ sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu SandyBridge -smp 3,sockets=1,cores=3,threads=1 -bios /opt/kalujny/kernel/seabios/out/bios.bin -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,romfile=/opt/kalujny/thrash/PNYGTX6802GB_GRIDK2.rom -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device ahci,bus=pcie.0,id=ahci -drive file=/opt/kalujny/thrash/windows.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk -usbdevice tablet qemu-system-x86_64: -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1: Bus &#039;pcie.0&#039; not found </code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356330">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356333" class="blockpost rowodd"> <h2><span><span class="conr">#859</span> <a href="viewtopic.php?pid=1356333#p1356333">2013-12-03 17:46:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Real GRID cards report the same Code 12 on the q35 chipset model, try 440fx instead.&#160; I can&#039;t figure out what resources it&#039;s missing, nor have I had time to experiment.&#160; Linux guests will work fine on the q35 model.&#160; Again, you&#039;re not going to get pre-boot VGA output unless the VBIOS matches the hardware.&#160; Also, Nvidia does not support GRID in a VGA mode, it&#039;s only supported as a secondary device to emulated VGA.&#160; The professional version of the drivers detect that they&#039;re running on a VM and behave differently.&#160; The quirks enabled with x-vga=on do not work correctly with those drivers.</p></div></blockquote></div><p>Thanks for the suggestions!</p><p>I downloaded BIOS from GPU using GPU-Z, patched device ID, updated the CRC, added romfile=/path/to/rom/file to options for VGA portion of GPU, still no luck with output to monitors on VM start. All I get in kern.log is:</p><div class="codebox"><pre><code>Dec 3 21:29:33 cave-lin kernel: [ 286.128960] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Dec 3 21:30:10 cave-lin kernel: [ 324.069324] kvm: zapping shadow pages for mmio generation wraparound Dec 3 21:30:10 cave-lin kernel: [ 324.106954] vfio-pci 0000:01:00.0: irq 57 for MSI/MSI-X</code></pre></div><p>Also I have tried running VM with FX440 chipset, but it doesnt seem to have pcie bus, so no luck starting VM at all:</p><div class="codebox"><pre><code>kalujny@cave-lin:~$ sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu SandyBridge -smp 3,sockets=1,cores=3,threads=1 -bios /opt/kalujny/kernel/seabios/out/bios.bin -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,romfile=/opt/kalujny/thrash/PNYGTX6802GB_GRIDK2.rom -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device ahci,bus=pcie.0,id=ahci -drive file=/opt/kalujny/thrash/windows.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk -usbdevice tablet qemu-system-x86_64: -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1: Bus &#039;pcie.0&#039; not found </code></pre></div></div></blockquote></div><p>Root ports (ioh3420) are incompatible with 44fx, the device needs to be placed on the host bridge (pci.0) which is the default if not specified.&#160; Try something like this:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu SandyBridge -smp 3,sockets=1,cores=3,threads=1 -bios /opt/kalujny/kernel/seabios/out/bios.bin \ -device vfio-pci,host=01:00.0,addr=07.0,multifunction=on,romfile=/opt/kalujny/thrash/PNYGTX6802GB_GRIDK2.rom -device vfio-pci,host=01:00.1,addr=07.1 \ -drive file=/opt/kalujny/thrash/windows.img,if=none,id=disk,format=raw -device ide-hd,bus=ide.0,unit=0,drive=disk -usbdevice tablet </code></pre></div><p>(I chose device address 7, move it if you want)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356333">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356334" class="blockpost roweven"> <h2><span><span class="conr">#860</span> <a href="viewtopic.php?pid=1356334#p1356334">2013-12-03 17:48:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>AW thank you for your replies. You actually answered one of my questions as well in this. I have also an Opteron system Tyan S8225 with dual 4234 CPUs on it. From what I have been reading it appears to support IOMMU (and the option also called SVVM) is enabled in the bios. I presume this would support VGA passthrough? Its obvious my intel setup doesnt :*( But least there is hope. Can you confirm if this is the case?</p></div></blockquote></div><p>The DMAR and intel_iommu=on tips are Intel specific.&#160; On AMD the IOMMU is described by the IVRS table in ACPI instead of the DMAR, AMD calls this AMD-Vi.&#160; The equivalent boot option is amd_iommu=on.&#160; SVM is the processor level virtualization technology, you can verify this with &#039;grep svm /proc/cpuinfo&#039; (vmx is the equivalent Intel flag).&#160; Unfortunately AMD doesn&#039;t have a convenient reference page for checking CPU and chipset features like Intel does with ark.</p></div></blockquote></div><p>Well in regards to my intel server system you answered my questions so thats appreciated. I also have an AMD opteron setup as well. So at least I have hope to make VGA passthrough work on something lol. </p><p>No they don&#039;t but wikipedia is a decent alternative. Here is a page I found for Opterons. At least AMD-V is clearly supported on the valencias (4200 series) and my board does support IOMMU. I guess I will give it a go and see what happens. Thanks again. <br /><a href="https://en.wikipedia.org/wiki/List_of_AMD_Opteron_microprocessors#Opteron_4200-series_.22Valencia.22_.2832_nm.29" rel="nofollow">https://en.wikipedia.org/wiki/List_of_A … 2832_nm.29</a></p> <p class="postedit"><em>Last edited by paradexes (2013-12-03 17:49:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356336" class="blockpost rowodd"> <h2><span><span class="conr">#861</span> <a href="viewtopic.php?pid=1356336#p1356336">2013-12-03 17:56:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>AW thank you for your replies. You actually answered one of my questions as well in this. I have also an Opteron system Tyan S8225 with dual 4234 CPUs on it. From what I have been reading it appears to support IOMMU (and the option also called SVVM) is enabled in the bios. I presume this would support VGA passthrough? Its obvious my intel setup doesnt :*( But least there is hope. Can you confirm if this is the case?</p></div></blockquote></div><p>The DMAR and intel_iommu=on tips are Intel specific.&#160; On AMD the IOMMU is described by the IVRS table in ACPI instead of the DMAR, AMD calls this AMD-Vi.&#160; The equivalent boot option is amd_iommu=on.&#160; SVM is the processor level virtualization technology, you can verify this with &#039;grep svm /proc/cpuinfo&#039; (vmx is the equivalent Intel flag).&#160; Unfortunately AMD doesn&#039;t have a convenient reference page for checking CPU and chipset features like Intel does with ark.</p></div></blockquote></div><p>Well in regards to my intel server system you answered my questions so thats appreciated. I also have an AMD opteron setup as well. So at least I have hope to make VGA passthrough work on something lol. </p><p>No they don&#039;t but wikipedia is a decent alternative. Here is a page I found for Opterons. At least AMD-V is clearly supported on the valencias (4200 series) and my board does support IOMMU. I guess I will give it a go and see what happens. Thanks again. <br /><a href="https://en.wikipedia.org/wiki/List_of_AMD_Opteron_microprocessors#Opteron_4200-series_.22Valencia.22_.2832_nm.29" rel="nofollow">https://en.wikipedia.org/wiki/List_of_A … 2832_nm.29</a></p></div></blockquote></div><p>I&#039;m sorry to say that I will be incredibly surprised if it has AMD IOMMU (AMD-Vi) support.&#160; AMD-V (no i) is the CPU virtualization, aka SVM.&#160; AFAIK the RD870 (maybe 890) was the first AMD-IOMMU chipset.&#160; Most people using AMD for device assignment are using an 970/990.&#160; Note that documentation and BIOS for AMD system can be very confusing because they&#039;ll refer to the onboard GART as an IOMMU.&#160; While originally intended for graphics, it became a general purpose IOMMU for many system.&#160; Unfortunately to support device assignment we need an IOMMU capable of both translation and isolation, the GART only has translation.&#160; Furthermore, I believe it&#039;s a window based IOMMU rather than page table based, so even if you wanted to forego isolation, it doesn&#039;t even support the model we use for device assignment.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356336">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356481" class="blockpost roweven"> <h2><span><span class="conr">#862</span> <a href="viewtopic.php?pid=1356481#p1356481">2013-12-04 04:09:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77297">paradexes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-30</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77297">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The DMAR and intel_iommu=on tips are Intel specific.&#160; On AMD the IOMMU is described by the IVRS table in ACPI instead of the DMAR, AMD calls this AMD-Vi.&#160; The equivalent boot option is amd_iommu=on.&#160; SVM is the processor level virtualization technology, you can verify this with &#039;grep svm /proc/cpuinfo&#039; (vmx is the equivalent Intel flag).&#160; Unfortunately AMD doesn&#039;t have a convenient reference page for checking CPU and chipset features like Intel does with ark.</p></div></blockquote></div><p>Well in regards to my intel server system you answered my questions so thats appreciated. I also have an AMD opteron setup as well. So at least I have hope to make VGA passthrough work on something lol. </p><p>No they don&#039;t but wikipedia is a decent alternative. Here is a page I found for Opterons. At least AMD-V is clearly supported on the valencias (4200 series) and my board does support IOMMU. I guess I will give it a go and see what happens. Thanks again. <br /><a href="https://en.wikipedia.org/wiki/List_of_AMD_Opteron_microprocessors#Opteron_4200-series_.22Valencia.22_.2832_nm.29" rel="nofollow">https://en.wikipedia.org/wiki/List_of_A … 2832_nm.29</a></p></div></blockquote></div><p>I&#039;m sorry to say that I will be incredibly surprised if it has AMD IOMMU (AMD-Vi) support.&#160; AMD-V (no i) is the CPU virtualization, aka SVM.&#160; AFAIK the RD870 (maybe 890) was the first AMD-IOMMU chipset.&#160; Most people using AMD for device assignment are using an 970/990.&#160; Note that documentation and BIOS for AMD system can be very confusing because they&#039;ll refer to the onboard GART as an IOMMU.&#160; While originally intended for graphics, it became a general purpose IOMMU for many system.&#160; Unfortunately to support device assignment we need an IOMMU capable of both translation and isolation, the GART only has translation.&#160; Furthermore, I believe it&#039;s a window based IOMMU rather than page table based, so even if you wanted to forego isolation, it doesn&#039;t even support the model we use for device assignment.</p></div></blockquote></div><br /><p>Well this is interesting. AMD-Vi IS IOMMU. Least according to this wiki, I think I might be good here.&#160; The chipset for the board is reported to be working for VGA passthrough in xen. I would imagine the same would apply here. <br /><a href="http://en.wikipedia.org/wiki/X86_virtualization" rel="nofollow">http://en.wikipedia.org/wiki/X86_virtualization</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356481">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1356501" class="blockpost rowodd"> <h2><span><span class="conr">#863</span> <a href="viewtopic.php?pid=1356501#p1356501">2013-12-04 05:23:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>paradexes wrote:</cite><blockquote><div><p>Well in regards to my intel server system you answered my questions so thats appreciated. I also have an AMD opteron setup as well. So at least I have hope to make VGA passthrough work on something lol. </p><p>No they don&#039;t but wikipedia is a decent alternative. Here is a page I found for Opterons. At least AMD-V is clearly supported on the valencias (4200 series) and my board does support IOMMU. I guess I will give it a go and see what happens. Thanks again. <br /><a href="https://en.wikipedia.org/wiki/List_of_AMD_Opteron_microprocessors#Opteron_4200-series_.22Valencia.22_.2832_nm.29" rel="nofollow">https://en.wikipedia.org/wiki/List_of_A … 2832_nm.29</a></p></div></blockquote></div><p>I&#039;m sorry to say that I will be incredibly surprised if it has AMD IOMMU (AMD-Vi) support.&#160; AMD-V (no i) is the CPU virtualization, aka SVM.&#160; AFAIK the RD870 (maybe 890) was the first AMD-IOMMU chipset.&#160; Most people using AMD for device assignment are using an 970/990.&#160; Note that documentation and BIOS for AMD system can be very confusing because they&#039;ll refer to the onboard GART as an IOMMU.&#160; While originally intended for graphics, it became a general purpose IOMMU for many system.&#160; Unfortunately to support device assignment we need an IOMMU capable of both translation and isolation, the GART only has translation.&#160; Furthermore, I believe it&#039;s a window based IOMMU rather than page table based, so even if you wanted to forego isolation, it doesn&#039;t even support the model we use for device assignment.</p></div></blockquote></div><br /><p>Well this is interesting. AMD-Vi IS IOMMU. Least according to this wiki, I think I might be good here.&#160; The chipset for the board is reported to be working for VGA passthrough in xen. I would imagine the same would apply here. <br /><a href="http://en.wikipedia.org/wiki/X86_virtualization" rel="nofollow">http://en.wikipedia.org/wiki/X86_virtualization</a></p></div></blockquote></div><p>Found this page - <a href="http://www.amd.com/us/products/server/processors/Pages/amd-platform-specifications.aspx" rel="nofollow">http://www.amd.com/us/products/server/p … tions.aspx</a></p><p>And here <a href="http://en.wikipedia.org/wiki/AMD_800_chipset_series" rel="nofollow">http://en.wikipedia.org/wiki/AMD_800_chipset_series</a> indicates that the SR5690 is a rebranding of the RD890, so I agree, you should be good.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1356501">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1357007" class="blockpost roweven"> <h2><span><span class="conr">#864</span> <a href="viewtopic.php?pid=1357007#p1357007">2013-12-05 14:33:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77441">nivs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-05</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:klad-mv@mail.ru">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;d try to passthrough GTX780 with i7-4771 CPU and Z78 chipset, but got &quot;Invalid ROM contents&quot; in dmesg and 43 or 12 error in windows. Kernel and qemu from first post.</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=b011c3ab-e015-4d13-b5d8-afd54b708603 rw max_loop=64 intel_iommu=on pci-stub.ids=10de:1004,10de:0e1a vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><div class="codebox"><pre><code># zcat /proc/config.gz| grep -i vfio 22:05 pts/2 CONFIG_VFIO_IOMMU_TYPE1=y CONFIG_VFIO=y CONFIG_VFIO_PCI=y CONFIG_VFIO_PCI_VGA=y</code></pre></div><p>Win 7 x64 and win 8 x64 were installed. Host GPU is Intel, but now it&#039;s off, cable connect to GTX 780, i see terminals. All work do in vncserver from notebook or SSH connection with &quot;-nographic -monitor stdio&quot;. When i run this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 2048 -cpu host -smp 3,sockets=1,cores=3,threads=1 -bios /usr/share/qemu/bios.bin -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=0000:01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/var/lib/libvirt/images/780.rom -device vfio-pci,host=0000:01:00.1,bus=root.1,addr=00.1 -device ahci,id=ahci0,bus=pcie.0,addr=0x5 -device virtio-serial-pci,id=virtio-serial0,bus=pcie.0,addr=0x6 -drive file=/var/lib/libvirt/images/windVirt7.img,if=none,id=drive-sata0-0-0,format=qcow2,cache=none -device ide-hd,bus=ahci0.0,drive=drive-sata0-0-0,id=sata0-0-0,bootindex=1 -drive file=/var/lib/libvirt/images/ru_7x64.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=2 -net nic -net bridge,br=xenbr0</code></pre></div><p>in dmesg appers this:</p><div class="codebox"><pre><code>[ 1175.295251] device tap0 entered promiscuous mode [ 1175.295332] xenbr0: port 2(tap0) entered forwarding state [ 1175.295335] xenbr0: port 2(tap0) entered forwarding state [ 1175.919638] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 1175.919685] vfio-pci 0000:01:00.0: Invalid ROM contents [ 1175.954591] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0xf0000000-0xf1ffffff 64bit pref] [ 1179.035148] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p> With -vga none this: <a href="http://pastebin.com/MPJnUY3a" rel="nofollow">http://pastebin.com/MPJnUY3a</a><br />And in terminal:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,addr=07.0,multifunction=on,romfile=/var/lib/libvirt/images/780.rom: Warning, device 0000:01:00.0 does not support reset qemu-system-x86_64: -device vfio-pci,host=01:00.0,addr=07.0,multifunction=on,romfile=/var/lib/libvirt/images/780.rom: VFIO 0000:01:00.0 BAR 3 mmap unsupported. Performance may be slow qemu-system-x86_64: -device vfio-pci,host=01:00.1,addr=07.1: Warning, device 0000:01:00.1 does not support reset</code></pre></div><p>With </p><div class="codebox"><pre><code>#!/bin/bash qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu SandyBridge -smp 3,sockets=1,cores=3,threads=1 -bios /usr/share/qemu/bios.bin \ -device vfio-pci,host=01:00.0,addr=07.0,multifunction=on,romfile=/var/lib/libvirt/images/780.rom -device vfio-pci,host=01:00.1,addr=07.1 \ -drive file=/var/lib/libvirt/images/virt.img,if=none,id=disk,format=raw -device ide-hd,bus=ide.0,unit=0,drive=disk -usbdevice tablet -vga none</code></pre></div><p> i also get this. What should I do to make it finally work? I&#039;m doing it for 4 days, with Xen also didn&#039;t work. If i wait about 40 sec with -vga none, in monitor (GTX 780) appeard this <a href="http://f-bit.ru/uploads/297542.jpg" rel="nofollow">http://f-bit.ru/uploads/297542.jpg</a>. 40 sec is time to select &quot;repair&quot; in menu. MB&#039;s BIOS up to date, GTX&#039;s BIOS too.</p><p>5-10 minutes after the start in the terminal there was a lot of messages:</p><div class="codebox"><pre><code>qemu-system-x86_64: vfio_bar_write(,0x12ffc, 0x0, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x98, 0xbffa41, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x9c, 0x0, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x13000, 0xabcdabcd, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x13004, 0xabcdabcd, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x13008, 0xabcdabcd, 4) failed: Device or resource busy qemu-system-x86_64: vfio_bar_write(,0x1300c, 0xabcdabcd, 4) failed: Device or resource busy</code></pre></div><p>With qemu debug:</p><div class="codebox"><pre><code>&lt;4&gt;[ 108.175567] vfio-pci 0000:01:00.0: BAR 3: can&#039;t reserve [mem 0xf0000000-0xf1ffffff 64bit pref] &lt;2&gt;[ 110.177869] ERROR: DMA PTE for vPFN 0x0 already set (to 416bc3003 not 403400083)</code></pre></div><p>or</p><div class="codebox"><pre class="vscroll"><code>&lt;3&gt;[ 89.103901] irq 16: nobody cared (try booting with the &quot;irqpoll&quot; option) &lt;4&gt;[ 89.106576] CPU: 0 PID: 0 Comm: swapper/0 Tainted: G WC 3.12.0-1-mainline #1 &lt;4&gt;[ 89.106577] Hardware name: Gigabyte Technology Co., Ltd. Z87M-HD3/Z87M-HD3, BIOS F7 08/03/2013 &lt;4&gt;[ 89.106578] ffff88042841d68c ffff88043f203e48 ffffffff814f5a4b ffff88042841d600 &lt;4&gt;[ 89.106580] ffff88043f203e70 ffffffff810b8e22 ffff88042841d600 0000000000000010 &lt;4&gt;[ 89.106581] 0000000000000000 ffff88043f203eb0 ffffffff810b9248 ffffffff813d4402 &lt;4&gt;[ 89.106583] Call Trace: &lt;4&gt;[ 89.106584] &lt;IRQ&gt; [&lt;ffffffff814f5a4b&gt;] dump_stack+0x54/0x8d &lt;4&gt;[ 89.106591] [&lt;ffffffff810b8e22&gt;] __report_bad_irq+0x32/0xd0 &lt;4&gt;[ 89.106593] [&lt;ffffffff810b9248&gt;] note_interrupt+0x138/0x1f0 &lt;4&gt;[ 89.106596] [&lt;ffffffff813d4402&gt;] ? cpuidle_enter_state+0x52/0xc0 &lt;4&gt;[ 89.106598] [&lt;ffffffff810b6c39&gt;] handle_irq_event_percpu+0xf9/0x250 &lt;4&gt;[ 89.106599] [&lt;ffffffff810b6dcd&gt;] handle_irq_event+0x3d/0x60 &lt;4&gt;[ 89.106601] [&lt;ffffffff810b9dba&gt;] handle_fasteoi_irq+0x5a/0x100 &lt;4&gt;[ 89.106605] [&lt;ffffffff81016b0e&gt;] handle_irq+0x1e/0x30 &lt;4&gt;[ 89.106607] [&lt;ffffffff8150690d&gt;] do_IRQ+0x4d/0xc0 &lt;4&gt;[ 89.106609] [&lt;ffffffff814fcfed&gt;] common_interrupt+0x6d/0x6d &lt;4&gt;[ 89.106610] &lt;EOI&gt; [&lt;ffffffff813d4402&gt;] ? cpuidle_enter_state+0x52/0xc0 &lt;4&gt;[ 89.106613] [&lt;ffffffff813d43f8&gt;] ? cpuidle_enter_state+0x48/0xc0 &lt;4&gt;[ 89.106614] [&lt;ffffffff813d4537&gt;] cpuidle_idle_call+0xc7/0x280 &lt;4&gt;[ 89.106616] [&lt;ffffffff8101e30e&gt;] arch_cpu_idle+0xe/0x30 &lt;4&gt;[ 89.106617] [&lt;ffffffff810b6207&gt;] cpu_startup_entry+0x267/0x2e0 &lt;4&gt;[ 89.106620] [&lt;ffffffff814e8254&gt;] rest_init+0x84/0x90 &lt;4&gt;[ 89.106621] [&lt;ffffffff818e2f01&gt;] start_kernel+0x414/0x420 &lt;4&gt;[ 89.106622] [&lt;ffffffff818e28f6&gt;] ? repair_env_string+0x5c/0x5c &lt;4&gt;[ 89.106624] [&lt;ffffffff818e2120&gt;] ? early_idt_handlers+0x120/0x120 &lt;4&gt;[ 89.106625] [&lt;ffffffff818e25de&gt;] x86_64_start_reservations+0x2a/0x2c &lt;4&gt;[ 89.106626] [&lt;ffffffff818e26e8&gt;] x86_64_start_kernel+0x108/0x117 &lt;3&gt;[ 89.106627] handlers: &lt;3&gt;[ 89.107536] [&lt;ffffffffa0056ae0&gt;] usb_hcd_irq [usbcore] &lt;3&gt;[ 89.109648] [&lt;ffffffff813b23f0&gt;] vfio_intx_handler &lt;0&gt;[ 89.111623] Disabling IRQ #16</code></pre></div><p>P.S.: sorry for my English.</p> <p class="postedit"><em>Last edited by nivs (2013-12-05 23:40:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1357007">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1357277" class="blockpost rowodd"> <h2><span><span class="conr">#865</span> <a href="viewtopic.php?pid=1357277#p1357277">2013-12-06 05:43:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69703">keatsfonam</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-28</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>EDIT:<br />Solved the error 43 with AW&#039;s current qemu-vfio.&#160; Im having the reboot issue still, working on that.&#160; Thanks for all the great info in this thread.</p><p>EDIT2:</p><p>All problems solved by avoiding letting vfio-pci take the device from pci-stub upon starting the vm with the script provided.&#160; Thanks</p><p>------</p><br /><p>Similiar situation as previous poster, can&#039;t get past error 43:</p><p>all my hardware supports VT-d<br />I am trying to run host on my intel integrated (ivy bridge) but I see that the i915 driver has caused problems.&#160; I tried running the guest before X even and still couldn&#039;t get past the problem.</p><p>For the record I am trying to pass through an nvidia gtx 560</p><p>dmesg | grep -e IOMMU -e DMAR</p><div class="codebox"><pre><code>[ 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA [ 0.000000] ACPI: DMAR 00000000be0f4c60 000B8 (v01 INTEL SNB 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.077767] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a [ 0.077771] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a [ 0.077851] IOAPIC id 2 under DRHD base 0xfed91000 IOMMU 1 [ 0.254226] DMAR: No ATSR found [ 0.254249] IOMMU 0 0xfed90000: using Queued invalidation [ 0.254250] IOMMU 1 0xfed91000: using Queued invalidation [ 0.254251] IOMMU: Setting RMRR: [ 0.254260] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf800000 - 0xcf9fffff] [ 0.255421] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdb64000 - 0xbdb8efff] [ 0.255438] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdb64000 - 0xbdb8efff] [ 0.255451] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdb64000 - 0xbdb8efff] [ 0.255459] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.255465] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</code></pre></div><br /><p>/proc/cmdline:</p><div class="codebox"><pre><code>BOOT_IMAGE=../vmlinuz-linux-mainline root=UUID=0ff525e8-6238-4741-a5f3-dec5653ebd14 ro intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=10de:1201,10de:0e0c initrd=../initramfs-linux-mainline.img</code></pre></div><p>and tried:</p><div class="codebox"><pre><code>BOOT_IMAGE=../vmlinuz-linux-mainline root=UUID=0ff525e8-6238-4741-a5f3-dec5653ebd14 ro intel_iommu=on initrd=../initramfs-linux-mainline.img</code></pre></div><br /><p>uname -r</p><div class="codebox"><pre><code>3.12.0-1-mainline</code></pre></div><p>tried with the three packages on the first post with the same kconfig<br />tried both qemu-git and linux-mainline from aur, same problem.</p><p>I can boot into windows 7 or windows 8 guest but I get the error 43.&#160; Additionally I cannot reboot or it will lock up the host system.&#160; I tried the patch that aw said fixes the error 43, but it still doesn&#039;t seem to work.</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 2048 -cpu host -smp 6,sockets=1,cores=2,threads=1 -bios /usr/share/qemu/bios.bin -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.0 -boot once=d,menu=on -drive file=/home/me/win7.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd -drive file=/home/me/images/win7.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk -device vfio-pci,host=01:00.0,bus=root.0,addr=00.0,multifunction=on,x-vga=on -vga none -usbdevice host:1532:010b -usbdevice host:046d:c00c</code></pre></div><p>I have tried -cpu IvyBridge</p><p>dmesg:</p><div class="codebox"><pre><code> 8.119274] [drm] Initialized drm 1.1.0 20060810 [ 8.127061] [drm] Memory usable by graphics device = 2048M [ 8.127065] i915 0000:00:02.0: setting latency timer to 64 [ 8.146428] i915 0000:00:02.0: irq 62 for MSI/MSI-X [ 8.146440] [drm] Supports vblank timestamp caching Rev 1 (10.10.2010). [ 8.146442] [drm] Driver supports precise vblank timestamp query. [ 8.167917] [drm] Wrong MCH_SSKPD value: 0x20100406 [ 8.167920] [drm] This can cause pipe underruns and display issues. [ 8.167921] [drm] Please upgrade your BIOS to fix this. [ 8.266493] [drm] GMBUS [i915 gmbus dpc] timed out, falling back to bit banging on pin 4 [ 8.277615] fbcon: inteldrmfb (fb0) is primary device [ 8.277752] Console: switching to colour frame buffer device 210x65 [ 8.277762] i915 0000:00:02.0: fb0: inteldrmfb frame buffer device [ 8.277764] i915 0000:00:02.0: registered panic notifier [ 8.277768] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io [ 8.282909] acpi device:43: registered as cooling_device4 [ 8.283082] ACPI: Video Device [GFX0] (multi-head: yes rom: no post: no) [ 8.283130] input: Video Bus as /devices/LNXSYSTM:00/device:00/PNP0A08:00/LNXVIDEO:00/input/input8 [ 8.283204] [drm] Initialized i915 1.6.0 20080730 for 0000:00:02.0 on minor 0 [ 8.442675] vfio-pci 0000:01:00.0: Invalid ROM contents [ 9.775993] [drm] Enabling RC6 states: RC6 on, RC6p on, RC6pp off [ 19.912534] xenbr0: port 1(enp4s0) entered forwarding state</code></pre></div><p>I think the invalid ROM contents is the key error here, but I might be wrong.<br />I&#039;m not sure if MCH_SSKPD is relevant.<br />I dumped my rom and tried to load it and it gave me all sorts of errors about invalid commands and locked up my host system completely forcing a reboot.</p><div class="codebox"><pre><code>dma: command 78 not supported dma: command 78 not supported</code></pre></div><p>And a slew of similiar command not supported messages until I kill the process</p><div class="codebox"><pre><code>dma: command 8c not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: command 5c not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: command 5c not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: command 58 not supported dma: command 58 not supported dma: command 84 not supported dma: command 60 not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: command 4c not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: command 4c not supported dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769 dma: unregistered DMA channel used nchan=0 dma_pos=0 dma_len=64769</code></pre></div><br /><p>When I start the VM:</p><div class="codebox"><pre><code>[ 1513.598793] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 1516.405951] usb 2-1.5: reset full-speed USB device number 3 using ehci-pci [ 1516.745059] usb 3-2: reset low-speed USB device number 2 using xhci_hcd [ 1516.758317] xhci_hcd 0000:00:14.0: xHCI xhci_drop_endpoint called with disabled ep ffff880417f98a00 [ 1516.758331] usb 3-2: ep 0x81 - rounding interval to 64 microframes, ep desc says 80 microframes</code></pre></div><p>The usb and xhci_hcd are spammed 5 or 6 more times, but it seems like the vfio-pci has no error message.&#160; <br />However I saw some other user&#039;s dmesgs that said</p><div class="codebox"><pre><code>assign device 0:X:0.0</code></pre></div><p>Which is missing from mine.&#160; Does that mean the device isn&#039;t actually getting assigned?</p><p>I&#039;m not sure if the problem stems for qemu or from linux-mainline, so I keep trying different combinations with no luck.<br />Any help is appreciated, I suspect I may be better off with a radeon card.</p> <p class="postedit"><em>Last edited by keatsfonam (2013-12-07 09:29:02)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1357277">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1357801" class="blockpost roweven"> <h2><span><span class="conr">#866</span> <a href="viewtopic.php?pid=1357801#p1357801">2013-12-07 18:41:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=65509">jackun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-11-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=65509">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m dual booting and sometimes messing with passthrough and having a dual input monitor, it was getting tiresome to switch monitor&#039;s input. So one way to use a gfxcard for passthrough without setting another card to be primary is to force off any FB consoles with kernel argument <strong>&#039;vga=0&#039;</strong> and then manually (create a systemd service or something) use <strong>fbset</strong> and <strong>con2fb</strong>. Default low res text-only bios console should be still working.</p><p>You can get con2fb source from <a href="http://www.dafyddcrosby.com/src/con2fb.c" rel="nofollow">http://www.dafyddcrosby.com/src/con2fb.c</a><br />So:</p><div class="codebox"><pre><code>cat /proc/fb</code></pre></div><p>to see that only one fb is setup (probably radeondrmfb or something).</p><p>Then with working kms driver and 1920x1080 monitor:</p><div class="codebox"><pre><code>fbset /dev/fb0 -xres 1920 -vxres 1920 -yres 1080 -vyres 1080 #initializes framebuffer and wakes up monitor (??) con2fb /dev/fb0 /dev/tty1 #map ttys to framebuffer. Even though only tty1 is passed, it seems all ttys are move to fb0</code></pre></div><p>Now you can see bios etc. stuff still on your (probably) more powerful card and use it in windows and still use it with passthrough too.<br />Ofcourse pci-stub etc. the gfxcard you intend to use for passthrough.</p><p>Now the question, can you unbind kernel&#039;s VGA console without &#039;vga=0&#039; ? Then &#039;fbcon=map:1&#039; could be enough probably.</p> <p class="postedit"><em>Last edited by jackun (2013-12-07 23:24:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1357801">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1357851" class="blockpost rowodd"> <h2><span><span class="conr">#867</span> <a href="viewtopic.php?pid=1357851#p1357851">2013-12-07 21:11:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>keatsfonam wrote:</cite><blockquote><div><p>EDIT2:</p><p>All problems solved by avoiding letting vfio-pci take the device from pci-stub upon starting the vm with the script provided.&#160; Thanks</p></div></blockquote></div><p>What exactly does that mean?</p><p>BTW, as of this morning everything except i915 vga arbiter stuff is in upstream, kernel and qemu.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1357851">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1357929" class="blockpost roweven"> <h2><span><span class="conr">#868</span> <a href="viewtopic.php?pid=1357929#p1357929">2013-12-08 02:58:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does anyone know of a way to monitor CPU temperature from within the guest and output it to an OSD program like RTSS? Proper cpu statistics would also be really nice.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1357929">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358014" class="blockpost rowodd"> <h2><span><span class="conr">#869</span> <a href="viewtopic.php?pid=1358014#p1358014">2013-12-08 11:33:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=24756">Damon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Germany</span></dd> <dd><span>Registered: 2009-04-09</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=24756">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to pass a SATA controller of my Supermicro X10SAE to the guest.</p><p>Kernel: 3.12.3 with acs-override patch.</p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 --version QEMU emulator version 1.7.50, Copyright (c) 2003-2008 Fabrice Bellard</code></pre></div><div class="codebox"><pre><code>$ dmesg | grep -e DMAR -e IOMMU [ 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA [ 0.000000] ACPI: DMAR 00000000d9508dd0 000B8 (v01 INTEL HSW 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.025640] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a [ 0.025644] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008020660462 ecap f010da [ 0.025710] IOAPIC id 2 under DRHD base 0xfed91000 IOMMU 1 [ 0.430025] DMAR: No ATSR found [ 0.430050] IOMMU 0 0xfed90000: using Queued invalidation [ 0.430051] IOMMU 1 0xfed91000: using Queued invalidation [ 0.430053] IOMMU: Setting RMRR: [ 0.430062] IOMMU: Setting identity map for device 0000:00:02.0 [0xdc000000 - 0xde1fffff] [ 0.430254] IOMMU: Setting identity map for device 0000:00:1d.0 [0xd9ea8000 - 0xd9eb6fff] [ 0.430276] IOMMU: Setting identity map for device 0000:00:1a.0 [0xd9ea8000 - 0xd9eb6fff] [ 0.430295] IOMMU: Setting identity map for device 0000:00:14.0 [0xd9ea8000 - 0xd9eb6fff] [ 0.430309] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.430315] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</code></pre></div><div class="codebox"><pre><code>$ cat /proc/cmdline BOOT_IMAGE=/@/boot/vmlinuz-3.12.3+ root=UUID=4a5ab603-c89c-42fb-93bb-ef541d20f32e ro rootflags=subvol=@ crashkernel=384M-2G:64M,2G-:128M splash quiet intel_iommu=on pcie_acs_override=downstream vt.handoff=7</code></pre></div><div class="codebox"><pre class="vscroll"><code>$ ./lsgroup ### Group 0 ### 00:00.0 Host bridge: Intel Corporation Xeon E3-1200 v3 Processor DRAM Controller (rev 06) ### Group 1 ### 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3 Processor Integrated Graphics Controller (rev 06) ### Group 2 ### 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) ### Group 3 ### 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 05) ### Group 4 ### 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04) 00:16.3 Serial controller: Intel Corporation 8 Series/C220 Series Chipset Family KT Controller (rev 04) ### Group 5 ### 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-LM (rev 05) ### Group 6 ### 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 05) ### Group 7 ### 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 05) ### Group 8 ### 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d5) ### Group 9 ### 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d5) ### Group 10 ### 00:1c.5 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #6 (rev d5) ### Group 11 ### 00:1c.6 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #7 (rev d5) ### Group 12 ### 00:1c.7 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #8 (rev d5) ### Group 13 ### 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 05) ### Group 14 ### 00:1f.0 ISA bridge: Intel Corporation C226 Series Chipset Family Server Advanced SKU LPC Controller (rev 05) 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 05) 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 05) 00:1f.6 Signal processing controller: Intel Corporation 8 Series Chipset Family Thermal Management Controller (rev 05) ### Group 15 ### 02:00.0 Ethernet controller: Intel Corporation I210 Gigabit Network Connection (rev 03) ### Group 16 ### 03:00.0 PCI bridge: Tundra Semiconductor Corp. Device 8113 (rev 01) 04:03.0 FireWire (IEEE 1394): Texas Instruments TSB43AB22A IEEE-1394a-2000 Controller (PHY/Link) [iOHCI-Lynx] ### Group 17 ### 05:00.0 USB controller: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller (rev 02) ### Group 18 ### 06:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)</code></pre></div><p>The device I want to pass is in the IOMMU-Group 14 </p><div class="codebox"><pre><code>00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 05)</code></pre></div><p>Therefore I bind this group to vfio-pci</p><div class="codebox"><pre><code>./vfio-group 14 0000:00:1f.0 0000:00:1f.2 0x8086 0x8c56 0x8086 0x8c02 0x8086 0x8c22 0x8086 0x8c24</code></pre></div><p>Finally I want to test if it works:</p><div class="codebox"><pre><code>$ /usr/bin/qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 6,sockets=1,cores=6,threads=1 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=00:1f.2,bus=root.1,addr=00.0 qemu-system-x86_64: vfio: Cannot reset device 0000:00:1f.2, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:1f.2, no available reset mechanism.</code></pre></div><p>I really don&#039;t know what I&#039;m doing wrong or what I have missed to do. Initially I tried to pass the controller using pci-assign but that wasn&#039;t possible due to the lack of FLReset.</p><p>I would really appreciate any help.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358014">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358057" class="blockpost roweven"> <h2><span><span class="conr">#870</span> <a href="viewtopic.php?pid=1358057#p1358057">2013-12-08 14:34:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="http://www.fileswap.com/dl/Uf24Pitlf/" rel="nofollow">linux-mainline.tar.gz (3.13-rc3, acs override patch)</a> Doesnt include i935 vga arbiter fixes<br /><a href="http://www.fileswap.com/dl/LvWAgkzGB/" rel="nofollow">qemu-git.tar.gz</a> Spice disabled due to build errors<br /><a href="http://www.fileswap.com/dl/X7oShaoShg/" rel="nofollow">seabios-git.tar.gz</a></p><p>Aur:</p><p><a href="https://aur.archlinux.org/packages/qemu-git/" rel="nofollow">https://aur.archlinux.org/packages/qemu-git/</a><br /><a href="https://aur.archlinux.org/packages/linux-mainline/" rel="nofollow">https://aur.archlinux.org/packages/linux-mainline/</a> (still -rc2 as of today)</p> <p class="postedit"><em>Last edited by nbhs (2013-12-08 14:41:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358057">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358198" class="blockpost rowodd"> <h2><span><span class="conr">#871</span> <a href="viewtopic.php?pid=1358198#p1358198">2013-12-08 20:34:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75819">alphahere</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75819">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The the i915 patch does not apply cleanly to linux-3.13-rc3. This is the request when I attempted to patch linux-3.13-rc3.</p><div class="codebox"><pre><code>patch -p1 -i ../vfio-previous/linux-mainline/i915_fixes.patch patching file drivers/gpu/drm/i915/i915_dma.c patching file drivers/gpu/drm/i915/intel_display.c Hunk #1 succeeded at 10585 (offset 544 lines). Hunk #2 succeeded at 10601 with fuzz 1 (offset 544 lines). Hunk #3 succeeded at 11105 (offset 543 lines). patching file include/linux/vgaarb.h patching file drivers/gpu/drm/i915/i915_dma.c Hunk #1 succeeded at 1355 (offset 4 lines). patching file drivers/gpu/drm/i915/intel_display.c Hunk #1 succeeded at 10585 (offset 545 lines). Hunk #2 succeeded at 10592 (offset 545 lines). Hunk #3 succeeded at 10606 with fuzz 1 (offset 545 lines). Hunk #4 succeeded at 10904 with fuzz 1 (offset 552 lines). Hunk #5 succeeded at 11110 (offset 544 lines). patching file drivers/gpu/drm/i915/intel_drv.h Hunk #1 FAILED at 792. 1 out of 1 hunk FAILED -- saving rejects to file drivers/gpu/drm/i915/intel_drv.h.rej</code></pre></div><p>I am&#160; able to pass a usb 3.0 controller to the VM but totally unable to install a driver under windows 7. Complete BSOD when installing the driver. Anyone know of a working usb 3.0 or usb 2.0 controller? I even tried passing the intel motherboard usb devices. Still could not install a driver. If there is additional information please let me know. I have no problem passing a usb device but want to pass a controller.</p><p>I think it is the controller. So much for that Black Friday special ;-). At least it was cheap. I think I will try a via usb 3.0 controller. I am looking for pci express card. If anyone has one that works please list the model. </p><p>The card I was trying to use is a Vantec Model UGT-PC312</p><p>04:00.0 USB controller: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller (rev 02) (prog-if 30 [XHCI])<br />&#160; &#160; &#160; &#160; Subsystem: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller<br />&#160; &#160; &#160; &#160; Control: I/O- Mem+ BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx-<br />&#160; &#160; &#160; &#160; Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx-<br />&#160; &#160; &#160; &#160; Interrupt: pin A routed to IRQ 18<br />&#160; &#160; &#160; &#160; Region 0: Memory at f7900000 (64-bit, non-prefetchable) [size=8K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Flags: PMEClk- DSI- D1- D2- AuxCurrent=375mA PME(D0+,D1-,D2-,D3hot+,D3cold+)<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-<br />&#160; &#160; &#160; &#160; Capabilities: [70] MSI: Enable- Count=1/8 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Address: 0000000000000000&#160; Data: 0000<br />&#160; &#160; &#160; &#160; Capabilities: [90] MSI-X: Enable- Count=8 Masked-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Vector table: BAR=0 offset=00001000<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; PBA: BAR=0 offset=00001080<br />&#160; &#160; &#160; &#160; Capabilities: [a0] Express (v2) Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s unlimited, L1 unlimited<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ExtTag- AttnBtn- AttnInd- PwrInd- RBE+ FLReset-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop+<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MaxPayload 128 bytes, MaxReadReq 512 bytes<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr+ TransPend-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LnkCap: Port #0, Speed 5GT/s, Width x1, ASPM L0s L1, Latency L0 &lt;4us, L1 unlimited<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ClockPM+ Surprise- LLActRep- BwNot-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk+<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LnkSta: Speed 5GT/s, Width x1, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; DevCap2: Completion Timeout: Not Supported, TimeoutDis+<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LnkCtl2: Target Link Speed: 5GT/s, EnterCompliance- SpeedDis-, Selectable De-emphasis: -6dB<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Compliance De-emphasis: -6dB<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete-, EqualizationPhase1-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest-<br />&#160; &#160; &#160; &#160; Capabilities: [100 v1] Advanced Error Reporting<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; UESta:&#160; DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; UEMsk:&#160; DLP- SDES- TLP- FCP- CmpltTO- CmpltAbrt- UnxCmplt- RxOF- MalfTLP- ECRC- UnsupReq- ACSViol-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; UESvrt: DLP+ SDES+ TLP- FCP+ CmpltTO- CmpltAbrt- UnxCmplt- RxOF+ MalfTLP+ ECRC- UnsupReq- ACSViol-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; CESta:&#160; RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; CEMsk:&#160; RxErr- BadTLP- BadDLLP- Rollover- Timeout- NonFatalErr-<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; AERCap: First Error Pointer: 00, GenCap- CGenEn- ChkCap- ChkEn-<br />&#160; &#160; &#160; &#160; Capabilities: [150 v1] Latency Tolerance Reporting<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Max snoop latency: 0ns<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Max no snoop latency: 0ns<br />&#160; &#160; &#160; &#160; Kernel driver in use: vfio-pci</p><p>Thanks.</p> <p class="postedit"><em>Last edited by alphahere (2013-12-09 03:18:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358198">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358266" class="blockpost roweven"> <h2><span><span class="conr">#872</span> <a href="viewtopic.php?pid=1358266#p1358266">2013-12-08 23:57:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59131">binaryplease</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-11</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59131">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I cant get pass the step from unbinding step. Everytime i execute the script or do </p><div class="codebox"><pre><code>echo &quot;0000:02:00.0&quot; &gt; /sys/bus/pci/devices/0000:02:00.0/driver/unbind</code></pre></div><p>my system freezes and i have to switch it of holding the power button.</p><p>I have a lenovo y500 with two geforce gt650m cards (SLI). <br />Im using the nouveau driver. Can anyone help?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358266">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358345" class="blockpost rowodd"> <h2><span><span class="conr">#873</span> <a href="viewtopic.php?pid=1358345#p1358345">2013-12-09 05:24:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=24068">dalingrin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2009-03-18</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=24068">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone tried passing through 2 cards in SLI?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358345">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358538" class="blockpost roweven"> <h2><span><span class="conr">#874</span> <a href="viewtopic.php?pid=1358538#p1358538">2013-12-09 18:37:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alphahere wrote:</cite><blockquote><div><p>I am&#160; able to pass a usb 3.0 controller to the VM but totally unable to install a driver under windows 7. Complete BSOD when installing the driver. Anyone know of a working usb 3.0 or usb 2.0 controller? I even tried passing the intel motherboard usb devices. Still could not install a driver. If there is additional information please let me know. I have no problem passing a usb device but want to pass a controller.</p><p>I think it is the controller. So much for that Black Friday special ;-). At least it was cheap. I think I will try a via usb 3.0 controller. I am looking for pci express card. If anyone has one that works please list the model. </p><p>The card I was trying to use is a Vantec Model UGT-PC312</p><p>04:00.0 USB controller: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller (rev 02) (prog-if 30 [XHCI])</p></div></blockquote></div><p>I bought one (because my onboard Etron controllers cause BSOD in Win7 when trying to install the driver).<br />The one I got works absolutely perfect in both Win 7 and 8.1, it&#039;s a</p><div class="codebox"><pre><code>05:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03) (prog-if 30 [XHCI])</code></pre></div><p>/me hides, giggeling.</p> <p class="postedit"><em>Last edited by teekay (2013-12-09 18:38:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358538">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1358565" class="blockpost rowodd"> <h2><span><span class="conr">#875</span> <a href="viewtopic.php?pid=1358565#p1358565">2013-12-09 19:58:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77556">peaquino</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-09</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77556">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all!</p><p>I think I read all the posts in this long thread, but unfortunatelly I&#039;m still not able to passthrough my Radeon 7870XT to a Windows 7 VM. My other components are:<br />- AMD APU A10-5800K (with Radeon 7660D acting as primary VGA)<br />- Asrock A85 FM2A85X Extreme6<br />- 16G RAM</p><div class="codebox"><pre><code>lspci</code></pre></div><div class="quotebox"><blockquote><div><p>00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Root Complex<br />00:00.2 IOMMU: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) I/O Memory Management Unit<br />00:01.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Trinity [Radeon HD 7660D]<br />00:02.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Root Port<br />00:03.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Root Port<br />00:10.0 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB XHCI Controller (rev 03)<br />00:10.1 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB XHCI Controller (rev 03)<br />00:11.0 SATA controller: Advanced Micro Devices, Inc. [AMD] FCH SATA Controller [AHCI mode] (rev 40)<br />00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller (rev 11)<br />00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB EHCI Controller (rev 11)<br />00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller (rev 11)<br />00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB EHCI Controller (rev 11)<br />00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller (rev 14)<br />00:14.1 IDE interface: Advanced Micro Devices, Inc. [AMD] FCH IDE Controller<br />00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD] FCH Azalia Controller (rev 01)<br />00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge (rev 11)<br />00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD] FCH PCI Bridge (rev 40)<br />00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD] FCH USB OHCI Controller (rev 11)<br />00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD] Hudson PCI to PCI bridge (PCIE port 0)<br />00:15.2 PCI bridge: Advanced Micro Devices, Inc. [AMD] Hudson PCI to PCI bridge (PCIE port 2)<br />00:15.3 PCI bridge: Advanced Micro Devices, Inc. [AMD] Hudson PCI to PCI bridge (PCIE port 3)<br />00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 0<br />00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 1<br />00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 2<br />00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 3<br />00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 4<br />00:18.5 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h (Models 10h-1fh) Processor Function 5<br />01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti LE [Radeon HD 7870 XT]<br />01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series]<br />02:00.0 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.1 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.2 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.3 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.4 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.5 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.6 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />02:00.7 USB controller: MosChip Semiconductor Technology Ltd. MCS9990 PCIe to 4‐Port USB 2.0 Host Controller<br />05:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller<br />06:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168 PCI Express Gigabit Ethernet controller (rev 06)</p></div></blockquote></div><p>I&#039;m using linux-mainline, qemu and seabios from the first page of the thread. </p><p>According to dmesg, the board properly activates IOMMU, and the 7870 is properly bound to pci-stub:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/arch/vmlinuz-linux-mainline root=UUID=c25d5a87-40b9-4a3d-89db-3e263ff8b839 rw quiet pci-stub.ids=1002:679e,1002:aaa0 radeon.dpm=1 radeon.fastfb=1 iommu=pt</p></div></blockquote></div><div class="codebox"><pre><code>dmesg | grep AMD-Vi</code></pre></div><div class="quotebox"><blockquote><div><p>[&#160; &#160; 1.139471] AMD-Vi: Found IOMMU at 0000:00:00.2 cap 0x40<br />[&#160; &#160; 1.139472] AMD-Vi:&#160; Extended features:&#160; PreF PPR GT IA<br />[&#160; &#160; 1.139475] AMD-Vi: Interrupt remapping enabled<br />[&#160; &#160; 1.139647] AMD-Vi: Initialized for Passthrough Mode</p></div></blockquote></div><div class="codebox"><pre><code>dmesg | grep pci-stub</code></pre></div><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/arch/vmlinuz-linux-mainline root=UUID=c25d5a87-40b9-4a3d-89db-3e263ff8b839 rw quiet pci-stub.ids=1002:679e,1002:aaa0 radeon.dpm=1 radeon.fastfb=1 iommu=pt<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/arch/vmlinuz-linux-mainline root=UUID=c25d5a87-40b9-4a3d-89db-3e263ff8b839 rw quiet pci-stub.ids=1002:679e,1002:aaa0 radeon.dpm=1 radeon.fastfb=1 iommu=pt<br />[&#160; &#160; 1.175368] pci-stub: add 1002:679E sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 1.175380] pci-stub 0000:01:00.0: claimed by stub<br />[&#160; &#160; 1.175389] pci-stub: add 1002:AAA0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 1.175395] pci-stub 0000:01:00.1: claimed by stub</p></div></blockquote></div><p>I&#039;m trying to run the VM with the following script:</p><div class="codebox"><pre><code>#!/bin/bash QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64 -enable-kvm -cpu qemu64 -M q35 -m 8192 \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin \ -vga none \ -monitor stdio \ -nographic \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/dev/bcache/by-uuid/d79f9dd0-c884-42f7-b5a9-79db832ea9d0,id=disk,format=raw \ -device ide-hd,bus=ahci.0,drive=disk \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/home/myuser/Tahiti.rom \ -device vfio-pci,host=01:00.1,bus=pcie.0,multifunction=on \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -usb -usbdevice host:04fc:05d8 \ -boot menu=on</code></pre></div><p>I can see the BIOS output and Windows starting animation on the monitor connected to the Radeon, but as soon as Catalyst tries to initialize the card, I get a BSOD with atikmpag.sys 116 error. <br />Additionally, after Seabios initializes the 7870, the color palette in Gnome running on the 7660D is totally messed up (I can to post a photo of the screen, if that could be any help). Qemu monitor is not showing any errors, but I get<br />the follwing entries in journal:</p><div class="quotebox"><blockquote><div><p>[ 2204.807168] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003)<br />[ 2204.831486] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x270<br />[ 2204.831500] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1b@0x2d0<br />[ 2204.873898] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002)<br />[ 2246.082840] kvm: zapping shadow pages for mmio generation wraparound<br />[ 2248.441789] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc000 flags=0x0010]<br />[ 2248.441798] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc800 flags=0x0010]<br />[ 2248.441801] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc800 flags=0x0030]<br />[ 2248.441803] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc800 flags=0x0010]<br />[ 2248.441805] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc810 flags=0x0030]<br />[ 2248.441807] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc800 flags=0x0010]<br />[ 2248.441809] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.1 domain=0x0002 address=0x00000000857fc810 flags=0x0030]</p></div></blockquote></div><p>I tried every workaround I could find, nothing seems to work. <br />About 7 months ago I was able to passthrough on the same hardware using Xen 4.1 (but I abandoned this setup beacause of problems with card resets and host hangs on Windows reboots, I wasn&#039;t aware of the dev eject hack then).</p><p>I hope I&#039;m just being stupid and overlooked something obvious. If not, what motherboard and processor would you recommend me to replace my APU setup?</p><p>Thanks for all pointers!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1358565">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=34">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=33">33</a> <a href="viewtopic.php?id=162768&amp;p=34">34</a> <strong>35</strong> <a href="viewtopic.php?id=162768&amp;p=36">36</a> <a href="viewtopic.php?id=162768&amp;p=37">37</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=36">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
