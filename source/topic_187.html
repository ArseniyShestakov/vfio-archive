<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 187) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=187" title="Page 187" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=186" title="Page 186" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=188" title="Page 188" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=186">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=185">185</a> <a href="viewtopic.php?id=162768&amp;p=186">186</a> <strong>187</strong> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=188">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1515368" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4651</span> <a href="viewtopic.php?pid=1515368#p1515368">2015-03-30 03:08:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Tried that, window does BSOD with error 7b, remove the device and it works again.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515371" class="blockpost roweven"> <h2><span><span class="conr">#4652</span> <a href="viewtopic.php?pid=1515371#p1515371">2015-03-30 03:20:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>Tried that, window does BSOD with error 7b, remove the device and it works again.</p></div></blockquote></div><p>this one? <a href="https://msdn.microsoft.com/en-us/library/windows/hardware/ff559218%28v=vs.85%29.aspx" rel="nofollow">https://msdn.microsoft.com/en-us/librar … 85%29.aspx</a>, weird, works for me on 8.1</p><div class="codebox"><pre><code>-device nec-usb-xhci,id=xhci -device usb-host,vendorid=0x046e,productid=0x530a,bus=xhci.0</code></pre></div> <p class="postedit"><em>Last edited by nbhs (2015-03-30 03:21:12)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515371">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515388" class="blockpost rowodd"> <h2><span><span class="conr">#4653</span> <a href="viewtopic.php?pid=1515388#p1515388">2015-03-30 07:44:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87624">Chaohong Hu</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-29</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:huchh2012@163.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is that possible to passthrough graphic card on a laptop? My laptop has a intel igd and a nvidia card.</p><p>If the answer is tricky or just impossible, please tell me why.</p><p>If some special laptops support passthrough, what is the features?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515388">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515397" class="blockpost roweven"> <h2><span><span class="conr">#4654</span> <a href="viewtopic.php?pid=1515397#p1515397">2015-03-30 08:46:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chaohong Hu wrote:</cite><blockquote><div><p>Is that possible to passthrough graphic card on a laptop? My laptop has a intel igd and a nvidia card.</p><p>If the answer is tricky or just impossible, please tell me why.</p><p>If some special laptops support passthrough, what is the features?</p></div></blockquote></div><p>Interessting Question. Speaking from my experience gathered last Weekend with a desktop workstation I would say: Maybe!</p><p>It should be possible in theory but 3 things must allign for that to happen:<br />Intel CPU supports VT-d (i.e. i7 4500U)<br />Chipset supports VT-d (i.e. QM87)<br />and probably the most troubling:<br />The provided BIOS must support that option too ...</p><p>I would imagine 2 points of that list troublesome:<br />I pretty much never see what chipset is used in the product description.<br />The BIOS is pretty much never mentioned or looked at in tests and reviews, so without thinking too much about it I would say this could be a frustrating try and error phase ...</p><p>But this is just me talking. Have no practical experience. Never tried ...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515397">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515417" class="blockpost rowodd"> <h2><span><span class="conr">#4655</span> <a href="viewtopic.php?pid=1515417#p1515417">2015-03-30 11:48:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89614">tholin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m thinking about upgrading my Radeon HD 6770 to something more powerful. I don&#039;t like nvidia so the cards I&#039;m considering with good price performance ratio are the following.<br />Radeon R9 270X<br />Radeon R9 285<br />Radeon R9 280<br />Any pros or cons to using any of them? Can anyone confirm that they work? What about the reset problem?</p><p>A new patch went into kernel 4.0 to work around the reset problem but it requires a switch between the cards and the root hub. My 16x lanes connect to some PLX PEX 8747 switches before the CPU root port so reset shouldn&#039;t be a problem for me?</p><p>I see that Powercolor, MSI and Sapphire got official UEFI GOP support lists for their cards but what about the other manufacturers? I can&#039;t find any lists, just speculations on forums.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515417">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515426" class="blockpost roweven"> <h2><span><span class="conr">#4656</span> <a href="viewtopic.php?pid=1515426#p1515426">2015-03-30 13:04:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>I&#039;m thinking about upgrading my Radeon HD 6770 to something more powerful. I don&#039;t like nvidia so the cards I&#039;m considering with good price performance ratio are the following.<br />Radeon R9 270X<br />Radeon R9 285<br />Radeon R9 280<br />Any pros or cons to using any of them? Can anyone confirm that they work? What about the reset problem?</p><p>A new patch went into kernel 4.0 to work around the reset problem but it requires a switch between the cards and the root hub. My 16x lanes connect to some PLX PEX 8747 switches before the CPU root port so reset shouldn&#039;t be a problem for me?</p><p>I see that Powercolor, MSI and Sapphire got official UEFI GOP support lists for their cards but what about the other manufacturers? I can&#039;t find any lists, just speculations on forums.</p></div></blockquote></div><p>I&#039;ve heard that R9 285 is based on a new chip(so it&#039;s not rebadged 7xxx series card) and shouldn&#039;t have reset problems.<br />Aaand try preferring MSI or Powercolor or somebody else, because saphhire have some problems with UEFI too. Basically, if your card doesn&#039;t support UEFI natively, out of the box, then you have high chances of not getting it to work.</p><p>For stats you can check out that huge google spreadsheet from the op-post, but remember the &quot;old&quot; names of rebadged cards(i.e. 270x is 7970 if i recall properly).</p><div class="quotebox"><cite>Chaohong Hu wrote:</cite><blockquote><div><p>Is that possible to passthrough graphic card on a laptop? My laptop has a intel igd and a nvidia card.</p><p>If the answer is tricky or just impossible, please tell me why.</p><p>If some special laptops support passthrough, what is the features?</p></div></blockquote></div><p>Well, some notebooks(i&#039;ve stumbled with lenovo myself) may have weird nvidia optimus technology, which broke everything up. The laptop that i&#039;ve observed had unknown header 7f in lspci when the nvidia card is offline, and NoSoftRst+ when the card is online. Hell, that machine even couldn&#039;t go to STR and back without having that card broken. I highly doubt that VFIO will work on that setup.</p><p>Second problem is video output! As you might know, all video outputs, including the screen itself, are switched between intel and discrete gpu. How does that switch works - almost nobody knows, because it is a highly proprietary stuff. Ask guys with bumblebee, there are problems of getting it to work just like it&#039;s supposed to work. This problem applies to intel-amd(WORST COMBINATION EVER, hello rare hybrid drivers) and amd-amd notebooks too.</p><p>You can construct or buy and external pci-e 16x slot in kind of dock-station way, connecting it somewhere like pcmcia or inside to mini-pci-e or somewhere else, and plug a desktop GPU. That way it should work good, but you&#039;ll need too connect an external screen to it, or try fiddling with nvidia optimus(or some alike from AMD).</p><br /><p>Conclusion: I wouldn&#039;t even bother. We have problems on desktops, and you&#039;re bringing a whole new opportunity to suffer from proprietary hardware&amp;software.</p><p>P.S. I&#039;m not sure if AMD-NVIDIA notebooks even exist on this planet. And it&#039;s not some eurocom notebooks, which are whatever you want.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-30 13:07:42)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515426">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515437" class="blockpost rowodd"> <h2><span><span class="conr">#4657</span> <a href="viewtopic.php?pid=1515437#p1515437">2015-03-30 14:42:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>A new patch went into kernel 4.0 to work around the reset problem but it requires a switch between the cards and the root hub.</p></div></blockquote></div><p>What patch is this?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515442" class="blockpost roweven"> <h2><span><span class="conr">#4658</span> <a href="viewtopic.php?pid=1515442#p1515442">2015-03-30 15:23:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89614">tholin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>A new patch went into kernel 4.0 to work around the reset problem but it requires a switch between the cards and the root hub.</p></div></blockquote></div><p>What patch is this?</p></div></blockquote></div><p>Well, you wrote it.</p><p>commit d84f31744643e2c439466d513ebc1bc81c4d9186<br />Author: Alex Williamson &lt;alex.williamson@redhat.com&gt;<br />Date:&#160; &#160;Fri Nov 21 11:24:14 2014 -0700</p><p><em>PCI: Mark AMD/ATI VGA devices that don&#039;t reset on D3hot-&gt;D0 transition</p><p>Some AMD/ATI GPUs report NoSoftRst- to indicate that they perform a reset<br />when software transitions them from D3hot to D0, but there is no apparent<br />effect on the device: the monitor remains synced and the framebuffer<br />contents are retained.</em></p><p><em>Callers of pci_reset_function() don&#039;t necessarily have a way to validate<br />whether a reset was effective, so we don&#039;t want to rely on NoSoftRst if<br />it&#039;s known to be inaccurate.&#160; Returning an error in such cases appears to<br />be the better option.&#160; For users like vfio-pci, this allows the driver to<br />escalate to the bus reset interfaces.</em></p><p><em>If a device lives on the root bus, there&#039;s really no further<br />escalation path, so we exempt PM reset as potentially better than<br />nothing.<br /></em></p><div class="codebox"><pre class="vscroll"><code>diff --git a/drivers/pci/quirks.c b/drivers/pci/quirks.c index e52356a..31e7972 100644 --- a/drivers/pci/quirks.c +++ b/drivers/pci/quirks.c @@ -3042,6 +3042,27 @@ static void quirk_no_bus_reset(struct pci_dev *dev) */ DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_ATHEROS, 0x0030, quirk_no_bus_reset); +static void quirk_no_pm_reset(struct pci_dev *dev) +{ + /1 /bin /boot /cdrom /dev /etc /home /initrd.img /initrd.img.old /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /ubiquity-apt-clone /usr /var /vmlinuz /vmlinuz.old /win81-base.qcow2 /win81-base.qcow2.md5 /win81-writable-amd.qcow2 /win81-writable-nvidia.qcow2 /win81-writable-nvidia.qcow2.backup + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html We can&#039;t do a bus reset on root bus devices, but an ineffective + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html PM reset may be better than nothing. + */ + if (!pci_is_root_bus(dev-&gt;bus)) + dev-&gt;dev_flags |= PCI_DEV_FLAGS_NO_PM_RESET; +} + +/* + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html Some AMD/ATI GPUS (HD8570 - Oland) report that a D3hot-&gt;D0 transition + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html causes a reset (i.e., they advertise NoSoftRst-). This transition seems + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html to have no effect on the device: it retains the framebuffer contents and + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html monitor sync. Advertising this support makes other layers, like VFIO, + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html assume pci_reset_function() is viable for this device. Mark it as + 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html unavailable to skip it when testing reset methods. + */ +DECLARE_PCI_FIXUP_CLASS_HEADER(PCI_VENDOR_ID_ATI, PCI_ANY_ID, + PCI_CLASS_DISPLAY_VGA, 8, quirk_no_pm_reset); +</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515442">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515445" class="blockpost rowodd"> <h2><span><span class="conr">#4659</span> <a href="viewtopic.php?pid=1515445#p1515445">2015-03-30 15:47:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>A new patch went into kernel 4.0 to work around the reset problem but it requires a switch between the cards and the root hub.</p></div></blockquote></div><p>What patch is this?</p></div></blockquote></div><p>Well, you wrote it.</p><p>commit d84f31744643e2c439466d513ebc1bc81c4d9186</p></div></blockquote></div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515445">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515461" class="blockpost roweven"> <h2><span><span class="conr">#4660</span> <a href="viewtopic.php?pid=1515461#p1515461">2015-03-30 16:56:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89614">tholin</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p></div></blockquote></div><p>That&#039;s disappointing. Which cards are affected? Just the Bonaire XT (HD7790) or all the GCN 1.1 based cards? Are the GCN 1.2 based R9 285 unaffected like Duelist suggested?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515461">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515464" class="blockpost rowodd"> <h2><span><span class="conr">#4661</span> <a href="viewtopic.php?pid=1515464#p1515464">2015-03-30 17:08:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p></div></blockquote></div><p>That&#039;s disappointing. Which cards are affected? Just the Bonaire XT (HD7790) or all the GCN 1.1 based cards? Are the GCN 1.2 based R9 285 unaffected like Duelist suggested?</p></div></blockquote></div><p>Dunno</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515464">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515465" class="blockpost roweven"> <h2><span><span class="conr">#4662</span> <a href="viewtopic.php?pid=1515465#p1515465">2015-03-30 17:08:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>What patch is this?</p></div></blockquote></div><p>Well, you wrote it.</p><p>commit d84f31744643e2c439466d513ebc1bc81c4d9186</p></div></blockquote></div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p></div></blockquote></div><p>Huh? The behaviour you&#039;ve described i&#039;ve observed on HD7750 when i force-off&#039;d the guest machine. I thought it was logical for it to behave like that. Like, the machine is killed, and the device is left in the last state it was.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515465">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515489" class="blockpost rowodd"> <h2><span><span class="conr">#4663</span> <a href="viewtopic.php?pid=1515489#p1515489">2015-03-30 18:18:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>tholin wrote:</cite><blockquote><div><p>Well, you wrote it.</p><p>commit d84f31744643e2c439466d513ebc1bc81c4d9186</p></div></blockquote></div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p></div></blockquote></div><p>Huh? The behaviour you&#039;ve described i&#039;ve observed on HD7750 when i force-off&#039;d the guest machine. I thought it was logical for it to behave like that. Like, the machine is killed, and the device is left in the last state it was.</p></div></blockquote></div><p>It might be useful for debugging, but it&#039;s not intended.&#160; We really want to return the device to the host in a similar state that we received it.&#160; It&#039;s also nice that the monitor will turn off if the VM isn&#039;t running.&#160; Not to mention that the data in the framebuffer is guest state that we shouldn&#039;t just leave laying around if we can help it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515489">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515511" class="blockpost roweven"> <h2><span><span class="conr">#4664</span> <a href="viewtopic.php?pid=1515511#p1515511">2015-03-30 19:43:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yep, that&#039;s the one I was afraid you were looking at.&#160; This is only a fix for a limited number of devices that expose that they do a reset on transition from D3hot to D0.&#160; My HD8570 is one such card.&#160; It mostly makes the finishing reset-on-close work so the screen turns off rather than leaving the last image displayed by the guest.&#160; This does not fix the reset problem on cards like the HD7790 or various R7/9 cards that can&#039;t even manage to reboot the guest within the same instance of the VM.&#160; We still do not have a solution for that reset problem.</p></div></blockquote></div><p>Huh? The behaviour you&#039;ve described i&#039;ve observed on HD7750 when i force-off&#039;d the guest machine. I thought it was logical for it to behave like that. Like, the machine is killed, and the device is left in the last state it was.</p></div></blockquote></div><p>It might be useful for debugging, but it&#039;s not intended.&#160; We really want to return the device to the host in a similar state that we received it.&#160; It&#039;s also nice that the monitor will turn off if the VM isn&#039;t running.&#160; Not to mention that the data in the framebuffer is guest state that we shouldn&#039;t just leave laying around if we can help it.</p></div></blockquote></div><p>Okay, i know that this feature is good, but you&#039;ve said &quot;only for selected devices&quot;. But reading the patch seems like every ATI device will be reset. Is it true? If so - that&#039;s neat.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515511">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515516" class="blockpost rowodd"> <h2><span><span class="conr">#4665</span> <a href="viewtopic.php?pid=1515516#p1515516">2015-03-30 20:03:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Okay, i know that this feature is good, but you&#039;ve said &quot;only for selected devices&quot;. But reading the patch seems like every ATI device will be reset. Is it true? If so - that&#039;s neat.</p></div></blockquote></div><p>We&#039;ve been resetting devices as they&#039;re released for a while (v3.17), it&#039;s not AMD specific.&#160; What we&#039;re doing in this commit is simply blacklisting PM reset for the small population of AMD GPUs that claim to support it (NoSoftRst-).&#160; Most GPUs, AMD or otherwise, do not claim to support PM reset, so there&#039;s no change.&#160; When there are no function-level resets available for a device, the device remains tagged as dirty and when vfio-pci has the opportunity to do a bus reset, it will.&#160; For this to work, all of the devices affected by a bus reset need to be bound to vfio-pci.&#160; For instance, if you don&#039;t assign the audio function to the VM and leave it bound to pci-stub, this would be a reason to bind it to vfio-pci instead.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515610" class="blockpost roweven"> <h2><span><span class="conr">#4666</span> <a href="viewtopic.php?pid=1515610#p1515610">2015-03-31 01:50:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Okay, i know that this feature is good, but you&#039;ve said &quot;only for selected devices&quot;. But reading the patch seems like every ATI device will be reset. Is it true? If so - that&#039;s neat.</p></div></blockquote></div><p>We&#039;ve been resetting devices as they&#039;re released for a while (v3.17), it&#039;s not AMD specific.&#160; What we&#039;re doing in this commit is simply blacklisting PM reset for the small population of AMD GPUs that claim to support it (NoSoftRst-).&#160; Most GPUs, AMD or otherwise, do not claim to support PM reset, so there&#039;s no change.&#160; When there are no function-level resets available for a device, the device remains tagged as dirty and when vfio-pci has the opportunity to do a bus reset, it will.&#160; For this to work, all of the devices affected by a bus reset need to be bound to vfio-pci.&#160; For instance, if you don&#039;t assign the audio function to the VM and leave it bound to pci-stub, this would be a reason to bind it to vfio-pci instead.</p></div></blockquote></div><p>Thanks for clarification. Aaand my GPU is affected by this patch, it reports NoSoftRst- but doesn&#039;t reset. Well, half a year waiting untill 4.0 will be released..</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515610">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515612" class="blockpost rowodd"> <h2><span><span class="conr">#4667</span> <a href="viewtopic.php?pid=1515612#p1515612">2015-03-31 01:53:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89764">syshack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-24</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:syshack@me.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>syshack wrote:</cite><blockquote><div><div class="quotebox"><cite>syshack wrote:</cite><blockquote><div><p>i&#039;v filed a bugzia,pls check,thx. ( <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1206006)" rel="nofollow">https://bugzilla.redhat.com/show_bug.cgi?id=1206006)</a><br />if need more details,let me know and i will provid as soon as possible.</p></div></blockquote></div><p>im sorry ，i make a stupid mistake. the fails caused by power shortage.</p></div></blockquote></div><p>Glad you got it working</p></div></blockquote></div><p>Thank you and erganzi!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515613" class="blockpost roweven"> <h2><span><span class="conr">#4668</span> <a href="viewtopic.php?pid=1515613#p1515613">2015-03-31 01:59:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=59241">tritron4</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-04-14</span></dd> <dd><span>Posts: 146</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=59241">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just received Creative Labs Sound Blaster Audigy2 ZS PCI Sound Card and I had no issues passing it to windows 8.1</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515613">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515832" class="blockpost rowodd"> <h2><span><span class="conr">#4669</span> <a href="viewtopic.php?pid=1515832#p1515832">2015-03-31 17:08:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p> ... for win7 ... although I put -smp 6, the 440fx/ovmf/Uefi version reports only two processors.</p></div></blockquote></div><p>That seems to be a limitation of Windows 7.</p><p><a href="http://en.wikipedia.org/wiki/Windows_7#Processor_limits" rel="nofollow">http://en.wikipedia.org/wiki/Windows_7#Processor_limits</a></p><p>You can try experimenting with the -smp sub-options. I think plain </p><div class="codebox"><pre><code>-smp 6</code></pre></div><p> says &quot;six single-core, single-thread processors&quot;, and that is beyond the Windows 7 limitation. Try to pass &quot;two triple-core, single-thread processors&quot; instead, with</p><div class="codebox"><pre><code>-smp sockets=2,cores=3,threads=1</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515832">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515847" class="blockpost roweven"> <h2><span><span class="conr">#4670</span> <a href="viewtopic.php?pid=1515847#p1515847">2015-03-31 17:43:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p> ... for win7 ... although I put -smp 6, the 440fx/ovmf/Uefi version reports only two processors.</p></div></blockquote></div><p>That seems to be a limitation of Windows 7.</p><p><a href="http://en.wikipedia.org/wiki/Windows_7#Processor_limits" rel="nofollow">http://en.wikipedia.org/wiki/Windows_7#Processor_limits</a></p><p>You can try experimenting with the -smp sub-options. I think plain </p><div class="codebox"><pre><code>-smp 6</code></pre></div><p> says &quot;six single-core, single-thread processors&quot;, and that is beyond the Windows 7 limitation. Try to pass &quot;two triple-core, single-thread processors&quot; instead, with</p><div class="codebox"><pre><code>-smp sockets=2,cores=3,threads=1</code></pre></div></div></blockquote></div><p>I used to have -smp 4 and it worked just fine with win7, showing four cores with one thread each in one socket. Now i have libvirt, and &quot;&lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt;&quot; and it works fine with(or without) OVMF and win7.</p><p>Also, check it out:<br /><span class="postimg"><img src="http://i.imgur.com/XHoLa2B.png" alt="windows server 2008r2 on an unknown hypervisor" /></span><br />I might be able to dig out some more info on this machine. All i know - this is a server machine, obviously.</p><p>UPD:<br />Table of testing:<br />S_C_T_Number of windows cores<br />2_2_1_4 (two sockets, two cores per socket, one thread per core, four logical cpus as seen by windows)<br />2_4_1_8<br />4_1_1_2<br />4_4_1_8</p><p><span class="bbs">Weird, as wikipedia states that the limit is one socket, not two.</span> OH. RIGHT. I&#039;ve forgot what edition of windowns i have. I should go to hell for this...</p> <p class="postedit"><em>Last edited by Duelist (2015-03-31 20:19:17)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515847">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515898" class="blockpost rowodd"> <h2><span><span class="conr">#4671</span> <a href="viewtopic.php?pid=1515898#p1515898">2015-03-31 20:46:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89947">dante82</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-31</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi there,</p><p>I finally got to the point of succeeding in passing through my graphics card using the marvelous step-by-step guide in the first comment, thanks for keeping this also updated!!!</p><p>However, I&#039;m experiencing heavy lags after installing the NVidia graphics card driver. I already tried the 340.52 version that doesn&#039;t have the error 43 issue. I don&#039;t experience these lags without the graphics driver (fallback to system drivers). I googled for that issue but couldn&#039;t find any leap to follow. Any ideas from the audience?</p><p>My setup is passing through a GeForce 750Ti on a Windows 8.1 64Bit VM with the following qemu call:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -enable-kvm -cpu host,kvm=off,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time \ -M q35 \ -m 4096 -smp 2 \ -device vfio-pci,host=01:00.0,x-vga=on \ -device vfio-pci,host=01:00.1 \ -device vfio-pci,host=03:00.0 \ -device virtio-scsi-pci,id=scsi \ -drive file=/mnt/vir-pool/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -drive file=/mnt/vir-pool/kvm-win7.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -net nic,model=virtio,macaddr=52:54:00:00:00:01 -net bridge,br=br0 \ -vnc :1 -vga none</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515905" class="blockpost roweven"> <h2><span><span class="conr">#4672</span> <a href="viewtopic.php?pid=1515905#p1515905">2015-03-31 21:02:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So somehow I managed to break it again, after it&#039;s been working great for a while.</p><p>My main graphics card (a GTX980) broke, so I sent it to RMA. In the process of de-terming what was wrong with my pc (before I found out it was the GPU), i&#039;ve reinstalled my Arch Host and switched to the linux-ovmf kernel in the AUR. I&#039;ve gotten it back yesterday and plugged everything in again. Added the correct video card (a GTX770) to pci-stub again.</p><p>lspci -nn</p><div class="codebox"><pre><code>00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection I217-V [8086:153b] (rev 05) 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM204 [GeForce GTX 980] [10de:13c0] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GM204 High Definition Audio Controller [10de:0fbb] (rev a1) 02:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 770] [10de:1184] (rev a1) 02:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1) 04:00.0 Network controller [0280]: Broadcom Corporation BCM4352 802.11ac Wireless Network Adapter [14e4:43b1] (rev 03)</code></pre></div><p>/etc/default/grub</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on pci-stub.ids=8086:153b,14e4:43b1,10de:1184,10de:0e0a&quot;</code></pre></div><p>As my motherboard has 2 ethernet slots, i&#039;ve also passthroughed(?) the ethernet adapter and the wireless adapter for Bluetooth.</p><p>To me it seems everything is correct here. However:<br />dmesg | grep pci-stub</p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux-vfio root=UUID=5ff3e9bb-e7b1-494f-8e42-6c5a1f8e7aa6 rw quiet intel_iommu=on pci-stub.ids=8086:153b,14e4:43b1,10de:1184,10de:0e0a i915.enable_hd_vgaarb=1 [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux-vfio root=UUID=5ff3e9bb-e7b1-494f-8e42-6c5a1f8e7aa6 rw quiet intel_iommu=on pci-stub.ids=8086:153b,14e4:43b1,10de:1184,10de:0e0a i915.enable_hd_vgaarb=1 [ 0.451397] pci-stub: add 8086:153B sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.451402] pci-stub 0000:00:19.0: claimed by stub [ 0.451405] pci-stub: add 14E4:43B1 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.451409] pci-stub 0000:04:00.0: claimed by stub [ 0.451411] pci-stub: add 10DE:1184 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.451415] pci-stub 0000:02:00.0: claimed by stub [ 0.451417] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.451421] pci-stub 0000:02:00.1: claimed by stub [ 3.153520] pci-stub 0000:02:00.0: enabling device (0000 -&gt; 0003)</code></pre></div><p>So everything seems correctly blocked by pci-stub, except for 02:00.0 (which is the graphics card itself, not the audio). Somehow it re-enables itself?</p><p>Also /etc/vfio-pci.cfg:</p><div class="codebox"><pre><code>DEVICES=&quot;0000:00:19.0 0000:02:00.0 0000:02:00.1 0000:04:00.0&quot;</code></pre></div><p>Now when I run the VM script it gives the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>The script:</p><div class="codebox"><pre><code>QEMU_AUDIO_DRV=pa qemu-system-x86_64 -L . -enable-kvm -m 8096 -cpu host,kvm=off -smp 6,sockets=1,cores=6,threads=1 -vga none \ -device vfio-pci,host=02:00.0,x-vga=on -device vfio-pci,host=02:00.1 -device vfio-pci,host=00:19.0 -device vfio-pci,host=04:00.0 \ -device virtio-scsi-pci,id=scsi -drive file=/dev/sdb,id=ssddisk,format=raw,if=none -device scsi-hd,drive=ssddisk \ -usb -usbdevice host:0738:2215 -usbdevice host:13d3:3404 -usbdevice host:2516:0011 -usbdevice host:1532:0033 -soundhw hda</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515905">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515907" class="blockpost rowodd"> <h2><span><span class="conr">#4673</span> <a href="viewtopic.php?pid=1515907#p1515907">2015-03-31 21:06:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Now when I run the VM script it gives the following error:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: vfio: error no iommu_group for device</code></pre></div></div></blockquote></div><p>That means the IOMMU is not enabled.&#160; Maybe it&#039;s not enabled in the kernel config.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515907">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515910" class="blockpost roweven"> <h2><span><span class="conr">#4674</span> <a href="viewtopic.php?pid=1515910#p1515910">2015-03-31 21:13:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dante82 wrote:</cite><blockquote><div><p>Hi there,</p><p>I finally got to the point of succeeding in passing through my graphics card using the marvelous step-by-step guide in the first comment, thanks for keeping this also updated!!!</p><p>However, I&#039;m experiencing heavy lags after installing the NVidia graphics card driver. I already tried the 340.52 version that doesn&#039;t have the error 43 issue. I don&#039;t experience these lags without the graphics driver (fallback to system drivers). I googled for that issue but couldn&#039;t find any leap to follow. Any ideas from the audience?</p><p>My setup is passing through a GeForce 750Ti on a Windows 8.1 64Bit VM with the following qemu call:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -enable-kvm -cpu host,kvm=off,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time \ -M q35 \ -m 4096 -smp 2 \ -device vfio-pci,host=01:00.0,x-vga=on \ -device vfio-pci,host=01:00.1 \ -device vfio-pci,host=03:00.0 \ -device virtio-scsi-pci,id=scsi \ -drive file=/mnt/vir-pool/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -drive file=/mnt/vir-pool/kvm-win7.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -net nic,model=virtio,macaddr=52:54:00:00:00:01 -net bridge,br=br0 \ -vnc :1 -vga none</code></pre></div></div></blockquote></div><p>Any messages in dmesg maybe? Like IO_PAGE_FAULT?<br />What motherboard and CPU do you have?</p><p>And, aw, wasn&#039;t there some problem with one of hyper-v extensions and nvidia?</p> <p class="postedit"><em>Last edited by Duelist (2015-03-31 21:22:34)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515910">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1515911" class="blockpost rowodd"> <h2><span><span class="conr">#4675</span> <a href="viewtopic.php?pid=1515911#p1515911">2015-03-31 21:14:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And, aw, wasn&#039;t there some problem wioth one of hyper-v extensions and nvidia?</p></div></blockquote></div><p>I didn&#039;t feel like looking it up, I assume they&#039;re using the version that detects KVM, but not Hyper-V</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1515911">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=186">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=185">185</a> <a href="viewtopic.php?id=162768&amp;p=186">186</a> <strong>187</strong> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <a href="viewtopic.php?id=162768&amp;p=189">189</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=188">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
