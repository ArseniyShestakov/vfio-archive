<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 33) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=33" title="Page 33" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=32" title="Page 32" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=34" title="Page 34" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=32">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=31">31</a> <a href="viewtopic.php?id=162768&amp;p=32">32</a> <strong>33</strong> <a href="viewtopic.php?id=162768&amp;p=34">34</a> <a href="viewtopic.php?id=162768&amp;p=35">35</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=34">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1351461" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#801</span> <a href="viewtopic.php?pid=1351461#p1351461">2013-11-19 13:08:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76766">mafferri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-11</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76766">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>juhe wrote:</cite><blockquote><div><p>Just wanted to let you know I was able to get the thing working on following HW configurations:</p><p>AMD Platform:</p><ul><li><p>Motherboard: SABERTOOTH 990FX R20 (BIOS rev. 2005)</p></li><li><p>CPU: AMD FX-8350 @4Ghz </p></li><li><p>Primary VGA: Radeon HD 5850</p></li><li><p>Secondary (passed through) VGA: Radeon HD 7870</p></li></ul><p>Intel Platform:</p><ul><li><p>Motherboard: P9X79 DELUXE (BIOS rev. 4502)</p></li><li><p>CPU: Intel i7-3930K</p></li><li><p>Primary VGA: Radeon HD 6670</p></li><li><p>Secondary (passed through) VGA: Radeon HD 7850</p></li></ul><p>Both platform have also passed one internal USB HUB for keyboard / mouse and internal Intel HDA audio for sound. Network and disk use virtio interface.</p><p>Host OS (on both machines) is Archlinux with recent stock 3.12 kernel, qemu (1.7.r29424.g964668b) and seabios (1.7.3.2) from <em>nbhs&#039;</em> first post.</p><p>AMD platform worked basically out of the box, because <em>nbhs</em> has very similar setup (chipset is the same).&#160; Intel, however, was a bit tougher to get working because of Catalyst 13.9 atikmpag.sys&#039; code 116 BSOD which was finally solved thanks to recent posts from <em>aw</em> and <em>gentoo-nut</em> by simply ommiting the HDMI Audio completely (or adding it to pcie.0 bus works as well).</p><p>I would like to Thank <em>nbhs</em>, <em>aw</em> and all you guys who share the information about setups, related issues and their solutions on this thread.&#160; I wouldn&#039;t be able to get the thing working without you :-).</p></div></blockquote></div><p>hello hda-intel will work well on the guest? to me makes strange noises and echoes</p><p>How did you pass the usb hub? because I can not even spend an entire controller usb3 -. - &#039;<br />and I have to pass individually keyboard and mouse</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1351461">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1351500" class="blockpost roweven"> <h2><span><span class="conr">#802</span> <a href="viewtopic.php?pid=1351500#p1351500">2013-11-19 14:41:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mangobot wrote:</cite><blockquote><div><p>Hey guys,</p><p>Thanks for the awesome writeup. My basic hardware is:</p><p>cpu: amd FX-6300<br />gpu: amd 7970<br />mb: ASUS M5A99FX PRO R2.0 (2005 bios)</p><p>I previously used this walkthrough to set up fully working passthrough using two graphics cards (using the 7970 as secondary and a really basic ati card as primary), but I just managed to get it working on my primary card alone, using pci_stub. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> I do see boot graphics and console output from the gfx card (I run all my monitors off of it), but when I run qemu it seems to switch over fine.<br />I hadn&#039;t seen much success with this/had heard a lot about primary passthrough not being possible, but since I&#039;m looking at it, I thought I&#039;d throw my experience into the ring. Now I have more space in my box so I can avoid the Realtek ethernet card!</p></div></blockquote></div><p>The problem with primary graphics is detaching the host drivers or making sure the host driver uses the vga arbiter.&#160; Typically if you free the primary device by blacklisting the framebuffer driver or using pci-stub then you&#039;re left with vgacon on the primary VGA.&#160; vgacon is completely unaware of VGA arbitration and writes to whatever device owns VGA routing at the time.&#160; That means you could see host console messages on the guest if the guest is in VGA mode, but even in graphics mode those writes could be corrupting the state of the device in the guest.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1351500">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1351912" class="blockpost rowodd"> <h2><span><span class="conr">#803</span> <a href="viewtopic.php?pid=1351912#p1351912">2013-11-20 17:12:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73990">juhe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-08-10</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><div class="quotebox"><cite>mafferri wrote:</cite><blockquote><div><p>hello hda-intel will work well on the guest? to me makes strange noises and echoes</p></div></blockquote></div><p>I&#039;m not sure to which system (AMD/Intel) I maintain you refer to. On Intel, it seems working fine. I didn&#039;t do extensive testing/game playing since it is a production machine at work to which I added another VGA for vfio testing (well, I couldn&#039;t resit to try it <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />). It means I didn&#039;t play a game on it, just run the &quot;Kalimba test&quot;, i.e. run the Kalimba.mp3 from Music/ folder on windows 7 and did some internet browsing while listening to the music. From the feeling and comparison with the other AMD system I&#039;m maintaining (and on which I run couple of games), the sound rarely stutters, even initial login sound seems clean. The stuttering seems more often happening on the AMD system, where I rarely get clean logon sound. However, after some time (probably when everything important gets cached in memory) it runs fine also on AMD system. BTW, thanks <em>nbhs</em> for the npt=0 parameter to kvm-amd kernel module, it really makes difference.</p><p>DPC Latency Checker seems to have lower red bars on the Intel platform, but all this is really just my current feeling (YMMV), more elaborate tests (possibly having both systems side by side, which is not that easily possible) would be necessary to compare the systems properly.</p><div class="quotebox"><cite>mafferri wrote:</cite><blockquote><div><p>How did you pass the usb hub? because I can not even spend an entire controller usb3 -. - &#039;<br />and I have to pass individually keyboard and mouse</p></div></blockquote></div><p>I pass only USB2 controller (I really meant controller in my previous post, not HUB, I am sorry for the confusion). I use these options in my qemu startup command line for Intel system (which I have currently at hand):</p><div class="codebox"><pre><code> -device vfio-pci,host=00:1a.0,bus=pcie.0,id=usb \ -device vfio-pci,host=00:1b.0,bus=pcie.0,id=snd \</code></pre></div><div class="codebox"><pre><code>$ lspci | grep 1[ab]\.0 00:1a.0 USB controller: Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #2 (rev 06) 00:1b.0 Audio device: Intel Corporation C600/X79 series chipset High Definition Audio Controller (rev 06)</code></pre></div><p>And both devices get to their own group, thanksfully, even without ACS patch. The lsgroup.sh used below is <em>aw</em>&#039;s script stolen from one of his previous post and added &quot;.sh&quot; extension.</p><div class="codebox"><pre><code>$ ./lsgroup.sh | grep -C1 1[ab]\.0 ### Group 9 ### 00:1a.0 USB controller: Intel Corporation C600/X79 series chipset USB2 Enhanced Host Controller #2 (rev 06) ### Group 10 ### 00:1b.0 Audio device: Intel Corporation C600/X79 series chipset High Definition Audio Controller (rev 06) ### Group 11 ###</code></pre></div><p>I use a wireless keyboard and mouse with a single USB transmitter/receiver, which occupies one USB port.</p><p>HTH</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1351912">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352045" class="blockpost roweven"> <h2><span><span class="conr">#804</span> <a href="viewtopic.php?pid=1352045#p1352045">2013-11-20 23:40:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys. With the latest kernel and patches I finally managed to get it working! ...kinda.</p><p>I can&#039;t pass my usb 3.0 controller for some reason. It simply won&#039;t work. I can try to find another controller that works, but I really wanted it to be this one. For now I passed my usb keyboard and mouse only, but I need either the controller or my HUB (which I also can&#039;t pass).</p><p>The second problem is that it can&#039;t stand a reboot. If I try to reboot it will get stuck on a screen with the seabios version.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352045">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352191" class="blockpost rowodd"> <h2><span><span class="conr">#805</span> <a href="viewtopic.php?pid=1352191#p1352191">2013-11-21 13:19:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77080">sbd</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-21</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77080">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone,</p><p>Long time lurker, first time poster here. Thanks very much for the interesting and informative thread, it&#039;s been a great help. I&#039;ve been trying to get VGA passthrough working for some time, and while I&#039;ve succeeded in getting a secondary passthrough working with Xen I&#039;ve yet to succeed with KVM. I&#039;m experiencing the same stop 0x00000116 error seen by several others with Catalyst drivers installed, but haven&#039;t had any joy solving it with the suggested methods.</p><p>Unfortunately at the moment I&#039;m having to do my testing on a Fedora machine (my other machine is indisposed right now, although I&#039;m hoping to have it available again soon, please excuse the foreign OS). It has the following specs:<br />Asus P8H61M-LE (B3 revision)<br />i5-2500<br />HD5770<br />I was previously using version 1.6.1 of qemu to test, however I am currently using qemu compiled from Alex&#039;s git repo with the tag referenced in post 1: <br />git://github.com/awilliam/qemu-vfio.git tags/vfio-pci-for-qemu-20131003.0</p><p>Kernel is 3.11.8 (no special config) but I have checked and VFIO support is compiled in (as modules).</p><p>I have succeeded in getting the 5770 passed through as primary adapter to a Windows 7 guest, however when I install the Catalyst drivers and reboot, I get the stop 0x00000116 error, followed by a hard lockup of the machine (screen goes black, machine goes unresponsive, and I have to hard reboot. Before the catalyst drivers are installed everything is fine, but I am really after accelerated graphics. I have passed through a USB controller as well and this appears to function normally, and the virtio drivers for the network card also work fine.</p><p>When the stop error occurs, the machine goes completely unresponsive. No messages show on my other monitor (running off the onboard GPU), and the machine stops responding to keyboard and ping. There&#039;s nothing in the logs afterwards either.</p><p>I have done/tried the following without success:<br />- Blacklisting the radeon driver and assigning the graphics card to pci-stub in the grub command line.<br />- Setting options vfio_iommu_type1 allow_unsafe_interrupts=1 in /etc/modprobe.d/vfio_iommu_type1.conf<br />- Setting clear_emulator_capabilities = 0 in qemu.conf, and setting user and group to root. <br />- Adding the various /dev/vfio/x devices to cgroup_device_acl in qemu.conf<br />- Moving the HDMI audio component (01:00.1) of the 5770 to pcie.0, instead of being attached to the pcie root port.<br />- Attaching 01:00.1 to a pci port.<br />- Removing the 01:00.1 from the qemu config completely so it isn&#039;t passed through.<br />- Upgrading my motherboard BIOS</p><p>I have the guest running off of a ZFS zpool, with snapshots, so I&#039;ve been able to rollback and reinstall the catalyst drivers under different configurations (for example, installing the drivers without the HDMI audio component). In each case I&#039;ve encountered the same stop error.</p><p>I&#039;ve checked my dmesg output and the IOMMU appears to be being detected properly (and I have intel_iommu=on set in /etc/default/grub):</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.016716] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.016787] IOAPIC id 2 under DRHD base&#160; 0xfed90000 IOMMU 0<br />[&#160; &#160; 0.443112] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 0.443114] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.443121] IOMMU: Setting identity map for device 0000:00:1d.0 [0xdf0d6000 - 0xdf0e4fff]<br />[&#160; &#160; 0.443139] IOMMU: Setting identity map for device 0000:00:1a.0 [0xdf0d6000 - 0xdf0e4fff]<br />[&#160; &#160; 0.443148] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.443154] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</p></div></blockquote></div><p>However after the entry for device 00:1f.0 (LPC controller) I get this:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.443154] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]<br />[&#160; &#160; 0.443233] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O<br />[&#160; &#160; 0.443290] ------------[ cut here ]------------<br />[&#160; &#160; 0.443295] WARNING: CPU: 0 PID: 1 at drivers/pci/search.c:46 pci_find_upstream_pcie_bridge+0x77/0x90()<br />[&#160; &#160; 0.443296] Modules linked in:<br />[&#160; &#160; 0.443299] CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.11.8-200.fc19.x86_64 #1<br />[&#160; &#160; 0.443300] Hardware name: System manufacturer System Product Name/P8H61-M LE, BIOS 4501 05/10/2013<br />[&#160; &#160; 0.443301]&#160; 0000000000000009 ffff8801f3eabce0 ffffffff8164781b 0000000000000000<br />[&#160; &#160; 0.443303]&#160; ffff8801f3eabd18 ffffffff8106715d ffff8801f3b04098 ffff8801f3b04000<br />[&#160; &#160; 0.443305]&#160; ffff8801f3b04098 ffffffff81cbb0a0 ffff8801f68095a0 ffff8801f3eabd28<br />[&#160; &#160; 0.443306] Call Trace:<br />[&#160; &#160; 0.443311]&#160; [&lt;ffffffff8164781b&gt;] dump_stack+0x45/0x56<br />[&#160; &#160; 0.443313]&#160; [&lt;ffffffff8106715d&gt;] warn_slowpath_common+0x7d/0xa0<br />[&#160; &#160; 0.443315]&#160; [&lt;ffffffff8106723a&gt;] warn_slowpath_null+0x1a/0x20<br />[&#160; &#160; 0.443317]&#160; [&lt;ffffffff8132b547&gt;] pci_find_upstream_pcie_bridge+0x77/0x90<br />[&#160; &#160; 0.443319]&#160; [&lt;ffffffff815262ad&gt;] intel_iommu_add_device+0x4d/0x220<br />[&#160; &#160; 0.443322]&#160; [&lt;ffffffff8151d5a0&gt;] ? bus_set_iommu+0x50/0x50<br />[&#160; &#160; 0.443323]&#160; [&lt;ffffffff8151d5ca&gt;] add_iommu_group+0x2a/0x50<br />[&#160; &#160; 0.443325]&#160; [&lt;ffffffff813effe3&gt;] bus_for_each_dev+0x63/0xa0<br />[&#160; &#160; 0.443327]&#160; [&lt;ffffffff8151d598&gt;] bus_set_iommu+0x48/0x50<br />[&#160; &#160; 0.443330]&#160; [&lt;ffffffff81d5f4f0&gt;] intel_iommu_init+0xa55/0xb4d<br />[&#160; &#160; 0.443332]&#160; [&lt;ffffffff8104f5e5&gt;] ? free_init_pages+0x75/0xa0<br />[&#160; &#160; 0.443335]&#160; [&lt;ffffffff81d10694&gt;] ? maybe_link.part.2+0x110/0x110<br />[&#160; &#160; 0.443337]&#160; [&lt;ffffffff81d17da9&gt;] ? memblock_find_dma_reserve+0x124/0x124<br />[&#160; &#160; 0.443339]&#160; [&lt;ffffffff81d17dbb&gt;] pci_iommu_init+0x12/0x3c<br />[&#160; &#160; 0.443341]&#160; [&lt;ffffffff810020fa&gt;] do_one_initcall+0xfa/0x1b0<br />[&#160; &#160; 0.443344]&#160; [&lt;ffffffff810866a8&gt;] ? parse_args+0x138/0x400<br />[&#160; &#160; 0.443346]&#160; [&lt;ffffffff81d0f078&gt;] kernel_init_freeable+0x177/0x1ff<br />[&#160; &#160; 0.443347]&#160; [&lt;ffffffff81d0e898&gt;] ? do_early_param+0x88/0x88<br />[&#160; &#160; 0.443350]&#160; [&lt;ffffffff8163db10&gt;] ? rest_init+0x80/0x80<br />[&#160; &#160; 0.443352]&#160; [&lt;ffffffff8163db1e&gt;] kernel_init+0xe/0x190<br />[&#160; &#160; 0.443354]&#160; [&lt;ffffffff8165696c&gt;] ret_from_fork+0x7c/0xb0<br />[&#160; &#160; 0.443356]&#160; [&lt;ffffffff8163db10&gt;] ? rest_init+0x80/0x80<br />[&#160; &#160; 0.443361] ---[ end trace 2d03b7eaf7f34bc3 ]---</p></div></blockquote></div><p>I don&#039;t think it&#039;s related though, since I&#039;m not trying to pass through any PCI devices. Here&#039;s my lspci for reference:</p><div class="quotebox"><blockquote><div><p>00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller (rev 09)<br />00:01.0 PCI bridge: Intel Corporation Xeon E3-1200/2nd Generation Core Processor Family PCI Express Root Port (rev 09)<br />00:16.0 Communication controller: Intel Corporation 6 Series/C200 Series Chipset Family MEI Controller #1 (rev 04)<br />00:1a.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #2 (rev 05)<br />00:1b.0 Audio device: Intel Corporation 6 Series/C200 Series Chipset Family High Definition Audio Controller (rev 05)<br />00:1c.0 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 1 (rev b5)<br />00:1c.1 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 2 (rev b5)<br />00:1c.2 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 3 (rev b5)<br />00:1c.4 PCI bridge: Intel Corporation 82801 PCI Bridge (rev b5)<br />00:1d.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #1 (rev 05)<br />00:1f.0 ISA bridge: Intel Corporation H61 Express Chipset Family LPC Controller (rev 05)<br />00:1f.2 SATA controller: Intel Corporation 6 Series/C200 Series Chipset Family SATA AHCI Controller (rev 05)<br />00:1f.3 SMBus: Intel Corporation 6 Series/C200 Series Chipset Family SMBus Controller (rev 05)<br />01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Juniper XT [Radeon HD 5770]<br />01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Juniper HDMI Audio [Radeon HD 5700 Series]<br />03:00.0 Ethernet controller: Intel Corporation 82574L Gigabit Network Connection<br />04:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 06)<br />05:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 01)<br />06:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8169 PCI Gigabit Ethernet Controller (rev 10)</p></div></blockquote></div><p>I know a few other posters have encountered stop 0x00000116 but from what I can tell those issues were resolved for most people by placing 01:00.1 under pcie.0 (or disabling it entirely). Has anyone else had no luck with this method? I&#039;m hoping I&#039;ve just missed something obvious, but I&#039;m guessing it could also be an issue with my Asus motherboard. My other machine has an Asrock board that I&#039;m hoping to be able to test with soon.</p><p>Any advice appreciated. Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352191">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352330" class="blockpost roweven"> <h2><span><span class="conr">#806</span> <a href="viewtopic.php?pid=1352330#p1352330">2013-11-21 20:05:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76479">Norcoen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Norway</span></dd> <dd><span>Registered: 2013-11-02</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:frankmoll@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Was the solution with deveject.exe at shutdown deleted from the initial post?<br />I can&#039;t find anything about it anymore.<br />I used it in an older VM and wanted to add my new PCIe Controller, which seems to have he same problem. But I don&#039;t remember where I put the entry to do so. Wasn&#039;t the taskplaner or mmc (w/e that is)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352330">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352510" class="blockpost rowodd"> <h2><span><span class="conr">#807</span> <a href="viewtopic.php?pid=1352510#p1352510">2013-11-22 11:18:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sbd wrote:</cite><blockquote><div><p>...Any advice appreciated. Thanks...</p></div></blockquote></div><p>You need the 3.12 kernel, and if you&#039;re using the i915 driver you&#039;ll also need some fixes</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352510">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352512" class="blockpost roweven"> <h2><span><span class="conr">#808</span> <a href="viewtopic.php?pid=1352512#p1352512">2013-11-22 11:21:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Norcoen wrote:</cite><blockquote><div><p>Was the solution with deveject.exe at shutdown deleted from the initial post?<br />I can&#039;t find anything about it anymore.<br />I used it in an older VM and wanted to add my new PCIe Controller, which seems to have he same problem. But I don&#039;t remember where I put the entry to do so. Wasn&#039;t the taskplaner or mmc (w/e that is)</p></div></blockquote></div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>To automate this process three&#039;s a tool called &quot;deveject&quot; from <a href="http://www.withopf.com/tools/deveject/" rel="nofollow">http://www.withopf.com/tools/deveject/</a>, extract it somewhere then run it from cmd.<br />You should see an output like this:</p><div class="codebox"><pre><code>... &#039;@oem4.inf,%amd6719.1%;AMD Radeon HD 6900 Series&#039; &#039;PCI\VEN_1002&amp;DEV_6719&amp;SUBSYS_31221682&amp;REV_00\4&amp;184E0D10&amp;0&amp;00E0&#039; [REMOVEABLE] ...</code></pre></div><p>Now press the start button and type gpedit.msc<br />Go to &quot;Computer Configuration&quot;--&gt;&quot;Windows Settings&quot;--&gt;&quot;Scripts&quot;--&gt;&quot;Shutdown&quot;<br />Click Properties, then &quot;Add..&quot;<br />On Script Name put the full path to deveject.exe (C:\Windows\System32\deveject.exe in my case)<br />On Script Parameters -EjectId:&quot;PCI\VEN_1002&amp;DEV_6719&amp;SUBSYS_31221682&amp;REV_00\4&amp;184E0D10&amp;0&amp;00E0&quot; &lt;--change this acording to your case<br />If its working you should see windows changing the resolution while shutting down.</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352512">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352766" class="blockpost rowodd"> <h2><span><span class="conr">#809</span> <a href="viewtopic.php?pid=1352766#p1352766">2013-11-23 02:09:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77080">sbd</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-21</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77080">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for the tips guys, I&#039;ll give those suggestions a try.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352766">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352898" class="blockpost roweven"> <h2><span><span class="conr">#810</span> <a href="viewtopic.php?pid=1352898#p1352898">2013-11-23 13:35:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi guys! Can anyone who got this working check which PCI bus does GPU end up on when booting Windows 7? Its in the device manager.</p><p>For me its PCI Bus 28, while on bare metal its PCI bus 0.</p> <p class="postedit"><em>Last edited by ilya80 (2013-11-23 13:40:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352900" class="blockpost rowodd"> <h2><span><span class="conr">#811</span> <a href="viewtopic.php?pid=1352900#p1352900">2013-11-23 13:43:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><p>Hi guys! Can anyone who got this working check which PCI bus does GPU end up on when booting Windows 7? Its in the device manager.</p><p>For me its PCI Bus 28, while on bare metal its PCI bus 0.</p></div></blockquote></div><p><span class="postimg"><img src="http://i.imgur.com/l41Twxg.jpg" alt="l41Twxg.jpg" /></span></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1352934" class="blockpost roweven"> <h2><span><span class="conr">#812</span> <a href="viewtopic.php?pid=1352934#p1352934">2013-11-23 16:50:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Cool this must be something else then.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1352934">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353275" class="blockpost rowodd"> <h2><span><span class="conr">#813</span> <a href="viewtopic.php?pid=1353275#p1353275">2013-11-24 16:22:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi guys!</p><p>Today I successfully hardmodded my GTX 680 to report itself as GRID K2.</p><p>When I try to passthrough the card, I get no output on either display outputs though. Nothing suspicious in the logs, just:</p><div class="codebox"><pre><code>Nov 24 20:19:42 cave-lin kernel: [ 368.001538] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Nov 24 20:19:42 cave-lin kernel: [ 368.001719] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Nov 24 20:20:20 cave-lin kernel: [ 405.590323] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>I havent changed anything since last time I run my config, except of device ID to assign to pci-stub during boot. Prior to that passthrough worked and I just wasnt able to install Nvidia drivers in guest.</p><p>Any advice?</p> <p class="postedit"><em>Last edited by ilya80 (2013-11-24 19:39:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353275">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353388" class="blockpost roweven"> <h2><span><span class="conr">#814</span> <a href="viewtopic.php?pid=1353388#p1353388">2013-11-24 23:58:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><p>Hi guys!</p><p>Today I successfully hardmodded my GTX 680 to report itself as GRID K2.</p><p>When I try to passthrough the card, I get no output on either display outputs though. Nothing suspicious in the logs, just:</p><div class="codebox"><pre><code>Nov 24 20:19:42 cave-lin kernel: [ 368.001538] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Nov 24 20:19:42 cave-lin kernel: [ 368.001719] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Nov 24 20:20:20 cave-lin kernel: [ 405.590323] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>I havent changed anything since last time I run my config, except of device ID to assign to pci-stub during boot. Prior to that passthrough worked and I just wasnt able to install Nvidia drivers in guest.</p><p>Any advice?</p></div></blockquote></div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.&#160; However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353388">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353453" class="blockpost rowodd"> <h2><span><span class="conr">#815</span> <a href="viewtopic.php?pid=1353453#p1353453">2013-11-25 07:09:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.</p></div></blockquote></div><p>With VBIOS you mean the bios on the video card? No I haven&#039;t updated that. I`d rather keep the original bios b/c as far as I understand it manages clocks/fans in a way I want it to - as a GTX 680. Is there a way to force seabios to run GPU BIOS even though there is a mismatch?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Thanks for advice! Ill try that.</p><p>Update: for some reason WIndows is not able to boot - BSOD with PAGE_FAULT_IN_NONPAGED_AREA code 0x00000050. Sometimes BSOD has different code 0x0000007E ( SYSTEM_THREAD_EXCEPTION_NOT_HANDLED )</p><p>I might look into seabios at see if it can be forced to load BIOS even though there is a mismatch.</p> <p class="postedit"><em>Last edited by ilya80 (2013-11-25 07:41:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353453">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353479" class="blockpost roweven"> <h2><span><span class="conr">#816</span> <a href="viewtopic.php?pid=1353479#p1353479">2013-11-25 10:23:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.</p></div></blockquote></div><p>With VBIOS you mean the bios on the video card? No I haven&#039;t updated that. I`d rather keep the original bios b/c as far as I understand it manages clocks/fans in a way I want it to - as a GTX 680. Is there a way to force seabios to run GPU BIOS even though there is a mismatch?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Thanks for advice! Ill try that.</p><p>Update: for some reason WIndows is not able to boot - BSOD with PAGE_FAULT_IN_NONPAGED_AREA code 0x00000050. Sometimes BSOD has different code 0x0000007E ( SYSTEM_THREAD_EXCEPTION_NOT_HANDLED )</p><p>I might look into seabios at see if it can be forced to load BIOS even though there is a mismatch.</p></div></blockquote></div><p>See my first post on how to load your vbios from a dump, but you`ll still need to modify the devid if you`re dumping it from your card</p> <p class="postedit"><em>Last edited by nbhs (2013-11-25 10:26:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353479">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353480" class="blockpost rowodd"> <h2><span><span class="conr">#817</span> <a href="viewtopic.php?pid=1353480#p1353480">2013-11-25 10:29:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>See my first post on how to load your vbios from a dump, but you`ll still need to modify the devid if you`re dumping it from your card</p></div></blockquote></div><p>Yes, I read it again and see what you mean. I will also have to update checksum after I patch the device ID i think. Thanks for the hint.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353480">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353491" class="blockpost roweven"> <h2><span><span class="conr">#818</span> <a href="viewtopic.php?pid=1353491#p1353491">2013-11-25 12:11:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying to understand cpuset. nbhs&#039; script uses the number of physical cores, but I have 4 physical and 4 logical (I7 3770); so if I want to have 6 vcpus in my guest what do I do? Do I use -smp 3,sockets=1,cores=3,threads=2 or something like that?</p><p>Sorry for the dumb question.</p> <p class="postedit"><em>Last edited by Chetyre (2013-11-25 13:26:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353491">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353508" class="blockpost rowodd"> <h2><span><span class="conr">#819</span> <a href="viewtopic.php?pid=1353508#p1353508">2013-11-25 13:24:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76794">ilya80</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76794">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>do I use -smp 3,sockets=1,cores=3,threads=2</p></div></blockquote></div><p>I think this would work. I think cpuset is used to pin CPU&#039;s to VM, is it what you want to do?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353508">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353509" class="blockpost roweven"> <h2><span><span class="conr">#820</span> <a href="viewtopic.php?pid=1353509#p1353509">2013-11-25 13:27:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>do I use -smp 3,sockets=1,cores=3,threads=2</p></div></blockquote></div><p>I think this would work. I think cpuset is used to pin CPU&#039;s to VM, is it what you want to do?</p></div></blockquote></div><p>Yeah, I want to squeeze as much performance from the processor as possible for the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353511" class="blockpost rowodd"> <h2><span><span class="conr">#821</span> <a href="viewtopic.php?pid=1353511#p1353511">2013-11-25 13:33:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>I&#039;m trying to understand cpuset. nbhs&#039; script uses the number of physical cores, but I have 4 physical and 4 logical (I7 3770); so if I want to have 6 vcpus in my guest what do I do? Do I use -smp 3,sockets=1,cores=3,threads=2 or something like that?</p><p>Sorry for the dumb question.</p></div></blockquote></div><p>My script is broken on intel, i didnt take into consideration ht.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353511">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353513" class="blockpost roweven"> <h2><span><span class="conr">#822</span> <a href="viewtopic.php?pid=1353513#p1353513">2013-11-25 13:35:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>I&#039;m trying to understand cpuset. nbhs&#039; script uses the number of physical cores, but I have 4 physical and 4 logical (I7 3770); so if I want to have 6 vcpus in my guest what do I do? Do I use -smp 3,sockets=1,cores=3,threads=2 or something like that?</p><p>Sorry for the dumb question.</p></div></blockquote></div><p>My script is broken on intel, i didnt take into consideration ht.</p></div></blockquote></div><p>In that case is there a big difference between taskset and cpuset?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353513">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353516" class="blockpost rowodd"> <h2><span><span class="conr">#823</span> <a href="viewtopic.php?pid=1353516#p1353516">2013-11-25 13:48:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>I&#039;m trying to understand cpuset. nbhs&#039; script uses the number of physical cores, but I have 4 physical and 4 logical (I7 3770); so if I want to have 6 vcpus in my guest what do I do? Do I use -smp 3,sockets=1,cores=3,threads=2 or something like that?</p><p>Sorry for the dumb question.</p></div></blockquote></div><p>My script is broken on intel, i didnt take into consideration ht.</p></div></blockquote></div><p>In that case is there a big difference between taskset and cpuset?</p></div></blockquote></div><p>cpuset is a tool for controlling cgroups, what a did is create cpu cgroup with x cores, then move everything to the system cgroup (in my case 2 cores) and run qemu on the user cgroup</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353520" class="blockpost roweven"> <h2><span><span class="conr">#824</span> <a href="viewtopic.php?pid=1353520#p1353520">2013-11-25 14:14:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.</p></div></blockquote></div><p>With VBIOS you mean the bios on the video card? No I haven&#039;t updated that. I`d rather keep the original bios b/c as far as I understand it manages clocks/fans in a way I want it to - as a GTX 680. Is there a way to force seabios to run GPU BIOS even though there is a mismatch?</p></div></blockquote></div><p>You won&#039;t have VGA on bare metal without a modified VBIOS either, so our emulation is accurate <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />&#160; The only way to force seabios to use the VBIOS would be to modify the code.</p><div class="quotebox"><cite>ila80 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Thanks for advice! Ill try that.</p><p>Update: for some reason WIndows is not able to boot - BSOD with PAGE_FAULT_IN_NONPAGED_AREA code 0x00000050. Sometimes BSOD has different code 0x0000007E ( SYSTEM_THREAD_EXCEPTION_NOT_HANDLED )</p><p>I might look into seabios at see if it can be forced to load BIOS even though there is a mismatch.</p></div></blockquote></div><p>IIRC the PAGE_FAULT_IN_NONPAGED_AREA is the manifestation of the -cpu host problem on Nvidia.&#160; Try -cpu qemu64 or one of the CPU specific types.&#160; Note that you can dump the VBIOS, modify it, then load it with romfile= to avoid flashing it back to hardware.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353520">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1353643" class="blockpost rowodd"> <h2><span><span class="conr">#825</span> <a href="viewtopic.php?pid=1353643#p1353643">2013-11-25 22:09:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I need your help,</p><p>In my setup i added a sata3 controler on my VM but when i whant to reboot my VM the sata3 controler break the boot.</p><p>My sata3 controler is an Asmedia 1061.</p><p>I think the probleme is to reset the controler when the VM reboot.</p><p>Any idea ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1353643">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=32">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=31">31</a> <a href="viewtopic.php?id=162768&amp;p=32">32</a> <strong>33</strong> <a href="viewtopic.php?id=162768&amp;p=34">34</a> <a href="viewtopic.php?id=162768&amp;p=35">35</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=34">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
