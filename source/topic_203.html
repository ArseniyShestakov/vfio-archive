<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 203) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=203" title="Page 203" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=202" title="Page 202" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=204" title="Page 204" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=202">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <a href="viewtopic.php?id=162768&amp;p=202">202</a> <strong>203</strong> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <a href="viewtopic.php?id=162768&amp;p=205">205</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=204">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1527378" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5051</span> <a href="viewtopic.php?pid=1527378#p1527378">2015-05-10 01:01:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Omar007 wrote:</cite><blockquote><div><p>Used hardware<br />MoBo: ASUS X99-A</p></div></blockquote></div><p>My greatest mistake since my virtualization journey started was to &quot;upgrade&quot; to X99-Deluxe from ASUS . period .</p><p>My previous 990FXA from GigaByte was rock stable for passing through GPUs . I got rid of it because the AMD FX-8350 was causing most heavy games to lag , and emulators were a nightmare to play on .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527378">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527379" class="blockpost roweven"> <h2><span><span class="conr">#5052</span> <a href="viewtopic.php?pid=1527379#p1527379">2015-05-10 01:06:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90178">Omar007</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-09</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90178">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How so? What problems did you face? Maybe it was just bad luck and you received a bad board?</p><p>So far I&#039;ve not had any real problems with mine. Unless one of the points I mentioned is caused by the board but I kinda doubt that tbh.</p><p>I wish Nouveau worked properly with my cards already! Or that nVidia releases a driver version for Wayland and which doesn&#039;t take possession of the VGA arbitration thingie.<br />I&#039;d really like to give Wayland a shot to see how that fares with dynamic unbinding and rebinding of GPUs <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p> <p class="postedit"><em>Last edited by Omar007 (2015-05-10 01:09:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527379">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527389" class="blockpost rowodd"> <h2><span><span class="conr">#5053</span> <a href="viewtopic.php?pid=1527389#p1527389">2015-05-10 02:17:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Omar007 wrote:</cite><blockquote><div><p>How so? What problems did you face? Maybe it was just bad luck and you received a bad board?</p></div></blockquote></div><p>Well , I bought it 2 months after its release . It used to crash randomly ALOT during normal operation on my Windows VM . Secondly , when I moved to this platform my GT610 started to have reset issues and I am certain that it didn&#039;t have any issues running atop 990FXA .</p><p>Anyway , to be honest , recent ASUS updates fixed 99% of the stability issues (No more random crashing) .</p><p>My plan is IF (a big IF here) AMD&#039;s Zen performed near Haswell&#039;s single-threaded performance , I&#039;ll seriously consider moving to Zen+ (Zen&#039;s second gen.) platfrom . </p><p>Cheers ! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527389">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527604" class="blockpost roweven"> <h2><span><span class="conr">#5054</span> <a href="viewtopic.php?pid=1527604#p1527604">2015-05-10 23:23:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69895">mikeabrahamsen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-04-03</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69895">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone been able to get SLI working? I have 2 gtx 780ti cards being passed through to a windows guest. The cards are recognize by the OS but the nvidia control panel does not have the option to enable SLI (however I can set one card as a PhysX processor). Any suggestions?</p><p>Hardware:<br />MoBo: Asus x99 Deluxe<br />Processor: Intel i7 5820k<br />Host Graphics: AMD R7 240<br />Guest Graphics: 2x Nvidia gtx 780ti</p><p>Currently using virt-manager to configure vm.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527608" class="blockpost rowodd"> <h2><span><span class="conr">#5055</span> <a href="viewtopic.php?pid=1527608#p1527608">2015-05-11 00:11:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mikeabrahamsen wrote:</cite><blockquote><div><p>Has anyone been able to get SLI working? I have 2 gtx 780ti cards being passed through to a windows guest. The cards are recognize by the OS but the nvidia control panel does not have the option to enable SLI (however I can set one card as a PhysX processor). Any suggestions?</p><p>Hardware:<br />MoBo: Asus x99 Deluxe<br />Processor: Intel i7 5820k<br />Host Graphics: AMD R7 240<br />Guest Graphics: 2x Nvidia gtx 780ti</p><p>Currently using virt-manager to configure vm.</p></div></blockquote></div><p>I can&#039;t remember anyone running SLI for, well, 75 pages at least.<br />Anyway, i think nvidia drivers detect your VM as non SLI-compatible motherboard and refuse to work.<br />It happens on physical machines too, so there&#039;s a crutch for that: <a href="http://www.techpowerup.com/forums/threads/hypersli-enabling-sli-on-non-sli-motherboards.153046/" rel="nofollow">HyperSLI</a>. Maybe it will work if you&#039;ll enable nested virtualization. Or maybe it won&#039;t.</p><p>In the broad scale, i can&#039;t see any obvious technical reasons for it to not work - i&#039;ve got my XDMA crossfire working since a long time. Maybe aw will tell something, i don&#039;t know.</p><p>Glad to see you have both cards running independently, at least.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527608">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527784" class="blockpost roweven"> <h2><span><span class="conr">#5056</span> <a href="viewtopic.php?pid=1527784#p1527784">2015-05-11 16:25:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69895">mikeabrahamsen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-04-03</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69895">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I can&#039;t remember anyone running SLI for, well, 75 pages at least.<br />Anyway, i think nvidia drivers detect your VM as non SLI-compatible motherboard and refuse to work.<br />It happens on physical machines too, so there&#039;s a crutch for that: <a href="http://www.techpowerup.com/forums/threads/hypersli-enabling-sli-on-non-sli-motherboards.153046/" rel="nofollow">HyperSLI</a>. Maybe it will work if you&#039;ll enable nested virtualization. Or maybe it won&#039;t.</p><p>In the broad scale, i can&#039;t see any obvious technical reasons for it to not work - i&#039;ve got my XDMA crossfire working since a long time. Maybe aw will tell something, i don&#039;t know.</p><p>Glad to see you have both cards running independently, at least.</p></div></blockquote></div><p>Thanks for the response. I tried out nested virtualization with both HyperSLI and DifferentSLI (seems to be what most people were using in more recent posts from the thread you linked). Neither worked for me, it gave me another avenue to try at least. For now I will just settle for using one card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527784">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527805" class="blockpost rowodd"> <h2><span><span class="conr">#5057</span> <a href="viewtopic.php?pid=1527805#p1527805">2015-05-11 18:00:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mikeabrahamsen wrote:</cite><blockquote><div><p> For now I will just settle for using one card.</p></div></blockquote></div><p>Or you could run two VMs simultaneously to try to &quot;emulate&quot; GRID K2 setup. Oh, btw, i think it&#039;s possible to quadrify your GPUs, check that. That may open you some possibilities.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-11 18:01:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527805">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527913" class="blockpost roweven"> <h2><span><span class="conr">#5058</span> <a href="viewtopic.php?pid=1527913#p1527913">2015-05-12 02:17:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91060">strunberg</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-12</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:johndouble2@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, this is my first post because I came to this forum because of this thread.</p><p><a href="https://www.pugetsystems.com/labs/articles/Multiheaded-NVIDIA-Gaming-using-Ubuntu-14-04-KVM-585/" rel="nofollow">https://www.pugetsystems.com/labs/artic … 4-KVM-585/</a><br /><a href="https://www.pugetsystems.com/labs/articles/Multi-headed-VMWare-Gaming-Setup-564/" rel="nofollow">https://www.pugetsystems.com/labs/artic … Setup-564/</a></p><p>I&#039;m going to&#160; send some emails to AMD,Intel,GPU manufactures,and the motherboard manufactures.</p><p>I want to create a database of computer component compatibility to make things easier for my self,others,and to pad my resume.</p><p>What compatibility questions(Which of your mother board support X?) should I ask ?</p><p>Please list everything that I need to ask.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527913">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1527953" class="blockpost rowodd"> <h2><span><span class="conr">#5059</span> <a href="viewtopic.php?pid=1527953#p1527953">2015-05-12 08:32:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>There is google spreadsheet of known working hardware in this thread.</p><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1527953">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528061" class="blockpost roweven"> <h2><span><span class="conr">#5060</span> <a href="viewtopic.php?pid=1528061#p1528061">2015-05-12 16:00:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89870">bierbauch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-28</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey all, <br />After I showed my current setup around I now have the honor to play with a different config...</p><p>The system has two GTX 970. One is supposed to work with the host machine and one is for a Windows guest. Since both have the same vendor ID (10de:13c2,...) I&#039;m expecting this to not work correctly, or is there a way to bind the specific device to linux after boot. Or can I filter with PCI stub for the spot ID in addition to the vendor one? </p><p>Pls excuse my grammar, in my the phone ...</p><p>Best regards, <br />Beerbelly</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528061">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528071" class="blockpost rowodd"> <h2><span><span class="conr">#5061</span> <a href="viewtopic.php?pid=1528071#p1528071">2015-05-12 16:38:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>Hey all, <br />After I showed my current setup around I now have the honor to play with a different config...</p><p>The system has two GTX 970. One is supposed to work with the host machine and one is for a Windows guest. Since both have the same vendor ID (10de:13c2,...) I&#039;m expecting this to not work correctly, or is there a way to bind the specific device to linux after boot. Or can I filter with PCI stub for the spot ID in addition to the vendor one? </p><p>Pls excuse my grammar, in my the phone ...</p></div></blockquote></div><p><a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-3-host.html" rel="nofollow">http://vfio.blogspot.com/2015/05/vfio-g … -host.html</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528071">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528188" class="blockpost roweven"> <h2><span><span class="conr">#5062</span> <a href="viewtopic.php?pid=1528188#p1528188">2015-05-12 21:53:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>bierbauch wrote:</cite><blockquote><div><p>Hey all, <br />After I showed my current setup around I now have the honor to play with a different config...</p><p>The system has two GTX 970. One is supposed to work with the host machine and one is for a Windows guest. Since both have the same vendor ID (10de:13c2,...) I&#039;m expecting this to not work correctly, or is there a way to bind the specific device to linux after boot. Or can I filter with PCI stub for the spot ID in addition to the vendor one? </p><p>Pls excuse my grammar, in my the phone ...</p></div></blockquote></div><p><a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-3-host.html" rel="nofollow">http://vfio.blogspot.com/2015/05/vfio-g … -host.html</a></p></div></blockquote></div><p>Y U NO XEN PCI-BACK?</p><div class="quotebox"><blockquote><div><p>Some users have found the xen-pciback module to be a suitable stand-in for pci-stub with the additional feature that the &quot;hide&quot; option for this module takes device addresses rather than device IDs.&#160; I can&#039;t load this module on Fedora, so here&#039;s my solution that I like a bit better.</p></div></blockquote></div><p>Oh.. I guess you need to install xen for that, right? Is it possible to tear that module from xen and make it something like pci-id-stub or vfio-stub or something?</p> <p class="postedit"><em>Last edited by Duelist (2015-05-12 21:57:26)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528188">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528192" class="blockpost rowodd"> <h2><span><span class="conr">#5063</span> <a href="viewtopic.php?pid=1528192#p1528192">2015-05-12 22:16:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>I saw that you used a &quot;generic&quot; pattern to bind every NVIDIA &amp; AMD devices to VFIO without the need to specify the exact IDs :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff,10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff</code></pre></div><p>Can I use that and SKIP the binding script altogether ? I know my question is confusing , basically what I&#039;m doing now is this :</p><p>1 - Binding the devices to pci-stub.ids from the bootloader .</p><p>2 - Binding the same devices to VFIO using the binding script (from OP) like this :</p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0 0000:01:00.1 0000:02:00.0 0000:02:00.1 0000:05:00.0 0000:06:00.0 0000:07:00.0 0000:08:00.0 0000:00:1b.0 0000:00:19.0</code></pre></div><p>3 - Starting VMs .</p><p>Wouldn&#039;t steps 1&amp;2 become unnecessary if I use :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff,10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff</code></pre></div><p>in modprobe.d ?</p><p>A second question if I may :</p><p>Can I break the &quot;options vfio-pci ids=&quot; into multiple lines ? like this :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=8086:8d20,1912:0015,8086:15a1</code></pre></div><p>Thanks !</p> <p class="postedit"><em>Last edited by Denso (2015-05-12 22:22:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528192">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528197" class="blockpost roweven"> <h2><span><span class="conr">#5064</span> <a href="viewtopic.php?pid=1528197#p1528197">2015-05-12 22:38:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@aw :</p><p>I saw that you used a &quot;generic&quot; pattern to bind every NVIDIA &amp; AMD devices to VFIO without the need to specify the exact IDs :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff,10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff</code></pre></div><p>Can I use that and SKIP the binding script altogether ? I know my question is confusing , basically what I&#039;m doing now is this :</p><p>1 - Binding the devices to pci-stub.ids from the bootloader .</p><p>2 - Binding the same devices to VFIO using the binding script (from OP) like this :</p><div class="codebox"><pre><code>vfio-bind 0000:01:00.0 0000:01:00.1 0000:02:00.0 0000:02:00.1 0000:05:00.0 0000:06:00.0 0000:07:00.0 0000:08:00.0 0000:00:1b.0 0000:00:19.0</code></pre></div><p>3 - Starting VMs .</p><p>Wouldn&#039;t steps 1&amp;2 become unnecessary if I use :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff,10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff</code></pre></div><p>in modprobe.d ?</p></div></blockquote></div><p>Yes, vfio-pci.ids option added in 4.1 is meant to negate the need to use pci-stub and bind directly to vfio-pci.&#160; The only difference is that pci-stub is often built statically into the kernel while vfio-pci is more typically loaded as a module, so you&#039;ll need to configure your initramfs to include all the vfio modules and trigger it to load vfio-pci (the dependencies should all autoload the other modules).</p><div class="quotebox"><blockquote><div><p>A second question if I may :</p><p>Can I break the &quot;options vfio-pci ids=&quot; into multiple lines ? like this :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=8086:8d20,1912:0015,8086:15a1</code></pre></div><p>Thanks !</p></div></blockquote></div><p>AFAIK, no</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528197">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528201" class="blockpost rowodd"> <h2><span><span class="conr">#5065</span> <a href="viewtopic.php?pid=1528201#p1528201">2015-05-12 22:46:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p><a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-3-host.html" rel="nofollow">http://vfio.blogspot.com/2015/05/vfio-g … -host.html</a></p></div></blockquote></div><p>Y U NO XEN PCI-BACK?</p><div class="quotebox"><blockquote><div><p>Some users have found the xen-pciback module to be a suitable stand-in for pci-stub with the additional feature that the &quot;hide&quot; option for this module takes device addresses rather than device IDs.&#160; I can&#039;t load this module on Fedora, so here&#039;s my solution that I like a bit better.</p></div></blockquote></div><p>Oh.. I guess you need to install xen for that, right? Is it possible to tear that module from xen and make it something like pci-id-stub or vfio-stub or something?</p></div></blockquote></div><p>The problem that xen ignores with the pciback module is that the kernel has every right to re-number your PCI bus.&#160; What&#039;s at 01:00.0 now could be at 02:00.0 in the next kernel release if a tweak were made to bus enumeration.&#160; Things like the VT-d spec take this into account, providing paths to devices from known starting points, like the root bus where the bus number is fixed by the platform firmware.&#160; So while the xen-pciback method of picking devices usually works and nobody is likely to change PCI bus enumeration for the fun of it, it&#039;s flawed and I&#039;m not willing to propose it as an alternative claiming method for vfio-pci.&#160; Besides, I showed in the blog post how trivial it is to create a script that moves the problem to userspace and makes use of a less problematic interface than binding drivers by PCI device IDs.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528201">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528202" class="blockpost roweven"> <h2><span><span class="conr">#5066</span> <a href="viewtopic.php?pid=1528202#p1528202">2015-05-12 22:47:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yes, vfio-pci.ids option added in 4.1 is meant to negate the need to use pci-stub and bind directly to vfio-pci.&#160; The only difference is that pci-stub is often built statically into the kernel while vfio-pci is more typically loaded as a module, so you&#039;ll need to configure your initramfs to include all the vfio modules and trigger it to load vfio-pci (the dependencies should all autoload the other modules).</p></div></blockquote></div><p>Thanks , I did add vfio-pci to initramfs (mkinitcpio.conf in Arch) . Pci-stub is also a module in Arch&#039;s stock kernel . I had to add it to initramfs too .</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>AFAIK, no</p></div></blockquote></div><p>Thanks ! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>EDIT :</p><p>Breaking the &quot;options vfio-pci ids=&quot; to multiple lines is possible . I just broke mine to 3 lines , rebooted and everything is working like a charm :</p><div class="codebox"><pre><code>options vfio-pci ids=1002:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,1002:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=10de:ffffffff:ffffffff:ffffffff:00030000:ffff00ff,10de:ffffffff:ffffffff:ffffffff:00040300:ffffffff options vfio-pci ids=8086:8d20,1912:0015,8086:15a1</code></pre></div><p>This makes adding devices and maintaining the binding list a lot easier and cleaner . <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by Denso (2015-05-12 23:18:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528202">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528213" class="blockpost rowodd"> <h2><span><span class="conr">#5067</span> <a href="viewtopic.php?pid=1528213#p1528213">2015-05-12 23:55:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>EDIT :</p><p>Breaking the &quot;options vfio-pci ids=&quot; to multiple lines is possible . I just broke mine to 3 lines , rebooted and everything is working like a charm :</p></div></blockquote></div><p>Cool</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528213">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528227" class="blockpost roweven"> <h2><span><span class="conr">#5068</span> <a href="viewtopic.php?pid=1528227#p1528227">2015-05-13 02:14:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91090">JeromeDGDG</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-13</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91090">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I Arrived to PCI passthrough my Nvidia GTX 750 (from EVGA) on ASrock Z97 extrem 6 motherboard with intel 4470 proc by the linux-vfio dedied kernel and add: iommu, ACS, i915 options support on bootloader.<br />I just would like to add this material ability to the support list: <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a><br />But how to add it ?<br />Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528227">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528263" class="blockpost rowodd"> <h2><span><span class="conr">#5069</span> <a href="viewtopic.php?pid=1528263#p1528263">2015-05-13 06:27:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91096">corna</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-13</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:nicola@corna.info">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Good morning<br />I&#039;ve followed every hint I&#039;ve found on the web but I can&#039;t make my VGA passthrough work<br />I&#039;m on Debian testing with official kernel (3.16.0.4 - 3.16.7-ckt9-3), with ACS and i915 patches, distro&#039;s QEMU (2.1+dfsg-11) and distro&#039;s seabios (1.8.1-2)<br />This is my PC</p><p>Sapphire PURE Platinum H61<br />Intel i7 3770<br />Nvidia GTX660 Ti (Zotac, the one I want to passthrough)<br />8GB of DDR3</p><p>I can successfully load the vfio and vfio-pvi modules and associate the GPU and the HDMI audio to it with</p><div class="quotebox"><blockquote><div><p>modprobe vfio<br />modprobe vfio-pci<br />echo &#039;0000:01:00.1&#039; | sudo tee /sys/bus/pci/devices/0000:01:00.1/driver/unbind<br />echo 1002 6739 | sudo tee /sys/bus/pci/drivers/vfio-pci/new_id<br />echo 1002 aa88 | sudo tee /sys/bus/pci/drivers/vfio-pci/new_id</p></div></blockquote></div><p>With lspci -nnv I can see that the two devices are used by the driver vfio-pci<br />With these qemu&#039;s argument I can successfully run Windows 7 and the GTX660 Ti is visible from there</p><div class="quotebox"><blockquote><div><p>#!/bin/sh<br />export QEMU_AUDIO_DRV=alsa <br />DISKIMG=&quot;/media/nicola/data/qemu/WindowsVM.img&quot;<br />qemu-system-x86_64 --enable-kvm -M q35 -smp 8,sockets=1,cores=4,threads=2 -drive file=${DISKIMG},if=virtio&#160; -m 6144 \<br />-usbdevice tablet -soundhw ac97 -cpu host,kvm=off \<br />-net nic,model=virtio -net user,hostname=windowsvm \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device piix4-ide,bus=pcie.0,id=piix4-ide \<br />-device vfio-pci,host=01:00.0,bus=root.1,multifunction=on,x-vga=on,romfile=/home/nicola/Desktop/Zotac.GTX660Ti.2048.120723.rom \<br />-device vfio-pci,host=01:00.1,bus=root.1 -vga vmware</p></div></blockquote></div><p><span class="postimg"><img src="http://i60.tinypic.com/4gj0i.jpg" alt="4gj0i.jpg" /></span></p><p>But if I set -vga none I don&#039;t have any output on the discrete GPU. Do you have any hints?</p> <p class="postedit"><em>Last edited by corna (2015-05-13 13:13:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528272" class="blockpost roweven"> <h2><span><span class="conr">#5070</span> <a href="viewtopic.php?pid=1528272#p1528272">2015-05-13 07:33:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Your i915 patch is not working/not enabled in kernel boot options.</p><p>edit: you got h61 mbo, i don&#039;t think it supports vt-d?</p> <p class="postedit"><em>Last edited by slis (2015-05-13 07:35:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528272">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528305" class="blockpost rowodd"> <h2><span><span class="conr">#5071</span> <a href="viewtopic.php?pid=1528305#p1528305">2015-05-13 10:28:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91096">corna</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-13</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:nicola@corna.info">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>In my BIOS configuration there&#039;s a &quot;VT-d&quot; switch and dmesg does not output any IOMMU error; this should mean that the VT-d is supported, right?<br />When I&#039;ll get home I&#039;ll double-check the BIOS configuration and the GRUB kernel&#039;s boot options</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528305">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528311" class="blockpost roweven"> <h2><span><span class="conr">#5072</span> <a href="viewtopic.php?pid=1528311#p1528311">2015-05-13 10:55:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I got this in my dmesg:</p><div class="quotebox"><blockquote><div><p>root@HOST:~# dmesg | grep IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.012702] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a<br />[&#160; &#160; 0.012707] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.012778] IOAPIC id 2 under DRHD base&#160; 0xfed91000 IOMMU 1<br />[&#160; &#160; 0.398237] IOMMU: dmar0 using Queued invalidation<br />[&#160; &#160; 0.398238] IOMMU: dmar1 using Queued invalidation<br />[&#160; &#160; 0.398239] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.398248] IOMMU: Setting identity map for device 0000:00:02.0 [0xcb800000 - 0xcf9fffff]<br />[&#160; &#160; 0.398526] IOMMU: Setting identity map for device 0000:00:14.0 [0xc95cb000 - 0xc95d7fff]<br />[&#160; &#160; 0.398542] IOMMU: Setting identity map for device 0000:00:1a.0 [0xc95cb000 - 0xc95d7fff]<br />[&#160; &#160; 0.398554] IOMMU: Setting identity map for device 0000:00:1d.0 [0xc95cb000 - 0xc95d7fff]<br />[&#160; &#160; 0.398562] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.398568] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</p></div></blockquote></div><p>and this</p><div class="quotebox"><blockquote><div><p>root@HOST:~# dmesg | grep vgaarb<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.19.0-mast root=UUID=d8c8db8d-2f38-479e-9aba-8b9e004cf0b0 ro transparent_hugepage=always intel_iommu=on i915.enable_hd_vgaarb=1 elevator=deadline quiet<br />[&#160; &#160; 0.166672] vgaarb: setting as boot device: PCI:0000:00:02.0<br />[&#160; &#160; 0.166673] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none<br />[&#160; &#160; 0.166676] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none<br />[&#160; &#160; 0.166677] vgaarb: loaded<br />[&#160; &#160; 0.166678] vgaarb: bridge control possible 0000:01:00.0<br />[&#160; &#160; 0.166679] vgaarb: no bridge control possible 0000:00:02.0<br />[&#160; &#160; 1.488098] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io+mem</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528311">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528328" class="blockpost rowodd"> <h2><span><span class="conr">#5073</span> <a href="viewtopic.php?pid=1528328#p1528328">2015-05-13 13:17:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91096">corna</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-13</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:nicola@corna.info">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve checked and both the &quot;Intel Virtualization Technology&quot; and &quot;VT-d&quot; switches are on in my BIOS<br />This is the output of your commands, almost identical</p><div class="quotebox"><blockquote><div><p>nicola@debianDesktop:~$ dmesg | grep IOMMU<br />[&#160; &#160; 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.015015] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a<br />[&#160; &#160; 0.015019] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.015091] IOAPIC id 2 under DRHD base&#160; 0xfed91000 IOMMU 1<br />[&#160; &#160; 0.506913] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 0.506914] IOMMU 1 0xfed91000: using Queued invalidation<br />[&#160; &#160; 0.506915] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.506924] IOMMU: Setting identity map for device 0000:00:02.0 [0xcb800000 - 0xcf9fffff]<br />[&#160; &#160; 0.507212] IOMMU: Setting identity map for device 0000:00:1a.0 [0xca1fa000 - 0xca216fff]<br />[&#160; &#160; 0.507230] IOMMU: Setting identity map for device 0000:00:1d.0 [0xca1fa000 - 0xca216fff]<br />[&#160; &#160; 0.507241] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.507247] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]<br />[&#160; &#160; 0.512879] AMD IOMMUv2 driver by Joerg Roedel &lt;joerg.roedel@amd.com&gt;<br />[&#160; &#160; 0.512881] AMD IOMMUv2 functionality not available on this system</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>nicola@debianDesktop:~$ dmesg | grep vgaarb<br />[&#160; &#160; 0.000000] Linux version 3.16.0-4-amd64 (debian-kernel@lists.debian.org) (gcc version 4.8.4 (Debian 4.8.4-1) ) #1 SMP Debian 3.16.7-ckt9-3~deb8u1+acsoverridei915vgaarbiter1 (2<br />[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.16.0-4-amd64 root=UUID=cf3edd70-0d97-4e7a-af69-a5b6beff2e6e ro intel_iommu=on pcie_acs_override=downstream i915.enable_hd_vgaarb=1 quiet<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-3.16.0-4-amd64 root=UUID=cf3edd70-0d97-4e7a-af69-a5b6beff2e6e ro intel_iommu=on pcie_acs_override=downstream i915.enable_hd_vgaarb=1 quiet<br />[&#160; &#160; 0.256781] vgaarb: setting as boot device: PCI:0000:00:02.0<br />[&#160; &#160; 0.256782] vgaarb: device added: PCI:0000:00:02.0,decodes=io+mem,owns=io+mem,locks=none<br />[&#160; &#160; 0.256785] vgaarb: device added: PCI:0000:01:00.0,decodes=io+mem,owns=none,locks=none<br />[&#160; &#160; 0.256786] vgaarb: loaded<br />[&#160; &#160; 0.256787] vgaarb: bridge control possible 0000:01:00.0<br />[&#160; &#160; 0.256788] vgaarb: no bridge control possible 0000:00:02.0<br />[&#160; &#160; 2.203712] vgaarb: device changed decodes: PCI:0000:00:02.0,olddecodes=io+mem,decodes=io:owns=io</p></div></blockquote></div><p>I&#039;m running the qemu&#039;s script with kdesudo; is there a way to run it without sudo privileges?<br />Ideas?</p> <p class="postedit"><em>Last edited by corna (2015-05-13 13:20:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528328">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528334" class="blockpost roweven"> <h2><span><span class="conr">#5074</span> <a href="viewtopic.php?pid=1528334#p1528334">2015-05-13 13:40:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah it all looks good, you should have output on your gpu... old qemu maybe? i don&#039;t know.</p><p>edit: try ovmf? try libvirt? check aw&#039;s blog.</p> <p class="postedit"><em>Last edited by slis (2015-05-13 13:42:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1528488" class="blockpost rowodd"> <h2><span><span class="conr">#5075</span> <a href="viewtopic.php?pid=1528488#p1528488">2015-05-13 22:06:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91096">corna</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-13</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:nicola@corna.info">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The output of rom-parser (<a href="http://vfio.blogspot.it/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.it/2014/08/does-my … t-efi.html</a>) is this one</p><div class="codebox"><pre><code> Valid ROM signature found @0h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 1183, class: 030000 PCIR: revision 0, vendor revision: 1 Last image</code></pre></div><p>so I suppose I can&#039;t use ovmf...</p><p>What about libvirt? Can you link me the blog?<br />QEMU&#039;s version is 2.1, a recent one</p> <p class="postedit"><em>Last edited by corna (2015-05-13 22:07:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1528488">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=202">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=201">201</a> <a href="viewtopic.php?id=162768&amp;p=202">202</a> <strong>203</strong> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <a href="viewtopic.php?id=162768&amp;p=205">205</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=204">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
