<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 205) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=205" title="Page 205" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=204" title="Page 204" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=206" title="Page 206" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=204">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=203">203</a> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <strong>205</strong> <a href="viewtopic.php?id=162768&amp;p=206">206</a> <a href="viewtopic.php?id=162768&amp;p=207">207</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=206">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1529135" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5101</span> <a href="viewtopic.php?pid=1529135#p1529135">2015-05-15 23:56:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>What would be a good choice for a motherboard at the moment, given that I still want to use it for a gaming VM and having at least two pcie x16 slots?</p></div></blockquote></div><p>Are both slots for a single VM or split between host and guest?&#160; Do they both need to be PCIe 3.0?&#160; Integrated graphics or discrete for host?&#160; Any other cards to install (for host or guest)?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529135">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529189" class="blockpost roweven"> <h2><span><span class="conr">#5102</span> <a href="viewtopic.php?pid=1529189#p1529189">2015-05-16 08:18:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81197">scoobydog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-14</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81197">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I saw my system is in the Google Doc list, nice :-)</p><p>Here are the missing informations about my System:</p><p>Linux&#160; 3.16.0-4-amd64 #1 SMP Debian 3.16.7-ckt9-3~deb8u1 (2015-04-24) x86_64 GNU/Linux</p><p>QEMU emulator version 2.1.2 (Debian 1:2.1+dfsg-11), Copyright (c) 2003-2008 Fabrice Bellard</p><p>No special Paches, I&#039;m using the kernel from Debian.</p><p>And it&#039;s also working with a Asus strix GTX970 OC Graphikcard, see a benchmark of it here <a href="https://www.youtube.com/watch?v=v1cFWrKtWis" rel="nofollow">https://www.youtube.com/watch?v=v1cFWrKtWis</a> .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529189">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529209" class="blockpost rowodd"> <h2><span><span class="conr">#5103</span> <a href="viewtopic.php?pid=1529209#p1529209">2015-05-16 10:08:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>What would be a good choice for a motherboard at the moment, given that I still want to use it for a gaming VM and having at least two pcie x16 slots?</p></div></blockquote></div><p>Are both slots for a single VM or split between host and guest?&#160; Do they both need to be PCIe 3.0?&#160; Integrated graphics or discrete for host?&#160; Any other cards to install (for host or guest)?</p></div></blockquote></div><p>I guess its not necessary, that both slots are for a single VM. Now I&#039;m curious: does that make a difference? However I think it would be nice if they have PCIe 3.0. <br />Integrated Graphics is always a nice to have, I think. Two separete SATA controllers would be nice to have. Integrated or as extra card is not so important for me. <br />Also at the moment I use a dedicated sound card for the VM, but I think there isn&#039;t much benefit in this, is it? OK after all in my setup the speaker out goes directly into the line in of the integrated sound device used in the host <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by apex8 (2015-05-16 10:13:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529209">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529217" class="blockpost roweven"> <h2><span><span class="conr">#5104</span> <a href="viewtopic.php?pid=1529217#p1529217">2015-05-16 10:57:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...because 55w of electricity was equal to zero cents per month....</p></div></blockquote></div><p>How do you figure that?&#160; Free electric?&#160; Surplus production?&#160; 55 watts 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_166.html topic_167.html topic_168.html topic_169.html topic_16.html topic_170.html topic_171.html topic_172.html topic_173.html topic_174.html topic_175.html topic_176.html topic_177.html topic_178.html topic_179.html topic_17.html topic_180.html topic_181.html topic_182.html topic_183.html topic_184.html topic_185.html topic_186.html topic_187.html topic_188.html topic_189.html topic_18.html topic_190.html topic_191.html topic_192.html topic_193.html topic_194.html topic_195.html topic_196.html topic_197.html topic_198.html topic_199.html topic_19.html topic_1.html topic_200.html topic_201.html topic_202.html topic_203.html topic_204.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html 24 hours = 1.32kW, which is 10 cents per day from my utility even at the lowest tier</p></div></blockquote></div><p>Currency exchange rate allows me to say this. And I don&#039;t have the lowest prices, but they&#039;re quite low for my area. But that currency-exchange-magic works the other way, so i can&#039;t really sell my cards or buy a new one. Hence the obsession.</p><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>What would be a good choice for a motherboard at the moment, given that I still want to use it for a gaming VM and having at least two pcie x16 slots?</p></div></blockquote></div><p>Let&#039;s start from the top:<br />What CPU do you want to use?<br />AMD? Use whatever with 990FX and tons of pci-e lanes. Intel? AW will give you more advice on this, especially about 9-series chipsets and ACS quirks.</p><p>And also... PCI-E 3.0 is needed when you don&#039;t have enough bandwidth in PCI-E 2.0. If your current cards run fine on pci-e 2.0 - don&#039;t bother. Maaaybe you might get some slight performance increase due to additional bandwidth. Especially you&#039;ll notice this if you&#039;re using some weird config(like me) or doing crossfire-over-pci-e aka XDMA CF(again, like me).<br />ATM most GPUs already support PCI-E 3.0, and there&#039;s rarely a motherboard-CPU combo without pci-e 3.0.(usually that&#039;s AMD)</p><p>Dedicated sound card for the VM... I admit, i&#039;ve set that up too, but that&#039;s too much hassle(actually, now i continue using that card because of gameport and a joystick) in mixing host and guest sounds, so i&#039;d suggest you digging to NetJack way of mixing outputs. Since we have localhost tun/tap network, we shouldn&#039;t stumble into bandwidth or lag issues, and something hints me that it should work better that embedded pulse audio or alsa stuff we have now. I&#039;m not a linux sound specialist, so YMMV.</p><p>And why would you want to have a separate SATA controller? Why?<br />Virtio-pci gives you A LOT of speed and in some cases you can even benefit from host system caching. Oh noes, SMART and TRIM aren&#039;t working? Use virtio-scsi or whatever it was the controller variant.<br />Usually you&#039;d want to have a separate SATA controller for the VM just to reduce the amount of guest-system-trickery with drivers(like windows having BSOD 7B). Otherwise it&#039;s not worth it, IMO.<br />And also, that controller, if it isn&#039;t a separate PCI card, may fall into a clustered IOMMU-group, requesting you to passthrough other stuff that you don&#039;t want to passthrough, like USB or ethernet controllers.</p><p>And also, i&#039;ve exceeded my post quota on &quot;And also&quot; usage.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529217">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529227" class="blockpost rowodd"> <h2><span><span class="conr">#5105</span> <a href="viewtopic.php?pid=1529227#p1529227">2015-05-16 11:25:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OK maybe I&#039;m a bit too pessimistic on the disk performance, because currently I already use virt io with data-x-plane and the performance could be better. However the host runs on a SSD and this could be something I could do with the VM too.<br />At the sound configuration, you mentioned something like NetJack. Can you go into a bit more detail? Currently I&#039;m using pulseaudio, but I suspect this thing of being responsible for trouble with google play movies and audio crackle. Why do I suspect pulseaudio for those issues? Both things worked in the past and the only major changes I did to the system was switching from KDE to LXDE and installing pulseaudio.</p> <p class="postedit"><em>Last edited by apex8 (2015-05-16 11:35:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529227">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529266" class="blockpost roweven"> <h2><span><span class="conr">#5106</span> <a href="viewtopic.php?pid=1529266#p1529266">2015-05-16 13:52:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>In the first post of my recent how-to series I talk about the hardware I use, not that I&#039;d recommend it, but to talk about why it works for my config - <a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-1-hardware.html" rel="nofollow">http://vfio.blogspot.com/2015/05/vfio-g … dware.html</a></p><p>I won&#039;t be as generous as Duelist, skip AMD platforms.&#160; They&#039;ve admittedly given up on the single core performance race, you don&#039;t know what you&#039;re getting on an APU system for isolation, and their latest performance/workstation class chipset is quickly coming up on its four year anniversary since launch.</p><p>So that leaves Intel.&#160; I assume that most people do not want to patch their kernel long term, so that means we want a config that avoids the i915 VGA arbiter issues and doesn&#039;t require the ACS override patch.&#160; The VGA issue is easy, use a UEFI capable GPU and guest or use discrete graphics for the host.&#160; The isolation problem is more complicated.&#160; The reason I ask about PCIe 3.0 requirements is that PCIe 3.0 slots are pretty much always sourced from the processor root ports rather than the chipset root ports.&#160; If you use a &quot;client&quot; processor, ie. Core i5/i7, or even a Xeon E3-1200 series, there&#039;s not going to be isolation between the processor root ports.&#160; That means that whatever you plug into those root port slots either needs to be used exclusively by the host or exclusively by a single VM.&#160; That leaves a lot of workable configs, but you must be conscious of the restrictions.&#160; We have pretty good coverage for isolation of the PCH root ports, 9-series is coming in kernel 4.2, the reset should already be there.&#160; This means that you get finer granularity of what you can assign for devices connected via the PCH root ports, which are generally the PCIe 2.0 slots as well as the integrated components. </p><p>If you don&#039;t want to sorry about this at all and want the most flexibility in your system config without patches, get a Xeon E5 or better with and X79 or X99 chipset.</p><p>If you really want to assign a disk controller to a VM, you&#039;re into risky territory, mostly because the cheap ones are all crap.&#160; If you try to assign an integrated controller, the boot ROM for it may be integrated into the system BIOS, so you&#039;ll have no way to boot the VM unless you can extract it... and hope it supports UEFI if you&#039;re going the OVMF route with the VM.&#160; You may have better luck with a discrete HBA, but you&#039;re still in the unknown/crap space.&#160; Personally I find virtio-scsi w/ multi-queue and a fast backing setup to meet my needs.</p><p>If you want to assign a NIC, make it an Intel NIC, Realtek NICs are crap for assignment.&#160; Broadcom can be ok, but it&#039;s a bit more of a gamble.&#160; For anything else you might want to assign, try to avoid conventional PCI.&#160; All conventional PCI devices are indistinguishable by the IOMMU, so there is no way to split them between host and guest and they often have poor support for interrupt masking.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529266">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529270" class="blockpost rowodd"> <h2><span><span class="conr">#5107</span> <a href="viewtopic.php?pid=1529270#p1529270">2015-05-16 14:14:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If you want to assign a NIC, make it an Intel NIC, Realtek NICs are crap for assignment.&#160; Broadcom can be ok, but it&#039;s a bit more of a gamble.&#160; For anything else you might want to assign, try to avoid conventional PCI.&#160; All conventional PCI devices are indistinguishable by the IOMMU, so there is no way to split them between host and guest and they often have poor support for interrupt masking.</p></div></blockquote></div><p>Oh god, I have Atheros flashbacks. Oh god. No, not the L1 again. Oh god... This card was incompatible with.. everything. Are they dead yet?</p><p>And why do you skip AMD platforms? Some people use debian, being the not-so-fresh-but-stable software, why not combine it with 4-years-old-but-already-patched-everywhere AMD chipset?</p><p>Some people prefer i5-2500k for it&#039;s insane overclocking abilities and cheapness, and it&#039;s 3-4 years old too. And what, it makes it a bad motherboard-cpu combo?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529279" class="blockpost roweven"> <h2><span><span class="conr">#5108</span> <a href="viewtopic.php?pid=1529279#p1529279">2015-05-16 14:40:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And why do you skip AMD platforms? Some people use debian, being the not-so-fresh-but-stable software, why not combine it with 4-years-old-but-already-patched-everywhere AMD chipset?</p><p>Some people prefer i5-2500k for it&#039;s insane overclocking abilities and cheapness, and it&#039;s 3-4 years old too. And what, it makes it a bad motherboard-cpu combo?</p></div></blockquote></div><p>I&#039;m not sure how 2500k is relevant here, it doesn&#039;t support VT-d, so for anything in this thread, yes it does make a bad combo.</p><p>AMD is just not interesting to me, so certainly factor in some personal bias.&#160; 990FX has reasonably good isolation, I have one myself.&#160; Mine is also a dog compared to my Intel boxes.&#160; If you head towards the newer APU-based AMD system, you&#039;re in a world of unknown.&#160; We don&#039;t know what the isolation capabilities are of the chipset and I don&#039;t have a relationship with AMD to try to fix any gaps with quirks.&#160; There&#039;s also no resource like ark to determine the various features of a given combo of AMD CPU and chipset.&#160; We also have users reporting that they need to do strange things like disable hugepages on some AMD systems which implies there&#039;s some software or hardware problem out there, but we don&#039;t have enough data points, or interest, to figure it out.&#160; So no, I can&#039;t in good faith recommend an AMD platform.</p><p>BTW, I forgot to mention that Gigabyte boards seem to have the best BIOS configuration for primary graphics, so if discrete host graphics was on my radar in choosing a motherboard, it would probably be a Gigabyte board.&#160; I obviously can&#039;t guarantee anything there though.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529420" class="blockpost rowodd"> <h2><span><span class="conr">#5109</span> <a href="viewtopic.php?pid=1529420#p1529420">2015-05-17 01:57:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75818">ceri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 44</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>ISo that leaves Intel.&#160; I assume that most people do not want to patch their kernel long term, so that means we want a config that avoids the i915 VGA arbiter issues and doesn&#039;t require the ACS override patch.&#160; The VGA issue is easy, use a UEFI capable GPU and guest or use discrete graphics for the host.&#160; The isolation problem is more complicated.&#160; The reason I ask about PCIe 3.0 requirements is that PCIe 3.0 slots are pretty much always sourced from the processor root ports rather than the chipset root ports.&#160; If you use a &quot;client&quot; processor, ie. Core i5/i7, or even a Xeon E3-1200 series, there&#039;s not going to be isolation between the processor root ports.&#160; That means that whatever you plug into those root port slots either needs to be used exclusively by the host or exclusively by a single VM.&#160; That leaves a lot of workable configs, but you must be conscious of the restrictions.&#160; We have pretty good coverage for isolation of the PCH root ports, 9-series is coming in kernel 4.2, the reset should already be there.&#160; This means that you get finer granularity of what you can assign for devices connected via the PCH root ports, which are generally the PCIe 2.0 slots as well as the integrated components.</p></div></blockquote></div><p>I don&#039;t really know/understand the architecture of the interaction between PCI/e ports and the CPU &amp; MB, and so I&#039;m confused about the ACS isolation stuff, but from what you&#039;ve written here and on your blog, would I be correct in assuming that:</p><p>a) if i wanted to use discrete graphics (w/ a UEFI bios) on a single guest, and intel integrated graphics on the host (with no other PCI/PCIe devices), I wouldn&#039;t have to worry about using any patches or isolation, nor the type of CPU/motherboard I get (except for CPU/GFX compatibility with the MB and VT-d, etc)?</p><p>b) in the case of (a) but also with a PCIe 1.0+ sound card for use on the host (e.g. put in a PCIe 2.0 slot), I wouldn&#039;t have to worry about patches or isolation with a pre-9 series chipset (or 9 series from linux 4.2+)?</p><p>c) in the case of (a), except that I would be using a second discrete GFX card for the host, I *would* have to worry about patches and isolation?</p> <p class="postedit"><em>Last edited by ceri (2015-05-17 01:58:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529420">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529437" class="blockpost roweven"> <h2><span><span class="conr">#5110</span> <a href="viewtopic.php?pid=1529437#p1529437">2015-05-17 03:43:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79799">marca311</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79799.png?m=1393353372" width="80" height="53" alt="" /></dd> <dd><span>From: Canada</span></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79799">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all!</p><p>I have been following this thread for several weeks now and after a couple weeks of trying things on my computer, I have hit a brick wall.<br />Before we get any further, here are my specs:</p><div class="codebox"><pre><code>Arch stock Kernel 4.0.2-1 or 3.19.3-1-ck+ACS override patch Intel i7-5820k MSI Gaming 7 X99S Motherboard Intel X99 chipset 32GB RAM EVGA 980 Superclocked QEMU-git (pulled and compiled 16 May 2015) OVMF-svn (pulled and compiled last week)</code></pre></div><p>I have tried with both libvirt and straight up qemu.<br />Here is my QEMU file:</p><div class="codebox"><pre><code>#!/bin/bash vfio-bind 0000:03:00.0 0000:03:00.1 export QEMU_AUDIO_DAC_FIXED_SETTINGS=1 export QEMU_AUDIO_DAC_FIXED_FREQ=44100 export QEMU_AUDIO_DAC_FIXED_FMT=S16 export QEMU_SDL_SAMPLES=1024 qemu-system-x86_64 -enable-kvm -m 8192 -cpu host,kvm=off \ -soundhw hda \ -mem-path /dev/hugepages \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -boot d /home/marcus/qemu/win8.1/c_drive.qcow2 \ -net nic \ -net user,smb=/run/Game-Drive \ -smp 4,sockets=1,cores=4,threads=1 \ -device vfio-pci,host=03:00.0,x-vga=on \ -device vfio-pci,host=03:00.1 \ -vga none \ -usb \ -device nec-usb-xhci,id=xhci \ -usbdevice host:046d:c52f \ -usbdevice host:045e:00b4</code></pre></div><p>And here is my libvirt config:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;win8.1&lt;/name&gt; &lt;uuid&gt;d9aaa8dd-6b43-421b-b165-706926e9181e&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8290304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8290304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039; current=&#039;8&#039;&gt;32&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.3&#039;&gt;hvm&lt;/type&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/usr/share/ovmf/x64/ovmf_code_x64.bin&lt;/loader&gt; &lt;nvram template=&#039;/usr/share/ovmf/x64/ovmf_vars_x64.bin&#039;&gt;/var/lib/libvirt/qemu/nvram/win8.1_VARS.fd&lt;/nvram&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;8&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/home/marcus/qemu/win8.1/c_drive.qcow2&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/home/marcus/qemu/win8.1/Witcher3.qcow2&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/home/marcus/qemu/win8.1/GTAV.qcow2&#039;/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039; model=&#039;virtio-scsi&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:03:6e:f7&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;rtl8139&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;sound model=&#039;ac97&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;sound model=&#039;es1370&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;sound model=&#039;ich9&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0c&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;sound model=&#039;pcspk&#039;/&gt; &lt;sound model=&#039;sb16&#039;/&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52f&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x045e&#039;/&gt; &lt;product id=&#039;0x00b4&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>Here is what libvirt starts up</p><div class="codebox"><pre><code>LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=none /usr/sbin/qemu-system-x86_64 -name win8.1 -S -machine pc-i440fx-2.3,accel=kvm,usb=off -cpu host,kvm=off -drive file=/usr/share/ovmf/x64/ovmf_code_x64.bin,if=pflash,format=raw,unit=0,readonly=on -drive file=/var/lib/libvirt/qemu/nvram/win8.1_VARS.fd,if=pflash,format=raw,unit=1 -m 8096 -realtime mlock=off -smp 8,maxcpus=32,sockets=1,cores=4,threads=8 -uuid d9aaa8dd-6b43-421b-b165-706926e9181e -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/win8.1.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=localtime,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x6.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x6 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x6.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x6.0x2 -device virtio-scsi-pci,id=scsi0,bus=pci.0,addr=0x5 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x7 -drive if=none,id=drive-ide0-0-0,readonly=on,format=raw -device ide-cd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0 -drive file=/home/marcus/qemu/win8.1/c_drive.qcow2,if=none,id=drive-ide0-0-1,format=qcow2 -device ide-hd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1 -drive file=/home/marcus/qemu/win8.1/Witcher3.qcow2,if=none,id=drive-ide0-1-0,format=qcow2 -device ide-hd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0 -drive file=/home/marcus/qemu/win8.1/GTAV.qcow2,if=none,id=drive-ide0-1-1,format=qcow2 -device ide-hd,bus=ide.1,unit=1,drive=drive-ide0-1-1,id=ide0-1-1 -netdev tap,fd=23,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:03:6e:f7,bus=pci.0,addr=0x9 -device AC97,id=sound0,bus=pci.0,addr=0x4 -device ES1370,id=sound1,bus=pci.0,addr=0xa -device intel-hda,id=sound2,bus=pci.0,addr=0xb -device hda-duplex,id=sound2-codec0,bus=sound2.0,cad=0 -device ich9-intel-hda,id=sound3,bus=pci.0,addr=0xc -device hda-duplex,id=sound3-codec0,bus=sound3.0,cad=0 -soundhw pcspk -device sb16,id=sound5 -device vfio-pci,host=03:00.0,id=hostdev0,bus=pci.0,addr=0x2 -device vfio-pci,host=03:00.1,id=hostdev1,bus=pci.0,addr=0x3 -device usb-host,hostbus=1,hostaddr=6,id=hostdev2 -device usb-host,hostbus=1,hostaddr=5,id=hostdev3 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x8 -msg timestamp=on</code></pre></div><p>Now then, that&#039;s out of the way.<br />My issue is in a few places.<br />The biggest one is that when I shut down the VM, the X server on the host freezes and if I try to shut it down, nothing happens.<br />If I try to shut the computer down, everything just freezes and I have to hard reboot. Finally, I have to shut off my power supply for approximately 15 mins before the motherboard even acknowledges me pressing the power button. I&#039;m wondering if I&#039;m damaging my hardware.</p><p>Error I get on shutdown right before the freeze (with qemu only, not libvirt):</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: error, group 28 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to get group 28 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device initialization failed qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Yes, I do have the kernel arguments for PCI-Stub set up.</p><p>This issue happens with both qemu and libvirt, however qemu requires mouse something on the display to update first before it freezes, libvirt just freezes immediately.<br />I have been unable to find anything in journalctl or any relevant logs. Any ideas?</p> <p class="postedit"><em>Last edited by marca311 (2015-05-17 03:51:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529518" class="blockpost rowodd"> <h2><span><span class="conr">#5111</span> <a href="viewtopic.php?pid=1529518#p1529518">2015-05-17 11:56:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>marca311 wrote:</cite><blockquote><div><p>Hi all!</p><p>I have been following this thread for several weeks now and after a couple weeks of trying things on my computer, I have hit a brick wall.<br />Before we get any further, here are my specs:</p><div class="codebox"><pre><code>Arch stock Kernel 4.0.2-1 or 3.19.3-1-ck+ACS override patch Intel i7-5820k MSI Gaming 7 X99S Motherboard Intel X99 chipset 32GB RAM EVGA 980 Superclocked QEMU-git (pulled and compiled 16 May 2015) OVMF-svn (pulled and compiled last week)</code></pre></div><p>..SNIP...</p><p>Error I get on shutdown right before the freeze (with qemu only, not libvirt):</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: error, group 28 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: vfio: failed to get group 28 qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device initialization failed qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Yes, I do have the kernel arguments for PCI-Stub set up.</p><p>This issue happens with both qemu and libvirt, however qemu requires mouse something on the display to update first before it freezes, libvirt just freezes immediately.<br />I have been unable to find anything in journalctl or any relevant logs. Any ideas?</p></div></blockquote></div><p>List your iommu groups by doing</p><div class="codebox"><pre><code>tree /sys/kernel/iommu_groups/</code></pre></div><p>and check what&#039;s in group 28. Or just stuff it all here. Chances are that you have problems with device isolation, needing ACS patch <span class="bbu">and general 9-series intel chipset support that will be brought upstream in linux 4.2</span>.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-17 11:57:11)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529518">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529542" class="blockpost roweven"> <h2><span><span class="conr">#5112</span> <a href="viewtopic.php?pid=1529542#p1529542">2015-05-17 13:40:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ceri wrote:</cite><blockquote><div><p>I don&#039;t really know/understand the architecture of the interaction between PCI/e ports and the CPU &amp; MB, and so I&#039;m confused about the ACS isolation stuff, but from what you&#039;ve written here and on your blog, would I be correct in assuming that:</p><p>a) if i wanted to use discrete graphics (w/ a UEFI bios) on a single guest, and intel integrated graphics on the host (with no other PCI/PCIe devices), I wouldn&#039;t have to worry about using any patches or isolation, nor the type of CPU/motherboard I get (except for CPU/GFX compatibility with the MB and VT-d, etc)?</p></div></blockquote></div><p>Yes, if the discrete graphics card for the guest is the only plugin card, then pretty much anything will work.&#160; If your chipset is not quirked for PCH root port isolation, then you&#039;d need to install it in a processor root port slot to keep it from getting grouped with onboard devices, if it is quirked, then any slot will work.</p><div class="quotebox"><blockquote><div><p>b) in the case of (a) but also with a PCIe 1.0+ sound card for use on the host (e.g. put in a PCIe 2.0 slot), I wouldn&#039;t have to worry about patches or isolation with a pre-9 series chipset (or 9 series from linux 4.2+)?</p></div></blockquote></div><p>This is also an easy configuration, but you do somewhat need to worry about isolation and which card goes where.&#160; If the guest discrete graphics is installed in a processor root port slot, then the host sound card would need to be installed in a PCH root port slot.&#160; If you have a pre-9 series chipset, both could be installed in PCH root port slots.</p><div class="quotebox"><blockquote><div><p>c) in the case of (a), except that I would be using a second discrete GFX card for the host, I *would* have to worry about patches and isolation?</p></div></blockquote></div><p>It&#039;s still achievable without patches, but you&#039;re potentially sacrificing performance.&#160; The rule is that Intel Client processors (i5/i7) and Xeon E3-1200 series do not have isolation between the processor root ports.&#160; Therefore anything plugged into those slots will be part of the same IOMMU group.&#160; We cannot have split ownership of an IOMMU group between host and guest.&#160; Most motherboard will only allow you to specify &quot;PCIe&quot; for graphics without slot granularity (Gigabyte seems to be the exception here), which means that you need to use the processor root port slots for your host graphics.&#160; That means any other processor root port slots need to be used for host owned devices, for example you can put your x1 sound card in another processor slot.&#160; The guest discrete graphics would need to use a PCH root port slot which is already quirked for isolation to avoid grouping with onboard devices (pre-9 series until kernel 4.2).&#160; With BIOSes that allow slot selection of primary graphics, there&#039;s a bit more freedom that you can choose whether to put the host graphics in the processor or PCH root port, which can favor guest graphics performance.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529542">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529545" class="blockpost rowodd"> <h2><span><span class="conr">#5113</span> <a href="viewtopic.php?pid=1529545#p1529545">2015-05-17 14:00:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Duelist, X99 is not a 9-series chipset, X99 quirks went in for 4.0</p><p>@marca311, your log doesn&#039;t make much sense, the group not viable error is a fatal qemu error, the VM shouldn&#039;t start but you&#039;re saying you get that error on shutdown.&#160; I don&#039;t see how that&#039;s possible.&#160; You say you have the kernel commandline enabled for pci-stub, but is it effective?&#160; Does /proc/cmdline show the option?&#160; Is pci-stub built statically into your kernel?&#160; If pci-stub is a module then it becomes non-deterministic which pci-stub gets a shot at rebinding to the GPU before the native driver, it all depends on which module loaded first.&#160; But event that&#039;s still confusing because your raw qemu script doesn&#039;t appear to be unbinding devices when finished.&#160; I don&#039;t recommend vfio-bind anymore, and that itself should be causing you trouble if it&#039;s doing more than binding endpoint devices to vfio-pci.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529545">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529641" class="blockpost roweven"> <h2><span><span class="conr">#5114</span> <a href="viewtopic.php?pid=1529641#p1529641">2015-05-17 19:45:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79799">marca311</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79799.png?m=1393353372" width="80" height="53" alt="" /></dd> <dd><span>From: Canada</span></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79799">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@marca311, your log doesn&#039;t make much sense, the group not viable error is a fatal qemu error, the VM shouldn&#039;t start but you&#039;re saying you get that error on shutdown.&#160; I don&#039;t see how that&#039;s possible.&#160; You say you have the kernel commandline enabled for pci-stub, but is it effective?&#160; Does /proc/cmdline show the option?&#160; Is pci-stub built statically into your kernel?&#160; If pci-stub is a module then it becomes non-deterministic which pci-stub gets a shot at rebinding to the GPU before the native driver, it all depends on which module loaded first.&#160; But event that&#039;s still confusing because your raw qemu script doesn&#039;t appear to be unbinding devices when finished.&#160; I don&#039;t recommend vfio-bind anymore, and that itself should be causing you trouble if it&#039;s doing more than binding endpoint devices to vfio-pci.</p></div></blockquote></div><p>So I double-checked my kernel config and it turns out that CONFIG_PCI_STUB was set to module, so I changed it and recompiled.<br />I haven&#039;t had a crash yet, but I haven&#039;t tested as much yet. Thanks so far though!</p><p>However this brings me to my next couple of issues: sound and CPU performance.<br />Running 3DMark gives me bad scores on my CPU (http://www.3dmark.com/3dm/7000311?) (See the physics score, the average for my processor is around 11940).<br />In addition, the GTA V benchmark gives me scores around 15-20fps on the GTX 980.<br />I have 4100 2048KB hugepages set up and QEMU is using nearly all of them.<br />Is this a chipset issue and I just have to be patient for kernel 4.2? Is there a patch other than the ACS one in the OP?</p><p>And finally on the sound front, I am getting heavily distorted sound from standalone QEMU setup, I&#039;m using hda for the qemu soundhw option and the following flags:</p><div class="codebox"><pre><code>export QEMU_ALSA_DAC_BUFFER_SIZE=512 export QEMU_ALSA_DAC_PERIOD_SIZE=170 export QEMU_AUDIO_DRV=alsa export QEMU_AUDIO_DAC_FIXED_SETTINGS=1 export QEMU_AUDIO_DAC_FIXED_FREQ=48000 export QEMU_AUDIO_DAC_FIXED_FMT=S16 export QEMU_SDL_SAMPLES=1024</code></pre></div><p>However on VM boot, I get the following errors:</p><div class="codebox"><pre><code>alsa: Requested buffer size 512 was rejected, using 2048 alsa: Requested period size 170 was rejected, using 1024</code></pre></div><p>Again, both of these are probably small things I&#039;m missing, but I&#039;ve been working on all these problems combined for a couple of weeks now, so I&#039;m at my wits end.</p> <p class="postedit"><em>Last edited by marca311 (2015-05-17 19:46:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529641">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529647" class="blockpost rowodd"> <h2><span><span class="conr">#5115</span> <a href="viewtopic.php?pid=1529647#p1529647">2015-05-17 19:58:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@marca311, it looks like you&#039;ve done no tuning aside from hugepages and host CPU type.&#160; You&#039;re using emulated audio, default IDE disk, default rtl network, user mode networking, not attempting to pin vCPU threads...&#160; you&#039;ve got work to do before complaining about performance.&#160; Nothing you&#039;re seeing has anything to do with chipset or the patch in 4.2 that&#039;s not even relevant to you.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529647">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529675" class="blockpost roweven"> <h2><span><span class="conr">#5116</span> <a href="viewtopic.php?pid=1529675#p1529675">2015-05-17 21:24:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=29361">Jimi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/29361.png?m=1431898807" width="80" height="80" alt="" /></dd> <dd><span>From: Brooklyn, NY</span></dd> <dd><span>Registered: 2009-09-25</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=29361">Email</a></span> <span class="website"><a href="http://jzelinskie.com" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does anyone have this working with an LGA 1150 CPU/mobo?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://github.com/jzelinskie" rel="nofollow">github</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529675">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529681" class="blockpost rowodd"> <h2><span><span class="conr">#5117</span> <a href="viewtopic.php?pid=1529681#p1529681">2015-05-17 21:33:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>patch in 4.2</p></div></blockquote></div><p>If it&#039;s not X79 and X99, then what is 9-series chipsets?.. Those for LGA 1151(yeah, that one pin was very necessary) skylake(i7-5XXX) like H150 or what was it? Or what? Haven&#039;t seen that chipset belonging to people here...<br /><a href="http://en.wikipedia.org/wiki/LGA_1150" rel="nofollow">Here</a>: &quot;On May 12, 2014, Intel announced the release of two 9-series chipsets, H97 and Z97.&quot;<br />Oh wait, then what is X79/X99?..</p><p>@marca311</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You&#039;re using emulated audio, default IDE disk, default rtl network, user mode networking, not attempting to pin vCPU threads...</p></div></blockquote></div><p>Emulated audio: i don&#039;t know what he meant...<br />Default IDE disk: Use virtio-blk-pci like -device virtio-blk-pci,drive=disk1 and try playing with x-data-plane and caching, maybe others will suggest you their best options combos.<br />Default rtl network and user mode networking: tun/tap networking is very fast and somewhat simple to manage: <a href="https://wiki.archlinux.org/index.php/QEMU#Tap_networking_with_QEMU" rel="nofollow">here</a>, have a link to read, i&#039;m not sure if it&#039;s not outdated, but you get the idea.<br />vCPU pinning: <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Tuning_and_Optimization_Guide/sect-Virtualization_Tuning_Optimization_Guide-Virt_Manager-CPU_Options.html#idp4270912" rel="nofollow">redhat&#039;s awesome guide</a>, but it&#039;s for libvirt - for qemu command-line there was cpuset and even core NoHZ mode trickery with isolcpus, with which i&#039;m not so familiar(since i personally don&#039;t have spare cores to disable from host usage). I think there was something about it in the op-post.</p><p>In general - try swooping through the redhat&#039;s guide, it&#039;s darn awesome for performance improvements.</p><div class="quotebox"><cite>Jimi wrote:</cite><blockquote><div><p>Does anyone have this working with an LGA 1150 CPU/mobo?</p></div></blockquote></div><p>Have you checked <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">there</a>?<br />I think filtering by the motherboard will help, though i can&#039;t help you much with that question.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-17 21:41:19)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529681">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529686" class="blockpost roweven"> <h2><span><span class="conr">#5118</span> <a href="viewtopic.php?pid=1529686#p1529686">2015-05-17 21:39:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Jimi wrote:</cite><blockquote><div><p>Does anyone have this working with an LGA 1150 CPU/mobo?</p></div></blockquote></div><p>See part 1 of the guide in my sig</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529686">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529687" class="blockpost rowodd"> <h2><span><span class="conr">#5119</span> <a href="viewtopic.php?pid=1529687#p1529687">2015-05-17 21:42:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Jimi wrote:</cite><blockquote><div><p>Does anyone have this working with an LGA 1150 CPU/mobo?</p></div></blockquote></div><p>See part 1 of the guide in my sig</p></div></blockquote></div><p>I&#039;ve checked your blog a second after he posted this, and your xeon is 1155. Or am i misunderstanding something?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529688" class="blockpost roweven"> <h2><span><span class="conr">#5120</span> <a href="viewtopic.php?pid=1529688#p1529688">2015-05-17 21:44:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Jimi wrote:</cite><blockquote><div><p>Does anyone have this working with an LGA 1150 CPU/mobo?</p></div></blockquote></div><p>See part 1 of the guide in my sig</p></div></blockquote></div><p>I&#039;ve checked your blog a second after he posted this, and your xeon is 1155. Or am i misunderstanding something?</p></div></blockquote></div><p>Oops, you&#039;re right.&#160; I do have another B85/Haswell setup, that works, but it has very limited I/O.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529688">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529717" class="blockpost rowodd"> <h2><span><span class="conr">#5121</span> <a href="viewtopic.php?pid=1529717#p1529717">2015-05-17 23:40:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=29361">Jimi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/29361.png?m=1431898807" width="80" height="80" alt="" /></dd> <dd><span>From: Brooklyn, NY</span></dd> <dd><span>Registered: 2009-09-25</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=29361">Email</a></span> <span class="website"><a href="http://jzelinskie.com" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>See part 1 of the guide in my sig</p></div></blockquote></div><p>I&#039;ve checked your blog a second after he posted this, and your xeon is 1155. Or am i misunderstanding something?</p></div></blockquote></div><p>Oops, you&#039;re right.&#160; I do have another B85/Haswell setup, that works, but it has very limited I/O.</p></div></blockquote></div><p>I found a bunch of setups listed in <a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=2" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=2</a></p><p>Looks like my odds are good finally having Linux as the main OS on my home gaming PC.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://github.com/jzelinskie" rel="nofollow">github</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529732" class="blockpost roweven"> <h2><span><span class="conr">#5122</span> <a href="viewtopic.php?pid=1529732#p1529732">2015-05-18 01:55:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, managed to convert my existing qemu script Win 7 Bios setup to a OVMF/libvirt/Uefi setup without data loss or reinstallation.&#160; However I note that Win XP Mode no longer works.&#160; Anyone else trying to run Win XP mode under KVM? I tried hiding the VM with the &lt;KVM&gt; hidden=on without success.&#160; Realize it&#039;s a little OT.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529732">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529735" class="blockpost rowodd"> <h2><span><span class="conr">#5123</span> <a href="viewtopic.php?pid=1529735#p1529735">2015-05-18 02:15:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>So, managed to convert my existing qemu script Win 7 Bios setup to a OVMF/libvirt/Uefi setup without data loss or reinstallation.&#160; However I note that Win XP Mode no longer works.&#160; Anyone else trying to run Win XP mode under KVM? I tried hiding the VM with the &lt;KVM&gt; hidden=on without success.&#160; Realize it&#039;s a little OT.</p></div></blockquote></div><p>Doesn&#039;t XP mode just require nested virt?&#160; So you need to add <em>options kvm_intel nested=1</em> (or <em>kvm_amd</em>) to a modprobe.d conf file, then expose the feature on the CPU using:</p><div class="quotebox"><blockquote><div><p>&lt;cpu mode=&#039;host-passthrough&#039;&gt;<br />&#160; &#160; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt;<br />&#160; &#160; <strong>&lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt;</strong><br />&#160; &lt;/cpu&gt;</p></div></blockquote></div><p>I haven&#039;t tried XP mode, but that makes cpu-z show the vt-x flag.</p><p>EDIT: Seems like just enabling the module option is enough, cpu-z shows vt-x regardless of the extra feature flag as long as nested is enabled in the kernel module.</p> <p class="postedit"><em>Last edited by aw (2015-05-18 02:28:30)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529735">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529792" class="blockpost roweven"> <h2><span><span class="conr">#5124</span> <a href="viewtopic.php?pid=1529792#p1529792">2015-05-18 09:40:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>regarding motherboard selection, I have good experience with SuperMicro X9DA7 (which probably is not what you want because it&#039;s getting long in tooth and is 2 socket). From this experience I would guess that newer workstation class (single socket) X10 motherboards would be worth a try. Thinking about X10SRA in particular; its chipset is C612</p> <p class="postedit"><em>Last edited by Bronek (2015-05-18 10:09:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529792">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1529855" class="blockpost rowodd"> <h2><span><span class="conr">#5125</span> <a href="viewtopic.php?pid=1529855#p1529855">2015-05-18 15:34:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ll give the VMT option a try, but Windows isn&#039;t complaining about lack of virtualization ability.&#160; It has a DCOM error in the Event viewer similar to <a href="http://superuser.com/questions/282994/windows-xp-mode-wont-start-in-win7-64-bit-server-execution-failed" rel="nofollow">http://superuser.com/questions/282994/w … ion-failed</a> Bear in mind that the same installation worked under qemu script.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1529855">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=204">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=203">203</a> <a href="viewtopic.php?id=162768&amp;p=204">204</a> <strong>205</strong> <a href="viewtopic.php?id=162768&amp;p=206">206</a> <a href="viewtopic.php?id=162768&amp;p=207">207</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=206">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
