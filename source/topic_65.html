<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 65) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=65" title="Page 65" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=64" title="Page 64" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=66" title="Page 66" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=64">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=63">63</a> <a href="viewtopic.php?id=162768&amp;p=64">64</a> <strong>65</strong> <a href="viewtopic.php?id=162768&amp;p=66">66</a> <a href="viewtopic.php?id=162768&amp;p=67">67</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=66">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1409987" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1601</span> <a href="viewtopic.php?pid=1409987#p1409987">2014-04-28 21:36:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>how do I fix that? <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p></div></blockquote></div><p>Enable the IOMMU!</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409987">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409992" class="blockpost roweven"> <h2><span><span class="conr">#1602</span> <a href="viewtopic.php?pid=1409992#p1409992">2014-04-28 21:53:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>how do I fix that? <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p></div></blockquote></div><p>Enable the IOMMU!</p></div></blockquote></div><p>Like this?</p><div class="codebox"><pre><code>Kernel command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=298f5fd5-65b3-4f84-9de7-046660a66597 rw quiet intel_iommu=1 pci-stub.ids=10de:1189,10de:0e0a</code></pre></div><p>That isn&#039;t enough it would seem.<br />What part did I miss?</p> <p class="postedit"><em>Last edited by rabcor (2014-04-28 21:56:07)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409992">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410005" class="blockpost rowodd"> <h2><span><span class="conr">#1603</span> <a href="viewtopic.php?pid=1410005#p1410005">2014-04-28 22:19:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>how do I fix that? <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p></div></blockquote></div><p>Enable the IOMMU!</p></div></blockquote></div><p>Like this?</p><div class="codebox"><pre><code>Kernel command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=298f5fd5-65b3-4f84-9de7-046660a66597 rw quiet intel_iommu=1 pci-stub.ids=10de:1189,10de:0e0a</code></pre></div><p>That isn&#039;t enough it would seem.<br />What part did I miss?</p></div></blockquote></div><p>intel_iommu=on and make sure it&#039;s enabled in your BIOS and supported by your processor (ark.intel.com)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410005">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410010" class="blockpost roweven"> <h2><span><span class="conr">#1604</span> <a href="viewtopic.php?pid=1410010#p1410010">2014-04-28 22:27:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks! it was the &quot;intel_iommu=on&quot; part instead of 1 <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> however:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 5 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 5 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I read <a href="https://bbs.archlinux.org/viewtopic.php?pid=1345641#p1345641" rel="nofollow">a post</a> (by you) saying I need the ACS override patch. I installed the linux mainline kernel from the OP which should have this patch, but still no luck. I am also using the nouveau drivers as is rather than the proprietary drivers. So it&#039;s not that I need to patch my gpu drivers I would think.</p> <p class="postedit"><em>Last edited by rabcor (2014-04-28 23:13:09)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410010">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410034" class="blockpost rowodd"> <h2><span><span class="conr">#1605</span> <a href="viewtopic.php?pid=1410034#p1410034">2014-04-29 00:53:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Thanks! it was the &quot;intel_iommu=on&quot; part instead of 1 <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> however:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error, group 5 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 5 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I read <a href="https://bbs.archlinux.org/viewtopic.php?pid=1345641#p1345641" rel="nofollow">a post</a> (by you) saying I need the ACS override patch. I installed the linux mainline kernel from the OP which should have this patch, but still no luck. I am also using the nouveau drivers as is rather than the proprietary drivers. So it&#039;s not that I need to patch my gpu drivers I would think.</p></div></blockquote></div><p>And notice how the patch in that link requires kernel command line options to enable:</p><div class="codebox"><pre><code>--- a/Documentation/kernel-parameters.txt +++ b/Documentation/kernel-parameters.txt @@ -2349,6 +2349,16 @@ bytes respectively. Such letter suffixes can also be entirely omitted. nomsi Do not use MSI for native PCIe PME signaling (this makes all PCIe root ports use INTx for all services). + pcie_acs_override = + [PCIE] Override missing PCIe ACS support for: + downstream + All downstream ports - full ACS capabilties + multifunction + All multifunction devices - multifunction ACS subset + id:nnnn:nnnn + Specfic device - full ACS capabilities + Specified as vid:did (vendor/device ID) in hex +</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410034">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410041" class="blockpost roweven"> <h2><span><span class="conr">#1606</span> <a href="viewtopic.php?pid=1410041#p1410041">2014-04-29 01:17:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ah, so essentially add &quot;pcie_acs_override=downstream&quot; to command line?&#160; this seems to have worked, thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Qemu now opens as a blank window. However, the passthroughed card is giving no signals. (Monitor says &quot;No Video Input&quot;)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410041">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410042" class="blockpost rowodd"> <h2><span><span class="conr">#1607</span> <a href="viewtopic.php?pid=1410042#p1410042">2014-04-29 01:19:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dear All,</p><p>Is it possible to fix:</p><div class="codebox"><pre><code>... Apr 29 07:11:48 dhcppc5 kernel: dmar: DRHD: handling fault status reg 3 Apr 29 07:11:48 dhcppc5 kernel: dmar: DMAR:[DMA Write] Request device [04:00.0] fault addr 7ff96000 DMAR:[fault reason 02] Present bit in context entry is clear Apr 29 07:11:48 dhcppc5 kernel: dmar: DRHD: handling fault status reg 3 Apr 29 07:11:48 dhcppc5 kernel: dmar: DMAR:[DMA Write] Request device [04:00.0] fault addr 7ff96000 DMAR:[fault reason 02] Present bit in context entry is clear ...</code></pre></div><p>The root of the issue is DVB card</p><div class="codebox"><pre><code>04:02.0 Multimedia controller [0480]: Philips Semiconductors SAA7146 [1131:7146] (rev 01)</code></pre></div><p>PCI tree:</p><div class="codebox"><pre><code>-[0000:00]-+-00.0 Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor DRAM Controller +-01.0-[01]--+-00.0 NVIDIA Corporation GK107 [GeForce GT 640] | \-00.1 NVIDIA Corporation GK107 HDMI Audio Controller +-02.0 Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller +-14.0 Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller +-16.0 Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 +-1a.0 Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 +-1b.0 Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller +-1c.0-[02]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] +-1c.4-[03-04]----00.0-[04]----02.0 Philips Semiconductors SAA7146</code></pre></div><p>The messages aboves occurs if DVB card is passed to VM via:</p><div class="codebox"><pre><code>-device vfio-pci,host=03:00.0,bus=pcie.0 \ -device vfio-pci,host=04:02.0,bus=pcie.0 \</code></pre></div><p>If try to use DVB card on the host - host freezes.<br />Could you please help me to find a way how to use a dvb card (in VM or in Host - it does not matter)<br />Thank you in advance.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410042">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410043" class="blockpost roweven"> <h2><span><span class="conr">#1608</span> <a href="viewtopic.php?pid=1410043#p1410043">2014-04-29 01:21:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Dear All,</p><p>Is it possible to fix:</p><div class="codebox"><pre><code>... Apr 29 07:11:48 dhcppc5 kernel: dmar: DRHD: handling fault status reg 3 Apr 29 07:11:48 dhcppc5 kernel: dmar: DMAR:[DMA Write] Request device [04:00.0] fault addr 7ff96000 DMAR:[fault reason 02] Present bit in context entry is clear Apr 29 07:11:48 dhcppc5 kernel: dmar: DRHD: handling fault status reg 3 Apr 29 07:11:48 dhcppc5 kernel: dmar: DMAR:[DMA Write] Request device [04:00.0] fault addr 7ff96000 DMAR:[fault reason 02] Present bit in context entry is clear ...</code></pre></div><p>The root of the issue is DVB card</p><div class="codebox"><pre><code>04:02.0 Multimedia controller [0480]: Philips Semiconductors SAA7146 [1131:7146] (rev 01)</code></pre></div><p>PCI tree:</p><div class="codebox"><pre><code>-[0000:00]-+-00.0 Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor DRAM Controller +-01.0-[01]--+-00.0 NVIDIA Corporation GK107 [GeForce GT 640] | \-00.1 NVIDIA Corporation GK107 HDMI Audio Controller +-02.0 Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller +-14.0 Intel Corporation 7 Series/C210 Series Chipset Family USB xHCI Host Controller +-16.0 Intel Corporation 7 Series/C210 Series Chipset Family MEI Controller #1 +-1a.0 Intel Corporation 7 Series/C210 Series Chipset Family USB Enhanced Host Controller #2 +-1b.0 Intel Corporation 7 Series/C210 Series Chipset Family High Definition Audio Controller +-1c.0-[02]--+-00.0 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750] | \-00.1 Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] +-1c.4-[03-04]----00.0-[04]----02.0 Philips Semiconductors SAA7146</code></pre></div><p>The messages aboves occurs if DVB card is passed to VM via:</p><div class="codebox"><pre><code>-device vfio-pci,host=03:00.0,bus=pcie.0 \ -device vfio-pci,host=04:02.0,bus=pcie.0 \</code></pre></div><p>If try to use DVB card on the host - host freezes.<br />Could you please help me to find a way how to use a dvb card (in VM or in Host - it does not matter)<br />Thank you in advance.</p></div></blockquote></div><p>What&#039;s the bridge device at 3:00.0?&#160; lspci -vvv -s 3:00.0</p><p>EDIT: Oh, you&#039;re passing 3:00.0 to the guest, never pass the bridge, this shouldn&#039;t even be allowed</p> <p class="postedit"><em>Last edited by aw (2014-04-29 01:22:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410043">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410047" class="blockpost rowodd"> <h2><span><span class="conr">#1609</span> <a href="viewtopic.php?pid=1410047#p1410047">2014-04-29 01:47:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>What&#039;s the bridge device at 3:00.0?&#160; lspci -vvv -s 3:00.0</p></div></blockquote></div><div class="codebox"><pre><code>03:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) (prog-if 01 [Subtractive decode]) Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Bus: primary=03, secondary=04, subordinate=04, sec-latency=32 I/O behind bridge: 0000f000-00000fff Memory behind bridge: f7900000-f79fffff Prefetchable memory behind bridge: 00000000fff00000-00000000000fffff Secondary status: 66MHz+ FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort+ &lt;SERR- &lt;PERR- BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- &gt;Reset- FastB2B- PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn- Capabilities: [c0] Subsystem: ASRock Incorporation Motherboard</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410047">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410061" class="blockpost roweven"> <h2><span><span class="conr">#1610</span> <a href="viewtopic.php?pid=1410061#p1410061">2014-04-29 03:21:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m seeing someone had <a href="https://bbs.archlinux.org/viewtopic.php?pid=1328198#p1328198" rel="nofollow">a similar problem</a> to my own with unpatched nvidia drivers, I want to take a shot at patching the nvidia drivers instead of using nouveau, but I have no idea how to actually apply the patch to the drivers, can somebody point me in the right direction please?</p> <p class="postedit"><em>Last edited by rabcor (2014-04-29 03:28:18)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410061">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410067" class="blockpost rowodd"> <h2><span><span class="conr">#1611</span> <a href="viewtopic.php?pid=1410067#p1410067">2014-04-29 03:34:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I&#039;m seeing someone had <a href="https://bbs.archlinux.org/viewtopic.php?pid=1328198#p1328198" rel="nofollow">a similar problem</a> to my own with unpatched nvidia drivers, I want to take a shot at patching the nvidia drivers instead of using nouveau, but I have no idea how to actually apply the patch to the drivers, can somebody point me in the right direction please?</p></div></blockquote></div><p>I think I have a old gist somewhere with a pkgbuild… lets see. <a href="https://gist.github.com/ajs124/8491428" rel="nofollow">Here you go!</a>.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410067">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410081" class="blockpost roweven"> <h2><span><span class="conr">#1612</span> <a href="viewtopic.php?pid=1410081#p1410081">2014-04-29 04:29:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, download nvidia-dkms.install from <a href="https://aur.archlinux.org/packages/nvidia-dkms/" rel="nofollow">here</a>, and update pkgver to 337.12 and md5sum to &#039;c610d5bff8f7f758dc25fdd51b1b65eb&#039; right? Thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> would be nice to have something similar setup for the kernel ACS patch, too bad I don&#039;t know how to set that up.</p> <p class="postedit"><em>Last edited by rabcor (2014-04-29 04:30:53)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410081">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410196" class="blockpost rowodd"> <h2><span><span class="conr">#1613</span> <a href="viewtopic.php?pid=1410196#p1410196">2014-04-29 12:56:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I have the same error as gneville ( <a href="https://bbs.archlinux.org/viewtopic.php?pid=1403248#p1403248" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1403248</a> ).<br />VGA Passthrough works when I launch windows but if I reboot or stop and then launch again, I have this message&amp;BSOD (PAGE_FAULT_IN_NONPAGED_AREA). It is just after the loading of windows (black background) and just before the launch of the desktop. It is exactly at this moment that the screen resolution must change.</p><p>Résumé:<br />- If I launch windows with my VM then stop windows and the VM, then reboot the host, and launch the VM again, it works.<br />- If I launch windows with my VM then stop windows and the VM, then launch the VM again, there is this BSOD.</p><p>Any Idea?<br />have you find a solution gneville?</p><p>My last tried configuration is :</p><div class="quotebox"><blockquote><div><p>MB : ASUS H87M-PLUS<br />GPU : Radeon R7 260X<br />RAM : 8Go<br />CPU : i5 4570 <br />Qemu : <a href="http://wiki.qemu-project.org/download/qemu-2.0.0.tar.bz2" rel="nofollow">http://wiki.qemu-project.org/download/q … .0.tar.bz2</a><br />Kernel : <a href="https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.14.1.tar.xz" rel="nofollow">https://www.kernel.org/pub/linux/kernel … 4.1.tar.xz</a><br />patch -Np1 -i override_for_missing_acs_capabilities.patch<br />patch -Np1 -i i915_314.patch</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>/usr/local/bin/qemu-system-x86_64 \<br />-enable-kvm -M q35 -m 4G -cpu host \<br />-balloon none&#160; -rtc clock=host&#160; -serial null&#160; -parallel null&#160; -monitor none&#160; -display none \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-drive file=/home/ja/VM/windows2.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \<br />-net nic -net tap,ifname=tap0,script=no,downscript=no \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on</p></div></blockquote></div><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>I&#039;ve just found something interesting with my setup.</p><p>I can get around the BSOD on Windows boot after installing the drivers, providing I do a fresh reload of the Host. I also had to remove the HDMI Audio from the ioh3420 device.</p><p>Edit: Confirmed this is the same for Win7 &amp; Win8 as a Guest</p><p>But provided I reboot the Host everytime I boot the Windows Guest with the below qemu commands it will start up and use the AMD drivers correctly, if I then reboot the Guest or Shutdown and restart the Qemu again from Command line then Windows will BSOD on boot with the &quot;PAGE_FAULT_IN_NONPAGED_AREA&quot; error.</p><p>Any ideas what can be causing this please?</p><p>/usr/local/qemu-xen-4-4-git-patched/bin/qemu-system-x86_64 -name win8 -enable-kvm -M q35 -m 6144&#160; \<br />-cpu Haswell,hv-time,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 \<br />-boot order=dc \<br />-smp 2,sockets=1,cores=2,threads=1 \<br />-bios /home/xen/vfio/bios.bin -vga none \<br />-usb -usbdevice tablet \<br />-spice port=5902,disable-ticketing \<br />-vnc 0.0.0.0:0 \<br />-net nic \<br />-net tap,ifname=tap0,script=no,downscript=no \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=pcie.0 \<br />-device vfio-pci,host=00:14.0,bus=pcie.0 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/dev/mapper/vg1-winv1,media=disk,index=1,id=disk,cache=none,if=virtio \<br />-drive file=/dev/mapper/vg1-winv1data,media=disk,index=2,id=diskb,cache=none,if=virtio \<br />-drive file=/home/xen/iso/windows/en-gb_windows_8_1_enterprise_x64_dvd_2971910.iso,boot=on,media=cdrom,index=3,id=isocd&#160; \<br />-device ide-cd,bus=ahci.1,drive=isocd \<br />-drive file=/root/virtio-win-0.1-74.iso,media=cdrom,index=4,id=virtio&#160; \<br />-device ide-cd,bus=ahci.2,drive=virtio</p><br /><br /><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Still not having much luck with vfio vga passthrough on my AMD R9 290 <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I&#039;ve tried pretty much all the suggestions I&#039;ve seen on here but no matter what I try the guest always crashes after installing video drivers.</p><p>I did swap from Win8 to Win7 and noticed that after installing the video drivers and rebooting when windows boots up it crashes with a BSOD saying</p><p>&quot;PAGE_FAULT_IN_NONPAGED_AREA&quot;</p><p>I&#039;ve tried the following:<br />multiple linux kernels all with the patches rolled in.<br />multiple Qemu versions (1.7.0, 1.7.1, 2.0.0RC0,1 &amp;2) and have applied the vga reset patches<br />Tried both machine types of q35 and i440fx, of which both successfully passthrough the vga card but crash after installing the drivers and rebooting windows<br />Tried just passing through the Video card leaving out the HDMI Audio.<br />Tried installing drivers without installing the Catalyst Control Centre as suggested by some other forums.<br />Tried both AMD drivers and Windows Provided drivers via Windows Updates.<br />Tried using RomFiles </p><p>I&#039;m guessing the problem lies within Qemu somewhere.</p><br /><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>On top of this I have just installed the OP linux-mainline (3.13.6-1-mainline),seabios (1.7.4.r1788.g8abc6a8-1) &amp; qemu (2.0.r31714.g03d5142-1) versions (Just added reset patch and manually compiled (<a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00767.html)" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 0767.html)</a>)</p><p>and still no change <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div></div></blockquote></div></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410196">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410374" class="blockpost roweven"> <h2><span><span class="conr">#1614</span> <a href="viewtopic.php?pid=1410374#p1410374">2014-04-29 21:22:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi adejour,</p><p>Yes I managed to fix the bsods on reboots by following the instructions this guy had in his blog <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a> it works perfectly now.</p><br /><br /><div class="quotebox"><cite>adejour wrote:</cite><blockquote><div><p>Hello,</p><p>I have the same error as gneville ( <a href="https://bbs.archlinux.org/viewtopic.php?pid=1403248#p1403248" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1403248</a> ).<br />VGA Passthrough works when I launch windows but if I reboot or stop and then launch again, I have this message&amp;BSOD (PAGE_FAULT_IN_NONPAGED_AREA). It is just after the loading of windows (black background) and just before the launch of the desktop. It is exactly at this moment that the screen resolution must change.</p><p>Résumé:<br />- If I launch windows with my VM then stop windows and the VM, then reboot the host, and launch the VM again, it works.<br />- If I launch windows with my VM then stop windows and the VM, then launch the VM again, there is this BSOD.</p><p>Any Idea?<br />have you find a solution gneville?</p><p>My last tried configuration is :</p><div class="quotebox"><blockquote><div><p>MB : ASUS H87M-PLUS<br />GPU : Radeon R7 260X<br />RAM : 8Go<br />CPU : i5 4570 <br />Qemu : <a href="http://wiki.qemu-project.org/download/qemu-2.0.0.tar.bz2" rel="nofollow">http://wiki.qemu-project.org/download/q … .0.tar.bz2</a><br />Kernel : <a href="https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.14.1.tar.xz" rel="nofollow">https://www.kernel.org/pub/linux/kernel … 4.1.tar.xz</a><br />patch -Np1 -i override_for_missing_acs_capabilities.patch<br />patch -Np1 -i i915_314.patch</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>/usr/local/bin/qemu-system-x86_64 \<br />-enable-kvm -M q35 -m 4G -cpu host \<br />-balloon none&#160; -rtc clock=host&#160; -serial null&#160; -parallel null&#160; -monitor none&#160; -display none \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-bios /usr/share/qemu/bios.bin -vga none \<br />-drive file=/home/ja/VM/windows2.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \<br />-net nic -net tap,ifname=tap0,script=no,downscript=no \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on</p></div></blockquote></div><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>I&#039;ve just found something interesting with my setup.</p><p>I can get around the BSOD on Windows boot after installing the drivers, providing I do a fresh reload of the Host. I also had to remove the HDMI Audio from the ioh3420 device.</p><p>Edit: Confirmed this is the same for Win7 &amp; Win8 as a Guest</p><p>But provided I reboot the Host everytime I boot the Windows Guest with the below qemu commands it will start up and use the AMD drivers correctly, if I then reboot the Guest or Shutdown and restart the Qemu again from Command line then Windows will BSOD on boot with the &quot;PAGE_FAULT_IN_NONPAGED_AREA&quot; error.</p><p>Any ideas what can be causing this please?</p><p>/usr/local/qemu-xen-4-4-git-patched/bin/qemu-system-x86_64 -name win8 -enable-kvm -M q35 -m 6144&#160; \<br />-cpu Haswell,hv-time,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 \<br />-boot order=dc \<br />-smp 2,sockets=1,cores=2,threads=1 \<br />-bios /home/xen/vfio/bios.bin -vga none \<br />-usb -usbdevice tablet \<br />-spice port=5902,disable-ticketing \<br />-vnc 0.0.0.0:0 \<br />-net nic \<br />-net tap,ifname=tap0,script=no,downscript=no \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=pcie.0 \<br />-device vfio-pci,host=00:14.0,bus=pcie.0 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/dev/mapper/vg1-winv1,media=disk,index=1,id=disk,cache=none,if=virtio \<br />-drive file=/dev/mapper/vg1-winv1data,media=disk,index=2,id=diskb,cache=none,if=virtio \<br />-drive file=/home/xen/iso/windows/en-gb_windows_8_1_enterprise_x64_dvd_2971910.iso,boot=on,media=cdrom,index=3,id=isocd&#160; \<br />-device ide-cd,bus=ahci.1,drive=isocd \<br />-drive file=/root/virtio-win-0.1-74.iso,media=cdrom,index=4,id=virtio&#160; \<br />-device ide-cd,bus=ahci.2,drive=virtio</p><br /><br /><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Still not having much luck with vfio vga passthrough on my AMD R9 290 <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>I&#039;ve tried pretty much all the suggestions I&#039;ve seen on here but no matter what I try the guest always crashes after installing video drivers.</p><p>I did swap from Win8 to Win7 and noticed that after installing the video drivers and rebooting when windows boots up it crashes with a BSOD saying</p><p>&quot;PAGE_FAULT_IN_NONPAGED_AREA&quot;</p><p>I&#039;ve tried the following:<br />multiple linux kernels all with the patches rolled in.<br />multiple Qemu versions (1.7.0, 1.7.1, 2.0.0RC0,1 &amp;2) and have applied the vga reset patches<br />Tried both machine types of q35 and i440fx, of which both successfully passthrough the vga card but crash after installing the drivers and rebooting windows<br />Tried just passing through the Video card leaving out the HDMI Audio.<br />Tried installing drivers without installing the Catalyst Control Centre as suggested by some other forums.<br />Tried both AMD drivers and Windows Provided drivers via Windows Updates.<br />Tried using RomFiles </p><p>I&#039;m guessing the problem lies within Qemu somewhere.</p></div></blockquote></div></div></blockquote></div></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410374">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410391" class="blockpost rowodd"> <h2><span><span class="conr">#1615</span> <a href="viewtopic.php?pid=1410391#p1410391">2014-04-29 23:06:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>What&#039;s the bridge device at 3:00.0?&#160; lspci -vvv -s 3:00.0</p></div></blockquote></div><div class="codebox"><pre><code>03:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) (prog-if 01 [Subtractive decode]) Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Bus: primary=03, secondary=04, subordinate=04, sec-latency=32 I/O behind bridge: 0000f000-00000fff Memory behind bridge: f7900000-f79fffff Prefetchable memory behind bridge: 00000000fff00000-00000000000fffff Secondary status: 66MHz+ FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort+ &lt;SERR- &lt;PERR- BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- &gt;Reset- FastB2B- PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn- Capabilities: [c0] Subsystem: ASRock Incorporation Motherboard</code></pre></div></div></blockquote></div><p><strong>Alex</strong>,<br />Is it correct that ASMedia pci bridge is root cause of &quot;DMAR:[fault reason 02] Present bit in context entry is clear&quot; issue?<br />Is it correct that it is a known issue and there is no way to fix it and it&#039;s impossible to use any PCI devices while IOMMU is turned on?</p><p>Thank you!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410391">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410538" class="blockpost roweven"> <h2><span><span class="conr">#1616</span> <a href="viewtopic.php?pid=1410538#p1410538">2014-04-30 10:02:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Hi adejour,</p><p>Yes I managed to fix the bsods on reboots by following the instructions this guy had in his blog <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a> it works perfectly now.</p><div class="quotebox"><cite>adejour wrote:</cite><blockquote><div><p>Hello,</p><p>I have the same error as gneville ( <a href="https://bbs.archlinux.org/viewtopic.php?pid=1403248#p1403248" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1403248</a> ).<br />VGA Passthrough works when I launch windows but if I reboot or stop and then launch again, I have this message&amp;BSOD (PAGE_FAULT_IN_NONPAGED_AREA). It is just after the loading of windows (black background) and just before the launch of the desktop. It is exactly at this moment that the screen resolution must change.</p><p>Résumé:<br />- If I launch windows with my VM then stop windows and the VM, then reboot the host, and launch the VM again, it works.<br />- If I launch windows with my VM then stop windows and the VM, then launch the VM again, there is this BSOD.</p></div></blockquote></div></div></blockquote></div><p>Ok, it seems to be a good software workaround and I will try that. Thank you very much !</p><p>Anyway it doesn&#039;t explain the real problem. When the VM shutdown, the VM turns off but the screen still display the last image (windows blue background with &quot;windows is shuting down&quot; (or something like that, my windows is not in english)).<br />=&gt; qemu doesn&#039;t switch off my GPU, and the screen stays on !</p><p>Do you know if it is a pbroblem with qemu? Or may be with the bios used with qemu?<br />Any idea to fix this ?!</p> <p class="postedit"><em>Last edited by adejour (2014-04-30 10:02:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410538">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410578" class="blockpost rowodd"> <h2><span><span class="conr">#1617</span> <a href="viewtopic.php?pid=1410578#p1410578">2014-04-30 13:07:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>What&#039;s the bridge device at 3:00.0?&#160; lspci -vvv -s 3:00.0</p></div></blockquote></div><div class="codebox"><pre><code>03:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03) (prog-if 01 [Subtractive decode]) Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Bus: primary=03, secondary=04, subordinate=04, sec-latency=32 I/O behind bridge: 0000f000-00000fff Memory behind bridge: f7900000-f79fffff Prefetchable memory behind bridge: 00000000fff00000-00000000000fffff Secondary status: 66MHz+ FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort+ &lt;SERR- &lt;PERR- BridgeCtl: Parity- SERR- NoISA- VGA- MAbort- &gt;Reset- FastB2B- PriDiscTmr- SecDiscTmr- DiscTmrStat- DiscTmrSERREn- Capabilities: [c0] Subsystem: ASRock Incorporation Motherboard</code></pre></div></div></blockquote></div><p><strong>Alex</strong>,<br />Is it correct that ASMedia pci bridge is root cause of &quot;DMAR:[fault reason 02] Present bit in context entry is clear&quot; issue?<br />Is it correct that it is a known issue and there is no way to fix it and it&#039;s impossible to use any PCI devices while IOMMU is turned on?</p><p>Thank you!</p></div></blockquote></div><p>This particular bridge likely produces a WARN_ON when booting the kernel on a VT-d system because it lacks a PCIe capability (in violation of the PCIe spec).&#160; As a result, I doubt that the IOMMU tables are getting setup correct for devices behind the bridge.&#160; I&#039;ve actually been working on trying to fix this for the last couple weeks.&#160; In any case, assigning the bridge to the guest is always wrong, so I&#039;d start with that.&#160; I&#039;ll hopefully be posting patches to fix the situation with this bridge this week or next.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410578">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410589" class="blockpost roweven"> <h2><span><span class="conr">#1618</span> <a href="viewtopic.php?pid=1410589#p1410589">2014-04-30 13:43:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Gneville, this guy had exactly the same pb reported to a qemu developper : <a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00905.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00905.html</a></p><p>Patch the vfio.c file was the solution for him. He has the R9 290X and I&#039;m using the R7 260X. I&#039;ll try.</p><p>I looked on the code, and it is may be linked to the Power Management Flag NoSoftRst (when you run lspci -vvv).<br />Can somebody who succeed in multiple reboots tell we what is the result of this command for him?</p><p>this part :</p><div class="quotebox"><blockquote><div><p>Capabilities: [70] Power Management version 3<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot+,D3cold-)<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-</p></div></blockquote></div><p>Thanks!</p><div class="quotebox"><cite>adejour wrote:</cite><blockquote><div><p>Ok, it seems to be a good software workaround and I will try that. Thank you very much !</p><p>Anyway it doesn&#039;t explain the real problem. When the VM shutdown, the VM turns off but the screen still display the last image (windows blue background with &quot;windows is shuting down&quot; (or something like that, my windows is not in english)).<br />=&gt; qemu doesn&#039;t switch off my GPU, and the screen stays on !</p><p>Do you know if it is a pbroblem with qemu? Or may be with the bios used with qemu?<br />Any idea to fix this ?!</p><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Hi adejour,</p><p>Yes I managed to fix the bsods on reboots by following the instructions this guy had in his blog <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a> it works perfectly now.</p><div class="quotebox"><cite>adejour wrote:</cite><blockquote><div><p>Hello,</p><p>I have the same error as gneville ( <a href="https://bbs.archlinux.org/viewtopic.php?pid=1403248#p1403248" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1403248</a> ).<br />VGA Passthrough works when I launch windows but if I reboot or stop and then launch again, I have this message&amp;BSOD (PAGE_FAULT_IN_NONPAGED_AREA). It is just after the loading of windows (black background) and just before the launch of the desktop. It is exactly at this moment that the screen resolution must change.</p><p>Résumé:<br />- If I launch windows with my VM then stop windows and the VM, then reboot the host, and launch the VM again, it works.<br />- If I launch windows with my VM then stop windows and the VM, then launch the VM again, there is this BSOD.</p></div></blockquote></div></div></blockquote></div></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410604" class="blockpost rowodd"> <h2><span><span class="conr">#1619</span> <a href="viewtopic.php?pid=1410604#p1410604">2014-04-30 14:41:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>adejour, I did spot that a while back and tried it but it didn&#039;t fix the BSOD issue when you reboot a guest or shutdown the guest and power it back on. I do have it applied to my current version of Qemu I&#039;m using.</p><p>From memory however, I believe it does kill the video output when the guest is killed so it may fix your issue there.</p><p>edit: FWIW this is my output of Power Management from &quot;lspci -vvv&quot; from my R290, with the guest having the card passed through running:</p><div class="quotebox"><blockquote><div><p>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Hawaii PRO (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Flags: PMEClk- DSI- D1+ D2+ AuxCurrent=0mA PME(D0-,D1+,D2+,D3hot+,D3cold-)<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-</p></div></blockquote></div><p>Cheers</p><div class="quotebox"><cite>adejour wrote:</cite><blockquote><div><p>Gneville, this guy had exactly the same pb reported to a qemu developper : <a href="https://lists.gnu.org/archive/html/qemu-devel/2014-02/msg00905.html" rel="nofollow">https://lists.gnu.org/archive/html/qemu … 00905.html</a></p><p>Patch the vfio.c file was the solution for him. He has the R9 290X and I&#039;m using the R7 260X. I&#039;ll try.</p><p>I looked on the code, and it is may be linked to the Power Management Flag NoSoftRst (when you run lspci -vvv).<br />Can somebody who succeed in multiple reboots tell we what is the result of this command for him?</p><p>this part :</p><div class="quotebox"><blockquote><div><p>Capabilities: [70] Power Management version 3<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot+,D3cold-)<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-</p></div></blockquote></div><p>Thanks!</p></div></blockquote></div> <p class="postedit"><em>Last edited by gneville (2014-04-30 14:47:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410910" class="blockpost roweven"> <h2><span><span class="conr">#1620</span> <a href="viewtopic.php?pid=1410910#p1410910">2014-05-01 10:28:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey together,</p><p>there`s something that bothers me and I hope somebody can give me an explaination for it:<br />My mainboard is a Asrock Z68 Pro3 Gen3.</p><div class="codebox"><pre><code>lspci | grep USB ⏎ 00:1a.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #2 (rev 05) 00:1d.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #1 (rev 05) 07:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>As you can see I have two usb 2.0 controllers. Initially I planned using a KVM switch to switch my keyboard/mouse between my VM an the host. So I added 00:1a.0 to pci-stub and binded it to vfio-pci, but I was still able to use the related ports on the host whenever I clicked the button on the KVM switch. Of course passthrough of 00:1a.0 to the VM didn&#039;t work either. Keyboard and mouse simply was usable on the host AND the VM (using parameter vga=std)</p><p>So I would like to know, if there is a reason why this controller behaves in this strange way. In the end, are these two controllers maybe the same device?<br />Anyway, I found Synergy being totally sufficient, but that issue still bugs me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>BR<br />apex</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410910">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410914" class="blockpost rowodd"> <h2><span><span class="conr">#1621</span> <a href="viewtopic.php?pid=1410914#p1410914">2014-05-01 10:53:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81662">maduraa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-01</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81662">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I followed the instructions with a stock kernel (3.14.1). When I run qemu(for testing using the commands given in the first post) I get no output from the passed through vga (nVidia 750GTX). But I do get a blank screen on qemu on the main display, I do not own another monitor so I ran the command and plugged the cable to the nVidia card to check whether it has the BIOS output as mentioned but that port is not on the monitor goes to standby when I plug it. I am using IGP as my primary VGA.</p><div class="codebox"><pre><code># ls -l /sys/bus/pci/drivers/vfio-pci/ total 0 lrwxrwxrwx 1 root root 0 May 1 15:31 0000:01:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.0/ lrwxrwxrwx 1 root root 0 May 1 15:31 0000:01:00.1 -&gt; ../../../../devices/pci0000:00/0000:00:01.0/0000:01:00.1/ --w------- 1 root root 4096 May 1 15:31 bind lrwxrwxrwx 1 root root 0 May 1 15:31 module -&gt; ../../../../module/vfio_pci/ --w------- 1 root root 4096 May 1 14:54 new_id --w------- 1 root root 4096 May 1 15:31 remove_id --w------- 1 root root 4096 May 1 14:54 uevent --w------- 1 root root 4096 May 1 15:31 unbind</code></pre></div><p>I installed Windows 7 on a VM and Windows is able to detect the card, I installed the drivers and then it got disabled by Windows(it says the devive didn&#039;t function as expected so it&#039;s disabled (code:43))</p><p>What can be the problem?</p><p>Thanks</p> <p class="postedit"><em>Last edited by maduraa (2014-05-01 10:54:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410914">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410931" class="blockpost roweven"> <h2><span><span class="conr">#1622</span> <a href="viewtopic.php?pid=1410931#p1410931">2014-05-01 11:34:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81662">maduraa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-01</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81662">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>spam wrote:</cite><blockquote><div><p>I&#039;ve been trying adding acs to my config but still had no luck my guest works only as a basic video card, I get a code 43 in windows. I am gonna try a linux guest to get traces. When I try to load a vbios with the romfile option my guest has no outputs at all. Is someone has an idea of what else could I try ? My gtx 660 is not UEFI compatible and I start my computer in UEFI mode, could it be a problem ?</p></div></blockquote></div><p>Are you using IGP and nvidia? I saw in an earlier post that the stock kernel wouldn&#039;t work this way, I&#039;m currently building the linux-mainline kernel will be back with updates. I get the same result with stock kernel see above post by me.</p><p>EDIT: I also tried the given kernel, seabios-git, qemu-git I get nothing on the passthru&#039;d VGA&#039;s output<br />EDIT2: I also tried with another monitor, I can confirm that the passthru&#039;d card doesn&#039;t display anything.</p> <p class="postedit"><em>Last edited by maduraa (2014-05-01 14:22:50)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410931">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1410941" class="blockpost rowodd"> <h2><span><span class="conr">#1623</span> <a href="viewtopic.php?pid=1410941#p1410941">2014-05-01 11:57:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>I had the same problem.</p><p>If you have xHCI enabled in you BIOS, this controler is used for both usb 3 and usb 2 ports.<br />If you disable xHCI / USB3 in the BIOS, you can send one controler as you did before,<br />else you have to send the USB 3 conroler to the VM</p><p>I think you can also send the &quot;device&quot; with &quot;-usb&quot; as explained in the first post of this thread.</p><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hey together,</p><p>there`s something that bothers me and I hope somebody can give me an explaination for it:<br />My mainboard is a Asrock Z68 Pro3 Gen3.</p><div class="codebox"><pre><code>lspci | grep USB ⏎ 00:1a.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #2 (rev 05) 00:1d.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #1 (rev 05) 07:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>As you can see I have two usb 2.0 controllers. Initially I planned using a KVM switch to switch my keyboard/mouse between my VM an the host. So I added 00:1a.0 to pci-stub and binded it to vfio-pci, but I was still able to use the related ports on the host whenever I clicked the button on the KVM switch. Of course passthrough of 00:1a.0 to the VM didn&#039;t work either. Keyboard and mouse simply was usable on the host AND the VM (using parameter vga=std)</p><p>So I would like to know, if there is a reason why this controller behaves in this strange way. In the end, are these two controllers maybe the same device?<br />Anyway, I found Synergy being totally sufficient, but that issue still bugs me <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>BR<br />apex</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1410941">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1411143" class="blockpost roweven"> <h2><span><span class="conr">#1624</span> <a href="viewtopic.php?pid=1411143#p1411143">2014-05-01 20:26:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This particular bridge likely produces a WARN_ON when booting the kernel on a VT-d system because it lacks a PCIe capability (in violation of the PCIe spec).&#160; As a result, I doubt that the IOMMU tables are getting setup correct for devices behind the bridge.&#160; I&#039;ve actually been working on trying to fix this for the last couple weeks.&#160; In any case, assigning the bridge to the guest is always wrong, so I&#039;d start with that.&#160; I&#039;ll hopefully be posting patches to fix the situation with this bridge this week or next.</p></div></blockquote></div><p>This is amazing news! <br />Could you please specify where are you going to upload/write info about fix (twitter, github, ... - how to follow news)?</p><p>Dear All,<br />Could you please help to setup VM via libvirt? I have created the following xml:</p><div class="codebox"><pre class="vscroll"><code>&lt;!-- WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit X or other application using the libvirt API. --&gt; &lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;X&lt;/name&gt; &lt;uuid&gt;9efa8a71-b193-c50b-c770-9ce6dad02390&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.0&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;clock offset=&#039;utc&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source dev=&#039;/dev/md1&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;/&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1e&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;/&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:4b:be:6d&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=pcie.0&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=00:1a.0,bus=pcie.0&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=00:1b.0,bus=pcie.0&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>VM started, but there is no VGA.</p><p>I use libvirt-git.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1411143">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1411158" class="blockpost rowodd"> <h2><span><span class="conr">#1625</span> <a href="viewtopic.php?pid=1411158#p1411158">2014-05-01 20:53:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This particular bridge likely produces a WARN_ON when booting the kernel on a VT-d system because it lacks a PCIe capability (in violation of the PCIe spec).&#160; As a result, I doubt that the IOMMU tables are getting setup correct for devices behind the bridge.&#160; I&#039;ve actually been working on trying to fix this for the last couple weeks.&#160; In any case, assigning the bridge to the guest is always wrong, so I&#039;d start with that.&#160; I&#039;ll hopefully be posting patches to fix the situation with this bridge this week or next.</p></div></blockquote></div><p>This is amazing news! <br />Could you please specify where are you going to upload/write info about fix (twitter, github, ... - how to follow news)?</p></div></blockquote></div><p>I posted the patches today, here&#039;s a link to the header with a description:</p><p><a href="http://www.spinics.net/lists/linux-pci/msg30941.html" rel="nofollow">http://www.spinics.net/lists/linux-pci/msg30941.html</a></p><p>For your convenience, I&#039;ve also pushed a branch out to github that is 3.15-rc3 + these changes, you&#039;ll need to add whatever other patches (i915/acs) on top:</p><p>git://github.com/awilliam/linux-vfio.git</p><p>branch: dma-alias</p><p>Let me know how it goes.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1411158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=64">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=63">63</a> <a href="viewtopic.php?id=162768&amp;p=64">64</a> <strong>65</strong> <a href="viewtopic.php?id=162768&amp;p=66">66</a> <a href="viewtopic.php?id=162768&amp;p=67">67</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=66">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
