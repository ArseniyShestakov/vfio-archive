<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 164) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=164" title="Page 164" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=163" title="Page 163" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=165" title="Page 165" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=163">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <strong>164</strong> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=165">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1499759" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4076</span> <a href="viewtopic.php?pid=1499759#p1499759">2015-02-04 15:29:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82709">flack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82709">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499759">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499766" class="blockpost roweven"> <h2><span><span class="conr">#4077</span> <a href="viewtopic.php?pid=1499766#p1499766">2015-02-04 15:53:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p></div></blockquote></div><p>Yes . Have a look at my VM :</p><div class="codebox"><pre><code>qemu-system-x86_64 -name main -nographic \ -enable-kvm -m 8192 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 \ -vga none -nodefconfig \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/VMs/ovmf_main.bin \ -device vfio-pci,host=04:00.0,multifunction=on \ -device vfio-pci,host=04:00.1 \ -device vfio-pci,host=07:00.0 \ -device vfio-pci,host=00:1b.0 \ -drive file=/VMs/Win_Main.img,cache=writeback,format=raw,if=none,id=drive0,aio=threads \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/VMs/Win7.iso,id=iso_install,if=none \ -device scsi-cd,drive=iso_install \ -cdrom /VMs/virtio.iso \ -localtime \ -net nic,model=virtio,macaddr=38:29:21:5F:C4:7D -net bridge,br=br0 \ -netdev type=tap,ifname=tap_s,id=net1,vhost=on,vhostforce=on,queues=4,script= \ -device virtio-net-pci,netdev=net1,mq=on,vectors=9 \ -monitor unix:/tmp/vm_main,server,nowait &amp;</code></pre></div><p>As you can see , I&#039;m passing-through a total of 4 PCI devices . My GPU + HDMI Audio , a USB 3.0 PCI-E card and the onboard Intel HD Audio controller .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499766">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499767" class="blockpost rowodd"> <h2><span><span class="conr">#4078</span> <a href="viewtopic.php?pid=1499767#p1499767">2015-02-04 15:56:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p></div></blockquote></div><p>That&#039;s mostly the purpose of vfio, GPU assignment with vfio is just a fun hack.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499767">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499777" class="blockpost roweven"> <h2><span><span class="conr">#4079</span> <a href="viewtopic.php?pid=1499777#p1499777">2015-02-04 16:28:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82709">flack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82709">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>THX <strong>Denso</strong> and <strong>aw</strong></p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p></div></blockquote></div><p>That&#039;s mostly the purpose of vfio, GPU assignment with vfio is just a fun hack.</p></div></blockquote></div><p>I ask becouse using USB network card and USB soundcard in qemu. But when i play over internet on virtual machine then i got some latency lags.&#160; I think this can be reduced when i use USB PCIe card. And then put all USB devices to this PCIe USB controller.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499777">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499813" class="blockpost rowodd"> <h2><span><span class="conr">#4080</span> <a href="viewtopic.php?pid=1499813#p1499813">2015-02-04 18:28:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>THX <strong>Denso</strong> and <strong>aw</strong></p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p></div></blockquote></div><p>That&#039;s mostly the purpose of vfio, GPU assignment with vfio is just a fun hack.</p></div></blockquote></div><p>I ask becouse using USB network card and USB soundcard in qemu. But when i play over internet on virtual machine then i got some latency lags.&#160; I think this can be reduced when i use USB PCIe card. And then put all USB devices to this PCIe USB controller.</p></div></blockquote></div><p>Yeeeah, that&#039;s usually how people do when they&#039;re dealing with USB latency - they pass-through the whole USB controller as a PCIe device. As stated in Denso&#039;s example - it&#039;s done the same way as GPU pass-through, only much easier.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499813">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499858" class="blockpost roweven"> <h2><span><span class="conr">#4081</span> <a href="viewtopic.php?pid=1499858#p1499858">2015-02-04 20:33:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>THX <strong>Denso</strong> and <strong>aw</strong></p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi all, It is possible Passthrough another PCIe device? PCIe USB controller, PCIe Sound Card? PCIe network card?</p></div></blockquote></div><p>That&#039;s mostly the purpose of vfio, GPU assignment with vfio is just a fun hack.</p></div></blockquote></div><p>I ask becouse using USB network card and USB soundcard in qemu. But when i play over internet on virtual machine then i got some latency lags.&#160; I think this can be reduced when i use USB PCIe card. And then put all USB devices to this PCIe USB controller.</p></div></blockquote></div><p>TBH virtio-net is probably much better (and faster) than your USB NIC.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499858">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499859" class="blockpost rowodd"> <h2><span><span class="conr">#4082</span> <a href="viewtopic.php?pid=1499859#p1499859">2015-02-04 20:34:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>TBH virtio-net is probably much better (and faster) than your USB NIC.</p></div></blockquote></div><p>Agreed</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499859">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499948" class="blockpost roweven"> <h2><span><span class="conr">#4083</span> <a href="viewtopic.php?pid=1499948#p1499948">2015-02-05 03:57:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>As reported countless times in this thread, the latest Nvidia driver is incompatible with hyper-v extensions, including hv_time.&#160; The driver doesn&#039;t seem to detect these extensions on every boot, which can lead to confusing issues like this, but hv_time and friends should never be recommended for Nvidia users.</p></div></blockquote></div><p>Got it, looks like some boost function can&#039;t use on NVIDIA Driver.<br />Also, I found out the delay problem I got just Windows 8 problem. After update, everything got right.</p><p>(P.S&#160; I got Windows Update from 4 p.m to 3 a.m, how &#039;wonderful&#039; does Windows 8.)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499948">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1499974" class="blockpost rowodd"> <h2><span><span class="conr">#4084</span> <a href="viewtopic.php?pid=1499974#p1499974">2015-02-05 07:06:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I&#039;m trying to install Ubuntu 14.04.1 on OVMF VM.<br />It can enter into GRUB menu, but I select install Ubuntu, only black screen.</p><p>Is my GTX980 too new so that Ubuntu&#039;s driver didn&#039;t support yet?<br />Maybe I should change back to GTX480, but I guess GTX480&#039;s BIOS didn&#039;t support UEFI model.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1499974">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500077" class="blockpost roweven"> <h2><span><span class="conr">#4085</span> <a href="viewtopic.php?pid=1500077#p1500077">2015-02-05 15:23:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86675">lordleto</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-14</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok i got Yosemite in KVM with GPU passtrough working!</p><p>Essentially i created a pure mac install usb by</p><div class="codebox"><pre><code>sudo /Applications/Install\ OS\ X\ Yosemite.app/Contents/Resources/createinstallmedia --volume /Volumes/Name-des-USB-Sticks/ --applicationpath /Applications/Install\ OS\ X\ Yosemite.app/ --nointeraction</code></pre></div><p>Booted seabios and used chameleon 2510 as kernel. Installation worked quite nicely on q35 machine. But after install also 440fx works. So i use this.<br />One needs to play with slots for e1000-82545em to get it working. (Some strange irq issue apparently).<br />GPU passthrough works, without any kvm=off stuff. On mac i can even pass my titan as secondary card besides vga. Go figure. USB3 (ASM1042) works with driver from multibeast. Pass through of 82574L also works with driver from multibeast but performance is abysimal. Hope virtio-net is working on Yosemite soon, no need to pass a real card anymore. But e1000 is not bad for now.</p><p>One last problem is cpu. Now it works with model core2duo but this disables some sse instructions, and all aes and avx and other features my Xeon 1650 v1 (Think i7-3930k with ECC) has. Model Sandybridge kinda works. But OS X cant figure the right clock and think it runs on 133MHz and so the realtime clock runs 20 times faster. Anyone knows how to fix this? Passing cpu as model host ends in kernel panic on boot.</p><p>I also run some test on Mac VM, Ubuntu 14.04 VM and Windows7 VM and also on Host. All VM have 4 pinned HT Cores (8 Logical) Windows VM is additinally guared by cset, Ubuntu and Mac are not. Hugepages are on.<br />no hv enhancments on Windows VM due to latest driver.</p><p>Geekbench (first single then multi)<br />Baseline Host Ubuntu 12.04 3.17.1: <a href="http://browser.primatelabs.com/geekbench3/1848887" rel="nofollow">http://browser.primatelabs.com/geekbench3/1848887</a> 3218&#160; &#160; &#160;17638<br />Windows 7 VM: <a href="http://browser.primatelabs.com/geekbench3/1848676" rel="nofollow">http://browser.primatelabs.com/geekbench3/1848676</a> 3221&#160; &#160; &#160;12821<br />Ubuntu 14.04: <a href="http://browser.primatelabs.com/geekbench3/1848847" rel="nofollow">http://browser.primatelabs.com/geekbench3/1848847</a> 3230&#160; &#160; &#160;13215<br />Mac 10.10.2: <a href="http://browser.primatelabs.com/geekbench3/1848531" rel="nofollow">http://browser.primatelabs.com/geekbench3/1848531</a> 2940&#160; &#160; &#160;12055 <br />lower result on mac almost fully attributable to lacking of aes on core2duo, so for some stuff somehow managing to get mac vm working with sandybridge or even host would be great.</p><p>Also done Unigine 4.0 benches</p><p>Winows 7&#160; VM<br />FPS:&#160; &#160; 61.3 Score: 1544 Min FPS: 8.6 Max FPS:&#160; &#160; 141.3 <br />Windows 7 (build 7601, Service Pack 1) 64bit CPU model:&#160; &#160; Intel(R) Xeon(R) CPU E5-1650 0 @ 3.20GHz (3999MHz) x4 GPU model:&#160; &#160; &#160;NVIDIA GeForce GTX TITAN 9.18.13.4725 (4095MB) x1 <br />Settings Render:&#160; &#160; Direct3D11 Mode:&#160; &#160; &#160;1600x900 8xAA windowed Preset&#160; &#160; Extreme</p><p>Ubuntu 14.04 VM<br />FPS:&#160; &#160; 63.8 Score:&#160; &#160; 1608 Min FPS:&#160; &#160; &#160;9.3 Max FPS:&#160; &#160; 132.5<br />Linux 3.13.0-45-generic x86_64 CPU model:&#160; &#160; &#160;Intel(R) Xeon(R) CPU E5-1650 0 @ 3.20GHz (3999MHz) x8 GPU model:&#160; &#160; &#160;GeForce GTX TITAN PCI Express 346.35 (6144MB) x1 <br />Settings Render:&#160; &#160; OpenGL Mode:&#160; &#160; &#160;1600x900 8xAA windowed Preset&#160; &#160; &#160;Extreme</p><p>Mac OS X 10.10.2 (Stock Nvidia Driver)<br />FPS:&#160; &#160; 59.1 Score:&#160; &#160; 1490 Min FPS:&#160; &#160; &#160;8.5 Max FPS:&#160; &#160; &#160;122.1<br />Darwin 14.1.0 x86_64 CPU model:&#160; &#160; Intel(R) Core(TM)2 Duo CPU T7700 @ 2.40GHz (3999MHz) x8 GPU model:&#160; &#160; &#160;NVIDIA GeForce GTX TITAN (6144MB) x1 <br />Settings Render:&#160; &#160; OpenGL Mode:&#160; &#160; &#160;1600x900 8xAA windowed Preset&#160; &#160; Extreme</p><p>Id say not bad, differences are not that big.<br />Maybe i do also bare metal run on Heaven to compare but this needs a reboot and a new xorg.conf.<br />So appart from some difficulties in setting this up, there is no reason to not do it <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by lordleto (2015-02-05 15:28:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500077">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500102" class="blockpost rowodd"> <h2><span><span class="conr">#4086</span> <a href="viewtopic.php?pid=1500102#p1500102">2015-02-05 16:30:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=35021">Lockheed</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-16</span></dd> <dd><span>Posts: 1,420</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=35021">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><div class="codebox"><pre class="vscroll"><code>$ find /sys/kernel/iommu_groups /sys/kernel/iommu_groups /sys/kernel/iommu_groups/0 /sys/kernel/iommu_groups/0/devices /sys/kernel/iommu_groups/0/devices/0000:00:00.0 /sys/kernel/iommu_groups/1 /sys/kernel/iommu_groups/1/devices /sys/kernel/iommu_groups/1/devices/0000:00:01.0 /sys/kernel/iommu_groups/1/devices/0000:01:00.0 /sys/kernel/iommu_groups/2 /sys/kernel/iommu_groups/2/devices /sys/kernel/iommu_groups/2/devices/0000:00:02.0 /sys/kernel/iommu_groups/3 /sys/kernel/iommu_groups/3/devices /sys/kernel/iommu_groups/3/devices/0000:00:03.0 /sys/kernel/iommu_groups/3/devices/0000:00:03.3 /sys/kernel/iommu_groups/4 /sys/kernel/iommu_groups/4/devices /sys/kernel/iommu_groups/4/devices/0000:00:1a.0 /sys/kernel/iommu_groups/4/devices/0000:00:1a.1 /sys/kernel/iommu_groups/4/devices/0000:00:1a.2 /sys/kernel/iommu_groups/4/devices/0000:00:1a.7 /sys/kernel/iommu_groups/5 /sys/kernel/iommu_groups/5/devices /sys/kernel/iommu_groups/5/devices/0000:00:1b.0 /sys/kernel/iommu_groups/6 /sys/kernel/iommu_groups/6/devices /sys/kernel/iommu_groups/6/devices/0000:00:1c.0 /sys/kernel/iommu_groups/6/devices/0000:00:1c.1 /sys/kernel/iommu_groups/6/devices/0000:00:1c.2 /sys/kernel/iommu_groups/6/devices/0000:00:1c.3 /sys/kernel/iommu_groups/6/devices/0000:03:00.0 /sys/kernel/iommu_groups/6/devices/0000:04:00.0 /sys/kernel/iommu_groups/6/devices/0000:05:00.0 /sys/kernel/iommu_groups/7 /sys/kernel/iommu_groups/7/devices /sys/kernel/iommu_groups/7/devices/0000:00:1d.0 /sys/kernel/iommu_groups/7/devices/0000:00:1d.1 /sys/kernel/iommu_groups/7/devices/0000:00:1d.2 /sys/kernel/iommu_groups/7/devices/0000:00:1d.7 /sys/kernel/iommu_groups/8 /sys/kernel/iommu_groups/8/devices /sys/kernel/iommu_groups/8/devices/0000:00:1e.0 /sys/kernel/iommu_groups/8/devices/0000:15:00.0 /sys/kernel/iommu_groups/8/devices/0000:15:00.2 /sys/kernel/iommu_groups/8/devices/0000:15:00.4 /sys/kernel/iommu_groups/8/devices/0000:15:00.5 /sys/kernel/iommu_groups/9 /sys/kernel/iommu_groups/9/devices /sys/kernel/iommu_groups/9/devices/0000:00:1f.0 /sys/kernel/iommu_groups/9/devices/0000:00:1f.2 /sys/kernel/iommu_groups/9/devices/0000:00:1f.3</code></pre></div><br /><p>What is better/easier - blacklisting, or using PCI stub? Do I understand it right that you suggest going the pci-stub route because of VGA BIOS being integrated into system firmware?</p><p>I plan to use Intel GPU for the host system and give Radeon entirely to qemu. Not sure if that&#039;s what you meant by </p><div class="quotebox"><blockquote><div><p>you probably don&#039;t need the i915 VGA arbitration patch if you do end going the primary head/VGA route.</p></div></blockquote></div><p>?</p><p>Also, when I am not running qemu, is there a way to keep using radeon (occasionally) with DRI_PRIME?</p><br /><p>EDIT:<br />I booted with that custom kernel form the OP, but it has negative influence on the radeon GPU temperature. It skyrockets to ~90 C even when not in use and the fan is running like crazy. Perhaps it disables power management for it?</p></div></blockquote></div><br /><p>@aw, could you please comment on my post?</p> </div> <div class="postsignature postmsg"><hr /><p><span style="color: #625D5D"><strong>Laptop:</strong> ThinkPad W500, C2D P9500, 8GB, Radeon RV635 (HD3650), Arch</span> | <span style="color: #625D5D"><strong>Server/fw:</strong> Zotac AQ01, A4-5000 Kabini, 4GB, Arch/pfSense VM</span></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500102">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500158" class="blockpost roweven"> <h2><span><span class="conr">#4087</span> <a href="viewtopic.php?pid=1500158#p1500158">2015-02-05 19:22:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79198">Utku1Kan</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-04</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:utku.birkan@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So guys can you tell me why are we compiling linux-mainline but not stock arch package? Is it possible that all things work when i compile linux package with patches applied?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500260" class="blockpost rowodd"> <h2><span><span class="conr">#4088</span> <a href="viewtopic.php?pid=1500260#p1500260">2015-02-06 01:31:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Utku1Kan wrote:</cite><blockquote><div><p>So guys can you tell me why are we compiling linux-mainline but not stock arch package? Is it possible that all things work when i compile linux package with patches applied?</p></div></blockquote></div><p>I guess because not all kernel included VFIO driver, like Ubuntu generic kernel not included yet. So we usually install kernel from kernel.org.</p><p>And I don&#039;t know what do you mean about &#039;all things work&#039;, the patches you need is depends on your hardware, like if you have Intel graphic on your computer, you need to install i915 patch.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500260">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500264" class="blockpost roweven"> <h2><span><span class="conr">#4089</span> <a href="viewtopic.php?pid=1500264#p1500264">2015-02-06 01:55:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lockheed wrote:</cite><blockquote><div><p>What is better/easier - blacklisting, or using PCI stub?</p></div></blockquote></div><p>I tend to prefer pci-stub.ids, but neither is really better or easier.</p><div class="quotebox"><blockquote><div><p>Do I understand it right that you suggest going the pci-stub route because of VGA BIOS being integrated into system firmware?</p></div></blockquote></div><p>No, that&#039;s unrelated</p><div class="quotebox"><blockquote><div><p>I plan to use Intel GPU for the host system and give Radeon entirely to qemu. Not sure if that&#039;s what you meant by </p><div class="quotebox"><blockquote><div><p>you probably don&#039;t need the i915 VGA arbitration patch if you do end going the primary head/VGA route.</p></div></blockquote></div><p>?</p></div></blockquote></div><p>That&#039;s really your only option. Theoretically the existing VGA arbitration in the i915 driver actually works for the generation of hardware you have.</p><div class="quotebox"><blockquote><div><p>Also, when I am not running qemu, is there a way to keep using radeon (occasionally) with DRI_PRIME?</p></div></blockquote></div><p>Maybe.&#160; Graphics drivers often don&#039;t work well with binding and unbinding the device.&#160; GPUs aren&#039;t hotplugged nearly as often as NICs.</p><div class="quotebox"><blockquote><div><p>EDIT:<br />I booted with that custom kernel form the OP, but it has negative influence on the radeon GPU temperature. It skyrockets to ~90 C even when not in use and the fan is running like crazy. Perhaps it disables power management for it?</p></div></blockquote></div><p>How are you reading the GPU temperature without a driver?&#160; Is the exhaust hot?&#160; It&#039;s possible that the system relies on the driver for reporting the temperature and freaks out when there isn&#039;t one.&#160; These are just some of the fun problems you&#039;re going to have trying to make this work on a laptop.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500264">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500273" class="blockpost rowodd"> <h2><span><span class="conr">#4090</span> <a href="viewtopic.php?pid=1500273#p1500273">2015-02-06 02:32:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><div class="quotebox"><cite>Utku1Kan wrote:</cite><blockquote><div><p>So guys can you tell me why are we compiling linux-mainline but not stock arch package? Is it possible that all things work when i compile linux package with patches applied?</p></div></blockquote></div><p>I guess because not all kernel included VFIO driver, like Ubuntu generic kernel not included yet.</p></div></blockquote></div><p>Now you&#039;ve gone and made me install an ubuntu VM just to check.&#160; Not true, both 14.04 and 14.10 have vfio enabled in the kernel.&#160; I run a stock Fedora kernel since I don&#039;t need either the i915 patch (using OVMF) or the ACS override.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500276" class="blockpost roweven"> <h2><span><span class="conr">#4091</span> <a href="viewtopic.php?pid=1500276#p1500276">2015-02-06 02:40:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><div class="quotebox"><cite>Utku1Kan wrote:</cite><blockquote><div><p>So guys can you tell me why are we compiling linux-mainline but not stock arch package? Is it possible that all things work when i compile linux package with patches applied?</p></div></blockquote></div><p>I guess because not all kernel included VFIO driver, like Ubuntu generic kernel not included yet.</p></div></blockquote></div><p>Now you&#039;ve gone and made me install an ubuntu VM just to check.&#160; Not true, both 14.04 and 14.10 have vfio enabled in the kernel.&#160; I run a stock Fedora kernel since I don&#039;t need either the i915 patch (using OVMF) or the ACS override.</p></div></blockquote></div><p>Sorry, my information still old <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> , now I&#039;m install 3.18.5 kernel.<br />After that, keep testing why Ubuntu 14.04 installation can&#039;t start with OVMF.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500287" class="blockpost rowodd"> <h2><span><span class="conr">#4092</span> <a href="viewtopic.php?pid=1500287#p1500287">2015-02-06 05:10:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79578">AKSN74</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/79578.jpg?m=1423108340" width="80" height="80" alt="" /></dd> <dd><span>From: Taichung, Taiwan</span></dd> <dd><span>Registered: 2014-02-18</span></dd> <dd><span>Posts: 52</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:missile0407@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I had another problem while installing Ubuntu 14.04-1 with OVMF.<br />(Sorry about so many problems first.)</p><p>First installation, I use GTX980 to install, but only got blank screen (monitor power is on) after I select &#039;Install Ubuntu&#039;.<br />Then I change GTX480 to install. In OVMF message, it shows:</p><div class="codebox"><pre><code>No suitable video mode. Enter into blind mode.</code></pre></div><p>But I can see installation wizard. So I installed Ubuntu then reboot, OVMF shows same message, but get blank screen with monitor power off.<br />Then I switch back to GTX980, same as beginning, get blank screen with monitor power is on.<br />Now it still blank, and I can reboot VM with Ctrl+Alt+Delete then Enter.</p><p>Before that, I&#039;m sure that I can install and enter into Ubuntu in real computer with GTX980. But not install with UEFI mode.<br />Does anyone know how to solve it?</p><p>EDIT: Fixed with nomodeset, seems like Ubuntu got a problem with GTX980 while in UEFI mode.</p> <p class="postedit"><em>Last edited by AKSN74 (2015-02-06 05:39:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500287">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500326" class="blockpost roweven"> <h2><span><span class="conr">#4093</span> <a href="viewtopic.php?pid=1500326#p1500326">2015-02-06 10:02:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>AKSN74 wrote:</cite><blockquote><div><div class="quotebox"><cite>Utku1Kan wrote:</cite><blockquote><div><p>So guys can you tell me why are we compiling linux-mainline but not stock arch package? Is it possible that all things work when i compile linux package with patches applied?</p></div></blockquote></div><p>I guess because not all kernel included VFIO driver, like Ubuntu generic kernel not included yet.</p></div></blockquote></div><p>Now you&#039;ve gone and made me install an ubuntu VM just to check.&#160; Not true, both 14.04 and 14.10 have vfio enabled in the kernel.&#160; I run a stock Fedora kernel since I don&#039;t need either the i915 patch (using OVMF) or the ACS override.</p></div></blockquote></div><p>So you&#039;re actually using Fedora 21 with stock 3.18.3? How can you compile ACS patch then?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500326">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500343" class="blockpost rowodd"> <h2><span><span class="conr">#4094</span> <a href="viewtopic.php?pid=1500343#p1500343">2015-02-06 12:20:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p> How can you compile ACS patch then?</p></div></blockquote></div><p>He doesn&#039;t need it on his hardware .</p> <p class="postedit"><em>Last edited by Denso (2015-02-06 12:20:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500343">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500346" class="blockpost roweven"> <h2><span><span class="conr">#4095</span> <a href="viewtopic.php?pid=1500346#p1500346">2015-02-06 12:26:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p> How can you compile ACS patch then?</p></div></blockquote></div><p>He doesn&#039;t need it on his hardware .</p></div></blockquote></div><p>I understand he doesnt need it. I would like to know how can he compile one. Few pages back I posted that on my Fedora I cannot compile ACS patch and did not get an answer, while on previous Fedora I was compiling it flawlessly for more then 6 months. Looks like now I will not get an answer either.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500346">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500375" class="blockpost rowodd"> <h2><span><span class="conr">#4096</span> <a href="viewtopic.php?pid=1500375#p1500375">2015-02-06 14:00:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86675">lordleto</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-14</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have redone Unigine test.<br />First attempt i forgot to disable cuda double precision and also switching intput during run cause spikes prob due to usb disconnect.<br />So clean results are</p><div class="codebox"><pre class="vscroll"><code>Host Ubuntu 12.04 FPS: 67.7 Score: 1704 Min FPS: 39.3 Max FPS: 144.2 System Platform: Linux 3.17.1-031701-generic x86_64 CPU model: Intel(R) Xeon(R) CPU E5-1650 0 @ 3.20GHz (3999MHz) x12 GPU model: GeForce GTX TITAN PCI Express 340.32 (6144MB) x1 Settings Render: OpenGL Mode: 1600x900 8xAA windowed Preset Extreme Windows 7 KVM FPS: 70.2 Score: 1768 Min FPS: 27.4 Max FPS: 153.6 System Platform: Windows 7 (build 7601, Service Pack 1) 64bit CPU model: Intel(R) Xeon(R) CPU E5-1650 0 @ 3.20GHz (3999MHz) x4 GPU model: NVIDIA GeForce GTX TITAN 9.18.13.4725 (4095MB) x1 Settings Render: Direct3D11 Mode: 1600x900 8xAA windowed Preset Extreme Ubuntu 14.04 KVM FPS: 66.8 Score: 1684 Min FPS: 38.8 Max FPS: 138.6 System Platform: Linux 3.13.0-45-generic x86_64 CPU model: Intel(R) Xeon(R) CPU E5-1650 0 @ 3.20GHz (3999MHz) x8 GPU model: GeForce GTX TITAN PCI Express 346.35 (6144MB) x1 Settings Render: OpenGL Mode: 1600x900 8xAA windowed Preset Extreme Mac OS X 10.10.2 KVM FPS: 61.3 Score: 1544 Min FPS: 37.2 Max FPS: 133.5 System Platform: Darwin 14.1.0 x86_64 CPU model: Intel(R) Core(TM)2 Duo CPU T7700 @ 2.40GHz (3999MHz) x8 GPU model: NVIDIA GeForce GTX TITAN (6144MB) x1 Settings Render: OpenGL Mode: 1600x900 8xAA windowed Preset Extreme</code></pre></div><p>So i will try now to boot mac os though omvf and clover, maybe then i can use a proper cpu model (ie SandyBridge). Host prob will never work since there never was a mac with SandyBridge-E Xeons.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500375">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500408" class="blockpost roweven"> <h2><span><span class="conr">#4097</span> <a href="viewtopic.php?pid=1500408#p1500408">2015-02-06 16:43:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello guys,</p><p>I&#039;m dealing with a problem I can&#039;t solve, I have successfully passed through an AMD R7 250 to my windows 8.1 guest but I&#039;m getting a lot of audio hiccups everytime other guest starts an io intensive job.</p><p>The vms are stored at an zfs dataset.</p><p>My setup is the follow:</p><p>CPU: Intel Xeon E3-1245V3<br />MOBO: Supermicro&#160; X10SAE-O<br />RAM: 16GB ECC<br />VIDEO: AMD R7 250</p><p>Any help would be welcome.</p><p>Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500408">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500411" class="blockpost rowodd"> <h2><span><span class="conr">#4098</span> <a href="viewtopic.php?pid=1500411#p1500411">2015-02-06 16:48:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><p>Hello guys,</p><p>I&#039;m dealing with a problem I can&#039;t solve, I have successfully passed through an AMD R7 250 to my windows 8.1 guest but I&#039;m getting a lot of audio hiccups everytime other guest starts an io intensive job.</p><p>The vms are stored at an zfs dataset.</p><p>My setup is the follow:</p><p>CPU: Intel Xeon E3-1245V3<br />MOBO: Supermicro&#160; X10SAE-O<br />RAM: 16GB ECC<br />VIDEO: AMD R7 250</p><p>Any help would be welcome.</p><p>Thanks.</p></div></blockquote></div><p>Pin vCPUs and don&#039;t oversubscribe physical CPUs if you expect the guest to handle latency sensitive tasks.&#160; You may also need to move host device interrupts to other CPUs.&#160; Use isolcpus if you really want to have vCPU isolation guarantees.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500428" class="blockpost roweven"> <h2><span><span class="conr">#4099</span> <a href="viewtopic.php?pid=1500428#p1500428">2015-02-06 17:27:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><p>Hello guys,</p><p>I&#039;m dealing with a problem I can&#039;t solve, I have successfully passed through an AMD R7 250 to my windows 8.1 guest but I&#039;m getting a lot of audio hiccups everytime other guest starts an io intensive job.</p><p>The vms are stored at an zfs dataset.</p><p>My setup is the follow:</p><p>CPU: Intel Xeon E3-1245V3<br />MOBO: Supermicro&#160; X10SAE-O<br />RAM: 16GB ECC<br />VIDEO: AMD R7 250</p><p>Any help would be welcome.</p><p>Thanks.</p></div></blockquote></div><p>Pin vCPUs and don&#039;t oversubscribe physical CPUs if you expect the guest to handle latency sensitive tasks.&#160; You may also need to move host device interrupts to other CPUs.&#160; Use isolcpus if you really want to have vCPU isolation guarantees.</p></div></blockquote></div><p>Thank you aw.</p><p>I&#039;m already using isolcpus=2-7 and pinning vcpus for my guest.<br />The only thing I&#039;m not doing is moving my host device interrups. Do you have any script to do it?</p><p>Here my Windows 8.1 xml:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; id=&#039;2&#039;&gt; &lt;name&gt;htpc-sala-windows&lt;/name&gt; &lt;uuid&gt;89abba7f-cbb4-4360-8dc2-a1187be73e1c&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;3145728&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;3145728&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt; &lt;cputune&gt; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;2&#039;/&gt; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;3&#039;/&gt; &lt;/cputune&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.3&#039;&gt;hvm&lt;/type&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64.vgaon&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; cache=&#039;writeback&#039; io=&#039;threads&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/htpc-sala-windows.qcow2&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;alias name=&#039;virtio-disk0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;alias name=&#039;ide0-0-0&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;&gt; &lt;alias name=&#039;pci.0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;ide0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;virtio-serial0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:ed:4b:fb&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;target dev=&#039;vnet0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;alias name=&#039;net0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52b&#039;/&gt; &lt;address bus=&#039;3&#039; device=&#039;6&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0471&#039;/&gt; &lt;product id=&#039;0x060d&#039;/&gt; &lt;address bus=&#039;3&#039; device=&#039;5&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev3&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;alias name=&#039;balloon0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>cmdline:</p><div class="codebox"><pre><code>BOOT_IMAGE=/boot/vmlinuz-linux root=UUID=1ff9fe0c-8a92-42b2-97ac-0892e610d9ad rw quiet intel_iommu=on i915.enable_hd_vgaarb=1 isolcpus=2-7 pci-stub.ids=1002:6610,1002:aab0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500428">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1500431" class="blockpost rowodd"> <h2><span><span class="conr">#4100</span> <a href="viewtopic.php?pid=1500431#p1500431">2015-02-06 17:37:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Pin vCPUs and don&#039;t oversubscribe physical CPUs if you expect the guest to handle latency sensitive tasks.&#160; You may also need to move host device interrupts to other CPUs.&#160; Use isolcpus if you really want to have vCPU isolation guarantees.</p></div></blockquote></div><p>Thank you aw.</p><p>I&#039;m already using isolcpus=2-7 and pinning vcpus for my guest.<br />The only thing I&#039;m not doing is moving my host device interrups. Do you have any script to do it?</p></div></blockquote></div><p>I don&#039;t have anything, but you want to manipulate /proc/irq/*/smp_affinity.&#160; You probably want to be careful only to do this for device interrupts (ie. things with IO-APIC or PCI-MSI in the type from /proc/interrupts).&#160; You&#039;ll also want to make sure irqbalance doesn&#039;t move interrutps back to your isolated CPUs, there&#039;s a IRQBALANCE_BANNED_CPUS environment variable that can be used to do that.</p><p>EDIT: I doubt an E3 v3 has it, but if /sys/module/kvm_intel/parameters/enable_apicv reports &#039;Y&#039; then by making sure assigned device interrupts come to a CPU not running the guest, KVM can inject the interrupt into the guest with forcing a VM exit.&#160; I also recall someone was using (I think) the nohz_full= boot option to stop timer ticks on the isolated CPUs.</p> <p class="postedit"><em>Last edited by aw (2015-02-06 17:42:29)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1500431">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=163">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <strong>164</strong> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <a href="viewtopic.php?id=162768&amp;p=166">166</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=165">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
