<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 220) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=220" title="Page 220" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=219" title="Page 219" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=221" title="Page 221" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=219">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=218">218</a> <a href="viewtopic.php?id=162768&amp;p=219">219</a> <strong>220</strong> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=221">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1541082" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5476</span> <a href="viewtopic.php?pid=1541082#p1541082">2015-06-30 20:20:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> Without knowing the host cpu or guest cpu topology, this is pretty meaningless</p></div></blockquote></div><p>My processor is an X5660, and I believe I have it setup correct with 2 Cores and 2 Thread. My question is, are the core id the same between &#039;isolcpus&#039; and my &#039;vm config&#039;? Is 2 in one the same 2 in the other?</p><p>Here is the core thread layout for my Xeon X5660:</p><div class="codebox"><pre><code>[root@kvmhost1 ~]# egrep &quot;^processor|^core id&quot; /proc/cpuinfo processor : 0 core id : 0 processor : 1 core id : 1 processor : 2 core id : 2 processor : 3 core id : 8 processor : 4 core id : 9 processor : 5 core id : 10 processor : 6 core id : 0 processor : 7 core id : 1 processor : 8 core id : 2 processor : 9 core id : 8 processor : 10 core id : 9 processor : 11 core id : 10 [root@kvmhost1 ~]#</code></pre></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> You&#039;re messing with the cpu affinity of the qemu process, not the vCPUs.&#160; There&#039;s an &lt;emulatorpin&gt; control for this <a href="https://libvirt.org/formatdomain.html#elementsCPUTuning" rel="nofollow">https://libvirt.org/formatdomain.html#elementsCPUTuning</a></p></div></blockquote></div><p>I will look into this.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541082">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541106" class="blockpost roweven"> <h2><span><span class="conr">#5477</span> <a href="viewtopic.php?pid=1541106#p1541106">2015-06-30 21:06:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek :</p><p>I&#039;m using raw disk images (.img) for my VMs . No block devices or zvols . I&#039;m just looking for a way to copy those images to a backup location but qemu always crashes along with the host .</p><p>@jasonwryan :</p><p>How is my question about qemu VMs disk images unrelated to this qemu thread ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541106">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541118" class="blockpost rowodd"> <h2><span><span class="conr">#5478</span> <a href="viewtopic.php?pid=1541118#p1541118">2015-06-30 21:42:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>How is my question about qemu VMs disk images unrelated to this qemu thread ?</p></div></blockquote></div><p>How is a question about snapshotting a running VM disk image unrelated to graphics assignment?&#160; Virtualization is a very broad topic, not every question about running or managing a QEMU VM is relevant to this particular thread.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541118">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541134" class="blockpost roweven"> <h2><span><span class="conr">#5479</span> <a href="viewtopic.php?pid=1541134#p1541134">2015-06-30 22:28:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, there&#039;s positive news about my project and negative.<br />The positive news are:<br /><strong>Three GPUs actually WORK! Separately.</strong><br />So i can mine my whatever-coins in a virtual machine. A strange thing to do, but combined with openstack that could be a base for some virtual private miner(VPS, but for mining) service.. ...althrough it&#039;d be as pointless as /dev/null as a service.<br />But also i can crack some passwords! oclHashCat is able to utilize all three GPUs at their full power, so cracking NTLM hashes from filthy wind0wz is now 33% faster, heh.<br />I can attach a whooping number of screens to the VM: <strong>Nine</strong>. There was a version of HD7750 with 6 mini-dp ports, but it&#039;s cost was nowhere near my setup.<br />That 9 screens would work with AMD EyeFinity. I&#039;ve actually tried doing three screens(one fullhd 24&quot; and two square 1280x1024 17&quot;) on two GPUs, and i&#039;ve ran out of video memory quickly, 2gb cards would be much nicer. AFAIK, the video memory <span class="bbu">does</span> stack when using <span class="bbu">XDMA</span> crossfire.<br />But i&#039;ve distracted from the topic, back to qemu again.<br />Crossfire works with two cards only even if there&#039;s only one card running using vfio-pci and the others are one pci-assign from xen, which is considered legacy.<br />I&#039;ve managed to find a way of determining which cards are crossfire-bound - the unbound card still has it&#039;s video outputs working, the paired one shares the display connectors with the master.<br />Also, i am really able to run two or three VMs in parallel, so it&#039;s three &quot;seats&quot; per one case. Well, almost, as the third card does not fit inside.<br /><a href="http://i.imgur.com/PN6XNaq.jpg" rel="nofollow">http://i.imgur.com/PN6XNaq.jpg</a><br />Again, sorry for the big image.<br />Negative news:<br />Crossfire with 3 cards totally doesn&#039;t work in my setup.<br />Maybe the culprit is pci-e bandwidth, as pci-e 2.0 x1 is not enough to overwhelm that physical crossfire bridge.<br />Or maybe the AMD support was right, and crossfire requires an even number of cards to work. I hope i&#039;ll find it out someday, but most likely not.</p><p>Now the third card goes to the sponsor(he paid for half of the card) and i continue to run crossfire with two cards, hoping to sell them one day and buy a GTX 750 KalmX. Or...<br />Hmm, what if i&#039;ll find a PLX-based switch which does ACS and stuff and presents three cards as if they were all connected to the proccesor&#039;s root port?..<br />Not only there would be a somewhat bandwidth increase(maybe), but it would enable me to use vfio-pci for all three cards eliminating the reset problems.<br />Sad thing that pci-e switches are rare an expensive, especially in my location. If i could only borrow it for some time...<br />The alternate way of proceeding on my way to tri-way crossfire in a VM would be using something on A85X/88X with three pci-e 16x slots(they are hopefully routed as processor-root-ports).<br />Or running windows bare-metal! That&#039;s a thing to try.</p><br /><br /><p>-- mod edit: read the Forum Etiquette and only post thumbnails <a href="http://wiki.archlinux.org/index.php/Forum_Etiquette#Pasting_Pictures_and_Code" rel="nofollow">http://wiki.archlinux.org/index.php/For … s_and_Code</a> [jwr] --</p> <p class="postedit"><em>Last edited by Duelist (2015-06-30 22:33:09)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541134">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541138" class="blockpost rowodd"> <h2><span><span class="conr">#5480</span> <a href="viewtopic.php?pid=1541138#p1541138">2015-07-01 00:06:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Dang , I forgot the thread&#039;s title completely&#160; : (</p><p>@Duelist :</p><p>I guess you can run three AMD gpus on crossfire . I think they call it TriFire but don&#039;t quote me on that . I&#039;ve never purchased one since the ATI days . <br />PCI-E expansion chasis are really expensive . Magma sells a 3 slot chassis for over $2000 . And they even have a 10 slots chassis for an unknown price , probably would be over $7000 . You&#039;re better off building more virtualization hosts with regular hardware .</p> <p class="postedit"><em>Last edited by Denso (2015-07-01 00:10:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541138">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541244" class="blockpost roweven"> <h2><span><span class="conr">#5481</span> <a href="viewtopic.php?pid=1541244#p1541244">2015-07-01 11:45:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>My ASMedia USB 3.0 is working flawlessly (from 1 page before) with OVMF-pure-efi, but not with OVMF-with-csm and QEMU. Can I do something about it anywhere in OVMF-with-csm (because the GPU used with ASMedia is not GOP capable) to load EFI for USB controllers?</p><p>EDIT:<br />On QEMU I get it to work almost flawlessly with Legacy USB 3.0 disabled in BIOS + pcie_aspm=off. After 10-30 reboots of the OS/VM I get DMAR error on host and only the reboot of the host solves it. It looks like the USB controller gets into a power saving mode or whatever and it doesnt unstick/reset anymore and only a host reboot solves it. Can it be fixed with any command/patch? To reset manually?</p> <p class="postedit"><em>Last edited by devianceluka (2015-07-01 12:18:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541244">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541254" class="blockpost rowodd"> <h2><span><span class="conr">#5482</span> <a href="viewtopic.php?pid=1541254#p1541254">2015-07-01 12:21:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Crossfire with 3 cards on my setup doesn&#039;t work even on bare metal.<br />But i&#039;ve been able to record some benchmarks:<br />Unigine Heaven Benchmark 4.0: D3D11, quality medium, resolution 1920x1080 fullscreen(basic preset with full resolution).<br />Bare metal: 654 single card(100%), 1244 crossfire(190% performance with crossfire)<br />VM:630 single card(96%), <span class="bbs">1013</span>1087 crossfire(<span class="bbs">160%</span>173% crossfire from single VM card, <span class="bbs">81%</span>87% from bare metal performance).<br /><span class="bbs">I ran only one run, so i think some CPU activity on host did interfere with crossfire VM run.</span><br />There&#039;s also some stuttering occuring in the crossfire VM, <span class="bbs">i think about turning iommu=pt to iommu=on</span> and maybe running PCAP or something to capture that and try to align it with host CPU and/or disk usage.<br />Sadly, toggling iommu=pt to iommu=on didn&#039;t help much. There&#039;s still stuttering present when unigine shows a new area or scene. Especially this is seen in the end of scene #19, where the camera pans to the city, and in the beginning of scene #22, where there&#039;s a fade in in the city.<br />If anyone is able to reproduce that lags, please tell.</p><p>Now i&#039;ll try to setup a second VM with the third card only.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-01 12:57:53)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541254">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541289" class="blockpost roweven"> <h2><span><span class="conr">#5483</span> <a href="viewtopic.php?pid=1541289#p1541289">2015-07-01 14:55:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p> Sadly, toggling iommu=pt to iommu=on didn&#039;t help much. There&#039;s still stuttering present when unigine shows a new area or scene. Especially this is seen in the end of scene #19, where the camera pans to the city, and in the beginning of scene #22, where there&#039;s a fade in in the city.<br />If anyone is able to reproduce that lags, please tell.</p><p>Now i&#039;ll try to setup a second VM with the third card only.</p></div></blockquote></div><p>This same issue happens to me. For instance, in World of Tanks, gliding over different tanks with the cursor causes the screen to freeze for a split second then jump ahead. In GTA5, some textures take a while to load when traveling at a high rate of speed, but this may be normal. I also noticed the issue on previous Windows 10 builds when swapping between the ICONS. As I play different games, i might be able to reproduce the issue.</p><p>Another issue I noticed was with GTA4, when I would load it, it would just crash the host to crash.</p><p>I think it might be good to look at different performance recording statistics from the host end, like iostat and vmstat.</p><p>With Windows 10, when opening up Task Manager, I also noticed that Windows knows it is a VM. I thought &#039;kvm=off&#039; was supposed to fix that, but maybe it is just with NVIDIA Drivers?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541308" class="blockpost rowodd"> <h2><span><span class="conr">#5484</span> <a href="viewtopic.php?pid=1541308#p1541308">2015-07-01 16:06:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Why nobody wants to help?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541308">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541315" class="blockpost roweven"> <h2><span><span class="conr">#5485</span> <a href="viewtopic.php?pid=1541315#p1541315">2015-07-01 16:38:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Why nobody wants to help?</p></div></blockquote></div><p>Why are you using &#039;OVMF-with-csm&#039;?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541315">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541321" class="blockpost rowodd"> <h2><span><span class="conr">#5486</span> <a href="viewtopic.php?pid=1541321#p1541321">2015-07-01 17:09:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Why nobody wants to help?</p></div></blockquote></div><p>If you insist:<br />reset issues are tough. And they require quirks for particular devices.<br />BUT. Why do you p-t a USB controller, if there&#039;s a device passthrough, which gives almost 100% performance and is trouble-free?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541321">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541329" class="blockpost roweven"> <h2><span><span class="conr">#5487</span> <a href="viewtopic.php?pid=1541329#p1541329">2015-07-01 17:47:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Sorry for taking so long, took a nap after nerd rage... I&#039;m already trying for 4 days straight, 12h minimum each day, trying ALOT of combinations of BIOS and linux stuff and rebooting.</p><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Why nobody wants to help?</p></div></blockquote></div><p>Why are you using &#039;OVMF-with-csm&#039;?</p></div></blockquote></div><p>Because the GPU used with ASMedia does not support GOP (R7 240).</p><p>OVMF-pure-efi - works flawlessly (okay in 100 reboots, it didnt recognize it 1 time - its no problem)<br />SeaBIOS - works half the time<br />OVMF-with-csm - doesnt work, before booting Windows logo and after OVMF logo there&#039;s &quot; _ &quot; for 1-2 minutes and then it boots and doesnt recognize it in windows. If I disconnect the keyboard before starting VM and connecting back when windows boots, it works &quot;flawlessly&quot;</p><p>The real question is why wouldnt it boot with csm and only with pure-efi? Tried to remove all uhci/xhci/usb devices in XML, thought it might be in a dilemma which to choose and it doesnt fix it.</p><p>The only explanation from me would be that because SeaBIOS sometimes works sometimes doesnt (legacy ROM), OVMF-with-csm is using legacy ROM from USB controller also then... Where and how to change it to use EFI ROM for everything except GPU? </p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Why nobody wants to help?</p></div></blockquote></div><p>If you insist:<br />reset issues are tough. And they require quirks for particular devices.<br />BUT. Why do you p-t a USB controller, if there&#039;s a device passthrough, which gives almost 100% performance and is trouble-free?</p></div></blockquote></div><p>It is not 100% identical. It is bad for gaming. It is software and CPU accelerated. Would you flash your Android with an emulated USB controller? The question is only time when a trouble will arise and something will not be compatible... I have 4 GPU and 4 USB, so...</p><p>----</p><p>Also one observation made by me... Sometimes SeaBIOS when it doesnt work, it in my opinion&quot;locks&quot; the controller and even after host reboot it doesnt work. Only solution is pcie_aspm=off to pcie_aspm=force and it works after next host reboot (policy powersave ; performance &amp; default do not work ever).</p><p>----</p><p>Before someone says it is a BIOS/firmware bug... It MAY be, but it is FIXABLE (by me), but needs a human hand. There 100% must be a software solution/fix. As I&#039;m saying I get like 3-4 lines on host: &quot;dmar dma write request device fault addr&quot;. Also if EFI is working, there should atleast be a setting where one can force (like in real MB UEFI BIOS) to force EFI on devices (CSM) if the devices have working EFI ROMs atleast.</p><p>----</p><p>Host:<br />ASUS P9X79 PRO<br />i7-3820<br />16GB DDR3<br />256GB 850 PRO + 128GB 850 EVO<br />2x 2TB WD Black<br />2x R9 290<br />2x R7 240<br />4.0.6-300.fc22.x86_64 (virt-preview - everything latest!)<br />GRUB: intel_iommu=on pci-stub.ids=1b4b:9130,1b21:0612,1002:6613,1002:aab0,1002:6798,1002:aaa0,8086:1d26,8086:1d2d kvm-intel.nested=1 iommu=pt pcie_aspm=off vfio_iommu_type1.allow_unsafe_interrupts=1 kvm.ignore_msrs=1</p><p>----</p><p>Almost forgot. If I <span class="bbu">remove</span> ASMedia USB 3.0 controller from pci-stub, it increases the chances of working in SeaBIOS and surviving reboots by ALOT....</p> <p class="postedit"><em>Last edited by devianceluka (2015-07-01 18:22:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541329">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541334" class="blockpost rowodd"> <h2><span><span class="conr">#5488</span> <a href="viewtopic.php?pid=1541334#p1541334">2015-07-01 18:48:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77641">zir_blazer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 35</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ aw</p><p>Did you found any reelevant info for the VT-d support in Chipset discussion? I was waiting for it. With the huge amount of contradicting info going around from both Intel and manufacturers, I still want a final word on that, and you are close enough to the Intel guys to get it (And by final word, I mean someone that can also explain why the documentation incosistency).<br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1523059#p1523059" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1523059</a></p><p>I&#039;m still pondering how reelevant it is to get a Chipset that Intel claims that has VT-d support, in case I have to make or recommend a new build for this usage. Yes, I know that you can get this working on Desktop, yet I want to know if Server parts have a definite advantage which is not Firmware related.</p><br /><p>Also, I&#039;m aware that LGA 1155/1150 parts does not support ACS for the PCIe Controller of the Processor, so all PCIe slots that are connected to it should fall into the same IOMMU Group. However, assuming there is a Motherboard that adds a PLX chip (Typically you see it in some high end Motherboards that claims SLI/Crossfire in 16x/16x mode instead of 8x/8x), can the PLX chip itself isolate the PCIe Cards below it even if there is no isolation between Processor PCIe Controller and the PLX chip?<br />What about the new trend of PCIe SSDs supporting NVMe? Aren&#039;t they PCI devices? Could I do something like, do PCI Passthrough of a PCIe SSD to a VM, then using the OVMF Firmware and QEMU NVMe support to boot from it? I&#039;m also curious on how SATA Express and M.2 devices looks like from this point of view (Do they appear in lspci?), since they use PCIe Lanes and also SATA, which could come from two different places (SATA from Chipset, but PCIe Lanes can come from either the same Chipset or from the Processor itself). I expect these two to be rather hard to work with.</p><br /><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve heard some news about XenGT(or KVMGT or whatever) in linux 4.1, but <a href="https://lkml.org/lkml/2015/6/22/8" rel="nofollow">lkml</a> doesn&#039;t hint me on details.<br />Can anyone give me a brief info about it&#039;s state? Does anybody knows about it?</p></div></blockquote></div><p>According to Phoronix there was something related to XenGT that was included in 4.1:<br /><a href="http://www.phoronix.com/scan.php?page=news_item&amp;px=Linux-4.1-Intel-DRM-First" rel="nofollow">http://www.phoronix.com/scan.php?page=n … -DRM-First</a></p><p>It talks about &quot;client side&quot; and &quot;guest&quot;. I believe than it means that the Linux 4.1 Intel i915 Driver is XenGT/KVMGT ready from inside a VM, but it still doesn&#039;t mention anything about host side (Since it needs support from both the Linux kernel, QEMU, SeaBIOS, and for Xen, Xen itself. Not sure if the KVM component also needs a hand or is included in the Linux kernel part). So basically, I take that you don&#039;t need a special build of the Drivers to use the virtualized GPU from inside a VM, but you would still need to set up the host.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541372" class="blockpost roweven"> <h2><span><span class="conr">#5489</span> <a href="viewtopic.php?pid=1541372#p1541372">2015-07-01 21:37:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@devianceluka:<br />Things to try also:<br />Flashing the motherboard&#039;s firmware. Maybe there are updates of that asmedia(i suppose it&#039;s soldered to the board just like mine) controller&#039;s firmware too.<br />Digging into the GPU in question - I have R7 250E and i&#039;ve got my UEFI support working by doing weird and strange things which i completely understand now. Maybe you&#039;ll be able to pull that trick too?<br />Modifying the firmware itself would be almost impossible, sadly. But, i think, you can feed the firmware with any EFI driver for a device just by putting them on a right filesystem(fat32 of some sort). And it will load. Sadly, USB controllers have nothing to do with pci option roms.</p><p>P.S.</p><div class="quotebox"><blockquote><div><p>Would you flash your Android</p></div></blockquote></div><p>I&#039;d flash it with a flashbang grenade. Considering all this mess we have on x86 platforms, i don&#039;t even want to know anything about android and vendors and hardware and driver blobs and stuff. I don&#039;t want to loose my last remains of sanity. So i&#039;m stuck with a buttoney half chinese flip-phone and a dead sony err.. with some soldering iron modifications. I don&#039;t have much social life to rely on all those funky whatsapp-viber-facebook-twitter stuff, i don&#039;t even get enough e-mails.<br />If you need 100% insurance that everything will work - boot the windows baremetal if your operation is not available on linux host. If you have security concerns about that, unplug everything unneeded from the machine beforehand. If you set it up right, that is an easy task to do.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541372">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541374" class="blockpost rowodd"> <h2><span><span class="conr">#5490</span> <a href="viewtopic.php?pid=1541374#p1541374">2015-07-01 21:42:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>What are you saying about UEFI GPU trickery? Dont understand. You hacked it or what? Got a link?<br />Where to search for asmedia fw update? The MB BIOS is latest...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541374">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541507" class="blockpost roweven"> <h2><span><span class="conr">#5491</span> <a href="viewtopic.php?pid=1541507#p1541507">2015-07-02 14:47:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92280">iH8c0ff33</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-02</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:daniele.monteleone.it@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone,<br />I&#039;m trying to passtrough an Nvidia GTX 770.<br />I used the AUR package linux-vfio and booting with &quot;i915.enable_hd_vgaarb=1 intel_iommu=on&quot; but i keep getting this error:<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: error opening /dev/vfio/1: No such file or directory<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: failed to get group 1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />so i searched google for this error and found another boot parameter for ACS override but the error hasn&#039;t changed so much<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: error opening /dev/vfio/13: No such file or directory<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: failed to get group 13<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />I don&#039;t know what to do please help me<br />Thanks</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541507">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541509" class="blockpost rowodd"> <h2><span><span class="conr">#5492</span> <a href="viewtopic.php?pid=1541509#p1541509">2015-07-02 14:57:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@devianceluka:<br />Things to try also:<br />Flashing the motherboard&#039;s firmware. Maybe there are updates of that asmedia(i suppose it&#039;s soldered to the board just like mine) controller&#039;s firmware too.<br />Digging into the GPU in question - I have R7 250E and i&#039;ve got my UEFI support working by doing weird and strange things which i completely understand now. Maybe you&#039;ll be able to pull that trick too?<br />Modifying the firmware itself would be almost impossible, sadly. But, i think, you can feed the firmware with any EFI driver for a device just by putting them on a right filesystem(fat32 of some sort). And it will load. Sadly, USB controllers have nothing to do with pci option roms.</p><p>P.S.</p><div class="quotebox"><blockquote><div><p>Would you flash your Android</p></div></blockquote></div><p>I&#039;d flash it with a flashbang grenade. Considering all this mess we have on x86 platforms, i don&#039;t even want to know anything about android and vendors and hardware and driver blobs and stuff. I don&#039;t want to loose my last remains of sanity. So i&#039;m stuck with a buttoney half chinese flip-phone and a dead sony err.. with some soldering iron modifications. I don&#039;t have much social life to rely on all those funky whatsapp-viber-facebook-twitter stuff, i don&#039;t even get enough e-mails.<br />If you need 100% insurance that everything will work - boot the windows baremetal if your operation is not available on linux host. If you have security concerns about that, unplug everything unneeded from the machine beforehand. If you set it up right, that is an easy task to do.</p></div></blockquote></div><p>Are you going to let me in the dust waiting forever with your half completed answer? Can you elaborate more on GPU GOP trickery?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541532" class="blockpost roweven"> <h2><span><span class="conr">#5493</span> <a href="viewtopic.php?pid=1541532#p1541532">2015-07-02 15:59:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Are you going to let me in the dust waiting forever with your half completed answer? Can you elaborate more on GPU GOP trickery?</p></div></blockquote></div><p>Patience, my friend. I understand your passion, as i have adopted the same feeling some time ago. But sometimes i have to allocate some time on my RL problems. You&#039;d be pretty shocked to know the details, so i won&#039;t share them.</p><p>I don&#039;t know anything about asmedia, but i suggest you digging in the other direction.<br />(I&#039;d give you a link to my earlier messages about that, but i don&#039;t remember when i wrote them so..)<br />So. The idea is simple. My vendor(ASUS) supplied an update of GPU FW which enabled GOP and that image contained an .efi device driver.<br />BUT IT WAS BROKEN! So i went and googled for a supplement.<br />And i&#039;ve found two things:<br />1. In the early days of UEFI and GOP(2008-2010, i think) AMD gave a presentation about GOP support being <span class="bbu">universal</span> for all their 6 and 7 series GPUs. 8 and R5-7-9 stuff didn&#039;t exist that day.<br />2. Some mac fanatics compiled a ROM file with a efi driver from some 6XXX card. So that hinted me that i can take my broken firmware and replace the GOP part with the working one, taken from some 6-series(i think it was called barton or barts..) card.</p><p>That i did. I don&#039;t remember how to do that properly, so i&#039;m not able to give you step-by-step instructions.<br />What you need to do: take <a href="http://rghost.net/6JcLBXhxg" rel="nofollow">my UEFI-capable ROM</a> which i made for myself, use EDK2 tool called... called...<br />damn i forgot. Anyway, <a href="https://github.com/andyvand/UEFIRomExtract" rel="nofollow">try using that</a> to extract the .efi that really works and then you need to compress it back into your own &quot;legacy-only&quot; ROM made for your card exclusively. Append that romfile to your device in a VM(so no need to flash anything!) and hope it will work.</p><p>There are tools in EDK2 for that tasks, i just forgot how they were named and where are they.</p><p><span class="bbs">I&#039;ll try lurking through my old messages to find the details, but considering your inpatience..</span></p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1513281#p1513281" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 1#p1513281</a><br />Here. The message with the details and links and stuff. Modifying GPU ROM is easier that USB controllers&#039;.<br />...just found out that that message contains a link to my previous message about that. LOL.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-02 18:41:58)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541532">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541546" class="blockpost rowodd"> <h2><span><span class="conr">#5494</span> <a href="viewtopic.php?pid=1541546#p1541546">2015-07-02 16:34:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Are you going to let me in the dust waiting forever with your half completed answer? Can you elaborate more on GPU GOP trickery?</p></div></blockquote></div><p>Patience, my friend. I understand your passion, as i have adopted the same feeling some time ago. But sometimes i have to allocate some time on my RL problems. You&#039;d be pretty shocked to know the details, so i won&#039;t share them.</p><p>I don&#039;t know anything about asmedia, but i suggest you digging in the other direction.<br />(I&#039;d give you a link to my earlier messages about that, but i don&#039;t remember when i wrote them so..)<br />So. The idea is simple. My vendor(ASUS) supplied an update of GPU FW which enabled GOP and that image contained an .efi device driver.<br />BUT IT WAS BROKEN! So i went and googled for a supplement.<br />And i&#039;ve found two things:<br />1. In the early days of UEFI and GOP(2008-2010, i think) AMD gave a presentation about GOP support being <span class="bbu">universal</span> for all their 6 and 7 series GPUs. 8 and R5-7-9 stuff didn&#039;t exist that day.<br />2. Some mac fanatics compiled a ROM file with a efi driver from some 6XXX card. So that hinted me that i can take my broken firmware and replace the GOP part with the working one, taken from some 6-series(i think it was called barton or barts..) card.</p><p>That i did. I don&#039;t remember how to do that properly, so i&#039;m not able to give you step-by-step instructions.<br />What you need to do: take <a href="http://rghost.net/6JcLBXhxg" rel="nofollow">my UEFI-capable ROM</a> which i made for myself, use EDK2 tool called... called...<br />damn i forgot. Anyway, <a href="https://github.com/andyvand/UEFIRomExtract" rel="nofollow">try using that</a> to extract the .efi that really works and then you need to compress it back into your own &quot;legacy-only&quot; ROM made for your card exclusively. Append that romfile to your device in a VM(so no need to flash anything!) and hope it will work.</p><p>There are tools in EDK2 for that tasks, i just forgot how they were named and where are they.</p><p><span class="bbs">I&#039;ll try lurking through my old messages to find the details, but considering your inpatience..</span></p><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1513281#p1513281" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 1#p1513281</a><br />Here. The message with the details and links and stuff. Modifying GPU ROM is easier that USB controllers&#039;.</p></div></blockquote></div><p>Thanks man! I will look into it as that&#039;s my only option...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541546">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541549" class="blockpost roweven"> <h2><span><span class="conr">#5495</span> <a href="viewtopic.php?pid=1541549#p1541549">2015-07-02 16:50:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92280">iH8c0ff33</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-02</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:daniele.monteleone.it@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>iH8c0ff33 wrote:</cite><blockquote><div><p>Hi everyone,<br />I&#039;m trying to passtrough an Nvidia GTX 770.<br />I used the AUR package linux-vfio and booting with &quot;i915.enable_hd_vgaarb=1 intel_iommu=on&quot; but i keep getting this error:<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: error opening /dev/vfio/1: No such file or directory<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: failed to get group 1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />so i searched google for this error and found another boot parameter for ACS override but the error hasn&#039;t changed so much<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: error opening /dev/vfio/13: No such file or directory<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: failed to get group 13<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed<br />qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized<br />----------------------------------------------------------------------------------------------------------------------------------------------------------------<br />I don&#039;t know what to do please help me<br />Thanks</p></div></blockquote></div><p>Ok I think i solved the probled. I tried not to use the Systemd service and running vfio-bind many times then it worked O.o<br />Thanks anyway</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541549">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541606" class="blockpost rowodd"> <h2><span><span class="conr">#5496</span> <a href="viewtopic.php?pid=1541606#p1541606">2015-07-02 22:15:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87349">sunmast</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87349">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I&#039;m trying to pass through a EVGA GTX 960 card with OVMF method (because I need to use Intel IGP on the host), but I&#039;m hitting the VM unable to reboot problem (unable to reboot VM unless reboot host first, otherwise host freezes). It seems the card is not reset correctly between reboots.</p><p>Searching the thread it seems one workaround is to &quot;eject&quot; the card before Windows shutdown, but does this work for OVMF method? In Windows I don&#039;t see the card is removable. I&#039;ve tried deveject and devcon (from WDK), they both don&#039;t work. I&#039;ve also tried to disable the card before shutdown, it doesn&#039;t solve the problem.</p><p>I&#039;m wondering if there is any command from host side can help? Like reset the card each time when qemu exits?</p><p>Thanks in advance!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541606">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541735" class="blockpost roweven"> <h2><span><span class="conr">#5497</span> <a href="viewtopic.php?pid=1541735#p1541735">2015-07-03 12:30:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92299">maelask3</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-03</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92299">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Using Libvirt 1.2.17 and QEMU 2.3, Windows 8.1 setup BSODs (SYSTEM_SERVICE_EXCEPTION) no matter if the machine is i440fx or q35, or if the graphics card is passed through or not when it gets to Copying files.<br />Windows 10 setup doesn&#039;t even boot.<br />Edit : Worth mentioning : using OVMF with a Radeon R9 270X (Gigabyte OC)</p> <p class="postedit"><em>Last edited by maelask3 (2015-07-03 12:31:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541735">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541784" class="blockpost rowodd"> <h2><span><span class="conr">#5498</span> <a href="viewtopic.php?pid=1541784#p1541784">2015-07-03 15:52:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92304">Zeorymer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-03</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jerichokru@aol.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre class="vscroll"><code>AMD-Vi: device: 00:00.2 cap: 0040 seg: 0 flags: 3e info 1300 AMD-Vi: mmio-addr: 00000000feb20000 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:00.2 AMD-Vi: DEV_SELECT devid: 00:02.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 01:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 01:00.1 AMD-Vi: DEV_SELECT devid: 00:04.0 flags: 00 AMD-Vi: DEV_SELECT devid: 02:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:05.0 flags: 00 AMD-Vi: DEV_SELECT devid: 03:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:06.0 flags: 00 AMD-Vi: DEV_SELECT devid: 04:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:07.0 flags: 00 AMD-Vi: DEV_SELECT devid: 05:00.0 flags: 00 AMD-Vi: DEV_SELECT devid: 00:11.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:12.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:12.2 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:13.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:13.2 AMD-Vi: DEV_SELECT devid: 00:14.0 flags: d7 AMD-Vi: DEV_SELECT devid: 00:14.3 flags: 00 AMD-Vi: DEV_SELECT devid: 00:14.4 flags: 00 AMD-Vi: DEV_ALIAS_RANGE devid: 06:00.0 flags: 00 devid_to: 00:14.4 AMD-Vi: DEV_RANGE_END devid: 06:1f.7 AMD-Vi: DEV_SELECT devid: 00:14.5 flags: 00 AMD-Vi: DEV_SELECT devid: 00:15.0 flags: 00 AMD-Vi: DEV_SELECT_RANGE_START devid: 07:00.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 07:00.1 AMD-Vi: DEV_SELECT_RANGE_START devid: 00:16.0 flags: 00 AMD-Vi: DEV_RANGE_END devid: 00:16.2 AMD-Vi: DEV_SPECIAL(IOAPIC[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(HPET[0]) devid: 00:14.0 AMD-Vi: DEV_SPECIAL(IOAPIC[255]) devid: 00:00.1 [Firmware Bug]: AMD-Vi: IOAPIC[9] not in IVRS table [Firmware Bug]: AMD-Vi: IOAPIC[10] not in IVRS table [Firmware Bug]: AMD-Vi: No southbridge IOAPIC found AMD-Vi: Disabling interrupt remapping</code></pre></div><p>I&#039;m assuming my table is broken?</p><p>I&#039;m not exactly sure how to interpert the iommu dump data.</p><p>EDIT:&#160; May help</p><div class="codebox"><pre class="vscroll"><code>00:00.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx0 port B) [1002:5a14] (rev 02) 00:00.2 IOMMU [0806]: Advanced Micro Devices, Inc. [AMD/ATI] RD990 I/O Memory Management Unit (IOMMU) [1002:5a23] 00:02.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port B) [1002:5a16] 00:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port D) [1002:5a18] 00:05.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port E) [1002:5a19] 00:06.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port F) [1002:5a1a] 00:07.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port G) [1002:5a1b] 00:11.0 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode] [1002:4391] (rev 40) 00:12.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller [1002:4397] 00:12.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller [1002:4396] 00:13.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller [1002:4397] 00:13.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller [1002:4396] 00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller [1002:4385] (rev 42) 00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller [1002:439d] (rev 40) 00:14.4 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge [1002:4384] (rev 40) 00:14.5 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller [1002:4399] 00:15.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) [1002:43a0] 00:16.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller [1002:4397] 00:16.2 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller [1002:4396] 00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 0 [1022:1600] 00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 1 [1022:1601] 00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 2 [1022:1602] 00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 3 [1022:1603] 00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 4 [1022:1604] 00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 5 [1022:1605] 01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] RV630 XT [Radeon HD 2600 XT] [1002:9588] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] RV630 HDMI Audio [Radeon HD 2600 Series] [1002:aa08] 02:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 06) 03:00.0 USB controller [0c03]: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller [1b21:1042] 04:00.0 SATA controller [0106]: JMicron Technology Corp. JMB362 SATA Controller [197b:2362] (rev 10) 05:00.0 USB controller [0c03]: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller [1b21:1042] 06:06.0 Multimedia audio controller [0401]: C-Media Electronics Inc CMI8788 [Oxygen HD Audio] [13f6:8788] 07:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti PRO [Radeon HD 7950/8950 OEM / R9 280] [1002:679a] 07:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series] [1002:aaa0]</code></pre></div> <p class="postedit"><em>Last edited by Zeorymer (2015-07-03 15:58:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541784">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541797" class="blockpost roweven"> <h2><span><span class="conr">#5499</span> <a href="viewtopic.php?pid=1541797#p1541797">2015-07-03 17:03:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><p><span class="postimg"><img src="http://i.imgur.com/Mvd6M1B.png" alt="Mvd6M1B.png" /></span><br />I&#039;m assuming my table is broken?</p></div></blockquote></div><p>Try </p><div class="codebox"><pre><code>ivrs_ioapic[7]=00:14.0 ivrs_ioapic[8]=00:00.1</code></pre></div><p>mapping ioapic directly. Adjust accordingly, if i recall correctly - that should work for 990FX...</p><p>BTW, what versions of everything do you use? I <a href="https://lkml.org/lkml/2012/9/25/511" rel="nofollow">observe fixes</a> for this being added somewhere in 2012. AW may correct me.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-03 17:13:45)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541797">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1541804" class="blockpost rowodd"> <h2><span><span class="conr">#5500</span> <a href="viewtopic.php?pid=1541804#p1541804">2015-07-03 17:35:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92304">Zeorymer</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-03</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jerichokru@aol.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Zeorymer wrote:</cite><blockquote><div><p><a href="http://i.imgur.com/Mvd6M1B.png" rel="nofollow">http://i.imgur.com/Mvd6M1B.png</a><br />I&#039;m assuming my table is broken?</p></div></blockquote></div><p>Try </p><div class="codebox"><pre><code>ivrs_ioapic[7]=00:14.0 ivrs_ioapic[8]=00:00.1</code></pre></div><p>mapping ioapic directly. Adjust accordingly, if i recall correctly - that should work for 990FX...</p><p>BTW, what versions of everything do you use? I <a href="https://lkml.org/lkml/2012/9/25/511" rel="nofollow">observe fixes</a> for this being added somewhere in 2012. AW may correct me.</p></div></blockquote></div><p>Even though it complains about ioapic[9] and ioapic[10]?&#160; Then again, iommu is not my expertise.</p><p>Kernel is -ck with required options enabled for passthrough.</p><p>Everything else was in Arch repos, though I haven&#039;t really gotten that far thanks to Asus not knowing how to make a bios correctly.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1541804">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=219">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=218">218</a> <a href="viewtopic.php?id=162768&amp;p=219">219</a> <strong>220</strong> <a href="viewtopic.php?id=162768&amp;p=221">221</a> <a href="viewtopic.php?id=162768&amp;p=222">222</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=221">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
