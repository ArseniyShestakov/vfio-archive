<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 27) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=27" title="Page 27" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=26" title="Page 26" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=28" title="Page 28" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=26">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <a href="viewtopic.php?id=162768&amp;p=26">26</a> <strong>27</strong> <a href="viewtopic.php?id=162768&amp;p=28">28</a> <a href="viewtopic.php?id=162768&amp;p=29">29</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=28">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1343568" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#651</span> <a href="viewtopic.php?pid=1343568#p1343568">2013-10-31 00:44:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>Now it gives me a different error</p><div class="codebox"><pre><code>error: Failed to start domain windows7 error: internal error: early end of file from monitor: possible problem: qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error opening /dev/vfio/15: Operation not permitted qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><br /><p>The devices are bound to vfio already.</p></div></blockquote></div><p>vfio operates on iommu groups so you may need to attach more than just the devices being assigned to vfio-pci.&#160; Look in /sys/bus/pci/devices/0000:02:00.0/iommu_group/devices/ and verify all the devices in there other than root ports are attached to vfio-pci.</p></div></blockquote></div><p>Even without acs_override that group has always been its own. Only 02:00.0 and 02:00.1 (audio) are there. Both are bound to vfio.</p><p>Besides, it works when I call qemu directly. I get a lot of BSODs eventually but it works.</p> <p class="postedit"><em>Last edited by Chetyre (2013-10-31 00:46:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343572" class="blockpost roweven"> <h2><span><span class="conr">#652</span> <a href="viewtopic.php?pid=1343572#p1343572">2013-10-31 00:56:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>Now it gives me a different error</p><div class="codebox"><pre><code>error: Failed to start domain windows7 error: internal error: early end of file from monitor: possible problem: qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error opening /dev/vfio/15: Operation not permitted qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><br /><p>The devices are bound to vfio already.</p></div></blockquote></div><p>vfio operates on iommu groups so you may need to attach more than just the devices being assigned to vfio-pci.&#160; Look in /sys/bus/pci/devices/0000:02:00.0/iommu_group/devices/ and verify all the devices in there other than root ports are attached to vfio-pci.</p></div></blockquote></div><p>Even without acs_override that group has always been its own. Only 02:00.0 and 02:00.1 (audio) are there. Both are bound to vfio.</p><p>Besides, it works when I call qemu directly. I get a lot of BSODs eventually but it works.</p></div></blockquote></div><p>have you tried adding &quot;/dev/vfio/15&quot; to cgroup_device_acl =[..]&#160; on /etc/libvirt/qemu.conf?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343572">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343604" class="blockpost rowodd"> <h2><span><span class="conr">#653</span> <a href="viewtopic.php?pid=1343604#p1343604">2013-10-31 02:50:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76403">sabzn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-31</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76403">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello guys.<br />Sorry to bother you, but I just can&#039;t get this to work as it should.<br />For quite some time I&#039;ve been trying to get Windows 7 to work with VGA-Passthrough using my 7970.<br />The VM starts fine and VGA-Passthrough seems to be working to some extend (the VM&#039;s output is shown through the passthrough&#039;d GPU). Dmesg shows no errors either.<br />As I said, the video output through the VM works fine as long as I don&#039;t install the Catalyst drivers.<br />Whenever I try to install them, the VM BSOD&#039;s during the next restart with the &quot;device reset timeout&quot; error mentioned on page 23/24 in this thread, but the suggested fixes didn&#039;t work for me.<br />When I manually load the VGA BIOS (with rombar=0,romfile=/home/user/7970.rom), the VM does not bluescreen, but the Catalyst driver throws an error message saying that it failed to load the driver.<br />The GPU itself seems to be recognized by the Device Manager and programs like GPU-z, but there is still no acceleration available (see link below)<br /><a href="http://picpaste.com/pics/qlq1Pz79.1383184744.png" rel="nofollow">http://picpaste.com/pics/qlq1Pz79.1383184744.png</a></p><p>So far I have tried Catalyst 12.4, 12.10, 13.4 and 13.11 beta, but all of them show the same results.</p><p>Specs:<br />Intel i5-4670, integrated GPU used for the host<br />AsRock z87 Pro4<br />AMD Radeon HD 7970, used for passthrough<br />Kernel 3.12-rc6 with the i915 patches applied.</p><p>I have yet to apply the pcie_acs_override patch, but I don&#039;t think the problem is related to this one.</p><br /><p>If you need any other information about the system such as exact configurations or logs, please let me know.</p><p>best regards</p> <p class="postedit"><em>Last edited by sabzn (2013-10-31 02:52:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343604">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343622" class="blockpost roweven"> <h2><span><span class="conr">#654</span> <a href="viewtopic.php?pid=1343622#p1343622">2013-10-31 04:14:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sabzn wrote:</cite><blockquote><div><p>Hello guys.<br />Sorry to bother you, but I just can&#039;t get this to work as it should.<br />For quite some time I&#039;ve been trying to get Windows 7 to work with VGA-Passthrough using my 7970.<br />The VM starts fine and VGA-Passthrough seems to be working to some extend (the VM&#039;s output is shown through the passthrough&#039;d GPU). Dmesg shows no errors either.<br />As I said, the video output through the VM works fine as long as I don&#039;t install the Catalyst drivers.<br />Whenever I try to install them, the VM BSOD&#039;s during the next restart with the &quot;device reset timeout&quot; error mentioned on page 23/24 in this thread, but the suggested fixes didn&#039;t work for me.<br />When I manually load the VGA BIOS (with rombar=0,romfile=/home/user/7970.rom), the VM does not bluescreen, but the Catalyst driver throws an error message saying that it failed to load the driver.<br />The GPU itself seems to be recognized by the Device Manager and programs like GPU-z, but there is still no acceleration available (see link below)<br /><a href="http://picpaste.com/pics/qlq1Pz79.1383184744.png" rel="nofollow">http://picpaste.com/pics/qlq1Pz79.1383184744.png</a></p><p>So far I have tried Catalyst 12.4, 12.10, 13.4 and 13.11 beta, but all of them show the same results.</p><p>Specs:<br />Intel i5-4670, integrated GPU used for the host<br />AsRock z87 Pro4<br />AMD Radeon HD 7970, used for passthrough<br />Kernel 3.12-rc6 with the i915 patches applied.</p><p>I have yet to apply the pcie_acs_override patch, but I don&#039;t think the problem is related to this one.</p><br /><p>If you need any other information about the system such as exact configurations or logs, please let me know.</p><p>best regards</p></div></blockquote></div><p>Based on the GPU being listed as installed on a PCI bus and it&#039;s bus address of 00:02.0, I&#039;m guessing that you&#039;re using the default 440fx machine model.&#160; I think most folks here are having better success using the q35 model.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343622">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343656" class="blockpost rowodd"> <h2><span><span class="conr">#655</span> <a href="viewtopic.php?pid=1343656#p1343656">2013-10-31 07:14:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76403">sabzn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-31</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76403">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Based on the GPU being listed as installed on a PCI bus and it&#039;s bus address of 00:02.0, I&#039;m guessing that you&#039;re using the default 440fx machine model.&#160; I think most folks here are having better success using the q35 model.</p></div></blockquote></div><p>I&#039;m fairly certain that it&#039;s using q35. -M q35 is set in the start script and even programs in windows hint that the q35 chipset is being used.</p><p>I will check it again when I&#039;m at home though.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343656">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343717" class="blockpost roweven"> <h2><span><span class="conr">#656</span> <a href="viewtopic.php?pid=1343717#p1343717">2013-10-31 12:17:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dear All,<br />Could you please help to find the best solution to share drive (array) between two virtual machines in the same time:<br />1. Real machine: qemu host, combine real hard drive to ZFS partition<br />2. Virtual Linux machine should has access to ZFS partition<br />3. Virtual Windows machine should has access to ZFS partition<br />I am sorry for offtop question, but it would be great if someone point me to right direction.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343719" class="blockpost rowodd"> <h2><span><span class="conr">#657</span> <a href="viewtopic.php?pid=1343719#p1343719">2013-10-31 12:29:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>vfio operates on iommu groups so you may need to attach more than just the devices being assigned to vfio-pci.&#160; Look in /sys/bus/pci/devices/0000:02:00.0/iommu_group/devices/ and verify all the devices in there other than root ports are attached to vfio-pci.</p></div></blockquote></div><p>Even without acs_override that group has always been its own. Only 02:00.0 and 02:00.1 (audio) are there. Both are bound to vfio.</p><p>Besides, it works when I call qemu directly. I get a lot of BSODs eventually but it works.</p></div></blockquote></div><p>have you tried adding &quot;/dev/vfio/15&quot; to cgroup_device_acl =[..]&#160; on /etc/libvirt/qemu.conf?</p></div></blockquote></div><p>I had the same &quot;Operation not permitted&quot; issue, and that fixed it. Thanks!</p><p>Having it in libvirt is pretty neat! (Until now I had a systemd --user service)</p> <p class="postedit"><em>Last edited by teekay (2013-10-31 12:32:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343719">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343723" class="blockpost roweven"> <h2><span><span class="conr">#658</span> <a href="viewtopic.php?pid=1343723#p1343723">2013-10-31 12:38:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Dear All,<br />Could you please help to find the best solution to share drive (array) between two virtual machines in the same time:<br />1. Real machine: qemu host, combine real hard drive to ZFS partition<br />2. Virtual Linux machine should has access to ZFS partition<br />3. Virtual Windows machine should has access to ZFS partition<br />I am sorry for offtop question, but it would be great if someone point me to right direction.</p></div></blockquote></div><p><em>zfs set sharesmb=on pool/fs</em> maybe?</p><p><a href="http://zfsonlinux.org/faq.html#HowDoISetupShares" rel="nofollow">http://zfsonlinux.org/faq.html#HowDoISetupShares</a></p> <p class="postedit"><em>Last edited by teekay (2013-10-31 12:40:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343723">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343737" class="blockpost rowodd"> <h2><span><span class="conr">#659</span> <a href="viewtopic.php?pid=1343737#p1343737">2013-10-31 13:42:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76403">sabzn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-31</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76403">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sabzn wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Based on the GPU being listed as installed on a PCI bus and it&#039;s bus address of 00:02.0, I&#039;m guessing that you&#039;re using the default 440fx machine model.&#160; I think most folks here are having better success using the q35 model.</p></div></blockquote></div><p>I&#039;m fairly certain that it&#039;s using q35. -M q35 is set in the start script and even programs in windows hint that the q35 chipset is being used.</p><p>I will check it again when I&#039;m at home though.</p></div></blockquote></div><br /><p>I just checked again and it is indeed using q35. The CPU-z Mainboard tab shows the same output as in OP&#039;s screenshots.</p><p>Do you think that this error might be related to the lack of the pcie_acs_override patch?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343737">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343740" class="blockpost roweven"> <h2><span><span class="conr">#660</span> <a href="viewtopic.php?pid=1343740#p1343740">2013-10-31 13:44:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sabzn wrote:</cite><blockquote><div><div class="quotebox"><cite>sabzn wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Based on the GPU being listed as installed on a PCI bus and it&#039;s bus address of 00:02.0, I&#039;m guessing that you&#039;re using the default 440fx machine model.&#160; I think most folks here are having better success using the q35 model.</p></div></blockquote></div><p>I&#039;m fairly certain that it&#039;s using q35. -M q35 is set in the start script and even programs in windows hint that the q35 chipset is being used.</p><p>I will check it again when I&#039;m at home though.</p></div></blockquote></div><br /><p>I just checked again and it is indeed using q35. The CPU-z Mainboard tab shows the same output as in OP&#039;s screenshots.</p><p>Do you think that this error might be related to the lack of the pcie_acs_override patch?</p></div></blockquote></div><p>No.&#160; Even if you&#039;re using q35 you&#039;re still placing the GPU on the root complex rather than behind a root port.&#160; It would be on something other than bus 0 if it were behind a root port.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343884" class="blockpost rowodd"> <h2><span><span class="conr">#661</span> <a href="viewtopic.php?pid=1343884#p1343884">2013-10-31 19:22:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>teekay wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>Even without acs_override that group has always been its own. Only 02:00.0 and 02:00.1 (audio) are there. Both are bound to vfio.</p><p>Besides, it works when I call qemu directly. I get a lot of BSODs eventually but it works.</p></div></blockquote></div><p>have you tried adding &quot;/dev/vfio/15&quot; to cgroup_device_acl =[..]&#160; on /etc/libvirt/qemu.conf?</p></div></blockquote></div><p>I had the same &quot;Operation not permitted&quot; issue, and that fixed it. Thanks!</p><p>Having it in libvirt is pretty neat! (Until now I had a systemd --user service)</p></div></blockquote></div><p>Guess I spoke too soon.</p><p>I can either get VFIO working, OR the ICH9 audio emulation with pulseaudio. But not both.</p><p>If I configure qemu to run as my main user, the VM starts and I get output on the passed through card, but the resolution is low, and also the passed through USB3 controller isn&#039;t working (so, no mouse -.-). The /dev/vfio/16 /dev/vfio/17 /dev/vfio/7 /dev/vfio/vfio devices are chown&#039;ed.<br />In Qemu log I see</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7f0fe95d3ce0, 0x0, 0xb0000000, 0x7f0e44000000) = -12 (C annot allocate memory) qemu-system-x86_64: -device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio_dma_map(0x7f0fe95d3ce0, 0x100000000, 0xd0000000, 0x7f0ef4000000) = -12 (Cannot allocate memory) qemu-system-x86_64: vfio_dma_map(0x7f0fe95d3ce0, 0x0, 0xc0000, 0x7f0e44000000) = -12 (Cannot allocate memory) qemu-system-x86_64: vfio_dma_map(0x7f0fe95d3ce0, 0xc0000, 0x20000, 0x7f0fcf600000) = -12 (Cannot allocate memory) qemu-system-x86_64: vfio_dma_map(0x7f0fe95d3ce0, 0xe0000, 0x20000, 0x7f0fdc200000) = -12 (Cannot allocate memory) qemu-system-x86_64: vfio_dma_map(0x7f0fe95d3ce0, 0x100000, 0xaff00000, 0x7f0e44100000) = -12 (Cannot allocate memory) ...</code></pre></div><p>And dmesg many of those</p><div class="codebox"><pre><code>[ 9507.459310] vfio_pin_pages: RLIMIT_MEMLOCK (65536) exceeded</code></pre></div><p>and some</p><div class="codebox"><pre><code>[ 8845.605035] AMD-Vi: Event logged [IO_PAGE_FAULT device=05:00.0 domain=0x001f address=0x00000001c8cec800 flags=0x0000] [ 8847.018681] AMD-Vi: Event logged [IO_PAGE_FAULT device=04:00.0 domain=0x001f address=0x00000001bf330000 flags=0x0000]</code></pre></div><br /><p>If I run as root, VFIO works fine, but it cannot connect to my user&#039;s pulseaudio session:</p><div class="codebox"><pre><code>pulseaudio: pa_context_connect() failed pulseaudio: Reason: Connection refused pulseaudio: Failed to initialize PA contextaudio: Could not init `pa&#039; audio driver</code></pre></div><p>My domain .xml has</p><div class="codebox"><pre><code> &lt;qemu:env name=&#039;QEMU_PA_SAMPLES&#039; value=&#039;128&#039;/&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DRV&#039; value=&#039;pa&#039;/&gt;</code></pre></div><p>I must be missing something, either way.</p> <p class="postedit"><em>Last edited by teekay (2013-10-31 19:25:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343884">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343892" class="blockpost roweven"> <h2><span><span class="conr">#662</span> <a href="viewtopic.php?pid=1343892#p1343892">2013-10-31 19:41:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi Teekay,</p><p>Pulseaudio is running as a your user, qemu running as root may have difficulties to connect to its session i guess.</p><p>I stopped bothering with pulseaudio and qemu&#039;s sound emulation, as i couln&#039;t get the a/v latency below an acceptable minimum.<br />When playing e.g. this A/V Sync test <a href="http://www.youtube.com/watch?v=cGgf_dbDMsw" rel="nofollow">http://www.youtube.com/watch?v=cGgf_dbDMsw</a> - i always had a noteable lag (with above settings QEMU_PA_SAMPLES=128 it was minimum lag - but still noteable).<br />So i gave up with a fully virtualized soundcard and use a USB connected one.</p><p>Regarding mouse support i can recommend synergy: Its fast enough even for gaming, and when you press the Scroll-Lock button, the mouse gets locked which helps many fullscreen-applications to function perfectly with synergy.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343892">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343901" class="blockpost rowodd"> <h2><span><span class="conr">#663</span> <a href="viewtopic.php?pid=1343901#p1343901">2013-10-31 20:17:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kaeptnb wrote:</cite><blockquote><div><p>Hi Teekay,</p><p>Pulseaudio is running as a your user, qemu running as root may have difficulties to connect to its session i guess.</p><p>I stopped bothering with pulseaudio and qemu&#039;s sound emulation, as i couln&#039;t get the a/v latency below an acceptable minimum.<br />When playing e.g. this A/V Sync test <a href="http://www.youtube.com/watch?v=cGgf_dbDMsw" rel="nofollow">http://www.youtube.com/watch?v=cGgf_dbDMsw</a> - i always had a noteable lag (with above settings QEMU_PA_SAMPLES=128 it was minimum lag - but still noteable).<br />So i gave up with a fully virtualized soundcard and use a USB connected one.</p><p>Regarding mouse support i can recommend synergy: Its fast enough even for gaming, and when you press the Scroll-Lock button, the mouse gets locked which helps many fullscreen-applications to function perfectly with synergy.</p></div></blockquote></div><p>Hi kaeptnb,</p><p>thanks for your input.</p><p>When using qemu command line (as user), both vfio and ICH9 emulation to pulseaudio works fine. For mouse I pass through a dedicated USB3 controller and use a KVM-switch, so no issues there. Audio is working fine for what I need it, too.</p><p>I just wonder what&#039;s missing to get VFIO fully working when running as user in libvirt. I did<br />* chown tom:tom /dev/vfio/{17,18,19}<br />* chmod 666 /dev/vfio/vfio<br />* set memlock to 6GB + 2GB overhead in limits.conf (the VM is confiured to run with 6GB)<br />* set user, group and &quot;clear_emulator_capabilities = 0&quot; in /etc/libvirt/qemu.conf</p><p>Still same RLIMIT_MEMLOCK and &quot;vfio_dma_map .. Cannot allocate memory&quot; errors.</p><p>I&#039;d really like to run as user, not root - Audio is not the only issue here (I could just enable the onboard HDA, pass it through and plug it into my host MAUDIO Delta&#039;s input) - but,&#160; running Windows as root sounds scary! <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p> <p class="postedit"><em>Last edited by teekay (2013-10-31 21:48:12)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343901">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343962" class="blockpost roweven"> <h2><span><span class="conr">#664</span> <a href="viewtopic.php?pid=1343962#p1343962">2013-10-31 22:46:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>yes you&#039;re right, the need to run it as root is suboptimal, but to be honest i think IF any windows process is capabale to get out of kvm its already on the kernel-level - so getting root may be easy anyhow.</p><p>But yes - i also would like to run libvirt/qemu as non-root...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343962">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343964" class="blockpost rowodd"> <h2><span><span class="conr">#665</span> <a href="viewtopic.php?pid=1343964#p1343964">2013-10-31 22:51:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>oh i overread the main part: you can sucessfully run qemu as a user manually!<br />that never worked for me, when i startet qemu as a user i got the same or similar messages like you.</p> <p class="postedit"><em>Last edited by kaeptnb (2013-10-31 22:52:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343964">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1343978" class="blockpost roweven"> <h2><span><span class="conr">#666</span> <a href="viewtopic.php?pid=1343978#p1343978">2013-10-31 23:22:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kaeptnb wrote:</cite><blockquote><div><p>oh i overread the main part: you can sucessfully run qemu as a user manually!<br />that never worked for me, when i startet qemu as a user i got the same or similar messages like you.</p></div></blockquote></div><p>Yup, that works fine. It just required to chown the /dev/vfio devices and the hugetlbfs area.</p><p>Having it in libvirt would be cosmetic. I have some LXC containers managed with libvirt, so this would put everything in a unique interface. But libvirt causes me a headache, no idea where it takes the RLIMIT_MEMLOCK value from. It seems to ignore limits.conf</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1343978">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1344168" class="blockpost rowodd"> <h2><span><span class="conr">#667</span> <a href="viewtopic.php?pid=1344168#p1344168">2013-11-01 08:32:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kaeptnb wrote:</cite><blockquote><div><p>but the shell magic to automise this is probably more hassle than to adapt to libvirt <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Here is a script I use to pin vcpus. It works, though it&#039;s ugly:</p><div class="codebox"><pre><code>qemu [your usual options] -qmp unix:./qmp-sock,server,nowait --monitor stdio i=0 echo &#039;{&quot;execute&quot;:&quot;qmp_capabilities&quot;} {&quot;execute&quot;:&quot;query-cpus&quot;}&#039; | socat UNIX-CONNECT:./qmp-sock STDIO | grep -Po &#039;&quot;thread_id&quot;: (\d)*&#039; | awk &#039;{print $2}&#039; | while read tid do taskset -pc $((i++)) $tid done</code></pre></div><p>Now a question regarding libvirt.<br />Is it possible to launch just one vm with root privileges in libvirt? All my other vms work fine with regular user privileges, I don&#039;t want to switch all of them to root because of one special vm.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1344168">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1344316" class="blockpost roweven"> <h2><span><span class="conr">#668</span> <a href="viewtopic.php?pid=1344316#p1344316">2013-11-01 16:09:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>libvirt does have vfio support, so many of you may have any easier time getting the latest libvirt and enabling vfio that way.&#160; Then it&#039;s a matter of a small wrapper script to add the ,x-vga=on option for the VGA device.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1344316">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1344381" class="blockpost rowodd"> <h2><span><span class="conr">#669</span> <a href="viewtopic.php?pid=1344381#p1344381">2013-11-01 18:23:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I got a bit further regarding the libvirt-as-user issue. On the libvirt mailing list there were some comments about recently added patches the make libvirt set a proper RLIMIT_MEMLOCK value, if either memory is locked in the domain, or if VFIO is configured somewhere.</p><p>This is were your comment comes in, @aw</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>libvirt does have vfio support, so many of you may have any easier time getting the latest libvirt and enabling vfio that way.&#160; Then it&#039;s a matter of a small wrapper script to add the ,x-vga=on option for the VGA device.</p></div></blockquote></div><p>I&#039;m using latest libvirt-git, and I&#039;m struggling to convert this</p><div class="codebox"><pre><code>-device vfio-pci,host=03:00.0,bus=pcie.0</code></pre></div><p>into libvirt xml.<br />Using &quot;virsh edit&quot; I tried like this:</p><div class="codebox"><pre><code> &lt;hostdev type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt;</code></pre></div><p>which generated this address<br />&lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt;<br />and this command line:</p><div class="codebox"><pre><code>-device vfio-pci,host=03:00.0,id=hostdev0,bus=pci.2,addr=0x6</code></pre></div><p>It made the RLIMIT_MEMLOCK issues go away, but it also made the VM run into a boot-&gt;crash-&gt;boot loop.</p><p>Not sure if I&#039;m doing something wrong.. is there a <em>pcie</em> address type maybe?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1344381">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1344740" class="blockpost roweven"> <h2><span><span class="conr">#670</span> <a href="viewtopic.php?pid=1344740#p1344740">2013-11-02 16:16:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76479">Norcoen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Norway</span></dd> <dd><span>Registered: 2013-11-02</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:frankmoll@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,<br />I Have a problem passing through my PCIe <a href="http://www.amazon.de/Transcend-TS-PDC3-Combo-PCI--Schnittstellenkarte/dp/B0056TYT66/ref=sr_1_1?ie=UTF8&amp;qid=1383408161&amp;sr=8-1&amp;keywords=transcend+combo+card" rel="nofollow">Combo Card</a> to the virtual machine, because it has the same ASM1062 Serial ATA Controller as I have onboard.</p><div class="codebox"><pre class="vscroll"><code># lspci -nn 00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v3 Processor DRAM Controller [8086:0c08] (rev 06) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v3 Processor Integrated Graphics Controller [8086:041a] (rev 06) 00:03.0 Audio device [0403]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller [8086:0c0c] (rev 06) 00:14.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI [8086:8c31] (rev 05) 00:16.0 Communication controller [0780]: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 [8086:8c3a] (rev 04) 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection I217-V [8086:153b] (rev 05) 00:1a.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 [8086:8c2d] (rev 05) 00:1b.0 Audio device [0403]: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller [8086:8c20] (rev 05) 00:1c.0 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 [8086:8c10] (rev d5) 00:1c.2 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 [8086:8c14] (rev d5) 00:1c.3 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 [8086:8c16] (rev d5) 00:1c.4 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 [8086:8c18] (rev d5) 00:1c.5 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #6 [8086:8c1a] (rev d5) 00:1d.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 [8086:8c26] (rev 05) 00:1f.0 ISA bridge [0601]: Intel Corporation Z87 Express LPC Controller [8086:8c44] (rev 05) 00:1f.2 SATA controller [0106]: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] [8086:8c02] (rev 05) 00:1f.3 SMBus [0c05]: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller [8086:8c22] (rev 05) 01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Pitcairn PRO [Radeon HD 7850] [1002:6819] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] [1002:aab0] 03:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 04:00.0 Ethernet controller [0200]: Intel Corporation I211 Gigabit Network Connection [8086:1539] (rev 03) 05:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 06:00.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 07:01.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 07:02.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 08:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 09:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02)</code></pre></div><p>I think 05:00.0 to 09:00.0 would be the combo card, but all 3 SATA Controller have [1b21:0612] vendor/device id. Any ideas what would be the best way to pass this whole card to the virtual machine? Do I need to pass those PCI Bridges, too?</p><p>Thanks in advance<br />Frank</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1344740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1344835" class="blockpost rowodd"> <h2><span><span class="conr">#671</span> <a href="viewtopic.php?pid=1344835#p1344835">2013-11-02 20:37:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76088">cjn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-20</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76088">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I got hold of another Radeon HD 5450. I&#039;m trying to pass it through to a Windows 7 guest while using an identical graphics card on the host, which is now running the radeon frame buffer driver (but no X). I still don&#039;t have much luck. In fact, the host crashes hard as soon as I start QEMU, right when the guest is loading the Windows 7 installer and the guest graphics card says &quot;Windows is loading files...&quot;.</p><p>This is the relevant snippet from syslog when the crash happens</p><div class="codebox"><pre><code>Nov 2 15:32:20 host kernel: [ 746.027441] VFIO - User Level meta-driver version: 0.3 Nov 2 15:35:04 host kernel: [ 911.086167] pcieport 0000:00:0d.0: driver skip pci_set_master, fix it! Nov 2 15:35:04 host kernel: [ 911.086173] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) Nov 2 15:35:07 host acpid: input device has been disconnected, fd 7 Nov 2 15:35:07 host kernel: [ 914.162057] vgaarb: device changed decodes: PCI:0000:01:00.0,olddecodes=io+mem,decodes=none:owns=none Nov 2 15:35:08 host kernel: [ 914.777896] usb 6-2.4.1: reset full-speed USB device number 5 using ohci-pci Nov 2 15:35:08 host kernel: [ 915.138530] usb 6-2.4.2: reset low-speed USB device number 6 using ohci-pci Nov 2 15:35:09 host kernel: [ 915.571288] usb 6-2.4.1: reset full-speed USB device number 5 using ohci-pci Nov 2 15:35:09 host kernel: [ 915.935931] usb 6-2.4.2: reset low-speed USB device number 6 using ohci-pci</code></pre></div><p>and <a href="http://bpaste.net/show/146167/" rel="nofollow">this</a> is the VFIO debug output (warning: 4.5MB of logs). Not all of the relevant kernel messages are syslogged, unfortunately. Some only reach the console. I&#039;ve seen crashes in both SATA and USB code.</p><p>My configuration is currently</p><p>Linux 3.12.0-rc7<br />QEMU head as of today (includes SeaBIOS) + nosnoop patch + debug-vfio patch<br />ASRock 990FX Extreme3<br />AMD FX-8350<br />Radeon HD 5450 (host, PCI address 01:00)<br />Radeon HD 5450 (guest, PCI address 05:00)</p><p>I start QEMU like this</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu qemu64 -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/local/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/dev/shm/windows.img,id=disk,format=raw \ -device ide-hd,bus=ahci.0,drive=disk \ -drive file=/root/en_windows_7_home_premium_with_sp1_x64_dvd_u_676549.iso,id=isocd \ -device ide-cd,bus=ahci.1,drive=isocd \ -nographic -usb -usbdevice host:04fe:0006 -usbdevice host:046d:c05b</code></pre></div><p>The passed USB devices are my keyboard and my mouse.</p><p>Due to the fact that my two graphics cards have identical PCI IDs</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Park [Mobility Radeon HD 5430] [1002:68e1] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] [1002:aa68] 05:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Park [Mobility Radeon HD 5430] [1002:68e1] 05:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] [1002:aa68]</code></pre></div><p>and pci-stub accepts only PCI IDs as parameters (and not PCI addresses), I have</p><div class="codebox"><pre><code># Bind both graphics cards to the pci-stub driver and then unbind the one for # the host, making sure that the pci-stub driver is loaded before the drm # driver (and, in turn, before the radeon driver). options pci-stub ids=1002:68e1,1002:aa68 install pci-stub /sbin/modprobe --ignore-install pci-stub $CMDLINE_OPTS; /usr/local/sbin/pci-stub-unbind 0000:01:00.0 0000:01:00.1 softdep drm pre: pci-stub</code></pre></div><p>in /etc/modprobe.d/pci-stub.conf and</p><div class="codebox"><pre><code>#!/bin/sh for dev in &quot;$@&quot; do echo $dev &gt; /sys/bus/pci/drivers/pci-stub/unbind done</code></pre></div><p>in /usr/local/sbin/pci-stub-unbind, to bind the guest graphics card to the pci-stub driver and the host graphics card to the radeon driver.</p><p>Anyway, how do I get rid of the crashes? They seem to be caused by the radeon driver because I get no crashes without it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1344835">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1345032" class="blockpost roweven"> <h2><span><span class="conr">#672</span> <a href="viewtopic.php?pid=1345032#p1345032">2013-11-03 10:58:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>cjn wrote:</cite><blockquote><div><p>Hi all,</p><p>I got hold of another Radeon HD 5450. I&#039;m trying to pass it through to a Windows 7 guest while using an identical graphics card on the host, which is now running the radeon frame buffer driver (but no X). I still don&#039;t have much luck. In fact, the host crashes hard as soon as I start QEMU, right when the guest is loading the Windows 7 installer and the guest graphics card says &quot;Windows is loading files...&quot;.</p><p>This is the relevant snippet from syslog when the crash happens</p><div class="codebox"><pre><code>Nov 2 15:32:20 host kernel: [ 746.027441] VFIO - User Level meta-driver version: 0.3 Nov 2 15:35:04 host kernel: [ 911.086167] pcieport 0000:00:0d.0: driver skip pci_set_master, fix it! Nov 2 15:35:04 host kernel: [ 911.086173] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) Nov 2 15:35:07 host acpid: input device has been disconnected, fd 7 Nov 2 15:35:07 host kernel: [ 914.162057] vgaarb: device changed decodes: PCI:0000:01:00.0,olddecodes=io+mem,decodes=none:owns=none Nov 2 15:35:08 host kernel: [ 914.777896] usb 6-2.4.1: reset full-speed USB device number 5 using ohci-pci Nov 2 15:35:08 host kernel: [ 915.138530] usb 6-2.4.2: reset low-speed USB device number 6 using ohci-pci Nov 2 15:35:09 host kernel: [ 915.571288] usb 6-2.4.1: reset full-speed USB device number 5 using ohci-pci Nov 2 15:35:09 host kernel: [ 915.935931] usb 6-2.4.2: reset low-speed USB device number 6 using ohci-pci</code></pre></div><p>and <a href="http://bpaste.net/show/146167/" rel="nofollow">this</a> is the VFIO debug output (warning: 4.5MB of logs). Not all of the relevant kernel messages are syslogged, unfortunately. Some only reach the console. I&#039;ve seen crashes in both SATA and USB code.</p><p>My configuration is currently</p><p>Linux 3.12.0-rc7<br />QEMU head as of today (includes SeaBIOS) + nosnoop patch + debug-vfio patch<br />ASRock 990FX Extreme3<br />AMD FX-8350<br />Radeon HD 5450 (host, PCI address 01:00)<br />Radeon HD 5450 (guest, PCI address 05:00)</p><p>I start QEMU like this</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu qemu64 -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/local/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/dev/shm/windows.img,id=disk,format=raw \ -device ide-hd,bus=ahci.0,drive=disk \ -drive file=/root/en_windows_7_home_premium_with_sp1_x64_dvd_u_676549.iso,id=isocd \ -device ide-cd,bus=ahci.1,drive=isocd \ -nographic -usb -usbdevice host:04fe:0006 -usbdevice host:046d:c05b</code></pre></div><p>The passed USB devices are my keyboard and my mouse.</p><p>Due to the fact that my two graphics cards have identical PCI IDs</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Park [Mobility Radeon HD 5430] [1002:68e1] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] [1002:aa68] 05:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Park [Mobility Radeon HD 5430] [1002:68e1] 05:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cedar HDMI Audio [Radeon HD 5400/6300 Series] [1002:aa68]</code></pre></div><p>and pci-stub accepts only PCI IDs as parameters (and not PCI addresses), I have</p><div class="codebox"><pre><code># Bind both graphics cards to the pci-stub driver and then unbind the one for # the host, making sure that the pci-stub driver is loaded before the drm # driver (and, in turn, before the radeon driver). options pci-stub ids=1002:68e1,1002:aa68 install pci-stub /sbin/modprobe --ignore-install pci-stub $CMDLINE_OPTS; /usr/local/sbin/pci-stub-unbind 0000:01:00.0 0000:01:00.1 softdep drm pre: pci-stub</code></pre></div><p>in /etc/modprobe.d/pci-stub.conf and</p><div class="codebox"><pre><code>#!/bin/sh for dev in &quot;$@&quot; do echo $dev &gt; /sys/bus/pci/drivers/pci-stub/unbind done</code></pre></div><p>in /usr/local/sbin/pci-stub-unbind, to bind the guest graphics card to the pci-stub driver and the host graphics card to the radeon driver.</p><p>Anyway, how do I get rid of the crashes? They seem to be caused by the radeon driver because I get no crashes without it.</p></div></blockquote></div><p>You&#039;re supposed to bind the card to vfio-pci not pci-stub</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1345032">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1345064" class="blockpost rowodd"> <h2><span><span class="conr">#673</span> <a href="viewtopic.php?pid=1345064#p1345064">2013-11-03 12:51:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76088">cjn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-20</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76088">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You&#039;re supposed to bind the card to vfio-pci not pci-stub</p></div></blockquote></div><p>Thanks, but I already do that, using the vfio-bind script. I run</p><div class="codebox"><pre><code>vfio-bind 0000:05:00.0 0000:05:00.1</code></pre></div><p>right before starting QEMU. This should unbind the graphics card from the pci-stub driver and bind it to the vfio-pci driver.</p><p>Also, my IOMMU group looks fine, as far as I can see</p><div class="codebox"><pre><code>root@host:~# ll /sys/bus/pci/devices/0000\:05\:00.0/iommu_group/devices/ total 0 lrwxrwxrwx 1 root root 0 Nov 3 13:37 0000:05:00.0 -&gt; ../../../../devices/pci0000:00/0000:00:0d.0/0000:05:00.0 lrwxrwxrwx 1 root root 0 Nov 3 13:37 0000:05:00.1 -&gt; ../../../../devices/pci0000:00/0000:00:0d.0/0000:05:00.1</code></pre></div><p>Have you had any luck passing through your Radeon HD 5450 (with the radeon driver loaded)? Or have you only used it on the host?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1345064">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1345526" class="blockpost roweven"> <h2><span><span class="conr">#674</span> <a href="viewtopic.php?pid=1345526#p1345526">2013-11-04 14:14:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76479">Norcoen</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Norway</span></dd> <dd><span>Registered: 2013-11-02</span></dd> <dd><span>Posts: 23</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:frankmoll@gmx.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Norcoen wrote:</cite><blockquote><div><p>Hello,<br />I Have a problem passing through my PCIe <a href="http://www.amazon.de/Transcend-TS-PDC3-Combo-PCI--Schnittstellenkarte/dp/B0056TYT66/ref=sr_1_1?ie=UTF8&amp;qid=1383408161&amp;sr=8-1&amp;keywords=transcend+combo+card" rel="nofollow">Combo Card</a> to the virtual machine, because it has the same ASM1062 Serial ATA Controller as I have onboard.</p><div class="codebox"><pre class="vscroll"><code># lspci -nn 00:00.0 Host bridge [0600]: Intel Corporation Xeon E3-1200 v3 Processor DRAM Controller [8086:0c08] (rev 06) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v3 Processor Integrated Graphics Controller [8086:041a] (rev 06) 00:03.0 Audio device [0403]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller [8086:0c0c] (rev 06) 00:14.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI [8086:8c31] (rev 05) 00:16.0 Communication controller [0780]: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 [8086:8c3a] (rev 04) 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection I217-V [8086:153b] (rev 05) 00:1a.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 [8086:8c2d] (rev 05) 00:1b.0 Audio device [0403]: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller [8086:8c20] (rev 05) 00:1c.0 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 [8086:8c10] (rev d5) 00:1c.2 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 [8086:8c14] (rev d5) 00:1c.3 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 [8086:8c16] (rev d5) 00:1c.4 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 [8086:8c18] (rev d5) 00:1c.5 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #6 [8086:8c1a] (rev d5) 00:1d.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 [8086:8c26] (rev 05) 00:1f.0 ISA bridge [0601]: Intel Corporation Z87 Express LPC Controller [8086:8c44] (rev 05) 00:1f.2 SATA controller [0106]: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] [8086:8c02] (rev 05) 00:1f.3 SMBus [0c05]: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller [8086:8c22] (rev 05) 01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Pitcairn PRO [Radeon HD 7850] [1002:6819] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] [1002:aab0] 03:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 04:00.0 Ethernet controller [0200]: Intel Corporation I211 Gigabit Network Connection [8086:1539] (rev 03) 05:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 06:00.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 07:01.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 07:02.0 PCI bridge [0604]: PLX Technology, Inc. Device [10b5:8603] (rev aa) 08:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 09:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02)</code></pre></div><p>I think 05:00.0 to 09:00.0 would be the combo card, but all 3 SATA Controller have [1b21:0612] vendor/device id. Any ideas what would be the best way to pass this whole card to the virtual machine? Do I need to pass those PCI Bridges, too?</p><p>Thanks in advance<br />Frank</p></div></blockquote></div><p>I think I wrote this in a wrong way. I could pass them to the VM by using their enumeration, but how do I tell my kernel to ignore them on boot with pci-stub?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1345526">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1345612" class="blockpost rowodd"> <h2><span><span class="conr">#675</span> <a href="viewtopic.php?pid=1345612#p1345612">2013-11-04 17:47:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>like this:</p><p>kernel commandline parameter: pci-stub.ids=1002:6819,1002:aab0</p><p>the id&#039;s are not the PCI Bus IDs, but the Device Class/Subclass - you get them with &quot;lspci -vn&quot;</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1345612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=26">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <a href="viewtopic.php?id=162768&amp;p=26">26</a> <strong>27</strong> <a href="viewtopic.php?id=162768&amp;p=28">28</a> <a href="viewtopic.php?id=162768&amp;p=29">29</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=28">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
