<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 225) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=225" title="Page 225" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=224" title="Page 224" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=226" title="Page 226" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=224">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <strong>225</strong> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <a href="viewtopic.php?id=162768&amp;p=227">227</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=226">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1544289" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5601</span> <a href="viewtopic.php?pid=1544289#p1544289">2015-07-13 15:53:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Perhaps it&#039;s a PATH issue then since you&#039;ve taken the liberty to not call the qemu binary with the full path.</p><p>EDIT: Remove the -x for libvirt usage</p> <p class="postedit"><em>Last edited by aw (2015-07-13 15:54:37)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544291" class="blockpost roweven"> <h2><span><span class="conr">#5602</span> <a href="viewtopic.php?pid=1544291#p1544291">2015-07-13 15:55:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />Maybe, but probably not. exec /sbin/qemu-system-x86_64 still fails.<br />EDIT:<br />Removing the -x did not change anything.</p> <p class="postedit"><em>Last edited by morat (2015-07-13 15:56:29)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544291">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544292" class="blockpost rowodd"> <h2><span><span class="conr">#5603</span> <a href="viewtopic.php?pid=1544292#p1544292">2015-07-13 15:57:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Maybe the wrapper script should also be in /sbin, mine lives in /usr/libexec because that&#039;s where my qemu-kvm binary lives</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544292">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544293" class="blockpost roweven"> <h2><span><span class="conr">#5604</span> <a href="viewtopic.php?pid=1544293#p1544293">2015-07-13 16:00:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />Nope. Looks like we&#039;re running out of options <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /><br />EDIT:<br />Diff-ing the two outputs (qemu-kvm.vga &amp; qemu-system-x86_64) shows that they are identical, so it seems irrational that virsh still throws an error.</p> <p class="postedit"><em>Last edited by morat (2015-07-13 16:04:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544293">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544296" class="blockpost rowodd"> <h2><span><span class="conr">#5605</span> <a href="viewtopic.php?pid=1544296#p1544296">2015-07-13 16:04:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Change /bin/sh to /bin/bash?</p><p>Use full paths for echo and sed?</p><p>What distro are you on?&#160; Maybe apparmor or similar is preventing execution.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544296">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544297" class="blockpost roweven"> <h2><span><span class="conr">#5606</span> <a href="viewtopic.php?pid=1544297#p1544297">2015-07-13 16:07:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, it works. Good.<br />Seems unusual that it should require full paths, but w/e, I&#039;m happy. Onto the next problem, whatever it will be.</p><p>EDIT:<br />I haven&#039;t yet built and switched to the patched kernel (which btw, at 4.2-rc1 is missing most of the i915 files targeted by your patch), and that is something that can definitely wait till morning. Good hustle, thanks for the help.</p> <p class="postedit"><em>Last edited by morat (2015-07-13 16:09:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544297">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544298" class="blockpost rowodd"> <h2><span><span class="conr">#5607</span> <a href="viewtopic.php?pid=1544298#p1544298">2015-07-13 16:13:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morat</p><p>Perhaps you could post your working script and reference the distro to help those that come after you.</p><p>I would suggest not using 4.2-rc1, there&#039;s a reason rc kernels are rc.&#160; Use a released kernel.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544298">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544299" class="blockpost roweven"> <h2><span><span class="conr">#5608</span> <a href="viewtopic.php?pid=1544299#p1544299">2015-07-13 16:17:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92386">morat</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-07</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=92386">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>qemu-system-x86_64.vga:</p><div class="codebox"><pre><code>#! /bin/bash exec /sbin/qemu-system-x86_64 \ `/bin/echo &quot;\$@&quot; | \ /bin/sed &#039;s|01:00.0|01:00.0,x-vga=on|g&#039;`</code></pre></div><p>Working on Arch 4.0.7-2-ARCH</p><p>@aw<br />I&#039;ll just rebuild my current kernel then, seems like the safest route.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544299">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544301" class="blockpost rowodd"> <h2><span><span class="conr">#5609</span> <a href="viewtopic.php?pid=1544301#p1544301">2015-07-13 16:39:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><p>Strangely, although I am getting output on the physical card it isn&#039;t listed in device manager. Despite this, the AMD Catalyst installer detects the graphics hardware and tries (unsuccessfully) to install it. It gets up to installing the actual driver, the screen flickers once, then the physical display loses signal, the VM goes offline and ramps up to a constant 100% CPU usage with no disk activity. Happens using both the modified copy of my existing VBIOS and the vendor-provided updated one.</p><p>My hardware:<br />Motherboard: Gigabyte 990FXA-UD3<br />CPU: FX-8350<br />Host GPU: Gigabyte GTX 750 Ti OC<br />Guest GPU: Gigabyte R9 290 (initial reference cooler release)</p></div></blockquote></div><p>I&#039;ll write a guide some day.<br />What guest OS and what device manager(devmgmt.msc?) you&#039;ve used? I find it really odd that you can&#039;t see the card in there.<br />Also, which ROM did you bisect and took .efi part from? I remember finding 3 or 4 variants of GOP driver, maybe you could try different ones.</p><br /><p>UPD: Catalyst 15.7 installed successfully, without any problems. Crossfire works as before.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-13 17:32:41)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544301">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544367" class="blockpost roweven"> <h2><span><span class="conr">#5610</span> <a href="viewtopic.php?pid=1544367#p1544367">2015-07-13 21:11:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Another status update:</p><p>First of all, I use Witcher 3 as my benchmark. It loads roughly four CPUs and goes between being CPU and GPU limited about 50/50 on my (bare) hardware in the open game areas. I figure it makes a good way to check for CPU performance issues. I&#039;ve had stuttering and nasty sound dropouts and I thought it happened when the game was doing IO. The game now runs from a passed through SATA controller&#039;s drive and the stuttering is still the same. Seems I was too quick to place blame. </p><p>I moved my setup on top of libvirt and gained a ghastly amount of qemu command line arguments which I don&#039;t know about and don&#039;t dare touch in case I break it. Why does it do so much extra stuff when the XML is really bare-bones?<br />Anyway, I pinned my CPUs and confirmed that qemu threads were only appearing on the selected CPUs (hit &quot;1&quot; when running top). I ended up giving Windows three cores and their hyperthreads so 6 vCpus. That did not help much either. Then I tried booting my host with isolcpus=2-7 so host processes only run on the first core and its hyperthread. Seems to work beautifully! I only ran it for a very brief time but the constant stutters were all gone. GPU usage and FPS were also up a little, suggesting it&#039;s less CPU bottlenecked now, though that was a very unscientific quick observation.</p><p>I had trouble understanding what exactly was involved in doing cpu pinning since so many different things and use cases have been documented. I&#039;ll take what worked and spell it out in case someone else needs help with it. This is for a HT quad-core with 8 logical CPUs. Adjust the CPU division to your hardware and needs.</p><p>On an existing libvirt setup, put this in the xml file:</p><div class="codebox"><pre><code>&lt;domain&gt; ... &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt; &lt;iothreads&gt;1&lt;/iothreads&gt; &lt;cputune&gt; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;2&#039;/&gt; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;3&#039;/&gt; &lt;vcpupin vcpu=&#039;2&#039; cpuset=&#039;4&#039;/&gt; &lt;vcpupin vcpu=&#039;3&#039; cpuset=&#039;5&#039;/&gt; &lt;vcpupin vcpu=&#039;4&#039; cpuset=&#039;6&#039;/&gt; &lt;vcpupin vcpu=&#039;5&#039; cpuset=&#039;7&#039;/&gt; &lt;emulatorpin cpuset=&#039;0&#039;/&gt; &lt;iothreadpin iothread=&#039;1&#039; cpuset=&#039;1&#039;/&gt; &lt;/cputune&gt; ... &lt;/domain&gt;</code></pre></div><p>What this does is give the guest 6 vCpus and place the guest threads on cores 2-7. (Could be 0-5 instead as well, shouldn&#039;t matter. I opted to keep the first two for the host). I&#039;m not sure if the emulatorpin and iothreadpin settings are necessary but they basically move qemu&#039;s internal tasks and IO handling to the specified CPUs. Read more: <a href="https://libvirt.org/formatdomain.html" rel="nofollow">https://libvirt.org/formatdomain.html</a> <br />This alone won&#039;t do much good because the host will still schedule its threads on the same CPUs. Adding the isolcpus=2-7 makes CPUs 2 through 7 unavailable for regular userspace processes. Some kernel tasks and interrupts still run on them but AFAIK it should be far less intrusive. The isolated CPUs are only used explicitly such as with cpuset. Kind of sucks when you want to use the CPUs on your host. I haven&#039;t looked up if the isolation could be done dynamically but that sounds like an ideal way.</p><p>Edit: Another random observation: using OVMF solves the problem of USB passthrough devices not working until the guest os has booted. At least I think so. Windows 8 has different error recovery menus though so I&#039;m not sure if it loads USB drivers there. Legacy BIOS doesn&#039;t play nice with USB apparently. Same thing happens on my hardware BIOS if I disable its legacy USB hack mode.</p> <p class="postedit"><em>Last edited by impulse_255 (2015-07-13 21:42:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544367">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544459" class="blockpost rowodd"> <h2><span><span class="conr">#5611</span> <a href="viewtopic.php?pid=1544459#p1544459">2015-07-14 03:08:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><p>Strangely, although I am getting output on the physical card it isn&#039;t listed in device manager. Despite this, the AMD Catalyst installer detects the graphics hardware and tries (unsuccessfully) to install it. It gets up to installing the actual driver, the screen flickers once, then the physical display loses signal, the VM goes offline and ramps up to a constant 100% CPU usage with no disk activity. Happens using both the modified copy of my existing VBIOS and the vendor-provided updated one.</p><p>My hardware:<br />Motherboard: Gigabyte 990FXA-UD3<br />CPU: FX-8350<br />Host GPU: Gigabyte GTX 750 Ti OC<br />Guest GPU: Gigabyte R9 290 (initial reference cooler release)</p></div></blockquote></div><p>I&#039;ll write a guide some day.<br />What guest OS and what device manager(devmgmt.msc?) you&#039;ve used? I find it really odd that you can&#039;t see the card in there.<br />Also, which ROM did you bisect and took .efi part from? I remember finding 3 or 4 variants of GOP driver, maybe you could try different ones.</p><br /><p>UPD: Catalyst 15.7 installed successfully, without any problems. Crossfire works as before.</p></div></blockquote></div><p>After further messing about, the card is showing up in device manager using the &#039;Microsoft Basic Display Adapter&#039; driver. It doesn&#039;t list any errors, but Catalyst still won&#039;t install (tried 14.12 which was what I ran under SeaBIOS, also tried 15.7). Guest OS is Windows 8.1. </p><p>I didn&#039;t end up bisecting a driver for the EFI section, as the linked UEFIRomExtract repo only appears to have a binary for Macs, and I have no idea how to compile it from source. As such, I just used the GOP provided in the first version of the AMD-UEFI-GOP-MAKER tool, which I think is from a HD6450.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544459">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544497" class="blockpost roweven"> <h2><span><span class="conr">#5612</span> <a href="viewtopic.php?pid=1544497#p1544497">2015-07-14 09:31:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>UPD: Catalyst 15.7 installed successfully, without any problems. Crossfire works as before.</p></div></blockquote></div><p>Yeah I just got the Catalyst 15.7 working on my HD7770 as well. I just needed to boot Win7 without the GPU passthrough and then hot-plug the GPU via Qemu console (device_add vfio-pci....). After that, the installer works.</p><p>I also figured out a solution to the xHCI/EHCI USB port mapping problem that someone else noted a few pages ago. The problem was that on some Intel based systems, all the physical USB ports found on the motherboard would get mapped behind the single Intel xHCI controller. Even when the chipset contains EHCI controllers that show up in lspci. The solution that I finally came up with, is to directly access the PCI config space of the xHCI controller and change the Port Mapping Mask register. The register simply has a bit for each physical port, selecting if it should show up behind the EHCI controller or the xHCI controller. So for example, with my ASrock board I ended up using: setpci -s 00:14.0 0xd0.W=2037, where 00:14.0 is the address of the xHCI controller, 0xd0 is the address of the port mapping mask register and 0x2037 is the value that maps the physical USB2.0 ports behind EHCI controllers. Now I&#039;m able to passthrough one of the Intel EHCI controllers to my VM and gain 4 x real USB2.0 ports.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544497">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544547" class="blockpost rowodd"> <h2><span><span class="conr">#5613</span> <a href="viewtopic.php?pid=1544547#p1544547">2015-07-14 12:50:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>I also figured out a solution to the xHCI/EHCI USB port mapping problem that someone else noted a few pages ago. The problem was that on some Intel based systems, all the physical USB ports found on the motherboard would get mapped behind the single Intel xHCI controller. Even when the chipset contains EHCI controllers that show up in lspci. The solution that I finally came up with, is to directly access the PCI config space of the xHCI controller and change the Port Mapping Mask register. The register simply has a bit for each physical port, selecting if it should show up behind the EHCI controller or the xHCI controller. So for example, with my ASrock board I ended up using: setpci -s 00:14.0 0xd0.W=2037, where 00:14.0 is the address of the xHCI controller, 0xd0 is the address of the port mapping mask register and 0x2037 is the value that maps the physical USB2.0 ports behind EHCI controllers. Now I&#039;m able to passthrough one of the Intel EHCI controllers to my VM and gain 4 x real USB2.0 ports.</p></div></blockquote></div><p>I am having this exact issue with my X99 platform . Is there a detailed guide or a tutorial that you can redirect me to ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544547">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544569" class="blockpost roweven"> <h2><span><span class="conr">#5614</span> <a href="viewtopic.php?pid=1544569#p1544569">2015-07-14 13:47:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><p>I didn&#039;t end up bisecting a driver for the EFI section, as the linked UEFIRomExtract repo only appears to have a binary for Macs, and I have no idea how to compile it from source. As such, I just used the GOP provided in the first version of the AMD-UEFI-GOP-MAKER tool, which I think is from a HD6450.</p></div></blockquote></div><p>The thing is - that tools are from EDK2. I&#039;ve found EFIRom somewhere there some time ago, but i&#039;ve lost it. Anyway, what&#039;s the device IDs of that basic adapter?<br />I think something is broken deeply.</p><div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>Yeah I just got the Catalyst 15.7 working on my HD7770 as well. I just needed to boot Win7 without the GPU passthrough and then hot-plug the GPU via Qemu console (device_add vfio-pci....). After that, the installer works.</p></div></blockquote></div><p>I dunno, i have two HD7750s attached, i&#039;ve ran the installer, it finished without error and asked for a reboot. After a guest reboot, everything was perfect, except the crossfire turned itself off. With a flick of a switch, all was done.</p> <p class="postedit"><em>Last edited by Duelist (2015-07-14 13:49:42)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544569">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544637" class="blockpost rowodd"> <h2><span><span class="conr">#5615</span> <a href="viewtopic.php?pid=1544637#p1544637">2015-07-14 17:07:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>I also figured out a solution to the xHCI/EHCI USB port mapping problem that someone else noted a few pages ago. The problem was that on some Intel based systems, all the physical USB ports found on the motherboard would get mapped behind the single Intel xHCI controller. Even when the chipset contains EHCI controllers that show up in lspci. The solution that I finally came up with, is to directly access the PCI config space of the xHCI controller and change the Port Mapping Mask register. The register simply has a bit for each physical port, selecting if it should show up behind the EHCI controller or the xHCI controller. So for example, with my ASrock board I ended up using: setpci -s 00:14.0 0xd0.W=2037, where 00:14.0 is the address of the xHCI controller, 0xd0 is the address of the port mapping mask register and 0x2037 is the value that maps the physical USB2.0 ports behind EHCI controllers. Now I&#039;m able to passthrough one of the Intel EHCI controllers to my VM and gain 4 x real USB2.0 ports.</p></div></blockquote></div><p>I am having this exact issue with my X99 platform . Is there a detailed guide or a tutorial that you can redirect me to ?</p></div></blockquote></div><p>I&#039;m afraid there are no guides or tutorials for this. I just used the X87 PCH datasheet to figure out the correct register and then experimented with different values, until I had figured out the mapping between the bitmask and all the physical ports.</p><p>So you would need to start with the <a href="http://www.intel.com/content/www/us/en/chipsets/x99-chipset-pch-datasheet.html" rel="nofollow">X99 PCH datasheet</a> at around page 650 where it gets into xHCI port routing.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>Yeah I just got the Catalyst 15.7 working on my HD7770 as well. I just needed to boot Win7 without the GPU passthrough and then hot-plug the GPU via Qemu console (device_add vfio-pci....). After that, the installer works.</p></div></blockquote></div><p>I dunno, i have two HD7750s attached, i&#039;ve ran the installer, it finished without error and asked for a reboot. After a guest reboot, everything was perfect, except the crossfire turned itself off. With a flick of a switch, all was done.</p></div></blockquote></div><p>I&#039;m running without x-vga, so maybe that&#039;s why.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544637">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544662" class="blockpost roweven"> <h2><span><span class="conr">#5616</span> <a href="viewtopic.php?pid=1544662#p1544662">2015-07-14 19:31:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I&#039;m afraid there are no guides or tutorials for this. I just used the X87 PCH datasheet to figure out the correct register and then experimented with different values, until I had figured out the mapping between the bitmask and all the physical ports.</p><p>So you would need to start with the X99 PCH datasheet at around page 650 where it gets into xHCI port routing.</p></div></blockquote></div><p>Thanks ! It seems that I can only seperate it into 2 controllers only . I&#039;m better off using my PCI-E USB3 card then <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544662">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544672" class="blockpost rowodd"> <h2><span><span class="conr">#5617</span> <a href="viewtopic.php?pid=1544672#p1544672">2015-07-14 20:05:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87349">sunmast</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-16</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87349">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sunmast wrote:</cite><blockquote><div><p>Is it possible to run OSX with OVMF method?</p></div></blockquote></div><p>Yes. I have a proof-picture, if you&#039;re curious.</p></div></blockquote></div><p>Hi Duelist, would you please share your qemu command line to run OSX with OVMF? Are you using Chameleon or Clover?</p><p>Thanks a lot!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544672">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544681" class="blockpost roweven"> <h2><span><span class="conr">#5618</span> <a href="viewtopic.php?pid=1544681#p1544681">2015-07-14 20:27:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68529">Nektarios</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-19</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68529">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there a way to <strong>completely</strong> disable a graphics card (nvidia or ati) when not in use? And when I mean completely, I mean close to 0 power usage, no fan usage etc. </p><p>I want this so I can freely shut down the vga card that I use for the VM passthrough when the VM is not running.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544681">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544699" class="blockpost rowodd"> <h2><span><span class="conr">#5619</span> <a href="viewtopic.php?pid=1544699#p1544699">2015-07-14 21:09:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nektarios wrote:</cite><blockquote><div><p>Is there a way to <strong>completely</strong> disable a graphics card (nvidia or ati) when not in use? And when I mean completely, I mean close to 0 power usage, no fan usage etc. </p><p>I want this so I can freely shut down the vga card that I use for the VM passthrough when the VM is not running.</p></div></blockquote></div><p>Sure, buy an expensive server that supports physical PCI hotplug.&#160; Most systems do not provide power control for PCI slots, nor is there any way to manipulate the hardware to disable slot power.&#160; If you have a hotplug capable expresscard slot (ie. laptop - I haven&#039;t found one for desktop yet) and you&#039;re willing to take a <strong>significant</strong> performance penalty (5GT/s x1 PCIe), then something like the <a href="http://www.banggood.com/EXP-GDC-Laptop-External-PCI-E-Graphics-Card-p-934367.html" rel="nofollow">EXP GDC</a> external video card slot will work (often with some commandline trickery).&#160; You might also be surprised how little power some of the newer cards draw when idle.&#160; I haven&#039;t tried my GTX750 in the external slot yet, but some smaller cards show less than 5W when unassigned.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544699">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544722" class="blockpost roweven"> <h2><span><span class="conr">#5620</span> <a href="viewtopic.php?pid=1544722#p1544722">2015-07-14 22:46:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sunmast wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sunmast wrote:</cite><blockquote><div><p>Is it possible to run OSX with OVMF method?</p></div></blockquote></div><p>Yes. I have a proof-picture, if you&#039;re curious.</p></div></blockquote></div><p>Hi Duelist, would you please share your qemu command line to run OSX with OVMF? Are you using Chameleon or Clover?</p><p>Thanks a lot!</p></div></blockquote></div><p>I can&#039;t. I&#039;ve seen the picture of that. But only the picture.</p><div class="quotebox"><cite>fld wrote:</cite><blockquote><div><p>I&#039;m running without x-vga, so maybe that&#039;s why.</p></div></blockquote></div><p>ಠ_ಠ<br />I am too, since i needed to patch my VBIOS to get GOP... I use OVMF, OVMF doesn&#039;t require x-vga.<br />If you run OVMF too with a factory-flashed GPU ROM - could you send me the file or at least the .efi part?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544741" class="blockpost rowodd"> <h2><span><span class="conr">#5621</span> <a href="viewtopic.php?pid=1544741#p1544741">2015-07-15 02:31:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw :</p><p>Does vfio-pci ids REQUIRE pci-stub to be loaded ?</p><p>I&#039;m asking because I&#039;ve been having a hard time getting vfio-pci ids to be loaded at boot , and now that I added pci-stub module before vfio-pci in the boot modules chain IT WORKS ! And every device get bound to VFIO directly and correctly .</p><p>Please note that pci-stub is not built statically in Arch .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544741">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544742" class="blockpost roweven"> <h2><span><span class="conr">#5622</span> <a href="viewtopic.php?pid=1544742#p1544742">2015-07-15 02:33:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Denso</p><p>No, vfio-pci has no dependency on pci-stub.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544742">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544743" class="blockpost rowodd"> <h2><span><span class="conr">#5623</span> <a href="viewtopic.php?pid=1544743#p1544743">2015-07-15 02:39:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ Well , that is strange . &quot;options vfio-pci ids=&quot; didn&#039;t work on both of my NVIDIAs until I added pci-stub to the top of the boot chain . Anyway it is working like a charm now and I can finally get rid of the vfio-bind script .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544743">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544781" class="blockpost roweven"> <h2><span><span class="conr">#5624</span> <a href="viewtopic.php?pid=1544781#p1544781">2015-07-15 08:07:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>@ Well , that is strange . &quot;options vfio-pci ids=&quot; didn&#039;t work on both of my NVIDIAs until I added pci-stub to the top of the boot chain . Anyway it is working like a charm now and I can finally get rid of the vfio-bind script .</p></div></blockquote></div><p>@Denso could it be that, when pci-stub is not loaded, noveau driver loaded/probed your card thus preventing vfio-pci from working correctly, and loading pci-stub prevents this from happening (as is its purpose)?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1544807" class="blockpost rowodd"> <h2><span><span class="conr">#5625</span> <a href="viewtopic.php?pid=1544807#p1544807">2015-07-15 09:56:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64876">Nazfellun</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/64876.png?m=1352449839" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2012-10-22</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64876">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>Nazfellun wrote:</cite><blockquote><div><p>I didn&#039;t end up bisecting a driver for the EFI section, as the linked UEFIRomExtract repo only appears to have a binary for Macs, and I have no idea how to compile it from source. As such, I just used the GOP provided in the first version of the AMD-UEFI-GOP-MAKER tool, which I think is from a HD6450.</p></div></blockquote></div><p>The thing is - that tools are from EDK2. I&#039;ve found EFIRom somewhere there some time ago, but i&#039;ve lost it. Anyway, what&#039;s the device IDs of that basic adapter?<br />I think something is broken deeply.</p></div></blockquote></div><br /><p>The listed device &amp; vendor ID match up to the ones reported by lspci -nn on the host, and the PCI bus/slot listed for the device matches the libvirt configuration.</p> <p class="postedit"><em>Last edited by Nazfellun (2015-07-15 09:57:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1544807">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=224">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=223">223</a> <a href="viewtopic.php?id=162768&amp;p=224">224</a> <strong>225</strong> <a href="viewtopic.php?id=162768&amp;p=226">226</a> <a href="viewtopic.php?id=162768&amp;p=227">227</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=226">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
