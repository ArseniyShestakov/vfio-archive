<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 57) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=57" title="Page 57" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=56" title="Page 56" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=58" title="Page 58" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=56">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=55">55</a> <a href="viewtopic.php?id=162768&amp;p=56">56</a> <strong>57</strong> <a href="viewtopic.php?id=162768&amp;p=58">58</a> <a href="viewtopic.php?id=162768&amp;p=59">59</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=58">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1394576" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1401</span> <a href="viewtopic.php?pid=1394576#p1394576">2014-03-19 21:39:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ahl wrote:</cite><blockquote><div><div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><p>I have similar problems with a HD 5770, even though I&#039;ve found reports of this card working. See <a href="https://bbs.archlinux.org/viewtopic.php?pid=1391318#p1391318" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1391318</a>.&#160; For what it&#039;s worth, I don&#039;t think it&#039;s a problem with the ATA controller, per se, since I get errors with other PCI devices as well. It seems to be pretty random, which one is affected.</p></div></blockquote></div><p>You are right. The behavior is pretty random. Here&#039;s an incomplete list of problems that I remember occurring: ATA-errors on all connected devices, single port usb failures, full failure of all usb-devices, display port link failure (loss of picture), complete freeze of system, freeze + automatic reboot, and failure of SATA controller with IO_PAGE_FAULTS that resulted in corrupted root file system. Just about anything can happen.</p></div></blockquote></div><p>To me this seems as if the GPU touches other devices&#039; memory. My question about this is:</p><ul><li><p>Is it possible for one PCIe device to directly access another one? If it&#039;s done through DMA, shouldn&#039;t the IOMMU prevent exactly this?</p></li><li><p>Is there any way to debug this?</p></li></ul> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394576">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394593" class="blockpost roweven"> <h2><span><span class="conr">#1402</span> <a href="viewtopic.php?pid=1394593#p1394593">2014-03-19 22:06:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><div class="quotebox"><cite>ahl wrote:</cite><blockquote><div><div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><p>I have similar problems with a HD 5770, even though I&#039;ve found reports of this card working. See <a href="https://bbs.archlinux.org/viewtopic.php?pid=1391318#p1391318" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 8#p1391318</a>.&#160; For what it&#039;s worth, I don&#039;t think it&#039;s a problem with the ATA controller, per se, since I get errors with other PCI devices as well. It seems to be pretty random, which one is affected.</p></div></blockquote></div><p>You are right. The behavior is pretty random. Here&#039;s an incomplete list of problems that I remember occurring: ATA-errors on all connected devices, single port usb failures, full failure of all usb-devices, display port link failure (loss of picture), complete freeze of system, freeze + automatic reboot, and failure of SATA controller with IO_PAGE_FAULTS that resulted in corrupted root file system. Just about anything can happen.</p></div></blockquote></div><p>To me this seems as if the GPU touches other devices&#039; memory. My question about this is:</p><ul><li><p>Is it possible for one PCIe device to directly access another one? If it&#039;s done through DMA, shouldn&#039;t the IOMMU prevent exactly this?</p></li><li><p>Is there any way to debug this?</p></li></ul></div></blockquote></div><p>The IOMMU can only provide isolation and translation for transactions that it sees.&#160; If there&#039;s a multifunction device that allows peer-to-peer DMA within the component, then the IOMMU may never see the transaction.&#160; This is the purpose of Access Control Services (ACS) to allow configuration and enforcement of whether all transactions are forwarded upstream.&#160; This is why IOMMU groups put such devices together, so we can at least have a single entity manage them rather than allowing a guest to exploit the host.&#160; Many folks here abuse the ACS override patch which was rejected upstream exactly because such peer-to-peer interactions can be unpredictable and difficult to debug.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394593">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394601" class="blockpost rowodd"> <h2><span><span class="conr">#1403</span> <a href="viewtopic.php?pid=1394601#p1394601">2014-03-19 22:18:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80333">ahl</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-16</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The IOMMU can only provide isolation and translation for transactions that it sees.&#160; If there&#039;s a multifunction device that allows peer-to-peer DMA within the component, then the IOMMU may never see the transaction.&#160; This is the purpose of Access Control Services (ACS) to allow configuration and enforcement of whether all transactions are forwarded upstream.&#160; This is why IOMMU groups put such devices together, so we can at least have a single entity manage them rather than allowing a guest to exploit the host.&#160; Many folks here abuse the ACS override patch which was rejected upstream exactly because such peer-to-peer interactions can be unpredictable and difficult to debug.</p></div></blockquote></div><p>But I have never even applied that patch. I&#039;m using 3.14.0-rc7-00004-g9f8b483-dirty + fix_memleaks.patch.</p><p>Err, wait. I actually have it applied, but not activated. Surely it does not enable something automatically? I could try with clean source too.</p><p>Edit: I meant to test the patch, but I didn&#039;t find any documentation on how to evaluate when it might be needed. Like which devices should I try activating?</p> <p class="postedit"><em>Last edited by ahl (2014-03-19 22:32:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394601">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394607" class="blockpost roweven"> <h2><span><span class="conr">#1404</span> <a href="viewtopic.php?pid=1394607#p1394607">2014-03-19 22:31:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ahl wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The IOMMU can only provide isolation and translation for transactions that it sees.&#160; If there&#039;s a multifunction device that allows peer-to-peer DMA within the component, then the IOMMU may never see the transaction.&#160; This is the purpose of Access Control Services (ACS) to allow configuration and enforcement of whether all transactions are forwarded upstream.&#160; This is why IOMMU groups put such devices together, so we can at least have a single entity manage them rather than allowing a guest to exploit the host.&#160; Many folks here abuse the ACS override patch which was rejected upstream exactly because such peer-to-peer interactions can be unpredictable and difficult to debug.</p></div></blockquote></div><p>But I have never even applied that patch. I&#039;m using 3.14.0-rc7-00004-g9f8b483-dirty + fix_memleaks.patch.</p><p>Err, wait. I actually have it applied, but not activated. Surely it does not enable something automatically? I could try with clean source too.</p></div></blockquote></div><p>As I say, multifunction devices without ACS can do it too and there&#039;s not much we can do about it.&#160; We&#039;re dealing with lots of consumer grade hardware in more of a precision operating environment.&#160; It&#039;s really just pure speculation that this might be playing a factor.&#160; The only way I can think to test would be to assign only one device from any IOMMU group, the other device can be disabled by writing zero to the PCI command register (setpci -s bus:dev.fn COMMAND=0).&#160; That should prevent them from claiming any peer-to-peer traffic.&#160; Test and incrementally add one device at a time.&#160; Again, this is all just speculation, assuming peer-to-peer is occurring, how would you test for it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394607">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394610" class="blockpost rowodd"> <h2><span><span class="conr">#1405</span> <a href="viewtopic.php?pid=1394610#p1394610">2014-03-19 22:34:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noctavian wrote:</cite><blockquote><div><div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><div class="quotebox"><cite>Norcoen wrote:</cite><blockquote><div><p>Did anyone succeed using this with the Virtual Machine Managers (<a href="http://virt-manager.org/" rel="nofollow">http://virt-manager.org/</a>) XML-like configuration and could post it as an example?</p></div></blockquote></div><p>I am trying to, but no success so far, see <a href="https://bbs.archlinux.org/viewtopic.php?pid=1393384#p1393384" rel="nofollow">my post</a>. <br />But it seems some people got it to work: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1349595#p1349595" rel="nofollow">Val532</a>, <a href="https://bbs.archlinux.org/viewtopic.php?pid=1343400#p1343400" rel="nofollow">kaeptnb</a></p><p>PS: This thread is at the same time a goldmine and a total mess :-D</p></div></blockquote></div><p>This is my virt-manager config XML for a Windows 7 VM with AMD HD6770 GPU + HDMI, Audio controller and an usb controller passed to it. I made the vm using the virt-manager gui, I manually configured the number of sockets, cores and threads and after installing windows i used the gui to add the video card and various controllers to the vm. Also I have nested virtualization enabled if this makes a difference.</p><div class="codebox"><pre class="vscroll"><code>&lt;!-- WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit Windows-7-Main or other application using the libvirt API. --&gt; &lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;Windows-7-Main&lt;/name&gt; &lt;uuid&gt;fbc03842-e6ea-d94d-eeba-e1dc4da0e1dd&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-1.7&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;SandyBridge&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;6&#039; threads=&#039;6&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pcid&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/windows_7_main.img&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:fe:3e:b0&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;vga&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1b&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1a&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div></div></blockquote></div><p>Thanks noctavian! However this is not exactly what I want to achieve. You are passing your GPU as secondary card using standard pci-assign method. But I&#039;d like to use the GPU exclusively, so that SeaBios is already showing the boot screen on the real GPU (Using x-vga=on) and no emulated graphics adapter.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394610">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394621" class="blockpost roweven"> <h2><span><span class="conr">#1406</span> <a href="viewtopic.php?pid=1394621#p1394621">2014-03-19 23:00:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>As I say, multifunction devices without ACS can do it too and there&#039;s not much we can do about it.</p><p> We&#039;re dealing with lots of consumer grade hardware in more of a precision operating environment.&#160; It&#039;s really just pure speculation that this might be playing a factor.&#160; The only way I can think to test would be to assign only one device from any IOMMU group, the other device can be disabled by writing zero to the PCI command register (setpci -s bus:dev.fn COMMAND=0).&#160; That should prevent them from claiming any peer-to-peer traffic.&#160; Test and incrementally add one device at a time.&#160; Again, this is all just speculation, assuming peer-to-peer is occurring, how would you test for it.</p></div></blockquote></div><p>ACS is implemented in the bridge, right? So if my PCIe chipset support ACS (it&#039;s an AMD 990FX; how to check?) and I don&#039;t use the ACS override patch (which I don&#039;t), then this should not be possible, or am I missing something?</p><p>I don&#039;t understand how passing through the GPU can freeze the host, when the IOMMU should enforce isolation.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394621">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394661" class="blockpost rowodd"> <h2><span><span class="conr">#1407</span> <a href="viewtopic.php?pid=1394661#p1394661">2014-03-20 00:12:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><div class="quotebox"><cite>noctavian wrote:</cite><blockquote><div><div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>I am trying to, but no success so far, see <a href="https://bbs.archlinux.org/viewtopic.php?pid=1393384#p1393384" rel="nofollow">my post</a>. <br />But it seems some people got it to work: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1349595#p1349595" rel="nofollow">Val532</a>, <a href="https://bbs.archlinux.org/viewtopic.php?pid=1343400#p1343400" rel="nofollow">kaeptnb</a></p><p>PS: This thread is at the same time a goldmine and a total mess :-D</p></div></blockquote></div><p>This is my virt-manager config XML for a Windows 7 VM with AMD HD6770 GPU + HDMI, Audio controller and an usb controller passed to it. I made the vm using the virt-manager gui, I manually configured the number of sockets, cores and threads and after installing windows i used the gui to add the video card and various controllers to the vm. Also I have nested virtualization enabled if this makes a difference.</p><div class="codebox"><pre class="vscroll"><code>&lt;!-- WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit Windows-7-Main or other application using the libvirt API. --&gt; &lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;Windows-7-Main&lt;/name&gt; &lt;uuid&gt;fbc03842-e6ea-d94d-eeba-e1dc4da0e1dd&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-1.7&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;SandyBridge&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;6&#039; threads=&#039;6&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pcid&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/windows_7_main.img&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:fe:3e:b0&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;-1&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;vga&#039; vram=&#039;9216&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1b&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1a&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div></div></blockquote></div><p>Thanks noctavian! However this is not exactly what I want to achieve. You are passing your GPU as secondary card using standard pci-assign method. But I&#039;d like to use the GPU exclusively, so that SeaBios is already showing the boot screen on the real GPU (Using x-vga=on) and no emulated graphics adapter.</p></div></blockquote></div><p>Hi i see you whant to use Virt-Manager to stop and start your VM,<br />I think i can help you a bit.</p><p>This is an old working config xml for Virt-Manager, but i dont know if it work at this moment (i test a lot of different way to passthroug GPU to a VM)</p><div class="codebox"><pre class="vscroll"><code>&lt;!-- WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE OVERWRITTEN AND LOST. Changes to this xml configuration should be made using: virsh edit Windows-7 or other application using the libvirt API. --&gt; &lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;Windows-7&lt;/name&gt; &lt;uuid&gt;652e4382-4dc8-7349-cdbf-359d333aba08&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8388608&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8388608&lt;/currentMemory&gt; &lt;memoryBacking&gt; &lt;nosharepages/&gt; &lt;/memoryBacking&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-1.7&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;bootmenu enable=&#039;yes&#039;/&gt; &lt;smbios mode=&#039;host&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;abm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdpe1gb&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;rdrand&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;f16c&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; cache=&#039;writethrough&#039;/&gt; &lt;source file=&#039;/home/val/Image HDD/Windows-7-Test.img&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;/&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x01&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:f7:8e:2b&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;model type=&#039;e1000&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x05e3&#039;/&gt; &lt;product id=&#039;0x0607&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc228&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc229&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x1532&#039;/&gt; &lt;product id=&#039;0x002f&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;none&#039;/&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>This work for passthrough your graphique card as a primary gpu and use vfio </p><p>And it&#039;s just an example !!!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394661">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394690" class="blockpost roweven"> <h2><span><span class="conr">#1408</span> <a href="viewtopic.php?pid=1394690#p1394690">2014-03-20 01:55:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>OK, I&#039;m having a problem and hopefully someone might be able to help....</p><p>As my earlier post said, I&#039;ve got the 3 links from the first post built and installed (linux mainline, seabios, qemu..&#160; done in that order with linux being installed again later to make sure I had pci-stub installed correctly... and I know I don&#039;t need seabios anymore, but I didn&#039;t know then).</p><p>I have my sole video card blacklisted.&#160; On boot I see two or four lines of text and then no more updates.&#160; &#160;I then SSH in, bind the video card to vfio and run qemu with this command:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -nographic -enable-kvm -M q35 -m 1024 -cpu host \<br />&#160; -cdrom cb.iso \<br />&#160; -smp 6,sockets=1,cores=6,threads=1 \<br />&#160; -bios /usr/share/qemu/bios.bin -vga none \<br />&#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />&#160; -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1</p></div></blockquote></div><p>where &#039;cb.iso&#039; is a crunchbang live cd and &#039;03:00.0&#039; is my video card. I then hear the video card fan spin up and the screen flashes black and I get text dunmping to the screen from the VM.&#160; &#160;Every single time it comes up with no bootable device however.&#160; &#160;It should be loading the CDROM but it doesn&#039;t seem to be checking it.&#160; &#160;I tried adding the &#039;-boot order=d&#039; option, but that didn&#039;t take and the menu option blows by before I get a chance to attempt to interact.</p><p>It will boot off an image for a floppy disk though.&#160; So why can&#039;t I read a CDROM? (note, it also failed to read a fedora image and the physical bluray drive)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394690">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394697" class="blockpost rowodd"> <h2><span><span class="conr">#1409</span> <a href="viewtopic.php?pid=1394697#p1394697">2014-03-20 02:30:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Blind Tree Frog wrote:</cite><blockquote><div><p>It will boot off an image for a floppy disk though.&#160; So why can&#039;t I read a CDROM? (note, it also failed to read a fedora image and the physical bluray drive)</p></div></blockquote></div><p>Try the formatting listed in OP.</p><div class="codebox"><pre><code>-drive file=/home/nbhs/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd</code></pre></div><p>Also try hitting the F12 key while starting to get into the boot menu. If the problem is the time it takes your monitor to activate/display the output (I had this same problem), that should open the boot menu and pause long enough for you to see it.</p><p>Edit: #! installer is a dual USB/CD ISO, that may be confusing kvm. Maybe you can try passing it as a raw disk image.</p> <p class="postedit"><em>Last edited by alexis_evo (2014-03-20 02:37:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394697">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394698" class="blockpost roweven"> <h2><span><span class="conr">#1410</span> <a href="viewtopic.php?pid=1394698#p1394698">2014-03-20 02:34:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone figured out the issue where the right half of the screen is shifted to the left half (or vice versa)? This has plagued every game I&#039;ve tried to play in the VM. Doesn&#039;t happen as often as it originally did, but it still happens at least once every 4-5 hours of usage. It&#039;s very annoying when it happens in dota, as I&#039;m playing with a gigantic handicap for the rest of the game <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" />.</p><p>Screenshot of it occurring in Mirror&#039;s Edge <a href="http://i.imgur.com/fuD5HkB.jpg" rel="nofollow">http://i.imgur.com/fuD5HkB.jpg</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394698">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394702" class="blockpost rowodd"> <h2><span><span class="conr">#1411</span> <a href="viewtopic.php?pid=1394702#p1394702">2014-03-20 03:09:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><div class="quotebox"><cite>Blind Tree Frog wrote:</cite><blockquote><div><p>It will boot off an image for a floppy disk though.&#160; So why can&#039;t I read a CDROM? (note, it also failed to read a fedora image and the physical bluray drive)</p></div></blockquote></div><p>Try the formatting listed in OP.</p><div class="codebox"><pre><code>-drive file=/home/nbhs/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd</code></pre></div><p>Also try hitting the F12 key while starting to get into the boot menu. If the problem is the time it takes your monitor to activate/display the output (I had this same problem), that should open the boot menu and pause long enough for you to see it.</p><p>Edit: #! installer is a dual USB/CD ISO, that may be confusing kvm. Maybe you can try passing it as a raw disk image.</p></div></blockquote></div><p>The fedora live cd is a regular CD iso though.</p><p>The line from the OP works and I can boot in now.&#160; I&#039;m so used to using the &#039;-cdrom&#039; option that I forgot to check the first post for suggestions.&#160; Thanks.</p><br /><p>My next step is to figure out why I can&#039;t get the usb devices to pass through and this reset error I&#039;m getting on my non-video card devices.&#160; I&#039;m going to post this here in case the answer jumps out to anybody and so I have a reference to check when I&#039;m looking up answers away from my computer.</p><p>My qemu command:</p><div class="codebox"><pre><code>qemu-system-x86_64 -nographic -enable-kvm -M q35 -m 1024 -cpu host \ -drive file=/root/cb.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \ -device vfio-pci,host=00:12.0,bus=pcie.0 \ -device vfio-pci,host=00:12.2,bus=pcie.0 \ -device vfio-pci,host=00:13.0,bus=pcie.0 \ -device vfio-pci,host=00:13.2,bus=pcie.0 \ -device vfio-pci,host=00:14.0,bus=pcie.0 \ -device vfio-pci,host=00:14.2,bus=pcie.0 \ -device vfio-pci,host=00:14.3,bus=pcie.0 \ -device vfio-pci,host=00:14.4,bus=pcie.0 \ -device vfio-pci,host=00:14.5,bus=pcie.0 \ -device vfio-pci,host=00:16.0,bus=pcie.0 \ -device vfio-pci,host=00:16.2,bus=pcie.0 \ -device vfio-pci,host=07:00.0,bus=pcie.0 \</code></pre></div><p>Output of it being run:</p><div class="codebox"><pre><code>root@Pandora ~# sh qemu-test.sh qemu-system-x86_64: vfio: Cannot reset device 0000:00:16.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.5, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.4, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.3, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:13.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:12.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:16.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.5, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.4, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.3, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:14.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:13.0, no available reset mechanism. qemu-system-x86_64: vfio: Cannot reset device 0000:00:12.0, no available reset mechanism.</code></pre></div><p>lspci output:</p><div class="codebox"><pre class="vscroll"><code>00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx0 port B) (rev 02) 00:00.2 IOMMU: Advanced Micro Devices, Inc. [AMD/ATI] RD990 I/O Memory Management Unit (IOMMU) 00:02.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port B) 00:04.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port D) 00:05.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port E) 00:09.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port H) 00:0a.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx1 port A) 00:0b.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (NB-SB link) 00:11.0 SATA controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode] (rev 40) 00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 42) 00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40) 00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40) 00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40) 00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller 00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0) 00:15.1 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 1) 00:15.2 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB900 PCI to PCI bridge (PCIE port 2) 00:15.3 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB900 PCI to PCI bridge (PCIE port 3) 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller 00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor HyperTransport Configuration 00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Address Map 00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor DRAM Controller 00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Miscellaneous Control 00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 10h Processor Link Control 01:00.0 PCI bridge: PLX Technology, Inc. Device 8747 (rev ba) 02:08.0 PCI bridge: PLX Technology, Inc. Device 8747 (rev ba) 02:10.0 PCI bridge: PLX Technology, Inc. Device 8747 (rev ba) 03:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde XT [Radeon HD 7770 GHz Edition] 03:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde/Pitcairn HDMI Audio [Radeon HD 7700/7800 Series] 05:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 06:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 07:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller 0c:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 09) 0d:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller 0e:00.0 USB controller: ASMedia Technology Inc. ASM1042 SuperSpeed USB Host Controller</code></pre></div><p>vfio-pci.cfg</p><div class="codebox"><pre><code>DEVICES=&quot;0000:00:12.0 0000:00:12.2 0000:00:13.0 0000:00:13.2 0000:00:14.0 0000:00:14.2 0000:00:14.3 0000:00:14.4 0000:00:14.5 0000:00:16.0 0000:00:16.2 0000:03:00.0 0000:03:00.1 0000:07:00.0&quot;</code></pre></div><p>/proc/cmdline</p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux root=UUID=6a991f03-8fd6-42f2-b7be-06eacf457e76 rw quiet iommu=on video=efifb:off pci-stub.ids=1002:4397,1002:4396,1002:4397,1002:4396,1002:4385,1002:4383,1002:4395,1002:4384,1002:4399,1002:4397,1002:4396,1002:683d,1002:aab0</code></pre></div><p>interesting dmesg output that is probably a huge clue glaring at me:</p><div class="codebox"><pre><code>] [ 189.799749] AMD-Vi: Event logged [IO_PAGE_FAULT device=00:12.2 domain=0x0024 address=0x0000000100000000 flags=0x0000] [ 189.800493] AMD-Vi: Event logged [IO_PAGE_FAULT device=00:12.2 domain=0x0024 address=0x00000000f000ff40 flags=0x0000] [ 189.801242] AMD-Vi: Event logged [IO_PAGE_FAULT device=00:12.2 domain=0x0024 address=0x00000000f000ff40 flags=0x0000]</code></pre></div><br /><p>I&#039;m probably missing something obvious... now to find it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394702">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394736" class="blockpost roweven"> <h2><span><span class="conr">#1412</span> <a href="viewtopic.php?pid=1394736#p1394736">2014-03-20 07:42:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>i get reset error too. no idea why. however usb ports work just fine so i figured its not important.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394736">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394825" class="blockpost rowodd"> <h2><span><span class="conr">#1413</span> <a href="viewtopic.php?pid=1394825#p1394825">2014-03-20 12:16:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>i get reset error too. no idea why. however usb ports work just fine so i figured its not important.</p></div></blockquote></div><p>I wasn&#039;t too worried about them if USB came up, but since my keyboard isn&#039;t working in the guest I figure I need to investigate them somewhat.</p><p>I&#039;m more concerned about the dmesg error as I am seeing the same three strings repeated a lot.</p><p>edit:</p><p>i wonder if I&#039;m setting the wrong bus in the qemu command</p> <p class="postedit"><em>Last edited by Blind Tree Frog (2014-03-20 12:24:53)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394825">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394851" class="blockpost roweven"> <h2><span><span class="conr">#1414</span> <a href="viewtopic.php?pid=1394851#p1394851">2014-03-20 13:28:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Blind Tree Frog wrote:</cite><blockquote><div><div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>i get reset error too. no idea why. however usb ports work just fine so i figured its not important.</p></div></blockquote></div><p>I wasn&#039;t too worried about them if USB came up, but since my keyboard isn&#039;t working in the guest I figure I need to investigate them somewhat.</p><p>I&#039;m more concerned about the dmesg error as I am seeing the same three strings repeated a lot.</p><p>edit:</p><p>i wonder if I&#039;m setting the wrong bus in the qemu command</p></div></blockquote></div><p>You need to passthrough both ehci and ohci controllers</p><p>lspci</p><div class="codebox"><pre><code>... 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller ...</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394851">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1394860" class="blockpost rowodd"> <h2><span><span class="conr">#1415</span> <a href="viewtopic.php?pid=1394860#p1394860">2014-03-20 13:49:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Blind Tree Frog wrote:</cite><blockquote><div><div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>i get reset error too. no idea why. however usb ports work just fine so i figured its not important.</p></div></blockquote></div><p>...<br />i wonder if I&#039;m setting the wrong bus in the qemu command</p></div></blockquote></div><p>You need to passthrough both ehci and ohci controllers</p><p>lspci</p><div class="codebox"><pre><code>... 00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller ...</code></pre></div></div></blockquote></div><p>I thought I was:<br />(excerpt from above with newlines added to emphasis grouping)</p><div class="codebox"><pre><code> -device vfio-pci,host=00:12.0,bus=pcie.0 \ -device vfio-pci,host=00:12.2,bus=pcie.0 \ -device vfio-pci,host=00:13.0,bus=pcie.0 \ -device vfio-pci,host=00:13.2,bus=pcie.0 \ -device vfio-pci,host=00:14.0,bus=pcie.0 \ -device vfio-pci,host=00:14.2,bus=pcie.0 \ -device vfio-pci,host=00:14.3,bus=pcie.0 \ -device vfio-pci,host=00:14.4,bus=pcie.0 \ -device vfio-pci,host=00:14.5,bus=pcie.0 \ -device vfio-pci,host=00:16.0,bus=pcie.0 \ -device vfio-pci,host=00:16.2,bus=pcie.0 \</code></pre></div><p>Except for device one device I stubbed everything out that was under the same root number and passed them all in to qemu at the same time.&#160; The exception is 0000:07:00.0 which didn&#039;t have another.&#160; I originally tried 0e:00.0 and 0d:00.0 as well but that caused all sorts of errors so I figured I&#039;d come back to them.</p><p>Edit:</p><p>looking at my earlier post...</p><div class="codebox"><pre><code> -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1</code></pre></div><p>How do I determine what the bus needs to be set to and when do I set the addr field?&#160; In this case I copied the pattern that the OP used, but I figured that there must be a deterministic way.</p><p>Off to the man pages I guess.</p> <p class="postedit"><em>Last edited by Blind Tree Frog (2014-03-20 14:02:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1394860">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395074" class="blockpost roweven"> <h2><span><span class="conr">#1416</span> <a href="viewtopic.php?pid=1395074#p1395074">2014-03-21 02:07:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61335">Jesse2004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-25</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GNA wrote:</cite><blockquote><div><p>/sys/kernel/iommu_groups is empty.<br />My system is supporting vt-d and it should be enabled. I dont get it.<br />Did i miss something obvious? Thanks for help!</p></div></blockquote></div><p>I encountered this problem before, and adding intel_iommu=on to the kernel cmdline solved the problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395074">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395200" class="blockpost rowodd"> <h2><span><span class="conr">#1417</span> <a href="viewtopic.php?pid=1395200#p1395200">2014-03-21 12:25:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80474">ahom</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-21</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80474">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>First off I would like to thank everybody contributing to this, it sure is exciting to see all the possibilities of these tools, I&#039;m new to these forums but not new to archlinux and have been lurking around the vga passthrough for a longtime now.</p><p>I have a project, which is to have 2 windows VM (with each of them having one dedicated graphic card) running on the same archlinux host for my bf and I. From this thread I&#039;m sure that it works with one, however, before buying all the stuff I need I would have liked some validation on some level that it could maybe work (if it definitely can&#039;t there&#039;s no point in spending money <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />). From the looks of it I would say it could work but I may be missing something as I never took a look at the actual code.</p><p>Here is a summary of the spec I want to buy and what I intend to do with it:</p><p>- <strong>CPU</strong>: <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16819113284" rel="nofollow">AMD FX 8350 Black Edition</a><br />- <strong>RAM</strong>: 32 GB<br />- <strong>MB</strong>: I&#039;m not sure yet, but one of <br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131877" rel="nofollow">ASUS SABERTOOTH 990FX R2.0</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813130649" rel="nofollow">MSI 990FXA-GD80</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131876" rel="nofollow">ASUS CROSSHAIR V FORMULA-Z</a><br />- <strong>GC</strong>: 2 AMD ones for the windows VMs (can&#039;t remember the model names), one more very small fanless one for the host<br />- Other parts are irrelevant to the issue I guess.</p><p>The setup of the VMs would be:</p><p>- Each Windows VM:<br />&#160; &#160; - 3 cores<br />&#160; &#160; - 12GB ram<br />&#160; &#160; - One discrete GC<br />- Host:<br />&#160; &#160; - 2 cores<br />&#160; &#160; - 8 GB ram<br />&#160; &#160; - One discrete GC</p><p>Here are my thoughts:</p><p>&#160; &#160; - Will this certainly fail ? wrt passing 2 cards to 2 VM<br />&#160; &#160; - Is there one of these motherboards that will not work properly? (BIOS wise or w/e ?)<br />&#160; &#160; - Does having 16 lines PCIe x16 mandatory for performances on newest games/cards ? (I&#039;m saying this because when you start adding up cards PCI lines satrts to be spread and there are not so much of them in the end for 3 cards, the second card usually gets 8x, it seems that the MSI one can work with 16x/16x/4x but I fear that the slots are not aligned in a way I can have a 2nd 2slot card)</p><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395200">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395221" class="blockpost roweven"> <h2><span><span class="conr">#1418</span> <a href="viewtopic.php?pid=1395221#p1395221">2014-03-21 13:52:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ahom wrote:</cite><blockquote><div><p>&#160; &#160; - Does having 16 lines PCIe x16 mandatory for performances on newest games/cards ? (I&#039;m saying this because when you start adding up cards PCI lines satrts to be spread and there are not so much of them in the end for 3 cards, the second card usually gets 8x, it seems that the MSI one can work with 16x/16x/4x but I fear that the slots are not aligned in a way I can have a 2nd 2slot card)<br />Thanks!</p></div></blockquote></div><p><a href="http://www.techpowerup.com/reviews/AMD/HD_5870_PCI-Express_Scaling/25.html" rel="nofollow">http://www.techpowerup.com/reviews/AMD/ … ng/25.html</a><br /><a href="http://www.techpowerup.com/reviews/Intel/Ivy_Bridge_PCI-Express_Scaling/23.html" rel="nofollow">http://www.techpowerup.com/reviews/Inte … ng/23.html</a><br />(seen few more in other places)</p><p>If you ask me, differences are negligible.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395221">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395223" class="blockpost rowodd"> <h2><span><span class="conr">#1419</span> <a href="viewtopic.php?pid=1395223#p1395223">2014-03-21 14:02:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78143">Blind Tree Frog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-31</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78143">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ahom wrote:</cite><blockquote><div><p>Here is a summary of the spec I want to buy and what I intend to do with it:</p><p>- <strong>CPU</strong>: <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16819113284" rel="nofollow">AMD FX 8350 Black Edition</a><br />- <strong>RAM</strong>: 32 GB<br />- <strong>MB</strong>: I&#039;m not sure yet, but one of <br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131877" rel="nofollow">ASUS SABERTOOTH 990FX R2.0</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813130649" rel="nofollow">MSI 990FXA-GD80</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131876" rel="nofollow">ASUS CROSSHAIR V FORMULA-Z</a><br />- <strong>GC</strong>: 2 AMD ones for the windows VMs (can&#039;t remember the model names), one more very small fanless one for the host<br />- Other parts are irrelevant to the issue I guess.</p></div></blockquote></div><p>I believe there are some preferences up thread to avoid ASUS mobo&#039;s and interest towards Gigabyte.&#160; That said, that was also before ASUS&#039;s bios updates last year that seem to address the issues that people were concerned about.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395223">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395241" class="blockpost roweven"> <h2><span><span class="conr">#1420</span> <a href="viewtopic.php?pid=1395241#p1395241">2014-03-21 15:27:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Blind Tree Frog wrote:</cite><blockquote><div><div class="quotebox"><cite>ahom wrote:</cite><blockquote><div><p>Here is a summary of the spec I want to buy and what I intend to do with it:</p><p>- <strong>CPU</strong>: <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16819113284" rel="nofollow">AMD FX 8350 Black Edition</a><br />- <strong>RAM</strong>: 32 GB<br />- <strong>MB</strong>: I&#039;m not sure yet, but one of <br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131877" rel="nofollow">ASUS SABERTOOTH 990FX R2.0</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813130649" rel="nofollow">MSI 990FXA-GD80</a><br />&#160; &#160; - <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813131876" rel="nofollow">ASUS CROSSHAIR V FORMULA-Z</a><br />- <strong>GC</strong>: 2 AMD ones for the windows VMs (can&#039;t remember the model names), one more very small fanless one for the host<br />- Other parts are irrelevant to the issue I guess.</p></div></blockquote></div><p>I believe there are some preferences up thread to avoid ASUS mobo&#039;s and interest towards Gigabyte.&#160; That said, that was also before ASUS&#039;s bios updates last year that seem to address the issues that people were concerned about.</p></div></blockquote></div><p>ASUS has been wonderful in terms of updating their BIOS to fix support. @GizmoChicken managed to get through to a tech that could get a fix working, gave us test BIOS with the fix, then eventually pushed out the update to everyone.</p><p>@ahom: I know the Sabertooth 990FX has a fixed BIOS, and I personally use an ASUS M5A99FX PRO R2.0 that works perfectly with the latest BIOS.</p><p>I&#039;d suggest you be careful with how you limit 2 cores to a Windows VM with the FX-8350. Or avoid restricting it all together. The FX-8350 is actually four pairs of cores, with each pair sharing an FPU. In the worst case scenario, the 2 cores will perform as 1 core when the FPU bottlenecks the application in question (common for games). I find it&#039;s fine to overcommit CPUs to guests -- I run 6x cores on each guest for two Windows VMs, and use KVM to assign CPU priority to one of them. This gives the most out of the hardware to both VMs, as it isn&#039;t that often you&#039;ll 100% all four cores in both VMs.</p> <p class="postedit"><em>Last edited by alexis_evo (2014-03-21 15:32:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395241">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395289" class="blockpost rowodd"> <h2><span><span class="conr">#1421</span> <a href="viewtopic.php?pid=1395289#p1395289">2014-03-21 17:23:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>Im adding benchmark that does not make any sense. As you notice DirectCompute and especially DirectX 11 are more than one could wish for. However complex directx9 is right down the toilet. My brain cant figure out any scenario where this would make sense. It is sad because most of the games nowdays are still directx9 <img src="https://bbs.archlinux.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /><br /><a href="http://i61.tinypic.com/ictrgo.png" rel="nofollow">http://i61.tinypic.com/ictrgo.png</a></p></div></blockquote></div><p>Further testing required, but an Nvidia Quadro K4000 (passed as a secondary GPU, no VGA) gives me a Passmark 3D Graphics mark of 2796.&#160; The average for this card is 2797, so that&#039;s as good as we can hope for this card (this is without the debug register performance patches, so apparently not an issue on this test).&#160; I&#039;ll update with results from Nvidia and Radeon in VGA mode as I&#039;m able to run them.&#160; Unfortunately I still saw the BSOD with passmark, but when it does it the installation gets broken and I&#039;m unable to run it again even after uninstall-reinstall.&#160; It seemed to run ok on a fresh win7x64 install with only the Nvidia driver installed.&#160; No idea how to debug that.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395368" class="blockpost roweven"> <h2><span><span class="conr">#1422</span> <a href="viewtopic.php?pid=1395368#p1395368">2014-03-21 20:59:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>Im adding benchmark that does not make any sense. As you notice DirectCompute and especially DirectX 11 are more than one could wish for. However complex directx9 is right down the toilet. My brain cant figure out any scenario where this would make sense. It is sad because most of the games nowdays are still directx9 <img src="https://bbs.archlinux.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /><br /><a href="http://i61.tinypic.com/ictrgo.png" rel="nofollow">http://i61.tinypic.com/ictrgo.png</a></p></div></blockquote></div><p>Further testing required, but an Nvidia Quadro K4000 (passed as a secondary GPU, no VGA) gives me a Passmark 3D Graphics mark of 2796.&#160; The average for this card is 2797, so that&#039;s as good as we can hope for this card (this is without the debug register performance patches, so apparently not an issue on this test).&#160; I&#039;ll update with results from Nvidia and Radeon in VGA mode as I&#039;m able to run them.&#160; Unfortunately I still saw the BSOD with passmark, but when it does it the installation gets broken and I&#039;m unable to run it again even after uninstall-reinstall.&#160; It seemed to run ok on a fresh win7x64 install with only the Nvidia driver installed.&#160; No idea how to debug that.</p></div></blockquote></div><p>The benchmark worked fine for me with my AMD Radeon HD5670 on Windows 8.1 (64). Since I have a strange/disproportional GPU+CPU config, I&#039;m not sure if my results are comparable with what other people upload to the passmark service. In case you need more results, I can paste mine, but I&#039;d like to ensure comparability.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395368">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395520" class="blockpost rowodd"> <h2><span><span class="conr">#1423</span> <a href="viewtopic.php?pid=1395520#p1395520">2014-03-22 08:34:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ahom wrote:</cite><blockquote><div><p>First off I would like to thank everybody contributing to this, it sure is exciting to see all the possibilities of these tools, I&#039;m new to these forums but not new to archlinux and have been lurking around the vga passthrough for a longtime now.</p><p>I have a project, which is to have 2 windows VM (with each of them having one dedicated graphic card) running on the same archlinux host for my bf and I. From this thread I&#039;m sure that it works with one, however, before buying all the stuff I need I would have liked some validation on some level that it could maybe work (if it definitely can&#039;t there&#039;s no point in spending money <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />). From the looks of it I would say it could work but I may be missing something as I never took a look at the actual code.</p></div></blockquote></div><p>Certainly an interesting project! How do you plan to assign peripherals like keyboard, mouse, etc. to the hosts? You might want to look for a motherboard that has at least 3 distinct USB controllers, so you can pass through one chip to each VM and have one left for the host.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395520">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395524" class="blockpost roweven"> <h2><span><span class="conr">#1424</span> <a href="viewtopic.php?pid=1395524#p1395524">2014-03-22 08:46:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80279">novist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-14</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>Im adding benchmark that does not make any sense. As you notice DirectCompute and especially DirectX 11 are more than one could wish for. However complex directx9 is right down the toilet. My brain cant figure out any scenario where this would make sense. It is sad because most of the games nowdays are still directx9 <img src="https://bbs.archlinux.org/img/smilies/neutral.png" width="15" height="15" alt="neutral" /><br /><a href="http://i61.tinypic.com/ictrgo.png" rel="nofollow">http://i61.tinypic.com/ictrgo.png</a></p></div></blockquote></div><p>Further testing required, but an Nvidia Quadro K4000 (passed as a secondary GPU, no VGA) gives me a Passmark 3D Graphics mark of 2796.&#160; The average for this card is 2797, so that&#039;s as good as we can hope for this card (this is without the debug register performance patches, so apparently not an issue on this test).&#160; I&#039;ll update with results from Nvidia and Radeon in VGA mode as I&#039;m able to run them.&#160; Unfortunately I still saw the BSOD with passmark, but when it does it the installation gets broken and I&#039;m unable to run it again even after uninstall-reinstall.&#160; It seemed to run ok on a fresh win7x64 install with only the Nvidia driver installed.&#160; No idea how to debug that.</p></div></blockquote></div><p>The benchmark worked fine for me with my AMD Radeon HD5670 on Windows 8.1 (64). Since I have a strange/disproportional GPU+CPU config, I&#039;m not sure if my results are comparable with what other people upload to the passmark service. In case you need more results, I can paste mine, but I&#039;d like to ensure comparability.</p></div></blockquote></div><p>in passmark options i picked other people with same gpu+cpu to compare with. i figured thats best to get a perspective of virtualized performance relative to bare metal. Would be really interesting to see your results.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395524">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1395533" class="blockpost rowodd"> <h2><span><span class="conr">#1425</span> <a href="viewtopic.php?pid=1395533#p1395533">2014-03-22 09:25:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80474">ahom</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-21</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80474">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p><a href="http://www.techpowerup.com/reviews/AMD/HD_5870_PCI-Express_Scaling/25.html" rel="nofollow">http://www.techpowerup.com/reviews/AMD/ … ng/25.html</a><br /><a href="http://www.techpowerup.com/reviews/Intel/Ivy_Bridge_PCI-Express_Scaling/23.html" rel="nofollow">http://www.techpowerup.com/reviews/Inte … ng/23.html</a><br />(seen few more in other places)</p><p>If you ask me, differences are negligible.</p></div></blockquote></div><p>That&#039;s very good news! That was actually my main concern as both the VMs need to be performant.</p><div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>I&#039;d suggest you be careful with how you limit 2 cores to a Windows VM with the FX-8350. Or avoid restricting it all together. The FX-8350 is actually four pairs of cores, with each pair sharing an FPU. In the worst case scenario, the 2 cores will perform as 1 core when the FPU bottlenecks the application in question (common for games). I find it&#039;s fine to overcommit CPUs to guests -- I run 6x cores on each guest for two Windows VMs, and use KVM to assign CPU priority to one of them. This gives the most out of the hardware to both VMs, as it isn&#039;t that often you&#039;ll 100% all four cores in both VMs.</p></div></blockquote></div><p>I think I&#039;ll try first what you are suggesting about overcommiting CPUs, that seems like a right balance, if I perceive some issues I&#039;ll post here about my findings.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1395533">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=56">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=55">55</a> <a href="viewtopic.php?id=162768&amp;p=56">56</a> <strong>57</strong> <a href="viewtopic.php?id=162768&amp;p=58">58</a> <a href="viewtopic.php?id=162768&amp;p=59">59</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=58">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
