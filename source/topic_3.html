<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 3) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=3" title="Page 3" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=2" title="Page 2" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=4" title="Page 4" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=2">Previous</a> <a href="viewtopic.php?id=162768">1</a> <a href="viewtopic.php?id=162768&amp;p=2">2</a> <strong>3</strong> <a href="viewtopic.php?id=162768&amp;p=4">4</a> <a href="viewtopic.php?id=162768&amp;p=5">5</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=4">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1276263" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#51</span> <a href="viewtopic.php?pid=1276263#p1276263">2013-05-22 03:27:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ Powerhouse</p><p>Thanks a lot man!</p><p>@ Jgott</p><p>Great!</p><p><strong>Audio:</strong> I managed to fix all the audio scraching/stutter by disabling nested pages and rebuilding my kernel ( see my second post on first page about performance numbers ), with audio passthrough using QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128, and i also had a problem with my headset but its fixed now with the new kernel config.</p><p><strong>DISK:</strong> To tell you the truth i havent even tried virtio-blk since i just pass my second sata controller instead of using the emulated one, so it boots directly from the connected disk.</p><p>I also had some timing issues playing bioshock infinite, i solved it by following this guide: <a href="https://access.redhat.com/site/documentation/en-US/Red_Hat_Enterprise_Linux/5/html/Virtualization/chap-Virtualization-KVM_guest_timing_management.html" rel="nofollow">https://access.redhat.com/site/document … ement.html</a></p><p>EDIT: BTW im using cpuset cgroup and taskset to pin the 6 qemu threads to each vcpu, so in total there&#039;s 7 threads + 1 if audio passthrough is enabled,&#160; the main qemu thread + audio thread is running on cpus [0-1] while the vcpus threads run on cpus [2-7]</p> <p class="postedit"><em>Last edited by nbhs (2013-05-22 04:46:13)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276269" class="blockpost roweven"> <h2><span><span class="conr">#52</span> <a href="viewtopic.php?pid=1276269#p1276269">2013-05-22 03:42:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=47675">jgott</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-04-10</span></dd> <dd><span>Posts: 21</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=47675">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I managed to fix all the audio scraching/stutter by disabling nested pages and rebuilding my kernel ( see my second post on first page about performance numbers )</p></div></blockquote></div><p>Interesting that nested pages makes audio performance worse; I never would have guessed. I&#039;ll have to give this a try.</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>EDIT: BTW im using cpuset cgroup and taskset to pin the 6 qemu threads to each vcpu, so in total there&#039;s 7 threads + 1 if audio passthrough is enabled,&#160; the main qemu thread + audio thread is running on cpus [0-1] while the vcpus threads run on cpus [2-7]</p></div></blockquote></div><p>I wasn&#039;t setting CPU affinity before, but suddenly I can see why this matters, since qemu emulated devices (e.g. audio) are competing with the VM guest for CPU time. I&#039;ll have to try this, too.</p><p>Thanks for the tips. I should have looked at the performance tuning parts sooner. <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276269">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276273" class="blockpost rowodd"> <h2><span><span class="conr">#53</span> <a href="viewtopic.php?pid=1276273#p1276273">2013-05-22 03:51:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I sugest you use cgroups and move all the (movable) host threads to a couple of cores, and dedicate the rest to the vm, that way, even if your building a kernel on the host it wont interfere with the vm, you can create the cgroups manually or you can also use cset </p><p><a href="https://code.google.com/p/cpuset/" rel="nofollow">https://code.google.com/p/cpuset/</a><br /><a href="https://rt.wiki.kernel.org/index.php/Cpuset_Management_Utility/tutorial" rel="nofollow">https://rt.wiki.kernel.org/index.php/Cp … y/tutorial</a></p><p>You might need to patch the lastest version of cset (1.5.6)</p><p>EDIT: Patch here:</p><p><a href="http://www.filesend.net/download.php?f=8eeecf1101c62d9c3d61acac29d09c79" rel="nofollow">cset.py.patch</a></p><p>My VM script using CSET:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh CPU_CORE_NR=$(cat /proc/cpuinfo | egrep &quot;core id|physical id&quot; | tr -d &quot;\n&quot; | sed s/physical/\\nphysical/g | grep -v ^$ | sort | uniq | wc -l) QEMU=/usr/bin/qemu-system-x86_64 CSET=/usr/bin/cset VCPUS=&quot;6&quot; #must be &gt; 0 &lt; cpu core number CONFIG=&quot;-M q35 -enable-kvm&quot; MEM=&quot;8192&quot; MEM_PATH=&quot;/dev/hugepages&quot; CPU=&quot;host&quot; BIOS=&quot;/usr/share/qemu/bios.bin&quot; NET=&quot;-netdev bridge,br=br0,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0&quot; USB_DEVICES=&quot;tablet&quot; PCI_DEVICES=&quot;00:11.0 04:00.0 05:00.0 06:00.0&quot; SND=true SND_DRIVER_OPTS=&quot;QEMU_AUDIO_DRV=pa QEMU_PA_SAMPLES=128&quot; GPU=&quot;07:00.0&quot; GPU_SND=&quot;07:00.1&quot; VBIOS=&quot;/usr/local/share/qemu/vgabios-6950.bin&quot; HDD=&quot;&quot; CDROM=&quot;&quot; EXTRA_ARGS=&quot;-boot menu=on -monitor stdio&quot; if [ -n &quot;$GPU&quot; ]; then CONFIG+=&quot; -vga none -nographic&quot; DEV+=&quot; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&quot; if [ -n &quot;$VBIOS&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1,rombar=0,romfile=$VBIOS&quot; else DEV+=&quot; -device vfio-pci,host=$GPU,x-vga=on,addr=0.0,multifunction=on,bus=root.1&quot; fi if [ -n &quot;$GPU_SND&quot; ]; then DEV+=&quot; -device vfio-pci,host=$GPU_SND,addr=0.1,bus=root.1&quot; fi fi if [ -n &quot;$PCI_DEVICES&quot; ]; then for d in $PCI_DEVICES; do DEV+=&quot; -device vfio-pci,host=$d&quot; done fi if $SND ; then SND=&quot;-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,cad=0&quot; export $SND_DRIVER_OPTS else SND=&quot;&quot; fi if [ -n &quot;$HDD&quot; ] || [ -n &quot;$CDROM&quot; ]; then DEV+=&quot; -device ahci,bus=pcie.0,id=ahci&quot; if [ -n &quot;$HDD&quot; ]; then STORAGE+=&quot; -drive file=$HDD,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk&quot; fi if [ -n &quot;$CDROM&quot; ]; then STORAGE+=&quot; -drive file=$CDROM,id=isocd -device ide-cd,bus=ahci.1,drive=isocd&quot; fi fi if [ -n &quot;$CPU&quot; ]; then CPU=&quot;-cpu $CPU -smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; else CPU=&quot;-smp $VCPUS,sockets=1,cores=$VCPUS,threads=1&quot; fi if [ -n &quot;$BIOS&quot; ]; then BIOS=&quot; -bios $BIOS&quot; fi if [ -n &quot;$MEM&quot; ]; then MEMORY+=&quot;-m $MEM&quot; if [ -n &quot;$MEM_PATH&quot; ]; then MEMORY+=&quot; -mem-path $MEM_PATH&quot; fi else if [ -n &quot;$MEM_PATH&quot; ]; then MEMORY+=&quot; -mem-path $MEM_PATH&quot; fi fi if [ -n &quot;$USB_DEVICES&quot; ]; then for u in $USB_DEVICES; do USB_DEV+=&quot; -usbdevice $u&quot; done fi sync &amp;&amp; echo 1 &gt; /proc/sys/vm/drop_caches &amp; wait HUGEPAGES_NR=&quot;$(($MEM/$(($(grep Hugepagesize /proc/meminfo | awk &#039;{print $2}&#039;)/1024))))&quot; echo $HUGEPAGES_NR &gt; /proc/sys/vm/nr_hugepages if [ $HUGEPAGES_NR -eq $(cat /proc/sys/vm/nr_hugepages) ]; then $CSET shield -c $((CPU_CORE_NR-VCPUS))-$((CPU_CORE_NR-1)) set -m $QEMU $CONFIG $BIOS $CPU $MEMORY $DEV $USB_DEV $NET $SND $STORAGE $EXTRA_ARGS &amp; PID=$! ( while ( (kill -s 0 $PID &gt; /dev/null 2&gt;&amp;1) ); do if [ &quot;$(grep Threads /proc/$PID/status | awk &#039;{print $2}&#039; )&quot; -ge &quot;$((VCPUS+1))&quot; &gt; /dev/null 2&gt;&amp;1 ]; then i=$((CPU_CORE_NR-VCPUS)) for t in `ls /proc/$PID/task/`; do if [ $i -ne $((CPU_CORE_NR)) ]; then if [ $t -ne $PID ];then $CSET shield --shield --pid $t taskset -pc $i $t let i++ fi fi done break fi done ) &amp; fg %1 wait $CSET shield --reset echo 0 &gt; /proc/sys/vm/nr_hugepages echo &quot;All Done!!&quot; else echo &quot;Cannot reserve memory!&quot; fi</code></pre></div> <p class="postedit"><em>Last edited by nbhs (2013-05-22 04:27:31)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276460" class="blockpost roweven"> <h2><span><span class="conr">#54</span> <a href="viewtopic.php?pid=1276460#p1276460">2013-05-22 14:53:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71532">GreatEmerald</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-22</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71532">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I attempted to get this working as well. I have an integrated Intel HD Graphics 2500 (for the host) and a dedicated NVIDIA GeForce GTX 660 (for the guest).</p><p>I installed QEMU 1.5, kernel 3.9 (the VFIO components are modularised) and set intel_iommu=on in the boot options. Then I disabled everything that used NVIDIA (blacklisted, set libGL and libglx to point to Mesa, removed the paths from ldconfig.d, set xorg.conf.d to load the intel drivers). Then executed this:</p><div class="codebox"><pre><code>echo 1 | sudo tee /sys/module/vfio_iommu_type1/parameters/allow_unsafe_interrupts</code></pre></div><p>Then used your script to bind the two parts of the graphics card to vfio. This had an effect:</p><div class="codebox"><pre><code>[ 5517.777364] VFIO - User Level meta-driver version: 0.3 [ 5692.736558] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO0: (unknown bits 0x00008000) [ 5692.736567] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO0: ch 1 [DRM] subc 0 mthd 0x0000 data 0x00000000 [ 5695.738853] nouveau E[ DRM] failed to idle channel 0xcccc0000 [DRM] [ 5695.741961] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO2: (unknown bits 0x00008000) [ 5695.741965] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO2: ch 0 [DRM] subc 0 mthd 0x0000 data 0x00000000 [ 5698.744410] nouveau E[ DRM] failed to idle channel 0xcccc0001 [DRM] [ 5698.748200] [TTM] Finalizing pool allocator [ 5698.748203] [TTM] Finalizing DMA pool allocator [ 5698.748217] [TTM] Zone kernel: Used memory at exit: 0 kiB [ 5698.748219] [TTM] Zone dma32: Used memory at exit: 0 kiB</code></pre></div><p>I also added the systemd unit file and enabled it, but haven&#039;t restarted just yet.</p><p>Finally, I executed this:</p><div class="codebox"><pre><code>pkexec qemu-system-x86_64 --enable-kvm -M q35 -m 1024 -cpu host -smp 2,sockets=1,cores=2,threads=1 -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -bios /home/dainius/seabios/out/bios.bin</code></pre></div><p>The reason why it&#039;s using pkexec is that using sudo makes it fail due to missing display, kdesu eats all the stdout/stderr (even when passed the -t option), and qemu-system seemingly ignores the -D option, which leaves me with only pkexec that can actually give me a GUI and show debugging information at the same time (that required me to fiddle with policy settings, since you need to explicitly add a policy that enables org.freedesktop.policykit.exec.allow_gui for each GUI application you want to pkexec).</p><p>The output of the command is:</p><div class="codebox"><pre><code>Warning: default mac address being used, creating potential for address conflict qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Warning, device 0000:01:00.0 does not support reset qemu-system-x86_64: -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1: Warning, device 0000:01:00.1 does not support reset</code></pre></div><p>And dmesg gives me:</p><div class="codebox"><pre><code>[11151.655299] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [11151.717650] vfio_ecap_init: 0000:01:00.1 hiding ecap 0x0@0x100</code></pre></div><p>I get the QEMU window, showing &quot;This VM has no graphic display device&quot;. When I connect my monitor to the GTX 660&#039;s DVI ports, I see no output at all (the screen goes into sleep mode).</p><p>So, I&#039;m out of ideas right now. Maybe I should give pci-assign a try as well, although I&#039;m not yet sure how it works.</p><p>I&#039;m also not entirely sure how the whole passthrough is supposed to work as well. Does SeaBIOS see my graphics card as something it needs to initialise and use, so in essence the graphics card is supposed to think that it&#039;s being initialised in a clean boot process? But doesn&#039;t it generally need something to be connected to the card during that process, so that it could get EDID data and such? I have only one monitor here, so the only way to do so would be to connect the monitor before launching the virtual machine...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276460">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276521" class="blockpost rowodd"> <h2><span><span class="conr">#55</span> <a href="viewtopic.php?pid=1276521#p1276521">2013-05-22 16:32:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39060">alphaniner</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/39060.png?m=1312435868" width="80" height="80" alt="" /></dd> <dd><span>From: Ancapistan</span></dd> <dd><span>Registered: 2010-07-12</span></dd> <dd><span>Posts: 2,291</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=39060">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can you elaborate on exactly what you&#039;re doing with audio? In the first post you PCI-passthrough both your video card and the associated audio device. But you also mention</p><div class="quotebox"><blockquote><div><p>AUDIO PASSTHROUGH:</p><div class="codebox"><pre><code>-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0</code></pre></div></div></blockquote></div><p>Isn&#039;t the second method emulation rather than passthrough?</p><p>And in any case, is the second method what you&#039;re talking about wrt cpu pinning in post 51?</p> </div> <div class="postsignature postmsg"><hr /><p>But whether the Constitution really be one thing, or another, this much is certain - that it has either authorized such a government as we have had, or has been powerless to prevent it. In either case, it is unfit to exist.<br />-Lysander Spooner</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276521">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276706" class="blockpost roweven"> <h2><span><span class="conr">#56</span> <a href="viewtopic.php?pid=1276706#p1276706">2013-05-22 20:36:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GreatEmerald wrote:</cite><blockquote><div><p>Then used your script to bind the two parts of the graphics card to vfio. This had an effect:</p><div class="codebox"><pre><code>[ 5517.777364] VFIO - User Level meta-driver version: 0.3 [ 5692.736558] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO0: (unknown bits 0x00008000) [ 5692.736567] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO0: ch 1 [DRM] subc 0 mthd 0x0000 data 0x00000000 [ 5695.738853] nouveau E[ DRM] failed to idle channel 0xcccc0000 [DRM] [ 5695.741961] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO2: (unknown bits 0x00008000) [ 5695.741965] nouveau E[ PFIFO][0000:01:00.0] SUBFIFO2: ch 0 [DRM] subc 0 mthd 0x0000 data 0x00000000 [ 5698.744410] nouveau E[ DRM] failed to idle channel 0xcccc0001 [DRM] [ 5698.748200] [TTM] Finalizing pool allocator [ 5698.748203] [TTM] Finalizing DMA pool allocator [ 5698.748217] [TTM] Zone kernel: Used memory at exit: 0 kiB [ 5698.748219] [TTM] Zone dma32: Used memory at exit: 0 kiB</code></pre></div></div></blockquote></div><p>You need to block nouveau modules as well</p><p>Also try this:</p><div class="codebox"><pre><code>modprobe -r kvm_intel modprobe kvm_intel emulate_invalid_guest_state=0</code></pre></div><p>Also make sure seabios is patched as described on my guide, or use the seabios-git package i provided.</p><p>Other users reported it not working when using the IGP as primary device, you might want to try with 2 discrete cards and IGP off.</p><p>EDIT: This guy got some 660 cards working,unfortunately his page is down so i&#039;ll link webcache <a href="http://webcache.googleusercontent.com/search?q=cache%3Ahttp%3A%2F%2Fwww.frankdtech.org%2F&amp;aq=f&amp;oq=cache%3Ahttp%3A%2F%2Fwww.frankdtech.org%2F&amp;aqs=chrome.0.57j58.2701j0&amp;sourceid=chrome&amp;ie=UTF-8" rel="nofollow">http://webcache.googleusercontent.com/s … e&amp;ie=UTF-8</a></p> <p class="postedit"><em>Last edited by nbhs (2013-05-22 21:00:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276706">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276707" class="blockpost rowodd"> <h2><span><span class="conr">#57</span> <a href="viewtopic.php?pid=1276707#p1276707">2013-05-22 20:44:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alphaniner wrote:</cite><blockquote><div><p>Can you elaborate on exactly what you&#039;re doing with audio? In the first post you PCI-passthrough both your video card and the associated audio device. But you also mention</p><div class="quotebox"><blockquote><div><p>AUDIO PASSTHROUGH:</p><div class="codebox"><pre><code>-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0</code></pre></div></div></blockquote></div><p>Isn&#039;t the second method emulation rather than passthrough?</p><p>And in any case, is the second method what you&#039;re talking about wrt cpu pinning in post 51?</p></div></blockquote></div><p>Yes this is audio emulation, i called it passthrough because it pass the audio from the vm to the host, it creates an emulated sound card inside the vm, but im also using a usb headset connected to my usb3 ports which are passed thru to my vm.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-22 21:40:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276707">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276717" class="blockpost roweven"> <h2><span><span class="conr">#58</span> <a href="viewtopic.php?pid=1276717#p1276717">2013-05-22 21:01:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71532">GreatEmerald</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-22</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71532">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You need to block nouveau modules as well</p><p>Also try this:</p><div class="codebox"><pre><code>modprobe -r kvm_intel modprobe kvm_intel emulate_invalid_guest_state=0</code></pre></div><p>Also make sure seabios is patched as described on my guide, or use the seabios-git package i provided.</p><p>Other users reported it not working when using the IGP as primary device, you might want to try with 2 discrete cards and IGP off.</p></div></blockquote></div><p>Well, nouveau never was loaded. It&#039;s not on lsmod. So I don&#039;t know why it&#039;s mentioned in dmesg. Just to make sure, I added it to blacklist as well, but I&#039;ll have to restart to try it again.</p><p>And yes, I did load kvm_intel like that, I just forgot to mention it.</p><p>As for SeaBIOS, the patch actually isn&#039;t needed, because it&#039;s been merged upstream already: <a href="http://code.coreboot.org/p/seabios/source/commit/7adfd712d031e5b4bbd0865f32c99f397fbab821/" rel="nofollow">http://code.coreboot.org/p/seabios/sour … 97fbab821/</a> And yes, I am using SeaBIOS built from from git.</p><p>As for two dedicated cards, unfortunately I don&#039;t have such a luxury... I could try reversing the cards, so that the host uses NVIDIA and the guest uses Intel, but that&#039;s about it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276718" class="blockpost rowodd"> <h2><span><span class="conr">#59</span> <a href="viewtopic.php?pid=1276718#p1276718">2013-05-22 21:03:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It hasnt been merged here git.qemu.org/seabios.git, which is the one we need to use, so please use my package.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276718">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276737" class="blockpost roweven"> <h2><span><span class="conr">#60</span> <a href="viewtopic.php?pid=1276737#p1276737">2013-05-22 21:52:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71532">GreatEmerald</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-22</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71532">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>It hasnt been merged here git.qemu.org/seabios.git, which is the one we need to use, so please use my package.</p></div></blockquote></div><p>The QEMU SeaBIOS repository is an exact clone of the upstream SeaBIOS repository, just lagging behind (you can diff the git logs to make sure). So you can literally get the same result by fetching upstream and then doing a `git reset --hard f465e1ec1b01826100c92b890487a2ab09bfe2c1`. So unless the new commits actually break QEMU (unlikely, given that it hasn&#039;t broken it in a single commit up to now, unless upstream git is prone to breaking before it gets fixed up down the road), there really is no reason not to use the upstream SeaBIOS repository.</p><p>I suppose I can reset and cherry-pick the needed commit if you are so inclined. I just highly doubt there will be any difference.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276737">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1276740" class="blockpost rowodd"> <h2><span><span class="conr">#61</span> <a href="viewtopic.php?pid=1276740#p1276740">2013-05-22 21:59:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GreatEmerald wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>It hasnt been merged here git.qemu.org/seabios.git, which is the one we need to use, so please use my package.</p></div></blockquote></div><p>The QEMU SeaBIOS repository is an exact clone of the upstream SeaBIOS repository, just lagging behind (you can diff the git logs to make sure). So you can literally get the same result by fetching upstream and then doing a `git reset --hard f465e1ec1b01826100c92b890487a2ab09bfe2c1`. So unless the new commits actually break QEMU (unlikely, given that it hasn&#039;t broken it in a single commit up to now, unless upstream git is prone to breaking before it gets fixed up down the road), there really is no reason not to use the upstream SeaBIOS repository.</p><p>I suppose I can reset and cherry-pick the needed commit if you are so inclined. I just highly doubt there will be any difference.</p></div></blockquote></div><p>Yes i know, thing is upstream seabios does break my system, i cant boot windows with it, you should be able to get output on your card tho, but that might be broken too.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-22 22:02:34)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1276740">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277218" class="blockpost roweven"> <h2><span><span class="conr">#62</span> <a href="viewtopic.php?pid=1277218#p1277218">2013-05-24 00:46:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71577">Kamek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/71577.jpg?m=1369356640" width="80" height="80" alt="" /></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there a way to share a single GPU between the host and the guest ? I only have one GTX 670 in my rig, but I&#039;m sick and tired of rebooting every time I want to play a game.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277218">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277224" class="blockpost rowodd"> <h2><span><span class="conr">#63</span> <a href="viewtopic.php?pid=1277224#p1277224">2013-05-24 00:59:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Kamek wrote:</cite><blockquote><div><p>Is there a way to share a single GPU between the host and the guest ? I only have one GTX 670 in my rig, but I&#039;m sick and tired of rebooting every time I want to play a game.</p></div></blockquote></div><p>Not using this method, if you had a radeon card you could use kvm pci-assign and pass it as secondary but on NV cards this is the only reliable method (unless you&#039;re willing to try xen, and its counteless unreliable hacks)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277224">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277511" class="blockpost roweven"> <h2><span><span class="conr">#64</span> <a href="viewtopic.php?pid=1277511#p1277511">2013-05-24 18:37:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71604">darkspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey nbhs,<br />I followed your guide and got everything running, but I have an issue with the pci-passthrough of an USB Controller. My board has an Etron USB 3.0 controller I never use, so I wanted to pass it to my Win7 guest.<br />Here is the output of lspci:</p><div class="codebox"><pre><code>03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 05:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>So I use &quot;vfio-bind 0000:03:00.0 0000:05:00.0&quot; and add &quot;-device vfio-pci,host=03:00.0,bus=pcie.0 -device vfio-pci,host=05:00.0,bus=pcie.0&quot; to the start command of qemu and plug my mouse and keyboard into the 2 USB 3.0 ports. <br />But both aren&#039;t even powered (Razer-logo doesn&#039;t fade in and out and keyboard keys aren&#039;t lit) and the guest doesn&#039;t recognize them, same happens if I use any other USB Controller that lspci spits out. The mainboard I am using is an Gigabyte 990XA-UD3, which seems to have a quite good implementation of IOMMU. So, if I pass my mouse or my keyboard using the usb-function of qemu, it works, but of course it isn&#039;t available for the host anymore and I&#039;d like to use a KVM switch to switch between the guest and the host.<br />Any suggestions on how I can fix the problem?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277511">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277559" class="blockpost rowodd"> <h2><span><span class="conr">#65</span> <a href="viewtopic.php?pid=1277559#p1277559">2013-05-24 21:20:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>darkspider wrote:</cite><blockquote><div><p>Hey nbhs,<br />I followed your guide and got everything running, but I have an issue with the pci-passthrough of an USB Controller. My board has an Etron USB 3.0 controller I never use, so I wanted to pass it to my Win7 guest.<br />Here is the output of lspci:</p><div class="codebox"><pre><code>03:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01) 05:00.0 USB controller: Etron Technology, Inc. EJ168 USB 3.0 Host Controller (rev 01)</code></pre></div><p>So I use &quot;vfio-bind 0000:03:00.0 0000:05:00.0&quot; and add &quot;-device vfio-pci,host=03:00.0,bus=pcie.0 -device vfio-pci,host=05:00.0,bus=pcie.0&quot; to the start command of qemu and plug my mouse and keyboard into the 2 USB 3.0 ports. <br />But both aren&#039;t even powered (Razer-logo doesn&#039;t fade in and out and keyboard keys aren&#039;t lit) and the guest doesn&#039;t recognize them, same happens if I use any other USB Controller that lspci spits out. The mainboard I am using is an Gigabyte 990XA-UD3, which seems to have a quite good implementation of IOMMU. So, if I pass my mouse or my keyboard using the usb-function of qemu, it works, but of course it isn&#039;t available for the host anymore and I&#039;d like to use a KVM switch to switch between the guest and the host.<br />Any suggestions on how I can fix the problem?</p></div></blockquote></div><p>Great man what card did you manage to pass through?</p><p>Make sure every device on /sys/bus/pci/drivers/vfio-pci/0000\:03\:00.0/iommu_group/devices/ and&#160; /sys/bus/pci/drivers/vfio-pci/0000\:05\:00.0/iommu_group/devices/ are passed through</p><p>Or can try passing through usb2 ports, but they normally come in pairs, so you have to pass both for example:</p><p>lspci</p><div class="codebox"><pre><code>00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller 00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller</code></pre></div><p>You might have to pass it through as a single multifunction device.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-24 21:27:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277559">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277577" class="blockpost roweven"> <h2><span><span class="conr">#66</span> <a href="viewtopic.php?pid=1277577#p1277577">2013-05-24 21:45:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71604">darkspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank your for your quick reply and your great tutorial! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I managed to pass through a Nvidia GeForce GTX 460 while the host is running on an old Quadro FX 1700 (nouveau) I had laying around.<br />I saw a <a href="https://www.youtube.com/watch?v=Gtmwnx-k2qg" rel="nofollow">YouTube Video</a> by Ubisoft, who benchmarked a 2 VM-system running on 2 GTX 460s with the only difference that they were using XEN. So I thought I&#039;d try this out, but XEN didn&#039;t really seem to be what I was looking for and then I found your guide and yeah, it worked (except the USB part, which I&#039;ll try later) <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>So, let&#039;s come to the USB part:<br />I tried your second example before in which I exactly did what you described, but it would turn out the same way as my USB3 controller approach. Only thing I didn&#039;t try is to &quot;pass it through as a single multifunction device&quot;. Can you please explain how this works?<br />Thank you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Edit: Just remembered this: your systemd service contains an error (or typo):</p><div class="codebox"><pre><code>ExecStart=-/usr/bin/vfio-pci $DEVICES</code></pre></div><p>&#160; should say vfio-bind, because the script in /usr/bin is named vfio-bind in your tutorial <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by darkspider (2013-05-24 21:53:33)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277577">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277581" class="blockpost rowodd"> <h2><span><span class="conr">#67</span> <a href="viewtopic.php?pid=1277581#p1277581">2013-05-24 21:53:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>darkspider wrote:</cite><blockquote><div><p>Thank your for your quick reply and your great tutorial! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />I managed to pass through a Nvidia GeForce GTX 460 while the host is running on an old Quadro FX 1700 (nouveau) I had laying around.<br />I saw a <a href="https://www.youtube.com/watch?v=Gtmwnx-k2qg" rel="nofollow">YouTube Video</a> by Ubisoft, who benchmarked a 2 VM-system running on 2 GTX 460s with the only difference that they were using XEN. So I thought I&#039;d try this out, but XEN didn&#039;t really seem to be what I was looking for and then I found your guide and yeah, it worked (except the USB part, which I&#039;ll try later) <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p><p>So, let&#039;s come to the USB part:<br />I tried your second example before in which I exactly did what you described, but it would turn out the same way as my USB3 controller approach. Only thing I didn&#039;t try is to &quot;pass it through as a single multifunction device&quot;. Can you please explain how this works?<br />Thank you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Yeah for example for my usb 2 ports i would do something like this:</p><div class="codebox"><pre><code>qemu-system-x86_64 -device vfio-pci,host=00:13.0,multifunction=on,addr=13.0 \ -device vfio-pci,host=00:13.2,addr=13.2</code></pre></div><p>EDIT: Thanks didnt notice the typo ill correct it.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-24 21:58:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277589" class="blockpost roweven"> <h2><span><span class="conr">#68</span> <a href="viewtopic.php?pid=1277589#p1277589">2013-05-24 22:08:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71604">darkspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Typing this from my Win7 VM, pass through of USB2 ports works, the Etron controller doesn&#039;t want to work. &quot;multifunction&quot; won&#039;t do the trick for it, but it works like a charm for a pair of USB2 ports. Thanks a lot!<br />My last step is now getting audio to work (haven&#039;t tried it before, I was happy enough to see something on my screen <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> )</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277592" class="blockpost rowodd"> <h2><span><span class="conr">#69</span> <a href="viewtopic.php?pid=1277592#p1277592">2013-05-24 22:14:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Perhaps this &quot;etron&quot; controller needs an option rom to work, if you manage to dump it/find it somewhere (its most likely included in your mobo bios, you could extract it from there) you can pass it to the vm with</p><div class="codebox"><pre><code>-option-rom /path/to/rom</code></pre></div><p>Audio is painful, see my second post on first page on how to optimize for my amd cpu and also my first post in this page,&#160; i had to disable nested pages even for a usb headset&#160; to work without stuttering/scratchy sound.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-24 22:23:29)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277592">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277603" class="blockpost roweven"> <h2><span><span class="conr">#70</span> <a href="viewtopic.php?pid=1277603#p1277603">2013-05-24 22:57:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71604">darkspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Guess what? Audio&#039;s working perfectly with</p><div class="codebox"><pre><code> -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 </code></pre></div><p>and </p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64...</code></pre></div><p>just like how you mentioned in your first post, no stuttering, no scratching, everything is perfectly fine <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />!</p><p>I have extracted a recent version of my BIOS, but I can&#039;t find any files that may be related to the Etron USB 3.0 Controller (there are some &quot;GROUP ROM&quot;s, like tgroup.bin, t1group.bin up to &quot;t4&quot; and ggroup, ffgroup) and I honestly never did something like this (extracting a BIOS) before, also Google doesn&#039;t deliver anything about the controller&#039;s ROM (just many forum entries about issues with this controller in normal use i.e. driver issues)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277603">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277606" class="blockpost rowodd"> <h2><span><span class="conr">#71</span> <a href="viewtopic.php?pid=1277606#p1277606">2013-05-24 23:04:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>darkspider wrote:</cite><blockquote><div><p>Guess what? Audio&#039;s working perfectly with</p><div class="codebox"><pre><code> -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 </code></pre></div><p>and </p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64...</code></pre></div><p>just like how you mentioned in your first post, no stuttering, no scratching, everything is perfectly fine <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />!</p><p>I have extracted a recent version of my BIOS, but I can&#039;t find any files that may be related to the Etron USB 3.0 Controller (there are some &quot;GROUP ROM&quot;s, like tgroup.bin, t1group.bin up to &quot;t4&quot; and ggroup, ffgroup) and I honestly never did something like this (extracting a BIOS) before, also Google doesn&#039;t deliver anything about the controller&#039;s ROM (just many forum entries about issues with this controller in normal use i.e. driver issues)</p></div></blockquote></div><p>Well if you encounter, audio problems playing games, take a look at my second post on first page, like you i had no problems with audio, until i started playing metro last light, and then all kind of problems started to arrise, like scratchy audio, stuttering in sound and fps, i solved all that doing the steps i mentioned, and rebuilding my kernel with the config file i attached</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277606">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277825" class="blockpost roweven"> <h2><span><span class="conr">#72</span> <a href="viewtopic.php?pid=1277825#p1277825">2013-05-25 13:29:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71532">GreatEmerald</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-22</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71532">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I tried a few other things, like blacklisting nouveau, setting pci_stub to claim the graphics card and cherry-picking SeaBIOS. Still no go. I get this in dmesg:</p><div class="codebox"><pre><code>[19144.183320] VFIO - User Level meta-driver version: 0.3 [19433.567127] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [19433.567278] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [19433.641853] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002) [19433.641964] vfio_ecap_init: 0000:01:00.1 hiding ecap 0x0@0x100</code></pre></div><p>And this from the console:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Warning, device 0000:01:00.0 does not support reset qemu-system-x86_64: -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1: Warning, device 0000:01:00.1 does not support reset</code></pre></div><p>I also tried the commands suggested at the FrankD page. But it resulted in QEMU eating one core or outright dying with this message followed by a backtrace:</p><div class="codebox"><pre><code>KVM internal error. Suberror: 1 emulation failure</code></pre></div><p>The card still shows no output either way.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277825">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277901" class="blockpost rowodd"> <h2><span><span class="conr">#73</span> <a href="viewtopic.php?pid=1277901#p1277901">2013-05-25 16:44:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GreatEmerald wrote:</cite><blockquote><div><p>So I tried a few other things, like blacklisting nouveau, setting pci_stub to claim the graphics card and cherry-picking SeaBIOS. Still no go. I get this in dmesg:</p><div class="codebox"><pre><code>[19144.183320] VFIO - User Level meta-driver version: 0.3 [19433.567127] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [19433.567278] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [19433.641853] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002) [19433.641964] vfio_ecap_init: 0000:01:00.1 hiding ecap 0x0@0x100</code></pre></div><p>And this from the console:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Warning, device 0000:01:00.0 does not support reset qemu-system-x86_64: -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1: Warning, device 0000:01:00.1 does not support reset</code></pre></div><p>I also tried the commands suggested at the FrankD page. But it resulted in QEMU eating one core or outright dying with this message followed by a backtrace:</p><div class="codebox"><pre><code>KVM internal error. Suberror: 1 emulation failure</code></pre></div><p>The card still shows no output either way.</p></div></blockquote></div><p>You should fill a bug report @qemu-devel see: <a href="http://lists.gnu.org/archive/html/qemu-devel/2013-05/msg00432.html" rel="nofollow">http://lists.gnu.org/archive/html/qemu- … 00432.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277901">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277914" class="blockpost roweven"> <h2><span><span class="conr">#74</span> <a href="viewtopic.php?pid=1277914#p1277914">2013-05-25 17:05:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71604">darkspider</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-24</span></dd> <dd><span>Posts: 5</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>nbhs, thanks for your help, you&#039;re very kind. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Could you elaborate on your kernel config? What&#039;s the purpose of using a 1000HZ timer frequency and a voluntary Preemption Model? I&#039;ve seen some posts of people, who recommend this settings for a Desktop setup, because it reduces latency, is this the reason?<br />Since I&#039;m pretty much new to this kind of virtualization, I wonder if those kernel settings have an impact on the usability of the host system. So, would you recommend booting the modified kernel on a daily basis for productive work, or just if virtualization is needed? I&#039;d say there isn&#039;t that much difference to the &quot;vanilla&quot; Arch kernel, so there&#039;s is nothing that would really speak against using the modified kernel even if I don&#039;t intend to use virtualization every time, right?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277914">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1277920" class="blockpost rowodd"> <h2><span><span class="conr">#75</span> <a href="viewtopic.php?pid=1277920#p1277920">2013-05-25 17:19:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>darkspider wrote:</cite><blockquote><div><p>nbhs, thanks for your help, you&#039;re very kind. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />Could you elaborate on your kernel config? What&#039;s the purpose of using a 1000HZ timer frequency and a voluntary Preemption Model? I&#039;ve seen some posts of people, who recommend this settings for a Desktop setup, because it reduces latency, is this the reason?<br />Since I&#039;m pretty much new to this kind of virtualization, I wonder if those kernel settings have an impact on the usability of the host system. So, would you recommend booting the modified kernel on a daily basis for productive work, or just if virtualization is needed? I&#039;d say there isn&#039;t that much difference to the &quot;vanilla&quot; Arch kernel, so there&#039;s is nothing that would really speak against using the modified kernel even if I don&#039;t intend to use virtualization every time, right?</p></div></blockquote></div><p>Im using 1000hz instead of dynticks on my system because running the vm on cpus != of 0 would result in my vm hanging specially gaming, and im using voluntary preempt because without it my vm feels sluggish with npt disabled.</p><p>And yeah you shouldnt notice any issue on your host using my kernel config.</p> <p class="postedit"><em>Last edited by nbhs (2013-05-25 17:21:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1277920">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=2">Previous</a> <a href="viewtopic.php?id=162768">1</a> <a href="viewtopic.php?id=162768&amp;p=2">2</a> <strong>3</strong> <a href="viewtopic.php?id=162768&amp;p=4">4</a> <a href="viewtopic.php?id=162768&amp;p=5">5</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=4">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
