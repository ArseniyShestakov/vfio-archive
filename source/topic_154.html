<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 154) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=154" title="Page 154" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=153" title="Page 153" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=155" title="Page 155" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=153">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <a href="viewtopic.php?id=162768&amp;p=153">153</a> <strong>154</strong> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <a href="viewtopic.php?id=162768&amp;p=156">156</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=155">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1492193" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3826</span> <a href="viewtopic.php?pid=1492193#p1492193">2015-01-11 18:02:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>@aw<br />Thanks again for explanations. Now it gives me, when the driver for this card is pci-stub (lspci -kn)</p><div class="quotebox"><blockquote><div><p>cat rom &gt; /tmp/image.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;/sys/bus/pci/devices/0000:03:00.0<br />cat: rom: Input/output error</p></div></blockquote></div><p>Maybe I just try with the latest bios on <a href="http://www.techpowerup.com/" rel="nofollow">http://www.techpowerup.com/</a> ...</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ./rom-parser ~/Sapphire.HD6850.1024.110620.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ~/rom-parser<br />Valid ROM signature found @0h, PCIR offset 1f4h<br />&#160; &#160; PCIR: type 0, vendor: 1002, device: 6739, class: 030000<br />&#160; &#160; PCIR: revision 0, vendor revision: d0c<br />&#160; &#160; Last image</p></div></blockquote></div><p>latest from this site.. meanging no UEFI with this card?</p><p>and if I disable OVMF, and boot with seabios, should I see anything on screen which is connected to hd 6850 by hdmi? For now, it&#039;s nothing there.</p></div></blockquote></div><p>Yep, no UEFI support in that ROM.&#160; If you use seabios then you need x-vga=on, but search back a couple weeks and find the wrapper script method of adding it, don&#039;t use the &lt;qemu:arg&gt; abomination.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492193">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492217" class="blockpost roweven"> <h2><span><span class="conr">#3827</span> <a href="viewtopic.php?pid=1492217#p1492217">2015-01-11 19:58:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw</p><p>tried with</p><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039;&gt;<br />&#160; &lt;name&gt;windows&lt;/name&gt;<br />&#160; &lt;uuid&gt;c8bc2373-6271-4810-991e-8618a0ee01d2&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;3145728&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;3145728&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;clock offset=&#039;utc&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/bin/qemu-wrapper&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/virtio-win-0.1-94.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/brasero.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/var/lib/libvirt/images/vm1.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;4&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;sound model=&#039;ich6&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x0cf3&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x9271&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt;<br />&#160; &#160; &lt;/redirdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&#160; &lt;seclabel type=&#039;none&#039; model=&#039;none&#039;/&gt;<br />&lt;/domain&gt;</p></div></blockquote></div><p>modified wrapper to</p><div class="quotebox"><blockquote><div><p>#!/bin/sh<br />exec qemu-system-x86_64 `echo &quot;\$@&quot; | sed &#039;s|03:00.0|03:00.0,x-vga=on|g&#039;`</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Barts PRO [Radeon HD 6850]</p></div></blockquote></div><p>start the VM, switch to hmdi which connected to HD 6850 - no connection</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492217">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492222" class="blockpost rowodd"> <h2><span><span class="conr">#3828</span> <a href="viewtopic.php?pid=1492222#p1492222">2015-01-11 20:04:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>start the VM, switch to hmdi which connected to HD 6850 - no connection</p></div></blockquote></div><p>Do you get the &quot;Invalid ROM contents&quot; message in dmesg when starting the VM?&#160; If so, then you need to pass a rom with the &lt;rom file=&quot;$FILE&quot;/&gt; option (double check that syntax)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492222">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492233" class="blockpost roweven"> <h2><span><span class="conr">#3829</span> <a href="viewtopic.php?pid=1492233#p1492233">2015-01-11 20:22:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 4.355351] radeon 0000:01:00.0: Invalid ROM contents</p></div></blockquote></div><p>but this is for </p><div class="quotebox"><blockquote><div><p>01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Curacao PRO [Radeon R9 270]</p></div></blockquote></div><p>which works nice in linux with the latest mesa-git drivers</p><p>hmmm, sometimes it shows Seabios on screen, sometimes screen is completely dark.. but with no &quot;no connection&quot;.. it&#039;s like it&#039;s waiting for something</p><p>in dmesg I have:</p><div class="quotebox"><blockquote><div><p>[&#160; 740.315287] vfio-pci 0000:03:00.0: enabling device (0400 -&gt; 0403)</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>[&#160; 744.276043] kvm: zapping shadow pages for mmio generation wraparound</p></div></blockquote></div><p>Stupid me: should add tag bootmenu to os</p><p>Now I need to passthrough my second, ps2 keyboard to actually press F12. How?)</p> <p class="postedit"><em>Last edited by walkindude (2015-01-11 23:07:15)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492233">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492303" class="blockpost rowodd"> <h2><span><span class="conr">#3830</span> <a href="viewtopic.php?pid=1492303#p1492303">2015-01-12 00:25:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>Now I need to passthrough my second, ps2 keyboard to actually press F12. How?)</p></div></blockquote></div><p>QEMU doesn&#039;t support ps/2 passthrough afaik.&#160; Probably too much BIOS involved in ps/2.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492303">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492307" class="blockpost roweven"> <h2><span><span class="conr">#3831</span> <a href="viewtopic.php?pid=1492307#p1492307">2015-01-12 00:37:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@aw<br />Damn, and my other, bluetooth keyboard doesn&#039;t work too. Not detected before any system has been booted.<br />Time to borrow some from friend)</p> <p class="postedit"><em>Last edited by walkindude (2015-01-12 00:37:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492307">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492312" class="blockpost rowodd"> <h2><span><span class="conr">#3832</span> <a href="viewtopic.php?pid=1492312#p1492312">2015-01-12 01:49:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It really is a bummer that the E3-12xx series lacks isolation on the CPU root ports.<br />Motherboards that use PLX chips (which have ACS) should help a lot.</p><p><a href="http://www.anandtech.com/show/6170/four-multigpu-z77-boards-from-280350-plx-pex-8747-featuring-gigabyte-asrock-ecs-and-evga" rel="nofollow">http://www.anandtech.com/show/6170/four … s-and-evga</a></p><p>The Gigabyte diagram shows all CPU lanes connected directly into the switch, which is the ideal case.<br />The EVGA diagram shows the first x16 slot directly connected to the CPU, and all the other slots behind the switch.<br />In that situation, is it possible for the PLX switch to provide isolation between that directly-connected slot and all the other slots?&#160; I&#039;d hope it would be able to force all transactions to go directly upstream.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492312">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492314" class="blockpost roweven"> <h2><span><span class="conr">#3833</span> <a href="viewtopic.php?pid=1492314#p1492314">2015-01-12 01:54:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><p>It really is a bummer that the E3-12xx series lacks isolation on the CPU root ports.<br />Motherboards that use PLX chips (which have ACS) should help a lot.</p><p><a href="http://www.anandtech.com/show/6170/four-multigpu-z77-boards-from-280350-plx-pex-8747-featuring-gigabyte-asrock-ecs-and-evga" rel="nofollow">http://www.anandtech.com/show/6170/four … s-and-evga</a></p><p>The Gigabyte diagram shows all CPU lanes connected directly into the switch, which is the ideal case.<br />The EVGA diagram shows the first x16 slot directly connected to the CPU, and all the other slots behind the switch.<br />In that situation, is it possible for the PLX switch to provide isolation between that directly-connected slot and all the other slots?&#160; I&#039;d hope it would be able to force all transactions to go directly upstream.</p></div></blockquote></div><p>Nope, switches downstream of root ports don&#039;t help, the full topology must support ACS.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492314">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492329" class="blockpost rowodd"> <h2><span><span class="conr">#3834</span> <a href="viewtopic.php?pid=1492329#p1492329">2015-01-12 03:58:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>does anyone have any tips on reducing audio latency?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492329">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492342" class="blockpost roweven"> <h2><span><span class="conr">#3835</span> <a href="viewtopic.php?pid=1492342#p1492342">2015-01-12 05:35:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79899">winie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-01</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:alireza4051@yahoo.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>does anyone have any tips on reducing audio latency?</p></div></blockquote></div><p>best option is to not use an emulated sound device in geust.</p><p>instead pasthrough a cheap usb sound card. you can find one for a few dollars.<br />or passthrough the graphic cards built in hdmi audio device.</p> <p class="postedit"><em>Last edited by winie (2015-01-12 05:35:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492342">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492389" class="blockpost rowodd"> <h2><span><span class="conr">#3836</span> <a href="viewtopic.php?pid=1492389#p1492389">2015-01-12 12:21:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>winie wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>does anyone have any tips on reducing audio latency?</p></div></blockquote></div><p>best option is to not use an emulated sound device in geust.</p><p>instead pasthrough a cheap usb sound card. you can find one for a few dollars.<br />or passthrough the graphic cards built in hdmi audio device.</p></div></blockquote></div><p>or passthrough ODAC USB device (like this <a href="http://www.amazon.co.uk/Epiphany-Acoustics-E-DAC-bit-miniature-Black/dp/B00G36MTT0" rel="nofollow">http://www.amazon.co.uk/Epiphany-Acoust … B00G36MTT0</a> - that&#039;s mine BTW) or even better, whole USB controller to which such device is attached.</p><p>also, use libvirt vcpupin or some other means of pinning VCPU.</p><p>finally, <strong>only if</strong> the computer is dedicated&#160; to running virtual machines, you can use isolcpus kernel option to ensure that some cores are left by kernel scheduler for exclusive use of the virtual machine.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492389">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492391" class="blockpost roweven"> <h2><span><span class="conr">#3837</span> <a href="viewtopic.php?pid=1492391#p1492391">2015-01-12 12:27:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Yep, no UEFI support in that ROM.&#160; If you use seabios then you need x-vga=on, but search back a couple weeks and find the wrapper script method of adding it, don&#039;t use the &lt;qemu:arg&gt; abomination.</p></div></blockquote></div><br /><p>... or only two pages back&#160; : <a href="https://bbs.archlinux.org/viewtopic.php?pid=1491451#p1491451" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 1#p1491451</a> <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492391">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492489" class="blockpost rowodd"> <h2><span><span class="conr">#3838</span> <a href="viewtopic.php?pid=1492489#p1492489">2015-01-12 19:33:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek<br />Already done that, see <a href="https://bbs.archlinux.org/viewtopic.php?pid=1492217#p1492217" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 7#p1492217</a> at the end. Just forgot to set bootmenu timeout.<br />Tried you wrapper: no connection.</p><p>But after I had seen Seabios load screen, pressed F12, tried to boot from Windows DVD / Arch Live CD, see &quot;Booting from CD/DVD&quot; or &quot;ISOLINUX ...&quot; caption for about a second and then screen goes dark. Tried to wait several minutes: nothing, just blackness.</p><p>My current xml is:</p><div class="quotebox"><blockquote><div><p>&lt;domain type=&#039;kvm&#039;&gt;<br />&#160; &lt;name&gt;windows&lt;/name&gt;<br />&#160; &lt;uuid&gt;c8bc2373-6271-4810-991e-8618a0ee01d2&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;3145728&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;3145728&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &#160; &lt;loader type=&#039;rom&#039;&gt;/usr/share/qemu/bios.bin&lt;/loader&gt;<br />&#160; &#160; &lt;bootmenu enable=&#039;yes&#039; timeout=&#039;60000&#039;/&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;clock offset=&#039;utc&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/bin/qemu-wrapper&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;readonly/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; cache=&#039;directsync&#039; io=&#039;threads&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/var/lib/libvirt/images/windows.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;vda&#039; bus=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;0&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt;<br />&#160; &#160; &#160; &lt;master startport=&#039;4&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;1&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;sound model=&#039;ich6&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;rom bar=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x09da&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x0260&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;vendor id=&#039;0x09da&#039;/&gt;<br />&#160; &#160; &#160; &#160; &lt;product id=&#039;0x000e&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &lt;/hostdev&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&lt;/domain&gt;</p></div></blockquote></div><p>@Bronek<br />Of course, I know why your script didn&#039;t work for me: didn&#039;t load rom file for my card.</p><p>But when I try this:</p><div class="quotebox"><blockquote><div><p>&lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;rom file=&#039;/home/walkindude/hd6850.rom&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x15&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;</p></div></blockquote></div><p>and it&#039;s definitely there:</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ls /home/walkindude/hd6850.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />/home/walkindude/hd6850.rom</p></div></blockquote></div><p>it gives me</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; sudo virsh start windows&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />error: Failed to start domain windows<br />error: internal error: early end of file from monitor: possible problem:<br />2015-01-12T20:25:41.102985Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: pci_add_option_rom: failed to find romfile &quot;/home/walkindude/hd6850.rom&quot;<br />2015-01-12T20:25:41.235373Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: Device initialization failed.<br />2015-01-12T20:25:41.235447Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: Device &#039;vfio-pci&#039; could not be initialized</p></div></blockquote></div> <p class="postedit"><em>Last edited by walkindude (2015-01-12 20:26:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492489">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492525" class="blockpost roweven"> <h2><span><span class="conr">#3839</span> <a href="viewtopic.php?pid=1492525#p1492525">2015-01-12 22:46:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>@Bronek<br />Of course, I know why your script didn&#039;t work for me: didn&#039;t load rom file for my card.</p><p>But when I try this:</p><div class="quotebox"><blockquote><div><p>&lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;vfio&#039;/&gt;<br />&#160; &#160; &#160; &lt;source&gt;<br />&#160; &#160; &#160; &#160; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x03&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &#160; &lt;/source&gt;<br />&#160; &#160; &#160; &lt;rom file=&#039;/home/walkindude/hd6850.rom&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x15&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/hostdev&gt;</p></div></blockquote></div><p>and it&#039;s definitely there:</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ls /home/walkindude/hd6850.rom&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />/home/walkindude/hd6850.rom</p></div></blockquote></div><p>it gives me</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; sudo virsh start windows&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />error: Failed to start domain windows<br />error: internal error: early end of file from monitor: possible problem:<br />2015-01-12T20:25:41.102985Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: pci_add_option_rom: failed to find romfile &quot;/home/walkindude/hd6850.rom&quot;<br />2015-01-12T20:25:41.235373Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: Device initialization failed.<br />2015-01-12T20:25:41.235447Z qemu-system-x86_64: -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom: Device &#039;vfio-pci&#039; could not be initialized</p></div></blockquote></div></div></blockquote></div><br /><p>ok so my script uses &quot;vga.rom&quot; suffix in the filename to detect that VGA ROM is being loaded and by this it &quot;knows&quot; to append x-vga=on. If your filename suffix is different, or if you do not need to load VGA ROM (e.g because your computer&#039;s BIOS alread did this) then you can use some other distinguishing feature of VGA PCI device. Just run &quot;ps lfxww | grep qemu&quot;&#160; to find what your qemu options look like and then you will know what the script should be looking for</p> <p class="postedit"><em>Last edited by Bronek (2015-01-12 22:47:01)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492525">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492529" class="blockpost rowodd"> <h2><span><span class="conr">#3840</span> <a href="viewtopic.php?pid=1492529#p1492529">2015-01-12 23:09:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ps lfxww | grep qemu&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />0&#160; 1000&#160; 5944&#160; 1447&#160; &#160;5&#160; &#160;0&#160; 14256&#160; 2240 pipe_w S+&#160; &#160;pts/0&#160; &#160; &#160; 0:00&#160; |&#160; &#160; &#160; &#160;\_ grep qemu</p></div></blockquote></div><p>No qemu options there...</p><p>If I look in /var/log/libvirt/qemu/windows.log, I see</p><div class="quotebox"><blockquote><div><p>2015-01-12 23:01:43.682+0000: starting up<br />LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=none /usr/bin/qemu-wrapper -name windows -S -machine pc-i440fx-2.2,accel=kvm,usb=off -bios /usr/share/qemu/bios.bin -m 3072 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid c8bc2373-6271-4810-991e-8618a0ee01d2 -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/windows.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot menu=on,splash-time=60000,strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device lsi,id=scsi0,bus=pci.0,addr=0x8 -device ahci,id=ahci0,bus=pci.0,addr=0x9 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=1 -drive file=/var/lib/libvirt/images/windows.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=directsync,aio=threads -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x3,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=2 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -device vfio-pci,host=03:00.0,id=hostdev0,bus=pci.0,addr=0x15 -device usb-host,hostbus=4,hostaddr=2,id=hostdev1 -device usb-host,hostbus=4,hostaddr=3,id=hostdev2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=o</p></div></blockquote></div><p>As I wrote before, I use:</p><div class="quotebox"><blockquote><div><p>#!/bin/sh<br />exec qemu-system-x86_64 `echo &quot;\$@&quot; | sed &#039;s|03:00.0|03:00.0,x-vga=on|g&#039;`</p></div></blockquote></div><p>It indeed shows Seabios info on desired screen, I can choose boot device (so keyboard also working), but then turns black.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492529">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492548" class="blockpost roweven"> <h2><span><span class="conr">#3841</span> <a href="viewtopic.php?pid=1492548#p1492548">2015-01-13 00:49:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=37117">Japanlinux</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-05-18</span></dd> <dd><span>Posts: 173</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=37117">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve tried this process several times without the kernel+patches mentioned in the OP and I have determined that I do need the ACS patch to make this work. I then proceeded to download the kernel, makepkg and pacman -U the mainline, kernel, and headers xz files that it generated 2 hours later. However, I do not have that kernel installed (still using the same default one with no option to use the new during boot). So I must have done something wrong here. I&#039;d appreciate some help.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492548">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492558" class="blockpost rowodd"> <h2><span><span class="conr">#3842</span> <a href="viewtopic.php?pid=1492558#p1492558">2015-01-13 02:30:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Japanlinux<br />Maybe you should do</p><div class="quotebox"><blockquote><div><p>grub-mkconfig -o /boot/grub/grub.cfg</p></div></blockquote></div><p>?</p><p>Or something similar, if you have different bootloader</p> <p class="postedit"><em>Last edited by walkindude (2015-01-13 02:32:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492558">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492600" class="blockpost roweven"> <h2><span><span class="conr">#3843</span> <a href="viewtopic.php?pid=1492600#p1492600">2015-01-13 09:26:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>walkindude wrote:</cite><blockquote><div><p>@Bronek</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; ps lfxww | grep qemu&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />0&#160; 1000&#160; 5944&#160; 1447&#160; &#160;5&#160; &#160;0&#160; 14256&#160; 2240 pipe_w S+&#160; &#160;pts/0&#160; &#160; &#160; 0:00&#160; |&#160; &#160; &#160; &#160;\_ grep qemu</p></div></blockquote></div><p>No qemu options there...</p><p>If I look in /var/log/libvirt/qemu/windows.log, I see</p><div class="quotebox"><blockquote><div><p>2015-01-12 23:01:43.682+0000: starting up<br />LC_ALL=C PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin QEMU_AUDIO_DRV=none /usr/bin/qemu-wrapper -name windows -S -machine pc-i440fx-2.2,accel=kvm,usb=off -bios /usr/share/qemu/bios.bin -m 3072 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid c8bc2373-6271-4810-991e-8618a0ee01d2 -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/windows.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot menu=on,splash-time=60000,strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device lsi,id=scsi0,bus=pci.0,addr=0x8 -device ahci,id=ahci0,bus=pci.0,addr=0x9 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=1 -drive file=/var/lib/libvirt/images/windows.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=directsync,aio=threads -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x3,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=2 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -device vfio-pci,host=03:00.0,id=hostdev0,bus=pci.0,addr=0x15 -device usb-host,hostbus=4,hostaddr=2,id=hostdev1 -device usb-host,hostbus=4,hostaddr=3,id=hostdev2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=o</p></div></blockquote></div><p>As I wrote before, I use:</p><div class="quotebox"><blockquote><div><p>#!/bin/sh<br />exec qemu-system-x86_64 `echo &quot;\$@&quot; | sed &#039;s|03:00.0|03:00.0,x-vga=on|g&#039;`</p></div></blockquote></div><p>It indeed shows Seabios info on desired screen, I can choose boot device (so keyboard also working), but then turns black.</p></div></blockquote></div><p>I suppose you do not see all processes in your ps lfxww command because you are not running it as root. Make it &quot;ps alfxww&quot; to see your effective qemu command. Above shows that the call to wrapper is correct and I checked your wrapper, it should work. So you should see &quot;qemu-system-x86_64 . . . -device vfio-pci,host=03:00.0,<strong>x-vga=on</strong>,id=hostdev0,bus=pci.0,addr=0x15 . . .&quot; reported by ps</p><p>Looking at what you wrote earlier I would hazard a guess that you are not setting up permissions of libvirt relaxed enough to access all the devices it needs and the ROM file as well - this could explain &quot;pci_add_option_rom: failed to find romfile &quot;/home/walkindude/hd6850.rom&quot; . See <a href="https://bbs.archlinux.org/viewtopic.php?pid=1438076#p1438076" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 6#p1438076</a></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492600">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492725" class="blockpost rowodd"> <h2><span><span class="conr">#3844</span> <a href="viewtopic.php?pid=1492725#p1492725">2015-01-13 19:14:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I have difficuties enabling hugepages. I followed the arch wiki. </p><br /><p>First step ist to add this line to /etc/fstab:</p><div class="codebox"><pre><code>hugetlbfs /dev/hugepages hugetlbfs mode=1770,gid=78 0 0</code></pre></div><p>First Problem. It says, </p><div class="quotebox"><blockquote><div><p>gid must match that of the kvm group</p></div></blockquote></div><p>. How do I find out if the gids match? I have no clue ...</p><p>Then I mounted /dev/hugepages. No problem.</p><p>grep Hugepagesize /proc/meminfo shows:</p><div class="quotebox"><blockquote><div><p>[root@archkvm ~]# grep Hugepagesize /proc/meminfo<br />Hugepagesize:&#160; &#160; &#160; &#160;2048 kB</p></div></blockquote></div><p>Now: I want my guest Windows 8.1 to run with 10 GB RAM. If I undersood correctly, I should add half to /etc/sysctl.d/40-hugepage.conf. So I added this:</p><div class="quotebox"><blockquote><div><p>vm.nr_hugepages = 5120</p></div></blockquote></div><p>I am not sure about this though. My thought was: 10 GB equals 10*1024=10240. Half of it is 5120. </p><p>But when I start Windows and use the command &quot;grep HugePages /proc/meminfo&quot; it shows this:</p><div class="quotebox"><blockquote><div><p>[root@archkvm ~]# grep HugePages /proc/meminfo<br />AnonHugePages:&#160; &#160; 366592 kB<br /><strong>HugePages_Total:&#160; &#160; 5120<br />HugePages_Free:&#160; &#160; &#160; &#160; 0</strong><br />HugePages_Rsvd:&#160; &#160; &#160; &#160; 0<br />HugePages_Surp:&#160; &#160; &#160; &#160; 0</p></div></blockquote></div><p>I think it&#039;s pretty obvious I made a mistake. I think the allocation is wrong. Why does it show 0 for HugePages_Free? </p><br /><p>oh, and this is what I added to my XML:</p><div class="quotebox"><blockquote><div><p>&lt;memoryBacking&gt;<br />&#160; &#160; &lt;hugepages/&gt;<br /><strong>&#160; &#160; &lt;nosharepages/&gt;</strong><br />&#160; &lt;/memoryBacking&gt;</p></div></blockquote></div><p>I am also not sure about those line. Especially the nosharepages.</p><p>Can someone please help me?</p><br /><p>thank you very much.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492727" class="blockpost roweven"> <h2><span><span class="conr">#3845</span> <a href="viewtopic.php?pid=1492727#p1492727">2015-01-13 19:20:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Slabity wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>...long story short...<br />I&#039;ve finally flashed my cards with UEFI-compatible &quot;secret&quot;(i can&#039;t get it anywhere anymore) firmware, but appears like windows7 doesn&#039;t really works right with it. I turn off CSM, boot up the windows, it shows the splash logo and then image freezes. Yay for windows7. So, OVMF/UEFI and windows 7 is possible but troublesome, so most folks shouldn&#039;t bother about it.</p></div></blockquote></div><p>Have you had any further success with UEFI Windows 7? I&#039;m stuck at this flash screen as well, unfortunately.</p><p>No errors or messages, just a pulsing &quot;Starting Windows&quot; logo indefinitely on both the installation disk and a boot disk.</p></div></blockquote></div><p>My test Win7 VM booted and worked on OVMF-pure-efi image <strong>with emulated graphics</strong>.<br />But when i try to passthrough my GPU with romfile option, it doesn&#039;t work.</p><div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><p>Maybe I sould have said this earlier, AFAIK Windows 7 boots in UEFI mode, however doesn&#039;t support UEFI vbios. I remenber getting a boot error on bare metal when disabling CSM even If i was booting using UEFI mode.<br />If you can&#039;t use seabios or ovmf with csm (like me), use Win8+&#160; <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p></div></blockquote></div><p>Windows 7 boots and shows me that &quot;starting windows&quot; logo, BUT when it&#039;s time for some high-res video output through GOP, the image freezes on my bare metal hardware(with CSM disabled, of course) while system continues to boot. I can&#039;t make any valuable conclusions from that because i haven&#039;t tested booting Win8 on that hardware and my vbios is &quot;illegal&quot; - you can&#039;t get it anywhere anymore(yay for asus). But hang on a second, i&#039;ve got an idea..</p><p>There should be no &quot;boot errors&quot;, it&#039;s just the image output part.</p><p>It may be not so obvious, but to install windows on UEFI, you need to boot the UEFI-setup and use GPT on your disk. Only that way the windows installation cd will provide you EFI loader.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492727">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492730" class="blockpost rowodd"> <h2><span><span class="conr">#3846</span> <a href="viewtopic.php?pid=1492730#p1492730">2015-01-13 19:27:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi, I have difficuties enabling hugepages. I followed the arch wiki. </p><br /><p>First step ist to add this line to /etc/fstab:</p><div class="codebox"><pre><code>hugetlbfs /dev/hugepages hugetlbfs mode=1770,gid=78 0 0</code></pre></div><p>First Problem. It says, </p><div class="quotebox"><blockquote><div><p>gid must match that of the kvm group</p></div></blockquote></div><p>. How do I find out if the gids match? I have no clue ...</p><p>Then I mounted /dev/hugepages. No problem.</p></div></blockquote></div><p>I doubt the above is necessary, but then I don&#039;t use arch, so I don&#039;t know for sure.&#160; On Fedora hugetlbfs is already mounted and works, all that&#039;s necessary is to make sure there are some available.</p><div class="quotebox"><blockquote><div><p>grep Hugepagesize /proc/meminfo shows:</p><div class="quotebox"><blockquote><div><p>[root@archkvm ~]# grep Hugepagesize /proc/meminfo<br />Hugepagesize:&#160; &#160; &#160; &#160;2048 kB</p></div></blockquote></div><p>Now: I want my guest Windows 8.1 to run with 10 GB RAM. If I undersood correctly, I should add half to /etc/sysctl.d/40-hugepage.conf. So I added this:</p><div class="quotebox"><blockquote><div><p>vm.nr_hugepages = 5120</p></div></blockquote></div><p>I am not sure about this though. My thought was: 10 GB equals 10*1024=10240. Half of it is 5120. </p><p>But when I start Windows and use the command &quot;grep HugePages /proc/meminfo&quot; it shows this:</p><div class="quotebox"><blockquote><div><p>[root@archkvm ~]# grep HugePages /proc/meminfo<br />AnonHugePages:&#160; &#160; 366592 kB<br /><strong>HugePages_Total:&#160; &#160; 5120<br />HugePages_Free:&#160; &#160; &#160; &#160; 0</strong><br />HugePages_Rsvd:&#160; &#160; &#160; &#160; 0<br />HugePages_Surp:&#160; &#160; &#160; &#160; 0</p></div></blockquote></div><p>I think it&#039;s pretty obvious I made a mistake. I think the allocation is wrong. Why does it show 0 for HugePages_Free?</p></div></blockquote></div><p>Looks like what I would expect.&#160; You have 5120 hugepages, 0 are free, therefore you&#039;ve configured the system for exactly the number you need.&#160; Congrats.&#160; If you want further confirmation, look in top.&#160; The resident memory for the qemu process should be much smaller now since it doesn&#039;t include hugepages.</p><div class="quotebox"><blockquote><div><p>oh, and this is what I added to my XML:</p><div class="quotebox"><blockquote><div><p>&lt;memoryBacking&gt;<br />&#160; &#160; &lt;hugepages/&gt;<br /><strong>&#160; &#160; &lt;nosharepages/&gt;</strong><br />&#160; &lt;/memoryBacking&gt;</p></div></blockquote></div><p>I am also not sure about those line. Especially the nosharepages.</p></div></blockquote></div><p>Matches what I have.</p> <p class="postedit"><em>Last edited by aw (2015-01-13 19:28:15)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492730">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492733" class="blockpost roweven"> <h2><span><span class="conr">#3847</span> <a href="viewtopic.php?pid=1492733#p1492733">2015-01-13 19:33:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, that&#039;s it then? <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Great, I didn&#039;t know how to check. Very happy then <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>thank you!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492733">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492742" class="blockpost rowodd"> <h2><span><span class="conr">#3848</span> <a href="viewtopic.php?pid=1492742#p1492742">2015-01-13 20:17:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><p>Did as you&#039;d told me. Now it doesn&#039;t complain about rom file, but black screen after &quot;Booting from CD/DVD&quot; remains.</p><div class="quotebox"><blockquote><div><p>walkindude@Desktop&gt; sudo ps alfxww | grep qemu&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;~<br />0&#160; 1000&#160; 6602&#160; 1492&#160; &#160;4&#160; &#160;0&#160; 14256&#160; 2244 pipe_w S+&#160; &#160;pts/0&#160; &#160; &#160; 0:00&#160; &#160; &#160; &#160; &#160; |&#160; &#160;|&#160; &#160;\_ grep qemu<br />6&#160; &#160; &#160;0&#160; 5830&#160; &#160; &#160;1&#160; &#160;1&#160; &#160;0 4001136 3175140 poll_s SLl ?&#160; &#160; &#160; &#160; 0:52 qemu-system-x86_64 -name windows -S -machine pc-i440fx-2.2,accel=kvm,usb=off -bios /usr/share/qemu/bios.bin -m 3072 -realtime mlock=off -smp 4,sockets=4,cores=1,threads=1 -uuid c8bc2373-6271-4810-991e-8618a0ee01d2 -nographic -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/windows.monitor,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot menu=on,splash-time=60000,strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device lsi,id=scsi0,bus=pci.0,addr=0x8 -device ahci,id=ahci0,bus=pci.0,addr=0x9 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/home/walkindude/Downloads/JM1_CCSA_X64FRE_EN-US_DV5.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=1 -drive file=/var/lib/libvirt/images/windows.qcow2,if=none,id=drive-virtio-disk0,format=qcow2,cache=directsync,aio=threads -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x3,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=2 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -device vfio-pci,host=03:00.0,x-vga=on,id=hostdev0,bus=pci.0,addr=0x15,romfile=/home/walkindude/hd6850.rom -device usb-host,hostbus=4,hostaddr=2,id=hostdev1 -device usb-host,hostbus=4,hostaddr=3,id=hostdev2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on</p></div></blockquote></div><p>in dmesg</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA</p></div></blockquote></div><div class="quotebox"><blockquote><div><p>[&#160; 450.266194] vfio-pci 0000:03:00.0: enabling device (0000 -&gt; 0003)</p></div></blockquote></div><p>Tried with rom which I got from running Atiflash and also some roms from techPowerUp. Every time: black screen after Seabios and boot device choosing.</p><p>It&#039;s like I&#039;m missing something stupid or something big, dunno</p> <p class="postedit"><em>Last edited by walkindude (2015-01-13 20:57:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492742">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492763" class="blockpost roweven"> <h2><span><span class="conr">#3849</span> <a href="viewtopic.php?pid=1492763#p1492763">2015-01-13 21:09:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87990">Nanori</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-13</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87990">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi everyone,</p><p>I follow this topic for a long time in order to manage a VGA pass-through on an Nvidia GTX 760.</p><p>At this time, I&#039;m able to start my VM without errors from qemu but my screen seems to receve no signal from the card... :&#039;(<br />I&#039;ve perform a successful try with an ATI Radeon 5770 so I hope that isn&#039;t mean my GTX 760 doesn&#039;t support pass-through <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>Here is my configuration : <br />&#160; &#160;Host software configuraton (Fedora 21) :<br />&#160; &#160; &#160; &#160; &#160;kernel 3.17-300 without any patch (I&#039;ve try 3.18 with i915 patch but I&#039;ve get the save result)<br />&#160; &#160; &#160; &#160; &#160;cmdline : </p><div class="codebox"><pre><code> GRUB_CMDLINE_LINUX=&quot;rd.lvm.lv=fedora/swap rd.lvm.lv=fedora/root rhgb quiet intel_iommu=on \ vfio_iommu_type1.allow_unsafe_interrupts=1 \ kvm_intel.enable_apicv=1 \ kvm_intel.emulate_invalid_guest_state=0 \ kvm.allow_unsafe_assigned_interrupts=1 \ pci-stub.ids=10de:1187,10de:0e0a&quot;</code></pre></div><p>&#160; &#160; &#160; &#160; &#160;qemu 2.2.0 </p><p>&#160; &#160;Host GPU (IGD): </p><div class="codebox"><pre><code> 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller</code></pre></div><p>&#160; &#160;Guest GPU and attached audio device (GTX 760) : </p><div class="codebox"><pre><code> 01:00.0 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 760] 01:00.1 Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1)</code></pre></div><p>To run my VM, I use those commands :</p><div class="codebox"><pre><code>./vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><div class="codebox"><pre><code>qemu-system-x86_64 \ -enable-kvm -M q35 \ -vga none \ -m 4096 \ -boot menu=on \ -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device piix4-ide,bus=pcie.0,id=piix4-ide \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=${HOME}/MSI.GTX760.2048.140225.rom \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -hda ${HOME}/windowsDisk&quot;</code></pre></div><br /><p>After running this command, dmesg display those messages : </p><div class="codebox"><pre><code>[ 3843.261116] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 3849.124426] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><br /><p>Can someone give me a hand ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492763">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1492767" class="blockpost rowodd"> <h2><span><span class="conr">#3850</span> <a href="viewtopic.php?pid=1492767#p1492767">2015-01-13 21:24:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>/me beats head on desk... </p><p>If you&#039;re using Intel host graphics and VGA mode for the device, you need the i915 patch.&#160; If it didn&#039;t work for you, it&#039;s probably because you didn&#039;t enable it via the kernel commandline.</p><p>Most of your current kernel options are unnecessary.</p><p>And... since you have a Windows guest, don&#039;t use q35!</p><p>Better yet, use Windows8+ and OVMF.</p><p>Doesn&#039;t seem like you&#039;ve been following the thread very carefully...</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1492767">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=153">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=152">152</a> <a href="viewtopic.php?id=162768&amp;p=153">153</a> <strong>154</strong> <a href="viewtopic.php?id=162768&amp;p=155">155</a> <a href="viewtopic.php?id=162768&amp;p=156">156</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=155">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
