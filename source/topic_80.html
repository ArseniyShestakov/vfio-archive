<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 80) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=80" title="Page 80" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=79" title="Page 79" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=81" title="Page 81" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=79">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=78">78</a> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <strong>80</strong> <a href="viewtopic.php?id=162768&amp;p=81">81</a> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=81">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1422970" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1976</span> <a href="viewtopic.php?pid=1422970#p1422970">2014-06-06 13:39:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rman wrote:</cite><blockquote><div><p>Just wanted to chime in with another success story. It took me an entire weekend plus the following Monday, but I got my VGA passthrough setup fully functional! <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>Specs:<br />CPU: Core i5-4690<br />MB: ASRock H97m Pro 4<br />GPU 1: HD Graphics 4600 (used by Arch host)<br />GPU 2: AMD Radeon R7 265 (passed through to Windows 7)</p><p>The only patch I needed was the i915 arbiter patch. At first I used the 3.14 kernel from the OP, but I had some suspend to RAM issues, so I applied the patch against 3.15rc8 and it built and ran fine.</p><p>I cannot passthrough the Radeon&#039;s HDMI audio controller, or I get the dreaded atikmpag.sys BSOD. The VM is otherwise flawless though - I can even reboot it with absolutely no problems.</p><p>I had some issues with Qemu&#039;s emulated audio - Intel HDA was basically unusable with pops and static. I tried ac97, which worked much better, but I still had stuttering, noise, and choppiness. At that point I gave up and bought a USB sound card, which of course is working perfectly.</p><p>Anyway, thanks to everyone who contributed to this thread! It&#039;s good to know that this is still working with the latest GPU&#039;s. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Passing system&#039;s HD Audio works great too ;p</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1422970">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423013" class="blockpost roweven"> <h2><span><span class="conr">#1977</span> <a href="viewtopic.php?pid=1423013#p1423013">2014-06-06 15:56:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Alright I finally got it working with kernel 3.15rc8 and just the i915 patch. &lt;3<br />Here is a little benchmark I did, to test if it&#039;s working: <a href="http://www.3dmark.com/3dm11/8402985" rel="nofollow">http://www.3dmark.com/3dm11/8402985</a></p><p>Compared to other native benchmarks are the ~10% difference in performance not that bad.<br />My question, can I optimize/tweak my performance somehow?</p><p>Edit: Compared to other benchmarks, my graphics score is pretty decent! But my physicsscore is pretty low, so this means my cpu slows this down as it seems.. Can I optimize this?</p> <p class="postedit"><em>Last edited by shawly (2014-06-06 16:02:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423013">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423024" class="blockpost rowodd"> <h2><span><span class="conr">#1978</span> <a href="viewtopic.php?pid=1423024#p1423024">2014-06-06 16:41:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73933">rman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: United States</span></dd> <dd><span>Registered: 2013-08-08</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73933">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><p>Passing system&#039;s HD Audio works great too ;p</p></div></blockquote></div><p>I need audio for Linux too. <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> <div class="postsignature postmsg"><hr /><p><strong>Laptop:</strong> Lenovo L440, Intel Core i3-4000M, HD Graphics 4600<br /><strong>Desktop:</strong> Intel Core i5-4690, HD Graphics 4600, AMD Radeon R7 265 <em>(KVM VGA passthrough)</em></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423024">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423046" class="blockpost roweven"> <h2><span><span class="conr">#1979</span> <a href="viewtopic.php?pid=1423046#p1423046">2014-06-06 17:43:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82553">bpye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ben@curlybracket.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I think from what I&#039;ve read my planned configuration should work, but before I go switching out my 4670k for something else I want to check.</p><p>CPU: Intel 4670/Intel 4690k (both support vt-d but I have yet to choose)<br />MB: MSI GD45 Gaming<br />GPU1: Intel iGPU (used by Arch host)<br />GPU2: Nvidia GTX 560 Ti (used by Windows guest)</p><p>I believe this should work if I A. use the i915 vga arbitration patch and B. -cpu host,hv-time,kvm=off . Is there anything else I should need to do, or should that setup work okay? Additionally, is there any way to switch the keyboard/mouse from the host to guest with say a keyboard shortcut or will I require a KVM, I can already hook up my monitor to both cards and just use it&#039;s source button. Lastly, does QEMU&#039;s emulated audio work sufficiently?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423046">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423048" class="blockpost rowodd"> <h2><span><span class="conr">#1980</span> <a href="viewtopic.php?pid=1423048#p1423048">2014-06-06 17:51:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73933">rman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: United States</span></dd> <dd><span>Registered: 2013-08-08</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73933">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Additionally, is there any way to switch the keyboard/mouse from the host to guest with say a keyboard shortcut or will I require a KVM,</p></div></blockquote></div><p>You can use <a href="http://www.synergy-project.org" rel="nofollow">Synergy</a>, which will allow you to share the keyboard, mouse, and clipboard between the host and the VM.</p><div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Lastly, does QEMU&#039;s emulated audio work sufficiently?</p></div></blockquote></div><p>Not really. Buy a $5 USB sound card and pass that through.</p> </div> <div class="postsignature postmsg"><hr /><p><strong>Laptop:</strong> Lenovo L440, Intel Core i3-4000M, HD Graphics 4600<br /><strong>Desktop:</strong> Intel Core i5-4690, HD Graphics 4600, AMD Radeon R7 265 <em>(KVM VGA passthrough)</em></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423048">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423100" class="blockpost roweven"> <h2><span><span class="conr">#1981</span> <a href="viewtopic.php?pid=1423100#p1423100">2014-06-06 20:10:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I decided to format my windows 8.1 guest after it somehow got its bootloader corrupted. However, one thing that has always annoyed me is that I couldn&#039;t boot from my virtio-blk-pci disk, because seabios sees the HDDs attached to the SATA controller I passed through first. </p><p>So, I decided that instead of passing the controller, I could use virtio-scsi. It works great, seabios now orders the disks the way I want it; however I can&#039;t boot windows or even finish the setup this way. If I finish the setup with virtio-blk and later switch it to scsi-hd it BSODs with error code 0xc000021a. Linux installs fine (I tried it with Ubuntu, and everything works correctly including the video card).</p><p>Can anyone help me figure out what is wrong? Or at least tell me a way to have seabios boot from a disk other than the 1st, so I can stick with what works. I&#039;m running Arch with all of nbhs&#039;s packages and patches. Here is my config file:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -enable-kvm \ -machine type=q35,accel=kvm \ -m 24G \ -boot menu=on \ -cpu host,hv-time \ -smp 6,sockets=1,cores=3,threads=2 \ -mem-path /dev/hugepages \ -bios /usr/share/qemu/bios.bin \ -vga none \ -nographic \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/home/user/tahiti.rom \ -device vfio-pci,host=02:00.1,bus=pcie.0 \ -device virtio-scsi-pci,id=scsi \ -drive id=ssd,format=raw,discard=on,cache=none,file=/dev/virtual-machines/windows \ -drive id=hssd,format=raw,cache=none,file=/dev/sdc \ -device scsi-hd,drive=ssd \ -device scsi-block,drive=hssd \ -netdev bridge,br=br0,id=hostnet0 \ -device virtio-net-pci,netdev=hostnet0,id=net0,mac=00:16:3e:00:01:01 \ -device vfio-pci,host=08:00.0,bus=pcie.0 \ -qmp tcp:127.0.0.1:5555,server,nowait \</code></pre></div> <p class="postedit"><em>Last edited by Chetyre (2014-06-06 20:12:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423100">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423101" class="blockpost rowodd"> <h2><span><span class="conr">#1982</span> <a href="viewtopic.php?pid=1423101#p1423101">2014-06-06 20:13:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rman wrote:</cite><blockquote><div><div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Lastly, does QEMU&#039;s emulated audio work sufficiently?</p></div></blockquote></div><p>Not really. Buy a $5 USB sound card and pass that through.</p></div></blockquote></div><p>disagree. it depends on your requirements. for me it does its job almost flawlessly after some playing around with parameters (described details it in one of my posts earlier)</p><p>passing through distinct usb audio card is not viable if outputs from both host and guest systems are desired on the same audio out port</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423101">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423104" class="blockpost roweven"> <h2><span><span class="conr">#1983</span> <a href="viewtopic.php?pid=1423104#p1423104">2014-06-06 20:20:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>rman wrote:</cite><blockquote><div><div class="quotebox"><cite>bpye wrote:</cite><blockquote><div><p>Lastly, does QEMU&#039;s emulated audio work sufficiently?</p></div></blockquote></div><p>Not really. Buy a $5 USB sound card and pass that through.</p></div></blockquote></div><p>disagree. it depends on your requirements. for me it does its job almost flawlessly after some playing around with parameters (described details it in one of my posts earlier)</p><p>passing through distinct usb audio card is not viable if outputs from both host and guest systems are desired on the same audio out port</p></div></blockquote></div><p>Emulated audio works surprisingly well for me too.&#160; It&#039;s a little crackly when the VM starts up, but it&#039;s good after that and I&#039;ve done zero tuning for it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423104">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423106" class="blockpost rowodd"> <h2><span><span class="conr">#1984</span> <a href="viewtopic.php?pid=1423106#p1423106">2014-06-06 20:25:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82553">bpye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ben@curlybracket.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>rman wrote:</cite><blockquote><div><p>Not really. Buy a $5 USB sound card and pass that through.</p></div></blockquote></div><p>disagree. it depends on your requirements. for me it does its job almost flawlessly after some playing around with parameters (described details it in one of my posts earlier)</p><p>passing through distinct usb audio card is not viable if outputs from both host and guest systems are desired on the same audio out port</p></div></blockquote></div><p>Emulated audio works surprisingly well for me too.&#160; It&#039;s a little crackly when the VM starts up, but it&#039;s good after that and I&#039;ve done zero tuning for it.</p></div></blockquote></div><p>Thanks, it sounds like this is the solution I&#039;ve been looking for which is great. Probably going to go with the 4690 since I don&#039;t care for overclocking, my workload has changed since I&#039;ve built this PC.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423106">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423138" class="blockpost roweven"> <h2><span><span class="conr">#1985</span> <a href="viewtopic.php?pid=1423138#p1423138">2014-06-06 21:43:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>shawly wrote:</cite><blockquote><div><p>Alright I finally got it working with kernel 3.15rc8 and just the i915 patch. &lt;3<br />Here is a little benchmark I did, to test if it&#039;s working: <a href="http://www.3dmark.com/3dm11/8402985" rel="nofollow">http://www.3dmark.com/3dm11/8402985</a></p><p>Compared to other native benchmarks are the ~10% difference in performance not that bad.<br />My question, can I optimize/tweak my performance somehow?</p><p>Edit: Compared to other benchmarks, my graphics score is pretty decent! But my physicsscore is pretty low, so this means my cpu slows this down as it seems.. Can I optimize this?</p></div></blockquote></div><p>what is your current cpu config?<br />i run my i7 2600 with<br />-cpu Haswell,hv-time -smp 8,sockets=1,cores=8,threads=1 </p><p>i got about 98% of native.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423138">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423265" class="blockpost rowodd"> <h2><span><span class="conr">#1986</span> <a href="viewtopic.php?pid=1423265#p1423265">2014-06-07 08:12:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>what is your current cpu config?<br />i run my i7 2600 with<br />-cpu Haswell,hv-time -smp 8,sockets=1,cores=8,threads=1 </p><p>i got about 98% of native.</p></div></blockquote></div><p>Wow, thats impressive.<br />I got an Intel Xeon E3-1245v3 with -cpu host -smp 8,sockets=1,cores=4,threads=2 (I use libvirt to set up my vms and start them).</p><p>Btw, how do you guys all use an emulated soundcard? I wanna use that too but I don&#039;t know the parameter for qemu..</p><p>Edit: Got another little question, can I change the resolution of SeaBios? My windows Logo is so streched and I want it to show in 1920x1080px</p> <p class="postedit"><em>Last edited by shawly (2014-06-07 08:20:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423265">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423272" class="blockpost roweven"> <h2><span><span class="conr">#1987</span> <a href="viewtopic.php?pid=1423272#p1423272">2014-06-07 09:13:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I got an Intel Xeon E3-1245v3 with -cpu host -smp 8,sockets=1,cores=4,threads=2 (I use libvirt to set up my vms and start them).</p></div></blockquote></div><p>try changing cores=8 threads=1 </p><p>and cpu model</p> <p class="postedit"><em>Last edited by slis (2014-06-07 09:16:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423272">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423281" class="blockpost rowodd"> <h2><span><span class="conr">#1988</span> <a href="viewtopic.php?pid=1423281#p1423281">2014-06-07 09:54:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>try changing cores=8 threads=1 </p><p>and cpu model</p></div></blockquote></div><p>When I do this my Graphicsscore drops in 3DMark and my Physicsscore is slightly higher..<br />Bench with cores=4 threads=2: <a href="http://www.3dmark.com/3dm11/8402985" rel="nofollow">http://www.3dmark.com/3dm11/8402985</a><br />Bench with cores=8 threads=1: <a href="http://www.3dmark.com/3dm11/8405475" rel="nofollow">http://www.3dmark.com/3dm11/8405475</a></p><p>Other problem is, I played Bioshock Infinite but it&#039;s barely playable, my FPS drop every 5 secs and this is very frustrating... dunno what to do anymore..<br />My motivation sinks with every new problem I get and I almost believe it&#039;s not possible.. but I don&#039;t wanna switch back to windows (or dualboot) so I&#039;m stuck in a loop...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423283" class="blockpost roweven"> <h2><span><span class="conr">#1989</span> <a href="viewtopic.php?pid=1423283#p1423283">2014-06-07 10:01:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>strange... but same happend to me when i got my friends gtx 770 ... dota 2 had drops to 30fps.... but i didn&#039;t have much time to test it...<br />native average is 150fps with that gpu...</p><p>my 560ti works like native....</p><p>change drivers maybe? are u using 335?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423283">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423284" class="blockpost rowodd"> <h2><span><span class="conr">#1990</span> <a href="viewtopic.php?pid=1423284#p1423284">2014-06-07 10:09:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82246">shawly</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82246">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>strange... but same happend to me when i got my friends gtx 770 ... dota 2 had drops to 30fps.... but i didn&#039;t have much time to test it...<br />native average is 150fps with that gpu...</p><p>my 560ti works like native....</p><p>change drivers maybe? are u using 335?</p></div></blockquote></div><p>Yep I&#039;m using 335, but updating to 338 scares me, because the last time, my vm didn&#039;t boot anymore and I had to reinstall it.<br />But well, F it, I&#039;ll try installing 338 since I&#039;m slowly getting tired of this... it&#039;s now three weeks I&#039;ve been trying to get this work and now this..</p><p>Edit: Ok atleast updating to 338 didn&#039;t gave any problems, will now test again.<br />Edit2: Benchmark looks like this: <a href="http://www.3dmark.com/3dm11/8405620" rel="nofollow">http://www.3dmark.com/3dm11/8405620</a><br />But Bioshock is still lagging... Same happens in Magicka WIzard Wars, every 5-10 seconds it hangs for just a half sec, which is pretty annoying..</p> <p class="postedit"><em>Last edited by shawly (2014-06-07 10:45:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423284">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423322" class="blockpost roweven"> <h2><span><span class="conr">#1991</span> <a href="viewtopic.php?pid=1423322#p1423322">2014-06-07 14:17:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82554">chopsta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82554">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hallo,</p><p>when i boot the VM, i get a bsod and the machine restarts.<br />While the machine starts, the terminal output is: qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.1, no available reset mechanism.<br />qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.0, no available reset mechanism.</p><p>i have installed the newest Kernel 3.11.10-03111011-generic (Mainline).<br />I also installed newest version of qemu git (from git)</p><p>The VM-Config is:<br />qemu-system-x86_64 -enable-kvm -M q35 -drive file=/home/florian/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk -m 1024 -cpu host,hv-time,kvm=off \<br />-smp 1,sockets=1,cores=1,threads=1 \<br />-bios /usr/share/qemu/bios.bin \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</p><p>System: <br />CPU: AMD A8 6600K (IGP for host)<br />MB: Gigabyte (GA-F2A88XN-WIFI) Mini ITX AMD A88X (Iommu is supported an enabled)<br />GPU: NVidia 750ti (Guest)&#160; &#160; &#160; &#160; &#160; &#160; &#160; </p><p>dmesg |grep pci-stub shows:<br />[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-3.11.10-03111011-generic root=UUID=b301bc17-2fa2-43b9-968a-868a8aaa1954 ro vfio_iommu_type1.allow_unsafe_interrupts=1 quiet splash pci-stub.ids=10de:1380,10de:0fbc vt.handoff=7<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-3.11.10-03111011-generic root=UUID=b301bc17-2fa2-43b9-968a-868a8aaa1954 ro vfio_iommu_type1.allow_unsafe_interrupts=1 quiet splash pci-stub.ids=10de:1380,10de:0fbc vt.handoff=7<br />[&#160; &#160; 4.786007] pci-stub: add 10DE:1380 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 4.786019] pci-stub 0000:01:00.0: claimed by stub<br />[&#160; &#160; 4.786028] pci-stub: add 10DE:0FBC sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 4.786036] pci-stub 0000:01:00.1: claimed by stub<br />[&#160; &#160;70.981336] pci-stub 0000:01:00.0: claimed by stub<br />[&#160; &#160;70.981467] pci-stub 0000:01:00.1: claimed by stub</p><p>I hope, that someone of you can give me a hint.</p><p>Many thanks in advance.</p> <p class="postedit"><em>Last edited by chopsta (2014-06-07 15:12:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423322">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423347" class="blockpost rowodd"> <h2><span><span class="conr">#1992</span> <a href="viewtopic.php?pid=1423347#p1423347">2014-06-07 16:23:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chopsta wrote:</cite><blockquote><div><p>i have installed the newest Kernel 3.11.10-03111011-generic (Mainline).</p></div></blockquote></div><p>Not remotely the newest kernel.&#160; This may even be pre-bus reset support.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423347">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423377" class="blockpost roweven"> <h2><span><span class="conr">#1993</span> <a href="viewtopic.php?pid=1423377#p1423377">2014-06-07 18:58:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82554">chopsta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-06</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82554">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ok, have installed 3.15.8-RC8.</p><p>Terminal doesn&#039;t output anymore &quot;qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.0, no available reset mechanism.&quot;<br />The screen, which is connected to the graphics card, has no video input. <br />When i activate emulated vga, i get a BSOD.</p> <p class="postedit"><em>Last edited by chopsta (2014-06-07 20:32:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423377">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423409" class="blockpost rowodd"> <h2><span><span class="conr">#1994</span> <a href="viewtopic.php?pid=1423409#p1423409">2014-06-07 20:37:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chopsta wrote:</cite><blockquote><div><p>ok, have installed 3.15.8-RC8.</p><p>Terminal doesn&#039;t output anymore &quot;qemu-system-x86_64: vfio: Cannot reset device 0000:01:00.0, no available reset mechanism.&quot;<br />The screen, which is connected to the graphics card, has no video input. <br />When i activate emulated vga, i get a BSOD.</p></div></blockquote></div><p>You probably need this patch <a href="https://lkml.org/lkml/2014/5/25/94" rel="nofollow">https://lkml.org/lkml/2014/5/25/94</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423409">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423619" class="blockpost roweven"> <h2><span><span class="conr">#1995</span> <a href="viewtopic.php?pid=1423619#p1423619">2014-06-08 15:23:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>But Bioshock is still lagging... Same happens in Magicka WIzard Wars, every 5-10 seconds it hangs for just a half sec, which is pretty annoying..</p></div></blockquote></div><br /><p>can u try installing cpufreqd and force 100% in config on some profile and set it to that?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423619">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423645" class="blockpost rowodd"> <h2><span><span class="conr">#1996</span> <a href="viewtopic.php?pid=1423645#p1423645">2014-06-08 16:19:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82596">setedivento</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-08</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82596">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everybody, really great topic, thanks!</p><p>If only I could make things work. I seemed so close... may anyone help?<br />I am trying to vga passthrough an Nvidia Quadro 4000 on a Kubuntu 14.04 host machine. Reports indicate more than one here has coped, on Ubuntu based distros, so I&#039;ve decided to ask.</p><p>My problem is, to put it short, that when I launch the vm, I land in the qemu monitor console.<br />This is how I launch the vm:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 6,sockets=1,cores=6,threads=1 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 -drive file=/home/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk -drive file=/home/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd -boot d</code></pre></div><p>And this is the pci infos I get when I redirect the monitor console output to the standard output (by adding the &#039;-monitor stdio&#039; argument to the command above) and type &#039;info pci&#039; inside the console:</p><div class="codebox"><pre class="vscroll"><code>QEMU 2.0.0 monitor - type &#039;help&#039; for more information (qemu) info pci Bus 0, device 0, function 0: Host bridge: PCI device 8086:29c0 id &quot;&quot; Bus 0, device 1, function 0: Ethernet controller: PCI device 8086:100e IRQ 10. BAR0: 32 bit memory at 0xfe040000 [0xfe05ffff]. BAR1: I/O at 0xd000 [0xd03f]. BAR6: 32 bit memory at 0xffffffffffffffff [0x0003fffe]. id &quot;&quot; Bus 0, device 28, function 0: PCI bridge: PCI device 8086:3420 BUS 0. secondary bus 1. subordinate bus 1. IO range [0xc000, 0xcfff] memory range [0xfa000000, 0xfdffffff] prefetchable memory range [0xe8000000, 0xf7ffffff] id &quot;root.1&quot; Bus 1, device 0, function 0: VGA controller: PCI device 10de:06dd IRQ 10. BAR0: 32 bit memory at 0xfa000000 [0xfbffffff]. BAR1: 64 bit prefetchable memory at 0xe8000000 [0xefffffff]. BAR3: 64 bit prefetchable memory at 0xf0000000 [0xf3ffffff]. BAR5: I/O at 0xc000 [0xc07f]. BAR6: 32 bit memory at 0xffffffffffffffff [0x0007fffe]. id &quot;&quot; Bus 1, device 0, function 1: Audio controller: PCI device 10de:0be5 IRQ 10. BAR0: 32 bit memory at 0xfc080000 [0xfc083fff]. id &quot;&quot; Bus 0, device 31, function 0: ISA bridge: PCI device 8086:2918 id &quot;&quot; Bus 0, device 31, function 2: SATA controller: PCI device 8086:2922 IRQ 10. BAR4: I/O at 0xd080 [0xd09f]. BAR5: 32 bit memory at 0xfe060000 [0xfe060fff]. id &quot;&quot; Bus 0, device 31, function 3: SMBus: PCI device 8086:2930 IRQ 10. BAR4: I/O at 0xb100 [0xb13f]. id &quot;&quot;</code></pre></div><p>In particular,&#160; the entries:<br />&#039;VGA controller: PCI device 10de:06dd&#039; <br />&amp;<br />&#039;Audio controller: PCI device 10de:0be5&#039; <br />correctly represent the video card and its audio addresses, which makes me think they are bound to vfio and used.</p><p>There is no error, I just land in the monitor console!</p><p>By the way, if I launch the vm without the &#039;-vga none&#039; argument, the install iso (windows.iso) boots perfectly.</p><p>Provided that I am quite a newbie on the matter, this is what I&#039;ve done so far (a raw summary of the complete setup):<br />-- selected under system settings the amd fglrx video drivers for the primary amd video card (radeon hd 5770)<br />-- blacklisted i915,nouveau,nvidia for the nvidia quadro to passthrough<br />-- installed (through apt-get) the libvirt-bin, libvirt-doc, qemu and qemu-kvm packages<br />-- used the procedure available here <a href="http://www.redhat.com/archives/libvir-list/2013-March/msg00514.html" rel="nofollow">http://www.redhat.com/archives/libvir-l … 00514.html</a> to bind the gpu (had to do because when I launched the vm there was an error about missing /dev/vfio/15)<br />-- added &#039;/dev/vfio/15&#039; to cgroup_device_acl&#160; on /etc/libvirt/qemu.conf (as suggested by nbhs at post nr. #652, p. 27)<br />-- followed the guidelines for Ubuntu distros by GizmoChicken at post #430, p. 18, but just added the vga controller and its audio, to the devices list in /etc/vfio-pci.cfg (no other address)</p><p>What I am I doing wrong?</p><p>Thanks so much!!!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423645">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423690" class="blockpost roweven"> <h2><span><span class="conr">#1997</span> <a href="viewtopic.php?pid=1423690#p1423690">2014-06-08 18:51:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>setedivento wrote:</cite><blockquote><div><p>Hello everybody, really great topic, thanks!</p><p>If only I could make things work. I seemed so close... may anyone help?<br />I am trying to vga passthrough an Nvidia Quadro 4000 on a Kubuntu 14.04 host machine. Reports indicate more than one here has coped, on Ubuntu based distros, so I&#039;ve decided to ask.</p></div></blockquote></div><p>Full stop, you have a Quadro card and while it&#039;s not the version that NVIDIA supports for device assignment, it&#039;s hopefully close enough.&#160; Forget about Q35, -vga none, and x-vga=on, Quadro doesn&#039;t need any of that.&#160; Just add it to the VM as you would any other assigned device, you can even use virt-manager for it.&#160; Install using the emulated VGA.&#160; When you install the NVIDIA driver stack, the emulated VGA will be disabled and you&#039;ll automatically switch over to the Quadro card.&#160; We intend to support K-series Quadros on RHEL7 using this mode, but those cards are also known not to work with x-vga=on.&#160; K-series cards are Kepler based and yours I believe is Fermi based.&#160; Those are only one generation apart, so it will hopefully work.&#160; For others out there hoping their cheapy Quadro NVS cards can work like this, don&#039;t bet on it.</p><p>EDIT: The audio device on K-series Quadro is also known not to work and will not be supported for assignment on RHEL7.&#160; Try it, but expect it not to work.&#160; Just bind it to pci-stub and forget it&#039;s there.</p> <p class="postedit"><em>Last edited by aw (2014-06-08 19:02:15)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423690">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423721" class="blockpost rowodd"> <h2><span><span class="conr">#1998</span> <a href="viewtopic.php?pid=1423721#p1423721">2014-06-08 19:38:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82601">hell_n_back</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-08</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82601">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Been banging my head against a brick wall with this one.<br />I am beginning to think something just isn&#039;t capable with this, </p><p>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 6,sockets=1,cores=2,threads=1 -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on </p><p>All I Ever get is:<br />qemu-system-x86_64: -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device<br />qemu-system-x86_64: -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</p><p>and the iommu_group folders are no where to be found.</p><p>[root@nether ~]# dmesg | grep IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled</p><p>[root@nether ~]# uname -r<br />3.15.0-1-mainline</p><p>linux&#160; &#160;/vmlinuz-linux-mainline root=UUID=5995bbb5-119b-40fc-8206-4c4b75f76c19 rw intel_iommu=on pci-stub.ids=1002:6798,1002:aaa0,13f6:8788 quiet</p><p>[&#160; &#160; 0.486310] pci-stub: add 1002:6798 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 0.486319] pci-stub 0000:03:00.0: claimed by stub<br />[&#160; &#160; 0.486324] pci-stub: add 1002:AAA0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 0.486328] pci-stub 0000:03:00.1: claimed by stub<br />[&#160; &#160; 0.486329] pci-stub: add 13F6:8788 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 0.486333] pci-stub 0000:09:01.0: claimed by stub</p><br /><p>or even : <br />[root@nether ~]# qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host -smp 6,sockets=1,cores=2,threads=1 -bios /usr/share/qemu/bios.bin -vga none --device pci-assign,host=09:01.0&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;qemu-system-x86_64: --device pci-assign,host=09:01.0: No IOMMU found.&#160; Unable to assign device &quot;(null)&quot;<br />qemu-system-x86_64: --device pci-assign,host=09:01.0: Device initialization failed.<br />qemu-system-x86_64: --device pci-assign,host=09:01.0: Device &#039;kvm-pci-assign&#039; could not be initialized</p><p>Intel Core i7-2600K <br />Gigabyte : GA-Z68X-UD7-B3<br />ASUS R9280X-DC2T-3GD5 Radeon R9 280X (Passthrough device)<br />GeForce 9500 GT - Host GPU<br />HT Omega Claro - want to pass this through as well</p><p>lspci<br />00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller (rev 09)<br />00:01.0 PCI bridge: Intel Corporation Xeon E3-1200/2nd Generation Core Processor Family PCI Express Root Port (rev 09)<br />00:16.0 Communication controller: Intel Corporation 6 Series/C200 Series Chipset Family MEI Controller #1 (rev 04)<br />00:1a.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #2 (rev 05)<br />00:1c.0 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 1 (rev b5)<br />00:1c.1 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 2 (rev b5)<br />00:1c.2 PCI bridge: Intel Corporation 82801 PCI Bridge (rev b5)<br />00:1c.3 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 4 (rev b5)<br />00:1c.4 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 5 (rev b5)<br />00:1c.5 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 6 (rev b5)<br />00:1c.6 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 7 (rev b5)<br />00:1c.7 PCI bridge: Intel Corporation 6 Series/C200 Series Chipset Family PCI Express Root Port 8 (rev b5)<br />00:1d.0 USB controller: Intel Corporation 6 Series/C200 Series Chipset Family USB Enhanced Host Controller #1 (rev 05)<br />00:1f.0 ISA bridge: Intel Corporation Z68 Express Chipset Family LPC Controller (rev 05)<br />00:1f.2 SATA controller: Intel Corporation 6 Series/C200 Series Chipset Family SATA AHCI Controller (rev 05)<br />00:1f.3 SMBus: Intel Corporation 6 Series/C200 Series Chipset Family SMBus Controller (rev 05)<br />01:00.0 PCI bridge: NVIDIA Corporation NF200 PCIe 2.0 switch (rev a3)<br />02:00.0 PCI bridge: NVIDIA Corporation NF200 PCIe 2.0 switch (rev a3)<br />02:02.0 PCI bridge: NVIDIA Corporation NF200 PCIe 2.0 switch (rev a3)<br />02:03.0 PCI bridge: NVIDIA Corporation NF200 PCIe 2.0 switch (rev a3)<br />03:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT [Radeon HD 7970]<br />03:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Tahiti XT HDMI Audio [Radeon HD 7970 Series]<br />04:00.0 VGA compatible controller: NVIDIA Corporation G96 [GeForce 9500 GT] (rev a1)<br />07:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 06)<br />08:00.0 PCI bridge: Integrated Technology Express, Inc. Device 8892 (rev 10)<br />09:01.0 Multimedia audio controller: C-Media Electronics Inc CMI8788 [Oxygen HD Audio]<br />09:03.0 FireWire (IEEE 1394): Texas Instruments TSB43AB23 IEEE-1394a-2000 Controller (PHY/Link)<br />0a:00.0 USB controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 04)<br />0b:00.0 USB controller: NEC Corporation uPD720200 USB 3.0 Host Controller (rev 04)<br />0c:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 06)<br />0d:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9128 PCIe SATA 6 Gb/s RAID controller with HyperDuo (rev 11)<br />0e:00.0 SATA controller: Marvell Technology Group Ltd. 88SE9128 PCIe SATA 6 Gb/s RAID controller with HyperDuo (rev 11)</p><br /><p>Not sure if this is even worth continuing, I feel like something is just not compatible with it all<br />Anyone have any suggestions?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423721">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423722" class="blockpost roweven"> <h2><span><span class="conr">#1999</span> <a href="viewtopic.php?pid=1423722#p1423722">2014-06-08 19:43:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>hell_n_back wrote:</cite><blockquote><div><p>Intel Core i7-2600K</p></div></blockquote></div><p><a href="http://ark.intel.com/products/52214/Intel-Core-i7-2600K-Processor-8M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/52214/Int … o-3_80-GHz</a></p><p>Intel® Virtualization Technology for Directed I/O (VT-d):&#160; &#160; No</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423722">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1423747" class="blockpost rowodd"> <h2><span><span class="conr">#2000</span> <a href="viewtopic.php?pid=1423747#p1423747">2014-06-08 21:07:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82601">hell_n_back</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-08</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82601">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>hell_n_back wrote:</cite><blockquote><div><p>Intel Core i7-2600K</p></div></blockquote></div><p><a href="http://ark.intel.com/products/52214/Intel-Core-i7-2600K-Processor-8M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/52214/Int … o-3_80-GHz</a></p><p>Intel® Virtualization Technology for Directed I/O (VT-d):&#160; &#160; No</p></div></blockquote></div><br /><p>Well that is helpful.<br />Wish I had seen that page a few weeks ago.&#160; <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /></p><p>Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1423747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=79">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=78">78</a> <a href="viewtopic.php?id=162768&amp;p=79">79</a> <strong>80</strong> <a href="viewtopic.php?id=162768&amp;p=81">81</a> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=81">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
