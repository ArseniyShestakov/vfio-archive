<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 122) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=122" title="Page 122" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=121" title="Page 121" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=123" title="Page 123" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=121">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=120">120</a> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <strong>122</strong> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=123">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1468050" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3026</span> <a href="viewtopic.php?pid=1468050#p1468050">2014-10-20 23:22:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>From what I can gather from your posts, I believe - but am not certain - that what you meant was &quot;Setup B using SPICE for controlling the Windows VM from the Linux machine&quot;. Is that correct? If so, then you won&#039;t be able to use that for any GPU-heavy applications, since an emulated graphics card won&#039;t be even close to good enough to what you need for that, regardless of how good or bad SPICE is for streaming the video to you.</p></div></blockquote></div><p>Sorry for my lack of words (English isn&#039;t my native language <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />) , and yes , I meant setup B . Where I get to interact with the VM directly from the host or through an external client . I was wondering whether SPICE can offer a big performance improvement over regular VNC or RDP , and from what I saw on YT it&#039;s still somewhat laggy . Maybe this was off topic when it comes to GPU passthrough , but it can be a solution for web surfing , printing documents , and watching videos . (Especially when you lack PCI-E lanes to add more cards as I stated previously) .</p><p>Thank you <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>No problem, it isn&#039;t my first language either. Alright, setup B it is. Do you mind my asking what the reason is? Web surfing, printing, watching videos, and pretty much anything else that does not expicitly depend on Windows-exclusive programs can be done on the Linux host, as well. And Intel&#039;s IGP are a lot more powerful than some people think, so even 1080p videos should be no problem at all. However, if you really want to do all of that on Windows, why even install Linux as the host? Just have Windows as the host and Linux in a VM (if you need the Linux at all, that is).</p><p>In either case, I don&#039;t think you should see stuttering from host-side if you use the &quot;std&quot; emulated graphics card (unless you intend to watch something really heavy, like a 1080p video). You don&#039;t need any extra VNC, or RDP there either, just use the normal monitor window that opens when you start the VM (I think it uses VNC internally, but I&#039;m not sure). If you want to connect from a different, separate box, however, you might want to look into Steam Inhome-streaming. I&#039;ve read on several pages that you can highjack it to get back at the desktop (i.e. have the Windows-desktop streamed to the client) and then you can just use any application you want through that. See <a href="http://steamcommunity.com/groups/homestream/discussions/0/540731690675937539/" rel="nofollow">this discussion</a> for some ways to do that.</p></div></blockquote></div><p>Well , I can&#039;t get rid of Windows altogether for work reasons . I used to run Hyper-V and a Linux VM on top of that , but it wasn&#039;t good enough to run a ZFS file server . So I switched to a Linux host + ZFS server and a Windows VM . That made me sleep at night knowing my TBs of data are safer that way <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Plus , I want my linux box to be as headless as it can get <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;m pretty happy with my current GPU passthrough setup , except for the reboot issue .</p><p>I might look into Steam&#039;s streaming if my GT210 didn&#039;t work . I&#039;m just a little lazy to open that NORCO case and switch GPUs <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Thanks !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468050">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468051" class="blockpost roweven"> <h2><span><span class="conr">#3027</span> <a href="viewtopic.php?pid=1468051#p1468051">2014-10-20 23:25:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>I finally got it working !<br />The host display is on the laptop screen and the guest screen on the secondary screen. It works fine but I had some other duties to do so I couldn&#039;t finish my configuration right now but I will soon.</p><p>About the outputs ports, it&#039;s actually working on the hdmi. I will try on the VGA on next try.</p></div></blockquote></div><p>Well, I&#039;ll be. Sorry for posting some wrong information then, I was really convinced that it wouldn&#039;t work like that. Now I&#039;m kind of curious whether the HDMI port actually belongs to the dedicated card, or if the passed through dedicated card still communicates correctly with the IGP and the IGP then forwards the guest&#039;s video output to whatever happens to be connected as a secondary screen (the latter of which would imply some serious coding on the side of the Intel devs who wrote the driver code).</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>The DMAR message is still there, but it doesn&#039;t seem to be an issue. Actually, there is something relative to memory in the BIOS: in the &quot;Video (Intel IGD) Control Sub-Menu&quot;, there is a parameter &quot;Total Graphics Memory&quot; which can be set to 128MB, 256MB or MaxDVMT. Informations says: &quot;Select the amount of Total Graphics Memory - Pre-Allocated + Fixed + DVMT for use by the Intel Graphics Device&quot; As I&#039;m actually working with OpenGL, I thought it was the framebuffer memory and nothing related to the DMA Remapping.<br />Well, I&#039;m still wondering what that really means...</p><p>I&#039;ll try to get in touch with this Intel guy, he would certainly know about it.</p></div></blockquote></div><p>Intel IGPs don&#039;t have any dedicated (V)RAM on their own (unlike the GDDR RAM of modern dedicated graphics cards), since they are integrated into the CPU-chip. So when your system boots up a small portion of your actual, normal RAM gets reserved as VRAM for the integrated graphics card. This option should set the size of that reserved portion.</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>Yep, that&#039;s right, it bothered me a lot !</p><p>Anyway, thank you a lot for your time. I&#039;ll post again tomorrow to tell you if it&#039;s stable but the big part is done, know I&#039;m very satisfied and proud of my work. Gonna play with my new baby, hehe !</p><p>Have a nice day since then !</p></div></blockquote></div><p>Cool, do have fun with it, I know I have with my OVMF-Machine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468054" class="blockpost rowodd"> <h2><span><span class="conr">#3028</span> <a href="viewtopic.php?pid=1468054#p1468054">2014-10-20 23:37:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>Plus , I want my linux box to be as headless as it can get <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Hm, I would just use two separate boxes, one headless server box for all the data and one desktop box, but if you&#039;re happy with that, &quot;never change a running system&quot;, I guess *toothless grin*.</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>I&#039;m pretty happy with my current GPU passthrough setup , except for the reboot issue .</p></div></blockquote></div><p>Have you tried OVMF? That got rid of my problems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468054">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468055" class="blockpost roweven"> <h2><span><span class="conr">#3029</span> <a href="viewtopic.php?pid=1468055#p1468055">2014-10-20 23:48:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>Have you tried OVMF? That got rid of my problems.</p></div></blockquote></div><p>Yup , all of my VMs are now running on OVMF <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I expect it to be a hardware issue , propably the X99 platform is to be blamed . But my GTX770 VM is working flawlessly , so it might also be a GT610-specific issue . </p><p>I&#039;ll nail it when I try my other GT210 and see if I still have reboot issues .</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468075" class="blockpost rowodd"> <h2><span><span class="conr">#3030</span> <a href="viewtopic.php?pid=1468075#p1468075">2014-10-21 03:20:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78023">doubledr</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-26</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>The idea of using SPICE with a low-end thin client (maybe a thin client that costs less than a dedicated GPU) sounds good enough for web browsing and watching YouTube . It can also be a solution for those who don&#039;t have enough PCI-E lanes for more GPUs . But I watched it in action on a YT video , and it seems to stutter/lag . So it won&#039;t be a good replacement for GPU passthrough .</p></div></blockquote></div><p>Forgive me for being so blunt, but from my point of view you&#039;re still not answering my question about why you think about bringing in SPICE <em>as a replacement for a graphics card passthrough</em>. Please consider the following:</p><p>Setup A:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box and gets a graphics card passed through from the Linux host</p><p>Setup B:</p><p>- One hardware box<br />- Linux runs natively on that box<br />- Windows runs as a VM on that box with an emulated graphics card (for QEMU that would be any of std,cirrus,qxl,vmware,...)</p><p>Setup C:</p><p>- Two separate hardware boxes, connected by some network (e.g. 1Gbit Ethernet, Infiniband, whatever)<br />- Box 1 has a native Linux running<br />- Box 2 has a native Windows running</p><p>These are essentially your choices (very abstract). The statement &quot;SPICE with a low-end thin client&quot; does not specify which, though, since the native Linux in all three setups could be such a thin client.<br />SPICE, VNC, or any such protocol is about how you control - in this context - the Windows machine (regardless of whether you have one or two boxes); the Windows machine (regardless of whether it is being virtualised or not) will still need access to a real, dedicated graphics card (setups A and C). I know of no way aroung that. In the far future when XenGT has become something that can actually be done with NVIDIA and AMD graphics cards, we will have a way around that by paravirtualising our graphics card analogous to how Vt-x/AMD-V paravirtualise your processor. But that&#039;s still quite a bit away.</p><p>SPICE is by definition not a replacement for a graphics card passthrough, it&#039;s about remote control and can be done regardless of whether you&#039;re doing such a passthrough, which is why I was - and still am - so confused by your posts about this.</p><p>From what I can gather from your posts, I believe - but am not certain - that what you meant was &quot;Setup B using SPICE for controlling the Windows VM from the Linux machine&quot;. Is that correct? If so, then you won&#039;t be able to use that for any GPU-heavy applications, since an emulated graphics card won&#039;t be even close to good enough to what you need for that, regardless of how good or bad SPICE is for streaming the video to you.</p></div></blockquote></div><p>Sorry for my lack of words (English isn&#039;t my native language <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />) , and yes , I meant setup B . Where I get to interact with the VM directly from the host or through an external client . I was wondering whether SPICE can offer a big performance improvement over regular VNC or RDP , and from what I saw on YT it&#039;s still somewhat laggy . Maybe this was off topic when it comes to GPU passthrough , but it can be a solution for web surfing , printing documents , and watching videos . (Especially when you lack PCI-E lanes to add more cards as I stated previously) .</p><p>Thank you <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Right now only VMware, Microsoft, Xenserver and VirtualBox provide what you want. In kvm world... Forget it... Please wait another 3 years...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468075">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468091" class="blockpost roweven"> <h2><span><span class="conr">#3031</span> <a href="viewtopic.php?pid=1468091#p1468091">2014-10-21 06:16:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>doubledr wrote:</cite><blockquote><div><p>[......] Please wait another 3 years...</p></div></blockquote></div><p>I&#039;m in no hurry <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> My GPU passthrough setup is working good enough (for now) !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468091">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468225" class="blockpost rowodd"> <h2><span><span class="conr">#3032</span> <a href="viewtopic.php?pid=1468225#p1468225">2014-10-21 16:15:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86040">mouton_sanglant</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-20</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>I finally got it working !<br />The host display is on the laptop screen and the guest screen on the secondary screen. It works fine but I had some other duties to do so I couldn&#039;t finish my configuration right now but I will soon.</p><p>About the outputs ports, it&#039;s actually working on the hdmi. I will try on the VGA on next try.</p></div></blockquote></div><p>Well, I&#039;ll be. Sorry for posting some wrong information then, I was really convinced that it wouldn&#039;t work like that. Now I&#039;m kind of curious whether the HDMI port actually belongs to the dedicated card, or if the passed through dedicated card still communicates correctly with the IGP and the IGP then forwards the guest&#039;s video output to whatever happens to be connected as a secondary screen (the latter of which would imply some serious coding on the side of the Intel devs who wrote the driver code).</p></div></blockquote></div><p>Ok, I finished to configure my virtualized system. It&#039;s working fine with drivers installed inside host, played some games, no crashes ! Performances are &quot;passed-troughed&quot; just as expected !</p><p>Windows detects 2 displays, so it automatically enable extended desktop. One of these 2 displays can be disabled, however, the other one can&#039;t or I won&#039;t have any signal until I hit esc (to cancel action).<br />I ran some additionnal testings: can&#039;t pass through via the VGA cable, it duplicates the linux screen. So it seems to confirm what you pointed about the HDMI belongs to the dedicated card. I&#039;ll try someday to install a non-virtualized Windows on another HDD, disable the discrete card and plug a screen in the hdmi port.</p><br /><p>Now, I have to fix an issue on the host: I can&#039;t launch any Desktop Manager. I think it is because of the i915 vga arbiter patch which disable DRI. Is that right ?<br />Window Managers works, so I should use Mozilla and stuff like that as long as I disable any 3d acceleration stuff, right ?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Preparing the GPU so we can bind it to vfio</p><p>If you are using an intel IGP on your host, you need the i915 vga arbiter patch (this patch is included in the kernel i provided), and you need to add this kernel parameter to your bootloader:</p><p>i915.enable_hd_vgaarb=1</p><p>NOTE: This will disable DRI for you IGP!</p></div></blockquote></div><br /><p>[Edit]: I just disabled the kernel parameter &quot;i915.enable_hd_vgaarb=1&quot; in the bootloader and everything works fine. Is this patch fix performances issues or things like that ?</p> <p class="postedit"><em>Last edited by mouton_sanglant (2014-10-21 16:21:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468225">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468291" class="blockpost roweven"> <h2><span><span class="conr">#3033</span> <a href="viewtopic.php?pid=1468291#p1468291">2014-10-21 19:26:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>You <strong>need</strong> VirtIO drivers for Windows if you want to use VirtIO devices in a Windows guest, see <a href="http://www.linux-kvm.org/page/WindowsGuestDrivers/Download_Drivers" rel="nofollow">here</a>. If you want a direct download, you can grab the - currently - latest Fedora-compiled, signed VirtIO drivers for Windows <a href="http://alt.fedoraproject.org/pub/alt/virtio-win/archives/virtio-win-0.1-81/virtio-win-0.1-81.iso" rel="nofollow">here</a>. That is an iso file, so you have to add it to your machine <strong>without VirtIO, i.e. as a normal IDE drive</strong>, so Windows can find it (Adding &quot;-cdrom /path/to/virtio-win-0.1-81.iso&quot; to your qemu command should do it). Once you booted from the Windows installation disc and got to the part where the installer &quot;cannot find installation media&quot; you should be able to select &quot;Browse&quot; or something similar (cannot remember exactly what it is called), at which point you select the Win8 directory on the drive that corresponds to the virtio driver iso (should be the only CDROM drive at this point) and select all the VirtIO drivers that he shows you for installation. Afterwards, you should be able to continue the Windows installation normally.</p></div></blockquote></div><p>Ok, I&#039;m now on VirtIO.</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>I&#039;ve tried Steam InhomeStreaming from the guest VM directly to the Gentoo host (no real network card involved) with the Guest using a VirtIO network card (which is currently the best in performance AFAIK).<br />I had my left monitor show the actual output of the guest VM (connected to the passed-through graphics card) and the right monitor be the Host&#039;s Steam Inhome-Streaming client with the following results at 1080p@60Hz:<br />If the screen content stays nearly the same or is very slow moving, you&#039;re not going to see a difference <em>on average</em>. But I saw a significant difference with fast-moving content, There were many skipped frames, the FPS count plummeted from 60 down do 30. Also, regardless of whether it&#039;s fast or slow-moving content, I had spikes which had the Inhome-Streaming client lag as far behind as one second (the missing frames were then completly skipped to get to the current frames).<br />I have no experience with nVidia GameStream, but I doubt they have a solution for network spikes. If the above is something you can live with, then definitely go for it, but for me this was unbearable.</p></div></blockquote></div><p>And you are right again: I tested HomeStreaming with both e1000 and VirtIOnet and I confirm very annoying network spikes.<br />What about using a physical network card passed through with &quot;vfio-pci&quot;?<br />Beside that, the fact that I can stream a game means Windows can use the GTX 650 in some way (even if I&#039;m booting with &quot;-vga std&quot;).</p><div class="quotebox"><cite>Calrama wrote:</cite><blockquote><div><p>But regardless of the above two paragraphs, you might really want to get your passthrough to work on its own, before moving on to that stuff, because right now you&#039;re trying two things at the same time without having confirmed the first thing to be working properly.</p></div></blockquote></div><p>You absolutely right, I will try qemu-git ASAP (sorry, but right now I&#039;m very busy).</p><p>As always, thanks very much.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468291">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468339" class="blockpost rowodd"> <h2><span><span class="conr">#3034</span> <a href="viewtopic.php?pid=1468339#p1468339">2014-10-21 23:49:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>Ok, I finished to configure my virtualized system. It&#039;s working fine with drivers installed inside host, played some games, no crashes ! Performances are &quot;passed-troughed&quot; just as expected !</p><p>Windows detects 2 displays, so it automatically enable extended desktop. One of these 2 displays can be disabled, however, the other one can&#039;t or I won&#039;t have any signal until I hit esc (to cancel action).<br />I ran some additionnal testings: can&#039;t pass through via the VGA cable, it duplicates the linux screen. So it seems to confirm what you pointed about the HDMI belongs to the dedicated card. I&#039;ll try someday to install a non-virtualized Windows on another HDD, disable the discrete card and plug a screen in the hdmi port.</p></div></blockquote></div><p>That&#039;s quite an interesting design (thanks for the information), do post about it should go get around to it.</p><div class="quotebox"><cite>mouton_sanglant wrote:</cite><blockquote><div><p>Now, I have to fix an issue on the host: I can&#039;t launch any Desktop Manager. I think it is because of the i915 vga arbiter patch which disable DRI. Is that right ?<br />Window Managers works, so I should use Mozilla and stuff like that as long as I disable any 3d acceleration stuff, right ?</p></div></blockquote></div><p>I&#039;m afraid I cannot be of any help here, sorry. When I was still doing VGA-Passthrough, I always had full DRI-capabilities for my IGP and no problems at the host side other than sometimes my entire host system&#039;s input periphery completely freezing when booting the VM, even with the VGA-Arbitration patch and this kernel option active (despite the patch explicitly stating the opposite). But I never dug deep into this, since I moved on to OVMF to get rid of this freezing issue.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468339">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468342" class="blockpost roweven"> <h2><span><span class="conr">#3035</span> <a href="viewtopic.php?pid=1468342#p1468342">2014-10-22 00:18:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53258">Calrama</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Berlin</span></dd> <dd><span>Registered: 2011-10-14</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:moritzmaxeiner@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>And you are right again: I tested HomeStreaming with both e1000 and VirtIOnet and I confirm very annoying network spikes.</p></div></blockquote></div><p>One way to at least reduce that is to use hardware en- and decoding. To enable hardware encoding you need to install Geforce experience, click on the &quot;shadow play&quot; button in its GUI and flip the left-positioned virtual switch that they show in the new popup windows: Turn it on once, then off again. After that you will need to access the Inhome-Streaming options in Steam&#039;s settings (on the client), open up the advanced host settings, and enable hardware encoding (You might also want to set the same option on the VM&#039;s steam installation for good measure, but it shouldn&#039;t be necessary).</p><p>You might also try to set the client options to &quot;fast&quot; and set the bandwidth limit in the advanced client options to automatic (should it not already be set to it). I&#039;ve found that even with hardware en- and decoding I could still detect a slight difference between host and guest while inside an FPS, because the camera didn&#039;t rotate completely smoothly on the guest. Just enough that it would get me killed in multiplayer. The only way I could rid of any noticeable latency when Inhome-streaming through an emulated VirtIO network card was to limit the bandwith manually to 3Mbit, at which 1080p looks like someone threw several buckets full of different-coloured paint at my screen from the inside (and 720p is unacceptable to me).</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>What about using a physical network card passed through with &quot;vfio-pci&quot;?</p></div></blockquote></div><p>I do not own one, but I&#039;m going to try that out when I have enough time to make an informed decision about picking one.</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>Beside that, the fact that I can stream a game means Windows can use the GTX 650 in some way (even if I&#039;m booting with &quot;-vga std&quot;).</p></div></blockquote></div><p>It should. Just to be sure: You are able to stream regardless of whether your VM gets an emulated card or not (so both &quot;-vga none&quot; and &quot;-vga std&quot; work)?</p><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>You absolutely right, I will try qemu-git ASAP (sorry, but right now I&#039;m very busy).</p><p>As always, thanks very much.</p></div></blockquote></div><p>Happy to help.</p> <p class="postedit"><em>Last edited by Calrama (2014-10-22 00:18:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468342">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468480" class="blockpost rowodd"> <h2><span><span class="conr">#3036</span> <a href="viewtopic.php?pid=1468480#p1468480">2014-10-22 14:45:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Suddenly, i can not boot OVMF&#039;s built-in shell or start Windows8.1 installation CD in UEFI mode. There is just blank screen and a cursor on serial0, and nothing on any VGA or video output. I need OVMF to avoid IO_PAGE_FAULTS referring to my first GPU. The windows ISO checked to be correct and it does boot on real hardware.</p><p><a href="http://pastebin.com/9Wb3trV4" rel="nofollow">http://pastebin.com/9Wb3trV4</a></p><p>OVMF:20141021.b745.g8c83d0c<br />qemu 2.1.2<br />Fedora 21<br />Kernel 3.17.1-302.fc21.x86_64</p><p>Host Nvidia driver with vgaarb patch(though it shouldn&#039;t be needed anymore when using OVMF).</p><p>Two HD7750. romfile appear to be looking good, however, i couldn&#039;t update(ATIWinFlash just crashes after start, maybe i need drivers installed) it physically, so the ROMs in fact may be fake and broken. But if that&#039;s the case - asus support ticket should help me getting updated or getting the right ROMs.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-22 14:48:43)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468480">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468493" class="blockpost roweven"> <h2><span><span class="conr">#3037</span> <a href="viewtopic.php?pid=1468493#p1468493">2014-10-22 15:09:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Two HD7750. romfile appear to be looking good, however, i couldn&#039;t update(ATIWinFlash just crashes after start, maybe i need drivers installed) it physically, so the ROMs in fact may be fake and broken. But if that&#039;s the case - asus support ticket should help me getting updated or getting the right ROMs.</p></div></blockquote></div><p>Are you saying you have an ASUS Radeon HD7750 with UEFI support? Can I have that rom? Pretty please? My HD7750 is vga-only.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468493">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468516" class="blockpost rowodd"> <h2><span><span class="conr">#3038</span> <a href="viewtopic.php?pid=1468516#p1468516">2014-10-22 17:01:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Two HD7750. romfile appear to be looking good, however, i couldn&#039;t update(ATIWinFlash just crashes after start, maybe i need drivers installed) it physically, so the ROMs in fact may be fake and broken. But if that&#039;s the case - asus support ticket should help me getting updated or getting the right ROMs.</p></div></blockquote></div><p>Are you saying you have an ASUS Radeon HD7750 with UEFI support? Can I have that rom? Pretty please? My HD7750 is vga-only.</p></div></blockquote></div><p>You need an Asus motherboard(Almost any, but i&#039;m not sure about FM2(+) socket ones) and Asus HD7750. That way you are able to update it&#039;s bios.<br /><a href="http://www.asus.com/Graphics_Cards/HD7750T1GD5/HelpDesk_Download/" rel="nofollow">http://www.asus.com/Graphics_Cards/HD77 … _Download/</a><br /><a href="http://www.asus.com/Graphics_Cards/HD7750DCSL1GD5/HelpDesk_Download/" rel="nofollow">http://www.asus.com/Graphics_Cards/HD77 … _Download/</a></p><p>As for exact .rom files - that will be useless because:<br />1.I have DCSL, they&#039;re passive cooled and they were pretty rare. The clocks, voltage and Fan profiles(yes, you&#039;ve read it right, passively cooled GPU has fan profiles) are different on different models, and that may fry your card.<br />2.I took a diff out of two original romfiles, and we have a serial number in here. And something like CRC32-checksum in three bytes.. Don&#039;t know about the UEFI-capable ROM differences, but i&#039;ve copy-pasted the serial just in case it&#039;ll be checked somehow.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-22 17:03:23)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468533" class="blockpost roweven"> <h2><span><span class="conr">#3039</span> <a href="viewtopic.php?pid=1468533#p1468533">2014-10-22 18:47:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You need an Asus motherboard(Almost any, but i&#039;m not sure about FM2(+) socket ones) and Asus HD7750. That way you are able to update it&#039;s bios.</p></div></blockquote></div><p>That would be too easy. I don&#039;t have an ASUS motherboard. I downloaded the update utility. It&#039;s an .exe file. I haven&#039;t tried running it yet, but I guess it won&#039;t give me the .rom file easily. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I just wanted to run an EFI bios without flashing it.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>As for exact .rom files - that will be useless because:<br />1.I have DCSL, they&#039;re passive cooled and they were pretty rare. The clocks, voltage and Fan profiles(yes, you&#039;ve read it right, passively cooled GPU has fan profiles) are different on different models, and that may fry your card.<br />2.I took a diff out of two original romfiles, and we have a serial number in here. And something like CRC32-checksum in three bytes.. Don&#039;t know about the UEFI-capable ROM differences, but i&#039;ve copy-pasted the serial just in case it&#039;ll be checked somehow.</p></div></blockquote></div><p>Bummer. I certainly won&#039;t risk flashing a bios from any fanless design on my fanned HD7750-1GD5-V2. That being said, I don&#039;t think there is a serial number check in the GPU because some people even flash vbioses from different vendors (like the guy who commented on aw&#039;s blog about using Powercolor&#039;s bios on VTX3D&#039;s card). </p><p>I wish there was at least one EFI-capable vbios for HD7750 1GB DDR5 on TechPowerUP (all 51 of them are vga-only).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468533">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468616" class="blockpost rowodd"> <h2><span><span class="conr">#3040</span> <a href="viewtopic.php?pid=1468616#p1468616">2014-10-23 00:32:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86123">dtm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-22</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi Everyone,</p><p>Thanks for the fantastic thread, using it I have managed to get a fair way towards getting a working setup, at the same time breathing new life into my aging machine.</p><p>Specs:</p><p>Motherboard: Gigabyte GA-X58A-UD5 (w/VT-d enabled bios flashed)<br />CPU: Intel Xeon 5670<br />RAM: 12GB<br />Primary Video: Nvidia NVS 300<br />Passthrough Video: Nvidia GTX 570</p><p>I&#039;ve installed on Debian jessie (testing) with a stock 3.17.1 kernel, to which I have added a quirk in drivers/pci/quirks.c to get my Marvell 9128 SATA3 controller working properly:</p><div class="codebox"><pre><code>/* Declare this quirk for Marvell 9128 controller */ DECLARE_PCI_FIXUP_HEADER(PCI_VENDOR_ID_MARVELL_EXT, 0x9128, quirk_dma_func1_alias);</code></pre></div><p>I&#039;m running the versions of libvirt and qemu which are standard to debian jessie, i.e. qemu 2.1.2 and libvirt 1.2.8. I&#039;ve actually managed to get my video and USB3 controller bound and passed succesfully to a windows 8.1 virtual machine, and thus far it all seems to work well, although I am yet to do any benchmarking or performance testing.</p><p>The problem I&#039;m having is when I enable intel_iommu at boot, my onboard sound is disabled. I see the following messages in dmesg:</p><div class="codebox"><pre class="vscroll"><code>dmesg | grep -E &#039;(IOMMU|DMAR|1b\.0)&#039; [ 0.000000] ACPI: DMAR 0x00000000D7EDBF00 0000B0 (v01 IntelR AWRDACPI 322E3030 DRWA 00000002) [ 0.000000] Intel-IOMMU: enabled [ 0.023999] dmar: IOMMU 0: reg_base_addr fe711000 ver 1:0 cap c9008010e60262 ecap f0207a [ 0.024005] dmar: IOMMU 1: reg_base_addr fe710000 ver 1:0 cap c90780106f0462 ecap f020fe [ 0.364780] pci 0000:00:1b.0: [8086:3a3e] type 00 class 0x040300 [ 0.364794] pci 0000:00:1b.0: reg 0x10: [mem 0xfbff4000-0xfbff7fff 64bit] [ 0.364856] pci 0000:00:1b.0: PME# supported from D0 D3hot D3cold [ 0.364891] pci 0000:00:1b.0: System wakeup disabled by ACPI [ 3.854860] DMAR: No ATSR found [ 3.854903] IOMMU 0 0xfe711000: using Queued invalidation [ 3.854906] IOMMU 1 0xfe710000: using Queued invalidation [ 3.854907] IOMMU: Setting RMRR: [ 3.854921] IOMMU: Setting identity map for device 0000:00:1a.0 [0xd7ee0000 - 0xd7efffff] [ 3.854956] IOMMU: Setting identity map for device 0000:00:1a.1 [0xd7ee0000 - 0xd7efffff] [ 3.854983] IOMMU: Setting identity map for device 0000:00:1a.2 [0xd7ee0000 - 0xd7efffff] [ 3.855009] IOMMU: Setting identity map for device 0000:00:1a.7 [0xd7ee0000 - 0xd7efffff] [ 3.855035] IOMMU: Setting identity map for device 0000:00:1d.0 [0xd7ee0000 - 0xd7efffff] [ 3.855062] IOMMU: Setting identity map for device 0000:00:1d.1 [0xd7ee0000 - 0xd7efffff] [ 3.855088] IOMMU: Setting identity map for device 0000:00:1d.2 [0xd7ee0000 - 0xd7efffff] [ 3.855114] IOMMU: Setting identity map for device 0000:00:1d.7 [0xd7ee0000 - 0xd7efffff] [ 3.855132] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 3.855144] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 4.146418] AMD IOMMUv2 driver by Joerg Roedel &lt;joerg.roedel@amd.com&gt; [ 4.146419] AMD IOMMUv2 functionality not available on this system [ 8.116548] snd_hda_intel 0000:00:1b.0: irq 42 for MSI/MSI-X [ 8.120953] dmar: DMAR:[DMA Read] Request device [00:1b.0] fault addr ffff6000 DMAR:[fault reason 02] Present bit in context entry is clear [ 9.121162] snd_hda_intel 0000:00:1b.0: Codec #2 probe error; disabling it... [ 9.125612] dmar: DMAR:[DMA Read] Request device [00:1b.0] fault addr ffff6000 DMAR:[fault reason 02] Present bit in context entry is clear [ 14.140288] snd_hda_intel 0000:00:1b.0: no AFG or MFG node found [ 14.140307] snd_hda_intel 0000:00:1b.0: no codecs initialized</code></pre></div><p>If I boot without intel_iommu=on, then the codec is detected correctly and everything comes up OK. This is also the case if I boot with intel_iommu=pt, although in that case I do not see any IOMMU groups and attempting to bind devices using VFIO fails.</p><p>I was wondering if anyone had seen anything like this before or had any ideas as to what I might try to get my onboard sound working again?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468616">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468642" class="blockpost roweven"> <h2><span><span class="conr">#3041</span> <a href="viewtopic.php?pid=1468642#p1468642">2014-10-23 04:26:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Updated from 3.16 to&#160; 3.17.1-1 and now the vm skips. When I move the mouse or drag a window the mouse or window will freeze for a sec every few seconds. This happen to anyone else when they went to kernel 3.17?</p><p>Using X79 motherboard, 4930k cpu, and passing through an nvidia titan with a nvidia 670 on the host.</p><p>This happens using ovmf/1440FX as well as with bios/q35. Using qemu-git 2.2 and libvirt-git 1.2.9 and ovmf-svn 16214</p> <p class="postedit"><em>Last edited by kristopher004 (2014-10-23 04:29:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468642">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468711" class="blockpost rowodd"> <h2><span><span class="conr">#3042</span> <a href="viewtopic.php?pid=1468711#p1468711">2014-10-23 10:40:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You need an Asus motherboard(Almost any, but i&#039;m not sure about FM2(+) socket ones) and Asus HD7750. That way you are able to update it&#039;s bios.</p></div></blockquote></div><p>That would be too easy. I don&#039;t have an ASUS motherboard. I downloaded the update utility. It&#039;s an .exe file. I haven&#039;t tried running it yet, but I guess it won&#039;t give me the .rom file easily. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> I just wanted to run an EFI bios without flashing it.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>As for exact .rom files - that will be useless because:<br />1.I have DCSL, they&#039;re passive cooled and they were pretty rare. The clocks, voltage and Fan profiles(yes, you&#039;ve read it right, passively cooled GPU has fan profiles) are different on different models, and that may fry your card.<br />2.I took a diff out of two original romfiles, and we have a serial number in here. And something like CRC32-checksum in three bytes.. Don&#039;t know about the UEFI-capable ROM differences, but i&#039;ve copy-pasted the serial just in case it&#039;ll be checked somehow.</p></div></blockquote></div><p>Bummer. I certainly won&#039;t risk flashing a bios from any fanless design on my fanned HD7750-1GD5-V2. That being said, I don&#039;t think there is a serial number check in the GPU because some people even flash vbioses from different vendors (like the guy who commented on aw&#039;s blog about using Powercolor&#039;s bios on VTX3D&#039;s card). </p><p>I wish there was at least one EFI-capable vbios for HD7750 1GB DDR5 on TechPowerUP (all 51 of them are vga-only).</p></div></blockquote></div><p>TechPowerUp VBIOS database is outdated as hell. You can try asking asus support for exact ROMs. Or you can find some friends with somewhat decent new motherboard and windows on board.</p><p>As for the serial number - the driver may go crazy.</p><p>And you can also try running that asus thingie, it may give you ROM, but refuse to flash.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-23 11:20:01)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468711">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1468717" class="blockpost roweven"> <h2><span><span class="conr">#3043</span> <a href="viewtopic.php?pid=1468717#p1468717">2014-10-23 11:33:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Suddenly, i can not boot OVMF&#039;s built-in shell or start Windows8.1 installation CD in UEFI mode. There is just blank screen and a cursor on serial0, and nothing on any VGA or video output.</p></div></blockquote></div><p>Alright, i&#039;ve turned off GPU PT, got into shell, booted from file(win8.1&#039;s EFI loader), got a progress bar about &quot;loading files&quot; full, and then nothing anywhere. Something hints me i should have some graphics showing up, but there is no output.</p><p>After installing windows8 without OVMF, i&#039;m still unable to boot with gpu passthrough. Seems like the ROM files were broken, and something screws up badly. I guess i&#039;ll have to search for some other ASUS motherboard to update them physically.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-23 12:53:34)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1468717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469017" class="blockpost rowodd"> <h2><span><span class="conr">#3044</span> <a href="viewtopic.php?pid=1469017#p1469017">2014-10-24 07:47:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78023">doubledr</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-26</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><p>Hi guys!</p><p>Today I successfully hardmodded my GTX 680 to report itself as GRID K2.</p><p>When I try to passthrough the card, I get no output on either display outputs though. Nothing suspicious in the logs, just:</p><div class="codebox"><pre><code>Nov 24 20:19:42 cave-lin kernel: [ 368.001538] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Nov 24 20:19:42 cave-lin kernel: [ 368.001719] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Nov 24 20:20:20 cave-lin kernel: [ 405.590323] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>I havent changed anything since last time I run my config, except of device ID to assign to pci-stub during boot. Prior to that passthrough worked and I just wasnt able to install Nvidia drivers in guest.</p><p>Any advice?</p></div></blockquote></div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.&#160; However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Hi, aw.</p><p>I tried it today. Passing a real(not modded) Nvidia Grid k2 results in code 12 in my windows 2008 vm... Same as a Quadro 400... Look&#039;s like &quot;x-vga&quot; is a must...</p><p>l have some difficulty with libvirt. No matter what I did, if I start my vm with libvirt, I always get the &quot;Cannot allocate memory&quot; error. &quot;ulimit -l unlimited&quot; doesn&#039;t help at all... Is anyone have similar issue? Now I can only start my vm manually with a long qemu command <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469017">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469052" class="blockpost roweven"> <h2><span><span class="conr">#3045</span> <a href="viewtopic.php?pid=1469052#p1469052">2014-10-24 11:07:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=48315">TripleSpeeder</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-05-02</span></dd> <dd><span>Posts: 43</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=48315">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I want to start looking into using OVMF, but before spending too much time on it a quick check: Can anyone here confirm if the XFX HD7850 (Dual Dissipation edition) has support for UEFI/GOP? I alread asked XFX, but got no answer so far... <br />Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469052">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469056" class="blockpost rowodd"> <h2><span><span class="conr">#3046</span> <a href="viewtopic.php?pid=1469056#p1469056">2014-10-24 11:24:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You can try asking asus support for exact ROMs.</p></div></blockquote></div><p>Great idea! I contacted them and got the rom just now. :3</p><div class="codebox"><pre><code>./rom-parser 113-AD41300-123.bin Valid ROM signature found @0h, PCIR offset 224h PCIR: type 0, vendor: 1002, device: 683f, class: 030000 PCIR: revision 0, vendor revision: f20 Valid ROM signature found @10000h, PCIR offset 1ch PCIR: type 3, vendor: 1002, device: 683f, class: 030000 PCIR: revision 0, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div><p>It&#039;s time to give OVMF a try...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469056">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469057" class="blockpost roweven"> <h2><span><span class="conr">#3047</span> <a href="viewtopic.php?pid=1469057#p1469057">2014-10-24 11:25:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>TripleSpeeder wrote:</cite><blockquote><div><p>I want to start looking into using OVMF, but before spending too much time on it a quick check: Can anyone here confirm if the XFX HD7850 (Dual Dissipation edition) has support for UEFI/GOP? I alread asked XFX, but got no answer so far... <br />Thanks!</p></div></blockquote></div><p>Read this: <a href="http://vfio.blogspot.de/2014/08/does-my-graphics-card-rom-support-efi.html" rel="nofollow">http://vfio.blogspot.de/2014/08/does-my … t-efi.html</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469057">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469066" class="blockpost rowodd"> <h2><span><span class="conr">#3048</span> <a href="viewtopic.php?pid=1469066#p1469066">2014-10-24 12:17:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You can try asking asus support for exact ROMs.</p></div></blockquote></div><p>Great idea! I contacted them and got the rom just now. :3</p><div class="codebox"><pre><code>./rom-parser 113-AD41300-123.bin Valid ROM signature found @0h, PCIR offset 224h PCIR: type 0, vendor: 1002, device: 683f, class: 030000 PCIR: revision 0, vendor revision: f20 Valid ROM signature found @10000h, PCIR offset 1ch PCIR: type 3, vendor: 1002, device: 683f, class: 030000 PCIR: revision 0, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div><p>It&#039;s time to give OVMF a try...</p></div></blockquote></div><p>Please, mark if you manage to get that cards doing something more useful than powering down when passing the ROM via romfile=.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469066">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469091" class="blockpost roweven"> <h2><span><span class="conr">#3049</span> <a href="viewtopic.php?pid=1469091#p1469091">2014-10-24 13:37:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>doubledr wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>ilya80 wrote:</cite><blockquote><div><p>Hi guys!</p><p>Today I successfully hardmodded my GTX 680 to report itself as GRID K2.</p><p>When I try to passthrough the card, I get no output on either display outputs though. Nothing suspicious in the logs, just:</p><div class="codebox"><pre><code>Nov 24 20:19:42 cave-lin kernel: [ 368.001538] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) Nov 24 20:19:42 cave-lin kernel: [ 368.001719] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 Nov 24 20:20:20 cave-lin kernel: [ 405.590323] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>I havent changed anything since last time I run my config, except of device ID to assign to pci-stub during boot. Prior to that passthrough worked and I just wasnt able to install Nvidia drivers in guest.</p><p>Any advice?</p></div></blockquote></div><p>Did you also modify the VBIOS for the new device ID?&#160; If the VBIOS doesn&#039;t match the card seabios won&#039;t run it.&#160; However, with a K2 you can avoid all the craziness of VGA and pass the card to the guest as a secondary display.&#160; Pre-boot and early guest boot will happen on the emulated VGA.&#160; When the Nvidia driver is loaded the emulated VGA is disabled and the assigned device will take over.&#160; Use one of the standard emulated VGA devices and drop x-vga=on from the assigned device in your guest config.</p></div></blockquote></div><p>Hi, aw.</p><p>I tried it today. Passing a real(not modded) Nvidia Grid k2 results in code 12 in my windows 2008 vm... Same as a Quadro 400... Look&#039;s like &quot;x-vga&quot; is a must...</p></div></blockquote></div><p>Use 440FX not Q35</p><div class="quotebox"><blockquote><div><p>l have some difficulty with libvirt. No matter what I did, if I start my vm with libvirt, I always get the &quot;Cannot allocate memory&quot; error. &quot;ulimit -l unlimited&quot; doesn&#039;t help at all... Is anyone have similar issue? Now I can only start my vm manually with a long qemu command <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>If libvirt doesn&#039;t know you&#039;re doing device assignment it won&#039;t set your limits correctly.&#160; If you use 440FX instead of Q35 you don&#039;t need any qemu:commandline sections and should be allowing libvirt to manage everything.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469091">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1469169" class="blockpost rowodd"> <h2><span><span class="conr">#3050</span> <a href="viewtopic.php?pid=1469169#p1469169">2014-10-24 18:22:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Please, mark if you manage to get that cards doing something more useful than powering down when passing the ROM via romfile=.</p></div></blockquote></div><p>Well, I can confirm that this rom works in vga mode. I used it to load my standard Win7 VM. <br />EFI, on the other hand, is a pain. First I tried to install Win8.1 just with QXL, but OVMF can&#039;t load the installation DVD (no drivers for the UDF filesystem?). I copied the DVD to a fat32 partition and managed to get the loader running, but it still fails quite soon with &quot;can&#039;t find the media&quot; error (maybe the installation process looks for UDF and dies because there is fat32?). Anyway, just to test EFI vbios I tried connecting the GPU annnnnd... nothing. I get a black screen and 100% one core utilisation, can&#039;t see OVMF, can&#039;t get to Windows installer.</p><p>P.S. I noticed in gpuz that this new bios (ver 015.032) bumps the default core clock to 900MHz while the original bios (ver 015.014) sets default to 820MHz.</p> <p class="postedit"><em>Last edited by deniv (2014-10-24 18:26:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1469169">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=121">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=120">120</a> <a href="viewtopic.php?id=162768&amp;p=121">121</a> <strong>122</strong> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <a href="viewtopic.php?id=162768&amp;p=124">124</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=123">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
