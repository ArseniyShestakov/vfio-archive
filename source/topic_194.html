<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 194) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=194" title="Page 194" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=193" title="Page 193" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=195" title="Page 195" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=193">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <a href="viewtopic.php?id=162768&amp;p=193">193</a> <strong>194</strong> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=195">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1520749" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4826</span> <a href="viewtopic.php?pid=1520749#p1520749">2015-04-17 14:27:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@fseven: you can achieve a similar effect when doing -device virtio-blk-pci with drive /dev/sda or even /dev/sda4(but that will bork the partition table, as the VM will think it&#039;s a whole disk). If you poke windows and it&#039;s EFI-loader the right way, you may even boot baremetal from that partitions.</p><p>I have /dev/sda1 as 500~GB junkyard FS mounted to linux, and windows knows about it(since it has full /dev/sda), but neither OS can mount other&#039;s FS. Linux prevents you, windows doesn&#039;t do ext4.<br />There are some caching and scheduling issues present, but they don&#039;t affect the performance much.</p><p>I haven&#039;t heard any success-stories about dedicating a single port to some VM.</p></div></blockquote></div><p>Right now I&#039;m trying out the software raid method from the wiki, which seems to have quite passable performance (better with just the -hda option than with&#160; -device virtio-blk-pci).<br />The host can see and mount the partition as well (though not at once (well I haven&#039;t tried, but it wouldn&#039;t be smart anyways).).<br />There are a few tweaks (see here for example&#160; <a href="http://wiki.mikejung.biz/KVM_/_Xen?PageSpeed=noscript#Libvirt_and_QEMU_Performance_Tweaks_for_KVM_Guests)" rel="nofollow">http://wiki.mikejung.biz/KVM_/_Xen?Page … VM_Guests)</a> that might further improve performance, I&#039;m trying that next.</p><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Can you give some more details about &quot;poking windows and it´s EFI-loader the right way&quot;? <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /> Furthermore I would expect Windows to complain about changed chipset/driver mismatch and crashing, or is this an issue which doesn&#039;t exist in newer Windows versions?</p></div></blockquote></div><p>In my experience if you pass the complete disk, you can try booting but windows always bluescreened for me (no wonder I guess, it&#039;s quite a different environment.). I don&#039;t think it&#039;s possible to boot both directly from the disk and via Qemu.</p> <p class="postedit"><em>Last edited by fseven (2015-04-17 14:29:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520749">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520835" class="blockpost roweven"> <h2><span><span class="conr">#4827</span> <a href="viewtopic.php?pid=1520835#p1520835">2015-04-17 20:57:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Used to be with Windows XP &quot;hardware profiles&quot;, that you could dual boot a VM and bare metal from the same installation...as if you had a docking station.&#160; You had to have a patch to one of the .sys files if I recall correctly.&#160; Haven&#039;t tried 7+</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520835">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520838" class="blockpost rowodd"> <h2><span><span class="conr">#4828</span> <a href="viewtopic.php?pid=1520838#p1520838">2015-04-17 21:04:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve now tried a few games and the graphics performance is way below my expectation (CS:GO for example frequently drops below 20 fps at lowest settings).<br />The graphics driver is installed and the device (Radeon HD6850) passed through as primary.<br />Could someone point me in the right direction as to what I can do to increase graphics performance? I&#039;m reading as much of this thread as I can but 200 pages is a lot.<br />Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520838">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520847" class="blockpost roweven"> <h2><span><span class="conr">#4829</span> <a href="viewtopic.php?pid=1520847#p1520847">2015-04-17 21:35:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>I&#039;ve now tried a few games and the graphics performance is way below my expectation (CS:GO for example frequently drops below 20 fps at lowest settings).<br />The graphics driver is installed and the device (Radeon HD6850) passed through as primary.<br />Could someone point me in the right direction as to what I can do to increase graphics performance? I&#039;m reading as much of this thread as I can but 200 pages is a lot.<br />Thanks!</p></div></blockquote></div><p>Check the CPU. And disks. I&#039;ve sudden FPS drops when host heavily loads the hard drive, or spikes when host is changing CPU&#039;s frequency.<br />Dedicating(pinning) CPUs will help.</p><p>@mostlyharmless<br />In win7+ you do this same way as XP - enable the &quot;generic&quot; hard drive controller driver, boot up in a different environment and install the needed drivers. The system won&#039;t delete drivers for unplugged hardware, so you should be able to boot both ways.</p><br /><p>As for &quot;poking EFI loader the right way&quot; - usually that involves copying EFIVARS from bare metal to VM and modifying them to point to the same ESP(partition with EFI loader) in different environments.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-17 22:53:15)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520847">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520888" class="blockpost rowodd"> <h2><span><span class="conr">#4830</span> <a href="viewtopic.php?pid=1520888#p1520888">2015-04-17 23:26:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>I&#039;ve now tried a few games and the graphics performance is way below my expectation (CS:GO for example frequently drops below 20 fps at lowest settings).<br />The graphics driver is installed and the device (Radeon HD6850) passed through as primary.<br />Could someone point me in the right direction as to what I can do to increase graphics performance? I&#039;m reading as much of this thread as I can but 200 pages is a lot.<br />Thanks!</p></div></blockquote></div><p>Check the CPU. And disks. I&#039;ve sudden FPS drops when host heavily loads the hard drive, or spikes when host is changing CPU&#039;s frequency.<br />Dedicating(pinning) CPUs will help.</p><p>@mostlyharmless<br />In win7+ you do this same way as XP - enable the &quot;generic&quot; hard drive controller driver, boot up in a different environment and install the needed drivers. The system won&#039;t delete drivers for unplugged hardware, so you should be able to boot both ways.</p><br /><p>As for &quot;poking EFI loader the right way&quot; - usually that involves copying EFIVARS from bare metal to VM and modifying them to point to the same ESP(partition with EFI loader) in different environments.</p></div></blockquote></div><p>The link in the first post is broken, where can I read up on dedicating/pinning CPUs?</p> <p class="postedit"><em>Last edited by fseven (2015-04-17 23:28:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520888">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520897" class="blockpost roweven"> <h2><span><span class="conr">#4831</span> <a href="viewtopic.php?pid=1520897#p1520897">2015-04-18 00:04:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>fseven wrote:</cite><blockquote><div><p>I&#039;ve now tried a few games and the graphics performance is way below my expectation (CS:GO for example frequently drops below 20 fps at lowest settings).<br />The graphics driver is installed and the device (Radeon HD6850) passed through as primary.<br />Could someone point me in the right direction as to what I can do to increase graphics performance? I&#039;m reading as much of this thread as I can but 200 pages is a lot.<br />Thanks!</p></div></blockquote></div><p>Check the CPU. And disks. I&#039;ve sudden FPS drops when host heavily loads the hard drive, or spikes when host is changing CPU&#039;s frequency.<br />Dedicating(pinning) CPUs will help.</p><p>@mostlyharmless<br />In win7+ you do this same way as XP - enable the &quot;generic&quot; hard drive controller driver, boot up in a different environment and install the needed drivers. The system won&#039;t delete drivers for unplugged hardware, so you should be able to boot both ways.</p><br /><p>As for &quot;poking EFI loader the right way&quot; - usually that involves copying EFIVARS from bare metal to VM and modifying them to point to the same ESP(partition with EFI loader) in different environments.</p></div></blockquote></div><p>The link in the first post is broken, where can I read up on dedicating/pinning CPUs?</p></div></blockquote></div><p>Apart from ITT, you can read <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Virtualization_Tuning_and_Optimization_Guide/sect-Virtualization_Tuning_Optimization_Guide-Virt_Manager-CPU_Options.html#idp4270912" rel="nofollow">redhat&#039;s guide</a>. It&#039;s very useful when you&#039;re pursuiting high performance.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520897">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520911" class="blockpost rowodd"> <h2><span><span class="conr">#4832</span> <a href="viewtopic.php?pid=1520911#p1520911">2015-04-18 00:45:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90427">fkoehler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,<br />I have a problem. I guess this question came up before but I did not find it in the depths of this lengthy thread. I have been googleing and experimenting for many hours today and yesterday.&#160; Binding my AMD HD7870 works fine and everything else seems to be fine as well. If I do not use OVMF I can install Windows using vga std on my partition /dev/sda3. If I use vga none and OVMF I see the output on the screen that is connected to the dedicated GPU (which is absolutely correct) but the system does not boot and I end up on the interactive EFI shell (I do not know waht to do with it). Am I just stupid?</p><p>I am using ovmf-svn from the AUR and the following command to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win81 \ -enable-kvm \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -cpu host,kvm=off \ -smp 4,sockets=1 \ -m 8G \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/fabian/win81.iso,id=cd0,if=none \ -device scsi-cd,drive=cd0 \ -drive file=/home/fabian/virtio.iso,id=cd1,if=none \ -device ide-cd,bus=ide.1,drive=cd1 \ -drive file=/dev/sda3,id=disk0,format=raw,if=none \ -device scsi-hd,drive=disk0 \ -boot menu=on</code></pre></div><p>win81.iso is my Windows 8.1 x64 iso file and virtio.iso is the redhat iso with the virtio Windows drivers on it. /dev/sda3 is the drive I want to install Windows on.</p><p>Do you have any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520911">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1520974" class="blockpost roweven"> <h2><span><span class="conr">#4833</span> <a href="viewtopic.php?pid=1520974#p1520974">2015-04-18 10:20:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fkoehler wrote:</cite><blockquote><div><p>Hello,<br />I have a problem. I guess this question came up before but I did not find it in the depths of this lengthy thread. I have been googleing and experimenting for many hours today and yesterday.&#160; Binding my AMD HD7870 works fine and everything else seems to be fine as well. If I do not use OVMF I can install Windows using vga std on my partition /dev/sda3. If I use vga none and OVMF I see the output on the screen that is connected to the dedicated GPU (which is absolutely correct) but the system does not boot and I end up on the interactive EFI shell (I do not know waht to do with it). Am I just stupid?</p><p>I am using ovmf-svn from the AUR and the following command to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win81 \ -enable-kvm \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -cpu host,kvm=off \ -smp 4,sockets=1 \ -m 8G \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/fabian/win81.iso,id=cd0,if=none \ -device scsi-cd,drive=cd0 \ -drive file=/home/fabian/virtio.iso,id=cd1,if=none \ -device ide-cd,bus=ide.1,drive=cd1 \ -drive file=/dev/sda3,id=disk0,format=raw,if=none \ -device scsi-hd,drive=disk0 \ -boot menu=on</code></pre></div><p>win81.iso is my Windows 8.1 x64 iso file and virtio.iso is the redhat iso with the virtio Windows drivers on it. /dev/sda3 is the drive I want to install Windows on.</p><p>Do you have any ideas?</p></div></blockquote></div><p>Type exit or quit(whatever works) in the shell and you&#039;ll get into the interactive menu, where you&#039;ll find your way around.<br />The problem is - OVMF and windows are very picky about what type of controller you use to connect .iso images to the VM.<br /><a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a> suggests this way:</p><div class="codebox"><pre><code> # The Fedora installer disk appears as an IDE CD-ROM in the guest. This is # the 2nd boot option. OPTS=&quot;$OPTS -drive id=cd0,if=none,format=raw,readonly&quot; OPTS=&quot;$OPTS,file=Fedora-Live-Xfce-x86_64-20-1.iso&quot; OPTS=&quot;$OPTS -device ide-cd,bus=ide.1,drive=cd0,bootindex=1&quot;</code></pre></div><p>And you should connect virtio windows drivers iso(virtio.iso) in some similar way for windows to be able to use virtio.</p><p>P.S.<br />-cpu kvm=off is needed only for nvidia drivers which detect KVM and shut themselves down. Since you&#039;re using radeon, you can drop that line and <a href="http://blog.wikichoon.com/2014/07/enabling-hyper-v-enlightenments-with-kvm.html" rel="nofollow">activate hyper-v enlightenments</a> instead.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-18 10:22:39)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1520974">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521115" class="blockpost rowodd"> <h2><span><span class="conr">#4834</span> <a href="viewtopic.php?pid=1521115#p1521115">2015-04-18 22:28:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi,<br />when I want to use a newer version of the ovmf-svn package in my VM, is it possible to keep the part where the settings are stored in from the old build?</p><p>Thanks<br />apex</p></div></blockquote></div><p>The split files for OVMF have been implemented for exactly this reason. When you upgrade the OVMF package on the host, the firmware binary (OVMF_CODE.fd) and the varstore template (OVMF_VARS.fd) are both updated. The code part is expected to see a change (that&#039;s what motivates the release of an updated OVMF package in the first place). The OVMF_VARS.fd file (the varstore template) is not expected to change.</p><p>In any case, since your virtual machines use their private variable stores (which had been originally copied from the then-installed OVMF_VARS.fd file, and then modified by the individual virtual machines in different, individual ways, and are all located under /var/lib/libvirt/qemu/nvram/ in a libvirt setup), such an OVMF package upgrade affects the firmware binary for *all* virtual machines (that&#039;s the goal), and it affects the varstores of *no* virtual machines (that is also the goal). The &quot;new&quot; OVMF_VARS.fd file (if it changed during the update, but it really doesn&#039;t) would only affect virtual machines that you&#039;d *create* after the pkg update.</p><p>So, the short version is, if you use the split files (which you should), and your package maintainer is not doing crazy things (like changing from &quot;secure boot disabled build&quot; to &quot;secure boot enabled build&quot; in a simple package upgrade), then you should be all set; just upgrade the OVMF package and continue using your VM&#039;s own private varstore with the new binary.</p><p>(Note that I have no clue if &quot;ovmf-svn&quot; ships the split files.)</p><p>There&#039;s obviously one issue that needs to be mentioned here: what if the firmware binary (OVMF_CODE.fd) is modified in such a way that it becomes incompatible with the earlier varstore template (and consequently, with all individual varstores that had been instantiated from that earlier varstore template)? In that case the new package will (well... should!) install the firmware binary under a different name (ie. not OVMF_CODE.fd, but something else).</p><p>This way your old virtual machines won&#039;t even boot (because qemu won&#039;t find the central firmware binary under the original name), which is certainly favorable to crashing. There are two options then: either move your virtual machine to the new firmware (by deleting its old varstore, and creating the new varstore from the new template -- libvirt should do this for you automatically, if you delete the old varstore and also remove the nvram element from the domain XML), *or* you can keep the OVMF_CODE.fd file from the earlier package around, in a different location, and re-point the domain XML for all affected VMs to the new location of the old firmware binary.</p><p>If you pick option #1, then the VM will clearly lose its non-volatile variables. That should be no problem though, as described here:</p><p><a href="http://blog.uncooperative.org/blog/2014/02/06/the-efi-system-partition/" rel="nofollow">http://blog.uncooperative.org/blog/2014 … partition/</a></p><p>installed UEFI OSes have (... should have) a fallback utility on their ESPs that get loaded if everything else fails, and they should regenerate some sane Boot#### options.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521115">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521120" class="blockpost roweven"> <h2><span><span class="conr">#4835</span> <a href="viewtopic.php?pid=1521120#p1521120">2015-04-18 22:42:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fkoehler wrote:</cite><blockquote><div><p>Hello,<br />I have a problem. I guess this question came up before but I did not find it in the depths of this lengthy thread. I have been googleing and experimenting for many hours today and yesterday.&#160; Binding my AMD HD7870 works fine and everything else seems to be fine as well. If I do not use OVMF I can install Windows using vga std on my partition /dev/sda3. If I use vga none and OVMF I see the output on the screen that is connected to the dedicated GPU (which is absolutely correct) but the system does not boot and I end up on the interactive EFI shell (I do not know waht to do with it). Am I just stupid?</p><p>I am using ovmf-svn from the AUR and the following command to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win81 \ -enable-kvm \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -cpu host,kvm=off \ -smp 4,sockets=1 \ -m 8G \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/fabian/win81.iso,id=cd0,if=none \ -device scsi-cd,drive=cd0 \ -drive file=/home/fabian/virtio.iso,id=cd1,if=none \ -device ide-cd,bus=ide.1,drive=cd1 \ -drive file=/dev/sda3,id=disk0,format=raw,if=none \ -device scsi-hd,drive=disk0 \ -boot menu=on</code></pre></div><p>win81.iso is my Windows 8.1 x64 iso file and virtio.iso is the redhat iso with the virtio Windows drivers on it. /dev/sda3 is the drive I want to install Windows on.</p><p>Do you have any ideas?</p></div></blockquote></div><p>First, you&#039;re using the varstore *template* as the VM&#039;s private variable store. That&#039;s wrong. Please use libvirt, or else instantiate the VM&#039;s own varstore from the template manually. See the &quot;cp&quot; command in the wiki. <a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#QEMU_commands" rel="nofollow">https://wiki.archlinux.org/index.php/PC … U_commands</a></p><p>Second, I think your virtio-scsi setup may not be right.&#160; For -device scsi-hd and -device scsi-cd, I&#039;d add the bus=scsi.0 property.</p><p>Finally, add the bootindex=0 property to your scsi-hd device, and bootindex=1 to scsi-cd. (If your target disk is empty / unformatted, this is the most convenient setting.) Otherwise, reverse the order.</p><p>I&#039;d have to see your OVMF debug log (-debugcon file:debug.log -global isa-debugcon.iobase=0x402) to know more.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521120">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521121" class="blockpost rowodd"> <h2><span><span class="conr">#4836</span> <a href="viewtopic.php?pid=1521121#p1521121">2015-04-18 22:46:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=67633">wikavalier</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-01-22</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fkoehler wrote:</cite><blockquote><div><p>Hello,<br />I have a problem. I guess this question came up before but I did not find it in the depths of this lengthy thread. I have been googleing and experimenting for many hours today and yesterday.&#160; Binding my AMD HD7870 works fine and everything else seems to be fine as well. If I do not use OVMF I can install Windows using vga std on my partition /dev/sda3. If I use vga none and OVMF I see the output on the screen that is connected to the dedicated GPU (which is absolutely correct) but the system does not boot and I end up on the interactive EFI shell (I do not know waht to do with it). Am I just stupid?</p><p>I am using ovmf-svn from the AUR and the following command to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win81 \ -enable-kvm \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -cpu host,kvm=off \ -smp 4,sockets=1 \ -m 8G \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/fabian/win81.iso,id=cd0,if=none \ -device scsi-cd,drive=cd0 \ -drive file=/home/fabian/virtio.iso,id=cd1,if=none \ -device ide-cd,bus=ide.1,drive=cd1 \ -drive file=/dev/sda3,id=disk0,format=raw,if=none \ -device scsi-hd,drive=disk0 \ -boot menu=on</code></pre></div><p>win81.iso is my Windows 8.1 x64 iso file and virtio.iso is the redhat iso with the virtio Windows drivers on it. /dev/sda3 is the drive I want to install Windows on.</p><p>Do you have any ideas?</p></div></blockquote></div><p>I also spent many hours figuring out what I did wrong!!! But the thing is that you just need to type &quot;exit&quot; and an interactive menu will appear. Then select something like boot from file, search for the windows dvd and browse the EFI folder.</p><p>I cant exactly tell since you only need to do it for the installation. After that, it seems that the uefi knows from where to boot.</p><p>One question: is there any way to use the nvidia/nouveau drivers with vfio, like lxc or cgroups? I would like to passthrough and use the nvidia card for linux, not at the same time, but without rebooting</p><p>EDIT<br />hmmmmm.... perhaps kernel 4.0?</p> <p class="postedit"><em>Last edited by wikavalier (2015-04-19 00:10:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521121">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521267" class="blockpost roweven"> <h2><span><span class="conr">#4837</span> <a href="viewtopic.php?pid=1521267#p1521267">2015-04-19 14:00:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>wikavalier wrote:</cite><blockquote><div><p>One question: is there any way to use the nvidia/nouveau drivers with vfio, like lxc or cgroups? I would like to passthrough and use the nvidia card for linux, not at the same time, but without rebooting</p><p>EDIT<br />hmmmmm.... perhaps kernel 4.0?</p></div></blockquote></div><p>You can write up a small script which will unbind the devices from vfio-pci after the VM shutdown and bind them back to whatever thre driver you need.</p><p>You could make a systemd unit which binds the devices and runs the VM, and also shuts down the VM and rebinds the devices back on unit shutdown.<br />I think that may be possible to implement this via libvirt, but i&#039;m not sure.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521267">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521317" class="blockpost rowodd"> <h2><span><span class="conr">#4838</span> <a href="viewtopic.php?pid=1521317#p1521317">2015-04-19 16:49:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So I&#039;ve got a pretty simple stable instance running, not everything is tested for full performance.</p><p>Here is the script:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash #kvm opt=&#039;-enable-kvm &#039; #Memory opt+=&#039;-m 8192 &#039; #cpu opt+=&#039;-cpu host,kvm=off &#039; opt+=&#039;-smp 4,cores=2,threads=2,sockets=1 &#039; #vga #opt+=&#039;-vga qxl &#039; #gpu bind opt+=&#039;-device vfio-pci,host=01:00.0 &#039; #ovmf opt+=&#039;-drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd &#039; opt+=&#039;-drive if=pflash,format=raw,file=/vm/7_vars.fd &#039; #virtio scsi controller opt+=&#039;-device virtio-scsi-pci,id=scsi &#039; #disk opt+=&#039;-drive file=/dev/mapper/vmdisks-win7,id=disk,format=raw,if=none -device scsi-hd,drive=disk &#039; #virtio drivers #opt+=&#039;-drive file=/vm/virtio-win-0.1-100.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd &#039; #install cdrom #opt+=&#039;-cdrom /vm/X17-58997.iso &#039; qemu-system-x86_64 $opt</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521317">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521326" class="blockpost roweven"> <h2><span><span class="conr">#4839</span> <a href="viewtopic.php?pid=1521326#p1521326">2015-04-19 17:16:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=39767">Naruni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-08-05</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You can write up a small script which will unbind the devices from vfio-pci after the VM shutdown and bind them back to whatever thre driver you need.</p><p>You could make a systemd unit which binds the devices and runs the VM, and also shuts down the VM and rebinds the devices back on unit shutdown.<br />I think that may be possible to implement this via libvirt, but i&#039;m not sure.</p></div></blockquote></div><p>I tried that, and here&#039;s something I ran into (sorry for the funky column alignment):</p><div class="codebox"><pre><code>$echo &quot;0000:01:00.1&quot; &gt; /sys/bus/pci/drivers/vfio-pci/unbind $ls /sys/bus/pci/devices/0000\:01\:00.0/ boot_vga config device enable iommu_group local_cpus numa_node rescan resource1 resource3_wc subsystem uevent broken_parity_status consistent_dma_mask_bits dma_mask_bits firmware_node irq modalias power resource resource1_wc resource5 subsystem_device vendor class d3cold_allowed driver_override iommu local_cpulist msi_bus remove resource0 resource3 rom subsystem_vendor</code></pre></div><p>*Assumption disclaimer* There is no more driver file in the device&#039;s dir because pci-stub claimed it. So in order for the host to use it, the device would need to be bound to a vfio group and utilized by the host somehow? I&#039;ve some more testing to do since I would like the same thing wikavalier wants.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521326">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521336" class="blockpost rowodd"> <h2><span><span class="conr">#4840</span> <a href="viewtopic.php?pid=1521336#p1521336">2015-04-19 17:53:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You can write up a small script which will unbind the devices from vfio-pci after the VM shutdown and bind them back to whatever thre driver you need.</p><p>You could make a systemd unit which binds the devices and runs the VM, and also shuts down the VM and rebinds the devices back on unit shutdown.<br />I think that may be possible to implement this via libvirt, but i&#039;m not sure.</p></div></blockquote></div><p>I tried that, and here&#039;s something I ran into (sorry for the funky column alignment):</p><div class="codebox"><pre><code>$echo &quot;0000:01:00.1&quot; &gt; /sys/bus/pci/drivers/vfio-pci/unbind $ls /sys/bus/pci/devices/0000\:01\:00.0/ boot_vga config device enable iommu_group local_cpus numa_node rescan resource1 resource3_wc subsystem uevent broken_parity_status consistent_dma_mask_bits dma_mask_bits firmware_node irq modalias power resource resource1_wc resource5 subsystem_device vendor class d3cold_allowed driver_override iommu local_cpulist msi_bus remove resource0 resource3 rom subsystem_vendor</code></pre></div><p>*Assumption disclaimer* There is no more driver file in the device&#039;s dir because pci-stub claimed it. So in order for the host to use it, the device would need to be bound to a vfio group and utilized by the host somehow? I&#039;ve some more testing to do since I would like the same thing wikavalier wants.</p></div></blockquote></div><p>Whaat?<br />You do the unbind. Then you do lspci to be sure that you&#039;ve unbound your device.<br />And then you bind it to whatever driver you want.<br /><strong>pci-stub is a device driver too.</strong><br />It is needed only for safety reasons, to make sure device doesn&#039;t get grabbed by some crazy driver which is loaded before vfio-bind systemd unit is launched.<br />When the system is fully booted, you can unbind the device from all drivers and have no kernel driver loaded for it.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521336">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521388" class="blockpost roweven"> <h2><span><span class="conr">#4841</span> <a href="viewtopic.php?pid=1521388#p1521388">2015-04-19 20:06:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90427">fkoehler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>fkoehler wrote:</cite><blockquote><div><p>Hello,<br />I have a problem. I guess this question came up before but I did not find it in the depths of this lengthy thread. I have been googleing and experimenting for many hours today and yesterday.&#160; Binding my AMD HD7870 works fine and everything else seems to be fine as well. If I do not use OVMF I can install Windows using vga std on my partition /dev/sda3. If I use vga none and OVMF I see the output on the screen that is connected to the dedicated GPU (which is absolutely correct) but the system does not boot and I end up on the interactive EFI shell (I do not know waht to do with it). Am I just stupid?</p><p>I am using ovmf-svn from the AUR and the following command to start qemu:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -name win81 \ -enable-kvm \ -drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=/usr/share/ovmf/x64/ovmf_vars_x64.bin \ -cpu host,kvm=off \ -smp 4,sockets=1 \ -m 8G \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -vga none \ -device virtio-scsi-pci,id=scsi \ -drive file=/home/fabian/win81.iso,id=cd0,if=none \ -device scsi-cd,drive=cd0 \ -drive file=/home/fabian/virtio.iso,id=cd1,if=none \ -device ide-cd,bus=ide.1,drive=cd1 \ -drive file=/dev/sda3,id=disk0,format=raw,if=none \ -device scsi-hd,drive=disk0 \ -boot menu=on</code></pre></div><p>win81.iso is my Windows 8.1 x64 iso file and virtio.iso is the redhat iso with the virtio Windows drivers on it. /dev/sda3 is the drive I want to install Windows on.</p><p>Do you have any ideas?</p></div></blockquote></div><p>First, you&#039;re using the varstore *template* as the VM&#039;s private variable store. That&#039;s wrong. Please use libvirt, or else instantiate the VM&#039;s own varstore from the template manually. See the &quot;cp&quot; command in the wiki. <a href="https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF#QEMU_commands" rel="nofollow">https://wiki.archlinux.org/index.php/PC … U_commands</a></p><p>Second, I think your virtio-scsi setup may not be right.&#160; For -device scsi-hd and -device scsi-cd, I&#039;d add the bus=scsi.0 property.</p><p>Finally, add the bootindex=0 property to your scsi-hd device, and bootindex=1 to scsi-cd. (If your target disk is empty / unformatted, this is the most convenient setting.) Otherwise, reverse the order.</p><p>I&#039;d have to see your OVMF debug log (-debugcon file:debug.log -global isa-debugcon.iobase=0x402) to know more.</p></div></blockquote></div><p>Still having the UEFI issue. I am using vga=std to get everything to boot first. I made changes to my qemu start according to Duelist&#039;s and lersek&#039;s replies. My startup script is below. If I use an ubuntu iso it is getting detected automatically and I a land on the iso&#039;s grub (cannot boot as the kernel crashes for some reason). Tried archlinux iso which does not get detected. Therefore I type <em>exit</em> to get to the interactive menu where I go to <em>Boot Maintenance Manager</em> where the Archlinux iso was selectable I chose the x64 efi (pressed enter) but landed back on the <em>Boot Maintenance Manager</em> screen. My windows does not show up at all. <em>debug.log</em> is created but empty.</p><p>I also have another question that will only be relevant if I finally get it to work: using the vga=none graphics I get the output on another screen. To use mouse or keyboard I can give the vm control over the usb devices. But then there will be no way to switch it back to the host or will it?</p><br /><div class="codebox"><pre class="vscroll"><code>#!/bin/bash QEMU=qemu-system-x86_64 QEMU_OPTS=&quot;&quot; function add() { for opt in $*; do QEMU_OPTS+=&quot; ${opt}&quot; done } # name add &quot;-name win81&quot; # debug options add &quot;-debugcon file:debug.log -global isa-debugcon.iobase=0x402&quot; # enable kvm virtualization add &quot;-enable-kvm&quot; # UEFI via ovmf add &quot;-drive if=pflash,format=raw,readonly,file=/usr/share/ovmf/x64/ovmf_code_x64.bin&quot; add &quot;-drive if=pflash,format=raw,file=/tmp/ovmf_vars.bin&quot; # cpu add &quot;-cpu host,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time&quot; add &quot;-smp 4,sockets=1&quot; # memory add &quot;-m 8G&quot; # pci add &quot;-device vfio-pci,host=01:00.0&quot; add &quot;-device vfio-pci,host=01:00.1&quot; # graphics mode #add &quot;-vga none&quot; # scsi controller add &quot;-device virtio-scsi-pci,id=scsi&quot; # hard drives add &quot;-drive file=/dev/sda3,id=disk0,format=raw,if=none -device scsi-hd,drive=disk0,bus=scsi.0,bootindex=1&quot; # cd drives add &quot;-drive file=/home/fabian/win81.iso,id=cd0,if=none,format=raw,readonly -device ide-cd,bus=ide.1,drive=cd0,bootindex=0&quot; add &quot;-drive file=/home/fabian/virtio.iso,id=cd1,if=none,format=raw,readonly -device scsi-cd,bus=scsi.0,drive=cd1&quot; # usb #add &quot;-usb&quot; # logitech receiver #add &quot;-usbdevice host:046d:c52b&quot; # sound hardware # add &quot;-soundhw hda&quot; # boot opitions add &quot;-boot menu=on&quot; cp /usr/share/ovmf/x64/ovmf_vars_x64.bin /tmp/ovmf_vars.bin echo &quot;${QEMU} ${QEMU_OPTS}&quot; exec ${QEMU} ${QEMU_OPTS}</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521388">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521421" class="blockpost rowodd"> <h2><span><span class="conr">#4842</span> <a href="viewtopic.php?pid=1521421#p1521421">2015-04-19 21:48:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fkoehler wrote:</cite><blockquote><div><p>I also have another question that will only be relevant if I finally get it to work: using the vga=none graphics I get the output on another screen. To use mouse or keyboard I can give the vm control over the usb devices. But then there will be no way to switch it back to the host or will it?</p></div></blockquote></div><p>You can use -device qxl to make qemu provide you a small SDL-based surface for mouse and keyboard capturing purposes.<br />It won&#039;t show anything, and the device won&#039;t work, but who cares since we got the input.<br />In libvirt i have Graphics-&gt;VNC, and it gives me the same small window for same purposes.<br />Also, there is synergy and hardware KVM switches, spice and various stuff to try.<br />You could&#039;ve just make qemu&#039;s VNC server running and connect to it from the host.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521421">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521511" class="blockpost roweven"> <h2><span><span class="conr">#4843</span> <a href="viewtopic.php?pid=1521511#p1521511">2015-04-20 09:20:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, all:</p><p>my environment:<br />kernel: 3.18.6 with i915 patches.<br />qemu: 2.1.3<br />arch: Intel Xeon series<br />type: legacy VGA passthrough</p><p>There is a problem when I passthrough AMD HD7850 card to VM. the catd can passthrough successfully.<br />but when I installed driver, the vm crashed with follow error:<br />pcieport 0000:00:03.0: AER: Multiple Uncorrected (Fatal) error received: id=0000<br />vfio-pci 0000:04:00.0: PCIe Bus Error: severity=Uncorrected (Fatal), type=Unaccessible, id=0400(Unregistered Agent ID)<br />vfio-pci 0000:04:00.1: PCIe Bus Error: severity=Uncorrected (Fatal), type=Unaccessible, id=0401(Unregistered Agent ID)</p><p>qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.1) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.0) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.1) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest<br />qemu-kvm-passthrough: vfio_err_notifier_handler(0000:04:00.0) Unrecoverable error detected.&#160; Please collect any data possible and then kill the guest</p><p>If I just passthrough the VGA card, without hdmi audio, the VM worked well with driver. I don&#039;t know why, somebody can explain to me, thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521511">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521515" class="blockpost rowodd"> <h2><span><span class="conr">#4844</span> <a href="viewtopic.php?pid=1521515#p1521515">2015-04-20 09:38:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90486">acehege</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-20</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90486">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey everybody,</p><p>I have gotten KVM VGA-Passthrough to work using this awesome forum and all of your experiences, code snippets and comments.</p><p>BUT, everytime i reboot/shutdown a VM with my passed-through Nvidia Cards ( GT630 ), it gives me the dreaded &quot;Error 43&quot; code, and the only fix is to reboot the arch linux host.</p><p>--- Info ---</p><p>1. I am running the <a href="https://aur.archlinux.org/pkgbase/linux-vfio/" rel="nofollow"> linux-vfio kernel </a> from AUR</p><p>2. I have four identical <strong>Nvidia GT630</strong> cards</p><p>3. I am using <strong>OVFM</strong> in the VMs</p><p>4. The VMs are running <strong>Windows 8.1</strong></p><p>5. <strong>kvm=off</strong> is set.</p><p>6. I have tried with and without <strong>x-vga=on</strong></p><p>7. I have tried with and without the following in grub: <strong> pcie_acs_override=downstream i915.enable_hd_vgaarb=1 </strong></p><p>8. I have tried with virt-manager and also commandline qemu, same symptoms.</p><p>My current kernel version is 3.19.3.</p><p>--- /Info ---</p><p>Any help would be highly appreciated!</p><p>If any of you need more information or snippets from the system, just ask, and I will deliver <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521515">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521639" class="blockpost roweven"> <h2><span><span class="conr">#4845</span> <a href="viewtopic.php?pid=1521639#p1521639">2015-04-20 16:43:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90371">fseven</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-15</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:blubbing.blub@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You can use -device qxl to make qemu provide you a small SDL-based surface for mouse and keyboard capturing purposes.<br />It won&#039;t show anything, and the device won&#039;t work, but who cares since we got the input.<br />In libvirt i have Graphics-&gt;VNC, and it gives me the same small window for same purposes.<br />Also, there is synergy and hardware KVM switches, spice and various stuff to try.<br />You could&#039;ve just make qemu&#039;s VNC server running and connect to it from the host.</p></div></blockquote></div><p>I was wondering if it is technically possible to emulate a kvm switch? Kind of like attaching and detaching the usb device, but leaving the slot active (real kvm switches do something similar so you dont have to wait 10 seconds for windows to load the drivers every time). <br />Because the network based options arent&#039;t really ideal when latency is important and switching by attaching/detaching always takes a few seconds.</p> <p class="postedit"><em>Last edited by fseven (2015-04-20 16:45:03)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521639">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521674" class="blockpost rowodd"> <h2><span><span class="conr">#4846</span> <a href="viewtopic.php?pid=1521674#p1521674">2015-04-20 18:44:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>acehege wrote:</cite><blockquote><div><p>Hey everybody,</p><p>I have gotten KVM VGA-Passthrough to work using this awesome forum and all of your experiences, code snippets and comments.</p><p>BUT, everytime i reboot/shutdown a VM with my passed-through Nvidia Cards ( GT630 ), it gives me the dreaded &quot;Error 43&quot; code, and the only fix is to reboot the arch linux host.</p><p>--- Info ---</p><p>1. I am running the <a href="https://aur.archlinux.org/pkgbase/linux-vfio/" rel="nofollow"> linux-vfio kernel </a> from AUR</p><p>2. I have four identical <strong>Nvidia GT630</strong> cards</p><p>3. I am using <strong>OVFM</strong> in the VMs</p><p>4. The VMs are running <strong>Windows 8.1</strong></p><p>5. <strong>kvm=off</strong> is set.</p><p>6. I have tried with and without <strong>x-vga=on</strong></p><p>7. I have tried with and without the following in grub: <strong> pcie_acs_override=downstream i915.enable_hd_vgaarb=1 </strong></p><p>8. I have tried with virt-manager and also commandline qemu, same symptoms.</p><p>My current kernel version is 3.19.3.</p><p>--- /Info ---</p><p>Any help would be highly appreciated!</p><p>If any of you need more information or snippets from the system, just ask, and I will deliver <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Have you tried loading your gpu rom with the romfile= parameter? check out this post <a href="https://bbs.archlinux.org/viewtopic.php?pid=1511177#p1511177" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 7#p1511177</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521674">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521678" class="blockpost roweven"> <h2><span><span class="conr">#4847</span> <a href="viewtopic.php?pid=1521678#p1521678">2015-04-20 19:05:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89045">akawoz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-22</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:wsh@warrenhughes.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Great success here - my gear / versions list.</p><p>Any questions please let me know - been battling this for ages.</p><p>Hardware:<br />Asrock 990FX Extreme9<br />AMD FX-8370 8-core CPU<br />32GB DDR3<br />1x GeForce GT 730 (host)<br />1x GeForce GTX 960 (VM)<br />1x Renasas 4x USB 3 PCIe 1x (VM)<br />no overclocking or special BIOS changes except:<br />IO-MMU=ON<br />USB 3 legacy support = OFF</p><p>Host OS:<br />Arch Linux stable repos<br />Kernel 3.19.3-3-vfio from: <a href="https://aur.archlinux.org/packages/linux-vfio/" rel="nofollow">https://aur.archlinux.org/packages/linux-vfio/</a><br />No patches</p><p>Guest OS:<br />Windows 8.1 x64<br />Latest NVIDIA Experience drivers</p><p>[root@cloud ~]# lspci<br />00:00.0 Host bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx0 port B) (rev 02)<br />00:00.2 IOMMU: Advanced Micro Devices, Inc. [AMD/ATI] RD990 I/O Memory Management Unit (IOMMU)<br />00:02.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port B)<br />00:04.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port D)<br />00:05.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port E)<br />00:06.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port F)<br />00:07.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (PCI express gpp port G)<br />00:0a.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx1 port A)<br />00:0b.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (NB-SB link)<br />00:0c.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890S PCI Express bridge for GPP2 port 1<br />00:0d.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] RD890 PCI to PCI bridge (external gfx1 port B)<br />00:11.0 SATA controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 SATA Controller [AHCI mode] (rev 40)<br />00:12.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller<br />00:12.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller<br />00:13.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller<br />00:13.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller<br />00:14.0 SMBus: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 SMBus Controller (rev 42)<br />00:14.1 IDE interface: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 IDE Controller (rev 40)<br />00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 Azalia (Intel HDA) (rev 40)<br />00:14.3 ISA bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 LPC host controller (rev 40)<br />00:14.4 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SBx00 PCI to PCI Bridge (rev 40)<br />00:14.5 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI2 Controller<br />00:15.0 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB700/SB800/SB900 PCI to PCI bridge (PCIE port 0)<br />00:15.2 PCI bridge: Advanced Micro Devices, Inc. [AMD/ATI] SB900 PCI to PCI bridge (PCIE port 2)<br />00:16.0 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB OHCI0 Controller<br />00:16.2 USB controller: Advanced Micro Devices, Inc. [AMD/ATI] SB7x0/SB8x0/SB9x0 USB EHCI Controller<br />00:18.0 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 0<br />00:18.1 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 1<br />00:18.2 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 2<br />00:18.3 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 3<br />00:18.4 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 4<br />00:18.5 Host bridge: Advanced Micro Devices, Inc. [AMD] Family 15h Processor Function 5<br />01:00.0 VGA compatible controller: NVIDIA Corporation GK208 [GeForce GT 730] (rev a1)<br />01:00.1 Audio device: NVIDIA Corporation GK208 HDMI/DP Audio Controller (rev a1)<br />02:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)<br />03:00.0 USB controller: Etron Technology, Inc. EJ188/EJ198 USB 3.0 Host Controller<br />04:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)<br />05:00.0 USB controller: Etron Technology, Inc. EJ188/EJ198 USB 3.0 Host Controller<br />06:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03)<br />07:00.0 VGA compatible controller: NVIDIA Corporation GM206 [GeForce GTX 960] (rev a1)<br />07:00.1 Audio device: NVIDIA Corporation Device 0fba (rev a1)<br />08:00.0 Ethernet controller: Intel Corporation 82575EB Gigabit Network Connection (rev 02)<br />08:00.1 Ethernet controller: Intel Corporation 82575EB Gigabit Network Connection (rev 02)<br />09:00.0 Serial Attached SCSI controller: LSI Logic / Symbios Logic SAS2008 PCI-Express Fusion-MPT SAS-2 [Falcon] (rev 03)<br />0b:00.0 FireWire (IEEE 1394): VIA Technologies, Inc. VT6315 Series Firewire Controller (rev 01)<br />0c:00.0 Ethernet controller: Intel Corporation 82583V Gigabit Network Connection</p><p>[root@cloud ~]# cat /etc/mkinitcpio.conf<br /># vim:set ft=sh<br /># MODULES<br /># The following modules are loaded before any boot hooks are<br /># run.&#160; Advanced users may wish to specify all system modules<br /># in this array.&#160; For instance:<br />#&#160; &#160; &#160;MODULES=&quot;piix ide_disk reiserfs&quot;<br />MODULES=&quot;nouveau pci-stub btrfs&quot;</p><p>[root@cloud ~]# cat /etc/default/grub<br />GRUB_DEFAULT=0<br />GRUB_TIMEOUT=5<br />GRUB_DISTRIBUTOR=&quot;Arch&quot;<br />GRUB_CMDLINE_LINUX_DEFAULT=&quot;amd_iommu=on iommu=noagp pci-stub.ids=10de:1401,10de:0fba,1912:0014&quot;</p><p>[root@cloud qemu]# cat gpu-bios2.xml<br />&lt;!--<br />WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE<br />OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:<br />&#160; virsh edit gpu-bios2<br />or other application using the libvirt API.<br />--&gt;</p><p>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt;<br />&#160; &lt;name&gt;gpu-bios2&lt;/name&gt;<br />&#160; &lt;uuid&gt;dd9ac642-5098-4c65-9c87-8d7d33ed32b6&lt;/uuid&gt;<br />&#160; &lt;memory unit=&#039;KiB&#039;&gt;4194304&lt;/memory&gt;<br />&#160; &lt;currentMemory unit=&#039;KiB&#039;&gt;4194304&lt;/currentMemory&gt;<br />&#160; &lt;vcpu placement=&#039;static&#039;&gt;8&lt;/vcpu&gt;<br />&#160; &lt;os&gt;<br />&#160; &#160; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.2&#039;&gt;hvm&lt;/type&gt;<br />&#160; &lt;/os&gt;<br />&#160; &lt;features&gt;<br />&#160; &#160; &lt;acpi/&gt;<br />&#160; &#160; &lt;apic/&gt;<br />&#160; &#160; &lt;pae/&gt;<br />&#160; &#160; &lt;hyperv&gt;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;off&#039;/&gt;<br />&#160; &#160; &#160; &lt;vapic state=&#039;off&#039;/&gt;<br />&#160; &#160; &#160; &lt;spinlocks state=&#039;off&#039;/&gt;<br />&#160; &#160; &lt;/hyperv&gt;<br />&#160; &#160; &lt;kvm&gt;<br />&#160; &#160; &#160; &lt;hidden state=&#039;on&#039;/&gt;<br />&#160; &#160; &lt;/kvm&gt;<br />&#160; &lt;/features&gt;<br />&#160; &lt;clock offset=&#039;localtime&#039;&gt;<br />&#160; &#160; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;no&#039;/&gt;<br />&#160; &lt;/clock&gt;<br />&#160; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;<br />&#160; &lt;on_reboot&gt;restart&lt;/on_reboot&gt;<br />&#160; &lt;on_crash&gt;restart&lt;/on_crash&gt;<br />&#160; &lt;pm&gt;<br />&#160; &#160; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt;<br />&#160; &#160; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt;<br />&#160; &lt;/pm&gt;<br />&#160; &lt;devices&gt;<br />&#160; &#160; &lt;emulator&gt;/usr/sbin/qemu-kvm&lt;/emulator&gt;<br />&#160; &#160; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;source file=&#039;/data/images/gpu-bios.qcow2&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;hda&#039; bus=&#039;ide&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;1&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;<br />&#160; &#160; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1e&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/controller&gt;<br />&#160; &#160; &lt;interface type=&#039;direct&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:99:bf:7d&#039;/&gt;<br />&#160; &#160; &#160; &lt;source dev=&#039;enp12s0&#039; mode=&#039;bridge&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;<br />&#160; &#160; &lt;interface type=&#039;network&#039;&gt;<br />&#160; &#160; &#160; &lt;mac address=&#039;52:54:00:79:67:c4&#039;/&gt;<br />&#160; &#160; &#160; &lt;source network=&#039;isolated&#039;/&gt;<br />&#160; &#160; &#160; &lt;model type=&#039;virtio&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/interface&gt;<br />&#160; &#160; &lt;serial type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/serial&gt;<br />&#160; &#160; &lt;console type=&#039;pty&#039;&gt;<br />&#160; &#160; &#160; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/console&gt;<br />&#160; &#160; &lt;sound model=&#039;ich6&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/sound&gt;<br />&#160; &#160; &lt;memballoon model=&#039;virtio&#039;&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt;<br />&#160; &#160; &lt;/memballoon&gt;<br />&#160; &lt;/devices&gt;<br />&#160; &lt;qemu:commandline&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=07:00.1,bus=pcie.0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;vfio-pci,host=06:00.0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-cpu&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;host,kvm=off&#039;/&gt;<br />&#160; &lt;/qemu:commandline&gt;<br />&lt;/domain&gt;</p> <p class="postedit"><em>Last edited by akawoz (2015-04-20 19:10:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521678">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521681" class="blockpost rowodd"> <h2><span><span class="conr">#4848</span> <a href="viewtopic.php?pid=1521681#p1521681">2015-04-20 19:12:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@akawoz</p><p>You&#039;re so close to having a pretty clean setup, why ruin it with q35 and all those &lt;qemu:arg&gt; statements?&#160; You&#039;re already telling libvirt to use kvm=off with the hidden option, no need to specify it again.&#160; If you swap to 440fx you can just use normal &lt;hostdev&gt; options for the GPU, audio, and USB.&#160; And with a win8.1 guest and card that new, I&#039;m not sure why you wouldn&#039;t use OVMF rather than BIOS to drop x-vga=on.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521681">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521687" class="blockpost roweven"> <h2><span><span class="conr">#4849</span> <a href="viewtopic.php?pid=1521687#p1521687">2015-04-20 19:47:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89045">akawoz</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-22</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:wsh@warrenhughes.net">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yeah agreed - but I&#039;ve been playing around with this trying to get it working for months (started with an X10SAT, Radeon 7850) so I&#039;m just pleased to finally have it working.</p><p>Good point re duplication of kvm=off statements.</p><p>Will take a look at &lt;hostdev&gt;.</p><p>Tried with OVMF but Windows kept freezing at boot - so followed the path of least resistance. Now I&#039;ve got it running and stable I&#039;d try other settings and options. Cheers.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@akawoz</p><p>You&#039;re so close to having a pretty clean setup, why ruin it with q35 and all those &lt;qemu:arg&gt; statements?&#160; You&#039;re already telling libvirt to use kvm=off with the hidden option, no need to specify it again.&#160; If you swap to 440fx you can just use normal &lt;hostdev&gt; options for the GPU, audio, and USB.&#160; And with a win8.1 guest and card that new, I&#039;m not sure why you wouldn&#039;t use OVMF rather than BIOS to drop x-vga=on.</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1521715" class="blockpost rowodd"> <h2><span><span class="conr">#4850</span> <a href="viewtopic.php?pid=1521715#p1521715">2015-04-20 21:06:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90427">fkoehler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-17</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am back. I still had no luck with <em>ovmf-svn</em> from the AUR. ubuntu would boot (only without the graphics card as the radeon driver would crash), none of the archlinux entries would boot and for the windows iso I do not even have an option to boot from file. debug.log remained empty all the time. So I tried ovmf from <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">this repo</a> as described in the wiki. Now I get a black screen but at least the debug.log is not empty. The error messages lead me to old edk2 issues that were fixed years ago. Maybe you understand them?</p><p>startup script</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash QEMU=qemu-system-x86_64 QEMU_OPTS=&quot;&quot; function add() { for opt in $*; do QEMU_OPTS+=&quot; ${opt}&quot; done } # name add &quot;-name win81&quot; # debug options add &quot;-debugcon file:debug.log -global isa-debugcon.iobase=0x402&quot; # enable kvm virtualization add &quot;-enable-kvm&quot; # uefi add &quot;-drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&quot; add &quot;-drive if=pflash,format=raw,file=/tmp/ovmf_vars.fd&quot; # cpu add &quot;-cpu host,hv_relaxed,hv_spinlocks=0x1fff,hv_vapic,hv_time&quot; add &quot;-smp 4,sockets=1&quot; # memory add &quot;-m 16G&quot; # pci add &quot;-device vfio-pci,host=01:00.0&quot; add &quot;-device vfio-pci,host=01:00.1&quot; # graphics mode add &quot;-vga none&quot; # scsi controller add &quot;-device virtio-scsi-pci,id=scsi&quot; # hard drives add &quot;-drive file=/dev/sda3,id=disk0,format=raw,if=none -device scsi-hd,drive=disk0,bus=scsi.0,bootindex=0&quot; # cdrom add &quot;-drive file=/home/fabian/win81.iso,id=cd0,if=none,format=raw,readonly -device ide-cd,bus=ide.1,drive=cd0,bootindex=1&quot; add &quot;-drive file=/home/fabian/virtio.iso,id=cd1,if=none,format=raw,readonly -device scsi-cd,bus=scsi.0,drive=cd1&quot; add &quot;-boot menu=on&quot; # start cp /usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd /tmp/ovmf_vars.fd echo &quot;${QEMU} ${QEMU_OPTS}&quot; exec ${QEMU} ${QEMU_OPTS}</code></pre></div><p>ovmf errors from debug.log</p><div class="codebox"><pre class="vscroll"><code>SecCoreStartupWithStack(0xFFFCC000, 0x818000) Register PPI Notify: DCD0BE23-9586-40F4-B643-06522CED4EDE Install PPI: 8C8CE578-8A3D-4F1C-9935-896185C32DD3 Install PPI: 5473C07A-3DCB-4DCA-BD6F-1E9689E7349A The 0th FV start address is 0x00000820000, size is 0x000E0000, handle is 0x820000 Register PPI Notify: 49EDB1C1-BF21-4761-BB12-EB0031AABB39 Register PPI Notify: EA7CA24B-DED5-4DAD-A389-BF827E8F9B38 Install PPI: B9E0ABFE-5979-4914-977F-6DEE78C278A6 Install PPI: DBE23AA9-A345-4B97-85B6-B226F1617389 Loading PEIM at 0x00000838EA0 EntryPoint=0x00000839100 PcdPeim.efi Install PPI: 06E81C58-4AD7-44BC-8390-F10265F72480 Install PPI: 01F34D25-4DE2-23AD-3FF3-36353FF323F1 Install PPI: 4D8B155B-C059-4C8F-8926-06FD4331DB8A Install PPI: A60C6B59-E459-425D-9C69-0BCC9CB27D81 Loading PEIM at 0x000008421A0 EntryPoint=0x00000842400 StatusCodePei.efi Install PPI: 229832D3-7A30-4B36-B827-F40CB7D45436 Loading PEIM at 0x00000847EA0 EntryPoint=0x00000848100 PlatformPei.efi Select Item: 0x0 FW CFG Signature: 0x554D4551 Select Item: 0x1 FW CFG Revision: 0x1 QemuFwCfg interface is supported. Platform PEIM Loaded CMOS: 00: 56 00 04 00 21 00 02 20 04 15 26 02 10 80 00 00 10: 40 00 00 00 07 80 02 FF FF 00 00 00 00 00 00 00 20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 30: FF FF 20 00 00 BF 00 20 30 00 00 00 00 12 00 00 40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 50: 00 00 00 00 00 00 00 00 00 00 00 00 40 03 00 03 60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 Select Item: 0x19 Select Item: 0x25 S3 support was detected on QEMU Install PPI: 7408D748-FC8C-4EE6-9288-C4BEC092A410 PeiInstallPeiMemory MemoryBegin 0xBC000000, MemoryLength 0x4000000 QemuInitializeRam called Allocated Memory unaligned: Address = 0xBFFD0000, Pages = 0x30, Type = 6 After aligning to 0x10000 bytes: Address = 0xBFFD0000, Pages = 0x20 Updated aligned-mem HOB with BaseAddress = BFFD0000, Length = 20000, MemoryType = 6 Created after-mem HOB with BaseAddress = BFFF0000, Length = 10000, MemoryType = 7 Reserved variable store memory: 0xBFFD0000; size: 128kb Platform PEI Firmware Volume Initialization Install PPI: 49EDB1C1-BF21-4761-BB12-EB0031AABB39 Notify: PPI Guid: 49EDB1C1-BF21-4761-BB12-EB0031AABB39, Peim notify entry point: 8242CA The 1th FV start address is 0x00000900000, size is 0x00800000, handle is 0x900000 Temp Stack : BaseAddress=0x814000 Length=0x4000 Temp Heap : BaseAddress=0x810000 Length=0x1980 Total temporary memory: 32768 bytes. temporary memory stack ever used: 16384 bytes. temporary memory heap used: 6528 bytes. Old Stack size 16384, New stack size 131072 Stack Hob: BaseAddress=0xBC000000 Length=0x20000 Heap Offset = 0xBB810000 Stack Offset = 0xBB808000 TemporaryRamMigration(0x810000, 0xBC01C000, 0x8000) Loading PEIM at 0x000BFFB6000 EntryPoint=0x000BFFB6260 PeiCore.efi Reinstall PPI: 8C8CE578-8A3D-4F1C-9935-896185C32DD3 Reinstall PPI: 5473C07A-3DCB-4DCA-BD6F-1E9689E7349A Reinstall PPI: B9E0ABFE-5979-4914-977F-6DEE78C278A6 Install PPI: F894643D-C449-42D1-8EA8-85BDD8C65BDE Loading PEIM at 0x000BFFAC000 EntryPoint=0x000BFFAC260 DxeIpl.efi Install PPI: 0AE8CE5D-E448-4437-A8D7-EBF5F194F731 Install PPI: 1A36E4E7-FAB6-476A-8E75-695A0576FDD7 Loading PEIM at 0x000BFFA1000 EntryPoint=0x000BFFA1260 S3Resume2Pei.efi Install PPI: 6D582DBC-DB85-4514-8FCC-5ADF6227B147 DXE IPL Entry Loading PEIM at 0x000BFF64000 EntryPoint=0x000BFF64260 DxeCore.efi Loading DXE CORE at 0x000BFF64000 EntryPoint=0x000BFF64260 Install PPI: 605EA650-C65C-42E1-BA80-91A52AB618C6 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BFF938C8 HOBLIST address in DXE = 0xBFD19018 Memory Allocation 0x0000000A 0x818000 - 0x81FFFF Memory Allocation 0x0000000A 0x810000 - 0x817FFF Memory Allocation 0x0000000A 0x807000 - 0x807FFF Memory Allocation 0x0000000A 0x800000 - 0x805FFF Memory Allocation 0x0000000A 0x806000 - 0x806FFF Memory Allocation 0x00000006 0xBFFD0000 - 0xBFFEFFFF Memory Allocation 0x00000007 0xBFFF0000 - 0xBFFFFFFF Memory Allocation 0x0000000A 0x820000 - 0x8FFFFF Memory Allocation 0x00000004 0x900000 - 0x10FFFFF Memory Allocation 0x00000004 0xBFF44000 - 0xBFF63FFF Memory Allocation 0x00000004 0xBFFCF000 - 0xBFFCFFFF Memory Allocation 0x00000004 0xBFFB6000 - 0xBFFCEFFF Memory Allocation 0x00000004 0xBFFAC000 - 0xBFFB5FFF Memory Allocation 0x00000004 0xBFFA1000 - 0xBFFABFFF Memory Allocation 0x00000004 0xBFF64000 - 0xBFFA0FFF Memory Allocation 0x00000003 0xBFF64000 - 0xBFFA0FFF Memory Allocation 0x00000004 0xBFF44000 - 0xBFF63FFF Memory Allocation 0x00000004 0xBFF02000 - 0xBFF43FFF Memory Allocation 0x00000004 0xBC000000 - 0xBC01FFFF FV Hob 0x900000 - 0x10FFFFF InstallProtocolInterface: D8117CFE-94A6-11D4-9A3A-0090273FC14D BFF93360 InstallProtocolInterface: 8F644FA9-E850-4DB1-9CE2-0B44698E8DA4 BFD15270 InstallProtocolInterface: 09576E91-6D3F-11D2-8E39-00A0C969723B BFD15658 InstallProtocolInterface: 220E73B6-6BDB-4413-8405-B974B108619A BFD14C70 InstallProtocolInterface: EE4E5898-3914-4259-9D6E-DC7BD79403CF BFF93588 Loading driver 9B680FCE-AD6B-4F3A-B60B-F59899003443 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF732180 Loading driver at 0x000BFE8C000 EntryPoint=0x000BFE8C2AF DevicePathDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF732E58 InstallProtocolInterface: 0379BE4E-D706-437D-B037-EDB82FB772A4 BFE98200 InstallProtocolInterface: 8B843E20-8132-4852-90CC-551A4E4A7F1C BFE98240 InstallProtocolInterface: 05C99A21-C70F-4AD2-8A5F-35DF3343F51E BFE98250 Loading driver 80CF7257-87AB-47F9-A3FE-D50B76D89541 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF7325C0 Loading driver at 0x000BFE7F000 EntryPoint=0x000BFE7F2AF PcdDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF724018 InstallProtocolInterface: 11B34006-D85B-4D0A-A290-D5A571310EF7 BFE87C60 InstallProtocolInterface: 13A3F0F6-264A-3EF0-F2E0-DEC512342F34 BFE87D60 InstallProtocolInterface: 5BE40F57-FA68-4610-BBBF-E9C5FCDAD365 BFE87DF0 InstallProtocolInterface: FD0F4478-0EFD-461D-BA2D-E58C45FD5F5E BFE87E10 Loading driver 733CBAC2-B23F-4B92-BC8E-FB01CE5907B7 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF727040 Loading driver at 0x000BFEC3000 EntryPoint=0x000BFEC32AF FvbServicesRuntimeDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF724698 QEMU Flash: Attempting flash detection at FFE00000 QemuFlashDetected =&gt; FD behaves as FLASH QemuFlashDetected =&gt; Yes Variable FV header is not valid. It will be reinitialized. Installing QEMU flash FVB InstallProtocolInterface: 8F644FA9-E850-4DB1-9CE2-0B44698E8DA4 BFEF0DF0 InstallProtocolInterface: 09576E91-6D3F-11D2-8E39-00A0C969723B BF727D98 Loading driver FEDE0A1B-BCA2-4A9F-BB2B-D9FD7DEC2E9F InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF727340 Loading driver at 0x000BFEB9000 EntryPoint=0x000BFEB92AF StatusCodeRuntimeDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF727598 InstallProtocolInterface: D2B2B828-0826-48A7-B3DF-983C006024F0 BFEBF600 Loading driver B601F8C4-43B7-4784-95B1-F4226CB40CEE InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72FBC0 Loading driver at 0x000BFEB1000 EntryPoint=0x000BFEB12AF RuntimeDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72F298 InstallProtocolInterface: B7DFB4E1-052F-449F-87BE-9818FC91B733 BFEB56C0 Loading driver F80697E9-7FD6-4665-8646-88E33EF71DFC InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72E040 Loading driver at 0x000BFDF9000 EntryPoint=0x000BFDF92AF SecurityStubDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72F698 InstallProtocolInterface: 94AB2F58-1438-4EF1-9152-18941A3A0E68 BFE57B70 InstallProtocolInterface: A46423E3-4617-49F1-B9FF-D1BFA9115839 BFE57B68 Loading driver 13AC6DD0-73D0-11D4-B06B-00AA00BD6DE7 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72E400 Loading driver at 0x000BFDED000 EntryPoint=0x000BFDED2AF EbcDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72EA18 InstallProtocolInterface: 13AC6DD1-73D0-11D4-B06B-00AA00BD6DE7 BF72E798 InstallProtocolInterface: 2755590C-6F3C-42FA-9EA4-A3BA543CDA25 BF72DE58 InstallProtocolInterface: AAEACCFD-F27B-4C17-B610-75CA1F2DFB52 BF72DE18 Loading driver 79CA4208-BBA1-4A9A-8456-E1E66A81484E InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72D140 Loading driver at 0x000BFDE8000 EntryPoint=0x000BFDE82AF Legacy8259.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72D8D8 InstallProtocolInterface: 38321DBA-4FE0-4E17-8AEC-413055EAEDC1 BFDEB040 Loading driver A19B1FE7-C1BC-49F8-875F-54A5D542443F InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72D500 Loading driver at 0x000BFDE2000 EntryPoint=0x000BFDE22AF CpuIo2Dxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72CF98 InstallProtocolInterface: AD61F191-AE5F-4C0E-B9FA-E869D288C64F BFDE53A0 Loading driver 1A1E4886-9517-440E-9FDE-3BE44CEE2136 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72CB00 Loading driver at 0x000BFDCF000 EntryPoint=0x000BFDCF2AF CpuDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72C998 InstallProtocolInterface: 26BACCB1-6F42-11D4-BCE7-0080C73C8881 BFDDBF20 Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Flushing GCD Loading driver 6F0198AA-1F1D-426D-AE3E-39AB633FCC28 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72BE00 Loading driver at 0x000BFEAB000 EntryPoint=0x000BFEAB2AF KbcReset.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF728D18 InstallProtocolInterface: 27CFAC88-46CC-11D4-9A38-0090273FC14D 0 Loading driver C8339973-A563-4561-B858-D8476F9DEFC4 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF7288C0 Loading driver at 0x000BFDC9000 EntryPoint=0x000BFDC92AF Metronome.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF728A98 InstallProtocolInterface: 26BACCB2-6F42-11D4-BCE7-0080C73C8881 BFDCBF20 Loading driver 22DC2B60-FE40-42AC-B01F-3AB1FAD9AAD8 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF72B9C0 Loading driver at 0x000BFEA3000 EntryPoint=0x000BFEA32AF EmuVariableFvbRuntimeDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF726F98 EMU Variable FVB Started Disabling EMU Variable FVB since flash variables appear to be supported. Error: Image at 000BFEA3000 start failed: Aborted Loading driver 2226F30F-3D5B-402D-9936-A97184EB4516 InstallProtocolInterface: 5B1B31A1-9562-11D2-8E3F-00A0C969723B BF726040 Loading driver at 0x000BED8A000 EntryPoint=0x000BED8A2AF VariableAuthRuntimeDxe.efi InstallProtocolInterface: BC62157E-3E33-4FEC-9920-2D3B36D750DF BF72BA98 Variable Store header is corrupted ASSERT_EFI_ERROR (Status = Volume Corrupt) ASSERT /var/lib/jenkins/jobs/edk2/workspace/rpmbuild/rpm/BUILD/edk2.git/SecurityPkg/VariableAuthenticated/RuntimeDxe/VariableDxe.c(449): !EFI_ERROR (Status)</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1521715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=193">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=192">192</a> <a href="viewtopic.php?id=162768&amp;p=193">193</a> <strong>194</strong> <a href="viewtopic.php?id=162768&amp;p=195">195</a> <a href="viewtopic.php?id=162768&amp;p=196">196</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=195">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
