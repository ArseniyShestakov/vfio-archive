<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 22) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=22" title="Page 22" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=21" title="Page 21" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=23" title="Page 23" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=21">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=20">20</a> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <strong>22</strong> <a href="viewtopic.php?id=162768&amp;p=23">23</a> <a href="viewtopic.php?id=162768&amp;p=24">24</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=23">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1333281" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#526</span> <a href="viewtopic.php?pid=1333281#p1333281">2013-10-05 02:46:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Code status update:</p><p>Linux v3.12 includes support for bus reset and the VFIO interfaces to use it, so you can update to the latest rc release and hopefully throw away any kernel patches you&#039;ve been using.</p><p>On the QEMU front, you&#039;ll need to get this series to match the above:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00494.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00494.html</a></p><p>Apply to latest qemu.git or pull my tag.</p><p>In addition to the bus reset, I&#039;ve reworked how and when we read the device option ROM, so if you previously needed to supply a romfile= to make things work, try without it.</p><p>Also, this patch should hopefully solve the Code 43 issues with Nvidia on Intel for many of you:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a></p><p>Thanks,<br />Alex</p></div></blockquote></div><p>Awsome news! thanks a lot Alex!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333406" class="blockpost roweven"> <h2><span><span class="conr">#527</span> <a href="viewtopic.php?pid=1333406#p1333406">2013-10-05 15:02:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Code status update:</p><p>Linux v3.12 includes support for bus reset and the VFIO interfaces to use it, so you can update to the latest rc release and hopefully throw away any kernel patches you&#039;ve been using.</p><p>On the QEMU front, you&#039;ll need to get this series to match the above:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00494.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00494.html</a></p><p>Apply to latest qemu.git or pull my tag.</p><p>In addition to the bus reset, I&#039;ve reworked how and when we read the device option ROM, so if you previously needed to supply a romfile= to make things work, try without it.</p><p>Also, this patch should hopefully solve the Code 43 issues with Nvidia on Intel for many of you:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a></p><p>Thanks,<br />Alex</p></div></blockquote></div><p>So with this new progress i will need a linux 3.12-rc1 or later and a pull from alex` repository (<a href="https://github.com/awilliam/qemu-vfio/releases/tag/vfio-pci-for-qemu-20131003.0" rel="nofollow">https://github.com/awilliam/qemu-vfio/r … 20131003.0</a>)?<br />It looks like seabios was merged into qemu so i wont need to install it?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333406">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333411" class="blockpost rowodd"> <h2><span><span class="conr">#528</span> <a href="viewtopic.php?pid=1333411#p1333411">2013-10-05 15:12:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Code status update:</p><p>Linux v3.12 includes support for bus reset and the VFIO interfaces to use it, so you can update to the latest rc release and hopefully throw away any kernel patches you&#039;ve been using.</p><p>On the QEMU front, you&#039;ll need to get this series to match the above:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00494.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00494.html</a></p><p>Apply to latest qemu.git or pull my tag.</p><p>In addition to the bus reset, I&#039;ve reworked how and when we read the device option ROM, so if you previously needed to supply a romfile= to make things work, try without it.</p><p>Also, this patch should hopefully solve the Code 43 issues with Nvidia on Intel for many of you:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a></p><p>Thanks,<br />Alex</p></div></blockquote></div><p>So with this new progress i will need a linux 3.12-rc1 or later and a pull from alex` repository (<a href="https://github.com/awilliam/qemu-vfio/releases/tag/vfio-pci-for-qemu-20131003.0" rel="nofollow">https://github.com/awilliam/qemu-vfio/r … 20131003.0</a>)?<br />It looks like seabios was merged into qemu so i wont need to install it?</p></div></blockquote></div><p>Right, you can use seabios as-is in qemu.&#160; If you use my tag note that it does not include the patch in the 2nd link.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333416" class="blockpost roweven"> <h2><span><span class="conr">#529</span> <a href="viewtopic.php?pid=1333416#p1333416">2013-10-05 15:19:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>...</p></div></blockquote></div><p>So with this new progress i will need a linux 3.12-rc1 or later and a pull from alex` repository (<a href="https://github.com/awilliam/qemu-vfio/releases/tag/vfio-pci-for-qemu-20131003.0" rel="nofollow">https://github.com/awilliam/qemu-vfio/r … 20131003.0</a>)?<br />It looks like seabios was merged into qemu so i wont need to install it?</p></div></blockquote></div><p>Right, you can use seabios as-is in qemu.&#160; If you use my tag note that it does not include the patch in the 2nd link.</p></div></blockquote></div><p>Alright, I will try to get it running with this. Since i use AMD i dont think i need that patch.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333416">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333469" class="blockpost rowodd"> <h2><span><span class="conr">#530</span> <a href="viewtopic.php?pid=1333469#p1333469">2013-10-05 16:44:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, so I tried 3.12-rc3 and qemu from <a href="https://github.com/awilliam/qemu-vfio" rel="nofollow">https://github.com/awilliam/qemu-vfio</a>.<br />It resulted in a lot of error messages in <a href="https://gist.github.com/ajs124/6842823" rel="nofollow">dmesg</a>, but it worked.<br />Afterwards, if I start qemu, it says </p><div class="codebox"><pre><code>file_ram_alloc: can&#039;t mmap RAM pages: Cannot allocate memory</code></pre></div><p> and does&#039;t seem to use my 4 1gb hugepages…<br />I&#039;ll reboot later and try again. My current kernel is compiled with &quot;# CONFIG_DEBUG_KERNEL is not set&quot; for some reason, is a recompile with &quot;CONFIG_DEBUG_KERNEL=y&quot; likely to give useful information?</p><p>While I&#039;m at it, has there been any news on the broken hardware front (<a href="http://lkml.indiana.edu/hypermail/linux/kernel/1303.0/00079.html" rel="nofollow">http://lkml.indiana.edu/hypermail/linux … 00079.html</a>)?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333469">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333483" class="blockpost roweven"> <h2><span><span class="conr">#531</span> <a href="viewtopic.php?pid=1333483#p1333483">2013-10-05 17:20:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>Ok, so I tried 3.12-rc3 and qemu from <a href="https://github.com/awilliam/qemu-vfio" rel="nofollow">https://github.com/awilliam/qemu-vfio</a>.<br />It resulted in a lot of error messages in <a href="https://gist.github.com/ajs124/6842823" rel="nofollow">dmesg</a>, but it worked.<br />Afterwards, if I start qemu, it says </p><div class="codebox"><pre><code>file_ram_alloc: can&#039;t mmap RAM pages: Cannot allocate memory</code></pre></div><p> and does&#039;t seem to use my 4 1gb hugepages…<br />I&#039;ll reboot later and try again. My current kernel is compiled with &quot;# CONFIG_DEBUG_KERNEL is not set&quot; for some reason, is a recompile with &quot;CONFIG_DEBUG_KERNEL=y&quot; likely to give useful information?</p><p>While I&#039;m at it, has there been any news on the broken hardware front (<a href="http://lkml.indiana.edu/hypermail/linux/kernel/1303.0/00079.html" rel="nofollow">http://lkml.indiana.edu/hypermail/linux … 00079.html</a>)?</p></div></blockquote></div><p>dmesg errors are all from kvm, not vfio.&#160; Do these happen regardless of an assigned device?&#160; What if you don&#039;t use hugepages?&#160; What if you boot the guest with a single CPU?&#160; WRT broken hardware, no time lately.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333483">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333530" class="blockpost rowodd"> <h2><span><span class="conr">#532</span> <a href="viewtopic.php?pid=1333530#p1333530">2013-10-05 19:33:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>…</p></div></blockquote></div><p>dmesg errors are all from kvm, not vfio.&#160; Do these happen regardless of an assigned device?&#160; What if you don&#039;t use hugepages?&#160; What if you boot the guest with a single CPU?&#160; WRT broken hardware, no time lately.</p></div></blockquote></div><p>Yeah, right. To clarify, the vm starts despite the mmap error and without &quot;-mem-path&quot; the error goes away. Not assinging devices or using only one cpu doesn&#039;t change anything.<br />I did some testing and the first vm start after a reboot results in no error from qemu, but the dmesg errors and everything afterwards returns &quot;file_ram_alloc: can&#039;t mmap RAM pages: Cannot allocate memory&quot; (but dmesg stays the same).<br />I tried something simple as a first start to try to reduce error sources: </p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 -enable-kvm -m 4096 -mem-path /dev/hugepages -drive file=/files/vm/arch.img,id=drive0,if=virtio,media=disk -monitor stdio</code></pre></div><p>In case I have the same problem with upstream stable qemu, any idea where to report this?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333530">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333540" class="blockpost roweven"> <h2><span><span class="conr">#533</span> <a href="viewtopic.php?pid=1333540#p1333540">2013-10-05 20:00:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>dmesg errors are all from kvm, not vfio.&#160; Do these happen regardless of an assigned device?&#160; What if you don&#039;t use hugepages?&#160; What if you boot the guest with a single CPU?&#160; WRT broken hardware, no time lately.</p></div></blockquote></div><p>Yeah, right. To clarify, the vm starts despite the mmap error and without &quot;-mem-path&quot; the error goes away. Not assinging devices or using only one cpu doesn&#039;t change anything.</p></div></blockquote></div><p>What happens with 2M hugepages?</p><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>I did some testing and the first vm start after a reboot results in no error from qemu, but the dmesg errors and everything afterwards returns &quot;file_ram_alloc: can&#039;t mmap RAM pages: Cannot allocate memory&quot; (but dmesg stays the same).<br />I tried something simple as a first start to try to reduce error sources: </p><div class="codebox"><pre><code>/usr/bin/qemu-system-x86_64 -enable-kvm -m 4096 -mem-path /dev/hugepages -drive file=/files/vm/arch.img,id=drive0,if=virtio,media=disk -monitor stdio</code></pre></div><p>In case I have the same problem with upstream stable qemu, any idea where to report this?</p></div></blockquote></div><p>My qemu tree only modifies vfio, so if it happens without an assigned device, it should happen on qemu.git.&#160; If you can narrow it down (or even if you can&#039;t), please report it to:</p><p>kvm@vger.kernel.org, cc qemu-devel@nongnu.org</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333540">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333626" class="blockpost rowodd"> <h2><span><span class="conr">#534</span> <a href="viewtopic.php?pid=1333626#p1333626">2013-10-06 00:32:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>What happens with 2M hugepages?</p><p>My qemu tree only modifies vfio, so if it happens without an assigned device, it should happen on qemu.git.&#160; If you can narrow it down (or even if you can&#039;t), please report it to:</p><p>kvm@vger.kernel.org, cc qemu-devel@nongnu.org</p></div></blockquote></div><p>There are no problems with 2M hugepages.<br />Thanks for those adresses, I did some futher testing and I noticed, that the hugepages seem to &quot;fill up&quot;. With 4x1G hugepages, I can start and stop 2 virtual machines with 2gb ram with dmesg errors, but without qemu telling me, that it can&#039;t mmap, 4 virtualmachines if they use 1gb each.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333626">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1333678" class="blockpost roweven"> <h2><span><span class="conr">#535</span> <a href="viewtopic.php?pid=1333678#p1333678">2013-10-06 03:19:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75627">tarcisioe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I am trying this with the following setup:</p><p>CPU: i7 2600 (supports VT-d)<br />Motherboard: Gigabyte GA-P67A-UD3-B3 (Current BIOS F4a, VT-d is enabled on BIOS setup)<br />Video cards:<br />- GeForce GT 620 (for Linux host)<br />- GeForce GTX 650 Ti (for Windows)</p><p>I can&#039;t seem to turn Intel_IOMMU on, though. When I try, Arch boots to weird messages about &quot;can&#039;t find DMAR&quot; for various devices and finally hangs, unable to find the hard drive.</p><p>The kernel line I am (trying to, actually) using is:<br />linux&#160; &#160; /vmlinuz-linux root=UUID=89c6d568-9a2f-4de8-ad98-5f210c6a7163 rw&#160; quiet iommu=1 intel_iommu=on pci-stub.ids=10de:11c6,10de:0b0e</p><p>I can&#039;t seem to get past this. Without intel_iommu=on, I get<br />ĺs: cannot access&#160; /sys/bus/pci/devices/0000:01.00.0/iommu_group/devices: No such file or directory<br />ĺs: cannot access&#160; /sys/bus/pci/devices/0000:01.00.1/iommu_group/devices: No such file or directory</p><p>when trying to run vfio-bind.</p><p>Any help will be much appreciated, so thanks in advance.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1333678">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1334201" class="blockpost rowodd"> <h2><span><span class="conr">#536</span> <a href="viewtopic.php?pid=1334201#p1334201">2013-10-07 15:54:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tarcisioe wrote:</cite><blockquote><div><p>Hi,</p><p>I am trying this with the following setup:</p><p>CPU: i7 2600 (supports VT-d)<br />Motherboard: Gigabyte GA-P67A-UD3-B3 (Current BIOS F4a, VT-d is enabled on BIOS setup)<br />Video cards:<br />- GeForce GT 620 (for Linux host)<br />- GeForce GTX 650 Ti (for Windows)</p><p>I can&#039;t seem to turn Intel_IOMMU on, though. When I try, Arch boots to weird messages about &quot;can&#039;t find DMAR&quot; for various devices and finally hangs, unable to find the hard drive.</p><p>The kernel line I am (trying to, actually) using is:<br />linux&#160; &#160; /vmlinuz-linux root=UUID=89c6d568-9a2f-4de8-ad98-5f210c6a7163 rw&#160; quiet iommu=1 intel_iommu=on pci-stub.ids=10de:11c6,10de:0b0e</p><p>I can&#039;t seem to get past this. Without intel_iommu=on, I get<br />ĺs: cannot access&#160; /sys/bus/pci/devices/0000:01.00.0/iommu_group/devices: No such file or directory<br />ĺs: cannot access&#160; /sys/bus/pci/devices/0000:01.00.1/iommu_group/devices: No such file or directory</p><p>when trying to run vfio-bind.</p><p>Any help will be much appreciated, so thanks in advance.</p></div></blockquote></div><p>IOMMU support is required for VFIO.&#160; Make sure VT-d support is enabled in your BIOS, update to a newer BIOS, and possibly contact your motherboard vendor about fixing their VT-d support.&#160; Perhaps others with this board can share their experience.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1334201">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1334926" class="blockpost roweven"> <h2><span><span class="conr">#537</span> <a href="viewtopic.php?pid=1334926#p1334926">2013-10-08 22:04:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75627">tarcisioe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>IOMMU support is required for VFIO.&#160; Make sure VT-d support is enabled in your BIOS, update to a newer BIOS, and possibly contact your motherboard vendor about fixing their VT-d support.&#160; Perhaps others with this board can share their experience.</p></div></blockquote></div><p>Indeed, updating to the newest BIOS (F9) made me able to boot with intel_iommu=on. For anyone who may care, the option &quot;M.I.T. Intelligent Tweaker &gt; Miscellaneous Settings &gt; Virtualization technology&quot; apparently enables VT-x as well as VT-d on the newer Gigabyte BIOS for GA-P67A-UD3-B3. There is no option called &quot;VT-d&quot; as it was called on F4a.</p><p>Now dmesg tells me that Intel IOMMU is on, but I can&#039;t seem to get the iommu_group directories under /sys/bus/pci/devices/0000:01:00.1 yet. I can&#039;t load vfio_iommu_type1 directly, but I&#039;ll try to compile it built-in just in case.</p><p>I&#039;m not with my PC right now but I can post any other needed information as soon as I get home.</p><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1334926">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1334931" class="blockpost rowodd"> <h2><span><span class="conr">#538</span> <a href="viewtopic.php?pid=1334931#p1334931">2013-10-08 22:14:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tarcisioe wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>IOMMU support is required for VFIO.&#160; Make sure VT-d support is enabled in your BIOS, update to a newer BIOS, and possibly contact your motherboard vendor about fixing their VT-d support.&#160; Perhaps others with this board can share their experience.</p></div></blockquote></div><p>Indeed, updating to the newest BIOS (F9) made me able to boot with intel_iommu=on. For anyone who may care, the option &quot;M.I.T. Intelligent Tweaker &gt; Miscellaneous Settings &gt; Virtualization technology&quot; apparently enables VT-x as well as VT-d on the newer Gigabyte BIOS for GA-P67A-UD3-B3. There is no option called &quot;VT-d&quot; as it was called on F4a.</p><p>Now dmesg tells me that Intel IOMMU is on, but I can&#039;t seem to get the iommu_group directories under /sys/bus/pci/devices/0000:01:00.1 yet. I can&#039;t load vfio_iommu_type1 directly, but I&#039;ll try to compile it built-in just in case.</p><p>I&#039;m not with my PC right now but I can post any other needed information as soon as I get home.</p><p>Thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>If there&#039;s no iommu_group link or /sys/kernel/iommu_groups/ is not populated, that suggests that intel-iommu isn&#039;t really enabled.&#160; Those are provided by the iommu driver, not vfio.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1334931">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335152" class="blockpost roweven"> <h2><span><span class="conr">#539</span> <a href="viewtopic.php?pid=1335152#p1335152">2013-10-09 12:08:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=60514">ttouch</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: /dev/null</span></dd> <dd><span>Registered: 2012-05-27</span></dd> <dd><span>Posts: 129</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=60514">Email</a></span> <span class="website"><a href="http://dzervas.gr" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Sorry to bother again,</p><p>I get output only when I omit -vga none.<br />Is the card used? Or I use qemu&#039;s graphics emulation?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://github.com/ttouch" rel="nofollow">GitHub</a> | <a href="http://git.dzervas.gr" rel="nofollow">Git Server</a> | <a href="http://dzervas.gr" rel="nofollow">Blog</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335152">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335312" class="blockpost rowodd"> <h2><span><span class="conr">#540</span> <a href="viewtopic.php?pid=1335312#p1335312">2013-10-09 19:13:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>A somewhat off-topic question: how can i pass isos/images/partitions to the guest? using -cdrom or -drive doesnt work for me. For the isos i have found a way by adding an ahci controller with an cd-drive attached to it, but that looks more like a workaround to me.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335312">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335314" class="blockpost roweven"> <h2><span><span class="conr">#541</span> <a href="viewtopic.php?pid=1335314#p1335314">2013-10-09 19:15:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><p>Sorry to bother again,</p><p>I get output only when I omit -vga none.<br />Is the card used? Or I use qemu&#039;s graphics emulation?</p></div></blockquote></div><p>Have you tried the lastest kernel rc + alex qemu tree?</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Code status update:</p><p>Linux v3.12 includes support for bus reset and the VFIO interfaces to use it, so you can update to the latest rc release and hopefully throw away any kernel patches you&#039;ve been using.</p><p>On the QEMU front, you&#039;ll need to get this series to match the above:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00494.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00494.html</a></p><p>Apply to latest qemu.git or pull my tag.</p><p>In addition to the bus reset, I&#039;ve reworked how and when we read the device option ROM, so if you previously needed to supply a romfile= to make things work, try without it.</p><p>Also, this patch should hopefully solve the Code 43 issues with Nvidia on Intel for many of you:</p><p><a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a></p><p>Thanks,<br />Alex</p></div></blockquote></div> <p class="postedit"><em>Last edited by nbhs (2013-10-09 19:19:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335314">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335315" class="blockpost rowodd"> <h2><span><span class="conr">#542</span> <a href="viewtopic.php?pid=1335315#p1335315">2013-10-09 19:17:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>A somewhat off-topic question: how can i pass isos/images/partitions to the guest? using -cdrom or -drive doesnt work for me. For the isos i have found a way by adding an ahci controller with an cd-drive attached to it, but that looks more like a workaround to me.</p></div></blockquote></div><p>Its on the main guide, you must add a sata/ide/virtio controller then attach a disk to it</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335315">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335328" class="blockpost roweven"> <h2><span><span class="conr">#543</span> <a href="viewtopic.php?pid=1335328#p1335328">2013-10-09 19:37:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>A somewhat off-topic question: how can i pass isos/images/partitions to the guest? using -cdrom or -drive doesnt work for me. For the isos i have found a way by adding an ahci controller with an cd-drive attached to it, but that looks more like a workaround to me.</p></div></blockquote></div><p>Its on the main guide, you must add a sata/ide/virtio controller then attach a disk to it</p></div></blockquote></div><p>Ah, now i see it, thanks!</p><p>EDIT: I`m afraid I can`t get Windows to install. It stops at &quot;Windows data is being expanded (0%)...&quot; i waited for a while but I cant see any progress... Any ideas?</p> <p class="postedit"><em>Last edited by SpacePirate (2013-10-09 20:31:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335328">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335495" class="blockpost rowodd"> <h2><span><span class="conr">#544</span> <a href="viewtopic.php?pid=1335495#p1335495">2013-10-10 03:19:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75627">tarcisioe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If there&#039;s no iommu_group link or /sys/kernel/iommu_groups/ is not populated, that suggests that intel-iommu isn&#039;t really enabled.&#160; Those are provided by the iommu driver, not vfio.</p></div></blockquote></div><p>Oh, I didn&#039;t check /sys/kernel/iommu_groups. It is indeed not populated. How can intel-iommu not be really enabled, though? I even got a bunch of errors when trying to use it with my old BIOS, and they were fixed by updating it to the latest one.</p><p>Don&#039;t want this second graphics card to be a waste of money, I am positive that my CPU supports IOMMU and was informed by Gigabyte&#039;s technical support that my motherboard indeed supports VT-d.</p><p>Any suggestions?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335495">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335497" class="blockpost roweven"> <h2><span><span class="conr">#545</span> <a href="viewtopic.php?pid=1335497#p1335497">2013-10-10 03:23:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>A somewhat off-topic question: how can i pass isos/images/partitions to the guest? using -cdrom or -drive doesnt work for me. For the isos i have found a way by adding an ahci controller with an cd-drive attached to it, but that looks more like a workaround to me.</p></div></blockquote></div><p>Its on the main guide, you must add a sata/ide/virtio controller then attach a disk to it</p></div></blockquote></div><p>Ah, now i see it, thanks!</p><p>EDIT: I`m afraid I can`t get Windows to install. It stops at &quot;Windows data is being expanded (0%)...&quot; i waited for a while but I cant see any progress... Any ideas?</p></div></blockquote></div><p>AHCI is currently extremely slow in QEMU, much slower than IDE on 440FX.&#160; You can use pidstat to see if there&#039;s actually I/O to the QEMU process.&#160; Suggest waiting it out and switch to virtio once installed (or try to attach IDE or switch to 440FX model).</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335497">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335498" class="blockpost rowodd"> <h2><span><span class="conr">#546</span> <a href="viewtopic.php?pid=1335498#p1335498">2013-10-10 03:24:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tarcisioe wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>If there&#039;s no iommu_group link or /sys/kernel/iommu_groups/ is not populated, that suggests that intel-iommu isn&#039;t really enabled.&#160; Those are provided by the iommu driver, not vfio.</p></div></blockquote></div><p>Oh, I didn&#039;t check /sys/kernel/iommu_groups. It is indeed not populated. How can intel-iommu not be really enabled, though? I even got a bunch of errors when trying to use it with my old BIOS, and they were fixed by updating it to the latest one.</p><p>Don&#039;t want this second graphics card to be a waste of money, I am positive that my CPU supports IOMMU and was informed by Gigabyte&#039;s technical support that my motherboard indeed supports VT-d.</p><p>Any suggestions?</p></div></blockquote></div><p>dmesg or it didn&#039;t happen.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335498">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335506" class="blockpost roweven"> <h2><span><span class="conr">#547</span> <a href="viewtopic.php?pid=1335506#p1335506">2013-10-10 04:26:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75627">tarcisioe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>dmesg or it didn&#039;t happen.</p></div></blockquote></div><p>LOL ok.</p><p>[root@jack tarcisioe]# dmesg | grep -e IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled</p><p>Anything else I should grep for?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335506">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335517" class="blockpost rowodd"> <h2><span><span class="conr">#548</span> <a href="viewtopic.php?pid=1335517#p1335517">2013-10-10 06:27:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve uploaded new builds for kernel 3.12-rc4, qemu-git + alex patches, and the lastest seabios, all working fine on my pc, ive also cleaned up the guide a bit to reflect the lastest changes</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335517">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335601" class="blockpost roweven"> <h2><span><span class="conr">#549</span> <a href="viewtopic.php?pid=1335601#p1335601">2013-10-10 10:49:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Maybe you could include a note that the AHCI controller will be slow in the first post. using the IDE controller it works fine for me now.</p><p>Also i think the best practice to create qemu images is using qemu-img instead of dd, isnt it? I dont know if there are any differences but so far i have only seen the use of qemu-img in other tutorials/wikis/the documentation.</p><p>I now got an Windows installation running but cant install the driver for the 6450 on the guest. When I use the installer I get a BSOD and if i try to use Windows` driver update functionality it detects the GPU but says &quot;Failed to read from device&quot;...</p> <p class="postedit"><em>Last edited by SpacePirate (2013-10-10 11:12:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335601">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335646" class="blockpost rowodd"> <h2><span><span class="conr">#550</span> <a href="viewtopic.php?pid=1335646#p1335646">2013-10-10 13:32:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tarcisioe wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>dmesg or it didn&#039;t happen.</p></div></blockquote></div><p>LOL ok.</p><p>[root@jack tarcisioe]# dmesg | grep -e IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled</p><p>Anything else I should grep for?</p></div></blockquote></div><p>You should have a lot more output than that, for example:</p><p>$ dmesg | grep -e IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.020973] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a<br />[&#160; &#160; 0.020977] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.021052] IOAPIC id 2 under DRHD base&#160; 0xfed91000 IOMMU 1<br />[&#160; &#160; 0.414246] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 0.414248] IOMMU 1 0xfed91000: using Queued invalidation<br />[&#160; &#160; 0.414251] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.414276] IOMMU: Setting identity map for device 0000:00:02.0 [0xdb800000 - 0xdf9fffff]<br />[&#160; &#160; 0.415007] IOMMU: Setting identity map for device 0000:00:1d.0 [0xda3ba000 - 0xda3d0fff]<br />[&#160; &#160; 0.415044] IOMMU: Setting identity map for device 0000:00:1a.0 [0xda3ba000 - 0xda3d0fff]<br />[&#160; &#160; 0.415077] IOMMU: Setting identity map for device 0000:00:14.0 [0xda3ba000 - 0xda3d0fff]<br />[&#160; &#160; 0.415095] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.415108] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335646">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=21">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=20">20</a> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <strong>22</strong> <a href="viewtopic.php?id=162768&amp;p=23">23</a> <a href="viewtopic.php?id=162768&amp;p=24">24</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=23">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
