<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 108) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=108" title="Page 108" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=107" title="Page 107" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=109" title="Page 109" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=107">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <strong>108</strong> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=109">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1454543" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2676</span> <a href="viewtopic.php?pid=1454543#p1454543">2014-09-08 00:57:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>okay i&#039;ve been messing with it more and i&#039;m still getting the same problems</p><p>test.sh</p><div class="codebox"><pre><code>#qemu-system-x86_64 -enable-kvm -m 1024 -cpu host \ #-smp 6,sockets=1,cores=2,threads=1 \ #-bios /usr/share/qemu/bios.bin -vga none \ #-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ ##-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ #-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none\ -rtc base=localtime \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \</code></pre></div><p>sh test.sh</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error opening /dev/vfio/15: Permission denied qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: failed to get group 15 qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>sudo sh test.sh</p><div class="codebox"><pre><code>No protocol specified Could not initialize SDL(No available video device) - exiting</code></pre></div><p>sh lsgroup</p><div class="codebox"><pre class="vscroll"><code>.... ### Group 15 ### 01:00.0 VGA compatible controller: NVIDIA Corporation GF110 [GeForce GTX 580] (rev a1) 01:00.1 Audio device: NVIDIA Corporation GF110 High Definition Audio Controller (rev a1) .... ### Group 0 ### 00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) ### Group 1 ### 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) ### Group 2 ### 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller (rev 06) ### Group 3 ### 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) ### Group 4 ### 00:14.0 USB controller: Intel Corporation 9 Series Chipset Family USB xHCI Controller ### Group 5 ### 00:16.0 Communication controller: Intel Corporation 9 Series Chipset Family ME Interface #1 ### Group 6 ### 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection (2) I218-V ### Group 7 ### 00:1a.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #2 ### Group 8 ### 00:1b.0 Audio device: Intel Corporation 9 Series Chipset Family HD Audio Controller ### Group 9 ### 00:1c.0 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 1 (rev d0) ### Group 10 ### 00:1c.2 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 3 (rev d0) ### Group 11 ### 00:1c.3 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 4 (rev d0) ### Group 12 ### 00:1c.6 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 7 (rev d0) ### Group 13 ### 00:1d.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 ### Group 14 ### 00:1f.0 ISA bridge: Intel Corporation 9 Series Chipset Family Z97 LPC Controller 00:1f.2 SATA controller: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode] 00:1f.3 SMBus: Intel Corporation 9 Series Chipset Family SMBus Controller ### Group 16 ### 03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 11) ### Group 17 ### 04:00.0 PCI bridge: ASMedia Technology Inc. Device 1184 ### Group 18 ### 05:01.0 PCI bridge: ASMedia Technology Inc. Device 1184 ### Group 19 ### 05:03.0 PCI bridge: ASMedia Technology Inc. Device 1184 ### Group 20 ### 05:05.0 PCI bridge: ASMedia Technology Inc. Device 1184 ### Group 21 ### 05:07.0 PCI bridge: ASMedia Technology Inc. Device 1184 ### Group 22 ### 06:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03) ### Group 23 ### 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) ### Group 24 ### 08:00.0 Network controller: Qualcomm Atheros AR93xx Wireless Network Adapter (rev 01) ### Group 25 ### 09:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) ### Group 26 ### 0a:00.0 USB controller: ASMedia Technology Inc. Device 1142</code></pre></div><p>lspci -nn</p><div class="codebox"><pre class="vscroll"><code>.... 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF110 [GeForce GTX 580] [10de:1080] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GF110 High Definition Audio Controller [10de:0e09] (rev a1) .... 00:00.0 Host bridge [0600]: Intel Corporation 4th Gen Core Processor DRAM Controller [8086:0c00] (rev 06) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller [8086:0412] (rev 06) 00:03.0 Audio device [0403]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller [8086:0c0c] (rev 06) 00:14.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB xHCI Controller [8086:8cb1] 00:16.0 Communication controller [0780]: Intel Corporation 9 Series Chipset Family ME Interface #1 [8086:8cba] 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection (2) I218-V [8086:15a1] 00:1a.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB EHCI Controller #2 [8086:8cad] 00:1b.0 Audio device [0403]: Intel Corporation 9 Series Chipset Family HD Audio Controller [8086:8ca0] 00:1c.0 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 1 [8086:8c90] (rev d0) 00:1c.2 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 3 [8086:8c94] (rev d0) 00:1c.3 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 4 [8086:8c96] (rev d0) 00:1c.6 PCI bridge [0604]: Intel Corporation 9 Series Chipset Family PCI Express Root Port 7 [8086:8c9c] (rev d0) 00:1d.0 USB controller [0c03]: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 [8086:8ca6] 00:1f.0 ISA bridge [0601]: Intel Corporation 9 Series Chipset Family Z97 LPC Controller [8086:8cc4] 00:1f.2 SATA controller [0106]: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode] [8086:8c82] 00:1f.3 SMBus [0c05]: Intel Corporation 9 Series Chipset Family SMBus Controller [8086:8ca2] 03:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 11) 04:00.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 05:01.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 05:03.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 05:05.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 05:07.0 PCI bridge [0604]: ASMedia Technology Inc. Device [1b21:1184] 06:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller [1912:0014] (rev 03) 07:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 02) 08:00.0 Network controller [0280]: Qualcomm Atheros AR93xx Wireless Network Adapter [168c:0030] (rev 01) 09:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 02) 0a:00.0 USB controller [0c03]: ASMedia Technology Inc. Device [1b21:1142]</code></pre></div><p>sh vfio-group 15</p><div class="codebox"><pre><code>0000:01:00.0 0000:01:00.1 0x10de 0x1080</code></pre></div><p>boot parameters</p><div class="codebox"><pre><code>LABEL arch-qemu MENU LABEL Arch Qemu LINUX ../vmlinuz-linux-mainline APPEND root=/dev/sdb1 rootflags=subvol=__active/rootvol intel_iommu=on i915.enable_hd_vgaarb=1 pcie_acs_override=downstream pci-stub.ids=10de:1080,10de:0e09,8086:0c01 modeset.nouveau=0 modeset.radeon=0 rw INITRD ../initramfs-linux-mainline.img</code></pre></div><p>i use vfiobind</p><div class="codebox"><pre><code>sudo vfio-bind 0000:01:00.0 0000:01:00.1</code></pre></div><br /><p>dmesg | grep -e DMAR -e IOMMU</p><div class="codebox"><pre><code>[ 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA [ 0.000000] ACPI: DMAR 0x00000000BD1C3BC8 0000B8 (v01 INTEL BDW 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.026976] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a [ 0.026979] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da [ 0.027044] IOAPIC id 8 under DRHD base 0xfed91000 IOMMU 1 [ 0.523584] DMAR: No ATSR found [ 0.523601] IOMMU 0 0xfed90000: using Queued invalidation [ 0.523601] IOMMU 1 0xfed91000: using Queued invalidation [ 0.523603] IOMMU: Setting RMRR: [ 0.523610] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff] [ 0.524672] IOMMU: Setting identity map for device 0000:00:14.0 [0xbde9a000 - 0xbdea8fff] [ 0.524691] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbde9a000 - 0xbdea8fff] [ 0.524707] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbde9a000 - 0xbdea8fff] [ 0.524718] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.524724] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 2.613731] [drm] DMAR active, disabling use of stolen memory</code></pre></div><p>i am absolutely lost and do not know what i can do next</p><p>by the way tuxuser thank you very much for pointing out those scripts to me they are really helpful.</p><p>does anyone have any ideas?</p> <p class="postedit"><em>Last edited by risho (2014-09-08 01:02:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454543">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454546" class="blockpost roweven"> <h2><span><span class="conr">#2677</span> <a href="viewtopic.php?pid=1454546#p1454546">2014-09-08 01:33:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84564">tuxuser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-23</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@risho I haven&#039;t dealt with that vfio permission problem myself.&#160; &#160;Does dmesg and lspci -v indicate that pci-stub claimed the device?&#160; I assume your pci-stub support is built into the kernel.</p><p>EDIT:&#160; as far as the SDL problem, i assume you are launching from Xorg, but just pass -nographic for now</p><div class="codebox"><pre><code>for my case support is as a module and I wrote about this earlier [root@archost ~]# zgrep PCI_STUB /proc/config.gz CONFIG_PCI_STUB=m [root@archost ~]# dmesg|grep stub [ 0.456853] pci-stub: add 10DE:1183 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.456860] pci-stub 0000:01:00.0: claimed by stub [ 0.456863] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.456867] pci-stub 0000:01:00.1: claimed by stub [ 0.456868] pci-stub: add 8086:1E20 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.456871] pci-stub 0000:00:1b.0: claimed by stub</code></pre></div> <p class="postedit"><em>Last edited by tuxuser (2014-09-08 01:48:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454546">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454549" class="blockpost rowodd"> <h2><span><span class="conr">#2678</span> <a href="viewtopic.php?pid=1454549#p1454549">2014-09-08 01:51:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>lspci-v</p><div class="codebox"><pre class="vscroll"><code>... 01:00.0 VGA compatible controller: NVIDIA Corporation GF110 [GeForce GTX 580] (rev a1) (prog-if 00 [VGA controller]) Subsystem: eVga.com. Corp. Device 1580 Flags: fast devsel, IRQ 16 Memory at ee000000 (32-bit, non-prefetchable) [size=16M] Memory at e0000000 (64-bit, prefetchable) [size=128M] Memory at e8000000 (64-bit, prefetchable) [size=32M] I/O ports at e000 [size=128] Expansion ROM at ef000000 [disabled] [size=512K] Capabilities: &lt;access denied&gt; Kernel driver in use: vfio-pci Kernel modules: nouveau 01:00.1 Audio device: NVIDIA Corporation GF110 High Definition Audio Controller (rev a1) Subsystem: eVga.com. Corp. Device 1580 Flags: bus master, fast devsel, latency 0, IRQ 17 Memory at ef080000 (32-bit, non-prefetchable) [size=16K] Capabilities: &lt;access denied&gt; Kernel driver in use: vfio-pci Kernel modules: snd_hda_intel ... 00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) Subsystem: ASRock Incorporation Device 0c00 Flags: bus master, fast devsel, latency 0 Capabilities: &lt;access denied&gt; Kernel driver in use: hsw_uncore 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=00, secondary=01, subordinate=01, sec-latency=0 I/O behind bridge: 0000e000-0000efff Memory behind bridge: ee000000-ef0fffff Prefetchable memory behind bridge: 00000000e0000000-00000000e9ffffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller (rev 06) (prog-if 00 [VGA controller]) Subsystem: ASRock Incorporation Device 0412 Flags: bus master, fast devsel, latency 0, IRQ 72 Memory at ef400000 (64-bit, non-prefetchable) [size=4M] Memory at d0000000 (64-bit, prefetchable) [size=256M] I/O ports at f000 [size=64] Expansion ROM at &lt;unassigned&gt; [disabled] Capabilities: &lt;access denied&gt; Kernel driver in use: i915 Kernel modules: i915 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) Subsystem: ASRock Incorporation Device 0c0c Flags: bus master, fast devsel, latency 0, IRQ 73 Memory at efe34000 (64-bit, non-prefetchable) [size=16K] Capabilities: &lt;access denied&gt; Kernel driver in use: snd_hda_intel Kernel modules: snd_hda_intel 00:14.0 USB controller: Intel Corporation 9 Series Chipset Family USB xHCI Controller (prog-if 30 [XHCI]) Subsystem: ASRock Incorporation Device 8cb1 Flags: bus master, medium devsel, latency 0, IRQ 48 Memory at efe20000 (64-bit, non-prefetchable) [size=64K] Capabilities: &lt;access denied&gt; Kernel driver in use: xhci_hcd Kernel modules: xhci_hcd 00:16.0 Communication controller: Intel Corporation 9 Series Chipset Family ME Interface #1 Subsystem: ASRock Incorporation Device 8cba Flags: bus master, fast devsel, latency 0, IRQ 68 Memory at efe3e000 (64-bit, non-prefetchable) [size=16] Capabilities: &lt;access denied&gt; Kernel driver in use: mei_me Kernel modules: mei_me 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection (2) I218-V Subsystem: ASRock Incorporation Device 15a1 Flags: bus master, fast devsel, latency 0, IRQ 69 Memory at efe00000 (32-bit, non-prefetchable) [size=128K] Memory at efe3c000 (32-bit, non-prefetchable) [size=4K] I/O ports at f080 [size=32] Capabilities: &lt;access denied&gt; Kernel driver in use: e1000e Kernel modules: e1000e 00:1a.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #2 (prog-if 20 [EHCI]) Subsystem: ASRock Incorporation Device 8cad Flags: bus master, medium devsel, latency 0, IRQ 16 Memory at efe3b000 (32-bit, non-prefetchable) [size=1K] Capabilities: &lt;access denied&gt; Kernel driver in use: ehci-pci Kernel modules: ehci_pci 00:1b.0 Audio device: Intel Corporation 9 Series Chipset Family HD Audio Controller Subsystem: ASRock Incorporation Device 1151 Flags: bus master, fast devsel, latency 0, IRQ 71 Memory at efe30000 (64-bit, non-prefetchable) [size=16K] Capabilities: &lt;access denied&gt; Kernel driver in use: snd_hda_intel Kernel modules: snd_hda_intel 00:1c.0 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 1 (rev d0) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=00, secondary=02, subordinate=02, sec-latency=0 Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.2 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 3 (rev d0) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=00, secondary=03, subordinate=03, sec-latency=0 I/O behind bridge: 0000d000-0000dfff Memory behind bridge: efd00000-efdfffff Prefetchable memory behind bridge: 00000000ea100000-00000000ea1fffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.3 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 4 (rev d0) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=00, secondary=04, subordinate=09, sec-latency=0 I/O behind bridge: 0000b000-0000cfff Memory behind bridge: ef800000-efbfffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 00:1c.6 PCI bridge: Intel Corporation 9 Series Chipset Family PCI Express Root Port 7 (rev d0) (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=00, secondary=0a, subordinate=0a, sec-latency=0 Memory behind bridge: efc00000-efcfffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 00:1d.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1 (prog-if 20 [EHCI]) Subsystem: ASRock Incorporation Device 8ca6 Flags: bus master, medium devsel, latency 0, IRQ 23 Memory at efe3a000 (32-bit, non-prefetchable) [size=1K] Capabilities: &lt;access denied&gt; Kernel driver in use: ehci-pci Kernel modules: ehci_pci 00:1f.0 ISA bridge: Intel Corporation 9 Series Chipset Family Z97 LPC Controller Subsystem: ASRock Incorporation Device 8cc4 Flags: bus master, medium devsel, latency 0 Capabilities: &lt;access denied&gt; 00:1f.2 SATA controller: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode] (prog-if 01 [AHCI 1.0]) Subsystem: ASRock Incorporation Device 8c82 Flags: bus master, 66MHz, medium devsel, latency 0, IRQ 49 I/O ports at f0d0 [size=8] I/O ports at f0c0 [size=4] I/O ports at f0b0 [size=8] I/O ports at f0a0 [size=4] I/O ports at f060 [size=32] Memory at efe39000 (32-bit, non-prefetchable) [size=2K] Capabilities: &lt;access denied&gt; Kernel driver in use: ahci Kernel modules: ahci 00:1f.3 SMBus: Intel Corporation 9 Series Chipset Family SMBus Controller Subsystem: ASRock Incorporation Device 8ca2 Flags: medium devsel, IRQ 10 Memory at efe38000 (64-bit, non-prefetchable) [size=256] I/O ports at f040 [size=32] 03:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller (rev 11) Subsystem: ASRock Incorporation Motherboard (one of many) Flags: bus master, fast devsel, latency 0, IRQ 70 I/O ports at d000 [size=256] Memory at efd00000 (64-bit, non-prefetchable) [size=4K] Memory at ea100000 (64-bit, prefetchable) [size=16K] Capabilities: &lt;access denied&gt; Kernel driver in use: r8169 Kernel modules: r8169 04:00.0 PCI bridge: ASMedia Technology Inc. Device 1184 (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=04, secondary=05, subordinate=09, sec-latency=0 I/O behind bridge: 0000b000-0000cfff Memory behind bridge: ef800000-efbfffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 05:01.0 PCI bridge: ASMedia Technology Inc. Device 1184 (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=05, secondary=06, subordinate=06, sec-latency=0 Memory behind bridge: efb00000-efbfffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 05:03.0 PCI bridge: ASMedia Technology Inc. Device 1184 (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=05, secondary=07, subordinate=07, sec-latency=0 I/O behind bridge: 0000c000-0000cfff Memory behind bridge: efa00000-efafffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 05:05.0 PCI bridge: ASMedia Technology Inc. Device 1184 (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=05, secondary=08, subordinate=08, sec-latency=0 Memory behind bridge: ef900000-ef9fffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 05:07.0 PCI bridge: ASMedia Technology Inc. Device 1184 (prog-if 00 [Normal decode]) Flags: bus master, fast devsel, latency 0 Bus: primary=05, secondary=09, subordinate=09, sec-latency=0 I/O behind bridge: 0000b000-0000bfff Memory behind bridge: ef800000-ef8fffff Capabilities: &lt;access denied&gt; Kernel driver in use: pcieport Kernel modules: shpchp 06:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03) (prog-if 30 [XHCI]) Flags: bus master, fast devsel, latency 0, IRQ 16 Memory at efb00000 (64-bit, non-prefetchable) [size=8K] Capabilities: &lt;access denied&gt; Kernel driver in use: xhci_hcd Kernel modules: xhci_hcd 07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) (prog-if 01 [AHCI 1.0]) Subsystem: ASRock Incorporation Motherboard Flags: bus master, fast devsel, latency 0, IRQ 58 I/O ports at c050 [size=8] I/O ports at c040 [size=4] I/O ports at c030 [size=8] I/O ports at c020 [size=4] I/O ports at c000 [size=32] Memory at efa00000 (32-bit, non-prefetchable) [size=512] Capabilities: &lt;access denied&gt; Kernel driver in use: ahci Kernel modules: ahci 08:00.0 Network controller: Qualcomm Atheros AR93xx Wireless Network Adapter (rev 01) Subsystem: Qualcomm Atheros Device 3112 Flags: bus master, fast devsel, latency 0, IRQ 16 Memory at ef900000 (64-bit, non-prefetchable) [size=128K] Expansion ROM at ef920000 [disabled] [size=64K] Capabilities: &lt;access denied&gt; Kernel driver in use: ath9k Kernel modules: ath9k 09:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02) (prog-if 01 [AHCI 1.0]) Subsystem: ASRock Incorporation Motherboard Flags: bus master, fast devsel, latency 0, IRQ 59 I/O ports at b050 [size=8] I/O ports at b040 [size=4] I/O ports at b030 [size=8] I/O ports at b020 [size=4] I/O ports at b000 [size=32] Memory at ef800000 (32-bit, non-prefetchable) [size=512] Capabilities: &lt;access denied&gt; Kernel driver in use: ahci Kernel modules: ahci 0a:00.0 USB controller: ASMedia Technology Inc. Device 1142 (prog-if 30 [XHCI]) Subsystem: ASRock Incorporation Device 1142 Flags: bus master, fast devsel, latency 0, IRQ 18 Memory at efc00000 (64-bit, non-prefetchable) [size=32K] Capabilities: &lt;access denied&gt; Kernel driver in use: xhci_hcd Kernel modules: xhci_hcd</code></pre></div><p>dmesg | grep vfio-pci</p><div class="codebox"><pre><code>[ 304.062334] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) </code></pre></div><p>interesting the card says </p><p>01:00.0 VGA compatible controller: NVIDIA Corporation GF110 [GeForce GTX 580] (rev a1) (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Subsystem: eVga.com. Corp. Device 1580<br />&#160; &#160; &#160; &#160; Flags: fast devsel, IRQ 16<br />&#160; &#160; &#160; &#160; Memory at ee000000 (32-bit, non-prefetchable) [size=16M]<br />&#160; &#160; &#160; &#160; Memory at e0000000 (64-bit, prefetchable) [size=128M]<br />&#160; &#160; &#160; &#160; Memory at e8000000 (64-bit, prefetchable) [size=32M]<br />&#160; &#160; &#160; &#160; I/O ports at e000 [size=128]<br />&#160; &#160; &#160; &#160; Expansion ROM at ef000000 [disabled] [size=512K]<br />&#160; &#160; &#160; &#160; Capabilities: &lt;access denied&gt;<br />&#160; &#160; &#160; &#160; Kernel driver in use: vfio-pci<br />&#160; &#160; &#160; &#160;<strong> Kernel modules: nouveau</strong><br />i dunno if that means it isnt being blacklisted?</p><br /><p>EDIT:</p><div class="quotebox"><blockquote><div><p>EDIT:&#160; as far as the SDL problem, i assume you are launching from Xorg, but just pass -nographic for now</p></div></blockquote></div><p>yes i am running from inside xorg</p><br /><p>i changed test.sh to:</p><div class="codebox"><pre><code>#qemu-system-x86_64 -enable-kvm -m 1024 -cpu host \ #-smp 6,sockets=1,cores=2,threads=1 \ #-bios /usr/share/qemu/bios.bin -vga none \ #-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ ##-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ #-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none\ -rtc base=localtime \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on -nographic \###altered line to add -nographic -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \</code></pre></div><p>it grabs the terminal and gives no output which makes me assume its working. in order to get the terminal back i have to kill qemu-x86_64(or whatever it was extactly). then when i ran it again</p><p>i got</p><div class="codebox"><pre><code>qemu-system-x86_64: vfio-pci: Cannot read device rom at 0000:01:00.0 Device option ROM contents are probably invalid (check dmesg). Skip option ROM probe with rombar=0, or load from file with romfile= </code></pre></div> <p class="postedit"><em>Last edited by risho (2014-09-08 01:59:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454549">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454550" class="blockpost roweven"> <h2><span><span class="conr">#2679</span> <a href="viewtopic.php?pid=1454550#p1454550">2014-09-08 01:57:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>risho, if you don&#039;t run as root then you need to change the permissions of the files for the user to access them and set the locked memory limit for the user to match that necessary for the guest.&#160; Just run as root and use the -nographic option so that QEMU won&#039;t try to create an SDL window.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454550">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454551" class="blockpost rowodd"> <h2><span><span class="conr">#2680</span> <a href="viewtopic.php?pid=1454551#p1454551">2014-09-08 02:05:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>i got it working. you guys are amazing. thank you so much for the help.</p><p>now i have a couple more questions. i killed qemu and the monitor is still being shown as if the vm were still running. (it&#039;s not even holding the terminal window anymore) how do i correctly shutdown the vm from inside the host?</p> <p class="postedit"><em>Last edited by risho (2014-09-08 02:06:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454551">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454552" class="blockpost roweven"> <h2><span><span class="conr">#2681</span> <a href="viewtopic.php?pid=1454552#p1454552">2014-09-08 02:08:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84564">tuxuser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-23</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>instead of kill the term, if you hit CTRL A C you can get a qemu monitor prompt and just type quit,&#160; &#160;in the log run this is why you want to either setup qemu monitor for telnet access or use gnu screen or some people go libvirt.</p><p>EDIT:&#160; during testing i will do the following:<br />stop<br />system_reset<br />quit</p><br /><p>This cleans up the passthough screen nicely.&#160; &#160;And that&#039;s nice to hear aw&#039;s update about 3.17 <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by tuxuser (2014-09-08 02:13:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454552">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454553" class="blockpost rowodd"> <h2><span><span class="conr">#2682</span> <a href="viewtopic.php?pid=1454553#p1454553">2014-09-08 02:10:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>i got it working. you guys are amazing. thank you so much for the help.</p><p>now i have a couple more questions. i killed qemu and the monitor is still being shown as if the vm were still running. (it&#039;s not even holding the terminal window anymore) how do i correctly shutdown the vm from inside the host?</p></div></blockquote></div><p>Since you&#039;re trying to assign nvidia, this should be fixed in 3.17.&#160; A bus reset will be done when the devices are released if any of the devices require it and all of the affected devices are bound to vfio-pci.&#160; (It will also work for radeon cards that report NoSoftRst+)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454553">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454937" class="blockpost roweven"> <h2><span><span class="conr">#2683</span> <a href="viewtopic.php?pid=1454937#p1454937">2014-09-09 13:56:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have an old idea that i think it is worth a thought. The normal bug/feedback reporting path is tedious and i think most ppls just wait and let somebody else do it. Speaking plainly, how about a site like kerneltest.org, where willing users can/could upload the output of some script or could enable a kernel cli of a module auto reporting tool (or something that is automatic and standardised enough). Sort of something non invasive and only user volontary. Like a sort of automatic reporting tool, not for developers, but for what is actually happening in the wild. I dont mind giving that kind of info as long as its entirely optional/volontary, code is transparent and whats being sent is visible and approvable. I think it would be a lot of good information offered by this process, not to mention nice statistics like how many bugs affect how many machines and of which type. Can be applied different ways, overall or in part. Like if some users want to test some &quot;vfio&quot; branch and have a script report back the issues of that branch exactly. Or if on their turn, are dubious about some other pull request, can ask the guy on that branch to first show say 100 unique reports that patch boots ok on 100 different machines. But something like this needs some form of &quot;official&quot; backing otherwise wont get traction. And has to rely on automatic reporting coz of user lazyness, and also to have a standardisation for data processing. I am generally stumped as how redhat has an automatic bug reporting tool (of sorts) and something much more global like kernel.org does not have a similar straightforward feedback shortcut. Well, not my place to comment, but really its just a thought.<br />Or maybe if you want to provide a script of some sorts, me and maybe a couple of other ppls on the thread would be happy to volonteer running it for you to get whatever info you may wish to have. And that would be in a fairly standardized manner. Meaning the data can be processed further, statistical and so on. In comparison i think most of the comments on the thread are just like any other thread, basic impressions and contextual ones, not quite able to be processed furtner because of not having details like configs, context, versions, etc. Hence quite limited usability and prone to the normal distribution being applied to ppls abilities - to put things in a nice way.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454937">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454943" class="blockpost rowodd"> <h2><span><span class="conr">#2684</span> <a href="viewtopic.php?pid=1454943#p1454943">2014-09-09 14:16:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>system_reset</p></div></blockquote></div><p><strong>system_reset</strong>&#160; -- reset the system || as if you hit the reset button while machine is running; <br /><strong>system_powerdown</strong>&#160; -- send system power down event || as if it would be turned off from inside start menu; if you have sound, you will hear the windows sutdown sound, so this is normal shutdown. Also with this you should not need stop and quit, if the machine closes normally the qemu terminal will close too by itself.<br />in qemu terminal, type &#039;help&#039; for a list of commands, or &#039;info&#039; for getting detailed machine information</p> <p class="postedit"><em>Last edited by noobman (2014-09-09 14:21:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454943">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454965" class="blockpost roweven"> <h2><span><span class="conr">#2685</span> <a href="viewtopic.php?pid=1454965#p1454965">2014-09-09 15:32:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>...<br />I am generally stumped as how redhat has an automatic bug reporting tool (of sorts) and something much more global like kernel.org does not have a similar straightforward feedback shortcut.<br />...</p></div></blockquote></div><p>well, &quot;redhat&quot; is a distro, while &quot;kernel.org&quot; is distro-agnostic software piece (a core one for all the distros out there). &quot;automatic bug reporting tool&quot; assumes some degree of usage of distro&#039;s infrastructure. still feeling stumped?</p><p>p.s. your idea was too vague for me to grasp from the text you wrote (purpose? subject?), but judging by what i think i understood from your posts, this is too little gains for huge trouble to make it work (if possible at all, considering all the distro/setup variety out there)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454965">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1454975" class="blockpost rowodd"> <h2><span><span class="conr">#2686</span> <a href="viewtopic.php?pid=1454975#p1454975">2014-09-09 16:07:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84564">tuxuser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-23</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>system_reset</p></div></blockquote></div><p><strong>system_reset</strong>&#160; -- reset the system || as if you hit the reset button while machine is running; <br /><strong>system_powerdown</strong>&#160; -- send system power down event || as if it would be turned off from inside start menu; if you have sound, you will hear the windows sutdown sound, so this is normal shutdown. Also with this you should not need stop and quit, if the machine closes normally the qemu terminal will close too by itself.<br />in qemu terminal, type &#039;help&#039; for a list of commands, or &#039;info&#039; for getting detailed machine information</p></div></blockquote></div><br /><p>noobman the context that system_reset was suggested was &quot;testing&quot; which you may not have a booted OS (ie no drives attached and just testing pt output).&#160; system_powerdown does not nothing for me at the Seabios screen or inside a installer with no shutdown option.&#160; Of course under normal circumstances you want want to do a graceful shutdown.&#160; I thought this was self explanitory...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1454975">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455020" class="blockpost roweven"> <h2><span><span class="conr">#2687</span> <a href="viewtopic.php?pid=1455020#p1455020">2014-09-09 17:57:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>noobman wrote:</cite><blockquote><div><p>...<br />I am generally stumped as how redhat has an automatic bug reporting tool (of sorts) and something much more global like kernel.org does not have a similar straightforward feedback shortcut.<br />...</p></div></blockquote></div><p>well, &quot;redhat&quot; is a distro, while &quot;kernel.org&quot; is distro-agnostic software piece (a core one for all the distros out there). &quot;automatic bug reporting tool&quot; assumes some degree of usage of distro&#039;s infrastructure. still feeling stumped?</p><p>p.s. your idea was too vague for me to grasp from the text you wrote (purpose? subject?), but judging by what i think i understood from your posts, this is too little gains for huge trouble to make it work (if possible at all, considering all the distro/setup variety out there)</p></div></blockquote></div><p>Yes well, as i said, its not for me to comment, just an ideea. Regarding its implementation, i dont think its impossible, nothing really is. This very thread goes towards doing something that once was not possible. And most likely just like anything else, could be implemented in a variety of ways, not just one. Then the usual, many choices to be made in that regard, etc. About distro related, could be something like only distro having src or pkg for each distro, or being half module half distro script, or maybe just rely on a kernel module alone, dunno. However i certainly think its not &quot;impossible&quot;. These days is hard to find a thing that really is. Harder or easier yes, but impossible - dunno. So the distro part i can see that, but i think its far from being an insurmontable obstacle.</p><p>What i said its just an ideea, having shortest and most standardized feedback possible for what is being done. This is the abstract idea alone. Its not even IT specific, but like information systems, more used in other places/industries which rely on feedback and where quality is a direct function of feedback and how its being implemented. And if in general the quality depends on the feedback, so is the case with kernel: where would kernel be with no bug reports ever. And hence one step further, the better feedback (more accurate, more standardised) should go towards applying same attributes to the release product. Better feedback, better product. Otherwise feedback does not just improve the main process, but nowadays its integral part of many things as a process. As it being universal, for example you can not have a stepper motor without feedback - it just can function without it, feedback is integrated in functioning principle because it needs a closed loop to start with, the entire thing relies on that. Many may consider it differently but the feedback like it is now, bug reports that take 2 weeks + 20 comments before somebody posts an actual gdb trace is something i would (as a matter of personal opinion), i would qualify that lacking, no standardisation, bad or poor quality feedback with as little context info as possible. Then i dunno how something so big and complex as the kernel cand work with that feedback of little drips of info (where it should be a river of information). So yes im still stumped, from the perspective i am looking. Thumbs up for the army of ppls, including volonteers, digging in all that and sorting the issues one by one, from where i am looking that is really nothing short of a miracle.</p><p>So again, ofc it is just an abstract sort of more or less universal idea, widely applicable. The &quot;how to do it&quot; its hierarhically different question. No point going further into it, because its not my place. I just do think that could make a good difference in many situations. Like imagine you look at all the gathered data from 10k machines for xx-test-rc3, and you see 80% having an issue, one could figure out its a regression of some kind from previous, easier and faster to pinpoint. And you dont have to wait 3 months before somebody puts a bug notification and then bisects everything back to rc3 from rc2 to find the culprit. Or we can imagine other scenarios where one branch change is not being credible but it can become so when its backed by xyz reports of running ok. Or the other way around, discard a patch coz of bad reports. We can play with the scenarios like these as long as we want, maybe some can imagine a scenario where it would hurt, but i think in general it would be a good thing, ofc depends on how its implemented and used. Again, as an abstraction any tool cuts both ways, but when it cuts the user, its user fault. No point playing the &quot;what-if&quot; game. </p><p>The context, or the place of this is, i would like to help, i could give feedback, but i am a poor user, very limited in knowledge, and ofc very lazy. In other words typical. So realistically things must not rely on my iq or work ability, else will certainly fail. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> Hence it needs to be automated and standardised. I dont think there is a single company with marketing division providing a feedback that relies on its clients inteligence or their work addiction - or if there is one, i would not buy that stock. So about bad SNR signal to noise ratio - true that, but it can be changed and improved. Not at the user base level (again coz normal repartition is a bitch when applied to human qualities), but it can be changed at the process level.</p><p>Sry cant elaborate further, as i said its just an idea, and pretty abstract one for that matter, tho quite widely applied. Ppls may like or dislike the ideea, again, its just an opinion, mine, im entitled to one, so here it is/was thrown in. All my concerns rest, further idc, so ill rest. Ofc ppls may think differently, and by all means they better should. Thats the good part, and its how things get filtered.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455020">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455041" class="blockpost rowodd"> <h2><span><span class="conr">#2688</span> <a href="viewtopic.php?pid=1455041#p1455041">2014-09-09 19:42:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77651">noobman</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-13</span></dd> <dd><span>Posts: 21</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tuxuser wrote:</cite><blockquote><div><p>noobman the context that system_reset was suggested was &quot;testing&quot; which you may not have a booted OS (ie no drives attached and just testing pt output).&#160; system_powerdown does not nothing for me at the Seabios screen or inside a installer with no shutdown option.&#160; Of course under normal circumstances you want want to do a graceful shutdown.&#160; I thought this was self explanitory...</p></div></blockquote></div><p>Yes sry then my bad, i assumed it was an os running inside the machine. Otherwise i (personally) dont care how i shut down the vm. If i have an os running, only then i care because i have open files, could loose data, etc, and then if i just close the process then windows will have dirty bit set and next time will scandisk at boot time. Else with no software in machine i would not care how i close it (but that might be just my personal choice). Anyway i didnt thought of that case really, i just assumed the machine has an os.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455041">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455104" class="blockpost roweven"> <h2><span><span class="conr">#2689</span> <a href="viewtopic.php?pid=1455104#p1455104">2014-09-09 23:06:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It would be nice to see a X99 motherboard do this as a multi-headed PC.</p><p>And I want to show off my work, but I want to show a Linux Distro (host), VM1(Windows) and VM2(MAC OS), the problem is, where do I get MAC OS !? it seems they only come with apple MACs.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455104">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455120" class="blockpost rowodd"> <h2><span><span class="conr">#2690</span> <a href="viewtopic.php?pid=1455120#p1455120">2014-09-10 00:58:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84905">zsph</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-04</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84905">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have a problem with suspend/resume my host. I searched the whole thread and this topic was brought up a few times but I couldn&#039;t get any hints. After using qemu and successfully shutting down the Windows guest I can no longer send the host to sleep. My desktop remains visible and frozen. </p><p>Afterwards I tried to run qemu without disks to only show seabieos, hoping it would release or reset the vfio devices. That way I can suspend but when resuming back there is no signal from iGPU, even REISUB doesn&#039;t help. Only hard reset.</p><p>I also tried to unbind the devices from vfio-pci and bind to drivers_probe but it didn&#039;t work out.</p> </div> <div class="postsignature postmsg"><hr /><p>Asus P8Z77-V LK, Core i7 3770, Asus NVIDIA GTX 770 DirectCU II OC, Debian x64, EFI, Kernel 3.16 + i915 arbiter patch. <br />3DMark11: bare metal <a href="http://www.3dmark.com/3dm11/8748717" rel="nofollow">P10231</a> vs vfio <a href="http://www.3dmark.com/3dm11/8754453" rel="nofollow">P10039</a>: 98% of performance!</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455120">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455124" class="blockpost roweven"> <h2><span><span class="conr">#2691</span> <a href="viewtopic.php?pid=1455124#p1455124">2014-09-10 01:33:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84538">mauorrizze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-22</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84538">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>[...] the problem is, where do I get MAC OS !? it seems they only come with apple MACs.</p></div></blockquote></div><p>Apple forbids the installation of OSX on non-Apple-hardware and there even don&#039;t exist installation discs any more. <em>&lt;Moderator edit.&#160; Redacted&gt;</em></p><p>It might be allowed to run a virtualized OSX with Linux KVM on Apple hardware. But if one would try something like this, it might be best to use a graphics card that is natively supported in OS X -&gt; <a href="http://wiki.osx86project.org/wiki/index.php/Main_Page" rel="nofollow">hardware database</a><br />KVM infos:<br /><a href="http://www.contrib.andrew.cmu.edu/~somlo/OSXKVM/" rel="nofollow">http://www.contrib.andrew.cmu.edu/~somlo/OSXKVM/</a> (page 28 in this thread)<br /><a href="http://www.reddit.com/r/hackintosh/comments/2fpf2d/has_anyone_virtualised_mac_os_x_in_kvm_with_vga/" rel="nofollow">http://www.reddit.com/r/hackintosh/comm … _with_vga/</a></p> <p class="postedit"><em>Last edited by ewaller (2014-09-10 02:26:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455124">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455134" class="blockpost rowodd"> <h2><span><span class="conr">#2692</span> <a href="viewtopic.php?pid=1455134#p1455134">2014-09-10 02:24:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=27289">ewaller</a></strong></dt> <dd class="usertitle"><strong>Forum Moderator</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/27289.jpg?m=1406180442" width="80" height="80" alt="" /></dd> <dd><span>From: Pasadena, CA</span></dd> <dd><span>Registered: 2009-07-13</span></dd> <dd><span>Posts: 10,547</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=27289">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>As a moderator, I am obliged to step in here and insist there be no further discussion that encourages or provides information as to violate copyright restrictions.&#160; <br /><a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Legality" rel="nofollow">Our policy with regards to the facilitation of copyright violation</a></p><p>Thank you.</p> </div> <div class="postsignature postmsg"><hr /><p>Nothing is too wonderful to be true, if it be consistent with the laws of nature -- <em>Michael Faraday</em><br />Like you, I have no idea what you are doing, but I am pretty sure it is wrong...<em>Jasonwryan</em><br />----<br /><a href="http://www.catb.org/~esr/faqs/smart-questions.html" rel="nofollow">How to Ask Questions the Smart Way</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455134">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455162" class="blockpost roweven"> <h2><span><span class="conr">#2693</span> <a href="viewtopic.php?pid=1455162#p1455162">2014-09-10 05:48:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84881">friedcpu</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-03</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone tried running any EA Origin Games in their Windows VM?</p><p>I am running Windows 7 x64 Enterprise and trying to run The Sims 4 (for the mrs, got to keep her happy) and it just refuses to open, I can see in task manager it opens the process, and then it just dies, can&#039;t find anything in any log files in Windows telling me whats going on and nothing happens on screen. If I boot the hard drive natively it works fine (installed windows through qemu and all drivers, I just swap the gfx card back to slot 1 and boot natively to test). My qemu settings are </p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 16384 -cpu host,kvm=off \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/sde,id=boot,format=raw -device scsi-hd,drive=boot \ -drive file=/dev/sdf,id=storage,format=raw -device scsi-hd,drive=storage \ -usb -usbdevice host:046d:c07d -usbdevice host:of39:1084 \ -nographic -boot menu=on</code></pre></div><p>System specs are:<br />ASUS x79-deluxe Motherboard<br />Intel 4930k CPU<br />64GB RAM<br />3x250GB Samsung EVO SSD (1 host, 1 for each VM)<br />2x3TB WD RED (1 for each VM)<br />1x2TB Seagate (for host, other VMs with no GPU passthrough)<br />AMD HD5450 (Host)<br />NVIDIA GTX550Ti (Yet Unknown VM)<br />NVIDIA GTX770 (Windows VM)</p><p>I have also tried with passing through the sata controller (which works on first boot, but if I reboot the VM it causes seabios to hang, can&#039;t figure it out its an ASM1602 Which is known to be a problem in passthrough) but still no difference. There isn&#039;t really any performance gain from using native sata than the scsi controller.</p><p>Any help would be greatly appreciated, otherwise I&#039;m going to have to keep a separate Windows install just for her to boot natively thus shutting down all my VM&#039;s <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> <p class="postedit"><em>Last edited by friedcpu (2014-09-10 05:49:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455162">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455270" class="blockpost rowodd"> <h2><span><span class="conr">#2694</span> <a href="viewtopic.php?pid=1455270#p1455270">2014-09-10 15:26:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>friedcpu wrote:</cite><blockquote><div><p>Has anyone tried running any EA Origin Games in their Windows VM?</p></div></blockquote></div><p>Isn&#039;t BF4 an EA Origin game?&#160; We seem to have reports of that working.&#160; I try to avoid EA on principle.</p><p>Have you tried the ignore_msrs=1 option for the kvm module?</p><p>Did you re-install the game as well as the OS?&#160; Perhaps some of the DRM that EA is so well known for doesn&#039;t like the change in computer platform.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455367" class="blockpost roweven"> <h2><span><span class="conr">#2695</span> <a href="viewtopic.php?pid=1455367#p1455367">2014-09-10 19:09:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I will post this little Python script that I made which grabs device ids from linux commandline and returns the corresponding PCI bus ids, useful to pass returning list to vfio-bind script:</p><div class="codebox"><pre class="vscroll"><code>#!/usr/bin/env python &quot;&quot;&quot;This script grabs pci bus from vendor:device using pci stubs from linux cmdline&quot;&quot;&quot; from subprocess import Popen, PIPE PCISTUB_CMD = &quot;pci-stub.ids=&quot; def shell(cmd, args = &quot;&quot;): &quot;&quot;&quot;Runs shell command&quot;&quot;&quot; proc = Popen([cmd, args], stdout = PIPE, stderr = PIPE) result, error = proc.communicate() if error: raise Exception(error) return result def get_linux_pcistub(): &quot;&quot;&quot;Returns dev ids list&quot;&quot;&quot; linux_cmds = shell(&quot;cat&quot;, &quot;/proc/cmdline&quot;) for cmd in linux_cmds.split(&quot; &quot;): if PCISTUB_CMD in cmd: return cmd.split(&quot;=&quot;)[1] pcidevs = &quot;&quot; devids = get_linux_pcistub() if devids is not None: for devid in devids.split(&quot;,&quot;): if devid: #devid is valid pcdidevid = shell(&quot;lspci&quot;, &quot;-d &quot; + devid) if pcdidevid: #we found existing pci bus pcidevs += &quot; 0000:&quot; + pcdidevid[:7] print(pcidevs)</code></pre></div> <p class="postedit"><em>Last edited by Cubex (2014-09-10 19:22:12)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455367">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455512" class="blockpost rowodd"> <h2><span><span class="conr">#2696</span> <a href="viewtopic.php?pid=1455512#p1455512">2014-09-11 10:19:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85041">guildem</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85041">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I all, I have some trouble when I try to do a vga passthrough with my system.</p><p>First thing, sorry for my bad english, i&#039;m french, and you know what they say about french people and foreign languages <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>So this is my config : </p><p>CM: Asrock Z97 Extreme 6<br />Proc: i7 4790k<br />Ram: 16GB<br />Host GPU: HD Graphics 4600<br />Guest GPU: Radeon HD 5850</p><p>Some informations : </p><p>- I use only repo packages, with last updates, no AUR, no patches<br />- kernel 3.16.2-1, qemu 2.1.0-2</p><p>My lspci dump : </p><div class="quotebox"><blockquote><div><p>02:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Cypress PRO [Radeon HD 5850] [1002:6899] (prog-if 00 [VGA controller])<br />02:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cypress HDMI Audio [Radeon HD 5800 Series] [1002:aa50]</p></div></blockquote></div><p>On my syslinux boot i added : </p><div class="quotebox"><blockquote><div><p>intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=1002:6899,1002:aa50</p></div></blockquote></div><p>I&#039;ve added this script : </p><div class="quotebox"><blockquote><div><p>vfio-bind 0000:02:00.0 0000:02:00.1</p></div></blockquote></div><p>And this is my qemu command : </p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \<br />&#160; &#160; -smp 4,sockets=1,cores=4,threads=1 \<br />&#160; &#160; -usbdevice tablet -usbdevice host:046d:c52e \<br />&#160; &#160; -bios /usr/share/qemu/bios.bin -vga cirrus \<br />&#160; &#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; &#160; -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />&#160; &#160; -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 \<br />&#160; &#160; -device piix4-ide,bus=pcie.0,id=piix4-ide \<br />&#160; &#160; -drive file=seven.img,id=disk,format=qcow2 -device ide-hd,bus=piix4-ide.0,drive=disk \<br />&#160; &#160; -drive file=software/iso/windows-seven-x64.iso,id=isocd -device ide-cd,bus=piix4-ide.1,drive=isocd \<br />&#160; &#160; -soundhw hda</p></div></blockquote></div><p>And now the weird thing : you&#039;ll notice the &quot;-vga cirrus&quot; option. when I put this option on cirrus, I boot on a cirrus card, and view my Seven desktop (all installed). If I try to view my graphic cards on the guest, I see 2 cards, the &quot;cirrus&quot; one acting as a VGA standard graphic card, and a second one &quot;AMD Radeon HD 5800 Series&quot; (i installed AMD&#039;s Catalyst driver), with an error : &quot;this device can&#039;t find enough free resources to work correctly&quot; (translated from French).</p><p>If I put a &quot;-vga none&quot; option on my qemu, I see only the compat_monitor console and nothing shown on my AMD VGA screen. And I have the color glitch on my iGPU screen (I go on tty mode and go back on X to remove it).</p><p>I don&#039;t know what else I can do to have something on my AMD screen...</p><p>Thanks for your help !</p><p>Guildem</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455512">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455514" class="blockpost roweven"> <h2><span><span class="conr">#2697</span> <a href="viewtopic.php?pid=1455514#p1455514">2014-09-11 10:23:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I all, I have some trouble when I try to do a vga passthrough with my system.</p><p>First thing, sorry for my bad english, i&#039;m french, and you know what they say about french people and foreign languages <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>...</p><p>If I put a &quot;-vga none&quot; option on my qemu, I see only the compat_monitor console and nothing shown on my AMD VGA screen. And I have the color glitch on my iGPU screen (I go on tty mode and go back on X to remove it).</p><p>I don&#039;t know what else I can do to have something on my AMD screen...</p><p>Thanks for your help !</p><p>Guildem</p></div></blockquote></div><p>Have you even read first post?</p><p>Anyway, you need to patch your kernel with i915 vgaarb patch.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455514">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455536" class="blockpost rowodd"> <h2><span><span class="conr">#2698</span> <a href="viewtopic.php?pid=1455536#p1455536">2014-09-11 12:07:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85041">guildem</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85041">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I all, I have some trouble when I try to do a vga passthrough with my system.</p><p>First thing, sorry for my bad english, i&#039;m french, and you know what they say about french people and foreign languages <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>...</p><p>If I put a &quot;-vga none&quot; option on my qemu, I see only the compat_monitor console and nothing shown on my AMD VGA screen. And I have the color glitch on my iGPU screen (I go on tty mode and go back on X to remove it).</p><p>I don&#039;t know what else I can do to have something on my AMD screen...</p><p>Thanks for your help !</p><p>Guildem</p></div></blockquote></div><p>Have you even read first post?</p><p>Anyway, you need to patch your kernel with i915 vgaarb patch.</p></div></blockquote></div><p>HI dwe11er, </p><p>Thank you for your answer. Yes, I saw the first post, and other articles too. I didn&#039;t view all the pages but I tried to find some informations. </p><p>I am not an expert and I try to learn all those things, but posts I found talk about many distribs, many kernels, many case (intel or amd cpu, amd or nvidia gpu,...). So this is difficult&#160; to find a good answer for my configuration. </p><p>I didn&#039;t used patches because I found people saying that they didn&#039;t patch their kernel. With your answer, I think that those people have an amd cpu. <br />I saw this i915 vgaarb patch may be in the 3.17 RC3 kernel. Is it true? I&#039;ll try to find informations about this patch. And I&#039;ll may compile the patched kernel of the first post to try it... or wait for 3.17... </p><p>I was thinking if I see the graphic card on the guest, all was OK with my stock kernel. </p><p>Thanks again! </p><p>Guildem</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455536">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455552" class="blockpost roweven"> <h2><span><span class="conr">#2699</span> <a href="viewtopic.php?pid=1455552#p1455552">2014-09-11 13:05:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I saw this i915 vgaarb patch may be in the 3.17 RC3 kernel. Is it true?</p></div></blockquote></div><p>No, the <em>other</em> VGA arbiter patch is in 3.17, the i915 patch is not currently scheduled for any upstream kernel and is a blocking issue for using an unmodified kernel for users with IGD.&#160; Those reporting success with an unmodified kernel probably don&#039;t have IGD or are not following the directions and using their GPU as a secondary card for the VM.&#160; Please see the articles at the URL below, especially the FAQ for more info.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455552">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1455558" class="blockpost rowodd"> <h2><span><span class="conr">#2700</span> <a href="viewtopic.php?pid=1455558#p1455558">2014-09-11 13:20:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85041">guildem</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-11</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85041">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>guildem wrote:</cite><blockquote><div><p>I saw this i915 vgaarb patch may be in the 3.17 RC3 kernel. Is it true?</p></div></blockquote></div><p>No, the <em>other</em> VGA arbiter patch is in 3.17, the i915 patch is not currently scheduled for any upstream kernel and is a blocking issue for using an unmodified kernel for users with IGD.&#160; Those reporting success with an unmodified kernel probably don&#039;t have IGD or are not following the directions and using their GPU as a secondary card for the VM.&#160; Please see the articles at the URL below, especially the FAQ for more info.</p></div></blockquote></div><p>Thanks aw, that is not a good news... i&#039;ll read the posts on your link too.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1455558">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=107">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <a href="viewtopic.php?id=162768&amp;p=107">107</a> <strong>108</strong> <a href="viewtopic.php?id=162768&amp;p=109">109</a> <a href="viewtopic.php?id=162768&amp;p=110">110</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=109">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
