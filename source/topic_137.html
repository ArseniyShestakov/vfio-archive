<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 137) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=137" title="Page 137" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=136" title="Page 136" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=138" title="Page 138" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=136">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=135">135</a> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <strong>137</strong> <a href="viewtopic.php?id=162768&amp;p=138">138</a> <a href="viewtopic.php?id=162768&amp;p=139">139</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=138">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1478545" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3401</span> <a href="viewtopic.php?pid=1478545#p1478545">2014-11-24 08:01:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>OMG... Today will be a party day!!!!! It&#039;s working!!!</p><p>All of you are the masters of knowledge and the kings of wisdom!!!!</p><p>There are not enough words to express my happiness right now!</p><p>If exists a donation place I will do it right now and if not, please, let me know if any of you is in Norway and I will invite him/her to a beer!!!!</p><p>Amazing!!!!!! Thanks a lot!!!!!</p></div></blockquote></div><p>So setting those options seems necessary on new Intel platforms (X99-Z97) .</p><p>Happy to see that you got it working <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>I&#039;m not expert so I&#160; cannot be sure if it&#039;s necessary on these chipsets only but now the solution is on this forum for eternity <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Really I&#039;m the most happy guy in the world right now and all thanks to all of you. I made my donation really happy! Please... never change! Best community ever!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478545">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478559" class="blockpost roweven"> <h2><span><span class="conr">#3402</span> <a href="viewtopic.php?pid=1478559#p1478559">2014-11-24 09:44:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve noticed that my disk subsystem is bottlenecking my game.<br />I&#039;m using a virtio-blk-pci device with 60GB raw image cache=none(i thought that windows would cache disk adequately, foolish me) on my 750GB 5-years-old-with-few-badsectors-louder-than-a-CNC-mill WD caviar black hdd.</p><p>So i&#039;ve created a new image sized 10GB in some directory mounted on the system SSD disk, sized 10GB. Attached it as an another virtio-blk-pci device to my windows VM and...<br />The disk image had 10GB of zeroes inside, so windows suggested initializing it in diskmgmt.msc, allowing me to choose between MBR and GPT(windows 7!). That again proves that i am right saying you do not need windows 8 to run on pure EFI.</p><p>So i&#039;ve moved my steam library to&#160; the new disk image, and i want to show you a neat little trick: windows has symlinks. Kind of. You can attach a drive as an empty NTFS folder, which is useful for some applications that load their data from a fixed location(like user&#039;s documents folder), but the folder must be empty.</p><p>Now the disk IO lags are gone, yay for me.</p></div></blockquote></div><p>Put stuff on LVM instead of file based images.</p><p><a href="https://dl.dropboxusercontent.com/u/17379792/io_test.png" rel="nofollow">Screenshot</a>. I&#039;ve got LVM on top of dm-crypt on top of mdadm&#039;s RAID1 (2x 1TB Barracuda ES.2). All of the disks (windows and steam are separate) are:</p><ul><li><p>raw images</p></li><li><p>cache set to none</p></li><li><p>aio set to native</p></li><li><p>ioeventfd set to on</p></li><li><p>x-data-plane set to on</p></li><li><p>steam drive has contiguous allocation</p></li></ul> <p class="postedit"><em>Last edited by dwe11er (2014-11-24 09:59:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478559">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478568" class="blockpost rowodd"> <h2><span><span class="conr">#3403</span> <a href="viewtopic.php?pid=1478568#p1478568">2014-11-24 10:40:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve noticed that my disk subsystem is bottlenecking my game.<br />I&#039;m using a virtio-blk-pci device with 60GB raw image cache=none(i thought that windows would cache disk adequately, foolish me) on my 750GB 5-years-old-with-few-badsectors-louder-than-a-CNC-mill WD caviar black hdd.</p><p>So i&#039;ve created a new image sized 10GB in some directory mounted on the system SSD disk, sized 10GB. Attached it as an another virtio-blk-pci device to my windows VM and...<br />The disk image had 10GB of zeroes inside, so windows suggested initializing it in diskmgmt.msc, allowing me to choose between MBR and GPT(windows 7!). That again proves that i am right saying you do not need windows 8 to run on pure EFI.</p><p>So i&#039;ve moved my steam library to&#160; the new disk image, and i want to show you a neat little trick: windows has symlinks. Kind of. You can attach a drive as an empty NTFS folder, which is useful for some applications that load their data from a fixed location(like user&#039;s documents folder), but the folder must be empty.</p><p>Now the disk IO lags are gone, yay for me.</p></div></blockquote></div><p>Put stuff on LVM instead of file based images.</p><p><a href="https://dl.dropboxusercontent.com/u/17379792/io_test.png" rel="nofollow">Screenshot</a>. I&#039;ve got LVM on top of dm-crypt on top of mdadm&#039;s RAID1 (2x 1TB Barracuda ES.2). All of the disks (windows and steam are separate) are:</p><ul><li><p>raw images</p></li><li><p>cache set to none</p></li><li><p>aio set to native</p></li><li><p>ioeventfd set to on</p></li><li><p>x-data-plane set to on</p></li><li><p>steam drive has contiguous allocation</p></li></ul></div></blockquote></div><br /><p>I am also using LVM and can confirm that it works really good. However, can you post your qemu command-line please? I&#039;d like to try some the optimization you are using, and I also would like to see how you &quot;call&quot; your LVM parition (ie: i&#039;m only doing this: &quot;-drive file=/dev/guest/win7,id=data,format=raw -device scsi-hd,drive=data&quot;).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478572" class="blockpost roweven"> <h2><span><span class="conr">#3404</span> <a href="viewtopic.php?pid=1478572#p1478572">2014-11-24 10:59:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;ve noticed that my disk subsystem is bottlenecking my game.<br />I&#039;m using a virtio-blk-pci device with 60GB raw image cache=none(i thought that windows would cache disk adequately, foolish me) on my 750GB 5-years-old-with-few-badsectors-louder-than-a-CNC-mill WD caviar black hdd.</p><p>So i&#039;ve created a new image sized 10GB in some directory mounted on the system SSD disk, sized 10GB. Attached it as an another virtio-blk-pci device to my windows VM and...<br />The disk image had 10GB of zeroes inside, so windows suggested initializing it in diskmgmt.msc, allowing me to choose between MBR and GPT(windows 7!). That again proves that i am right saying you do not need windows 8 to run on pure EFI.</p><p>So i&#039;ve moved my steam library to&#160; the new disk image, and i want to show you a neat little trick: windows has symlinks. Kind of. You can attach a drive as an empty NTFS folder, which is useful for some applications that load their data from a fixed location(like user&#039;s documents folder), but the folder must be empty.</p><p>Now the disk IO lags are gone, yay for me.</p></div></blockquote></div><p>Put stuff on LVM instead of file based images.</p><p><a href="https://dl.dropboxusercontent.com/u/17379792/io_test.png" rel="nofollow">Screenshot</a>. I&#039;ve got LVM on top of dm-crypt on top of mdadm&#039;s RAID1 (2x 1TB Barracuda ES.2). All of the disks (windows and steam are separate) are:</p><ul><li><p>raw images</p></li><li><p>cache set to none</p></li><li><p>aio set to native</p></li><li><p>ioeventfd set to on</p></li><li><p>x-data-plane set to on</p></li><li><p>steam drive has contiguous allocation</p></li></ul></div></blockquote></div><br /><p>I am also using LVM and can confirm that it works really good. However, can you post your qemu command-line please? I&#039;d like to try some the optimization you are using, and I also would like to see how you &quot;call&quot; your LVM parition (ie: i&#039;m only doing this: &quot;-drive file=/dev/guest/win7,id=data,format=raw -device scsi-hd,drive=data&quot;).</p></div></blockquote></div><p>I&#039;m using libvirt to start my VMs. Anyway, here is libvirt&#039;s command-line (I&#039;ve truncated not relevant stuff):</p><div class="codebox"><pre><code>/usr/sbin/qemu-system-x86_64 -name windows -S -machine pc-i440fx-2.1,accel=kvm,usb=off -cpu host,hv_time,-kvm_pv_eoi,hv_relaxed,hv_vapic,hv_spinlocks=0x1fff -m 8192 -realtime mlock=off -smp 6,sockets=1,cores=3,threads=2 -nographic -no-user-config -nodefaults -rtc base=localtime,clock=vm,driftfix=slew -global kvm-pit.lost_tick_policy=discard -no-hpet -no-shutdown ... -drive file=/dev/storage/windows-ovmf,if=none,id=drive-virtio-disk0,format=raw,aio=native -device virtio-blk-pci,ioeventfd=on,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/dev/storage/steam,if=none,id=drive-virtio-disk1,format=raw,aio=native -device virtio-blk-pci,ioeventfd=on,scsi=off,bus=pci.0,addr=0x6,drive=drive-virtio-disk1,id=virtio-disk1 ... -device vfio-pci,host=00:1b.0,id=hostdev0,bus=pci.0,addr=0x2 -device vfio-pci,host=01:00.0,id=hostdev1,bus=pci.0,multifunction=on,addr=0x7 -device vfio-pci,host=01:00.1,id=hostdev2,bus=pci.0,addr=0x7.0x1 -device usb-host,hostbus=2,hostaddr=5,id=hostdev3 ... -set device.virtio-disk0.scsi=off -set device.virtio-disk0.x-data-plane=on -set device.virtio-disk1.scsi=off -set device.virtio-disk1.x-data-plane=on -msg timestamp=on</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478572">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478585" class="blockpost rowodd"> <h2><span><span class="conr">#3405</span> <a href="viewtopic.php?pid=1478585#p1478585">2014-11-24 11:51:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks dwe11er!</p><p>If I remember correctly OP (or someone else) compiled OVMF from git and gave a link to binaries. Anyone could share this link please?</p> <p class="postedit"><em>Last edited by Nesousx (2014-11-24 11:51:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478585">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478589" class="blockpost roweven"> <h2><span><span class="conr">#3406</span> <a href="viewtopic.php?pid=1478589#p1478589">2014-11-24 12:05:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Thanks dwe11er!</p><p>If I remember correctly OP (or someone else) compiled OVMF from git and gave a link to binaries. Anyone could share this link please?</p></div></blockquote></div><br /><p><a href="https://drive.google.com/folderview?id=0Bxp_MsrVrNnEQ3hSTkZkbFJtXzg&amp;usp=sharing" rel="nofollow">OVMF-26830e8.tar.gz</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478589">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478641" class="blockpost rowodd"> <h2><span><span class="conr">#3407</span> <a href="viewtopic.php?pid=1478641#p1478641">2014-11-24 14:52:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks nbhs. @dwe11er, after a quick test here, I have way better disk perf if I do not specify &quot;aio=native,cache=none&quot;. I will do more tests if I have time, and report here. I just wanted to let you know, that you may be able to get better perf too. Unless those values you get are very close from your bare metal config.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478641">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478645" class="blockpost roweven"> <h2><span><span class="conr">#3408</span> <a href="viewtopic.php?pid=1478645#p1478645">2014-11-24 15:00:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>OMG... Today will be a party day!!!!! It&#039;s working!!!</p><p>All of you are the masters of knowledge and the kings of wisdom!!!!</p><p>There are not enough words to express my happiness right now!</p><p>If exists a donation place I will do it right now and if not, please, let me know if any of you is in Norway and I will invite him/her to a beer!!!!</p><p>Amazing!!!!!! Thanks a lot!!!!!</p></div></blockquote></div><p>So setting those options seems necessary on new Intel platforms (X99-Z97) .</p><p>Happy to see that you got it working <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>I&#039;m not expert so I&#160; cannot be sure if it&#039;s necessary on these chipsets only but now the solution is on this forum for eternity <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Well, I&#039;d prefer to have a bit more closure than instructions to apply a long list of arbitrary module options.&#160; Any chance you could whittle down the list of options and figure out what fixed it?</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="codebox"><pre><code>options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div></div></blockquote></div><p>Most of these seem completely unnecessary to me, especially the vfio options.&#160; APICv is already enabled by default when available, so that&#039;s a no-op.&#160; nested=1, why?&#160; You&#039;re not doing nesting.&#160; ignore_msrs=1 is the only thing I have set on my box.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478645">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478648" class="blockpost rowodd"> <h2><span><span class="conr">#3409</span> <a href="viewtopic.php?pid=1478648#p1478648">2014-11-24 15:11:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Nesousx wrote:</cite><blockquote><div><p>Thanks nbhs. @dwe11er, after a quick test here, I have way better disk perf if I do not specify &quot;aio=native,cache=none&quot;. I will do more tests if I have time, and report here. I just wanted to let you know, that you may be able to get better perf too. Unless those values you get are very close from your bare metal config.</p></div></blockquote></div><p>Might be. My main testing method was &#039;no sound stuttering during heavy I/O&#039; and it&#039;s ok with these settings <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478648">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478666" class="blockpost roweven"> <h2><span><span class="conr">#3410</span> <a href="viewtopic.php?pid=1478666#p1478666">2014-11-24 16:04:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71471">dRaiser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Poland</span></dd> <dd><span>Registered: 2013-05-20</span></dd> <dd><span>Posts: 49</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pw@draiser.net">Email</a></span> <span class="website"><a href="http://draiser.net/en" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I just want to share my sucess story <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" />.</p><p>I&#039;m running sucessfully Arch Linux with Nvidia driver with Qemu machine with Windows 7. My CPU&#039;s i5-3550, motherboard&#039;s AsRock Z77 Extreme4, host GPU&#039;s GeForce 9800 GTX+, guest GPU&#039;s Radeon 4850. Working just great, using obviously mainline kernel from OP PKG.</p><p>Some write-up with my thoughts if anyone&#039;s interested: <a href="http://tech.draiser.net/2014/11/23/kvmqemu-gaming-machine/" rel="nofollow">http://tech.draiser.net/2014/11/23/kvmq … g-machine/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478666">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478710" class="blockpost rowodd"> <h2><span><span class="conr">#3411</span> <a href="viewtopic.php?pid=1478710#p1478710">2014-11-24 17:27:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>So setting those options seems necessary on new Intel platforms (X99-Z97) .</p><p>Happy to see that you got it working <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>I&#039;m not expert so I&#160; cannot be sure if it&#039;s necessary on these chipsets only but now the solution is on this forum for eternity <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Well, I&#039;d prefer to have a bit more closure than instructions to apply a long list of arbitrary module options.&#160; Any chance you could whittle down the list of options and figure out what fixed it?</p><div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="codebox"><pre><code>options kvm ignore_msrs=1 options intel_kvm emulate_invalid_guest_state=0 options intel_kvm nested=1 options intel_kvm enable_shadow_vmcs=1 options intel_kvm enable_apicv=1 options intel_kvm ept=1 options vfio_pci nointxmask=1 options vfio_iommu_type1 disable_hugepages=1 options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div></div></blockquote></div><p>Most of these seem completely unnecessary to me, especially the vfio options.&#160; APICv is already enabled by default when available, so that&#039;s a no-op.&#160; nested=1, why?&#160; You&#039;re not doing nesting.&#160; ignore_msrs=1 is the only thing I have set on my box.</p></div></blockquote></div><p>Ok, I will test one by one to check what fixed it <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>But give me 24 hours or so <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>And thanks a lot!!!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478710">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478746" class="blockpost roweven"> <h2><span><span class="conr">#3412</span> <a href="viewtopic.php?pid=1478746#p1478746">2014-11-24 18:31:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Most of these seem completely unnecessary to me, especially the vfio options.&#160; APICv is already enabled by default when available, so that&#039;s a no-op.&#160; nested=1, why?&#160; You&#039;re not doing nesting.&#160; ignore_msrs=1 is the only thing I have set on my box.</p></div></blockquote></div><p>I know . There was a time when I completely commented out every line of those options and the VMs booted just fine . But they weren&#039;t stable after hours of operation . Plus , with them on , both of my VMs can boot fine at the same time (2 seperate GPUs , one to each VM) .</p><p>THe masking option is needed in my case , otherwise the whole VM goes into SloMo mode . <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;ll comment out the APICv + nested + shadow_vmcs + ept from now on though . I already commented out the disable_hugepages one for a month or so , no problem .</p><p>I didn&#039;t need any of these options when I was using Z77 .. X99 is more troublesome to setup . ALOT . And there is no way I can reboot any VM with GPU assigned to it without crashing the host <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> It is the ONLY remaining issue I have now .</p><p>They reboot fine , until I install Nvidia&#039;s drivers and then they crash the host whenever I reboot them .</p> <p class="postedit"><em>Last edited by Denso (2014-11-24 18:31:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478746">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478753" class="blockpost rowodd"> <h2><span><span class="conr">#3413</span> <a href="viewtopic.php?pid=1478753#p1478753">2014-11-24 18:48:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Most of these seem completely unnecessary to me, especially the vfio options.&#160; APICv is already enabled by default when available, so that&#039;s a no-op.&#160; nested=1, why?&#160; You&#039;re not doing nesting.&#160; ignore_msrs=1 is the only thing I have set on my box.</p></div></blockquote></div><p>I know . There was a time when I completely commented out every line of those options and the VMs booted just fine . But they weren&#039;t stable after hours of operation . Plus , with them on , both of my VMs can boot fine at the same time (2 seperate GPUs , one to each VM) .</p></div></blockquote></div><p>I do this too, one AMD + one Nvidia.&#160; AFAIK, I only need ignore_msrs so that passmark performance test works</p><div class="quotebox"><blockquote><div><p>THe masking option is needed in my case , otherwise the whole VM goes into SloMo mode . <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>That&#039;s specific to a device you&#039;re assigning, not likely related to the chipset.&#160; The option overrides our detection of whether the device supports INTxDisable masking and instead masks the interrupt at the APIC instead of the device.&#160; The huge downside of that is that it requires the device has an exclusive interrupt because of the difference in where we mask the interrupt.&#160; Also note:</p><p>$ modinfo vfio-pci<br />...<br />parm:&#160; &#160; &#160; &#160; &#160; &#160;nointxmask:Disable support for PCI 2.3 style INTx masking.&#160; <strong>If this resolves problems for specific devices, report lspci -vvvxxx to linux-pci@vger.kernel.org so the device can be fixed automatically via the broken_intx_masking flag</strong>. (bool)</p><p>Have you done that?&#160; This option would apply automatically to just that device if you did...</p><div class="quotebox"><blockquote><div><p>I&#039;ll comment out the APICv + nested + shadow_vmcs + ept from now on though . I already commented out the disable_hugepages one for a month or so , no problem .</p><p>I didn&#039;t need any of these options when I was using Z77 .. X99 is more troublesome to setup . ALOT . And there is no way I can reboot any VM with GPU assigned to it without crashing the host <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> It is the ONLY remaining issue I have now .</p><p>They reboot fine , until I install Nvidia&#039;s drivers and then they crash the host whenever I reboot them .</p></div></blockquote></div><p>Aside from the two Radeon reset issues (R7790 and similar can only be used once per boot and HD8570 and similar mistakenly report NoSoftRst-) I don&#039;t know of any other GPU reset issues, nor do I see why X99 would be more or less problematic than Z77 in that respect.</p><p>EDIT: Nvidia cards have pretty terrible DisableINTx support on the audio device (esp. Quadro and even fake Quadro), but the better option there is typically to make the guest driver use MSI, not to run with nointxmask</p> <p class="postedit"><em>Last edited by aw (2014-11-24 18:54:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478753">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478789" class="blockpost roweven"> <h2><span><span class="conr">#3414</span> <a href="viewtopic.php?pid=1478789#p1478789">2014-11-24 19:56:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>Have you done that?&#160; This option would apply automatically to just that device if you did...</p></div></blockquote></div><p>Reported just now <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Will try to comment out nointxmask=1 and see if reboot issues are resolved .</p><div class="quotebox"><blockquote><div><p>nor do I see why X99 would be more or less problematic than Z77 in that respect.</p></div></blockquote></div><p>I don&#039;t think its X99&#039;s fault , but rather ASUS&#039;s .</p><p>EDIT : </p><p>Confirmed . Commenting out nointxmask=1 solves the reboot issue in one VM . The second one , reboots fine and Windows loads fine until it reaches the login screen , then it goes into black screen . The good news is that the host doesn&#039;t crash anymore <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Now . I just have to wait for my USB PCI-E card to be fixed so I wouldn&#039;t need nointxmask=1 .</p><p>EDIT 2 :</p><p>Enabling MSI in the second 8.1 VM fixed its reboots issue completely ! Thanks Alex ! <del>One more question , I&#039;m about to reinstall Windows 8.1 on this particular VM . can I export the &quot;MessageSignaledInterruptProperties&quot; key to a .reg file and just apply it to the new installed OS ? Or should I just do it manually again ?</del> EDIT : Yes , it works when exported to a .reg file .</p> <p class="postedit"><em>Last edited by Denso (2014-11-24 20:48:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478789">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478827" class="blockpost rowodd"> <h2><span><span class="conr">#3415</span> <a href="viewtopic.php?pid=1478827#p1478827">2014-11-24 21:34:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>Have you done that?&#160; This option would apply automatically to just that device if you did...</p></div></blockquote></div><p>Reported just now <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p><p>Will try to comment out nointxmask=1 and see if reboot issues are resolved .</p><div class="quotebox"><blockquote><div><p>nor do I see why X99 would be more or less problematic than Z77 in that respect.</p></div></blockquote></div><p>I don&#039;t think its X99&#039;s fault , but rather ASUS&#039;s .</p><p>EDIT : </p><p>Confirmed . Commenting out nointxmask=1 solves the reboot issue in one VM . The second one , reboots fine and Windows loads fine until it reaches the login screen , then it goes into black screen . The good news is that the host doesn&#039;t crash anymore <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Now . I just have to wait for my USB PCI-E card to be fixed so I wouldn&#039;t need nointxmask=1 .</p></div></blockquote></div><p>You can add a patch like this one to your kernel to try it:</p><p><a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=3cb30b73ad" rel="nofollow">http://git.kernel.org/cgit/linux/kernel … 3cb30b73ad</a></p><p>Copy the two lines of code added and replace with your vendor &amp; device ID.</p><div class="quotebox"><blockquote><div><p>EDIT 2 :</p><p>Enabling MSI in the second 8.1 VM fixed its reboots issue completely ! Thanks Alex ! <del>One more question , I&#039;m about to reinstall Windows 8.1 on this particular VM . can I export the &quot;MessageSignaledInterruptProperties&quot; key to a .reg file and just apply it to the new installed OS ? Or should I just do it manually again ?</del> EDIT : Yes , it works when exported to a .reg file .</p></div></blockquote></div><p>Great!&#160; And neat trick with the exported reg file, please add it as a comment on the <a href="http://vfio.blogspot.com/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">blog</a>.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478827">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478953" class="blockpost roweven"> <h2><span><span class="conr">#3416</span> <a href="viewtopic.php?pid=1478953#p1478953">2014-11-25 06:41:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>You can add a patch like this one to your kernel to try it:</p><p><a href="http://git.kernel.org/cgit/linux/kernel" rel="nofollow">http://git.kernel.org/cgit/linux/kernel</a> … 3cb30b73ad</p><p>Copy the two lines of code added and replace with your vendor &amp; device ID.</p></div></blockquote></div><p>Would do that when I compile the next time for sure .</p><div class="quotebox"><blockquote><div><p>Great!&#160; And neat trick with the exported reg file, please add it as a comment on the blog.</p></div></blockquote></div><p>Will do so in a minute <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>EDIT :</p><p>errrr ... I can&#039;t publish my comment to your blog because I don&#039;t have any account of those that are required to post . Can you publish it ? Thank you .</p><div class="quotebox"><blockquote><div><p>Hi . </p><p>You can export the &quot;MessageSignaledInterruptProperties&quot; key to a &quot;.reg&quot; file and use it to enable MSI easily when you reinstall Windows .</p><p>Navigate to &quot;MessageSignaledInterruptProperties&quot; key and right click on it &gt; Choose &quot;Export&quot; , give it a name and save it anywhere you like . You will end up with a &quot;.reg&quot; file . you can double click on it to merge it into the registry when you do a reinstall of Windows .</p><p>You can also combine multiple &quot;.reg&quot; files into one big unified one to make things even easier .</p><p><a href="http://i.imgur.com/qVY1J2e.png" rel="nofollow">http://i.imgur.com/qVY1J2e.png</a></p></div></blockquote></div><br /><p>EDIT 2 :</p><p><del>Why can&#039;t I enable MSI for Nvidia&#039;s HDMI audio device ?</del></p><p>Figured it out . The device path shown in device properties doesn&#039;t point to the correct path . I enabled MSI for ALL devices that have Vendor&#039;s ID of 10de (Nvidia&#039;s ID) , and now it works beautifully without &quot;nointxmask=1&quot; . (Yes , the culprit was Nvidia&#039;s audio device and NOT the USB card as I initially assumed) .</p><p>EDIT 3 :</p><p>Here is the &quot;.reg&quot; file for fixing Nvidia&#039;s GT610 audio and reboot issues (I exported each key to a seperate file then combined them into a unified file using a quick copy/paste action in notepad :</p><p><a href="http://www.pastebin.ca/2877860" rel="nofollow">http://www.pastebin.ca/2877860</a></p><p>If you have GT610 and want to try it , just copy the text to a file , save it with &quot;.reg&quot; extention and just double click on it to merge it to your registry .</p><p>Hope this helps <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by Denso (2014-11-25 08:16:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478953">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1478976" class="blockpost rowodd"> <h2><span><span class="conr">#3417</span> <a href="viewtopic.php?pid=1478976#p1478976">2014-11-25 09:41:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>If you have GT610 and want to try it , just copy the text to a file , save it with &quot;.reg&quot; extention and just double click on it to merge it to your registry .</p><p>Hope this helps <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>Huh, you&#039;re passing a GT610?<br />I have a GT610 too, but i&#039;m using it for host system output. Is there any testing i could help you with? My GT610 is silent 1GB version from gigabyte.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1478976">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479007" class="blockpost roweven"> <h2><span><span class="conr">#3418</span> <a href="viewtopic.php?pid=1479007#p1479007">2014-11-25 12:21:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just to inform:</p><p>Having the cpupower ondemand or on powersave give me from 12 fps to 75 running Valley Benchmark so... be careful <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Between ondemand and performance I didn&#039;t found any relevant difference.</p><p>Regards,</p><br /><p>TheArcher</p> <p class="postedit"><em>Last edited by thearcherblog (2014-11-25 12:33:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479007">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479040" class="blockpost rowodd"> <h2><span><span class="conr">#3419</span> <a href="viewtopic.php?pid=1479040#p1479040">2014-11-25 14:02:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Just to inform:</p><p>Having the cpupower ondemand or on powersave give me from 12 fps to 75 running Valley Benchmark so... be careful <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Between ondemand and performance I didn&#039;t found any relevant difference.</p></div></blockquote></div><p>The <em>powersave</em> governor statically runs the processor at the lowest speed regardless of load, so yes, it will have a dramatic effect on performance.&#160; The <em>performance</em> governor runs the processor at the highest speed regardless of load.&#160; The <em>ondemand</em> governor adjusts the processor speed based on load, which is where the guest can experience response latency.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479040">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479043" class="blockpost roweven"> <h2><span><span class="conr">#3420</span> <a href="viewtopic.php?pid=1479043#p1479043">2014-11-25 14:15:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85963">Rommy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-17</span></dd> <dd><span>Posts: 22</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85963">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you, all is working now except sound and reboot. </p><p>I hear sound, but I get scraching/stutter. I use alsa and tried it with the params the OP mentioned it, but without &quot;QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170 QEMU_AUDIO_DRV=alsa&quot; it is the same result.</p><p>Reboot: <br />I found this method: <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a><br />All is working, when I start the logon script, the screen turns black and comes back. When I reboot with the logoff script, I get Invalid ROM contents and starting the VM does not work.</p><p>Any Ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479043">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479055" class="blockpost rowodd"> <h2><span><span class="conr">#3421</span> <a href="viewtopic.php?pid=1479055#p1479055">2014-11-25 15:13:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Just to inform:</p><p>Having the cpupower ondemand or on powersave give me from 12 fps to 75 running Valley Benchmark so... be careful <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Between ondemand and performance I didn&#039;t found any relevant difference.</p></div></blockquote></div><p>The <em>powersave</em> governor statically runs the processor at the lowest speed regardless of load, so yes, it will have a dramatic effect on performance.&#160; The <em>performance</em> governor runs the processor at the highest speed regardless of load.&#160; The <em>ondemand</em> governor adjusts the processor speed based on load, which is where the guest can experience response latency.</p></div></blockquote></div><p>However, this isn&#039;t true for <strong>intel_pstate</strong> (now by default for Sandy Bridge and upwards) which supports only <em>powersave</em> and <em>performance</em> governors. They behave more like ondemand, with some changes in power consumption characteristics in the long run.</p> <p class="postedit"><em>Last edited by dwe11er (2014-11-25 15:41:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479087" class="blockpost roweven"> <h2><span><span class="conr">#3422</span> <a href="viewtopic.php?pid=1479087#p1479087">2014-11-25 16:19:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86321">thearcherblog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-30</span></dd> <dd><span>Posts: 165</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jjgarcianorway@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>dwe11er wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>thearcherblog wrote:</cite><blockquote><div><p>Just to inform:</p><p>Having the cpupower ondemand or on powersave give me from 12 fps to 75 running Valley Benchmark so... be careful <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Between ondemand and performance I didn&#039;t found any relevant difference.</p></div></blockquote></div><p>The <em>powersave</em> governor statically runs the processor at the lowest speed regardless of load, so yes, it will have a dramatic effect on performance.&#160; The <em>performance</em> governor runs the processor at the highest speed regardless of load.&#160; The <em>ondemand</em> governor adjusts the processor speed based on load, which is where the guest can experience response latency.</p></div></blockquote></div><p>However, this isn&#039;t true for <strong>intel_pstate</strong> (now by default for Sandy Bridge and upwards) which supports only <em>powersave</em> and <em>performance</em> governors. They behave more like ondemand, with some changes in power consumption characteristics in the long run.</p></div></blockquote></div><p>It&#039;s truth but I needed to disable the intel_pstate because my processor was running all time at 4GHz...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479087">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479099" class="blockpost rowodd"> <h2><span><span class="conr">#3423</span> <a href="viewtopic.php?pid=1479099#p1479099">2014-11-25 17:04:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84760">Denso</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/84760.png?m=1412533733" width="71" height="80" alt="" /></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 179</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I have a GT610 too, but i&#039;m using it for host system output. Is there any testing i could help you with? My GT610 is silent 1GB version from gigabyte.</p></div></blockquote></div><p>This card sucks . Or maybe my X99-Deluxe sucks . This card used to work with zero tweaking on my AMD 990FXA board . Now everytime I think I finally got rid of the reboot issue , a couple reboots later and BAAAM it hangs the VM again . Sigh ... I&#039;m really tired . It works pretty darn well until I install the Nvidia drivers . Then it is the same all over again . I&#039;m seriously thinking of running the VM in full screen on top of a Linux DE . Will QXL give me 60fps when watching movies and surfing ? Because if it would , I will happily go that route . </p><p>umm ... would it be possible to manually install JUST the graphics/audio driver in Windows without running the Nvidia installer ? Would worth a try !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479099">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479118" class="blockpost roweven"> <h2><span><span class="conr">#3424</span> <a href="viewtopic.php?pid=1479118#p1479118">2014-11-25 18:29:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I have a GT610 too, but i&#039;m using it for host system output. Is there any testing i could help you with? My GT610 is silent 1GB version from gigabyte.</p></div></blockquote></div><p>This card sucks . Or maybe my X99-Deluxe sucks . This card used to work with zero tweaking on my AMD 990FXA board . Now everytime I think I finally got rid of the reboot issue , a couple reboots later and BAAAM it hangs the VM again . Sigh ... I&#039;m really tired . It works pretty darn well until I install the Nvidia drivers . Then it is the same all over again . I&#039;m seriously thinking of running the VM in full screen on top of a Linux DE . Will QXL give me 60fps when watching movies and surfing ? Because if it would , I will happily go that route . </p><p>umm ... would it be possible to manually install JUST the graphics/audio driver in Windows without running the Nvidia installer ? Would worth a try !</p></div></blockquote></div><p>uhm, running vm for surfing/video playback?</p><p>i always thought both of these areas are far more superior/comfortable while being in linux, but i just might have missed something ))</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479118">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1479119" class="blockpost rowodd"> <h2><span><span class="conr">#3425</span> <a href="viewtopic.php?pid=1479119#p1479119">2014-11-25 18:30:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Denso wrote:</cite><blockquote><div><p>This card sucks .</p></div></blockquote></div><p>Well, you know, it&#039;s a PLUG to fill the pci-e port.</p><br /><p>BTW, does anyone know what those two or three recent seavgabios git updates brought us? Seems like i&#039;ve got something borked:<br />Unigine Heaven benchmark runs fine in CF mode, GPU-Z says CF is enabled and even renders, but when i start my -nodx9ex switched game which is using DX9 - it crashes with something related to access violation and then even the Unigine Heaven benchmark breaks. Yesterday it was working just fine. And there is no messages in the host dmesg or something.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1479119">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=136">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=135">135</a> <a href="viewtopic.php?id=162768&amp;p=136">136</a> <strong>137</strong> <a href="viewtopic.php?id=162768&amp;p=138">138</a> <a href="viewtopic.php?id=162768&amp;p=139">139</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=138">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
