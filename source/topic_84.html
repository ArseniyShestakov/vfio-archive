<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 84) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=84" title="Page 84" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=83" title="Page 83" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=85" title="Page 85" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=83">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <a href="viewtopic.php?id=162768&amp;p=83">83</a> <strong>84</strong> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <a href="viewtopic.php?id=162768&amp;p=86">86</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=85">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1424867" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2076</span> <a href="viewtopic.php?pid=1424867#p1424867">2014-06-11 21:29:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><p>I&#039;m surprised people can&#039;t verify for themselves since the first post mentions :</p><p>&quot;NOTE: to get this working you&#039;ll need:</p><p>&#160; &#160; AMD-VI/VT-D enabled and working.&quot;</p></div></blockquote></div><p>To be fair, the kernel does like to lie and say things like &quot;Intel-IOMMU: enabled&quot; when actually all it&#039;s done is register that you&#039;ve passed intel_iommu=on.&#160; The actual telling line that nobody seems to get right when trying to prove that it&#039;s enabled is &quot;PCI-DMA: Intel(R) Virtualization Technology for Directed I/O&quot;.</p></div></blockquote></div><p> Do Intel K CPUs report the &#039;vmx&#039; flag? [EDITED OUT: Don&#039;t want to confuse people]</p> <p class="postedit"><em>Last edited by mv0lnicky (2014-06-11 21:33:51)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424867">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424869" class="blockpost roweven"> <h2><span><span class="conr">#2077</span> <a href="viewtopic.php?pid=1424869#p1424869">2014-06-11 21:29:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><p>I&#039;m surprised people can&#039;t verify for themselves since the first post mentions :</p><p>&quot;NOTE: to get this working you&#039;ll need:</p><p>&#160; &#160; AMD-VI/VT-D enabled and working.&quot;</p></div></blockquote></div><p>To be fair, the kernel does like to lie and say things like &quot;Intel-IOMMU: enabled&quot; when actually all it&#039;s done is register that you&#039;ve passed intel_iommu=on.&#160; The actual telling line that nobody seems to get right when trying to prove that it&#039;s enabled is &quot;PCI-DMA: Intel(R) Virtualization Technology for Directed I/O&quot;.</p></div></blockquote></div><p> Do Intel K CPUs report the &#039;vmx&#039; flag? If not, then it&#039;d just be a matter of adding in the first post something like :</p><div class="codebox"><pre><code>cat /proc/cpuinfo | grep &#039;vmx&#039;</code></pre></div></div></blockquote></div><p>vmx != VT-d</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424869">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424872" class="blockpost rowodd"> <h2><span><span class="conr">#2078</span> <a href="viewtopic.php?pid=1424872#p1424872">2014-06-11 21:33:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79991">mv0lnicky</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-05</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79991">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>To be fair, the kernel does like to lie and say things like &quot;Intel-IOMMU: enabled&quot; when actually all it&#039;s done is register that you&#039;ve passed intel_iommu=on.&#160; The actual telling line that nobody seems to get right when trying to prove that it&#039;s enabled is &quot;PCI-DMA: Intel(R) Virtualization Technology for Directed I/O&quot;.</p></div></blockquote></div><p> Do Intel K CPUs report the &#039;vmx&#039; flag? If not, then it&#039;d just be a matter of adding in the first post something like :</p><div class="codebox"><pre><code>cat /proc/cpuinfo | grep &#039;vmx&#039;</code></pre></div></div></blockquote></div><p>vmx != VT-d</p></div></blockquote></div><p> Oh you&#039;re right, it&#039;s for VT-x. So there&#039;s no cpu flag for VT-d.</p><p>Then I guess the only way really is:</p><div class="codebox"><pre><code>dmesg | grep -i pci-dma</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424872">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424932" class="blockpost roweven"> <h2><span><span class="conr">#2079</span> <a href="viewtopic.php?pid=1424932#p1424932">2014-06-12 00:45:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>CPU: i5 2500k<br />MB: Asus P8P67 EVO</p></div></blockquote></div><p>Your CPU doesn&#039;t support VT-d - <a href="http://ark.intel.com/products/52210/Intel-Core-i5-2500K-Processor-6M-Cache-up-to-3_70-GHz" rel="nofollow">http://ark.intel.com/products/52210/Int … o-3_70-GHz</a></p><p>Thanks for playing</p><p>nbhs, maybe you could add a link to ark on the first post, we&#039;re getting this a lot.</p></div></blockquote></div><p>Sure</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424932">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424987" class="blockpost rowodd"> <h2><span><span class="conr">#2080</span> <a href="viewtopic.php?pid=1424987#p1424987">2014-06-12 06:10:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><p>Umm, qemu adds an outer frame.<br />I change the resolution to 1920x1080, but the outer black frame remains. any advice? :)</p></div></blockquote></div><p> You mean like underscan?</p></div></blockquote></div><p>Yes.</p></div></blockquote></div><p>i&#039;m getting this as well.<br />my setup is one monitor (benq g2420hd) with connected:<br /> - DVI : host (fedora 20, i7-4770 IGP)<br /> - HDMI : guest (win 7, radeon HD 6450)</p><p>i just switch displayed input on monitor when needed.<br />host video (DVI) works just fine - native 1920x1080, no problems at all<br />but when i switch to guest video (HDMI) using 1920x1080 - i get pretty large black frame visible on the screen. so far, i &quot;solved&quot; it by decreasing screen resolution in guest</p><p>but if there is some sort of solution (e.g. it is not a problem with the monitor not being able to handle dual input correctly) - that would be great</p> <p class="postedit"><em>Last edited by sinny (2014-06-12 06:10:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424987">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1424991" class="blockpost roweven"> <h2><span><span class="conr">#2081</span> <a href="viewtopic.php?pid=1424991#p1424991">2014-06-12 06:40:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82294">_pheinrich_</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-26</span></dd> <dd><span>Posts: 32</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:pascalheinrich.de@googlemail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes you are right ... I should have seen that my cpu supports VT-x only.</p><p>So if I take a <a href="http://ark.intel.com/products/52209/Intel-Core-i5-2500-Processor-6M-Cache-up-to-3_70-GHz" rel="nofollow">http://ark.intel.com/products/52209/Int … o-3_70-GHz</a> without that stupid ---&gt;K&lt;--- I might have success?</p><p>Does anybody have experience with my MB (Asus P8P67 EVO) or do I get trouble with that too?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1424991">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425028" class="blockpost rowodd"> <h2><span><span class="conr">#2082</span> <a href="viewtopic.php?pid=1425028#p1425028">2014-06-12 09:00:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76389">blitzschlag</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-30</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>Does anybody have experience with my MB (Asus P8P67 EVO) or do I get trouble with that too?</p></div></blockquote></div><p>hey,<br />have a look at</p><p><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a></p><p>maybe its in there (haven&#039;t checked myself).</p><p>that would actually be a good mention in the opening Post aswell *hinthint* </p><p><img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>keep up the good work guys</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425028">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425103" class="blockpost roweven"> <h2><span><span class="conr">#2083</span> <a href="viewtopic.php?pid=1425103#p1425103">2014-06-12 13:38:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>_pheinrich_ wrote:</cite><blockquote><div><p>Yes you are right ... I should have seen that my cpu supports VT-x only.</p><p>So if I take a <a href="http://ark.intel.com/products/52209/Intel-Core-i5-2500-Processor-6M-Cache-up-to-3_70-GHz" rel="nofollow">http://ark.intel.com/products/52209/Int … o-3_70-GHz</a> without that stupid ---&gt;K&lt;--- I might have success?</p><p>Does anybody have experience with my MB (Asus P8P67 EVO) or do I get trouble with that too?</p></div></blockquote></div><p>It&#039;s probably fine, I have a similar generation P8H67-M PRO/CSM that works well with i5-3470T.&#160; Host uses the Intel HD graphics with GT635 and HD8570 for guests.&#160; If you have a rev 01 ASMedia PCI bridge you can pretty much write off the conventional PCI slots as useless, but that&#039;s true regardless of device assignment.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425103">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425118" class="blockpost rowodd"> <h2><span><span class="conr">#2084</span> <a href="viewtopic.php?pid=1425118#p1425118">2014-06-12 14:36:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>If you don&#039;t ask you won&#039;t know,<br />How do apply the &quot; i915: Add module option to support VGA arbiter on HD devices &quot; patch ?</p><p>Never mind, </p><p><a href="https://bbs.archlinux.org/search.php?action=show_user_posts&amp;user_id=82136" rel="nofollow">https://bbs.archlinux.org/search.php?ac … r_id=82136</a></p> <p class="postedit"><em>Last edited by abdullah (2014-06-12 14:42:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425118">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425156" class="blockpost roweven"> <h2><span><span class="conr">#2085</span> <a href="viewtopic.php?pid=1425156#p1425156">2014-06-12 16:23:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80773">Torello</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-01</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80773">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, somehow I&#039;m unable to pass any usb device to guest.</p><p>My start script is:</p><p>qemu-system-x86_64 -enable-kvm -M q35 -m 16384 -cpu Haswell \<br />-smp 8,sockets=1,cores=4,threads=2 \<br />-vga none \<br />-rtc clock=host \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \<br />-device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive if=virtio,file=/home/user/virt_images/win7_meta.qcow2,format=qcow2,cache=none \<br />-drive file=/home/user/distr/gparted.iso,id=isocd -device ide-cd,bus=ide.0,drive=isocd \<br />-boot menu=on \<br />-device qxl</p><p>I have ich9 &quot;Usb controllers&quot; in device manager, and seems they are working fine( no any marks about errors in device manager ).</p><p>If I add, for example,<br />&quot;-usb -device usb-host,hostbus=1,hostaddr=10 \&quot;<br />I have got additonally 4 unknown devices( ICH9 2934, ICH9 2935 and so on ), each of them is ich9 usb host controller too.<br />This devices has a windows error 29 - &quot;No drivers installed for device&quot;.<br />And Windows can&#039;t install a drivers for this controllers.<br />Do you have any suggestions how to fix that issue?</p><p>That&#039;s how device manager looks like:</p><p><span class="postimg"><img src="http://s8.postimg.org/y7599xb5h/error_1.png" alt="Device Manager" /></span></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425156">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425193" class="blockpost rowodd"> <h2><span><span class="conr">#2086</span> <a href="viewtopic.php?pid=1425193#p1425193">2014-06-12 18:41:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just to give kudos where due, I finally got around to booting my Gigabyte GA-990FXA-UD3 system today and it allows full configuration of the initial display, letting me select PCI/PEG/PEG1/PEG2/PEG3 for the init display.&#160; The only thing it won&#039;t let me select are the x1 slots.&#160; I peeked at their latest, greatest Intel board manual (GA-Z97X-SOC) and it appears to offer the same, IGD, any one of the x16 slots, or PCI (BTW, the manual also has a great slot layout diagram for those confused about x16 vs x8 vs x4, PEG vs PCH, and DMI).&#160; Asus hasn&#039;t really done anything to make me a loyal customer lately, so I may be looking to Gigabyte for my next board.&#160; Please pardon this commercial interruption <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p> <p class="postedit"><em>Last edited by aw (2014-06-12 18:52:09)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425193">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425202" class="blockpost roweven"> <h2><span><span class="conr">#2087</span> <a href="viewtopic.php?pid=1425202#p1425202">2014-06-12 19:06:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Just to give kudos where due, <br />...<br />Asus hasn&#039;t really done anything to make me a loyal customer lately, so I may be looking to Gigabyte for my next board.&#160; Please pardon this commercial interruption <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Interesting. I&#039;ve been using Asrock boards mostly as their BIOS seems to do well for VT-x/VT-d unlike some Asus boards I have here. Is Gigabyte consistent in that respect? The Asrock boards are overall not too bad but a bit on the flimsy side, they bend if you look at them the wrong way.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425202">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425207" class="blockpost rowodd"> <h2><span><span class="conr">#2088</span> <a href="viewtopic.php?pid=1425207#p1425207">2014-06-12 19:16:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82709">flack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82709">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Torello wrote:</cite><blockquote><div><p>Hello, somehow I&#039;m unable to pass any usb device to guest.</p><p>My start script is:</p><p>qemu-system-x86_64 -enable-kvm -M q35 -m 16384 -cpu Haswell \<br />-smp 8,sockets=1,cores=4,threads=2 \<br />-vga none \<br />-rtc clock=host \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \<br />-device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \<br />-device virtio-scsi-pci,id=scsi \<br />-drive if=virtio,file=/home/user/virt_images/win7_meta.qcow2,format=qcow2,cache=none \<br />-drive file=/home/user/distr/gparted.iso,id=isocd -device ide-cd,bus=ide.0,drive=isocd \<br />-boot menu=on \<br />-device qxl</p><p>...</p></div></blockquote></div><p>Hi I am here new in forum. Why you dont use somethink like this. In lsusb you can find your device vendorID and productID.</p><div class="codebox"><pre><code>back@KVM-Ubuntu:~$ lsusb Bus 002 Device 004: ID 058f:6362 Alcor Micro Corp. Flash Card Reader/Writer Bus 002 Device 003: ID 9710:7830 MosChip Semiconductor MCS7830 10/100 Mbps Ethernet adapter Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 005 Device 003: ID 13ba:0018 PCPlay Barcode PCP-BCG4209 Bus 005 Device 002: ID 2109:0811 Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 001 Device 006: ID 04b3:310b IBM Corp. Red Wheel Mouse</code></pre></div><p>my mouse is 04b3:310b then i add this parameter to qemu.</p><div class="codebox"><pre><code>-usb -usbdevice host:04b3:310b</code></pre></div> <p class="postedit"><em>Last edited by flack (2014-06-12 19:32:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425207">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425209" class="blockpost roweven"> <h2><span><span class="conr">#2089</span> <a href="viewtopic.php?pid=1425209#p1425209">2014-06-12 19:20:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Just to give kudos where due, <br />...<br />Asus hasn&#039;t really done anything to make me a loyal customer lately, so I may be looking to Gigabyte for my next board.&#160; Please pardon this commercial interruption <img src="https://bbs.archlinux.org/img/smilies/wink.png" width="15" height="15" alt="wink" /></p></div></blockquote></div><p>Interesting. I&#039;ve been using Asrock boards mostly as their BIOS seems to do well for VT-x/VT-d unlike some Asus boards I have here. Is Gigabyte consistent in that respect? The Asrock boards are overall not too bad but a bit on the flimsy side, they bend if you look at them the wrong way.</p></div></blockquote></div><p>Asrock got on my personal sh*t list when I was searching for an AMD-Vi system several years ago.&#160; When I sent a support request trying to figure out if their IOMMU option in the BIOS was actually enabling AMD-Vi or simply added a hole in memory for using a GART as an IOMMU.&#160; They gave me a non-answer referring me back to the manual and the exact BIOS option I was asking about, then volunteered that Asrock does not support Linux (I guess based on my OS selection or browser agent).&#160; I ended up with this Gigabyte board instead.&#160; There seem to be plenty of success stories with Asrock, so I guess they work.&#160; I can&#039;t speak to consistency on Gigabyte boards.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425209">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425212" class="blockpost rowodd"> <h2><span><span class="conr">#2090</span> <a href="viewtopic.php?pid=1425212#p1425212">2014-06-12 19:29:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><p> Do Intel K CPUs report the &#039;vmx&#039; flag? If not, then it&#039;d just be a matter of adding in the first post something like :</p><div class="codebox"><pre><code>cat /proc/cpuinfo | grep &#039;vmx&#039;</code></pre></div></div></blockquote></div><p>vmx != VT-d</p></div></blockquote></div><p> Oh you&#039;re right, it&#039;s for VT-x. So there&#039;s no cpu flag for VT-d.</p><p>Then I guess the only way really is:</p><div class="codebox"><pre><code>dmesg | grep -i pci-dma</code></pre></div></div></blockquote></div><p>Then you may run into this:</p><div class="codebox"><pre><code>PCI-DMA: Using software bounce buffering for IO (SWIOTLB)</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425212">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425386" class="blockpost roweven"> <h2><span><span class="conr">#2091</span> <a href="viewtopic.php?pid=1425386#p1425386">2014-06-13 07:56:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80773">Torello</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-01</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80773">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><div class="quotebox"><cite>Torello wrote:</cite><blockquote><div><p>Hello, somehow I&#039;m unable to pass any usb device to guest.<br />My start script is:<br />...</p></div></blockquote></div><p>Hi I am here new in forum. Why you dont use somethink like this. In lsusb you can find your device vendorID and productID.</p><div class="codebox"><pre><code>back@KVM-Ubuntu:~$ lsusb Bus 002 Device 004: ID 058f:6362 Alcor Micro Corp. Flash Card Reader/Writer Bus 002 Device 003: ID 9710:7830 MosChip Semiconductor MCS7830 10/100 Mbps Ethernet adapter Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 005 Device 003: ID 13ba:0018 PCPlay Barcode PCP-BCG4209 Bus 005 Device 002: ID 2109:0811 Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 001 Device 006: ID 04b3:310b IBM Corp. Red Wheel Mouse</code></pre></div><p>my mouse is 04b3:310b then i add this parameter to qemu.</p><div class="codebox"><pre><code>-usb -usbdevice host:04b3:310b</code></pre></div></div></blockquote></div><p>Thanks for help, but it doesn&#039;t work, I have same issue with your suggestion ( 4 unknown-device usb host controllers in device-manager ).</p> <p class="postedit"><em>Last edited by Torello (2014-06-13 07:57:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425386">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425413" class="blockpost rowodd"> <h2><span><span class="conr">#2092</span> <a href="viewtopic.php?pid=1425413#p1425413">2014-06-13 09:05:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><p>Hi I am here new in forum. Why you dont use somethink like this. In lsusb you can find your device vendorID and productID.</p><div class="codebox"><pre><code>back@KVM-Ubuntu:~$ lsusb Bus 002 Device 004: ID 058f:6362 Alcor Micro Corp. Flash Card Reader/Writer Bus 002 Device 003: ID 9710:7830 MosChip Semiconductor MCS7830 10/100 Mbps Ethernet adapter Bus 002 Device 002: ID 8087:0024 Intel Corp. Integrated Rate Matching Hub Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 006 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 005 Device 003: ID 13ba:0018 PCPlay Barcode PCP-BCG4209 Bus 005 Device 002: ID 2109:0811 Bus 005 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 001 Device 006: ID 04b3:310b IBM Corp. Red Wheel Mouse</code></pre></div><p>my mouse is 04b3:310b then i add this parameter to qemu.</p><div class="codebox"><pre><code>-usb -usbdevice host:04b3:310b</code></pre></div></div></blockquote></div><p>I pass both my mouse and keyboard to VM in the same way as you, it&#039;s very robust. But if you want to use host keyboard at the same time, you need a second one with a different device ID (this probably means different model or vendor). For me it does not matter, I only ssh to host anyway (when running a VM).</p><p>I wonder if a USB hub can be passed through this way (taking with it all the attached devices), didn&#039;t have time to check yet. Even better if this also worked for USB3.0 hub ...</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425413">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425455" class="blockpost roweven"> <h2><span><span class="conr">#2093</span> <a href="viewtopic.php?pid=1425455#p1425455">2014-06-13 11:47:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79237">mbroemme</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Cologne</span></dd> <dd><span>Registered: 2014-02-05</span></dd> <dd><span>Posts: 39</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79237">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Just to give kudos where due, I finally got around to booting my Gigabyte GA-990FXA-UD3 system today and it allows full configuration of the initial display, letting me select PCI/PEG/PEG1/PEG2/PEG3 for the init display.&#160; The only thing it won&#039;t let me select are the x1 slots.</p></div></blockquote></div><p>It is the same board I use and works really great with IOMMU and device passthrough. It is very stable solution from my point of view, except for the reset problem of R9 290X but all other devices I used for passthrough works like a charme.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425455">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425474" class="blockpost rowodd"> <h2><span><span class="conr">#2094</span> <a href="viewtopic.php?pid=1425474#p1425474">2014-06-13 12:21:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76145">Midov</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-22</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:midov@midov.pl">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>ttouch wrote:</cite><blockquote><div><div class="quotebox"><cite>mv0lnicky wrote:</cite><blockquote><div><p> You mean like underscan?</p></div></blockquote></div><p>Yes.</p></div></blockquote></div><p>i&#039;m getting this as well.<br />my setup is one monitor (benq g2420hd) with connected:<br /> - DVI : host (fedora 20, i7-4770 IGP)<br /> - HDMI : guest (win 7, radeon HD 6450)</p><p>i just switch displayed input on monitor when needed.<br />host video (DVI) works just fine - native 1920x1080, no problems at all<br />but when i switch to guest video (HDMI) using 1920x1080 - i get pretty large black frame visible on the screen. so far, i &quot;solved&quot; it by decreasing screen resolution in guest</p><p>but if there is some sort of solution (e.g. it is not a problem with the monitor not being able to handle dual input correctly) - that would be great</p></div></blockquote></div><p>I had exactly same problem with my Geforce 660 over HDMI when i installed newest drivers (version 337.88) in client.<br />It went away after i deleted those drivers and installed older ones (version 335 i belive) and now its working in full screen without that anoying black frame around it.<br />It was also working without any problems when i used default drivers that windows (win8) found on its own.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425474">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425509" class="blockpost roweven"> <h2><span><span class="conr">#2095</span> <a href="viewtopic.php?pid=1425509#p1425509">2014-06-13 13:47:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82577">vais</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-07</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82577">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello everyone!</p><p>This is a great thread and using it and a few other sources I too was able to get VFIO VGA passthrough working on Fedora 20.<br />My specs:</p><p>MB: Asrock Z97 Extreme4<br />CPU: Intel i5-4570<br />Host GPU: IGP HD 4600<br />Passed GPU: Radeon R9 270x</p><p>Qemu: 2.0.0-6 (from fedora-virt-preview, no patches)<br />Kernel: 12.5 (patched)</p><p>The only way I got it working was to use an already built kernel (thanks Stewart!) with the necessary patches applied - however this kernel is 3.12.5, which is now rather old and I would like to update it.<br />The issue is I was unable to apply the patch myself (and build the RPM) successfully.<br />I am trying to build a 3.15.rc8 (3.15.0.1 came out today in the repo, so I will switch to that) and tried all kinds of combinations of patches - none worked</p><p>In the end I believe all I need is the VGA arbiter patch: <a href="https://lkml.org/lkml/2014/5/9/517" rel="nofollow">https://lkml.org/lkml/2014/5/9/517</a> but the host graphics issue persists.</p><p>Are there any other patches for the VGA arb that need to be applied too?<br />If anyone with a similar config, and running Fedora, has a working 3.15 kernel could you list the patches used?<br />Also sharing the binaries will be appreciated&#160; <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>EDIT: Something that doesn&#039;t seem right - all modules of my built kernel (3.15.0-0.rc8.git2.1) are compressed - i915.ko.xz for example, while on the working kernel (3.12.5) they are not.<br />Has anything change in the kernel structure or I am doing something very wrong while building the RPM?</p><p>P.S. I use simply </p><div class="codebox"><pre><code>rpmbuild -ba ./kernel.spec</code></pre></div> <p class="postedit"><em>Last edited by vais (2014-06-13 13:59:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425523" class="blockpost rowodd"> <h2><span><span class="conr">#2096</span> <a href="viewtopic.php?pid=1425523#p1425523">2014-06-13 14:19:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>vais wrote:</cite><blockquote><div><p>In the end I believe all I need is the VGA arbiter patch: <a href="https://lkml.org/lkml/2014/5/9/517" rel="nofollow">https://lkml.org/lkml/2014/5/9/517</a> but the host graphics issue persists.</p></div></blockquote></div><p>Using this version of the patch, make sue you boot with i915.enable_hd_vgaarb=1</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425523">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425681" class="blockpost roweven"> <h2><span><span class="conr">#2097</span> <a href="viewtopic.php?pid=1425681#p1425681">2014-06-13 19:47:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82596">setedivento</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-08</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82596">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>setedivento wrote:</cite><blockquote><div><p>Hello everybody, really great topic, thanks!</p><p>If only I could make things work. I seemed so close... may anyone help?<br />I am trying to vga passthrough an Nvidia Quadro 4000 on a Kubuntu 14.04 host machine. Reports indicate more than one here has coped, on Ubuntu based distros, so I&#039;ve decided to ask.</p></div></blockquote></div><p>Full stop, you have a Quadro card and while it&#039;s not the version that NVIDIA supports for device assignment, it&#039;s hopefully close enough.&#160; Forget about Q35, -vga none, and x-vga=on, Quadro doesn&#039;t need any of that.&#160; Just add it to the VM as you would any other assigned device, you can even use virt-manager for it.&#160; Install using the emulated VGA.&#160; When you install the NVIDIA driver stack, the emulated VGA will be disabled and you&#039;ll automatically switch over to the Quadro card.&#160; We intend to support K-series Quadros on RHEL7 using this mode, but those cards are also known not to work with x-vga=on.&#160; K-series cards are Kepler based and yours I believe is Fermi based.&#160; Those are only one generation apart, so it will hopefully work.&#160; For others out there hoping their cheapy Quadro NVS cards can work like this, don&#039;t bet on it.</p><p>EDIT: The audio device on K-series Quadro is also known not to work and will not be supported for assignment on RHEL7.&#160; Try it, but expect it not to work.&#160; Just bind it to pci-stub and forget it&#039;s there.</p></div></blockquote></div><br /><p>woa, that&#039;s great to hear, thanks aw! (and sorry for the delay in answering, always busy with work)</p><p>may I just have a quick hint? how do I correctly add the device using the qemu-system-x86_64 CLI? <br />I have bound the card to the ioh3420 PCI bus as per OP guidelines (and of course removed the &#039;x-vga=on&#039;,&#039;vga-none&#039; and &#039;-M q35&#039; arguments);<br />but then when I start Windows, install the nvidia drivers and launch the nvidia control panel, the latter tells me &#039;you are not currently using a display attached to an NVIDIA GPU&#039; (there&#039;s no switch from the emulated VGA to the passed through card). <br />I quite don&#039;t have my ideas that clear, too, about how to instruct qemu to make the guest OS think the passed through graphic card is connected to the display... Especially in terms of what happens behind the scenes: if the display in qemu is somehow a device/device driver one can interact with or not....(sorry for the confusion, as I said I am a little newbie)...<br />virt-manager gave me the error described here:<br /><a href="https://bugs.launchpad.net/ubuntu/+source/libvirt/+bug/1276719/+activity" rel="nofollow">https://bugs.launchpad.net/ubuntu/+sour … /+activity</a><br />(both with and without the device being claimed by pci-stub)<br />and even when I successfully applied the relative workaround, it stayed an hour or so to launch the install process after I had configured the emulated hardware, before I decided to quit it.<br />I did not search for its log because in general, maybe it&#039;s more advisable for me to use a lower level tool, that forces me into better learning what exactly I am doing.</p><p>thanks again for your precious help!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425681">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425685" class="blockpost rowodd"> <h2><span><span class="conr">#2098</span> <a href="viewtopic.php?pid=1425685#p1425685">2014-06-13 20:00:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>setedivento wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>setedivento wrote:</cite><blockquote><div><p>Hello everybody, really great topic, thanks!</p><p>If only I could make things work. I seemed so close... may anyone help?<br />I am trying to vga passthrough an Nvidia Quadro 4000 on a Kubuntu 14.04 host machine. Reports indicate more than one here has coped, on Ubuntu based distros, so I&#039;ve decided to ask.</p></div></blockquote></div><p>Full stop, you have a Quadro card and while it&#039;s not the version that NVIDIA supports for device assignment, it&#039;s hopefully close enough.&#160; Forget about Q35, -vga none, and x-vga=on, Quadro doesn&#039;t need any of that.&#160; Just add it to the VM as you would any other assigned device, you can even use virt-manager for it.&#160; Install using the emulated VGA.&#160; When you install the NVIDIA driver stack, the emulated VGA will be disabled and you&#039;ll automatically switch over to the Quadro card.&#160; We intend to support K-series Quadros on RHEL7 using this mode, but those cards are also known not to work with x-vga=on.&#160; K-series cards are Kepler based and yours I believe is Fermi based.&#160; Those are only one generation apart, so it will hopefully work.&#160; For others out there hoping their cheapy Quadro NVS cards can work like this, don&#039;t bet on it.</p><p>EDIT: The audio device on K-series Quadro is also known not to work and will not be supported for assignment on RHEL7.&#160; Try it, but expect it not to work.&#160; Just bind it to pci-stub and forget it&#039;s there.</p></div></blockquote></div><br /><p>woa, that&#039;s great to hear, thanks aw! (and sorry for the delay in answering, always busy with work)</p><p>may I just have a quick hint? how do I correctly add the device using the qemu-system-x86_64 CLI? <br />I have bound the card to the ioh3420 PCI bus as per OP guidelines (and of course removed the &#039;x-vga=on&#039;,&#039;vga-none&#039; and &#039;-M q35&#039; arguments);<br />but then when I start Windows, install the nvidia drivers and launch the nvidia control panel, the latter tells me &#039;you are not currently using a display attached to an NVIDIA GPU&#039; (there&#039;s no switch from the emulated VGA to the passed through card). <br />I quite don&#039;t have my ideas that clear, too, about how to instruct qemu to make the guest OS think the passed through graphic card is connected to the display... Especially in terms of what happens behind the scenes: if the display in qemu is somehow a device/device driver one can interact with or not....(sorry for the confusion, as I said I am a little newbie)...<br />virt-manager gave me the error described here:<br /><a href="https://bugs.launchpad.net/ubuntu/+source/libvirt/+bug/1276719/+activity" rel="nofollow">https://bugs.launchpad.net/ubuntu/+sour … /+activity</a><br />(both with and without the device being claimed by pci-stub)<br />and even when I successfully applied the relative workaround, it stayed an hour or so to launch the install process after I had configured the emulated hardware, before I decided to quit it.<br />I did not search for its log because in general, maybe it&#039;s more advisable for me to use a lower level tool, that forces me into better learning what exactly I am doing.</p><p>thanks again for your precious help!</p></div></blockquote></div><p>If this card works like the K-series Quadros, then ignore the OP in this thread entirely.&#160; ioh3420 is a component of q35, don&#039;t use it.&#160; The qemu CLI for adding the GPU is simply:</p><div class="codebox"><pre><code>-device vfio-pci,host=1:00.0</code></pre></div><p>(replace with your device address as appropriate)&#160; Also, be sure that you&#039;re installing the Quadro driver, not the standard GeForce driver.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425685">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425725" class="blockpost roweven"> <h2><span><span class="conr">#2099</span> <a href="viewtopic.php?pid=1425725#p1425725">2014-06-13 21:32:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82596">setedivento</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-08</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82596">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thanks, I will try that and report here the results, if of any use... <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425725">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1425829" class="blockpost rowodd"> <h2><span><span class="conr">#2100</span> <a href="viewtopic.php?pid=1425829#p1425829">2014-06-14 05:17:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m having a bit of a problem with partition sharing. I&#039;ll make this short, I tried to follow <a href="http://fds-team.de/cms/articles/2013-12/use-a-real-windows-7-partition-in-virtualbox-kvm-vmware-player-u.html" rel="nofollow">this here</a> once with virtualbox and I do not remember how exactly it ended, just that it did not end in any sort of success. So this time I would like to get some help. Here is the partition setup I need to pass through.</p><p>/dev/sda (MBR = Bootmgr on /dev/sda1)<br />/dev/sda1 = System Reserved partition (windows&#039;s bootloader)<br />/dev/sda2 = Windows 7&#039;s C:/ partition<br />/dev/sda3 = Arch Linux (Host)</p><p>I&#039;ve got /dev/sda3&#039;s grub installed into the MBR of /dev/sdc (meaning booting /dev/sdc will boot me into my arch linux install, booting /dev/sda will boot me into windows)</p><p>I need to passthrough /dev/sda1, /dev/sda2 and preferably /dev/sda&#039;s MBR as well (but I don&#039;t mind using another method to make it boot as long as /dev/sda1 and /dev/sda2 are passed through)</p><p>How exactly should I proceed?</p><p>Additionally I have a GPT, NTFS partition on /dev/sdb2 that I want to be easily accessible from both the host and my guest at the same time (I want to share it between both systems) how do I do that too?</p> <p class="postedit"><em>Last edited by rabcor (2014-06-14 05:20:49)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1425829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=83">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=82">82</a> <a href="viewtopic.php?id=162768&amp;p=83">83</a> <strong>84</strong> <a href="viewtopic.php?id=162768&amp;p=85">85</a> <a href="viewtopic.php?id=162768&amp;p=86">86</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=85">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
