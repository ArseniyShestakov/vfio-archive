<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 24) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=24" title="Page 24" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=23" title="Page 23" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=25" title="Page 25" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=23">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <a href="viewtopic.php?id=162768&amp;p=23">23</a> <strong>24</strong> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <a href="viewtopic.php?id=162768&amp;p=26">26</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=25">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1338070" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#576</span> <a href="viewtopic.php?pid=1338070#p1338070">2013-10-16 10:26:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>so, i&#039;ve decided I would really like to get an intel 4930k, and I even found a motherboard that I was looking at getting. it&#039;s <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813188131" rel="nofollow"> EVGA X79 Dark</a>. I wasn&#039;t sure if it would support vt-d and linux so I contacted their customer service and asked them directly. they emailed me back:</p><div class="quotebox"><blockquote><div><p>Hi ****,</p><p>The motherboard will support Intel Visualization Technology. Unfortunately we do not support or have any drivers for Linux and only have drivers and support for Windows.</p><p>Regards,<br />EVGA</p></div></blockquote></div><p>I asked them SPECIFICALLY if it supported vt-d, and that seems to say that it does, but it doesn&#039;t have drivers to support linux. does that mean it won&#039;t work or does that just mean it doesn&#039;t support it actively and that the kernel would have to support it itself?</p><p>anyone have any idea, and if it won&#039;t work does anyone know a 2011 slot mobo that will work and supports ivy bridge e(not just sandy bridge)?</p></div></blockquote></div><p>I dont think you will find a vendor who supports Linux officially. The drivers are available in the Linux kernel so you shouldnt have any trouble.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338070">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338082" class="blockpost roweven"> <h2><span><span class="conr">#577</span> <a href="viewtopic.php?pid=1338082#p1338082">2013-10-16 11:03:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>interestingly the person called it &quot;visualization&quot; technology... makes it seem a little off.. can I really trust this guy? i know people can easily make typoes especially when you&#039;re doing something as monotonous as answering customer service emails... but still.</p><p>the whole point of me buying the mobo is solely based aroundit supporting vt-d, can anyone confirm that this motherboard supports vt-d? it&#039;s also possible they are assuming i meant vt-x or read it as vt-x when i tried to make it absolutely clear that i was asking specifically about vt-d.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338082">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338092" class="blockpost rowodd"> <h2><span><span class="conr">#578</span> <a href="viewtopic.php?pid=1338092#p1338092">2013-10-16 11:37:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61115">1Samildanach</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-18</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>interestingly the person called it &quot;visualization&quot; technology... makes it seem a little off.. can I really trust this guy? i know people can easily make typoes especially when you&#039;re doing something as monotonous as answering customer service emails... but still.</p><p>the whole point of me buying the mobo is solely based aroundit supporting vt-d, can anyone confirm that this motherboard supports vt-d? it&#039;s also possible they are assuming i meant vt-x or read it as vt-x when i tried to make it absolutely clear that i was asking specifically about vt-d.</p></div></blockquote></div><p>Could throw another email at them saying that you assume &quot;visualization&quot; was a typo, but want to double check before you cough up $400 because IOMMU is a crucial requirement for you (and use the term &quot;IOMMU&quot;; if they don&#039;t know what it is they&#039;ll hopefully spend the 10 secs to check what it is, thereby creating an opportunity for error correction if they&#039;ve misread/understood you).</p><p>It&#039;ll be annoying if you have to send it back, but if you have them on record specifically saying it&#039;ll do the job then at least getting a refund should be a no brainer.</p><p>EDIT: Oh, and I recall MSI being the most helpful/responsive when I was checking for MB compatibility ages ago (it was unfortunate that their products didn&#039;t quite tick other boxes, I felt kinda sad that I didn&#039;t give them any business), followed closely by Gigabyte (the brand I went with in the end). I couldn&#039;t find any way to even contact ASrock, and I ended up contacting ASUS by <em>telephone</em> <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" />... and didn&#039;t end up with anything useful from them &#039;cause the bloke couldn&#039;t find anything about vt-d. I don&#039;t think I tried any other&#160; manufacturers.</p><p>So you&#039;re not alone in having trouble getting reliable information even from the source. But if the EVGA X79 doesn&#039;t work out, I recommend just emailing a few manufacturers and asking for a list of models that support vt-d and the socket type you want, then cross anything unsatisfactory off the list and seeing what you have left.</p><p>[/ramble]</p> <p class="postedit"><em>Last edited by 1Samildanach (2013-10-16 11:58:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338092">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338175" class="blockpost roweven"> <h2><span><span class="conr">#579</span> <a href="viewtopic.php?pid=1338175#p1338175">2013-10-16 16:15:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi!</p><p>I&#039;m a long-time secondary-passthrough user who is fed up with fragility of this setup. Any time the gpu hangs it takes all the host down with itself. And the gpu will hang at least once in a month, you can bet on it. Besides, even though device removal in the guest helps a bit, every VM reboot is still risky with a good chance of something happening that will require the host reboot.</p><p>Long story short, today I&#039;ve tried vfio-vga. Thanks everybody who contributed to this thread, it&#039;s really helpful! But... has anybody had the &#039;gpu reset timeout&#039; BSOD in Win7?</p><p>I&#039;m using: <br />kernel-3.12.0-rc5 + the vfio patch from rc6 + reapplied vgaarb patches.<br />qemu-git-1680d4857 (the latest at this moment) + Alex&#039; nosnoop patch. The other patches are already in upstream.<br />seabios-1.7.3.2 (since there are no official builds yet, it&#039;s my own build with gcc-4.8.1).<br />Xeon E3-1245v2<br />SuperMicro X9SAE-V<br />Intel P4000 (host)<br />Radeon HD7750 (guest)</p><p>Binding stuff with:</p><div class="codebox"><pre><code>echo &quot;1002 683f&quot; &gt; /sys/bus/pci/drivers/vfio-pci/new_id echo 0000:01:00.0 &gt; /sys/bus/pci/devices/0000\:01\:00.0/driver/unbind echo 0000:01:00.0 &gt; /sys/bus/pci/drivers/vfio-pci/bind</code></pre></div><p>^ the same for hdmi audio, and usb.</p><p>Command line:</p><div class="codebox"><pre><code>qemu-kvm \ -machine q35,accel=kvm \ -cpu SandyBridge,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 \ -smp 4,cores=4,threads=1 \ -m 4G -mem-prealloc -mem-path /hugepages \ -boot order=c \ -device piix4-ide,bus=pcie.0 \ -drive file=/dev/vg0/gpu-snap,id=disk,format=raw,discard=unmap -device ide-hd,bus=ide.0,drive=disk \ -drive file=/vms/drivers/virtio-win-0.1-65.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -display none -vga none \ -device virtio-net,netdev=t10,mac=52:54:00:05:cd:79 \ -netdev tap,id=t10,vhost=on,ifname=tap10,script=no,downscript=no \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -device vfio-pci,host=00:1a.0 \ -name &quot;win7-gpu&quot;</code></pre></div><p>Completely new Windows 7 x64 install.</p><p>VGA functions work. I&#039;ve installed Win7 using the output of the gpu, but once I install the gpu drivers Windows BSODs right after the &quot;Starting Windows&quot; screen. It says &quot;device reset timeout.&quot; This happens with Catalyst 13.4 and 13.9. With secondary passthrough I use Catalyst 12.10; on vfio-vga setup, 12.10 just freezes in the &quot;Starting Windows&quot; screen (no BSOD, just the VM freeze). Has anybody encountred such issues? Is there any way to fix them?</p><p>P.S. Tried everything I could with VGA output to force host freeze, but it didn&#039;t. Impressive!</p><p>P.P.S. Looks like many people have stuttering audio in VMs, I&#039;ve never had such an issue. I use the audio output the gpu provides over HDMI. The VM has no emulated audio whatsoever. So if your setup allows HDMI audio, just use it. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338175">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338182" class="blockpost rowodd"> <h2><span><span class="conr">#580</span> <a href="viewtopic.php?pid=1338182#p1338182">2013-10-16 16:30:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75819">alphahere</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75819">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I had a similar problem. Change this line below<br />&#160; &#160; &#160; &#160; -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />TO THIS:<br />&#160; &#160; &#160; &#160; -device vfio-pci,host=01:00.1,bus=pcie.0 \</p><p>Changing the above line stopped BSOD&#039;s or windows crashes on boot. See page 23 for my post for more details and another cause of BSOD&#039;s. </p><p>Hope this helps.</p> <p class="postedit"><em>Last edited by alphahere (2013-10-16 17:39:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338182">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338191" class="blockpost roweven"> <h2><span><span class="conr">#581</span> <a href="viewtopic.php?pid=1338191#p1338191">2013-10-16 17:03:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How could I miss it?! So embarrassing. :\ Anyway, thank you very much! Everything works flawlessly now! </p><p>Even more, Windows Experice Score is slightly higher now. In previous setup: 7.4 (cpu), 7.6(mem), 7.2(gpu). Now: 7.5,7.9,7.5 on the same host.&#160; I guess it&#039;s thanks to the new kernel, qemu, and addition of hv_apicv and hv_spinlocks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338191">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338297" class="blockpost rowodd"> <h2><span><span class="conr">#582</span> <a href="viewtopic.php?pid=1338297#p1338297">2013-10-16 23:14:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=69685">Chetyre</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-03-27</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=69685">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>When I try to passthrough one of my USB Controllers, qemu fails with </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: vfio: error, group 7 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: vfio: failed to get group 7 qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Pretty sure this has something to do with my huge iommu group. Can I safely apply the acs_override patch to the 3.12 kernel?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338297">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339567" class="blockpost roweven"> <h2><span><span class="conr">#583</span> <a href="viewtopic.php?pid=1339567#p1339567">2013-10-20 18:41:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76088">cjn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-20</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76088">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all,</p><p>I&#039;m trying to pass-through a Radeon HD 3870 but don&#039;t have much luck doing so. I&#039;m using</p><p>Linux 3.12.0-rc6<br />QEMU head as of today (includes SeaBIOS) + nosnoop patch<br />ASRock 990FX Extreme3<br />AMD FX-8350<br />GeForce 210 (host)<br />Radeon HD 3870 (guest)</p><p>I&#039;m currently running on console, no frame buffer device drivers loaded. I start QEMU like this</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu qemu64 -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/local/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=04:00.1,bus=root.1,addr=00.1 \ -device ahci,bus=pcie.0,id=ahci \ -drive file=/dev/shm/windows.img,id=disk,format=raw \ -device ide-hd,bus=ahci.0,drive=disk \ -drive file=/root/en_windows_7_home_premium_with_sp1_x64_dvd_u_676549.iso,id=isocd \ -device ide-cd,bus=ahci.1,drive=isocd \ -nographic -usb -usbdevice host:04fe:0006 -usbdevice host:046d:c05b</code></pre></div><p>The passed USB devices are my keyboard and my mouse.</p><p>What happens is that the Windows installer BSODs with a &quot;STOP: 0x0000007E&quot; error (with a reference to &quot;atikmdag.sys&quot;) after &quot;Completing installation&quot;, at which point I can mostly just SSH to the host to shut it down in an orderly fashion. Killing the QEMU process does not restore keyboard/mouse functionality to the host.</p><p>Of note is that most things seem to work if I replace the Radeon HD 3870 with a Radeon HD 5450. The Windows installation completes, as does the subsequent Catalyst installation (of version 13.9). Issues remain with guest shutdown/reboot but these can probably be overcome.</p><p>Anyway, it is the Radeon HD 3870 I want in my Windows box. What can I do to debug this problem?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339567">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339751" class="blockpost rowodd"> <h2><span><span class="conr">#584</span> <a href="viewtopic.php?pid=1339751#p1339751">2013-10-21 06:08:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61115">1Samildanach</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-18</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>cjn wrote:</cite><blockquote><div><p>Anyway, it is the Radeon HD 3870 I want in my Windows box. What can I do to debug this problem?</p></div></blockquote></div><p>As I recall, the card must support Function Level Reset. Given that you&#039;ve got an older card there, it seems a good place to start. Post any output from this (replace the domain:bus:slot as appropriate):</p><p>su -c &#039;lspci -vvs 02:00.0 | grep FLR&#039;</p><p>If that comes up with nothing, the card is probably incapable of being passed through (:(). If you want to double check, drop the grep pipe, post the output, and we can take a look <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />.</p> <p class="postedit"><em>Last edited by 1Samildanach (2013-10-21 06:09:35)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339751">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339764" class="blockpost roweven"> <h2><span><span class="conr">#585</span> <a href="viewtopic.php?pid=1339764#p1339764">2013-10-21 08:30:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm, I have yet to see a VGA card that does support flr.&#160; We&#039;re probably missing quirks for older radeon cards.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339764">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339766" class="blockpost rowodd"> <h2><span><span class="conr">#586</span> <a href="viewtopic.php?pid=1339766#p1339766">2013-10-21 08:54:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61115">1Samildanach</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-18</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Hmm, I have yet to see a VGA card that does support flr.&#160; We&#039;re probably missing quirks for older radeon cards.</p></div></blockquote></div><p>It was just something I recall from when I was reading up on stuff ages ago that would be easy to check, though it was probably from Xen documentation (this was back when passthrough only really existed in Xen).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339766">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339899" class="blockpost roweven"> <h2><span><span class="conr">#587</span> <a href="viewtopic.php?pid=1339899#p1339899">2013-10-21 16:49:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76088">cjn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-20</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76088">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>1Samildanach wrote:</cite><blockquote><div><p>As I recall, the card must support Function Level Reset.</p></div></blockquote></div><p>No FLR it seems:</p><div class="codebox"><pre><code># lspci -vvs 04:00.0 | grep FLR ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset-</code></pre></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>We&#039;re probably missing quirks for older radeon cards.</p></div></blockquote></div><p>Can any logging be enabled in QEMU (or a kernel module?) that will help identify the quirk required for my card?</p><p>Otherwise, I&#039;m quite prepared to test patches. :-)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339899">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1339967" class="blockpost rowodd"> <h2><span><span class="conr">#588</span> <a href="viewtopic.php?pid=1339967#p1339967">2013-10-21 20:03:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76115">pablocrossa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-21</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi there</p><p>I&#039;ve been following this thread for a while and now I finally started putting things together. My current setup:<br />Laptop<br />i7-4800MQ (VT-d support and working, passthrough of most devices works)<br />Intel HD IGP (Whichever comes with that CPU)<br />Nvidia 770m GTX in Optimus setup</p><p>I believe the rest of the specifications are irrelevant; however, it is important to understand what Optimus does behind the scenes:<br />Intel IGP is connected to Display + all outputs<br />Nvidia GPU is connected to nowhere<br />Nvidia have a software solution to copy the &#039;framebuffer&#039; from the Nvidia card onto the Intel</p><p>I am also on Debian, not Arch; however I am using the kernel + qemu + seabios from here.</p><p>Now, I have correctly enabled IOMMU and am using PCI-stub correctly; no nouveau or i915 drivers are loaded. I have created a Windows 8 VM that boots with the following command line:<br />qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu Haswell \<br />-smp 4,sockets=1,cores=2,threads=2 \<br />-bios /usr/share/qemu/bios.bin \<br />-device ioh3420,bus=pcie.0,addr=1c.0,port=1,chassis=1,id=root.1 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/root/hd.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \<br />-drive file=/mnt/root/win8.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \<br />-boot dc \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0 \ #Nvidia<br />-vnc 0.0.0.0:1,1234 \<br />-usb -usbdevice tablet \<br />-vga vmware \ #the same happens with Cirrus<br />-device vfio-pci,host=00:1b.0,bus=pcie.0 \ #SoundCard<br />-device vfio-pci,host=00:03.0,bus=pcie.0 \ #Intel HD audio controller<br />-device vfio-pci,host=00:02.0,bus=pcie.0 #Intel IGP</p><p>If I comment out the last 2 lines the VM works fine (the Nvidia with newest drivers is registered under the device manager as working)(EDIT: I do this through VNC) and the soundcard works (Windows &#039;bings&#039; when you adjust the sound level). If I don&#039;t comment the last two lines like above Windows boots and then everything freezes except the cursor (no way to click on the Metro interface). Then I believe memory corruption happens as sometimes I can Ctrl+C the Qemu process, other times not; after Ctrl+C sometimes if I try launching software an error comes up about an incorrect reference to a library (that doesn&#039;t come up before launching the VM). If I type poweroff (I do all of this through SSH as the screen powers off when I pass the IGP to the VM) sometimes it outputs that the system is halting now but doesn&#039;t halt after waiting for a while or it just returns without outputting anything (and doesn&#039;t halt). I&#039;ve been out of internet for the last week so I have some Qs I still haven&#039;t been able to read from the source (will get onto it ASAP):</p><p>What exactly does the x-vga parameter do? Does it signal SeaBios which GPU to use as primary? I have tried every combination and it crashes.<br />Why do we need the &quot;-device ioh3420,bus=pcie.0,addr=1c.0,port=1,chassis=1,id=root.1 \&quot; line? Can we not pass the GPU/IGP to pcie.0 directly?<br />I believe the memory corruption might be hapenning because the Linux kernel doesn&#039;t give up the VGA memory or does BIOS calls to the VGA BIOS while the VM initializes it, making memory go everywhere from both hosts, causing the lockups and messups (this is only an idea); could it be so? Can KVM do a &#039;headless&#039; passthrough? What other causes could the memory corruption have?<br />Why aren&#039;t Intel IGPs working here? Why do they work with Xen in headless mode? I just want to understand it to see where to look and why this happens.</p><p>Thanks for all and I hope you can help, I&#039;m really close to having a great setup <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by pablocrossa (2013-10-21 20:04:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1339967">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340704" class="blockpost roweven"> <h2><span><span class="conr">#589</span> <a href="viewtopic.php?pid=1340704#p1340704">2013-10-23 17:59:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Chetyre wrote:</cite><blockquote><div><p>When I try to passthrough one of my USB Controllers, qemu fails with </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: vfio: error, group 7 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver. qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: vfio: failed to get group 7 qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=08:00.0,bus=pcie.0: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>Pretty sure this has something to do with my huge iommu group. Can I safely apply the acs_override patch to the 3.12 kernel?</p></div></blockquote></div><p>I have the same issue and I get no success&#160; with applying acs_override patch to the 3.12 kernel.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340704">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340705" class="blockpost rowodd"> <h2><span><span class="conr">#590</span> <a href="viewtopic.php?pid=1340705#p1340705">2013-10-23 18:02:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Could anyone please provide qemu-git PKGBUILD with alex qemu patches or alex qemu tree + NoSnoop?<br />Thank you in advance!</p> <p class="postedit"><em>Last edited by myweb (2013-10-23 18:06:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340705">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340730" class="blockpost roweven"> <h2><span><span class="conr">#591</span> <a href="viewtopic.php?pid=1340730#p1340730">2013-10-23 19:25:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Could anyone please provide qemu-git PKGBUILD with alex qemu patches or alex qemu tree + NoSnoop?<br />Thank you in advance!</p></div></blockquote></div><p><a href="http://www.fileswap.com/dl/P08BtJbpGe/" rel="nofollow">qemu-git.tar.gz</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340730">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340736" class="blockpost rowodd"> <h2><span><span class="conr">#592</span> <a href="viewtopic.php?pid=1340736#p1340736">2013-10-23 19:33:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Could anyone please provide qemu-git PKGBUILD with alex qemu patches or alex qemu tree + NoSnoop?<br />Thank you in advance!</p></div></blockquote></div><p><a href="http://www.fileswap.com/dl/P08BtJbpGe/" rel="nofollow">qemu-git.tar.gz</a></p></div></blockquote></div><p>Thank you!<br />Is it ok that git://git.qemu.org/qemu.git is used instead of git://github.com/awilliam/qemu-vfio.git tags/vfio-pci-for-qemu-20131003.0 ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340736">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340739" class="blockpost roweven"> <h2><span><span class="conr">#593</span> <a href="viewtopic.php?pid=1340739#p1340739">2013-10-23 19:44:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Could anyone please provide qemu-git PKGBUILD with alex qemu patches or alex qemu tree + NoSnoop?<br />Thank you in advance!</p></div></blockquote></div><p><a href="http://www.fileswap.com/dl/P08BtJbpGe/" rel="nofollow">qemu-git.tar.gz</a></p></div></blockquote></div><p>Thank you!<br />Is it ok that git://git.qemu.org/qemu.git is used instead of git://github.com/awilliam/qemu-vfio.git tags/vfio-pci-for-qemu-20131003.0 ?</p></div></blockquote></div><p>Alex patches have been merged upstream except the nosnoop patch, yes its ok <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by nbhs (2013-10-23 20:00:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340739">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340747" class="blockpost rowodd"> <h2><span><span class="conr">#594</span> <a href="viewtopic.php?pid=1340747#p1340747">2013-10-23 20:09:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you!<br />And one more question: could you please help to apply acs_override patch to the 3.12 kernel?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340747">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340750" class="blockpost roweven"> <h2><span><span class="conr">#595</span> <a href="viewtopic.php?pid=1340750#p1340750">2013-10-23 20:24:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Thank you!<br />And one more question: could you please help to apply acs_override patch to the 3.12 kernel?</p></div></blockquote></div><p><a href="http://www.fileswap.com/dl/UYPdmXwoD9/" rel="nofollow">linux-mainline.tar.gz</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340750">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340754" class="blockpost rowodd"> <h2><span><span class="conr">#596</span> <a href="viewtopic.php?pid=1340754#p1340754">2013-10-23 20:38:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75111">chUpa</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/75111.jpg?m=1379439992" width="80" height="80" alt="" /></dd> <dd><span>From: Chelyabinsk, Russia</span></dd> <dd><span>Registered: 2013-09-17</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75111">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>II found a solution, crossfire work in KVM. On x2 AMD Radeon HD 7970.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340754">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340755" class="blockpost roweven"> <h2><span><span class="conr">#597</span> <a href="viewtopic.php?pid=1340755#p1340755">2013-10-23 20:39:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>chUpa wrote:</cite><blockquote><div><p>II found a solution, crossfire work in KVM. On x2 AMD Radeon HD 7970.</p></div></blockquote></div><p>Interesting, could you share the solution?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340755">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340772" class="blockpost rowodd"> <h2><span><span class="conr">#598</span> <a href="viewtopic.php?pid=1340772#p1340772">2013-10-23 21:16:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>warning: cannot resolve &quot;libcacard-git&quot;, a dependency of &quot;qemu-git&quot;<br />:: The following package cannot be upgraded due to unresolvable dependencies:<br />&#160; &#160; &#160; qemu-git</p><p>Aur does not provide libcacard-git</p> <p class="postedit"><em>Last edited by myweb (2013-10-23 21:17:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340772">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340774" class="blockpost roweven"> <h2><span><span class="conr">#599</span> <a href="viewtopic.php?pid=1340774#p1340774">2013-10-23 21:18:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>warning: cannot resolve &quot;libcacard-git&quot;, a dependency of &quot;qemu-git&quot;<br />:: The following package cannot be upgraded due to unresolvable dependencies:<br />&#160; &#160; &#160; qemu-git</p><p>Aur does not provide libcacard-git</p></div></blockquote></div><p>The qemu-git PKGBUILD builds 2 packages, qemu-git and libcacard-git, it should be built on the same folder as qemu-git, so you should install it first then qemu</p> <p class="postedit"><em>Last edited by nbhs (2013-10-23 21:19:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340774">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1340781" class="blockpost rowodd"> <h2><span><span class="conr">#600</span> <a href="viewtopic.php?pid=1340781#p1340781">2013-10-23 21:35:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thank you and I am sorry for my inattention.<br />I have started VM via command bellow, but get black monitor - no signal... could you please help to investigate the issue?</p><p>qemu-system-x86_64 -M q35&#160; -m 4096&#160; -enable-kvm -cpu host&#160; -vga none \<br />-smp 1,sockets=1,cores=2,threads=1 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,x-vga=on,addr=0.0,multifunction=on,bus=root.1 \<br />-device vfio-pci,host=01:00.1,bus=pcie.0 \<br />-drive file=/run/media/abrilevskiy/CopiedData/Soft/saucy-desktop-amd64.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \<br />-drive if=none,id=drive0,cache=none,aio=native,format=raw,file=/home/abrilevskiy/windows.img \<br />-device virtio-blk,drive=drive0,scsi=off,config-wce=off,x-data-plane=on</p><p>I have tried:<br />modprobe -r kvm_intel<br />modprobe kvm_intel emulate_invalid_guest_state=0<br />but it did not help</p><br /><p>dmesg | grep -e IOMMU<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.080035] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a<br />[&#160; &#160; 0.080040] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.080110] IOAPIC id 2 under DRHD base&#160; 0xfed91000 IOMMU 1<br />[&#160; &#160; 0.366619] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 0.366620] IOMMU 1 0xfed91000: using Queued invalidation<br />[&#160; &#160; 0.366621] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.366629] IOMMU: Setting identity map for device 0000:00:02.0 [0x9f800000 - 0xaf9fffff]<br />[&#160; &#160; 0.367753] IOMMU: Setting identity map for device 0000:00:1d.0 [0x9d5e6000 - 0x9d617fff]<br />[&#160; &#160; 0.367773] IOMMU: Setting identity map for device 0000:00:1a.0 [0x9d5e6000 - 0x9d617fff]<br />[&#160; &#160; 0.367789] IOMMU: Setting identity map for device 0000:00:14.0 [0x9d5e6000 - 0x9d617fff]<br />[&#160; &#160; 0.367800] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.367807] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</p><br /><p>Command line: BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=51388cdb-7737-469b-80db-268b2f41e16c ro intel_iommu=on,igfx_on,pass-through pcie_acs_override=downstream quiet</p> <p class="postedit"><em>Last edited by myweb (2013-10-23 21:42:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1340781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=23">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <a href="viewtopic.php?id=162768&amp;p=23">23</a> <strong>24</strong> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <a href="viewtopic.php?id=162768&amp;p=26">26</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=25">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
