<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 232) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=232" title="Page 232" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=231" title="Page 231" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=233" title="Page 233" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=231">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=230">230</a> <a href="viewtopic.php?id=162768&amp;p=231">231</a> <strong>232</strong> <a href="viewtopic.php?id=162768&amp;p=233">233</a> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=233">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1549220" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5776</span> <a href="viewtopic.php?pid=1549220#p1549220">2015-07-31 06:37:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92904">Kartoffel</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-07-30</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:johncarmack@openmailbox.org">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Does it work that way? If so - ignore that lines. You can get rid of those lines by deleting</p><div class="codebox"><pre><code>QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170</code></pre></div></div></blockquote></div><p>When it rejects those settings the audio doesn&#039;t sound properly.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>And if you don&#039;t care much about using pulse audio or not - you can and should adapt QEMU to use it:</p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa</code></pre></div></div></blockquote></div><p>I have used those pa settings previously within KDE5 and they produced static quite frequently.<br />In addition, using those pa settings give an error within awesome:</p><div class="codebox"><pre><code>pulseaudio: pa_context_connect() failed pulseaudio: Reason: connection refused pulseaudio: Failed to initialize PA contextaudio: Could not init &#039;pa&#039; audio driver</code></pre></div><p>From what I&#039;ve gathered, it may be caused by running pa in single user mode and not system mode.<br />But because those settings give static, I believe there is no reason to pursue this further.<br />Any clue as to why it rejects the alsa settings?<br />Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549220">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549253" class="blockpost roweven"> <h2><span><span class="conr">#5777</span> <a href="viewtopic.php?pid=1549253#p1549253">2015-07-31 09:29:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>fabrizziop wrote:</cite><blockquote><div><p>I have an FX-8350 + GA990FXA-UD3, with 270x as passthrough GPU and 5770 as linux GPU. I want to upgrade my 270x to something faster. Does the r9 290/390 or the r9 285/380 work correctly, without reset issues?. Thanks.</p></div></blockquote></div><p>My Sapphire Tri-X R9 290X works fine with no issues at all (if only this card was a little bit smaller ...), with VM Windows 7 and regular Catalyst drivers. No gotchas, it just works. I am not using UEFI boot, so cannot say how this card would behave with OVMF. Also, I am using workstation class motherboard SuperMicro X9DA7, no idea how yours would work with this card.</p><p>I would advice against R9 285. I was unable to make FirePro W7100 work with pass-through and it uses the same chip Tonga PRO. Of course the reason for this <em>could</em> be specific to W7100 (ASIC or firmware), not to the chip. But on the <em>other</em> hand ...</p> <p class="postedit"><em>Last edited by Bronek (2015-07-31 09:32:45)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549253">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549261" class="blockpost rowodd"> <h2><span><span class="conr">#5778</span> <a href="viewtopic.php?pid=1549261#p1549261">2015-07-31 10:00:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m not having much luck installing Windows7 Pro using OVMF at the moment.</p><p>I&#039;ve got a fully working Windows8.1 Enterprise Machine with OVMF that I&#039;ve been using for months and months, but I would like to try Windows10 as a free upgrade which you can&#039;t do from an enterprise version so I am currently trying to get Windows7 Pro working.</p><p>I&#039;m using libvirt XML files to start the VM, I&#039;ve assigned the QXL vga adapter, as well as my AMD Radeon R290 card, I can boot from the Windows7 ISO which I see on the QXL adapter via VNC that it shows &quot;Windows is loading files&quot; progress then it goes to &quot;Starting Windows&quot; and just crashes.</p><p>I can see that there have been issues reported with the OVMF builds so I&#039;ve tried multiple builds:</p><p>The latest from <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">https://www.kraxel.org/repos/jenkins/edk2/</a> (31st July)<br />15214<br />16229<br />17542<br />And finally the custom one from lersek based on 18063&#160; <a href="http://people.redhat.com/~lersek/ovmf-r18063-ad-hoc-4530eb75/" rel="nofollow">http://people.redhat.com/~lersek/ovmf-r … -4530eb75/</a></p><p>All of them do the same, just appear blank/crashed after &quot;Starting Windows&quot; before you get to the installation screen.</p><p>I&#039;ve also tried dropping in to the EFI Shell and manually starting the Windows7 EFI boot application as per <a href="https://technet.microsoft.com/en-gb/library/cc749064(v=ws.10).aspx" rel="nofollow">https://technet.microsoft.com/en-gb/lib … s.10).aspx</a></p><p>Any one have any ideas?</p><p>Software Versions:</p><p>qemu-2-4-0-rc3<br />libvirt version: 1.2.15</p><p>Hardware:</p><p>Intel i7-4770s<br />Jetway NF9J-Q87<br />AMD Radeon R290</p><p>Here&#039;s my current XML file:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;windows7&lt;/name&gt; &lt;uuid&gt;7b222825-fc7d-4a66-a72c-5875063752d2&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;5291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;5291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt; &lt;cputune&gt; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;2&#039;/&gt; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;3&#039;/&gt; &lt;/cputune&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/home/root/ovmf-builds/15214/OVMF.fd&lt;/loader&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;/&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;destroy&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/local/qemu-2-4-0-rc3/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; /&gt; &lt;source file=&#039;/virtualguests/windows7/windows7-c-drive.qcow2&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/root/virtualguestisos/windows7/Windows_7_64-bit_Professional_x64.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/root/virtualguestisos/virtio-isos/virtio-win-0.1-74.iso&#039;/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039; /&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:12:34:76&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;target dev=&#039;tap8&#039;/&gt; &lt;model type=&#039;e1000&#039;/&gt; &lt;alias name=&#039;virtio&#039;/&gt; &lt;rom bar=&#039;off&#039;/&gt; &lt;/interface&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52e&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x045e&#039;/&gt; &lt;product id=&#039;0x0719&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x1415&#039;/&gt; &lt;product id=&#039;0x2000&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0fcf&#039;/&gt; &lt;product id=&#039;0x1009&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039; /&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;none&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;5903&#039; autoport=&#039;no&#039; listen=&#039;0.0.0.0&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;0.0.0.0&#039;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; vgamem=&#039;16384&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><br /><p>Thanks</p><p>Graham</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549261">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549293" class="blockpost roweven"> <h2><span><span class="conr">#5779</span> <a href="viewtopic.php?pid=1549293#p1549293">2015-07-31 11:57:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve just managed to progress further but without using libvirt, just plain qemu command line. I can now see the Windows7 pro Installation Screen in VNC via QXL.</p><p>Have also gone back to 16229, as it looks like 15214 doesnt work for Windows7. <a href="http://ubuntuforums.org/showthread.php?t=2262351" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2262351</a></p><p>I did try 16229 in libvirt but I couldn&#039;t get it working.</p><p>I&#039;ll post my progress after installation.</p><p>Command line used:</p><div class="codebox"><pre><code>/usr/local/qemu-2-4-0-rc3/bin/qemu-system-x86_64 \ -enable-kvm \ -m 4096 \ -cpu host,kvm=off \ -drive if=pflash,format=raw,readonly,file=/home/root/ovmf-builds/16229/usr/share/ovmf/ovmf_x64.bin \ -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 \ -drive file=/virtualguests/windows7/windows7-c-drive.qcow2,if=none,id=drive-virtio-disk1,format=qcow2 -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x7,drive=drive-virtio-disk1,id=virtio-disk1 \ -drive file=/home/root/virtualguestisos/windows7/Windows_7_64-bit_Professional_x64.iso,if=none,id=drive-ide0-1-0,readonly=on,format=raw \ -device ide-cd,bus=ide.1,unit=0,drive=drive-ide0-1-0,id=ide0-1-0,bootindex=1 \ -drive file=/home/root/virtualguestisos/virtio-isos/virtio-win-0.1-74.iso,if=none,id=drive-ide0-1-1,readonly=on,format=raw \ -device ide-cd,bus=ide.1,unit=1,drive=drive-ide0-1-1,id=ide0-1-1 \ -device qxl-vga,id=video0,ram_size=67108864,vram_size=67108864,vgamem_mb=16,bus=pci.0,addr=0x3 \ -device usb-host,hostbus=1,hostaddr=5,id=hostdev0 \ -device usb-host,hostbus=1,hostaddr=11,id=hostdev1 -device usb-host,hostbus=1,hostaddr=3,id=hostdev2 \ -device usb-host,hostbus=1,hostaddr=9,id=hostdev3 -device vfio-pci,host=01:00.0,id=hostdev4,bus=pci.0,multifunction=on,addr=0x8 -device vfio-pci,host=01:00.1,id=hostdev5,bus=pci.0,addr=0x9 \ -vnc 0.0.0.0:3</code></pre></div> <p class="postedit"><em>Last edited by gneville (2015-07-31 12:00:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549293">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549310" class="blockpost rowodd"> <h2><span><span class="conr">#5780</span> <a href="viewtopic.php?pid=1549310#p1549310">2015-07-31 12:56:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Windows7 Pro Installed worked and finished.</p><p>After first reboot of installation it dropped back to EFI Shell, had to manually start from HDD:</p><p>FS1:<br />\EFI\Boot\bootx64.efi</p><p>After &quot;Completing Installation&quot; it again dropped back EFI Shell, again manually started EFI from HDD:</p><p>FS1:<br />\EFI\Boot\bootx64.efi</p><p>Now progressed in to setup of Username and computer name and Product Key and finally Win7 desktop</p><p>Downloaded AMD Catalyst 15.7.1 and installed and rebooted now got Windows7 desktop on AMD HDMI Port.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549310">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549311" class="blockpost roweven"> <h2><span><span class="conr">#5781</span> <a href="viewtopic.php?pid=1549311#p1549311">2015-07-31 13:04:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549311">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549317" class="blockpost rowodd"> <h2><span><span class="conr">#5782</span> <a href="viewtopic.php?pid=1549317#p1549317">2015-07-31 13:25:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Worth trying the OVMF files from here : <a href="https://www.archlinux.org/packages/extra/any/ovmf/" rel="nofollow">https://www.archlinux.org/packages/extra/any/ovmf/</a></p><p>The issue I&#039;ve got now is on each boot I have to manually start the EFI boot in the EFI Shell. Hoping that after I get to Upgrade Win7 Pro to Win10 Pro and then finally to a clean install I won&#039;t need to worry.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549317">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549359" class="blockpost roweven"> <h2><span><span class="conr">#5783</span> <a href="viewtopic.php?pid=1549359#p1549359">2015-07-31 15:42:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Worth trying the OVMF files from here : <a href="https://www.archlinux.org/packages/extra/any/ovmf/" rel="nofollow">https://www.archlinux.org/packages/extra/any/ovmf/</a></p><p>The issue I&#039;ve got now is on each boot I have to manually start the EFI boot in the EFI Shell. Hoping that after I get to Upgrade Win7 Pro to Win10 Pro and then finally to a clean install I won&#039;t need to worry.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div></div></blockquote></div><p>Your issue is just a matter of configuration - specify the boot order, and you should be fine.</p><p>Although i do have pacman installed(i am one curious bastard), i use OVMF from git and i have fedora.<br />Could you tell me the build number which works for you?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549359">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549407" class="blockpost rowodd"> <h2><span><span class="conr">#5784</span> <a href="viewtopic.php?pid=1549407#p1549407">2015-07-31 19:14:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>The main requirement for a device to be passed through is to have a valid IOMMU group. Period.<br />If there&#039;s a device you want in the same group with the devices you want to leave for the host - you&#039;ll have to p-t the whole group with all it&#039;s devices.<br /><strong>OR</strong><br />use old, legacy, deprecated, xen <strong>pci-assign</strong>.<br />It works as vfio for regular PCI devices, and also doesn&#039;t require iommu groups to be valid. In fact, that&#039;s the only way i got my third GPU passed-through.</p><p>The problem you have usually happens when there&#039;s a malfunctioning windows driver. So the device is passed-through fine(check dmesg for errors btw), it&#039;s the drivers(or the windows kernel) who&#039;s glitching. As you can guess by the error message, check virtio-scsi driver(update it maybe?) and also check for the right IRQLs set for the sound card you&#039;ve p-t&#039;d. They really like interrupts.</p><p>I am passing my embedded on the motherboard</p><div class="codebox"><pre><code>00:14.2 Audio device: Advanced Micro Devices, Inc. [AMD] FCH Azalia Controller (rev 01)</code></pre></div><p>via pci-assign and i haven&#039;t observed any problems so far.</p><p>And what&#039;s that &quot;kernel_irqchip=on&quot; you have there? You sure you need it and you know how it works?</p></div></blockquote></div><p>Thank you for the response. It seems to be a Windows issues then. kernel-irqchip=on is enabled by default for qemu I believe, not sure why I explicitly added it but I don&#039;t think it makes any difference.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@mutiny</p><p>Conventional PCI devices often don&#039;t support or have broken support for interrupt masking.&#160; You can try using the vfio-pci module option nointxmask=1 to mask it at the APIC rather than the device, but this imposes the requirement that the device uses an exclusive interrupt.&#160; If you find the interrupt shared with other drivers, you&#039;ll need to unbind those conflicting devices from host drivers.&#160; If you have multiple conventional PCI devices behind the same PCIe-to-PCI bridge, the IOMMU cannot distinguish between them and therefore they are necessarily grouped together.&#160; The deprecated pci-assign driver (which has nothing to do with xen) will allow assigning such device separately, but it&#039;s much, much worse than ignoring the lack of isolation between PCIe devices and not recommended imho.</p></div></blockquote></div><p>Thank you very much aw. I will try with these options and see what happens. It is the only conventional PCI device I have installed at the moment, the other PCI slot is not populated.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549407">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549435" class="blockpost roweven"> <h2><span><span class="conr">#5785</span> <a href="viewtopic.php?pid=1549435#p1549435">2015-07-31 20:23:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Duelist<br />The build - ovmf 16229-1 - is directly here: <a href="https://www.archlinux.org/packages/extra/any/ovmf/" rel="nofollow">https://www.archlinux.org/packages/extra/any/ovmf/</a></p><br /><p>I&#039;ve now successfully upgraded the Win7 Pro Guest to Windows10 Pro and all works with OVMF. I&#039;ve grabbed my new Win10 Pro product key and I&#039;ve successfully performed a clean build of Windows10 Pro using OVFM as well. AMD Catalyst 15.7.1 installed and working fine with Win10. No reset issues either.</p><br /><br /><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Worth trying the OVMF files from here : <a href="https://www.archlinux.org/packages/extra/any/ovmf/" rel="nofollow">https://www.archlinux.org/packages/extra/any/ovmf/</a></p><p>The issue I&#039;ve got now is on each boot I have to manually start the EFI boot in the EFI Shell. Hoping that after I get to Upgrade Win7 Pro to Win10 Pro and then finally to a clean install I won&#039;t need to worry.</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div></div></blockquote></div><p>Your issue is just a matter of configuration - specify the boot order, and you should be fine.</p><p>Although i do have pacman installed(i am one curious bastard), i use OVMF from git and i have fedora.<br />Could you tell me the build number which works for you?</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549435">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549493" class="blockpost rowodd"> <h2><span><span class="conr">#5786</span> <a href="viewtopic.php?pid=1549493#p1549493">2015-07-31 23:45:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><em>You can&#039;t stop the progress...</em></p><p>Oh well. The time has come.<br />I have successfully installed Windows 10.<br />And damn it kind of frightened me when it didn&#039;t finish downloading the catalyst driver setup, but already installed the drivers.<br />Creepy stuff.<br />There&#039;s a good thing in all this modern hell: the screensaver settings menu remains the same for the damn 15 years. Yeah, that one where you cohoose the screensaver, with the funky drawn CRT-screen on it. It&#039;s the same as in Windows XP or W2K. I remember what a huge progress it was when that CRT screen changed it&#039;s design compared to 9x systems...</p><p>Anyway, Catalyst installed, crossfire launched, OVMF works. QXL is not needed.<br />AMD site hints me that my cards support DirectX 12.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549493">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549601" class="blockpost roweven"> <h2><span><span class="conr">#5787</span> <a href="viewtopic.php?pid=1549601#p1549601">2015-08-01 12:50:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84268">dragonreborn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-11</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:gabor.kovari@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey all,</p><p>I really need your help.<br />For months everything has been worked perfectly with VGA passthrough.<br />I have made a new Gentoo install as well and could enable the VGA passthrough there too.<br />Then something must have happened, after a few weeks of no-gaming, i tried to play some games, but after around 10 mins of gaming it became laggier and laggier, after one minute i got blank screen, and the following error message in terminal:</p><div class="codebox"><pre><code>qemu-system-x86_64: vfio: Unable to power on device, stuck in D3</code></pre></div><p>If i try to launch qemu again, ill get the following:</p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: vfio: Error: Failed to setup INTx fd: Device or resource busy qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device initialization failed qemu-system-x86_64: -device vfio-pci,host=01:00.0,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>dmesg:</p><div class="codebox"><pre><code>[ 3933.246342] genirq: Flags mismatch irq 16. 00000000 (vfio-intx(0000:01:00.0)) vs. 00000080 (ehci_hcd:usb1) [ 3933.267313] vfio-pci 0000:01:00.0: Refused to change power state, currently in D3 [ 3933.977098] vfio-pci 0000:01:00.0: timed out waiting for pending transaction; performing function level reset anyway</code></pre></div><p>qemu command:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -m 8196 -cpu host,kvm=off -smp 4 -device vfio-pci,host=01:00.0,x-vga=on -device vfio-pci,host=01:00.1 -vga none -hda /mnt/harddrives/ssd/win8.qcow2 -usb -usbdevice host:1532:0032 -usbdevice host:1532:0109 -soundhw hda</code></pre></div><p>I need to reboot the PC, then i can use qemu again (for 10 mins).<br />Noone seem to share this error with me on google.</p><p>Since i had backup from old Arch installation, where everything worked perfectly, i have restored everything, problem still persists.<br />I tried to downgrade apps, new install, fiddle with kernel, still no luck.</p><p>Getting desperate here, from time to time i like to play but dont want to switch back to windows &gt;&lt;<br />Please hep me if u can, and let me know if u need some more infos.<br />Thanks in advance.</p> <p class="postedit"><em>Last edited by dragonreborn (2015-08-01 12:51:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549601">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549629" class="blockpost rowodd"> <h2><span><span class="conr">#5788</span> <a href="viewtopic.php?pid=1549629#p1549629">2015-08-01 14:43:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@dragonreborn</p><p>There&#039;s a disable_idle_d3=1 option to vfio-pci in v4.1 that you might want to try.&#160; If D3 state is this broken for your device, it should probably be blacklisted in the kernel.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549629">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549650" class="blockpost roweven"> <h2><span><span class="conr">#5789</span> <a href="viewtopic.php?pid=1549650#p1549650">2015-08-01 16:25:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84268">dragonreborn</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-11</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:gabor.kovari@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@dragonreborn</p><p>There&#039;s a disable_idle_d3=1 option to vfio-pci in v4.1 that you might want to try.&#160; If D3 state is this broken for your device, it should probably be blacklisted in the kernel.</p></div></blockquote></div><br /><p>My bad. <br />Naturally after a couple of weeks trying to figure it out, and then writing on this forum, I figured it out. <br />It&#039;s most probably a hardware fault, fans aren&#039;t working on vga at all. Caused the card to overheat and stop working in 10 minutes. <br />Tried out the 2nd bios as well, no luck, no spin up at boot either. <br />I&#039;ll try a native windows out with the Evga software, otherwise back to RMA. Thanks for the help nevertheless!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549650">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549762" class="blockpost rowodd"> <h2><span><span class="conr">#5790</span> <a href="viewtopic.php?pid=1549762#p1549762">2015-08-01 21:27:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div><p>Just two quick notes.</p><p>First, I verified Windows 7 right now. I built OVMF from edk2 SVN r18122 (git 7669f734). Both the installer ISO (&quot;en_windows_7_professional_with_sp1_x64_dvd_u_676939.iso&quot;) and my preexistent guest boot to the GUI just fine, using QXL.</p><p>Second, I don&#039;t understand why you said &quot;i failed to attach the debug console&quot; again. I explained in excruciating detail how you should edit the domain XML, here: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1548842#p1548842" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 2#p1548842</a> . You didn&#039;t react to that comment, so I guess you either missed it, or didn&#039;t read it far enough for the actual XML snippet.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549762">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549767" class="blockpost roweven"> <h2><span><span class="conr">#5791</span> <a href="viewtopic.php?pid=1549767#p1549767">2015-08-01 21:37:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92953">morphological</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-08-01</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey Guys!</p><p>I have been trying to get GPU passthrough to work, but cannot seem to find out where the problem lies, since I do not get any errors.</p><p>I have primarily used these guides as sources:<br /><a href="http://ubuntuforums.org/showthread.php?t=2262280" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2262280</a><br /><a href="https://www.pugetsystems.com/labs/articles/Multiheaded-NVIDIA-Gaming-using-Ubuntu-14-04-KVM-585/" rel="nofollow">https://www.pugetsystems.com/labs/artic … 4-KVM-585/</a><br /><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?id=162768</a></p><p>Specs:<br />Lubuntu 14.04 with patched 3.18.0 kernel<br />GTX 750TI<br />i5 4690K (VT-d enabled)<br />Gigabyte Z97 D3H<br />TV with multiple outputs (VGA, HDMI)</p><p>The IGPU runs over VGA, whereas the GPU is connected via HDMI.<br />I use the IGPU for the host system, while attempting to pass the GTX 750TI through to the Guest.<br />Both are connected to one single TV.<br />When I run the script, a qemu window pops up saying &quot;compat_monitor0 console Qemu 2.1.2 monitor - type help<br />When I switch to the HDMI output of the TV, to which the CPU is connected, nothing appears. However, my GPU usage ramps up to 25%, hence something must be going on.<br /><a href="http://s18.postimg.org/9u9hg6v61/qemu.png" rel="nofollow">http://s18.postimg.org/9u9hg6v61/qemu.png</a></p><p>When I assign one of the downloaded gpu roms in the script, the colors become fuzzy and inverted (which cannot be seen on the screen), while nothing appears on the HDMI output and the cpu usage only momentarily rises, while dropping shortly after:<br /><a href="http://postimg.org/image/4txnlf85x/" rel="nofollow">http://postimg.org/image/4txnlf85x/</a></p><p>Prepwork:<br />.)I compiled, patched and installed kernel 3.18.0 with ACS and i915: <a href="http://ubuntuforums.org/showthread.php?t=2262280" rel="nofollow">http://ubuntuforums.org/showthread.php?t=2262280</a><br />.)Downloaded a rom file for my GPU (GTX 750 TI): <a href="http://www.techpowerup.com/vgabios/index.php?architecture=NVIDIA&amp;manufacturer=MSI&amp;model=GTX+750+Ti&amp;interface=&amp;memType=&amp;memSize=" rel="nofollow">http://www.techpowerup.com/vgabios/inde … =&amp;memSize=</a><br />.)Upgraded Qemu to version 2.1.2 via this ppa:jacob/virtualisation<br />.)Installed all necessary packages as suggested by this guide: <a href="https://help.ubuntu.com/community/KVM/Installation" rel="nofollow">https://help.ubuntu.com/community/KVM/Installation</a></p><br /><p>1.)Grub</p><div class="codebox"><pre><code>GRUB_DEFAULT=0 GRUB_HIDDEN_TIMEOUT=0 GRUB_HIDDEN_TIMEOUT_QUIET=true GRUB_TIMEOUT=10 GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian` GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pcie_acs_override=downstream i915.enable_hd_vgaarb=1&quot; GRUB_CMDLINE_LINUX=&quot;&quot;</code></pre></div><p>2.)Nvidia IDs</p><div class="codebox"><pre><code>lspci -nn | grep NVIDIA 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GM107 [GeForce GTX 750 Ti] [10de:1380] (rev a2) 01:00.1 Audio device [0403]: NVIDIA Corporation Device [10de:0fbc] (rev a1)</code></pre></div><p>3.)/etc/initramfs-tools/modules</p><div class="codebox"><pre><code>pci_stub ids=10de:1380,10de:0fbc</code></pre></div><p>4.)/etc/vfio-pci.cfg</p><div class="codebox"><pre><code>0000:01:00.0 0000:01:00.1</code></pre></div><p>5.)Here my script (Here without a rom file assigned, this can be seen in the screen above)</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash configfile=/etc/vfio-pci.cfg vfiobind() { dev=&quot;$1&quot; vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id } modprobe vfio-pci cat $configfile | while read line;do echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue vfiobind $line done sudo qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -drive file=/home/jackson/windows.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -drive file=/home/jackson/Downloads/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -boot menu=on exit 0 </code></pre></div><p>Please help me find out what&#039;s wrong.</p><p>Thank you!</p> <p class="postedit"><em>Last edited by morphological (2015-08-02 06:52:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549767">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549769" class="blockpost rowodd"> <h2><span><span class="conr">#5792</span> <a href="viewtopic.php?pid=1549769#p1549769">2015-08-01 21:39:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=25579">jasonwryan</a></strong></dt> <dd class="usertitle"><strong>Forum &amp; Wiki Admin</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/25579.png?m=1386831523" width="80" height="69" alt="" /></dd> <dd><span>From: .nz</span></dd> <dd><span>Registered: 2009-05-09</span></dd> <dd><span>Posts: 15,669</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=25579">Email</a></span> <span class="website"><a href="http://jasonwryan.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://www.flickr.com/photos/jasonwryan/9333810442/lightbox/" rel="nofollow">Arch + dwm</a>&#160; &#160;•&#160; &#160;<a href="http://bitbucket.jasonwryan.com/" rel="nofollow">Mercurial repos</a>&#160; •&#160; &#160;<a href="https://github.com/jasonwryan/" rel="nofollow">Github</a></p><p>Registered Linux User #482438</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549769">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549846" class="blockpost roweven"> <h2><span><span class="conr">#5793</span> <a href="viewtopic.php?pid=1549846#p1549846">2015-08-02 05:57:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90432">wmarler</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Denver, CO</span></dd> <dd><span>Registered: 2015-04-18</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90432">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@morphological</p><p>I have no experience with getting VGA passthrough working on Lubuntu, but I did get it working with both Fedora 22 and Arch, with both Windows 7 and Windows 10 technical preview, with the same video card &amp; very similar GPU (i5-4690. &quot;K&quot; versions usually do not support VT-d but <a href="http://ark.intel.com/products/80811/Intel-Core-i5-4690K-Processor-6M-Cache-up-to-3_90-GHz?q=4690k" rel="nofollow">according to ARK</a> yours does, so that&#039;s good). You should use the UEFI method and do not patch your kernel with the i915 VGA arbiter patch; your video card supports it. Also, you do not need to download a ROM for the card. Be advised, you will need to use <a href="https://bbs.archlinux.org/viewtopic.php?pid=1518188#p1518188" rel="nofollow">this version</a> of the OVMF binaries. Without it, the install will start but fail (with no messages... very maddening).</p><p>If you have access to/a license for Windows 10, I recommend using it over 7. For me at least, it performed much better. I can&#039;t speak to Windows 8/8.1.</p><p>You didn&#039;t mention using <a href="http://vfio.blogspot.com/2015/05/vfio-gpu-how-to-series-part-3-host.html" rel="nofollow">Alex Williamson&#039;s blog</a> as a guide. You should read it. This forum is way too long, and the blog condenses what you need to know down into a few good posts. I linked you at part 3; you should read &amp; follow it and part 4. The comments are helpful too; there are not many to sift through.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549846">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549870" class="blockpost rowodd"> <h2><span><span class="conr">#5794</span> <a href="viewtopic.php?pid=1549870#p1549870">2015-08-02 09:20:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80830">gneville</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-02</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I can confirm also that edk2 SVN r18123, which I got from here <a href="https://www.kraxel.org/repos/jenkins/edk2/" rel="nofollow">https://www.kraxel.org/repos/jenkins/edk2/</a> , works for me when Installing and Running Windows7</p><p><span class="bbs">However I can only get it working still via qemu command line.</span></p><p><span class="bbs">@lersek have you managed to get Windows7 working via libvirt? If so could you provide a copy of your XML file?</span></p><p>Edit: I&#039;ve managed to get it working now with libvirt, I had to take away some of the hyper-v settings:</p><br /><div class="codebox"><pre><code> &lt;features&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;/features&gt; &lt;clock&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt;</code></pre></div><br /><p>Edit2: Speifying the nvram file, got me past the issue where I&#039;d always have to manually boot the UEFI bootloader e.g. FS1: \EFI\Boot\bootx64.fd. I had to change the boot order in the Tiano Core BIOS and have it.</p><p>Here&#039;s my XML file in case anyone wants to refer to it:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;windows7&lt;/name&gt; &lt;uuid&gt;7b222825-fc7d-4a66-a72c-5875063752d2&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;5291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;5291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;2&lt;/vcpu&gt; &lt;cputune&gt; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;2&#039;/&gt; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;3&#039;/&gt; &lt;/cputune&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039; readonly=&#039;yes&#039;&gt;/home/root/ovmf-builds/ovmf-jenkins/ovmf-x64-02082015/usr/share/edk2.git/ovmf-x64-18123/OVMF-pure-efi.fd&lt;/loader&gt; &lt;nvram&gt;/home/root/ovmf-builds/ovmf-jenkins/ovmf-x64-02082015/usr/share/edk2.git/ovmf-x64-18123/OVMF_VARS-pure-efi.fd&lt;/nvram&gt; &lt;boot dev=&#039;cdrom&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-passthrough&#039;/&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;destroy&lt;/on_crash&gt; &lt;devices&gt; &lt;emulator&gt;/usr/local/qemu-2-4-0-rc3/bin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039; /&gt; &lt;source file=&#039;/virtualguests/windows7/windows7-c-drive.qcow2&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/root/virtualguestisos/windows7/Windows_7_64-bit_Professional_x64.iso&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/home/root/virtualguestisos/virtio-isos/virtio-win-0.1-74.iso&#039;/&gt; &lt;target dev=&#039;hdd&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;1&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039; /&gt; &lt;interface type=&#039;bridge&#039;&gt; &lt;mac address=&#039;52:54:00:12:34:76&#039;/&gt; &lt;source bridge=&#039;br0&#039;/&gt; &lt;target dev=&#039;tap8&#039;/&gt; &lt;model type=&#039;e1000&#039;/&gt; &lt;alias name=&#039;virtio&#039;/&gt; &lt;rom bar=&#039;off&#039;/&gt; &lt;/interface&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52e&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x045e&#039;/&gt; &lt;product id=&#039;0x0719&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;no&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0fcf&#039;/&gt; &lt;product id=&#039;0x1009&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039; /&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;none&#039;/&gt; &lt;graphics type=&#039;vnc&#039; port=&#039;5903&#039; autoport=&#039;no&#039; listen=&#039;0.0.0.0&#039;&gt; &lt;listen type=&#039;address&#039; address=&#039;0.0.0.0&#039;/&gt; &lt;/graphics&gt; &lt;video&gt; &lt;model type=&#039;qxl&#039; ram=&#039;65536&#039; vram=&#039;65536&#039; vgamem=&#039;16384&#039; heads=&#039;1&#039;/&gt; &lt;/video&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><br /><p>Thanks</p><div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div><p>Just two quick notes.</p><p>First, I verified Windows 7 right now. I built OVMF from edk2 SVN r18122 (git 7669f734). Both the installer ISO (&quot;en_windows_7_professional_with_sp1_x64_dvd_u_676939.iso&quot;) and my preexistent guest boot to the GUI just fine, using QXL.</p><p>Second, I don&#039;t understand why you said &quot;i failed to attach the debug console&quot; again. I explained in excruciating detail how you should edit the domain XML, here: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1548842#p1548842" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 2#p1548842</a> . You didn&#039;t react to that comment, so I guess you either missed it, or didn&#039;t read it far enough for the actual XML snippet.</p></div></blockquote></div> <p class="postedit"><em>Last edited by gneville (2015-08-02 13:13:43)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549870">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1549994" class="blockpost roweven"> <h2><span><span class="conr">#5795</span> <a href="viewtopic.php?pid=1549994#p1549994">2015-08-02 19:13:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>@gneville:<br />I have problems installing windows7 on OVMF since... 18 of july.<br />I don&#039;t know what causes it, as i failed to attach the debug console.<br />Glad to see you&#039;ve managed to finish it up via commandline.<br />It just hangs when the setup-from-hard-drive starts to boot up.</p></div></blockquote></div><p>Just two quick notes.</p><p>First, I verified Windows 7 right now. I built OVMF from edk2 SVN r18122 (git 7669f734). Both the installer ISO (&quot;en_windows_7_professional_with_sp1_x64_dvd_u_676939.iso&quot;) and my preexistent guest boot to the GUI just fine, using QXL.</p><p>Second, I don&#039;t understand why you said &quot;i failed to attach the debug console&quot; again. I explained in excruciating detail how you should edit the domain XML, here: <a href="https://bbs.archlinux.org/viewtopic.php?pid=1548842#p1548842" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 2#p1548842</a> . You didn&#039;t react to that comment, so I guess you either missed it, or didn&#039;t read it far enough for the actual XML snippet.</p></div></blockquote></div><p>Thanks, i&#039;ve missed that post because i&#039;ve posted an answer to someone else&#039;s post the moment you&#039;ve posted. Thanks! <br />Strangely though, i remember specifying the namespace, and libvirt didn&#039;t object on the syntax, however i didn&#039;t check for the actual QEMU command line produced. Will test again soon.</p><div class="quotebox"><cite>gneville wrote:</cite><blockquote><div><p>Edit2: Speifying the nvram file, got me past the issue where I&#039;d always have to manually boot the UEFI bootloader e.g. FS1: \EFI\Boot\bootx64.fd. I had to change the boot order in the Tiano Core BIOS and have it.</p></div></blockquote></div><p>Well, usually libvirt makes a copy of the OVMF_VARS file, where all the variale stuff are stored. Yeah, boot order is there too. If the loader is specified there, OVMF doesn&#039;t do it&#039;s &quot;scan for all loaders&quot; routine and boots the next available device, which is PXE, i guess. I might be wrong in that sentence.<br />I don&#039;t know why your VM didn&#039;t make that copy.</p><p>---</p><div class="quotebox"><cite>dragonreborn wrote:</cite><blockquote><div><p>It&#039;s most probably a hardware fault, fans aren&#039;t working on vga at all. Caused the card to overheat and stop working in 10 minutes.</p></div></blockquote></div><p>I wasn&#039;t swift enough to tell that this is really an overheating case.</p><div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p></div></blockquote></div><p>How about us ignoring that rule for another two years please? I run fedora, and <span class="bbu">all</span> my messages belong to this particular topic because that thread is the only thread on the net with that much of activity and info. There are lersek(who&#039;s the developer of OVMF) and aw(who&#039;s the (redhat i guess) developer of vfio).<br />Most of the questions are not distro-specific, anyway. If the arch packages differ from what others are using, it&#039;s only either a more fresh version of an upstream package, or with some very rare and specific patches like OVMF with sata booting.</p> <p class="postedit"><em>Last edited by Duelist (2015-08-02 19:40:38)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1549994">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1550013" class="blockpost rowodd"> <h2><span><span class="conr">#5796</span> <a href="viewtopic.php?pid=1550013#p1550013">2015-08-02 20:31:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=92218">impulse_255</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-06-29</span></dd> <dd><span>Posts: 22</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I switched to Windows 10. I found a comment on Alex&#039;s blog a while ago that suggested that on Win 10 Nvidia&#039;s driver only does Hyper-V checks when the system reboots.</p><p>Peculiarly, it is so. I&#039;ve been running the VM with HV enlightenments on and it keeps working after several shutdown/start cycles. Only when the guest is rebooted or started up after a crash, does the driver crap out with code 43 (edit: and during driver installation, I would assume). Likewise when in code 43 state, the guest must be rebooted when HV is off to fix it. Afterwards HV can be enabled again. The same behaviour happens with a quadro. I mentioned earlier that the quadro driver also detects HV but instead of refusing to work it runs in some kind of degraded mode (tldr: refresh rates are capped and some other functionality is missing in control panel).</p><p>Now I can get 144 Hz output to my monitor without sacrificing HV. Since I&#039;m avoiding the HV checks anyway, I&#039;m running with Geforce pci ids instead of Quadro&#039;s so overclocking tools work to their full extent as well.</p><p>Edit 2: I wonder if this is because of Fast Boot? Win 8 has it too, but I can&#039;t remember if I had it enabled. It&#039;s worth noting that libvirt seems to disable hibernation by default which prevents Fast Boot from working.</p> <p class="postedit"><em>Last edited by impulse_255 (2015-08-02 20:35:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1550013">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1550025" class="blockpost roweven"> <h2><span><span class="conr">#5797</span> <a href="viewtopic.php?pid=1550025#p1550025">2015-08-02 21:20:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=25579">jasonwryan</a></strong></dt> <dd class="usertitle"><strong>Forum &amp; Wiki Admin</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/25579.png?m=1386831523" width="80" height="69" alt="" /></dd> <dd><span>From: .nz</span></dd> <dd><span>Registered: 2009-05-09</span></dd> <dd><span>Posts: 15,669</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=25579">Email</a></span> <span class="website"><a href="http://jasonwryan.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p></div></blockquote></div><p>How about us ignoring that rule for another two years please? I run fedora, and <span class="bbu">all</span> my messages belong to this particular topic because that thread is the only thread on the net with that much of activity and info. There are lersek(who&#039;s the developer of OVMF) and aw(who&#039;s the (redhat i guess) developer of vfio).<br />Most of the questions are not distro-specific, anyway. If the arch packages differ from what others are using, it&#039;s only either a more fresh version of an upstream package, or with some very rare and specific patches like OVMF with sata booting.</p></div></blockquote></div><p>No. There are support communities for those distributions; these boards are for Arch.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://www.flickr.com/photos/jasonwryan/9333810442/lightbox/" rel="nofollow">Arch + dwm</a>&#160; &#160;•&#160; &#160;<a href="http://bitbucket.jasonwryan.com/" rel="nofollow">Mercurial repos</a>&#160; •&#160; &#160;<a href="https://github.com/jasonwryan/" rel="nofollow">Github</a></p><p>Registered Linux User #482438</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1550025">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1550026" class="blockpost rowodd"> <h2><span><span class="conr">#5798</span> <a href="viewtopic.php?pid=1550026#p1550026">2015-08-02 21:24:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p></div></blockquote></div><p>How about us ignoring that rule for another two years please? I run fedora, and <span class="bbu">all</span> my messages belong to this particular topic because that thread is the only thread on the net with that much of activity and info. There are lersek(who&#039;s the developer of OVMF) and aw(who&#039;s the (redhat i guess) developer of vfio).<br />Most of the questions are not distro-specific, anyway. If the arch packages differ from what others are using, it&#039;s only either a more fresh version of an upstream package, or with some very rare and specific patches like OVMF with sata booting.</p></div></blockquote></div><p>No. There are support communities for those distributions; these boards are for Arch.</p></div></blockquote></div><p>Ok, seeya.&#160; I thought this board was open to productive, distro agnostic discussions, but if non-Arch users are going to get turned away, you&#039;ll need to find another expert.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1550026">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1550045" class="blockpost roweven"> <h2><span><span class="conr">#5799</span> <a href="viewtopic.php?pid=1550045#p1550045">2015-08-02 22:43:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p></div></blockquote></div><p>What? Why? we&#039;ve been using this forum for 2 years now for everything and everyone related to gpu passthrough, so why now? make no sense</p> <p class="postedit"><em>Last edited by nbhs (2015-08-02 22:43:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1550045">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1550051" class="blockpost rowodd"> <h2><span><span class="conr">#5800</span> <a href="viewtopic.php?pid=1550051#p1550051">2015-08-02 22:51:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=25579">jasonwryan</a></strong></dt> <dd class="usertitle"><strong>Forum &amp; Wiki Admin</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/25579.png?m=1386831523" width="80" height="69" alt="" /></dd> <dd><span>From: .nz</span></dd> <dd><span>Registered: 2009-05-09</span></dd> <dd><span>Posts: 15,669</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=25579">Email</a></span> <span class="website"><a href="http://jasonwryan.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>jasonwryan wrote:</cite><blockquote><div><p>Please ask on your distro&#039;s boards, we only support Arch: <a href="https://wiki.archlinux.org/index.php/Forum_etiquette#Arch_Linux_distribution_support_ONLY" rel="nofollow">https://wiki.archlinux.org/index.php/Fo … pport_ONLY</a></p></div></blockquote></div><p>What? Why? we&#039;ve been using this forum for 2 years now for everything and everyone related to gpu passthrough, so why now? make no sense</p></div></blockquote></div><p>We have the policy for a reason. This thread is no different to the rest of the boards; so, yes, it does make sense, it is entirely consistent with the overall approach.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://www.flickr.com/photos/jasonwryan/9333810442/lightbox/" rel="nofollow">Arch + dwm</a>&#160; &#160;•&#160; &#160;<a href="http://bitbucket.jasonwryan.com/" rel="nofollow">Mercurial repos</a>&#160; •&#160; &#160;<a href="https://github.com/jasonwryan/" rel="nofollow">Github</a></p><p>Registered Linux User #482438</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1550051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=231">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=230">230</a> <a href="viewtopic.php?id=162768&amp;p=231">231</a> <strong>232</strong> <a href="viewtopic.php?id=162768&amp;p=233">233</a> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=233">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
