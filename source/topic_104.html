<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 104) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=104" title="Page 104" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=103" title="Page 103" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=105" title="Page 105" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=103">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=102">102</a> <a href="viewtopic.php?id=162768&amp;p=103">103</a> <strong>104</strong> <a href="viewtopic.php?id=162768&amp;p=105">105</a> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=105">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1451055" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#2576</span> <a href="viewtopic.php?pid=1451055#p1451055">2014-08-27 14:13:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83719">josipva</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83719">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><p>I have an 4790K with Win 8.1 using 4 vcpu and a 7950, if you&#039;d like I can run a benchmark if you tell me which one. Windows performance index is 8.1 for CPU, memory and graphics.</p></div></blockquote></div><p>Could you try cinebench with 4vcpu and 3 vcpu so I can compare it to native 4690 results ?</p><p>P.S. Thanks &quot;siddharta&quot; and &quot;aw&quot; for info so far.</p> <p class="postedit"><em>Last edited by josipva (2014-08-27 14:34:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451138" class="blockpost roweven"> <h2><span><span class="conr">#2577</span> <a href="viewtopic.php?pid=1451138#p1451138">2014-08-27 18:35:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81745">siddharta</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-03</span></dd> <dd><span>Posts: 30</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>josipva wrote:</cite><blockquote><div><div class="quotebox"><cite>siddharta wrote:</cite><blockquote><div><p>I have an 4790K with Win 8.1 using 4 vcpu and a 7950, if you&#039;d like I can run a benchmark if you tell me which one. Windows performance index is 8.1 for CPU, memory and graphics.</p></div></blockquote></div><p>Could you try cinebench with 4vcpu and 3 vcpu so I can compare it to native 4690 results ?</p><p>P.S. Thanks &quot;siddharta&quot; and &quot;aw&quot; for info so far.</p></div></blockquote></div><p>488cb for 3 vcpu, 590cb for 4 vcpu, 790 for 6 vcpu (for completeness). This could possibly be improved still, this is a clean install and not much tweaking was done.</p><p><a href="http://imgur.com/touYvyQ,EqM4eGw#1" rel="nofollow">http://imgur.com/touYvyQ,EqM4eGw#1</a> (forgot to screencap the 6 vcpu, sorry)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451138">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451146" class="blockpost rowodd"> <h2><span><span class="conr">#2578</span> <a href="viewtopic.php?pid=1451146#p1451146">2014-08-27 18:58:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83719">josipva</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83719">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Huge thanks. Helps a lot to estimate performance.</p><p>EDIT:</p><p>Interesting stuff 4vcpu performance puts it in line with 4690.</p> <p class="postedit"><em>Last edited by josipva (2014-08-27 19:20:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451146">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451171" class="blockpost roweven"> <h2><span><span class="conr">#2579</span> <a href="viewtopic.php?pid=1451171#p1451171">2014-08-27 20:37:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>josipva wrote:</cite><blockquote><div><p>Huge thanks. Helps a lot to estimate performance.</p><p>EDIT:</p><p>Interesting stuff 4vcpu performance puts it in line with 4690.</p></div></blockquote></div><p>Sure, if you only expect one VM to be under load at any given point, your i5-4690 is a good comparison.&#160; If you want the worst case performance where both VMs are under load, I think you&#039;ll be closer to the i3 processor.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451171">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451345" class="blockpost rowodd"> <h2><span><span class="conr">#2580</span> <a href="viewtopic.php?pid=1451345#p1451345">2014-08-28 15:33:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79135">bonob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-02</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It&#039;s not directly related with the topic at hand, but maybe some people around here have the same config as I have and will be able to confirm whether I&#039;m understanding my issue correctly (and possibly confirm if they suffer the same fate.)</p><p>I send the audio from my (Windows) VM to my (Arch) host using NetJack2 (mostly following <a href="http://forums.linuxmint.com/viewtopic.php?f=42&amp;t=160527" rel="nofollow">this guide</a>.) It&#039;s been working pretty well for the past few months.<br />Since I rebooted yesterday, it&#039;s not working anymore. I noticed that <a href="https://www.archlinux.org/packages/community/x86_64/jack2-dbus/" rel="nofollow">jack2-dbus</a> has just been updated to 1.9.10, so I&#039;m wondering if that&#039;s the cause of my trouble.</p><p>From what I can see, everything is working as usual, jack can play audio on the host, the virtual cable is plugged on the guest, the qjackctls on either side are not reporting anything unusual.<br />It seems that the problem is that the jack slave and the master cannot find each other, whereas they used to. So I&#039;m thinking that maybe the auto-discovery feature of NetJack2 is somehow broken?</p> <p class="postedit"><em>Last edited by bonob (2014-08-28 15:35:03)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451345">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451461" class="blockpost roweven"> <h2><span><span class="conr">#2581</span> <a href="viewtopic.php?pid=1451461#p1451461">2014-08-28 23:35:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I don&#039;t expect everyone is following my new blog (yet), but I wrote this up yesterday:<br />...</p></div></blockquote></div><p>I&#039;ve just successfully got my HD7770 passed through to my Win7 VM (trick was to not pass the sound with it - good tip redger) and proved capability.<br />Still have to work out networking and sound, but progress is always encouraging.<br />I will have to consider Win8 based on your UEFI comments, but will wait for my GTX750ti first and give that a crack.</p></div></blockquote></div><p>Just in addition to this, happy with the performance and can stream a steam game across the network fine (HD7770 anyway, haven&#039;t worked out how to get the GTX750 working yet..), but high level question about sound if anyone could help please.<br />I see the sound config details on p1, and will use for some testing, but going forward I want to use alsa on the host for some distributed home audio stuff (with a couple pcie sound cards).<br />Does that mean I can really only use pulseaudio for the VM? Will I run into conflicts later if I use alsa on both?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451461">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451482" class="blockpost rowodd"> <h2><span><span class="conr">#2582</span> <a href="viewtopic.php?pid=1451482#p1451482">2014-08-29 01:30:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I don&#039;t expect everyone is following my new blog (yet), but I wrote this up yesterday:<br />...</p></div></blockquote></div><p>I&#039;ve just successfully got my HD7770 passed through to my Win7 VM (trick was to not pass the sound with it - good tip redger) and proved capability.<br />Still have to work out networking and sound, but progress is always encouraging.<br />I will have to consider Win8 based on your UEFI comments, but will wait for my GTX750ti first and give that a crack.</p></div></blockquote></div><p>Just in addition to this, happy with the performance and can stream a steam game across the network fine (HD7770 anyway, haven&#039;t worked out how to get the GTX750 working yet..), but high level question about sound if anyone could help please.<br />I see the sound config details on p1, and will use for some testing, but going forward I want to use alsa on the host for some distributed home audio stuff (with a couple pcie sound cards).<br />Does that mean I can really only use pulseaudio for the VM? Will I run into conflicts later if I use alsa on both?</p></div></blockquote></div><p>Does audio only work with steam in-home-streaming when routed through the GPU audio?&#160; This was the conclusion I came to when I attempted to do streaming on a bare metal system without a monitor connected to the GPU, but I didn&#039;t try too hard.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451482">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451494" class="blockpost roweven"> <h2><span><span class="conr">#2583</span> <a href="viewtopic.php?pid=1451494#p1451494">2014-08-29 02:37:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Does audio only work with steam in-home-streaming when routed through the GPU audio?&#160; This was the conclusion I came to when I attempted to do streaming on a bare metal system without a monitor connected to the GPU, but I didn&#039;t try too hard.</p></div></blockquote></div><p>Yeah, this is my question essentially. I can&#039;t add in the audio device to my VM, as it won&#039;t boot with it.<br />Just the video card device itself is fine though, and at least gives me accelerated video capability.<br />Will try some audio lines to test, but get the feeling I&#039;ll still need to keep a second box or dual boot <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /><br />Be a bummer, as the main VM use for me would be steam streaming.<br />Not sure if I&#039;ll have more luck with my nvidia card, but a quick test yesterday just got me emulator error, like others have had in earlier posts. Still have to sort that out. More testing ahead...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451494">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451514" class="blockpost rowodd"> <h2><span><span class="conr">#2584</span> <a href="viewtopic.php?pid=1451514#p1451514">2014-08-29 05:04:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>steaming doesn&#039;t need sound card on guest, if u don&#039;t want sound (some games require sound card), but it can use any sound card... i am using&#160; &#160; </p><p>&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0&#039;/&gt;</p><p>since i don&#039;t need any audio on host / audio-output&#160; on guest, and hdmi audio causes problems after 30mins or so (in my case)....</p> <p class="postedit"><em>Last edited by slis (2014-08-29 05:08:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451514">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451529" class="blockpost roweven"> <h2><span><span class="conr">#2585</span> <a href="viewtopic.php?pid=1451529#p1451529">2014-08-29 07:59:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84731">Cenm</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-29</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve managed to get everything working for the first boot of the VM but it fails for every subsequent boot with the error &#039;vfio-pci 0000:03:00.0: Invalid ROM contents&#039;</p><p>If I specify romfile=/path/to/rom I don&#039;t get the error but nothing appears on the screen.</p><p>I have also noticed when I kill the VM whatever was on the screen remains there until I start the VM again, at which point the screen turns off.</p><p>Any advice would be great.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451529">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451547" class="blockpost rowodd"> <h2><span><span class="conr">#2586</span> <a href="viewtopic.php?pid=1451547#p1451547">2014-08-29 11:52:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>steaming doesn&#039;t need sound card on guest, if u don&#039;t want sound (some games require sound card), but it can use any sound card... i am using&#160; &#160; </p><p>&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0&#039;/&gt;</p><p>since i don&#039;t need any audio on host / audio-output&#160; on guest, and hdmi audio causes problems after 30mins or so (in my case)....</p></div></blockquote></div><p>Awesome,thanks. Will try this. I do need alsa audio on the host, and I want audio for streaming games, so will see if anything can work on the guest.</p><p>Still having issues with nvidia card though.<br />Is the kvm=off option still required for nvidia?<br />ref &quot;If you&#039;re a GeForce user, libirt just got support for kvm=off and QEMU will now automatically enable the primary device quirk for Nvidia GPUs independent of VGA&quot; posted a while back.</p><p>I cannot get anything on screen booting with a guest GTX750ti (HD5450 host), though had video passthrough fine with guest HD7770.<br />I get the QEMU window for a minute, then <br />KVM internal error. Suberror: 1<br />emulation failure<br />EAX=ffff0 ... etc<br />I tried cpu kvm=off option, but that fails also with<br />qemu-system-x86_64: Property &#039;.kvm&#039; not found</p><p>Nothing else was changed from the HD7770 setup (except for stub IDs for new card)... ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451547">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451552" class="blockpost roweven"> <h2><span><span class="conr">#2587</span> <a href="viewtopic.php?pid=1451552#p1451552">2014-08-29 12:20:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Wimma77 wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>steaming doesn&#039;t need sound card on guest, if u don&#039;t want sound (some games require sound card), but it can use any sound card... i am using&#160; &#160; </p><p>&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;-device&#039;/&gt;<br />&#160; &#160; &lt;qemu:arg value=&#039;hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0&#039;/&gt;</p><p>since i don&#039;t need any audio on host / audio-output&#160; on guest, and hdmi audio causes problems after 30mins or so (in my case)....</p></div></blockquote></div><p>Awesome,thanks. Will try this. I do need alsa audio on the host, and I want audio for streaming games, so will see if anything can work on the guest.</p><p>Still having issues with nvidia card though.<br />Is the kvm=off option still required for nvidia?<br />ref &quot;If you&#039;re a GeForce user, libirt just got support for kvm=off and QEMU will now automatically enable the primary device quirk for Nvidia GPUs independent of VGA&quot; posted a while back.</p></div></blockquote></div><p>These are two separate things.&#160; kvm=off will always be required as long as the guest Nvidia driver decides to bail when it finds KVM.&#160; The QEMU change allows Nvidia to work with OVMF (ie. without x-vga=on).</p><div class="quotebox"><blockquote><div><p>I cannot get anything on screen booting with a guest GTX750ti (HD5450 host), though had video passthrough fine with guest HD7770.<br />I get the QEMU window for a minute, then <br />KVM internal error. Suberror: 1<br />emulation failure<br />EAX=ffff0 ... etc<br />I tried cpu kvm=off option, but that fails also with<br />qemu-system-x86_64: Property &#039;.kvm&#039; not found</p></div></blockquote></div><p>This means you are not running a new enough QEMU.&#160; You need at least 2.1 for the kvm=off property.</p><div class="quotebox"><blockquote><div><p>Nothing else was changed from the HD7770 setup (except for stub IDs for new card)... ?</p></div></blockquote></div><p>What is your primary graphics for this test?&#160; Does FAQ question 4 apply?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451552">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451558" class="blockpost rowodd"> <h2><span><span class="conr">#2588</span> <a href="viewtopic.php?pid=1451558#p1451558">2014-08-29 12:56:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>These are two separate things.&#160; kvm=off will always be required as long as the guest Nvidia driver decides to bail when it finds KVM.&#160; The QEMU change allows Nvidia to work with OVMF (ie. without x-vga=on).<br />This means you are not running a new enough QEMU.&#160; You need at least 2.1 for the kvm=off property.<br />What is your primary graphics for this test?&#160; Does FAQ question 4 apply?</p></div></blockquote></div><p>Ok, wasn&#039;t sure I&#039;d need kvm=off. Looking at <a href="https://bbs.archlinux.org/viewtopic.php?pid=1313007#p1313007" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 7#p1313007</a> shows ubuntu success using older version, and similar host ATI card (I have HD5450) and guest nvidia. Will try newer QEMU this weekend anyway, no harm.<br />No errors from memory in dmesg like FAQ#3, but as I have a headless server NFI if it had any video issues. VNC to my xfce4 desktop was fine though! lol<br />Also just noticed card has the hybrid BIOS switch thing, so may set to legacy and try also, as using Win7.<br />Thanks again.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451558">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451561" class="blockpost roweven"> <h2><span><span class="conr">#2589</span> <a href="viewtopic.php?pid=1451561#p1451561">2014-08-29 13:10:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82643">abdullah</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-10</span></dd> <dd><span>Posts: 33</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I don&#039;t expect everyone is following my new blog (yet), but I wrote this up yesterday:</p><p><a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow">http://vfio.blogspot.com/2014/08/primar … t-vga.html</a></p><p>I&#039;m not the first to try this, former active user on this thread DanaGoyette attempted this, but never fully debugged the issues.&#160; Using OVMF (UEFI) for the guest we can avoid all of the issues with the VGA aspects of GPU assignment.&#160; This means that we don&#039;t care about how broken the i915 driver is and we don&#039;t need the x-vga option for the assigned device, making it just another assigned devices as far as libvirt is concerned.</p><p>Also:</p><p><a href="http://vfio.blogspot.com/2014/08/upstream-updates-for-august-26th-2014.html" rel="nofollow">http://vfio.blogspot.com/2014/08/upstre … -2014.html</a></p><p>If you&#039;re a GeForce user, libirt just got support for kvm=off and QEMU will now automatically enable the primary device quirk for Nvidia GPUs independent of VGA.</p></div></blockquote></div><p>Nicely done!, I was thinking about the same thing, I may submit a post or 2, maybe do some translation as well, but let me find the time for it.</p><p>Now everything works perfect exept one thing, when ever the proccess of qemu is killed, the guest OS becomes corrupted, is that the matter with the format of the container (using raw data here) ?, what should be done to avoid this problem, what if the powerd is lost suddenly for example.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451561">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451572" class="blockpost rowodd"> <h2><span><span class="conr">#2590</span> <a href="viewtopic.php?pid=1451572#p1451572">2014-08-29 13:57:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>abdullah wrote:</cite><blockquote><div><p>Nicely done!, I was thinking about the same thing, I may submit a post or 2, maybe do some translation as well, but let me find the time for it.</p></div></blockquote></div><p>That would be great!</p><div class="quotebox"><blockquote><div><p>Now everything works perfect exept one thing, when ever the proccess of qemu is killed, the guest OS becomes corrupted, is that the matter with the format of the container (using raw data here) ?, what should be done to avoid this problem, what if the powerd is lost suddenly for example.</p></div></blockquote></div><p>Are you specifying any cache option for the guest block device?&#160; There is a cache=unsafe option which uses the host buffer cache, but as the name implies, it&#039;s not safe.&#160; I typically use raw images or lvm volumes and I don&#039;t have much issue with killing the guest.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451572">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451588" class="blockpost roweven"> <h2><span><span class="conr">#2591</span> <a href="viewtopic.php?pid=1451588#p1451588">2014-08-29 15:03:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83719">josipva</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83719">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sure, if you only expect one VM to be under load at any given point, your i5-4690 is a good comparison.&#160; If you want the worst case performance where both VMs are under load, I think you&#039;ll be closer to the i3 processor.</p></div></blockquote></div><p>That makes sense. What do you think about newly released i7-5820k (it&#039;s only a bit more expensive than 4790k)? Could I clock it a bit, give 5 vcpu to each VM and leave 2vcpu for host while getting equivalent of 4690 performance for each VM (running simultaneously ofc)?</p> <p class="postedit"><em>Last edited by josipva (2014-08-29 15:04:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451588">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451592" class="blockpost rowodd"> <h2><span><span class="conr">#2592</span> <a href="viewtopic.php?pid=1451592#p1451592">2014-08-29 15:14:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>josipva wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sure, if you only expect one VM to be under load at any given point, your i5-4690 is a good comparison.&#160; If you want the worst case performance where both VMs are under load, I think you&#039;ll be closer to the i3 processor.</p></div></blockquote></div><p>That makes sense. What do you think about newly released i7-5820k (it&#039;s only a bit more expensive than 4790k)? Could I clock it a bit, give 5 vcpu to each VM and leave 2vcpu for host while getting equivalent of 4690 performance for each VM (running simultaneously ofc)?</p></div></blockquote></div><p>-ENOCPUINARK&#160; But I see elsewhere that it&#039;s a hex-core+threads and it&#039;s got a lower clock speed (3.3GHz) and since it&#039;s not in ARK yet, unknown VT-d support.&#160; With this CPU you&#039;ve gained 2 more cores, but you&#039;ve lost too much clock to be comparable to the i5-4690.&#160; You could reasonable have 2 concurrent sockets=1,cores=3,threads=2 VMs but it&#039;s difficult to compare 3cores+threads @3.3GHz to 4cores @3.5GHz.&#160; Seems like they could be pretty close aggregate, but your single thread performance is going to take a hit.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451592">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451597" class="blockpost roweven"> <h2><span><span class="conr">#2593</span> <a href="viewtopic.php?pid=1451597#p1451597">2014-08-29 15:19:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83719">josipva</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83719">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It&#039;s a cpu with unlocked multiplier and i plan to overclock it to atleast 4.0Ghz (early leaks indicate it&#039;s a pretty good chip for oc). Seems to me like a good target for dual VM without going for full on expensive 1k$ chip, thats why im asking for opinions <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by josipva (2014-08-29 15:20:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451597">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451601" class="blockpost rowodd"> <h2><span><span class="conr">#2594</span> <a href="viewtopic.php?pid=1451601#p1451601">2014-08-29 15:24:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>josipva wrote:</cite><blockquote><div><p>It&#039;s a cpu with unlocked multiplier and i plan to overclock it to atleast 4.0Ghz (early leaks indicate it&#039;s a pretty good chip for oc). Seems to me like a good target for dual VM without going for full on expensive 1k$ chip, thats why im asking for opinions <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>If you can get there and have it stable then it could be a good option (/me makes note to ignore any spectacularly weird bugs from josipva).&#160; Just be aware that there are many K-series processors that do not support VT-d.&#160; For a while they seemed to be mutually exclusive.&#160; Hopefully it will appear in ark soon.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451601">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451602" class="blockpost roweven"> <h2><span><span class="conr">#2595</span> <a href="viewtopic.php?pid=1451602#p1451602">2014-08-29 15:27:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83719">josipva</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-21</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83719">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well they added Vt-d support for both i5 and i7 in Devil&#039;s canyon release so i doubt it won&#039;t be supported in these new Haswell-E cpus. Anyway 4.0Ghz in Haswell is easy to get stable.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>(/me makes note to ignore any spectacularly weird bugs from josipva)</p></div></blockquote></div><p><img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p> <p class="postedit"><em>Last edited by josipva (2014-08-29 15:30:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451602">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451809" class="blockpost rowodd"> <h2><span><span class="conr">#2596</span> <a href="viewtopic.php?pid=1451809#p1451809">2014-08-30 09:16:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi all, first post here <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> .<br />I&#039;m getting some problems setting up a VM with Windows 7 and a GeForce GTX 650 passed through.</p><p>Software setup:<br />- Debian 7 (headless pc, managed through ssh)<br />- kernel 3.16.1 + ACS patch + i915 arbitrer patch + VGA arbitrer patch<br />- boot parameters &quot;i915.enable_hd_vgaarb=1 intel_iommu=on pci-stub.ids=10de:0fc6,10de:0e1b&quot;<br />- qemu 2.1<br />- seabios 1.7.5</p><p>Hardware setup:<br />- MSI Z77A-G43<br />- Intel i5-3470<br />- IGD as primary VGA (for host)<br />- nVidia GeForce GTX 650 as secondary VGA (for guest)</p><p>Steps I followed:<br />- enabled VT-d in motherboard<br />- installed Windows 7 through VNC using &quot;-vga std&quot; (keeping GTX 650 as secondary graphics card in guest)<br />- installed tightVNC inside Windows 7<br />- installed nVidia graphics driver (version 335.23)<br />- booted Windows 7 with &quot;-vga none&quot;<br />- black screen and cannot connect to VNC server inside Windows 7 (without any error from qemu)</p><p>Script used to start VM:</p><div class="codebox"><pre><code># Bind VGA DEVICES=&quot;0000:01:00.0 0000:01:00.1&quot; for dev in $DEVICES ; do vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id done # Start QEMU qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -bios /usr/share/qemu/bios-256k.bin -vga none \ -rtc base=localtime \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,rombar=0,romfile=/root/gtx650_bios.rom \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -drive file=/dev/sdc,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -boot menu=on \ -netdev tap,ifname=qemu0,id=qemu_tap -device e1000,netdev=qemu_tap,mac=00:16:3E:12:34:56 \ -usb -usbdevice tablet</code></pre></div><br /><p>If you need more info, just ask.<br />Thanks in advance.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451809">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451835" class="blockpost roweven"> <h2><span><span class="conr">#2597</span> <a href="viewtopic.php?pid=1451835#p1451835">2014-08-30 10:49:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>u don&#039;t need rombar and romfile...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451835">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451845" class="blockpost rowodd"> <h2><span><span class="conr">#2598</span> <a href="viewtopic.php?pid=1451845#p1451845">2014-08-30 11:24:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I need them as without these two options I was getting some errors about VGA initialization (or something like that).<br />Adding &quot;rombar&quot; and &quot;romfile&quot; the errors disappeared.</p><p>PS: obviously the file passed to &quot;romfile&quot; is the actual rom dumped from my nVidia card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451845">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451898" class="blockpost roweven"> <h2><span><span class="conr">#2599</span> <a href="viewtopic.php?pid=1451898#p1451898">2014-08-30 13:04:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84278">Wimma77</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-12</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84278">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This means you are not running a new enough QEMU.&#160; You need at least 2.1 for the kvm=off property.</p></div></blockquote></div><p>Ok, so got from git qemu 2.1.50, but when I then try to run my vm I just get a &#039;QEMU 2.1.50 monitor&#039; prompt?<br />Even added full path /usr/local/bin/qemu... to make sure was using.<br />And then I still get the same KVM internal error. Suberror: 1 emulation failure after a short time :\<br />May have to put the card in another machine to confirm all is working ok for a start (used card I just picked up). Or just stick with ATI cards..</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451898">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1451904" class="blockpost rowodd"> <h2><span><span class="conr">#2600</span> <a href="viewtopic.php?pid=1451904#p1451904">2014-08-30 13:29:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>I need them as without these two options I was getting some errors about VGA initialization (or something like that).<br />Adding &quot;rombar&quot; and &quot;romfile&quot; the errors disappeared.</p></div></blockquote></div><p>Those errors are what we need to debug.&#160; rombar=0 tells QEMU to not expose a PCI option ROM for the device.&#160; Following that with romfile= makes QEMU put that rom in the genroms section, which is sort of like having it builtin to the BIOS.&#160; The problem with that is that it is no longer associated with the device, so unless you know ROM has the ability to scan through all the devices to find the hardware, you&#039;ve probably just broken the option ROM execution.</p><p>Remove the rombar option and report the error, if there is one.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1451904">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=103">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=102">102</a> <a href="viewtopic.php?id=162768&amp;p=103">103</a> <strong>104</strong> <a href="viewtopic.php?id=162768&amp;p=105">105</a> <a href="viewtopic.php?id=162768&amp;p=106">106</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=105">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
