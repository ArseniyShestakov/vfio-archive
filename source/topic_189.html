<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 189) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=189" title="Page 189" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=188" title="Page 188" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=190" title="Page 190" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=188">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <strong>189</strong> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=190">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1516569" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4701</span> <a href="viewtopic.php?pid=1516569#p1516569">2015-04-03 12:54:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>marcosonoio wrote:</cite><blockquote><div><p>Hi, <br />thanks to all for this useful topic.<br />in these days i&#039;m trying to have a working VM with windows 8.1, but i have some problems.<br />with this config i can install windows, boot up and use windows, but when i try to install nvidia driver (340.52), i received a BSOD (with a video driver&#039;s error):</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 2048 -cpu host,kvm=off -smp 4 \ -drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \ -drive if=pflash,format=raw,file=/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd \ -device vfio-pci,host=01:00.0,romfile=/home/marco/image.rom,multifunction=on \ -device vfio-pci,host=01:00.1 \ ..snip.. -vga none</code></pre></div><p>so i want to try with the q25 chipset, i can&#039;t boot up windows, but i can install the system with the &quot;-vga std&quot; option:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 2048 -cpu host,kvm=off -smp 4 -M q35 \ -drive if=pflash,format=raw,readonly,file=/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd \ -drive if=pflash,format=raw,file=/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,romfile=/home/marco/image.rom,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ ..snip.. -vga none</code></pre></div><p>when i start the VM i find this in the dmesg output(always):</p><div class="codebox"><pre><code>[ 47.485338] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb000 flags=0x0010] [ 47.485345] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb3c0 flags=0x0010] ..snip.. [ 47.485367] AMD-Vi: Event logged [IO_PAGE_FAULT device=01:00.0 domain=0x0022 address=0x000000007efcb200 flags=0x0010]</code></pre></div><p>my system:</p><div class="codebox"><pre><code>amd a10 7850k gigabyte GA-F2A88XN-WIFI 2x4gb ddr3 ssd 128gb 840pro nvidia gtx 750 ti updated fedora 21 + libvirt preview repo</code></pre></div><p>i want to install the 340.52 to not have problem with the hyperv(nvidia related).<br />what&#039;s wrong?</p><p>thanks you</p></div></blockquote></div><p>First hint where to look:<br />Your CPU has bugs in IOMMU, they&#039;re listed <a href="http://amd-dev.wpengine.netdna-cdn.com/wordpress/media/2012/10/48931_15h_Mod_10h-1Fh_Rev_Guide.pdf" rel="nofollow">there</a> if i recall your CPU family number right.<br />That, i believe(haven&#039;t red IOMMU architectural guide yet), yelds those IO_PAGE_FAULT errors.<br />Also, seems like you&#039;re using your integrated card as the host gpu, there may be problems with that, but there&#039;s none i&#039;ve heard of.<br />And you shouldn&#039;t absolutely need x-vga option when using OVMF, as stated <a href="https://awilliam.github.io/presentations/KVM-Forum-2014/#/3/3" rel="nofollow">in aw&#039;s presentation</a>.<br />Try disabling x-vga.</p><p>The -vga std option just connects a virtual, emulated graphics card, making your GPU secondary <span class="bbu">in windows</span> but not in OVMF setup menus.</p><p>EDIT:<br />Forgot to add a reassuring note: i have amd athlon x4 750k, which is based on a similar architecture as yours(and opteron 6300 series too), and asus F2A55 motherboard, and it works with OVMF only.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-03 14:22:05)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516569">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516599" class="blockpost roweven"> <h2><span><span class="conr">#4702</span> <a href="viewtopic.php?pid=1516599#p1516599">2015-04-03 14:55:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84341">larrabee</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-14</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84341">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello. I have troubles with vfio.<br />I have:<br />Motherboard ASRock Z87 Extreme4<br />CPU Intel core i7 4771<br />video AMD 6450<br />video IGD<br />SAS adapter Adaptec 7805h<br />OS: Arch<br />kernel: stock&#160; (3.19.2-1)<br />I connect video to vfio and power up VM, but gave error «vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.»</p><p>lspci output:</p><div class="codebox"><pre><code>00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 00:01.1 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x8 Controller (rev 06) 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller (rev 06) 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 04) 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04) 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-V (rev 04) 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 04) 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 04) 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d4) 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d4) 00:1c.6 PCI bridge: Intel Corporation 82801 PCI Bridge (rev d4) 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 04) 00:1f.0 ISA bridge: Intel Corporation Z87 Express LPC Controller (rev 04) 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 04) 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 04) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Caicos [Radeon HD 6450/7450/8450 / R5 230 OEM] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Caicos HDMI Audio [Radeon HD 6400 Series] 02:00.0 Serial Attached SCSI controller: Adaptec PMC-Sierra PM8018 SAS HBA [Series 7H] (rev 06) 04:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03) 05:00.0 PCI bridge: ASMedia Technology Inc. ASM1083/1085 PCIe to PCI Bridge (rev 03)</code></pre></div><p>lspci -n output:</p><div class="codebox"><pre><code>00:00.0 0600: 8086:0c00 (rev 06) 00:01.0 0604: 8086:0c01 (rev 06) 00:01.1 0604: 8086:0c05 (rev 06) 00:02.0 0300: 8086:0412 (rev 06) 00:03.0 0403: 8086:0c0c (rev 06) 00:14.0 0c03: 8086:8c31 (rev 04) 00:16.0 0780: 8086:8c3a (rev 04) 00:19.0 0200: 8086:153b (rev 04) 00:1a.0 0c03: 8086:8c2d (rev 04) 00:1b.0 0403: 8086:8c20 (rev 04) 00:1c.0 0604: 8086:8c10 (rev d4) 00:1c.3 0604: 8086:8c16 (rev d4) 00:1c.6 0604: 8086:244e (rev d4) 00:1d.0 0c03: 8086:8c26 (rev 04) 00:1f.0 0601: 8086:8c44 (rev 04) 00:1f.2 0106: 8086:8c02 (rev 04) 00:1f.3 0c05: 8086:8c22 (rev 04) 01:00.0 0300: 1002:6779 01:00.1 0403: 1002:aa98 02:00.0 0107: 9005:8088 (rev 06) 04:00.0 0200: 8086:1539 (rev 03) 05:00.0 0604: 1b21:1080 (rev 03)</code></pre></div><p>cmdline:</p><div class="codebox"><pre><code>initrd=\intel-ucode.img initrd=\initramfs-linux.img root=/dev/sda2 rw intel_iommu=on iommu=on elevator=noop pci-stub.ids=1002:6779,1002:aa98</code></pre></div><p>ll /sys/bus/pci/devices/*/iommu_group:</p><div class="codebox"><pre><code>lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:00.0/iommu_group -&gt; ../../../kernel/iommu_groups/0/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:01.0/iommu_group -&gt; ../../../kernel/iommu_groups/1/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:01.1/iommu_group -&gt; ../../../kernel/iommu_groups/1/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:02.0/iommu_group -&gt; ../../../kernel/iommu_groups/2/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:03.0/iommu_group -&gt; ../../../kernel/iommu_groups/3/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:14.0/iommu_group -&gt; ../../../kernel/iommu_groups/4/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:16.0/iommu_group -&gt; ../../../kernel/iommu_groups/5/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:19.0/iommu_group -&gt; ../../../kernel/iommu_groups/6/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1a.0/iommu_group -&gt; ../../../kernel/iommu_groups/7/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1b.0/iommu_group -&gt; ../../../kernel/iommu_groups/8/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1c.0/iommu_group -&gt; ../../../kernel/iommu_groups/9/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1c.3/iommu_group -&gt; ../../../kernel/iommu_groups/10/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1c.6/iommu_group -&gt; ../../../kernel/iommu_groups/11/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1d.0/iommu_group -&gt; ../../../kernel/iommu_groups/12/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1f.0/iommu_group -&gt; ../../../kernel/iommu_groups/13/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1f.2/iommu_group -&gt; ../../../kernel/iommu_groups/13/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:00:1f.3/iommu_group -&gt; ../../../kernel/iommu_groups/13/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:01:00.0/iommu_group -&gt; ../../../../kernel/iommu_groups/1/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:01:00.1/iommu_group -&gt; ../../../../kernel/iommu_groups/1/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:02:00.0/iommu_group -&gt; ../../../../kernel/iommu_groups/1/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:04:00.0/iommu_group -&gt; ../../../../kernel/iommu_groups/14/ lrwxrwxrwx 1 root root 0 апр 3 10:57 /sys/bus/pci/devices/0000:05:00.0/iommu_group -&gt; ../../../../kernel/iommu_groups/11/</code></pre></div><p>Video card and SAS adapter in same iommu group (1)</p><p>I try:<br />Use kernel with ACS override patch<br />Use option vfio_iommu_type1 allow_unsafe_interrupts=1<br />It doesnot help.</p><p>How i can fix this error, please help. Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516599">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516611" class="blockpost rowodd"> <h2><span><span class="conr">#4703</span> <a href="viewtopic.php?pid=1516611#p1516611">2015-04-03 15:35:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>larrabee wrote:</cite><blockquote><div><p>Hello. I have troubles with vfio.<br />I have:<br />Motherboard ASRock Z87 Extreme4<br />CPU Intel core i7 4771<br />video AMD 6450<br />video IGD<br />SAS adapter Adaptec 7805h<br />OS: Arch<br />kernel: stock&#160; (3.19.2-1)<br />I connect video to vfio and power up VM, but gave error «vfio: error, group 1 is not viable, please ensure all devices within the iommu_group are bound to their vfio bus driver.»</p><p>..snip..<br />Video card and SAS adapter in same iommu group (1)</p><p>I try:<br />Use kernel with ACS override patch<br />Use option vfio_iommu_type1 allow_unsafe_interrupts=1<br />It doesnot help.</p><p>How i can fix this error, please help. Thank you.</p></div></blockquote></div><p>You sure you enabled your acs override mode? There&#039;s a kernel command line parameter for that:</p><div class="codebox"><pre><code>+ pcie_acs_override = + [PCIE] Override missing PCIe ACS support for: + downstream + All downstream ports - full ACS capabilties + multifunction + All multifunction devices - multifunction ACS subset + id:nnnn:nnnn + Specfic device - full ACS capabilities + Specified as vid:did (vendor/device ID) in hex</code></pre></div><p>And are you sure you need that &quot;allow_unsafe_interrupts=1&quot;?<br /><a href="http://vfio.blogspot.ru/2014/08/vfiovga-faq.html" rel="nofollow">Did you read aw&#039;s blog post about it?</a>(question 8)</p> <p class="postedit"><em>Last edited by Duelist (2015-04-03 15:36:11)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516611">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516644" class="blockpost roweven"> <h2><span><span class="conr">#4704</span> <a href="viewtopic.php?pid=1516644#p1516644">2015-04-03 17:53:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi together,</p><p>I managed to create an OVMF Windows 7 VM. After patching and installing drivers I have two problems left.<br />1: Starting the VM isn&#039;t very reliable. Right after the &quot;Windows is starting&quot; screen it can happen that the VM turns off. Qemu just displays a message that the index moved from 0 to &lt;higher number&gt;. After some attempts the VM starts.<br />2: It appears that I can passthrough my three devices (USB 3.0 controller, graphics adapter, sound card) only the first time I start the VM. When the VM turns off as described in [1] the devices are missing in the VM. The VM is still accessible via RDP, but in the device manager the devices aren&#039;t listed. </p><p>Is this related to the OVMF Setup? Do I need to release the devices in vfio explicitly?</p><p>Thanks in advance!</p><div class="codebox"><pre class="vscroll"><code>taskset 0x0000003F \ qemu-system-x86_64 \ -nodefaults \ -name win7uefi \ -enable-kvm \ -machine type=pc,accel=kvm \ -cpu host,kvm=off \ -smp 6,sockets=1,cores=3,threads=2 \ -m 4096 \ -mem-path /dev/hugepages \ -mem-prealloc \ -balloon none \ -k de \ -drive if=pflash,format=raw,readonly,file=ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=ovmf_vars_x64.bin \ -drive if=none,file=/dev/sdb3,id=vdisk1,cache=none,format=raw,aio=native \ -device virtio-blk-pci,scsi=off,config-wce=off,drive=vdisk1,id=disk1,x-data-plane=on \ -drive if=none,file=/dev/sdb7,id=vdisk2,cache=none,format=raw,aio=native \ -device virtio-blk-pci,scsi=off,config-wce=off,drive=vdisk2,id=disk2,x-data-plane=on \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -device vfio-pci,host=03:00.0 \ -device vfio-pci,host=07:00.0 \ -net nic,macaddr=52:54:00:12:34:57,model=virtio -net bridge,br=kvmbr0 \ -spice port=5930,disable-ticketing \ -device virtio-serial-pci \ -device virtserialport,chardev=spicechannel0,name=com.redhat.spice.0 \ -chardev spicevmc,id=spicechannel0,name=vdagent \ -rtc base=utc \ -monitor unix:user.sock,server,nowait \ -daemonize</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516644">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516647" class="blockpost rowodd"> <h2><span><span class="conr">#4705</span> <a href="viewtopic.php?pid=1516647#p1516647">2015-04-03 18:06:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi together,</p><p>I managed to create an OVMF Windows 7 VM. After patching and installing drivers I have two problems left.<br />1: Starting the VM isn&#039;t very reliable. Right after the &quot;Windows is starting&quot; screen it can happen that the VM turns off. Qemu just displays a message that the index moved from 0 to &lt;higher number&gt;. After some attempts the VM starts.<br />2: It appears that I can passthrough my three devices (USB 3.0 controller, graphics adapter, sound card) only the first time I start the VM. When the VM turns off as described in [1] the devices are missing in the VM. The VM is still accessible via RDP, but in the device manager the devices aren&#039;t listed. </p><p>Is this related to the OVMF Setup? Do I need to release the devices in vfio explicitly?</p><p>Thanks in advance!</p><div class="codebox"><pre class="vscroll"><code>taskset 0x0000003F \ qemu-system-x86_64 \ -nodefaults \ -name win7uefi \ -enable-kvm \ -machine type=pc,accel=kvm \ -cpu host,kvm=off \ -smp 6,sockets=1,cores=3,threads=2 \ -m 4096 \ -mem-path /dev/hugepages \ -mem-prealloc \ -balloon none \ -k de \ -drive if=pflash,format=raw,readonly,file=ovmf_code_x64.bin \ -drive if=pflash,format=raw,file=ovmf_vars_x64.bin \ -drive if=none,file=/dev/sdb3,id=vdisk1,cache=none,format=raw,aio=native \ -device virtio-blk-pci,scsi=off,config-wce=off,drive=vdisk1,id=disk1,x-data-plane=on \ -drive if=none,file=/dev/sdb7,id=vdisk2,cache=none,format=raw,aio=native \ -device virtio-blk-pci,scsi=off,config-wce=off,drive=vdisk2,id=disk2,x-data-plane=on \ -device vfio-pci,host=01:00.0 \ -device vfio-pci,host=01:00.1 \ -device vfio-pci,host=03:00.0 \ -device vfio-pci,host=07:00.0 \ -net nic,macaddr=52:54:00:12:34:57,model=virtio -net bridge,br=kvmbr0 \ -spice port=5930,disable-ticketing \ -device virtio-serial-pci \ -device virtserialport,chardev=spicechannel0,name=com.redhat.spice.0 \ -chardev spicevmc,id=spicechannel0,name=vdagent \ -rtc base=utc \ -monitor unix:user.sock,server,nowait \ -daemonize</code></pre></div></div></blockquote></div><p>Errr, did you use -device qxl-vga as stated in <a href="http://www.linux-kvm.org/downloads/lersek/ovmf-whitepaper-c770f8c.txt" rel="nofollow">OVMF whitepaper</a> for installing the drivers stage?</p><p>I&#039;m currently using libvirt, my VM starts, showing me &quot;starting windowns&quot; screen on QXL graphics in a window on host, then, <span class="bbu">after some black screen time</span>, it fires up the main GPUs and they start outputting the video signal to the screen properly.</p><p>And what do you mean &quot;patching the drivers&quot;?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516647">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516648" class="blockpost roweven"> <h2><span><span class="conr">#4706</span> <a href="viewtopic.php?pid=1516648#p1516648">2015-04-03 18:19:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes I needed qxl-vga during the setup. But after I installed the nvidia drivers I removed this device. This is working so far. The last thing I added to the startup script was adding the second disk partition. I removed that one and now I got a fine startup with all devices working well. Is something wrong with that parameter, maybe bus related?<br />Anyway I do not know if this is a oneshot or if that &quot;guest moved index from 0 to ...&quot; issue still persists.</p><p>EDIT: I meant patching windows (updating) and installing device drivers.</p><p>EDIT2: Sorry, I had a Seabios VM before and thus I might got something wrong. I was sure that removing the qxl-vga was intended after the drivers of the dedicated graphics device are installed. But I think what you wanted to tell me, that they always better should be present in the VM. Right?</p> <p class="postedit"><em>Last edited by apex8 (2015-04-03 18:45:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516648">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516654" class="blockpost rowodd"> <h2><span><span class="conr">#4707</span> <a href="viewtopic.php?pid=1516654#p1516654">2015-04-03 18:51:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Yes I needed qxl-vga during the setup. But after I installed the nvidia drivers I removed this device. This is working so far. The last thing I added to the startup script was adding the second disk partition. I removed that one and now I got a fine startup with all devices working well. Is something wrong with that parameter, maybe bus related?<br />Anyway I do not know if this is a oneshot or if that &quot;guest moved index from 0 to ...&quot; issue still persists.</p><p>EDIT: I meant patching windows (updating) and installing device drivers.</p><p>EDIT2: Sorry, I had a Seabios VM before and thus I might got something wrong. I was sure that removing the qxl-vga was intended after the drivers of the dedicated graphics device are installed. But I think what you wanted to tell me, that they always better should be present in the VM. Right?</p></div></blockquote></div><p>Well, even if nothing works, qxl-vga still works. Windows turns off QXL for me. For some reason, i couldn&#039;t make my VM output &quot;starting windows&quot; message on the main GPU, it works only on qxl-vga. I don&#039;t know why, but let it be. Well, it&#039;s intended to remove the QXL.</p><p>Try adding -device virtio-blk-pci for the second partition and see if that makes it work. Seems like i&#039;m unable help you anymore.</p> <p class="postedit"><em>Last edited by Duelist (2015-04-03 18:51:13)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516654">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516895" class="blockpost roweven"> <h2><span><span class="conr">#4708</span> <a href="viewtopic.php?pid=1516895#p1516895">2015-04-04 12:17:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is it normal for windows guests, that the red hat QXL graphics device is reported with code 43 in the device manager? However the dedicated nvidia device is working normally.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516895">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516913" class="blockpost rowodd"> <h2><span><span class="conr">#4709</span> <a href="viewtopic.php?pid=1516913#p1516913">2015-04-04 13:24:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Is it normal for windows guests, that the red hat QXL graphics device is reported with code 43 in the device manager? However the dedicated nvidia device is working normally.</p></div></blockquote></div><p>It&#039;s strange, but totally fine.<br />Actually, you can just disconnect it totally.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516913">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516937" class="blockpost roweven"> <h2><span><span class="conr">#4710</span> <a href="viewtopic.php?pid=1516937#p1516937">2015-04-04 14:42:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>darkstego wrote:</cite><blockquote><div><p>Hey guys,</p><p>I was able to get Windows 8.1 running with VFIO and OVMF, but I have an odd issue.</p><p>After the windows install, OVMF will not boot windows if I remove the drive with the install media</p><p>Here is my running script.</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -L $HOME/Desktop/ovmf -bios bios.bin \ ... -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install \ -drive file=/dev/sdb,id=disk_primary,format=raw,if=none -device scsi-hd,drive=disk_primary \ ...</code></pre></div><p>The trouble is if I omit the </p><div class="codebox"><pre><code> -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install </code></pre></div><p> line or move it after the disk drive the EFI will not find anything to boot.</p></div></blockquote></div><p>Please stop using -L and -bios. Refer to the wiki or the example in the whitepaper wrt. the pflash drives instead.</p><p>Please capture the debug output with &quot;-debugcon file:debug.log -global isa-debugcon.iobase=0x402&quot;; if there&#039;s a problem with processing QEMU&#039;s &quot;bootorder&quot; fw_cfg file, the debug log should help us understand it.</p><p>Also, how recent is your OVMF build?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516937">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516938" class="blockpost rowodd"> <h2><span><span class="conr">#4711</span> <a href="viewtopic.php?pid=1516938#p1516938">2015-04-04 14:46:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Naruni wrote:</cite><blockquote><div><p>Any idea why this command:</p><div class="codebox"><pre><code>virt-install --name=win7 --os-type=windows --disk path=/dev/mapper/VMssd-win7 --cdrom=/vm/win7x64.iso --graphics spice --ram=2048 --boot loader_type=pflash,loader_ro=yes,loader=/usr/share/edk2.git/ovmf-x64/OVMF-pure-efi.fd,nvram_template=/vm/win7_VARS-pure-efi.fd</code></pre></div><p>Results in this:</p><div class="codebox"><pre><code>ERROR Unknown options [&#039;loader_ro&#039;, &#039;nvram_template&#039;, &#039;loader_type&#039;]</code></pre></div></div></blockquote></div><p>Your virt-manager (or virt-install) package (or build) is too old.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516938">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516942" class="blockpost roweven"> <h2><span><span class="conr">#4712</span> <a href="viewtopic.php?pid=1516942#p1516942">2015-04-04 14:57:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@erganzi</p><p>-boot menu=on[,splash-time=$timeout_ms]&#160; ?</p></div></blockquote></div><p>Try:<br />-boot menu=on,splash-time=20000</p><p>It still display nothing, just black screen, then turned into windows startup.</p></div></blockquote></div><p>Please describe the symptoms in more detail: command line or domain XML, OVMF debug log (see capture notes above), what displays are configured, which one is the display that you see stuff on, etc.</p><p>Also, I doubt qemu 2.1.3 is recent enough (Alex will know better); as far as I remember, for my Nvidia GTX750 it was too old. I needed commit fe08275d, which implies 2.2.</p><p>Other than that, OVMF indeed supports &#039;-boot menu=on[,splash-time=$timeout_ms]&#039;. The behavior is not identical to that of SeaBIOS (as the qemu manual explains, these options have firmware-specific behavior), but it should be a close approximation. See <a href="https://github.com/tianocore/edk2/commit/9253c14d" rel="nofollow">https://github.com/tianocore/edk2/commit/9253c14d</a> and its surrounding commits.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516942">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516947" class="blockpost rowodd"> <h2><span><span class="conr">#4713</span> <a href="viewtopic.php?pid=1516947#p1516947">2015-04-04 15:12:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84341">larrabee</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-14</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84341">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>You sure you enabled your acs override mode? There&#039;s a kernel command line parameter for that:<br />...<br />And are you sure you need that &quot;allow_unsafe_interrupts=1&quot;?<br />Did you read aw&#039;s blog post about it?(question 8)</p></div></blockquote></div><p>Duelist, thank you.<br />Option pcie_acs_override=downstream resolve it. Now SAS and video card in different groups.<br />Thank you.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516947">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516948" class="blockpost roweven"> <h2><span><span class="conr">#4714</span> <a href="viewtopic.php?pid=1516948#p1516948">2015-04-04 15:14:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi together,</p><p>I managed to create an OVMF Windows 7 VM. After patching and installing drivers I have two problems left.<br />1: Starting the VM isn&#039;t very reliable. Right after the &quot;Windows is starting&quot; screen it can happen that the VM turns off. Qemu just displays a message that the index moved from 0 to &lt;higher number&gt;. After some attempts the VM starts.</p></div></blockquote></div><p>This should &quot;never happen&quot;, bar guest bugs. The QEMU error message reports a guest bug in the virtio communication. I&#039;ve encountered the error message once (it was related to an obscure virtio-scsi bug in SeaBIOS), but you really shouldn&#039;t be seeing it.</p><p>... Any particular reason for using virtio-blk with dataplane enabled?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516948">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516950" class="blockpost rowodd"> <h2><span><span class="conr">#4715</span> <a href="viewtopic.php?pid=1516950#p1516950">2015-04-04 15:25:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>i couldn&#039;t make my VM output &quot;starting windows&quot; message on the main GPU</p></div></blockquote></div><p>If you mean the colorful animation: I think that&#039;s presented by the windows 7 / windows server 2008 r2 boot loader, which is a UEFI application (or else, it could be early runtime OS code too, but it certainly inherits the video framebuffer from one of the GOPs (graphics output protocols) installed before ExitBootServices()).</p><p>It looks like this animation code only uses the first GOP that it finds. The order in which it finds GOPs is unspecified. You could experiment with replacing the guest-visible PCI addresses that are assigned to QXL and to the passthru card with each other on the qemu command line. That might invert the order in which these devices are enumerated in the firmware, and consequently the order in which their respective drivers install their GOPs.</p><p>I never tried this -- as you say there&#039;s some &quot;blank screen time&quot; to endure on the passthru display, but it isn&#039;t overly annoying.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516950">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516963" class="blockpost roweven"> <h2><span><span class="conr">#4716</span> <a href="viewtopic.php?pid=1516963#p1516963">2015-04-04 16:19:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>i couldn&#039;t make my VM output &quot;starting windows&quot; message on the main GPU</p></div></blockquote></div><p>If you mean the colorful animation: I think that&#039;s presented by the windows 7 / windows server 2008 r2 boot loader, which is a UEFI application (or else, it could be early runtime OS code too, but it certainly inherits the video framebuffer from one of the GOPs (graphics output protocols) installed before ExitBootServices()).</p><p>It looks like this animation code only uses the first GOP that it finds. The order in which it finds GOPs is unspecified. You could experiment with replacing the guest-visible PCI addresses that are assigned to QXL and to the passthru card with each other on the qemu command line. That might invert the order in which these devices are enumerated in the firmware, and consequently the order in which their respective drivers install their GOPs.</p><p>I never tried this -- as you say there&#039;s some &quot;blank screen time&quot; to endure on the passthru display, but it isn&#039;t overly annoying.</p></div></blockquote></div><p>Well, i kinda knew that it grabs the first GPU it finds. Nice idea of switching the addresses that way real GPUs would be presented first.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516963">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516983" class="blockpost rowodd"> <h2><span><span class="conr">#4717</span> <a href="viewtopic.php?pid=1516983#p1516983">2015-04-04 17:52:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi together,</p><p>I managed to create an OVMF Windows 7 VM. After patching and installing drivers I have two problems left.<br />1: Starting the VM isn&#039;t very reliable. Right after the &quot;Windows is starting&quot; screen it can happen that the VM turns off. Qemu just displays a message that the index moved from 0 to &lt;higher number&gt;. After some attempts the VM starts.</p></div></blockquote></div><p>This should &quot;never happen&quot;, bar guest bugs. The QEMU error message reports a guest bug in the virtio communication. I&#039;ve encountered the error message once (it was related to an obscure virtio-scsi bug in SeaBIOS), but you really shouldn&#039;t be seeing it.</p><p>... Any particular reason for using virtio-blk with dataplane enabled?</p></div></blockquote></div><p>Yes, I use it because it is recommended for best IO performance and I havn&#039;t had any problems when I was using a seabios VM. If dataplane would be the cause of this problem in the OVMF VM, how much would performance decrease if I switch it off?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516983">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1516997" class="blockpost roweven"> <h2><span><span class="conr">#4718</span> <a href="viewtopic.php?pid=1516997#p1516997">2015-04-04 19:24:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89552">lersek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-15</span></dd> <dd><span>Posts: 34</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89552">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Hi together,</p><p>I managed to create an OVMF Windows 7 VM. After patching and installing drivers I have two problems left.<br />1: Starting the VM isn&#039;t very reliable. Right after the &quot;Windows is starting&quot; screen it can happen that the VM turns off. Qemu just displays a message that the index moved from 0 to &lt;higher number&gt;. After some attempts the VM starts.</p></div></blockquote></div><p>This should &quot;never happen&quot;, bar guest bugs. The QEMU error message reports a guest bug in the virtio communication. I&#039;ve encountered the error message once (it was related to an obscure virtio-scsi bug in SeaBIOS), but you really shouldn&#039;t be seeing it.</p><p>... Any particular reason for using virtio-blk with dataplane enabled?</p></div></blockquote></div><p>Yes, I use it because it is recommended for best IO performance and I havn&#039;t had any problems when I was using a seabios VM. If dataplane would be the cause of this problem in the OVMF VM, how much would performance decrease if I switch it off?</p></div></blockquote></div><p>I have no reason to imply that dataplane was the &quot;culprit&quot; (or just &quot;trigger&quot;) here; I only raised it because it was the only &quot;unusual&quot; option to my eye, and because I vaguely recall the dataplane code having/being a separate &quot;virtio server&quot; implementation. (But, this may not be true any longer, and it may not have been true ever.)</p><p>I never used dataplane myself (and I certainly never tried to test it with any remotely &quot;scientific&quot; method), so I can&#039;t give you numbers, unfortunately.</p><p>Anyway it shouldn&#039;t be hard to test your setup with dataplane off.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1516997">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517314" class="blockpost rowodd"> <h2><span><span class="conr">#4719</span> <a href="viewtopic.php?pid=1517314#p1517314">2015-04-05 22:21:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76557">logix</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-04</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ken@logic.fm">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Need some help. I have read most of the thread; however, cannot shake this.</p><p>The error: <strong>vfio: error no iommu_group for device</strong></p><div class="codebox"><pre><code># qemu-system-x86_64 -enable-kvm -m 1024 -cpu host,kvm=off -smp 4,sockets=1,cores=4,threads=1 -device vfio-pci,host=02:00.0,x-vga=on -device vfio-pci,host=02:00.1 -vga none qemu-system-x86_64: -device vfio-pci,host=02:00.0,x-vga=on: vfio: error no iommu_group for device # dmesg | grep probe [ 478.084005] vfio-pci: probe of 0000:02:00.0 failed with error -22</code></pre></div><p>1. VT-d is supported and enabled in my bios [ASUS P9x79 LE (bios 4801/4701) i7-3930k (C2 stepping)].<br />2. Intel io_mmu is enabled.<br />3. pci-stub has blocked nouveau from taking control of the card<br />4. I am using pcie_acs_override=downstream</p><div class="codebox"><pre><code># dmesg | grep -e DMAR -e IOMMU [ 0.000000] Intel-IOMMU: enabled [ 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA</code></pre></div><div class="codebox"><pre><code>#dmesg | grep pci-stub [ 0.700460] pci-stub 0000:02:00.0: claimed by stub [ 0.700501] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><div class="codebox"><pre><code># dmesg | grep -i DMAR #</code></pre></div><p>Using the linux-vfio kernel out of the AUR: BOOT_IMAGE=/boot/vmlinuz-linux-vfio<br />I believe my kernel boot flags are correct:</p><div class="codebox"><pre><code>intel_iommu=on pcie_acs_override=downstream pci-stub.ids=10de:1184,10de:0e0a emulate_invalid_guest_state=0</code></pre></div><p>I have checked the following modules have loaded:</p><div class="codebox"><pre><code># cat /etc/modules-load.d/vga-passthrough.conf pci_stub vfio vfio_iommu_type1 vfio_pci kvm kvm-intel</code></pre></div><p>I am not using the i915 pach because I do not have Intel graphics. I am using a GTX 560ti as primary, trying to pass through a GTX 770.</p><p> I have read through most of the thread and tons of pages on the internet, and almost everyone who has seen this problem either 1) cpu/MB did not support vt-d or 2) forgot to enable it in bios or via kernel option. I have tried many, many variations of fixes; however, nothing.</p><p>What am I missing here?</p> <p class="postedit"><em>Last edited by logix (2015-04-05 22:52:38)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517314">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517323" class="blockpost roweven"> <h2><span><span class="conr">#4720</span> <a href="viewtopic.php?pid=1517323#p1517323">2015-04-05 23:15:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@logix</p><p>The IOMMU is not enabled, your first grep should produce lots more output.&#160; Does /sys/firmware/acpi/tables/DMAR exist on your system?&#160; A DMAR reference should have shown in the grep.&#160; Without a DMAR table, VT-d cannot be configured, which suggests a BIOS issue.</p><p>EDIT: I&#039;ve seen cases where a hard power cycle is required after enabling VT-d in the BIOS to make it actually take effect.</p> <p class="postedit"><em>Last edited by aw (2015-04-05 23:17:36)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517323">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517326" class="blockpost rowodd"> <h2><span><span class="conr">#4721</span> <a href="viewtopic.php?pid=1517326#p1517326">2015-04-05 23:25:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76557">logix</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-04</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:ken@logic.fm">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>@logix</p><p>The IOMMU is not enabled, your first grep should produce lots more output.&#160; Does /sys/firmware/acpi/tables/DMAR exist on your system?&#160; A DMAR reference should have shown in the grep.&#160; Without a DMAR table, VT-d cannot be configured, which suggests a BIOS issue.</p><p>EDIT: I&#039;ve seen cases where a hard power cycle is required after enabling VT-d in the BIOS to make it actually take effect.</p></div></blockquote></div><p>I do not have a DMAR reference</p><div class="codebox"><pre><code>$ sudo ls -al /sys/firmware/acpi/tables/DMAR ls: cannot access /sys/firmware/acpi/tables/DMAR: No such file or directory</code></pre></div><p>I had a feeling it was a problem with the firmware, and I guess that confirms it. I have hard-reset many times. In fact, disabling and enabling VT-d does a hard reset automatically. I will try downgrading the bios-- as there is a post with it working for old bios.</p><p>Thanks!</p><p>Edit: Tried 4 different bios dating from 1/2013 to most current. Cannot get DMAR tables to appear. Sad.</p> <p class="postedit"><em>Last edited by logix (2015-04-06 14:45:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517326">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517382" class="blockpost roweven"> <h2><span><span class="conr">#4722</span> <a href="viewtopic.php?pid=1517382#p1517382">2015-04-06 07:03:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><p>This should &quot;never happen&quot;, bar guest bugs. The QEMU error message reports a guest bug in the virtio communication. I&#039;ve encountered the error message once (it was related to an obscure virtio-scsi bug in SeaBIOS), but you really shouldn&#039;t be seeing it.</p><p>... Any particular reason for using virtio-blk with dataplane enabled?</p></div></blockquote></div><p>Yes, I use it because it is recommended for best IO performance and I havn&#039;t had any problems when I was using a seabios VM. If dataplane would be the cause of this problem in the OVMF VM, how much would performance decrease if I switch it off?</p></div></blockquote></div><p>I have no reason to imply that dataplane was the &quot;culprit&quot; (or just &quot;trigger&quot;) here; I only raised it because it was the only &quot;unusual&quot; option to my eye, and because I vaguely recall the dataplane code having/being a separate &quot;virtio server&quot; implementation. (But, this may not be true any longer, and it may not have been true ever.)</p><p>I never used dataplane myself (and I certainly never tried to test it with any remotely &quot;scientific&quot; method), so I can&#039;t give you numbers, unfortunately.</p><p>Anyway it shouldn&#039;t be hard to test your setup with dataplane off.</p></div></blockquote></div><p>I switched off x-data-plane...</p><div class="codebox"><pre><code>-drive if=none,file=/dev/sdb3,id=vdisk1,cache=none,format=raw,aio=native \ -device virtio-blk-pci,scsi=off,config-wce=off,drive=vdisk1,id=disk1,x-data-plane=off \</code></pre></div><p>...but the result was the same.</p><div class="codebox"><pre><code>qemu-system-x86_64: Guest moved used index from 14 to 0</code></pre></div><div class="codebox"><pre><code>dmesg [ 139.746997] device tap0 entered promiscuous mode [ 139.747123] kvmbr0: port 2(tap0) entered listening state [ 139.747131] kvmbr0: port 2(tap0) entered listening state [ 139.747490] qemu-system-x86: sending ioctl 5326 to a partition! [ 139.747523] qemu-system-x86: sending ioctl 80200204 to a partition! [ 140.179757] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 140.179889] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 140.181864] vfio-pci 0000:01:00.1: enabling device (0000 -&gt; 0002) [ 140.183020] vfio-pci 0000:03:00.0: enabling device (0100 -&gt; 0102) [ 144.698904] kvm: zapping shadow pages for mmio generation wraparound [ 153.360553] kvmbr0: port 2(tap0) entered disabled state [ 153.360595] device tap0 left promiscuous mode [ 153.360601] kvmbr0: port 2(tap0) entered disabled state</code></pre></div><p>Is it possible to gather some more data to find out whats happening in the background?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517382">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517456" class="blockpost rowodd"> <h2><span><span class="conr">#4723</span> <a href="viewtopic.php?pid=1517456#p1517456">2015-04-06 15:38:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="codebox"><pre><code>qemu-system-x86_64: Guest moved used index from 14 to 0</code></pre></div></div></blockquote></div><p>I don&#039;t think this is as unusual as Laszlo seems to think it is.&#160; I was seeing it roughly one in every three boots, but it doesn&#039;t seem like I can reproduce it anymore.&#160; I&#039;d try updating kernel and QEMU.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517456">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517457" class="blockpost roweven"> <h2><span><span class="conr">#4724</span> <a href="viewtopic.php?pid=1517457#p1517457">2015-04-06 15:42:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84454">darkstego</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-19</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=84454">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lersek wrote:</cite><blockquote><div><div class="quotebox"><cite>darkstego wrote:</cite><blockquote><div><p>Hey guys,</p><p>I was able to get Windows 8.1 running with VFIO and OVMF, but I have an odd issue.</p><p>After the windows install, OVMF will not boot windows if I remove the drive with the install media</p><p>Here is my running script.</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 \ -L $HOME/Desktop/ovmf -bios bios.bin \ ... -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install \ -drive file=/dev/sdb,id=disk_primary,format=raw,if=none -device scsi-hd,drive=disk_primary \ ...</code></pre></div><p>The trouble is if I omit the </p><div class="codebox"><pre><code> -drive file=$HOME/windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install </code></pre></div><p> line or move it after the disk drive the EFI will not find anything to boot.</p></div></blockquote></div><p>Please stop using -L and -bios. Refer to the wiki or the example in the whitepaper wrt. the pflash drives instead.</p><p>Please capture the debug output with &quot;-debugcon file:debug.log -global isa-debugcon.iobase=0x402&quot;; if there&#039;s a problem with processing QEMU&#039;s &quot;bootorder&quot; fw_cfg file, the debug log should help us understand it.</p><p>Also, how recent is your OVMF build?</p></div></blockquote></div><p>Thanks, </p><p>The reason I am using the -L and -bios options is it happened to be the only one I could get to work for the install. </p><p>I have now switched back to pflash and it seems the missing part was&#160; &quot;bootindex=0&quot; option added to the primary disk. </p><p>Everything works well now.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517457">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1517472" class="blockpost rowodd"> <h2><span><span class="conr">#4725</span> <a href="viewtopic.php?pid=1517472#p1517472">2015-04-06 17:03:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=57829">walkindude</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-04</span></dd> <dd><span>Posts: 27</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:lunarstrainut@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can&#039;t use keyboard before windows begins to load (after I can use it without problems), but I need it to press button to load from DVD.</p><p>Nevermind, with qemu (not -git) works ok</p> <p class="postedit"><em>Last edited by walkindude (2015-04-06 17:11:18)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1517472">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=188">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=187">187</a> <a href="viewtopic.php?id=162768&amp;p=188">188</a> <strong>189</strong> <a href="viewtopic.php?id=162768&amp;p=190">190</a> <a href="viewtopic.php?id=162768&amp;p=191">191</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=190">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
