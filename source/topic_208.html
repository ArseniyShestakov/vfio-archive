<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 208) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=208" title="Page 208" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=207" title="Page 207" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=209" title="Page 209" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=207">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=206">206</a> <a href="viewtopic.php?id=162768&amp;p=207">207</a> <strong>208</strong> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <a href="viewtopic.php?id=162768&amp;p=210">210</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=209">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1531698" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#5176</span> <a href="viewtopic.php?pid=1531698#p1531698">2015-05-24 23:01:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ghormoon:<br />And what about the video output? Switchable graphics always was a problem, even on windows machines.<br />Since you&#039;re having a separate(logitech G15) keyboard attached, i guess you have your video output routed via external display connector to the separate screen, and the notebook is actually... closed? Y&#039; trying to assemble something only from the available parts and the PC has a broken screen or something? Why you aren&#039;t doing this thing with a normal PC?..</p><p>If host will be headless - i&#039;d suggest you <span class="bbu">chopping the said head off before</span> doing anything with the VM.<br />Don&#039;t load the radeon. Don&#039;t start Kernel ModeSetting(KMS). Disable <span class="bbu">all</span> video output as we&#039;ll need VGA free from anything.<br />And drop all the unnecessary devices like the SD controller just for testing the GPU part. Then, after everything&#039;s set, you might attach all the other devices needed. Stuff like SD controllers may be not the separate device, but a part of something integrated, having their ROM and power controls hidden in depths of proprietary stuff and closed firmwares.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531698">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531712" class="blockpost roweven"> <h2><span><span class="conr">#5177</span> <a href="viewtopic.php?pid=1531712#p1531712">2015-05-24 23:25:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>as for video output, I use the internal display. the reason I&#039;m not doing this on desktop PC is that desktop PC is too heavy to carry daily in backpack <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />as for the HW, there is not any switchable graphics. the integrated one in the i7 cpu is not wired in at all. there&#039;s no way to turn off the radeon if you wanna have some output. not like the laptops which allow you to switch between igp and radeon.<br />as for the g15 usb keyboard - when I go headless, I can&#039;t use the internal one for input, since it&#039;s connected as ps/2 one.&#160; That&#039;s next level, which involves patching qemu. so that&#039;s the last one <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>I&#039;ll retry with blacklisted radeon, kms off, also tell grub not to change modes, let&#039;s see what it does.<br />current state is that linux VM can both show boot messages and actually work on the passed in GPU, windows goes black after showing logo. likely at the point where the radeon driver kicked in.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531712">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531717" class="blockpost rowodd"> <h2><span><span class="conr">#5178</span> <a href="viewtopic.php?pid=1531717#p1531717">2015-05-24 23:49:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>I&#039;ll retry with blacklisted radeon, kms off, also tell grub not to change modes, let&#039;s see what it does.<br />current state is that linux VM can both show boot messages and actually work on the passed in GPU, windows goes black after showing logo. likely at the point where the radeon driver kicked in.</p></div></blockquote></div><p>Try attaching a VGA(or hdmi or whatever you have there) screen to the GPU. Maybe it gets in trouble with the integrated screen, i&#039;m not sure how it&#039;s attached to the GPU. I guess you&#039;d be disappointed to have a burden of a separate screen.<br />If you&#039;re saying that intel&#039;s GPU isn&#039;t wired anyhow at all - that looks promising, maybe you have a real, full-featured AMD GPU inside, that fact will simplify some things.</p><p>So, yeah, do the clean install with no unnecessary hardware attached and see how it goes.</p><p>If this will work - it&#039;ll be the first actual notebook we&#039;ve observed passthrough running.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531717">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531742" class="blockpost roweven"> <h2><span><span class="conr">#5179</span> <a href="viewtopic.php?pid=1531742#p1531742">2015-05-25 02:14:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@ghormoon</p><p>Are you letting the host radeon driver claim the GPU that you&#039;re assigning?&#160; Linux GPU drivers are really not that good at releasing devices.&#160; What happens if you force it to be bound to pci-stub?&#160; Secondary laptop graphics are pretty much uncharted territory, but you&#039;ve got a lot of errors throughout that dmesg log, which all seem to point to radeon.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531742">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531805" class="blockpost rowodd"> <h2><span><span class="conr">#5180</span> <a href="viewtopic.php?pid=1531805#p1531805">2015-05-25 10:18:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve gotten everything working nicely with a Radeon card passed through to a Windows guest and using Intel integrated graphics for host. However, I&#039;ve found that I am starting to use more USB devices in the Windows guest VM (game controllers, wheels, etc), and find it inconvenient to have to start and stop the VM each time I want to use a new/different USB device. From aw blog, it is mentioned that entire USB controlled could be passed to VM using same process (vfio-pci). But... from lsusb I find that the USB bus that a plugged in device resides on is always the same 3.0 controller bus no matter what physical USB port I plug into (motherboard has 2 USB 2.0 ports, 6 3.0 ports, and an additional 1x 2.0 and 1x 3.0 port are available through the case). lspci shows 2 EHCI 2.0 controllers and 1 XHCI 3.0 controllers, so it doesn&#039;t make sense that all USB ports would be handled by a single controller, especially the 2.0 ports. Is there something I am not understanding here? Would a separate pci-e USB card dedicated to the guest be a better option? What would be best way to get hot-pluggability of USB devices to guest?</p><p>Physical layout of motherboard for reference:<br /><span class="postimg"><img src="http://s17.postimg.org/ve370sr2n/oie_One_RPCjb_V7hw.png" alt="oie_One_RPCjb_V7hw.png" /></span></p><p>lspci | grep USB:</p><div class="codebox"><pre><code>00:14.0 USB controller: Intel Corporation 9 Series Chipset Family USB xHCI Controller 00:1a.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #2 00:1d.0 USB controller: Intel Corporation 9 Series Chipset Family USB EHCI Controller #1</code></pre></div><p>lsusb:</p><div class="codebox"><pre><code>Bus 004 Device 002: ID 8087:8001 Intel Corp. Bus 004 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 003 Device 002: ID 8087:8009 Intel Corp. Bus 003 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 002 Device 002: ID 045b:0210 Hitachi, Ltd Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 001 Device 007: ID 09da:9066 A4Tech Co., Ltd. F3 V-Track Gaming Mouse Bus 001 Device 006: ID 05c7:2012 Qtronix Corp. Bus 001 Device 002: ID 045b:0209 Hitachi, Ltd Bus 001 Device 021: ID 045e:028e Microsoft Corp. Xbox360 Controller Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</code></pre></div><p>A4Tech and Qtronix are plugged into motherboard 2.0 port, Xbox360 controller is plugged into 3.0 port, but everything gets put on Bus 001...</p><div class="codebox"><pre><code>$ readlink /sys/bus/usb/devices/usb1 ../../../devices/pci0000:00/0000:00:14.0/usb1 $ readlink /sys/bus/usb/devices/usb2 ../../../devices/pci0000:00/0000:00:14.0/usb2 $ readlink /sys/bus/usb/devices/usb3 ../../../devices/pci0000:00/0000:00:1a.0/usb3 $ readlink /sys/bus/usb/devices/usb4 ../../../devices/pci0000:00/0000:00:1d.0/usb4</code></pre></div><p>Shouldn&#039;t the 2.0 ports at least go to Bus 003 or Bus 004?</p> <p class="postedit"><em>Last edited by mutiny (2015-05-25 10:42:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531805">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531811" class="blockpost roweven"> <h2><span><span class="conr">#5181</span> <a href="viewtopic.php?pid=1531811#p1531811">2015-05-25 10:30:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Usb 2.0 ports are probably ones on motherboard, usb headers for front usb...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531811">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531816" class="blockpost rowodd"> <h2><span><span class="conr">#5182</span> <a href="viewtopic.php?pid=1531816#p1531816">2015-05-25 10:38:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88848">mutiny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-15</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88848">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>Usb 2.0 ports are probably ones on motherboard, usb headers for front usb...</p></div></blockquote></div><p>The motherboard has both 2.0 and 3.0 ports, as well as headers for front/external 2.0 and 3.0, and even if I plug into either of the front USB ports they still end up on same bus/controller?</p> <p class="postedit"><em>Last edited by mutiny (2015-05-25 10:41:45)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531816">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531818" class="blockpost roweven"> <h2><span><span class="conr">#5183</span> <a href="viewtopic.php?pid=1531818#p1531818">2015-05-25 10:45:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>For me on Z77 intel board, usb 2.0 are accessible through 7 pin (or 9) headers on board, and on some revisions also 2 top ports on rear.</p><p>They work with vfio passing 00:1d.0, 00:1a.0 or 00:1f.0 (depends on revision)</p> <p class="postedit"><em>Last edited by slis (2015-05-25 10:47:14)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531818">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1531957" class="blockpost rowodd"> <h2><span><span class="conr">#5184</span> <a href="viewtopic.php?pid=1531957#p1531957">2015-05-25 20:04:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88609">fld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-06</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:fld@r00t3d.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mutiny wrote:</cite><blockquote><div><p>I&#039;ve gotten everything working nicely with a Radeon card passed through to a Windows guest and using Intel integrated graphics for host. However, I&#039;ve found that I am starting to use more USB devices in the Windows guest VM (game controllers, wheels, etc), and find it inconvenient to have to start and stop the VM each time I want to use a new/different USB device. From aw blog, it is mentioned that entire USB controlled could be passed to VM using same process (vfio-pci). But... from lsusb I find that the USB bus that a plugged in device resides on is always the same 3.0 controller bus no matter what physical USB port I plug into (motherboard has 2 USB 2.0 ports, 6 3.0 ports, and an additional 1x 2.0 and 1x 3.0 port are available through the case). lspci shows 2 EHCI 2.0 controllers and 1 XHCI 3.0 controllers, so it doesn&#039;t make sense that all USB ports would be handled by a single controller, especially the 2.0 ports. Is there something I am not understanding here? Would a separate pci-e USB card dedicated to the guest be a better option? What would be best way to get hot-pluggability of USB devices to guest?</p></div></blockquote></div><p>I had this exact same problem with my ASRock Z87 Extreme 6. No matter what USB port I used (external or internal), the device would always end up behind the XHCI controller. This is how the situation looks like in lshw:</p><div class="codebox"><pre class="vscroll"><code> *-usb:0 description: USB controller product: 8 Series/C220 Series Chipset Family USB xHCI vendor: Intel Corporation physical id: 14 bus info: pci@0000:00:14.0 version: 05 width: 64 bits clock: 33MHz capabilities: pm msi xhci bus_master cap_list configuration: driver=xhci_hcd latency=0 resources: irq:34 memory:f0c20000-f0c2ffff *-usbhost:0 product: xHCI Host Controller vendor: Linux 4.0.0-1-amd64 xhci-hcd physical id: 0 bus info: usb@4 logical name: usb4 version: 4.00 capabilities: usb-3.00 configuration: driver=hub slots=6 speed=5000Mbit/s *-usb description: USB hub product: AS2107 vendor: ASMedia physical id: 3 bus info: usb@4:3 version: 0.01 serial: USB2.0 Hub capabilities: usb-3.00 configuration: driver=hub maxpower=8mA slots=4 speed=5000Mbit/s *-usbhost:1 product: xHCI Host Controller vendor: Linux 4.0.0-1-amd64 xhci-hcd physical id: 1 bus info: usb@3 logical name: usb3 version: 4.00 capabilities: usb-2.00 configuration: driver=hub slots=14 speed=480Mbit/s *-usb:0 description: USB hub product: AS2107 vendor: ASMedia physical id: 3 bus info: usb@3:3 version: 0.01 serial: USB2.0 Hub capabilities: usb-2.10 configuration: driver=hub maxpower=100mA slots=4 speed=480Mbit/s *-usb:1 description: Mouse product: Powerful Receiver vendor: Itron physical id: 4 bus info: usb@3:4 version: 1.00 capabilities: usb-2.00 configuration: driver=usbhid maxpower=40mA speed=2Mbit/s *-usb:2 description: Audio device product: C-Media USB Headphone Set vendor: C-Media Electronics, Inc. physical id: d bus info: usb@3:d version: 1.00 capabilities: usb-1.10 audio-control configuration: driver=usbhid maxpower=100mA speed=12Mbit/s *-usb:1 description: USB controller product: 8 Series/C220 Series Chipset Family USB EHCI #2 vendor: Intel Corporation physical id: 1a bus info: pci@0000:00:1a.0 version: 05 width: 32 bits clock: 33MHz capabilities: pm debug ehci bus_master cap_list configuration: driver=ehci-pci latency=0 resources: irq:16 memory:f0c3c000-f0c3c3ff *-usbhost product: EHCI Host Controller vendor: Linux 4.0.0-1-amd64 ehci_hcd physical id: 1 bus info: usb@1 logical name: usb1 version: 4.00 capabilities: usb-2.00 configuration: driver=hub slots=2 speed=480Mbit/s *-usb description: USB hub vendor: Intel Corp. physical id: 1 bus info: usb@1:1 version: 0.05 capabilities: usb-2.00 configuration: driver=hub slots=6 speed=480Mbit/s *-usb:2 description: USB controller product: 8 Series/C220 Series Chipset Family USB EHCI # vendor: Intel Corporation physical id: 1d bus info: pci@0000:00:1d.0 version: 05 width: 32 bits clock: 33MHz capabilities: pm debug ehci bus_master cap_list configuration: driver=ehci-pci latency=0 resources: irq:23 memory:f0c3b000-f0c3b3ff *-usbhost product: EHCI Host Controller vendor: Linux 4.0.0-1-amd64 ehci_hcd physical id: 1 bus info: usb@2 logical name: usb2 version: 4.00 capabilities: usb-2.00 configuration: driver=hub slots=2 speed=480Mbit/s *-usb description: USB hub vendor: Intel Corp. physical id: 1 bus info: usb@2:1 version: 0.05 capabilities: usb-2.00 configuration: driver=hub slots=8 speed=480Mbit/s</code></pre></div><p>Why would manufacturers implement the USB 2.0 ports behind USB 3.0 controllers (and even throw in an additional ASMedia AS2107 hub), is quite strange. How can it possibly be cheaper to do it that way, than to wire the USB 2.0 ports from the chipset?</p><p>Anyways, I solved the problem by buying (reluctantly) a cheap uPD720201 based PCI-e USB 3.0 controller off ebay and passed that trough to win7. Works great. But it really sucks having to use an extension card, when the motherboard physically already has multiple USB controllers and plenty of ports :\</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1531957">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532033" class="blockpost roweven"> <h2><span><span class="conr">#5185</span> <a href="viewtopic.php?pid=1532033#p1532033">2015-05-26 02:49:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>well, I&#039;ve retried linux guest without radeon on the host (added to grub defaults &quot;intel_iommu=on nofb nomodeset modprobe.blacklist=radeon quiet&quot; and turned off graphical output in grub)<br />the result is that the dmesg is not *that* bad, but still not ok.</p><p>on VM start I get: (00:1d.0 is usb controller where I have keyboard and mouse, they work in the vm)<br />[&#160; 125.866335] dmar: DRHD: handling fault status reg 3<br />[&#160; 125.866400] dmar: DMAR:[DMA Read] Request device [00:1d.0] fault addr ef000 <br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;DMAR:[fault reason 06] PTE Read access is not set<br />[&#160; 125.992123] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; 132.713767] br0: port 1(vnet0) entered forwarding state<br />[&#160; 134.660405] kvm [585]: vcpu1 unhandled rdmsr: 0x606<br />[&#160; 139.884802] kvm [585]: vcpu0 unhandled rdmsr: 0x611<br />[&#160; 139.884885] kvm [585]: vcpu0 unhandled rdmsr: 0x639<br />[&#160; 139.884959] kvm [585]: vcpu0 unhandled rdmsr: 0x641<br />[&#160; 139.885026] kvm [585]: vcpu0 unhandled rdmsr: 0x619</p><p>on vm shutdown, nothing happens, virsh list says it&#039;s &quot;in shutdown&quot; (forever <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />)<br />if I do virsh destroy vmname it hangs.<br />then if I do virsh list, it hangs.<br />I need to shoot down the qemu process manually, then virsh list works again.<br />any ideas what&#039;s wrong?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532033">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532039" class="blockpost rowodd"> <h2><span><span class="conr">#5186</span> <a href="viewtopic.php?pid=1532039#p1532039">2015-05-26 03:33:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>update: I&#039;ve tried windows again, from a snapshot without amd drivers.<br />I can boot it and have the gpu working (as generic VGA adapter), it even recognized correctly max resolution of the screen if I tried to change it (defualt was 800x600).&#160; so far so good.<br />When I tried to install the driver, during &quot;detecting hardware&quot;, I get BSOD 0xCA <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> (nothing new in host dmesg at that time, boot time it gives the same errors as linux)</p> <p class="postedit"><em>Last edited by ghormoon (2015-05-26 03:33:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532039">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532040" class="blockpost roweven"> <h2><span><span class="conr">#5187</span> <a href="viewtopic.php?pid=1532040#p1532040">2015-05-26 03:35:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>update: I&#039;ve tried windows again, from a snapshot without amd drivers.<br />I can boot it and have the gpu working (as generic VGA adapter), it even recognized correctly max resolution of the screen if I tried to change it (defualt was 800x600).&#160; so far so good.<br />When I tried to install the driver, during &quot;detecting hardware&quot;, I get BSOD 0xCA <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>Use the driver specific to your hardware, don&#039;t go the detect driver path, even for updates via the catalyst control panel.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532040">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532044" class="blockpost rowodd"> <h2><span><span class="conr">#5188</span> <a href="viewtopic.php?pid=1532044#p1532044">2015-05-26 04:26:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m not sure what do you mean. When I select the driver on the website manually, it still gives me the catalyst installer, that goes through the &quot;detecting graphics hardware&quot; step and there it crashes. I can&#039;t select anything in the installer manually. should I extract only the driver and don&#039;t install the rest or what?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532044">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532051" class="blockpost roweven"> <h2><span><span class="conr">#5189</span> <a href="viewtopic.php?pid=1532051#p1532051">2015-05-26 05:56:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Just a heads up it looks like any Nvidia drivers past 347.88 are disabling themselves again, and spitting back code 43 errors.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532051">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532089" class="blockpost rowodd"> <h2><span><span class="conr">#5190</span> <a href="viewtopic.php?pid=1532089#p1532089">2015-05-26 10:32:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90710">toxster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-28</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90710">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hey guys</p><p>Introducing My next project, Virtualized OSX Yosemite (10.10.3) host with passthrough Nvidia GTX 970 running at 4K 60Hz..</p><p>Got everything working except USB passthrough of mouse (only apple keyboard works for some apparent reason) </p><p>Heaven ~68fps 720p with Extreme profile, 1080p ~40fps will benchmark with my win8.1 host later.</p><p>looks promising <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Modo: Gigabyte X99-Gaming 5<br />CPU: Intel 5960x<br />Passthrough GPU: Asus Strix NVidia 970 GTX</p> <p class="postedit"><em>Last edited by toxster (2015-05-26 10:33:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532089">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532119" class="blockpost roweven"> <h2><span><span class="conr">#5191</span> <a href="viewtopic.php?pid=1532119#p1532119">2015-05-26 13:54:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><p>Just a heads up it looks like any Nvidia drivers past 347.88 are disabling themselves again, and spitting back code 43 errors.</p></div></blockquote></div><p>Running 352.86 here, no Code 43 problems.&#160; The NVIDIA Control Panel stopped working, but I see others reporting that in non-VM applications.&#160; It worked on 350.12.&#160; Code 43 is a pretty generic &quot;something is wrong&quot; error, hypervisor detection isn&#039;t the only reason for it to get thrown.&#160; I recently discovered that failure to plugin aux power to cards also generates a Code 43.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532119">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532120" class="blockpost rowodd"> <h2><span><span class="conr">#5192</span> <a href="viewtopic.php?pid=1532120#p1532120">2015-05-26 13:59:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>I&#039;m not sure what do you mean. When I select the driver on the website manually, it still gives me the catalyst installer, that goes through the &quot;detecting graphics hardware&quot; step and there it crashes. I can&#039;t select anything in the installer manually. should I extract only the driver and don&#039;t install the rest or what?</p></div></blockquote></div><p>Just trying to say that the &quot;Automatically detect and install driver&quot; code is known to cause BSODs, if you&#039;re doing the &quot;Manually select your driver&quot; path, then you&#039;re getting something else.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532120">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532130" class="blockpost roweven"> <h2><span><span class="conr">#5193</span> <a href="viewtopic.php?pid=1532130#p1532130">2015-05-26 14:17:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I don&#039;t get where you maen to do that. on the web site, I do manually select (notebook gpu &gt; HD series &gt; 6xxx&gt; win 7 x64) and it gives me 288MB catalyst. that one only gives me default/custom selection and field for path. on next (either default or custom), it goes through few steps before allowing you to select things (at least on custom, default won&#039;t let you) and it crashes before that selection just after saying &quot;detecting graphics hardware&quot; in the progress bar. I can&#039;t find any way to get more specific driver than by the series 6xxx. What am I missing?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532130">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532147" class="blockpost rowodd"> <h2><span><span class="conr">#5194</span> <a href="viewtopic.php?pid=1532147#p1532147">2015-05-26 15:42:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>I don&#039;t get where you maen to do that. on the web site, I do manually select (notebook gpu &gt; HD series &gt; 6xxx&gt; win 7 x64) and it gives me 288MB catalyst. that one only gives me default/custom selection and field for path. on next (either default or custom), it goes through few steps before allowing you to select things (at least on custom, default won&#039;t let you) and it crashes before that selection just after saying &quot;detecting graphics hardware&quot; in the progress bar. I can&#039;t find any way to get more specific driver than by the series 6xxx. What am I missing?</p></div></blockquote></div><p>You&#039;re doing everything right, it just doesn&#039;t work somewhere else. Does dmesg say anything when the bsod happens?<br />And the bsod in question.. 0x000000CA you say? What are the other parameters? That&#039;s an interesting error actually. And try chopping off that 1d controller and plug in USB devices the other way, i&#039;m not sure if it isn&#039;t causing some other weird things to happen.</p> <p class="postedit"><em>Last edited by Duelist (2015-05-26 15:43:11)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532147">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532150" class="blockpost roweven"> <h2><span><span class="conr">#5195</span> <a href="viewtopic.php?pid=1532150#p1532150">2015-05-26 16:15:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=91279">ghormoon</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-05-20</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=91279">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>not a single line in dmesg.<br />when I&#039;ll get home, I&#039;ll retry and get the missing bsod parameters.<br />currently 1d is only controller I can use, maybe I can not passthrough it and pass the usb devices one by one, that should be possible somehow, though I&#039;ve not tried it yet <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /><br />or maybe I can chop them off and try to install the driver over rdp? let&#039;s see <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532150">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532166" class="blockpost rowodd"> <h2><span><span class="conr">#5196</span> <a href="viewtopic.php?pid=1532166#p1532166">2015-05-26 17:09:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86675">lordleto</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-14</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Mind sharing your xml/commandline?</p><div class="quotebox"><cite>toxster wrote:</cite><blockquote><div><p>Hey guys</p><p>Introducing My next project, Virtualized OSX Yosemite (10.10.3) host with passthrough Nvidia GTX 970 running at 4K 60Hz..</p><p>Got everything working except USB passthrough of mouse (only apple keyboard works for some apparent reason) </p><p>Heaven ~68fps 720p with Extreme profile, 1080p ~40fps will benchmark with my win8.1 host later.</p><p>looks promising <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Modo: Gigabyte X99-Gaming 5<br />CPU: Intel 5960x<br />Passthrough GPU: Asus Strix NVidia 970 GTX</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532166">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532168" class="blockpost roweven"> <h2><span><span class="conr">#5197</span> <a href="viewtopic.php?pid=1532168#p1532168">2015-05-26 17:19:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85563">Punkbob</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-02</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=85563">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><p>Just a heads up it looks like any Nvidia drivers past 347.88 are disabling themselves again, and spitting back code 43 errors.</p></div></blockquote></div><p>Running 352.86 here, no Code 43 problems.&#160; The NVIDIA Control Panel stopped working, but I see others reporting that in non-VM applications.&#160; It worked on 350.12.&#160; Code 43 is a pretty generic &quot;something is wrong&quot; error, hypervisor detection isn&#039;t the only reason for it to get thrown.&#160; I recently discovered that failure to plugin aux power to cards also generates a Code 43.</p></div></blockquote></div><p>Hmm, I will look into it more then. Btw, are you running Windows 10 or 8.1, cause it might be an issue on my end as I am running my VMs with Windows 10.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532168">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532216" class="blockpost rowodd"> <h2><span><span class="conr">#5198</span> <a href="viewtopic.php?pid=1532216#p1532216">2015-05-26 19:41:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Punkbob wrote:</cite><blockquote><div><p>Just a heads up it looks like any Nvidia drivers past 347.88 are disabling themselves again, and spitting back code 43 errors.</p></div></blockquote></div><p>Running 352.86 here, no Code 43 problems.&#160; The NVIDIA Control Panel stopped working, but I see others reporting that in non-VM applications.&#160; It worked on 350.12.&#160; Code 43 is a pretty generic &quot;something is wrong&quot; error, hypervisor detection isn&#039;t the only reason for it to get thrown.&#160; I recently discovered that failure to plugin aux power to cards also generates a Code 43.</p></div></blockquote></div><p>Hmm, I will look into it more then. Btw, are you running Windows 10 or 8.1, cause it might be an issue on my end as I am running my VMs with Windows 10.</p></div></blockquote></div><p>8.1, AIUI 10 has numerous issues running as a VM</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532216">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532238" class="blockpost roweven"> <h2><span><span class="conr">#5199</span> <a href="viewtopic.php?pid=1532238#p1532238">2015-05-26 20:58:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=90710">toxster</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-04-28</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=90710">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>lordleto wrote:</cite><blockquote><div><p>Mind sharing your xml/commandline?</p></div></blockquote></div><p>Sure, havent gotten around in attempting to forward the entire USB controller, supposedly doing so should work better.</p><p>Some comments to the XML below:</p><p>yoyo.iso is yosemite installer created with unibeast, end result is an installation that don&#039;t require any &quot;hacked&quot; kexts.<br />the direkt kernel /root/vm/boot is chameleon r2700 boot</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; id=&#039;8&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;osx&lt;/name&gt; &lt;uuid&gt;ddb18084-f1d7-4041-b7be-9ab0437470c6&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;8286208&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;8286208&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;resource&gt; &lt;partition&gt;/machine&lt;/partition&gt; &lt;/resource&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-q35-2.3&#039;&gt;hvm&lt;/type&gt; &lt;kernel&gt;/root/vm/boot&lt;/kernel&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;/hyperv&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;core2duo&lt;/model&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;4&#039; threads=&#039;1&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;utc&#039;/&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/cam/mac_hdd.img&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt; &lt;alias name=&#039;sata0-0-0&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;sata&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;sata0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1f&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pcie-root&#039;&gt; &lt;alias name=&#039;pcie.0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;1&#039; model=&#039;dmi-to-pci-bridge&#039;&gt; &lt;alias name=&#039;pci.1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1e&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;2&#039; model=&#039;pci-bridge&#039;&gt; &lt;alias name=&#039;pci.2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039;&gt; &lt;alias name=&#039;usb0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x01&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;c8:85:50:7f:9c:bf&#039;/&gt; &lt;source network=&#039;default&#039; bridge=&#039;virbr0&#039;/&gt; &lt;target dev=&#039;vnet0&#039;/&gt; &lt;model type=&#039;e1000-82545em&#039;/&gt; &lt;alias name=&#039;net0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x05ac&#039;/&gt; &lt;!-- apple keyboard --&gt; &lt;product id=&#039;0x0250&#039;/&gt; &lt;address bus=&#039;1&#039; device=&#039;9&#039;/&gt; &lt;/source&gt; &lt;alias name=&#039;hostdev0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;none&#039;&gt; &lt;alias name=&#039;balloon0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;seclabel type=&#039;none&#039; model=&#039;none&#039;/&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;isa-applesmc,osk=googleit!&#039;/&gt; &lt;!-- read out from your mac or google it. --&gt; &lt;qemu:arg value=&#039;-smbios&#039;/&gt; &lt;qemu:arg value=&#039;type=2&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ide-drive,bus=ide.1,drive=MacDVD&#039;/&gt; &lt;qemu:arg value=&#039;-drive&#039;/&gt; &lt;qemu:arg value=&#039;id=MacDVD,if=none,snapshot=on,file=/root/vm/yoyo.iso&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.0,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=03:00.1&#039;/&gt; &lt;qemu:arg value=&#039;-vga&#039;/&gt; &lt;qemu:arg value=&#039;none&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1532239" class="blockpost rowodd"> <h2><span><span class="conr">#5200</span> <a href="viewtopic.php?pid=1532239#p1532239">2015-05-26 20:59:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=58583">Nesousx</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-03-27</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=58583">Email</a></span> <span class="website"><a href="https://www.kodi-xbmc.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ghormoon wrote:</cite><blockquote><div><p>I don&#039;t get where you maen to do that. on the web site, I do manually select (notebook gpu &gt; HD series &gt; 6xxx&gt; win 7 x64) and it gives me 288MB catalyst. that one only gives me default/custom selection and field for path. on next (either default or custom), it goes through few steps before allowing you to select things (at least on custom, default won&#039;t let you) and it crashes before that selection just after saying &quot;detecting graphics hardware&quot; in the progress bar. I can&#039;t find any way to get more specific driver than by the series 6xxx. What am I missing?</p></div></blockquote></div><br /><p>Have you tried manually installing the driver? Once downloaded, you only extract it somewhere on your disk but do not use wizard. Then from Windows Device Manager, you right clic on the graphic card (probably with the yellow warning sign), and install driver from here by pointing to the path were the drivers has been extracted.</p><p>I used to do it this way with my old setup (Xen + AMD cards), in order to avoid BSOD.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1532239">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=207">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=206">206</a> <a href="viewtopic.php?id=162768&amp;p=207">207</a> <strong>208</strong> <a href="viewtopic.php?id=162768&amp;p=209">209</a> <a href="viewtopic.php?id=162768&amp;p=210">210</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=209">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
