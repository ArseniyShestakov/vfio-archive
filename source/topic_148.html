<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 148) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=148" title="Page 148" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=147" title="Page 147" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=149" title="Page 149" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=147">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=146">146</a> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <strong>148</strong> <a href="viewtopic.php?id=162768&amp;p=149">149</a> <a href="viewtopic.php?id=162768&amp;p=150">150</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=149">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1487387" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3676</span> <a href="viewtopic.php?pid=1487387#p1487387">2014-12-25 20:19:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m feeling like my GPU&#039;s vendor dumped me.<br />Some months ago i&#039;ve tried to update my card&#039;s VBIOS on UEFI, it downloaded the image but failed to apply it due to lack of drivers or some other stuff - it wasn&#039;t my pc, so i didn&#039;t want to mess with owner&#039;s windows system like installing drivers.</p><p>But i got the ROM. For one card only, but that&#039;s fine.<br />Tried passing it wth romfile and OVMF just hanged, aw suggested to test it on real hardware to see if it&#039;s just poorly written and broken. So i gave up for some time.</p><p>Now, i&#039;ve installed windows system on a bare metal system using UEFI+GPT and even secureboot was working. But ASUS UEFI Update tools now says that... my GPU doesn&#039;t support UEFI. Considering the fact i have the actual ROM... It seems strange.</p><p>So, it&#039;s time to begin my journey on writing messages to their support team.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487387">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487514" class="blockpost roweven"> <h2><span><span class="conr">#3677</span> <a href="viewtopic.php?pid=1487514#p1487514">2014-12-26 10:05:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>check whatever you use for your vm&#039;s disk. Be it filesystem&#039;s(you use file as a storage) health or actual hardware disk.<br />It seems to me like a kernel&#039;s problem, not a VM one.</p></div></blockquote></div><p>I&#039;m using a dedicated physical disk through lvm (I created a virtual disk using the whole physical disk and passed it to qemu).<br />It&#039;s a kernel oops for sure, but the process that generated it was qemu (for what I can understand from logs).</p><br /><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Also, if you&#039;re sure that your host disks are okay, try preparing your windows to migrating on virtio-blk-pci instead of scsi-way. That involves creating a dummy-drive on virtio-blk-pci device and feeding windows with drivers from virtio.iso and then &quot;reconnecting&quot; the drive.</p></div></blockquote></div><p>The disk seems good to me, which qemu options I need to use virtio-blk-pci?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487514">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487526" class="blockpost rowodd"> <h2><span><span class="conr">#3678</span> <a href="viewtopic.php?pid=1487526#p1487526">2014-12-26 11:50:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>The disk seems good to me, which qemu options I need to use virtio-blk-pci?</p></div></blockquote></div><p>First - you&#039;ve got to create a -device entry with virtio-blk-pci and drive=null, where -drive=/dev/null,id=null,if=none,format=raw .<br />Second - you boot windows with virtio.iso plugged into it, load the drivers for that disk controller.<br />Third - you change the drive of given virtio-blk-pci device to your windows drive and it should boot. If it gets BSOD 7B during startup - drivers for disk controller aren&#039;t installed.</p><p>Also, you appear to be using Q35 with it&#039;s built-in AHCI(SATA) controller, which is known to have some issues.</p><p>Hope that helps.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487526">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487568" class="blockpost roweven"> <h2><span><span class="conr">#3679</span> <a href="viewtopic.php?pid=1487568#p1487568">2014-12-26 14:18:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>First - you&#039;ve got to create a -device entry with virtio-blk-pci and drive=null, where -drive=/dev/null,id=null,if=none,format=raw .<br />Second - you boot windows with virtio.iso plugged into it, load the drivers for that disk controller.<br />Third - you change the drive of given virtio-blk-pci device to your windows drive and it should boot. If it gets BSOD 7B during startup - drivers for disk controller aren&#039;t installed.</p></div></blockquote></div><p>Thanks, I&#039;ll try ASAP.<br />What are the benefits of using virtio-blk instead of virtio-scsi?</p><br /><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Also, you appear to be using Q35 with it&#039;s built-in AHCI(SATA) controller, which is known to have some issues.</p></div></blockquote></div><p>I don&#039;t think so: as you can see from the script I&#039;m using to launch qemu (posted previously), I don&#039;t specify any &quot;-m&quot; option and looking at the output of &quot;qemu-system-x86_64 -machine help&quot; I found this:</p><div class="codebox"><pre><code>... pc Standard PC (i440FX + PIIX, 1996) (alias of pc-i440fx-2.2) pc-i440fx-2.2 Standard PC (i440FX + PIIX, 1996) (default) ...</code></pre></div><p>What is that makes you think I&#039;m using q35?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487568">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487573" class="blockpost rowodd"> <h2><span><span class="conr">#3680</span> <a href="viewtopic.php?pid=1487573#p1487573">2014-12-26 14:28:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>check whatever you use for your vm&#039;s disk. Be it filesystem&#039;s(you use file as a storage) health or actual hardware disk.<br />It seems to me like a kernel&#039;s problem, not a VM one.</p></div></blockquote></div><p>I&#039;m using a dedicated physical disk through lvm (I created a virtual disk using the whole physical disk and passed it to qemu).</p></div></blockquote></div><p>Maybe it&#039;s a collision of the host and guest LVM since you&#039;re using a whole disk and it will be visible to both.&#160; Is the guest volume group active in the host?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487573">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487580" class="blockpost roweven"> <h2><span><span class="conr">#3681</span> <a href="viewtopic.php?pid=1487580#p1487580">2014-12-26 14:52:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>It&#039;s posible to use the intended GPU to passthrough in first slot and tell the host to use the second slot GPU? In most motherboards the first slot has x16 and the second one has x8...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487580">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487595" class="blockpost rowodd"> <h2><span><span class="conr">#3682</span> <a href="viewtopic.php?pid=1487595#p1487595">2014-12-26 15:22:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Cubex wrote:</cite><blockquote><div><p>It&#039;s posible to use the intended GPU to passthrough in first slot and tell the host to use the second slot GPU? In most motherboards the first slot has x16 and the second one has x8...</p></div></blockquote></div><p>Yes.<br />Moreover, i have nvidia GT610 plugged in into pci-e x1 slot. Bus-Device-Function is 04:00.0<br />Passing through two HD7750 in x16 and x8(somehow runs as x4, but wired as x8, may be a driver&#039;s problem).<br />It works.<br />BUT!<br />1. You have to plunge the GPUs to pci-stub BEFORE ANYTHING.<br />2. Nvidia driver fails to detect the card without BusID option.</p><div class="codebox"><pre><code>Section &quot;Device&quot; Identifier &quot;Device0&quot; Driver &quot;nvidia&quot; VendorName &quot;NVIDIA Corporation&quot; BoardName &quot;GeForce GT 610&quot; BusID &quot;PCI:04:00:00&quot; EndSection</code></pre></div><p>EDIT:<br />Oh, the only downside is - there will be no emergency console available on ctrl-alt-F[1-12] since there is no VGA output.<br />Grub will show you your custom fonts, but things like plymouth, using kernel mode setting, won&#039;t work.<br />There is a bright side in it - usually VFIO-bind service is loaded after X, so if X fails to load due to bad drivers(like after a kernel rebuild, which should be worked around using package manager, but i&#039;m lazy and sort of know what i&#039;m doing) - primary GPU won&#039;t be hooked to pci-stub and VGA will work and you&#039;ll get to login in the console.</p><p>Also, gigabyte motherboards may offer a switch, which changes the primary GPU, solving everything. My ASUS doesn&#039;t have that feature.</p> <p class="postedit"><em>Last edited by Duelist (2014-12-26 16:19:07)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487595">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487635" class="blockpost roweven"> <h2><span><span class="conr">#3683</span> <a href="viewtopic.php?pid=1487635#p1487635">2014-12-26 17:21:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The console thing maybe can be solved by using fbcon, for example adding fbcon=map:111111 in bootline<br />and thanks for confirming the posibility of first slot</p> <p class="postedit"><em>Last edited by Cubex (2014-12-26 17:22:36)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487635">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1487806" class="blockpost rowodd"> <h2><span><span class="conr">#3684</span> <a href="viewtopic.php?pid=1487806#p1487806">2014-12-27 04:45:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I though that I should post what I&#039;ve done so far that has enabled me to get my passthrough working and the issues I&#039;ve run into along the way. <strong>Note:</strong> I&#039;m still having at least 1 issue, which is an issue with some flickering black lines on the host side of the passthrough.</p><p>Specifications:<br />Host OS: Arch Linux - I&#039;ve manually patched the current kernel (from ABS) with the ACS patch. This was an interesting experience required some modification to patch the correct lines.<br />Guest OS: Windows 8.1 Pro<br />Motherboard: Asrock C226-WS (Not the C226-WS+)<br />CPU: Intel Xeon E3-1241v3<br />Host GPU: Radeon R5 230<br />Guest GPU: Radeon R9 270X<br />(I&#039;m using the open source radeon driver, not catalyst)<br /><strong>Note:</strong> I&#039;m also using OVMF (which is actually in the Arch repos in Extra), but apart from manually patching the kernel, all other core software involved (qemu, libvirt, virt-manager) is from Arch repos, not from the AUR.</p><p><strong>Edit:</strong> I&#039;ve replaced the original motherboard (Asus P9D WS) with an Asrock C226-WS which allows me to put my passthrough VGA card in the top (closest to CPU) slot, since the video seems to initialise as per slot number since the full size slots are PCIe Slot 1, 3 and 6, with 6 being the top slot. This has given me a little extra performance (going from PCIe 3 x4 to x8) as well, bringing me closer to around 98% performance (somewhere around 98.5%), up from around 95%/96%, which is good enough for me.</p><p>The devices that I am passing through to the guest include the USB 3 card, the onboard audio (using a PCIe sound card on the host), one of the onboard LAN ports (Dual LAN, both Intel I210) and the R9 270X of course. At this point, I will mention that the original USB 3 card I was using ended up causing issues as the device wouldn&#039;t reset properly once it was released from the VM the first time leading to error&#039;s along the line of:</p><div class="codebox"><pre><code>vfio-pci 0000:01:00.0: Refused to change power state, currently in D3 vfio_pci_disable: Failed to reset device 0000:01:00.0 (-22)</code></pre></div><p>This also meant I could only pass through the device once from a fresh boot and then have to reboot to do it again. It would also cause irq issues like the following conflict with the sound card (I did remove the sound card, thinking that was the issue but it conflicted with other devices):</p><div class="codebox"><pre><code>genirq: Flags mismatch irq 16. 00000000 (vfio-intx(0000:01:00.0)) vs. 00000080 (snd_oxygen_lib)</code></pre></div><p>I had other cards on hand and replaced the USB 3 card with one that only partially worked (over-current conditions, leaving 2 ports not working) and then finally with one that would reset properly when released by the VM. I mention all this so that it might provide some insight for those that may be having these issues. The other main issue was with IOMMU groups (libvirt/qemu couldn&#039;t bind the devices being passed through without binding other devices in the IOMMU group) and required the ACS patch and the addition of <strong>pcie_acs_override=downstream</strong> to the kernel parameters in GRUB.</p><p>Kernel Parameters (through GRUB):</p><div class="codebox"><pre><code>intel_iommu=on pcie_acs_override=downstream pci-stub.ids=1002:6810,1002:aab0,1106:3432,8086:8c20</code></pre></div><p>I will also note here that the id for the dual LAN port hasn&#039;t been bound to pci-stub here as both devices share the same id, but it appears to work fine, perhaps due to it being an Intel NIC.</p><p>Kernel Modules (in initramfs via /etc/mkinicpio.conf) - except ahci, which was already in my modules line before this:</p><div class="codebox"><pre><code>MODULES=&quot;ahci pci-stub vfio-pci vfio-iommu-type1&quot;</code></pre></div><p>I also have /etc/modprobe.d/kvm-qemu.conf</p><div class="codebox"><pre><code>options kvm ignore_msrs=1</code></pre></div><p>And /etc/modprobe.d/vfio-iommu.conf</p><div class="codebox"><pre><code>options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p><strong>Edit:</strong> I was using the vfio-bind script, but I was able to just assign devices to pci-stub and let libvirt manage this (managed=&#039;yes&#039; hostdev entries). The only issue was that both LAN ports on this dual LAN board are the same vendor:model in lspci and my network scripts were adding any en* devices to the network bridge and so my host box wouldn&#039;t connect to the network. This has since been fixed but only assigning the one I want to a network and leaving the other disconnected.</p><p>At this point, I diverged slightly from others and used libvirt along with virt-manager to configure setup and configure VM and the passthrough.</p><p>I used virt-manager to create a new virtual machine, specifying Windows 8.1 as the guest OS, created a temporary hdd image and completed the setup without customizing the install, leaving it as an i440fx system (after watching Alex Williamson&#039;s KVM Forum presentation, seems like there&#039;s still potential issues with q35 and i440fx works fine). I then went through and removed some of the extra devices I didn&#039;t need, leaving the IDE, PCI and USB controllers in place and ended up just using VNC and cirrus video to get the guest installed, rather than having all the spice stuff in place. I modified a few of the settings, told it to copy the hosts cpu config, adjusted the cpu topology and then used virsh to edit the xml file of the VM. I specifically <strong>did not</strong> pass through the HDMI for the GPU being passed through in the end, as it causes the host screen to go fuzzy and it doesn&#039;t release/reset properly once the guest VM shuts down.</p><p><strong>Yet another note:</strong> I didn&#039;t pass the GPU through until I had installed the OS using the VNC/cirrus video and had ensured that my other devices were working correctly and that the VM would startup and shutdown repeatedly without issue without the GPU bieng passed through.</p><p>Of the changes via virsh, one of them was the addition of the OVMF loader, specifying a whole physical hard drive, rather than an image and modifying some of the hostdev entries with the vfio driver (I&#039;ll point these out further down).</p><p><strong>Edit:</strong> I modified the VM after it being noted that I wasn&#039;t using Virtio for the disk (virtio is definitely faster for me), so I went through the process to get the driver installed then switched the disk to virtio initially, then to scsi (using virtio-scsi controller) and added the discard=&quot;unmap&quot; to the driver line for the disk since I&#039;m using an SSD.</p><p>This is how the updated xml file for my VM looks:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;windows&lt;/name&gt; &lt;uuid&gt;b49fc4cc-149e-4904-8a5c-e74fb5a4c417&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;12582912&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;12582912&lt;/currentMemory&gt; &lt;memoryBacking&gt; &lt;hugepages/&gt; &lt;nosharepages/&gt; &lt;/memoryBacking&gt; &lt;vcpu placement=&#039;static&#039;&gt;6&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;loader type=&#039;pflash&#039;&gt;/var/lib/libvirt/images/ovmf_x64.bin&lt;/loader&gt; &lt;bootmenu enable=&#039;no&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;SandyBridge&lt;/model&gt; &lt;vendor&gt;Intel&lt;/vendor&gt; &lt;topology sockets=&#039;1&#039; cores=&#039;6&#039; threads=&#039;1&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vme&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;dtes64&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;invpcid&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;vmx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;erms&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;xtpr&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smep&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;est&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;monitor&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;smx&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;abm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;acpi&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;fma&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;osxsave&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ht&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdcm&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pdpe1gb&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;fsgsbase&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;f16c&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;invtsc&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;tm2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;avx2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ss&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;bmi1&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;bmi2&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;pcid&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;ds_cpl&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;movbe&#039;/&gt; &lt;feature policy=&#039;require&#039; name=&#039;rdrand&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/sbin/qemu-system-x86_64&lt;/emulator&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039; discard=&#039;unmap&#039;/&gt; &lt;source dev=&#039;/dev/sdd&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;scsi&#039;/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source dev=&#039;/dev/sde&#039;/&gt; &lt;target dev=&#039;sdb&#039; bus=&#039;scsi&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;target dev=&#039;hdc&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;boot order=&#039;1&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;nec-xhci&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039; model=&#039;virtio-scsi&#039;&gt; &lt;driver queues=&#039;6&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x05&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x1b&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x01&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x0f&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>The relevant extra changes I made are:<br />The OVMF loader, which I copied to my libvirt images directory (which is a symlink anyway) as it complained that it didn&#039;t have permissions and I was too lazy to mess around with it.</p><div class="codebox"><pre><code> &lt;loader type=&#039;pflash&#039;&gt;/var/lib/libvirt/images/ovmf_x64.bin&lt;/loader&gt;</code></pre></div><p>The disk type for the system drive (SSD), which I specified as block and specified the source drive (/dev/sdd in this case). As noted earlier, this was changed as I&#039;m using virtio-scsi and unmap to pass through trim/discard commands from the guest OS to the drive:</p><div class="codebox"><pre><code> &lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039; discard=&#039;unmap&#039;/&gt; &lt;source dev=&#039;/dev/sdd&#039;/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;scsi&#039;/&gt; &lt;boot order=&#039;2&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt;</code></pre></div><p>And the addition of the vfio device driver name for the host devices being passed through (just added between the hostdev lines):</p><div class="codebox"><pre><code> &lt;driver name=&#039;vfio&#039;/&gt;</code></pre></div><p>There was a bit of fiddling amongst all this obviously (as per some of my notes above for issues I ran into) but ultimately it is, for the most part, working. I haven&#039;t yet tested the system on bare metal to get an indication of the performance when it&#039;s not in the VM, but comparing some limited benchmarking to what I can find equivalents of online (Unigine Valley benchmark), I think I&#039;m within about 5% of bare metal performance. It might be more like within 10%, but I have yet to do more testing to determine how it compares to relatively equivalent hardware.</p><p>Hopefully some of this is useful to others with their attempts and I think I&#039;ve covered most of the work I&#039;ve done to get it to this point.</p><p><strong>Edit:</strong> I removed the seperate pci-stub conf and softdep on drm and put my pci-stub line as a kernel parameter. I also added a second drive for storage (steam backups, etc). I&#039;ve also enabled hugepages (using the Arch wiki guide), though this required a restart to work properly without throwing errors from libvirt.</p> <p class="postedit"><em>Last edited by Myranti (2015-01-20 11:43:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1487806">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488006" class="blockpost roweven"> <h2><span><span class="conr">#3685</span> <a href="viewtopic.php?pid=1488006#p1488006">2014-12-27 20:15:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87584">pkim</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-27</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87584">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>All,</p><p>I wanted to report my successful setup so that others may have another data point trying to do the same. I also need others to see what setup works, because before embarking on trying to do this and sinking down a significant amount of time, I didn&#039;t know whether I would succeed or not. I tried Googling my motherboard and the setup with vfio but didn&#039;t find any with my setup, so I didn&#039;t have 100% confidence that I would be able to get my system running.</p><p>Host OS: Fedora 21 (64bit, 3.17.7 kernel)<br />Guest OS: Windows 7 (64bit)<br />CPU: i7-4790K (one of the very few K versions that supports Vt-d)<br />Motherboard: Asus Sabertooth Z97 mark 1 (had to enable virtualization and Vt-d in BIOS)<br />Host GPU: Geforce 970 GTX (Nvidia&#039;s proprietary driver v346.22)<br />Guest GPU: Geforce 560Ti (Nvidia&#039;s driver v347.09)<br />System RAM: DDR3-1600 4x8GB (Crucial Ballistix Sport)<br />Emulator/Hypervisor: Running qemu-kvm, which is managed by libvirtd</p><p>I believe I ran into every conceivable problem that has been reported by others in this very long thread. Some of the issues and how I resolved them:</p><p>1. Windows reported Code 43 - had to hide from Windows (more specifically from Nvidia&#039;s driver) that it was running as a VM - <a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html" rel="nofollow"> info here </a> (modified the -cpu switch that was being sent by libvirt, include kvm=off and eliminate all hv_* options) - I am starting to see why Linus infamously gave Nvidia the finger on one of the videos I found on the internet. Why would Nvidia actively engage in locking out their card from being run in VM? I doubt that would increase the sales of their Quadro line of cards or to decrease their support line load because of guys like me trying to get this to work with their cards. Instead they decided to turn this into a game of cat and mouse hide and seek. I don&#039;t understand their decision other than because they have such a dominant position that they think they can get away with it. AMD isn&#039;t providing any competition to Nvidia as I am reading that Radeon cards have their own set of issues.<br />2. Windows reported Code 12 - Initially ran without any video or graphics for the VM in libvirt to bypass this issue, but I couldn&#039;t figure out how to pipe the sound out - ended up using &quot;Xen&quot; for video card in libvirt. That allowed the sound the come through and eliminated Code 12 in Windows.<br />3. qemu reported that it couldn&#039;t lock memory - I played with ilimit and editing /etc/security/limits.conf, but none of that worked (makes sense, I was running qemu-kvm as root - no limit) - it turned out that selinux was blocking ipc_lock operation for qemu-kvm. I used the excellent Fedora&#039;s selinux debugging tool to enable it and now it works.<br />4. I had issues with iommu grouping. The two Nvidia cards were being grouped into the same group and qemu refused to work because the iommu grouping was &quot;not a viable grouping.&quot; I had initially assumed that the PCIe ACS patch from Alex Williamson <a href="https://lkml.org/lkml/2013/5/30/513" rel="nofollow"> patch here </a> has either gone upstream or Fedora team incorporated the patch by now, but no amount of tweaking on the boot command pcie_acs_override=downstream would work. But in few posts, Alex says that this patch will not go upstream due to the nature of the patch and the bug report on fedora <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1113399" rel="nofollow"> bugzilla report here </a> makes it clear that it hadn&#039;t made it even as a patch on Fedora. I also downloaded the source RPM and checked out quirks.c file and realized that it did not have the patch (I&#039;m at the latest kernel version 3.17.7 for FC21). I wanted to do this the &quot;right&quot; way and went about creating a custom RPM from the source RPM (plus the ACS patch). I used the custom kernel compiling guide <a href="https://fedoraproject.org/wiki/Building_a_custom_kernel" rel="nofollow"> here </a>. The patch also didn&#039;t work out of the box, I had to manually patch it in for 3.17.7. I also had to create a link for python-config in /usr/local/bin. The stock installation doesn&#039;t seem to have the link and it breaks the kernel compile.<br />5. I had to put the following options to grub boot up - &quot;intel_iommu=on pci-stub.ids=10de:1200,10de:0e0c pcie_acs_override=downstream&quot;</p><p>I&#039;ve had other issues too, but many of them were caused by not following some of the nicely written guides on the net.</p><p>Here&#039;s what I used as a base guide <a href="http://www.firewing1.com/howtos/fedora-20/create-gaming-virtual-machine-using-vfio-pci-passthrough-kvm" rel="nofollow"> here </a>.<br />I didn&#039;t rebuild qemu, as I was already at version 2.1.2. I also didn&#039;t have to worry about nosnoop and i915 patch. I installed the stock qemu and kvm from Fedora. I did install the vfio-bind service as the guide indicated - this is important as we need bring the device into the /dev/vfio/ directory. I did update /etc/libvirt/qemu.conf to allow qemu to run as root and included the new cgroup_device_acl options. Instead of creating the libvirt xml from scratch as the guide suggested, I actually use libvirt to create a VM first. I then continued to install the guest OS and the virtio stuff needed to get it working. Then I started to modify the xml using &quot;virsh edit [domain name]&quot; to make updates first to use vfio-pci then any additional modifications as needed. The tricky part of editing the xml file was making sure I had the &quot;xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&quot; line at the top. Otherwise, I kept losing the &lt;qemu:commandline&gt; options.</p><p>Windows 7 indicates that I&#039;m at level 7.0 for &quot;Windows Experience Index&quot;<br />I didn&#039;t run any 3D benchmarks, but did run Portal using Steam - no problems seen there and very good performance as far as I can tell, certainly better than a Intel Core 2 Duo E8500 setup I had previously dedicated for gaming.</p><p>Ongoing problems - after shutting down the VM, I can&#039;t get it to come up again the second time (or the third time, etc). I used the suggested trick of putting the host in Suspend mode/wake up and launching again - that works. But occasionally, I get an interrupt issue that I can&#039;t get out of and the whole machine needs rebooting. Also the audio isn&#039;t quite right. I&#039;m using ICH6 to emulate and piping it to the host via the Xen setup, but I&#039;m getting fairly frequent glitches/stuttering in audio from the guest.</p><p>This capability is a bit of a game-changer for me. I&#039;ve always had two machines - one for my mission critical stuff in Linux, and another for gaming in Windows. Steam&#039;s effort to bring more gaming to Linux is helping, but we&#039;re not quite there yet. I think that this setup may be the first time where I feel that I can actually consolidate two machines into one. A big thank you for everyone who allowed this to happen and many people debugging this.</p><p>My libvirt xml file:</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039; xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;&gt; &lt;name&gt;win7-gaming&lt;/name&gt; &lt;uuid&gt;ed501ade-d5f1-447e-87d7-a527ba1847b5&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;hyperv&gt; &lt;relaxed state=&#039;on&#039;/&gt; &lt;vapic state=&#039;on&#039;/&gt; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt; &lt;/hyperv&gt; &lt;/features&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/bin/qemu-kvm&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win7.qcow2&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/virtio-win-0.1-94.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:cb:a5:3b&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;xen&#039; vram=&#039;4096&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0424&#039;/&gt; &lt;product id=&#039;0x2514&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;2&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x06a3&#039;/&gt; &lt;product id=&#039;0x8021&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52b&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;4&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pci.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=02:00.1,bus=pci.0&#039;/&gt; &lt;qemu:arg value=&#039;-bios&#039;/&gt; &lt;qemu:arg value=&#039;/usr/share/qemu/bios.bin&#039;/&gt; &lt;qemu:arg value=&#039;-cpu&#039;/&gt; &lt;qemu:arg value=&#039;Haswell,kvm=off&#039;/&gt; &lt;/qemu:commandline&gt; &lt;/domain&gt;</code></pre></div><p>The patch file for kernel 3.17.7:</p><div class="codebox"><pre class="vscroll"><code>diff -rupN kernel-3.17.fc21/linux-3.17.7-300.pkim.fc21.x86_64/Documentation/kernel-parameters.txt kernel-3.17.fc21.new/linux-3.17.7-300.pkim.fc21.x86_64/Documentation/kernel-parameters.txt --- a/Documentation/kernel-parameters.txt 2014-12-26 00:24:21.607861638 -0800 +++ b/Documentation/kernel-parameters.txt 2014-12-25 23:56:13.554340620 -0800 @@ -2655,6 +2655,16 @@ bytes respectively. Such letter suffixes nomsi Do not use MSI for native PCIe PME signaling (this makes all PCIe root ports use INTx for all services). + pcie_acs_override = + [PCIE] Override missing PCIe ACS support for: + downstream + All downstream ports - full ACS capabilties + multifunction + All multifunction devices - multifunction ACS subset + id:nnnn:nnnn + Specfic device - full ACS capabilities + Specified as vid:did (vendor/device ID) in hex + pcmv= [HW,PCMCIA] BadgePAD 4 pd_ignore_unused diff -rupN kernel-3.17.fc21/linux-3.17.7-300.pkim.fc21.x86_64/drivers/pci/quirks.c kernel-3.17.fc21.new/linux-3.17.7-300.pkim.fc21.x86_64/drivers/pci/quirks.c --- a/drivers/pci/quirks.c 2014-12-26 00:24:21.157861498 -0800 +++ b/drivers/pci/quirks.c 2014-12-26 00:02:46.714460917 -0800 @@ -3583,6 +3583,108 @@ struct pci_dev *pci_get_dma_source(struc return pci_dev_get(dev); } +static bool acs_on_downstream; +static bool acs_on_multifunction; + +#define NUM_ACS_IDS 16 +struct acs_on_id { + unsigned short vendor; + unsigned short device; +}; +static struct acs_on_id acs_on_ids[NUM_ACS_IDS]; +static u8 max_acs_id; + +static __init int pcie_acs_override_setup(char *p) +{ + if (!p) + return -EINVAL; + + while (*p) { + if (!strncmp(p, &quot;downstream&quot;, 10)) + acs_on_downstream = true; + if (!strncmp(p, &quot;multifunction&quot;, 13)) + acs_on_multifunction = true; + if (!strncmp(p, &quot;id:&quot;, 3)) { + char opt[5]; + int ret; + long val; + + if (max_acs_id &gt;= NUM_ACS_IDS - 1) { + pr_warn(&quot;Out of PCIe ACS override slots (%d)\n&quot;, + NUM_ACS_IDS); + goto next; + } + + p += 3; + snprintf(opt, 5, &quot;%s&quot;, p); + ret = kstrtol(opt, 16, &amp;val); + if (ret) { + pr_warn(&quot;PCIe ACS ID parse error %d\n&quot;, ret); + goto next; + } + acs_on_ids[max_acs_id].vendor = val; + + p += strcspn(p, &quot;:&quot;); + if (*p != &#039;:&#039;) { + pr_warn(&quot;PCIe ACS invalid ID\n&quot;); + goto next; + } + + p++; + snprintf(opt, 5, &quot;%s&quot;, p); + ret = kstrtol(opt, 16, &amp;val); + if (ret) { + pr_warn(&quot;PCIe ACS ID parse error %d\n&quot;, ret); + goto next; + } + acs_on_ids[max_acs_id].device = val; + max_acs_id++; + } +next: + p += strcspn(p, &quot;,&quot;); + if (*p == &#039;,&#039;) + p++; + } + + if (acs_on_downstream || acs_on_multifunction || max_acs_id) + pr_warn(&quot;Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA\n&quot;); + + return 0; +} +early_param(&quot;pcie_acs_override&quot;, pcie_acs_override_setup); + +static int pcie_acs_overrides(struct pci_dev *dev, u16 acs_flags) +{ + int i; + + /1 /bin /boot /cdrom /dev /etc /home /initrd.img /initrd.img.old /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /ubiquity-apt-clone /usr /var /vmlinuz /vmlinuz.old /win81-base.qcow2 /win81-base.qcow2.md5 /win81-writable-amd.qcow2 /win81-writable-nvidia.qcow2 /win81-writable-nvidia.qcow2.backup Never override ACS for legacy devices or devices with ACS caps */ + if (!pci_is_pcie(dev) || + pci_find_ext_capability(dev, PCI_EXT_CAP_ID_ACS)) + return -ENOTTY; + + for (i = 0; i &lt; max_acs_id; i++) + if (acs_on_ids[i].vendor == dev-&gt;vendor &amp;&amp; + acs_on_ids[i].device == dev-&gt;device) + return 1; + + switch (pci_pcie_type(dev)) { + case PCI_EXP_TYPE_DOWNSTREAM: + case PCI_EXP_TYPE_ROOT_PORT: + if (acs_on_downstream) + return 1; + break; + case PCI_EXP_TYPE_ENDPOINT: + case PCI_EXP_TYPE_UPSTREAM: + case PCI_EXP_TYPE_LEG_END: + case PCI_EXP_TYPE_RC_END: + if (acs_on_multifunction &amp;&amp; dev-&gt;multifunction) + return 1; + } + + return -ENOTTY; +} + + /1 /bin /boot /cdrom /dev /etc /home /initrd.img /initrd.img.old /lib /lib32 /lib64 /libx32 /lost+found /media /mnt /opt /proc /root /run /sbin /srv /sys /tmp /ubiquity-apt-clone /usr /var /vmlinuz /vmlinuz.old /win81-base.qcow2 /win81-base.qcow2.md5 /win81-writable-amd.qcow2 /win81-writable-nvidia.qcow2 /win81-writable-nvidia.qcow2.backup 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html AMD has indicated that the devices below do not support peer-to-peer 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html in any system where they are found in the southbridge with an AMD @@ -3696,6 +3798,7 @@ static const struct pci_dev_acs_enabled { PCI_VENDOR_ID_ATI, 0x4384, pci_quirk_amd_sb_acs }, { PCI_VENDOR_ID_ATI, 0x4399, pci_quirk_amd_sb_acs }, { PCI_VENDOR_ID_INTEL, PCI_ANY_ID, pci_quirk_intel_pch_acs }, + { PCI_ANY_ID, PCI_ANY_ID, pcie_acs_overrides }, { 0 } };</code></pre></div><p>the patch for kernel.spec:</p><div class="codebox"><pre class="vscroll"><code>--- kernel.spec.orig 2014-12-25 23:12:35.649583082 -0800 +++ kernel.spec 2014-12-26 01:44:27.301825643 -0800 @@ -42,7 +42,7 @@ Summary: The Linux kernel # For non-released -rc kernels, this will be appended after the rcX and # gitX tags, so a 3 here would become part of release &quot;0.rcX.gitX.3&quot; # -%global baserelease 300 +%global baserelease 301 %global fedora_build %{baserelease} # base_sublevel is the kernel version we&#039;re starting with and patching @@ -648,6 +648,9 @@ Patch26099: deal-with-deadlock-in-d_walk # git clone ssh://git.fedorahosted.org/git/kernel-arm64.git, git diff master...devel Patch30000: kernel-arm64.patch +# pcie_acs_override +Patch90000: PCIE-ACS-override.patch + # END OF PATCH DEFINITIONS %endif @@ -1412,6 +1415,9 @@ ApplyPatch arm64-fix-xgene_enet_process_ %endif %endif +# pcie_acs_override +ApplyPatch PCIE-ACS-override.patch + # END OF PATCH APPLICATIONS %endif</code></pre></div> <p class="postedit"><em>Last edited by pkim (2014-12-27 20:28:55)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488006">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488028" class="blockpost rowodd"> <h2><span><span class="conr">#3686</span> <a href="viewtopic.php?pid=1488028#p1488028">2014-12-27 20:52:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thank you guys for posting detailed descriptions!</p><p>one question for Myranti: I noticed you aren&#039;t using Virtio for your disk. Did you do that on purpose? Is it faster that way? Do you also use a spare SSD for Windows 8.1?</p> <p class="postedit"><em>Last edited by 4kGamer (2014-12-27 20:55:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488028">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488061" class="blockpost roweven"> <h2><span><span class="conr">#3687</span> <a href="viewtopic.php?pid=1488061#p1488061">2014-12-27 21:59:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87484">kainet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-22</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:bart47@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>thank you guys for posting detailed descriptions!</p><p>one question for Myranti: I noticed you aren&#039;t using Virtio for your disk. Did you do that on purpose? Is it faster that way? Do you also use a spare SSD for Windows 8.1?</p></div></blockquote></div><p>I had tested virtio and piix4-ide for me Windows shows the same 6.9 points for disk performance. I suppose the most performant way is to passthrough sata controller.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488061">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488097" class="blockpost rowodd"> <h2><span><span class="conr">#3688</span> <a href="viewtopic.php?pid=1488097#p1488097">2014-12-28 00:04:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>pkim wrote:</cite><blockquote><div><p>All,</p><p>I wanted to report my successful setup so that others may have another data point trying to do the same. I also need others to see what setup works, because before embarking on trying to do this and sinking down a significant amount of time, I didn&#039;t know whether I would succeed or not. I tried Googling my motherboard and the setup with vfio but didn&#039;t find any with my setup, so I didn&#039;t have 100% confidence that I would be able to get my system running.</p></div></blockquote></div><p>Congratulations... unfortunately I&#039;m not even sure where to start correcting your config.</p><p>a) Z97 (Lynx Point) is supported by kernel ACS quirks, so all you need to do is move your GPU to a difference slot to fix the IOMMU grouping problem, no custom kernel required.&#160; Put it behind a PCH root port slot.</p><p>b) All of your libvirt issues are self induced by using the qemu:arg options.&#160; See posts from me for reference to a wrapper script to add the x-vga=on option to the qemu-kvm invocation by libvirt.&#160; This lets libvirt manage the device, you won&#039;t need to run with elevated privileges or use the vfio-bind script (see reference to redhat instructions for how to make the wrapper script work with selinux).</p><p>c) Your config uses ioh3420 root ports on 440fx chipset.&#160; Stop it, just stop it.&#160; Move the vfio-pci options to proper hostdev options.</p><p>d) The whole xen primary graphics, stop that too.</p><p>e) libvirt supports kvm=off, why are you specifying it via qemu:args?!&#160; You&#039;ve also still got various hyper-v extensions enabled in your xml.&#160; See my blog for how to do all of this properly.</p><p>f) You&#039;re specifying a bios, stop that too.&#160; Completely unnecessary.</p><p>What can you expect to achieve by making all these changes?&#160; You don&#039;t need the i915 patch and you don&#039;t need the ACS patch, so I expect you can make this work with an unmodified kernel, qemu, and libvirt, having libvirt <strong>fully</strong> manage your VM (no vfio-bind), with just a qemu-kvm wrapper, your pci-stub.ids line, and an selinux module for the script.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488097">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488107" class="blockpost roweven"> <h2><span><span class="conr">#3689</span> <a href="viewtopic.php?pid=1488107#p1488107">2014-12-28 00:55:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>one question for Myranti: I noticed you aren&#039;t using Virtio for your disk. Did you do that on purpose? Is it faster that way? Do you also use a spare SSD for Windows 8.1?</p></div></blockquote></div><p>Good question! Probably because I didn&#039;t think of doing it, but I see there&#039;s a guide on on linux-kvm.org, so I&#039;ll try it out. It wasn&#039;t specifically on purpose, I just hadn&#039;t really considered it and now that I&#039;ve had a look, I realise I&#039;d probably need to do it after the initial install anyway.</p><p><span class="bbs">I&#039;m not sure if it&#039;s faster, but I&#039;ll do a test before the change and after to see if it has a noticeable impact.</span> Yes, I am using an SSD, not so much a spare, more of an additional drive, since this system was upgraded/built specifically for the purposes of doing this.</p><p><strong>Edit:</strong> Yes, it does appear to be faster to use virtio.</p> <p class="postedit"><em>Last edited by Myranti (2014-12-28 02:29:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488107">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488141" class="blockpost rowodd"> <h2><span><span class="conr">#3690</span> <a href="viewtopic.php?pid=1488141#p1488141">2014-12-28 07:21:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87584">pkim</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-27</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87584">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Alex,</p><p>Thanks for the good feedback -</p><div class="quotebox"><blockquote><div><p>a) Z97 (Lynx Point) is supported by kernel ACS quirks, so all you need to do is move your GPU to a difference slot to fix the IOMMU grouping problem, no custom kernel required.&#160; Put it behind a PCH root port slot.</p></div></blockquote></div><p>This is a consequence of the motherboard size, case design, power supply installed at the bottom and the fact that both Nvidia cards are double width. The motherboard has 3 16-lane PCIe slots and the two cards can only be fitted into two of them. In fact, the first thing I tried was to try to relocate one of the two cards to the 3rd slot based on your advice - not physically possible. So rather than buying another bigger case, I decided to try the ACS patch. (I would venture to guess that my situation is not unique.)</p><div class="quotebox"><blockquote><div><p>b) All of your libvirt issues are self induced by using the qemu:arg options.&#160; See posts from me for reference to a wrapper script to add the x-vga=on option to the qemu-kvm invocation by libvirt.&#160; This lets libvirt manage the device, you won&#039;t need to run with elevated privileges or use the vfio-bind script (see reference to redhat instructions for how to make the wrapper script work with selinux).</p></div></blockquote></div><p>I think I got this working using a wrapper script that you provided. But I still don&#039;t know how to do it without the vfio-bind script - are you suggesting that I do the binding inside the wrapper as well?</p><div class="quotebox"><blockquote><div><p>c) Your config uses ioh3420 root ports on 440fx chipset.&#160; Stop it, just stop it.&#160; Move the vfio-pci options to proper hostdev options.</p></div></blockquote></div><p>Ok, figured it out. Not too many examples out there. A user named &quot;teekay&quot; talked about trying it out and failing on this thread <a href="https://bbs.archlinux.org/search.php?search_id=1553485140&amp;p=3" rel="nofollow"> here</a> - but it seems to work for me.</p><div class="quotebox"><blockquote><div><p>d) The whole xen primary graphics, stop that too.</p></div></blockquote></div><p>One of your posts on your blog mentioned using qxl and disabling it so I can use it at least for the sound <a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow"> here</a>. But no matter how I tried, I just don&#039;t know how to &quot;disable&quot; the qxl video and eliminate the Code 12 error. I need this so that I can use the host sound.</p><div class="quotebox"><blockquote><div><p>e) libvirt supports kvm=off, why are you specifying it via qemu:args?!&#160; You&#039;ve also still got various hyper-v extensions enabled in your xml.&#160; See my blog for how to do all of this properly.</p></div></blockquote></div><p>I actually saw this while I was on the hunt to solve this, I remember seeing that you&#039;ve submitted it to git for inclusion like 3-months ago - I incorrectly assumed that the feature was not included in qemu 2.1.2. I was wrong. I cleaned up my xml - thanks!</p><div class="quotebox"><blockquote><div><p>f) You&#039;re specifying a bios, stop that too.&#160; Completely unnecessary.</p></div></blockquote></div><p>I didn&#039;t know that. I deleted it and it works fine without it.</p><p>Here&#039;s my latest xml, free of any qemu:args (still on xen - couldn&#039;t figure out how to use qxl):</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;win7-gaming&lt;/name&gt; &lt;uuid&gt;ed501ade-d5f1-447e-87d7-a527ba1847b5&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/libexec/qemu-kvm-nvidia-vga&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win7.qcow2&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/virtio-win-0.1-94.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:cb:a5:3b&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;xen&#039; vram=&#039;4096&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0424&#039;/&gt; &lt;product id=&#039;0x2514&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;2&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x06a3&#039;/&gt; &lt;product id=&#039;0x8021&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52b&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;4&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>By the way, I also backed out of the three settings in /etc/libvirt/qemu.conf (commented them and let libvirt use the defaults - the VM is very stable and also the sound works better now):</p><div class="codebox"><pre><code>user = &quot;root&quot; group = &quot;root&quot; clear_emulator_capabilities = 0</code></pre></div> <p class="postedit"><em>Last edited by pkim (2014-12-28 08:44:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488141">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488158" class="blockpost roweven"> <h2><span><span class="conr">#3691</span> <a href="viewtopic.php?pid=1488158#p1488158">2014-12-28 10:27:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Myranti. I wasn&#039;t so sure myself. Glad if it helped you.</p><p>And @kainet: It does make sense what you say. I wonder whether sata performance would surpass virtio. Did someone make the comparison?</p> <p class="postedit"><em>Last edited by 4kGamer (2014-12-28 12:17:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488158">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488166" class="blockpost rowodd"> <h2><span><span class="conr">#3692</span> <a href="viewtopic.php?pid=1488166#p1488166">2014-12-28 11:24:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=34610">Myranti</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2010-03-04</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=34610">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@4kGamer: Yeah, I just hadn&#039;t considered it. I ended up going with SCSI and using virito-scsi with discard=&#039;unmap&#039; so that any trim/discard is passed through.</p><p>If I was using another motherboard with additional sata controllers I could try that to see how it went, but alas!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488166">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488208" class="blockpost roweven"> <h2><span><span class="conr">#3693</span> <a href="viewtopic.php?pid=1488208#p1488208">2014-12-28 15:55:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>pkim wrote:</cite><blockquote><div><p>Alex,</p><p>Thanks for the good feedback -</p><div class="quotebox"><blockquote><div><p>a) Z97 (Lynx Point) is supported by kernel ACS quirks, so all you need to do is move your GPU to a difference slot to fix the IOMMU grouping problem, no custom kernel required.&#160; Put it behind a PCH root port slot.</p></div></blockquote></div><p>This is a consequence of the motherboard size, case design, power supply installed at the bottom and the fact that both Nvidia cards are double width. The motherboard has 3 16-lane PCIe slots and the two cards can only be fitted into two of them. In fact, the first thing I tried was to try to relocate one of the two cards to the 3rd slot based on your advice - not physically possible. So rather than buying another bigger case, I decided to try the ACS patch. (I would venture to guess that my situation is not unique.)</p></div></blockquote></div><p>Too bad, so close to being able to work unmodified.&#160; I have the same problem on my P8H67-M PRO, but I use integrated graphics for the host and my primary guest uses a dual slot GTX750 from the CPU root ports.&#160; My secondary guest uses an HD8570, single width slot off the PCH root port.&#160; In fact I&#039;ve managed to make that card fanless by cutting down a CoolVivaZ1 so that it still squeezes in above the P/S.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>b) All of your libvirt issues are self induced by using the qemu:arg options.&#160; See posts from me for reference to a wrapper script to add the x-vga=on option to the qemu-kvm invocation by libvirt.&#160; This lets libvirt manage the device, you won&#039;t need to run with elevated privileges or use the vfio-bind script (see reference to redhat instructions for how to make the wrapper script work with selinux).</p></div></blockquote></div><p>I think I got this working using a wrapper script that you provided. But I still don&#039;t know how to do it without the vfio-bind script - are you suggesting that I do the binding inside the wrapper as well?</p></div></blockquote></div><p>No, libvirt will do it for you, that&#039;s what the managed=&quot;yes&quot; option in the xml means.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>c) Your config uses ioh3420 root ports on 440fx chipset.&#160; Stop it, just stop it.&#160; Move the vfio-pci options to proper hostdev options.</p></div></blockquote></div><p>Ok, figured it out. Not too many examples out there. A user named &quot;teekay&quot; talked about trying it out and failing on this thread <a href="https://bbs.archlinux.org/search.php?search_id=1553485140&amp;p=3" rel="nofollow"> here</a> - but it seems to work for me.</p></div></blockquote></div><p>ioh3420 is a PCIe root port, so the frankenstein configuration that creates is to have a PCIe root port sourced on a conventional PCI bus.&#160; It&#039;s not something you&#039;d ever see on real hardware.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>d) The whole xen primary graphics, stop that too.</p></div></blockquote></div><p>One of your posts on your blog mentioned using qxl and disabling it so I can use it at least for the sound <a href="http://vfio.blogspot.com/2014/08/primary-graphics-assignment-without-vga.html" rel="nofollow"> here</a>. But no matter how I tried, I just don&#039;t know how to &quot;disable&quot; the qxl video and eliminate the Code 12 error. I need this so that I can use the host sound.</p></div></blockquote></div><p>Right, that qxl config is using OVMF and Win8, which is a much more amenable config for simultaneously supporting both assigned and emulated graphics.&#160; With Win7 and VGA, the VM will stop using the emulated graphics once the Nvidia driver loads due to resource conflicts of the VGA space.&#160; I don&#039;t know that that would affect audio over spice though.&#160; Theoretically libvirt can support connecting the emulated audio to your local pulseaudio server independent of the emulated graphics, but I&#039;ve never figured out how to do this.&#160; I&#039;m also suspicious whether things like Steam In-home-streaming work with anything other than the GPU audio device.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>e) libvirt supports kvm=off, why are you specifying it via qemu:args?!&#160; You&#039;ve also still got various hyper-v extensions enabled in your xml.&#160; See my blog for how to do all of this properly.</p></div></blockquote></div><p>I actually saw this while I was on the hunt to solve this, I remember seeing that you&#039;ve submitted it to git for inclusion like 3-months ago - I incorrectly assumed that the feature was not included in qemu 2.1.2. I was wrong. I cleaned up my xml - thanks!</p></div></blockquote></div><p>There&#039;s also the virt-preview repo for Fedora if you want more bleeding edge QEMU/libvirt.</p><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>f) You&#039;re specifying a bios, stop that too.&#160; Completely unnecessary.</p></div></blockquote></div><p>I didn&#039;t know that. I deleted it and it works fine without it.</p><p>Here&#039;s my latest xml, free of any qemu:args (still on xen - couldn&#039;t figure out how to use qxl):</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;win7-gaming&lt;/name&gt; &lt;uuid&gt;ed501ade-d5f1-447e-87d7-a527ba1847b5&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;custom&#039; match=&#039;exact&#039;&gt; &lt;model fallback=&#039;allow&#039;&gt;Haswell&lt;/model&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/libexec/qemu-kvm-nvidia-vga&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win7.qcow2&#039;/&gt; &lt;target dev=&#039;vdb&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x09&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;file&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/virtio-win-0.1-94.iso&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:cb:a5:3b&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;xen&#039; vram=&#039;4096&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x0424&#039;/&gt; &lt;product id=&#039;0x2514&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;2&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x06a3&#039;/&gt; &lt;product id=&#039;0x8021&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc52b&#039;/&gt; &lt;address bus=&#039;5&#039; device=&#039;4&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>By the way, I also backed out of the three settings in /etc/libvirt/qemu.conf (commented them and let libvirt use the defaults - the VM is very stable and also the sound works better now):</p><div class="codebox"><pre><code>user = &quot;root&quot; group = &quot;root&quot; clear_emulator_capabilities = 0</code></pre></div></div></blockquote></div><p>Great, that&#039;s a much cleaner config IMHO.&#160; If you wanted you could add multifunction=&quot;on&quot; to the GPU hostdev config and then you could move the assigned audio device to function 1 of the same slot.&#160; It makes the card appear to the guest more like it actually is, but I haven&#039;t found that it functionally behaves any different.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488208">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488271" class="blockpost rowodd"> <h2><span><span class="conr">#3694</span> <a href="viewtopic.php?pid=1488271#p1488271">2014-12-28 21:38:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can someone help me? I don&#039;t know how to passthrough a sata controller.</p><p>this is what lspci | gep SATA outputs:</p><div class="quotebox"><blockquote><div><p>00:1f.2 SATA controller: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode]<br />07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02)<br />09:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02)</p></div></blockquote></div><br /><p>I want to install Windows on a SATA Disk. I have to passthrough a SATA controller for that right?</p><p>First I bound the controller to vfio. But when I try to start the installation, i get this error:</p><div class="quotebox"><blockquote><div><p>Error starting domain: Requested operation is not valid: PCI device 0000:07:00.0 is not assignable</p></div></blockquote></div><br /><br /><p>This is what my XML looks like</p><div class="quotebox"><blockquote><div><p>&lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source dev=&#039;/dev/sdb&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;</p></div></blockquote></div><br /><p>I googled it, but I am lost here. Please help</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488271">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488273" class="blockpost roweven"> <h2><span><span class="conr">#3695</span> <a href="viewtopic.php?pid=1488273#p1488273">2014-12-28 21:48:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Can someone help me? I don&#039;t know how to passthrough a sata controller.</p><p>this is what lspci | gep SATA outputs:</p><div class="quotebox"><blockquote><div><p>00:1f.2 SATA controller: Intel Corporation 9 Series Chipset Family SATA Controller [AHCI Mode]<br />07:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02)<br />09:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 02)</p></div></blockquote></div><br /><p>I want to install Windows on a SATA Disk. I have to passthrough a SATA controller for that right?</p><p>First I bound the controller to vfio. But when I try to start the installation, i get this error:</p><div class="quotebox"><blockquote><div><p>Error starting domain: Requested operation is not valid: PCI device 0000:07:00.0 is not assignable</p></div></blockquote></div><br /><br /><p>This is what my XML looks like</p><div class="quotebox"><blockquote><div><p>&lt;disk type=&#039;block&#039; device=&#039;disk&#039;&gt;<br />&#160; &#160; &#160; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt;<br />&#160; &#160; &#160; &lt;source dev=&#039;/dev/sdb&#039;/&gt;<br />&#160; &#160; &#160; &lt;target dev=&#039;sda&#039; bus=&#039;sata&#039;/&gt;<br />&#160; &#160; &#160; &lt;boot order=&#039;2&#039;/&gt;<br />&#160; &#160; &#160; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt;<br />&#160; &#160; &lt;/disk&gt;</p></div></blockquote></div><br /><p>I googled it, but I am lost here. Please help</p></div></blockquote></div><p>You cannot both assign the device and attach the disk behind it using an emulated controller.&#160; One or the other.&#160; The only case where I consider assigning a SATA controller to be a valid option is if you want to boot the image both on bare metal and a VM, and even there it&#039;s questionable whether it&#039;s really an advantage.&#160; If you&#039;re doing this only for performance reasons then you haven&#039;t taken virtio tuning as far as it can go.&#160; There&#039;s very, very little performance to gain by doing this.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488273">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488279" class="blockpost rowodd"> <h2><span><span class="conr">#3696</span> <a href="viewtopic.php?pid=1488279#p1488279">2014-12-28 22:02:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thank you Alex, I won&#039;t bother with it, back to Virtio then. You&#039;re right. I am still not comfortable with virtio tuning, the documentation is great, but I still haven&#039;t had success with it. I will try again and probably have more questions for you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488283" class="blockpost roweven"> <h2><span><span class="conr">#3697</span> <a href="viewtopic.php?pid=1488283#p1488283">2014-12-28 22:14:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>thank you Alex, I won&#039;t bother with it, back to Virtio then. You&#039;re right. I am still not comfortable with virtio tuning, the documentation is great, but I still haven&#039;t had success with it. I will try again and probably have more questions for you <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p></div></blockquote></div><p>FWIW, I use this on my Steam VM:</p><div class="codebox"><pre><code> &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039; cache=&#039;none&#039; io=&#039;native&#039;/&gt; &lt;source file=&#039;/mnt/store/vm/Steam.raw&#039;/&gt; &lt;backingStore/&gt; &lt;target dev=&#039;sda&#039; bus=&#039;scsi&#039;/&gt; &lt;alias name=&#039;scsi0-0-0-0&#039;/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;0&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;scsi&#039; index=&#039;0&#039; model=&#039;virtio-scsi&#039;&gt; &lt;driver queues=&#039;4&#039;/&gt; &lt;alias name=&#039;scsi0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt;</code></pre></div><p>The raw disk image actually lives on a relatively slow spinning disk, but I use bcache to cache it across a small SSD.&#160; This setup doesn&#039;t always benchmark well, but for real world performance launching a single game, it does fantastic.</p><p>EDIT: queues=4 enables multi-queue virtio-scsi.&#160; I use 4 because that&#039;s the number of vCPUs provided to the guest.</p> <p class="postedit"><em>Last edited by aw (2014-12-28 22:16:07)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488283">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488364" class="blockpost rowodd"> <h2><span><span class="conr">#3698</span> <a href="viewtopic.php?pid=1488364#p1488364">2014-12-29 04:01:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87624">Chaohong Hu</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-29</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:huchh2012@163.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have successfully passed through graphics card using vfio. </p><p>The problem is vfio need an additional monitor connected to the graphics card to show vm,<br />but i only have one monitor(and two gfxs of course),so i am searching a solution which can<br />share the only monitor between host&#039;s gfx and vm&#039;s gfx. I mean when i launch vm the monitor<br />start to display output from passthru&#039;s card and when i shutdown vm, monitor display output from<br />host&#039;s gfx again.</p><p>Any idea about this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488364">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488390" class="blockpost roweven"> <h2><span><span class="conr">#3699</span> <a href="viewtopic.php?pid=1488390#p1488390">2014-12-29 06:42:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Alex: thank you, I will try your config!</p><br /><p>@Chao: You need some sort of switch or hub. If your GPUs both have HDMI outputs, you can use an HDMI switch. In any case a device with one output and two inputs would work.</p><p>I use an AV-R, because I use my setup with a TV. But there are other options. </p><p>Like a KVM switch&#160; (the abbreviations are coincidental). </p><p>Look here: <a href="https://www.youtube.com/watch?v=VGxzHkI8rXo" rel="nofollow">https://www.youtube.com/watch?v=VGxzHkI8rXo</a></p> <p class="postedit"><em>Last edited by 4kGamer (2014-12-29 08:09:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488390">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488408" class="blockpost rowodd"> <h2><span><span class="conr">#3700</span> <a href="viewtopic.php?pid=1488408#p1488408">2014-12-29 09:30:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87584">pkim</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-27</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87584">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><div class="quotebox"><blockquote><div><p>b) All of your libvirt issues are self induced by using the qemu:arg options.&#160; See posts from me for reference to a wrapper script to add the x-vga=on option to the qemu-kvm invocation by libvirt.&#160; This lets libvirt manage the device, you won&#039;t need to run with elevated privileges or use the vfio-bind script (see reference to redhat instructions for how to make the wrapper script work with selinux).</p></div></blockquote></div><p>I think I got this working using a wrapper script that you provided. But I still don&#039;t know how to do it without the vfio-bind script - are you suggesting that I do the binding inside the wrapper as well?</p></div></blockquote></div><p>No, libvirt will do it for you, that&#039;s what the managed=&quot;yes&quot; option in the xml means.</p></div></blockquote></div><p>Confirmed! letting libvirt to do all the managing seems to be much smoother and easier (once you figure out the correct xml configuration).</p><div class="quotebox"><blockquote><div><p>Great, that&#039;s a much cleaner config IMHO.&#160; If you wanted you could add multifunction=&quot;on&quot; to the GPU hostdev config and then you could move the assigned audio device to function 1 of the same slot.&#160; It makes the card appear to the guest more like it actually is, but I haven&#039;t found that it functionally behaves any different.</p></div></blockquote></div><p>Agreed. I&#039;ll try out the multifunction=&quot;on&quot; later just for the sake of making it cleaner.</p><p>So basically what I needed it to work is this:</p><p>Host OS: Fedora 21 (64bit, 3.17.7 kernel, CUSTOM compiled with PCIe ACS patch from Alex Williamson)<br />Guest OS: Windows 7 (64bit)<br />CPU: i7-4790K (one of the very few K versions that supports Vt-d)<br />Motherboard: Asus Sabertooth Z97 mark 1 (had to enable virtualization and Vt-d in BIOS)<br />Host GPU: Geforce 970 GTX (Nvidia&#039;s proprietary driver v346.22)<br />Guest GPU: Geforce 560Ti (Nvidia&#039;s driver v347.09)<br />System RAM: DDR3-1600 4x8GB (Crucial Ballistix Sport)<br />QEMU-KVM: 2.1.2, stock, no configuration changes.<br />Libvirt: 1.2.9, stock</p><p>And the following xml (it is possible to do everything without qemu:args! - also note that I used a wrapper script to insert the x-vga option):</p><div class="codebox"><pre class="vscroll"><code>&lt;domain type=&#039;kvm&#039;&gt; &lt;name&gt;win7-gaming&lt;/name&gt; &lt;uuid&gt;ed501ade-d5f1-447e-87d7-a527ba1847b5&lt;/uuid&gt; &lt;memory unit=&#039;KiB&#039;&gt;6291456&lt;/memory&gt; &lt;currentMemory unit=&#039;KiB&#039;&gt;6291456&lt;/currentMemory&gt; &lt;vcpu placement=&#039;static&#039;&gt;4&lt;/vcpu&gt; &lt;os&gt; &lt;type arch=&#039;x86_64&#039; machine=&#039;pc-i440fx-2.1&#039;&gt;hvm&lt;/type&gt; &lt;boot dev=&#039;hd&#039;/&gt; &lt;/os&gt; &lt;features&gt; &lt;acpi/&gt; &lt;apic/&gt; &lt;pae/&gt; &lt;kvm&gt; &lt;hidden state=&#039;on&#039;/&gt; &lt;/kvm&gt; &lt;/features&gt; &lt;cpu mode=&#039;host-model&#039;&gt; &lt;model fallback=&#039;allow&#039;/&gt; &lt;/cpu&gt; &lt;clock offset=&#039;localtime&#039;&gt; &lt;timer name=&#039;rtc&#039; tickpolicy=&#039;catchup&#039;/&gt; &lt;timer name=&#039;pit&#039; tickpolicy=&#039;delay&#039;/&gt; &lt;timer name=&#039;hpet&#039; present=&#039;no&#039;/&gt; &lt;/clock&gt; &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt; &lt;on_reboot&gt;restart&lt;/on_reboot&gt; &lt;on_crash&gt;restart&lt;/on_crash&gt; &lt;pm&gt; &lt;suspend-to-mem enabled=&#039;no&#039;/&gt; &lt;suspend-to-disk enabled=&#039;no&#039;/&gt; &lt;/pm&gt; &lt;devices&gt; &lt;emulator&gt;/usr/libexec/qemu-kvm-nvidia-vga&lt;/emulator&gt; &lt;disk type=&#039;file&#039; device=&#039;disk&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;qcow2&#039;/&gt; &lt;source file=&#039;/var/lib/libvirt/images/win7-gaming.qcow2&#039;/&gt; &lt;target dev=&#039;vdc&#039; bus=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0b&#039; function=&#039;0x0&#039;/&gt; &lt;/disk&gt; &lt;disk type=&#039;block&#039; device=&#039;cdrom&#039;&gt; &lt;driver name=&#039;qemu&#039; type=&#039;raw&#039;/&gt; &lt;target dev=&#039;hdb&#039; bus=&#039;ide&#039;/&gt; &lt;readonly/&gt; &lt;address type=&#039;drive&#039; controller=&#039;0&#039; bus=&#039;0&#039; target=&#039;0&#039; unit=&#039;1&#039;/&gt; &lt;/disk&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-ehci1&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x7&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci1&#039;&gt; &lt;master startport=&#039;0&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x0&#039; multifunction=&#039;on&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci2&#039;&gt; &lt;master startport=&#039;2&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;usb&#039; index=&#039;0&#039; model=&#039;ich9-uhci3&#039;&gt; &lt;master startport=&#039;4&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x05&#039; function=&#039;0x2&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;pci&#039; index=&#039;0&#039; model=&#039;pci-root&#039;/&gt; &lt;controller type=&#039;ide&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x01&#039; function=&#039;0x1&#039;/&gt; &lt;/controller&gt; &lt;controller type=&#039;virtio-serial&#039; index=&#039;0&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x06&#039; function=&#039;0x0&#039;/&gt; &lt;/controller&gt; &lt;interface type=&#039;network&#039;&gt; &lt;mac address=&#039;52:54:00:cb:a5:3b&#039;/&gt; &lt;source network=&#039;default&#039;/&gt; &lt;model type=&#039;virtio&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x03&#039; function=&#039;0x0&#039;/&gt; &lt;/interface&gt; &lt;serial type=&#039;pty&#039;&gt; &lt;target port=&#039;0&#039;/&gt; &lt;/serial&gt; &lt;console type=&#039;pty&#039;&gt; &lt;target type=&#039;serial&#039; port=&#039;0&#039;/&gt; &lt;/console&gt; &lt;channel type=&#039;spicevmc&#039;&gt; &lt;target type=&#039;virtio&#039; name=&#039;com.redhat.spice.0&#039;/&gt; &lt;address type=&#039;virtio-serial&#039; controller=&#039;0&#039; bus=&#039;0&#039; port=&#039;1&#039;/&gt; &lt;/channel&gt; &lt;input type=&#039;tablet&#039; bus=&#039;usb&#039;/&gt; &lt;input type=&#039;mouse&#039; bus=&#039;ps2&#039;/&gt; &lt;input type=&#039;keyboard&#039; bus=&#039;ps2&#039;/&gt; &lt;graphics type=&#039;spice&#039; autoport=&#039;yes&#039;/&gt; &lt;sound model=&#039;ich6&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x04&#039; function=&#039;0x0&#039;/&gt; &lt;/sound&gt; &lt;video&gt; &lt;model type=&#039;xen&#039; vram=&#039;4096&#039; heads=&#039;1&#039;/&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x02&#039; function=&#039;0x0&#039;/&gt; &lt;/video&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x06a3&#039;/&gt; &lt;product id=&#039;0x8021&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x0&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x08&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;pci&#039; managed=&#039;yes&#039;&gt; &lt;driver name=&#039;vfio&#039;/&gt; &lt;source&gt; &lt;address domain=&#039;0x0000&#039; bus=&#039;0x02&#039; slot=&#039;0x00&#039; function=&#039;0x1&#039;/&gt; &lt;/source&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x0a&#039; function=&#039;0x0&#039;/&gt; &lt;/hostdev&gt; &lt;hostdev mode=&#039;subsystem&#039; type=&#039;usb&#039; managed=&#039;yes&#039;&gt; &lt;source&gt; &lt;vendor id=&#039;0x046d&#039;/&gt; &lt;product id=&#039;0xc066&#039;/&gt; &lt;/source&gt; &lt;/hostdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;redirdev bus=&#039;usb&#039; type=&#039;spicevmc&#039;&gt; &lt;/redirdev&gt; &lt;memballoon model=&#039;virtio&#039;&gt; &lt;address type=&#039;pci&#039; domain=&#039;0x0000&#039; bus=&#039;0x00&#039; slot=&#039;0x07&#039; function=&#039;0x0&#039;/&gt; &lt;/memballoon&gt; &lt;/devices&gt; &lt;/domain&gt;</code></pre></div><p>/usr/libexec/qemu-kvm-nvidia-vga:</p><div class="codebox"><pre><code>#!/bin/sh exec /bin/qemu-kvm \ `echo &quot;$@&quot; | sed &#039;s|02:00.0|02:00.0,x-vga=on|g&#039;`</code></pre></div><p>Remaining problems:<br />1. Once the first VM shuts down, the subsequent booting doesn&#039;t work properly. Work-around: suspend the host OS to reset the GPU. There is an annoying problem with losing the background with the suspend/resume on the Nvidia cards. Alt-F2 then r to reset in Gnome.<br />2. I can&#039;t figure out how to pipe only the sound through spice. Work-around: use Xen for video card type.</p> <p class="postedit"><em>Last edited by pkim (2014-12-29 12:26:59)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488408">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=147">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=146">146</a> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <strong>148</strong> <a href="viewtopic.php?id=162768&amp;p=149">149</a> <a href="viewtopic.php?id=162768&amp;p=150">150</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=149">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
