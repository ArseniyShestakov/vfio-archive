<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 63) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=63" title="Page 63" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=62" title="Page 62" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=64" title="Page 64" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=62">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=61">61</a> <a href="viewtopic.php?id=162768&amp;p=62">62</a> <strong>63</strong> <a href="viewtopic.php?id=162768&amp;p=64">64</a> <a href="viewtopic.php?id=162768&amp;p=65">65</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=64">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1404251" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1551</span> <a href="viewtopic.php?pid=1404251#p1404251">2014-04-14 14:24:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=17456">FruitieX</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2008-07-03</span></dd> <dd><span>Posts: 18</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=17456">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Val532 wrote:</cite><blockquote><div><p>And i have not any problem.</p><p>Qemu 2.0.0-RC2 + original kernel 3.14 from kernel.org + i915, acs (and other litle patch on KVM side but without it, it works the same).</p></div></blockquote></div><p>Strange. I tried compiling the 3.14 kernel with the i915 and acs patches from the first post but am still having this issue. I&#039;m using qemu from latest git.</p><p>I investigated this a bit more and found that this error message is generated when I have both compiled my kernel with pre-emption on and am using the hv-time qemu cpu flag. You didn&#039;t happen to change the kernel configuration from the one in the first post?</p><p>FruitieX</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404251">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404323" class="blockpost roweven"> <h2><span><span class="conr">#1552</span> <a href="viewtopic.php?pid=1404323#p1404323">2014-04-14 16:20:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81197">scoobydog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-14</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81197">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Torello wrote:</cite><blockquote><div><p>Hello,<br />Finally, vga-passthrough work. ( Using kernel with debug registers patch, qemu and seabios from first post ).<br />But I have a strange issue, which makes keyboard and mouse in guest os - unusable.</p><p>My specs: <br />Core i7 4771, GA-Z87X-OC , Radeon 6950@6970 for guest and integrated intel video for host.<br />Keyboard Microsoft Natural 4000 ( usb ), mouse Logitech Mx510 ( usb ).</p><p>My startup script is:<br />qemu-system-x86_64 -enable-kvm -M q35 -m 16384 -cpu host \<br />-smp 4,sockets=1,cores=4,threads=1 \<br />-vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-drive file=/home/torello/virt_images/windows7.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \<br />-drive file=/home/torello/distr/win7_msdn.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \<br />-boot menu=on</p><p>If I boot vm without &quot;-vga none&quot;.<br />I can switch to qemu window, and it grabs my keyboard and mouse input.</p><p>If I boot with &quot;-vga none&quot;, I can&#039;t use keyboard in guest at all, and with my mouse I can do some operations like scrolling the window using the thumb, or change window place ( using mouse ), but If I want to click a button I must click 20-30 times, trying different corners, before I was able to press any onscreen button.</p><p>Do you have any suggestions, how I can debug/solve that issue?</p></div></blockquote></div><p>Use a dummy console with -vga none -device qxl </p><p>So you don&#039;t need to passthru USB devices for testings.</p><p>Scoobydog</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404323">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404331" class="blockpost rowodd"> <h2><span><span class="conr">#1553</span> <a href="viewtopic.php?pid=1404331#p1404331">2014-04-14 16:42:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80773">Torello</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-01</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80773">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>novist wrote:</cite><blockquote><div><p>@Torello: pass-through usb ports too.</p></div></blockquote></div><p>Thanks, but I want to use one keyboard and mouse on my system. I have already done that with some old version of qemu.</p><div class="quotebox"><cite>scoobydog wrote:</cite><blockquote><div><p>@Torello: Use a dummy console with -vga none -device qxl<br />So you don&#039;t need to passthru USB devices for testings.<br />Scoobydog</p></div></blockquote></div><p>Thanks! That&#039;s exactly what I need, now mouse and keyboard fully functional. Hurray!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404331">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404347" class="blockpost roweven"> <h2><span><span class="conr">#1554</span> <a href="viewtopic.php?pid=1404347#p1404347">2014-04-14 17:14:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80088">pereczes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>after my precious time went wasted with a crap PowerColor card, that turned out to be faulty (lot of freezes also before with opencl/darktable), received my GTX TI 750, works like charm on the guest with nvidia drivers! finally an old dream became true... can do photography on virtual machine with dedicated graphic card!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404347">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404370" class="blockpost rowodd"> <h2><span><span class="conr">#1555</span> <a href="viewtopic.php?pid=1404370#p1404370">2014-04-14 18:36:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80773">Torello</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-01</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80773">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now there is only one problem left - how to pass my 2tb gpt disk to qemu?<br />If I use that command:<br />-drive file=/dev/sdc2,id=diske,format=raw -device ide-hd,bus=ide.2,drive=diske<br />I got 5 or 6 partitions in windows disk manager( but actually there is only one partition ).<br />That&#039;s how I see my disk using lsblk -f</p><p>sdc&#160; &#160; promise_fasttrack_raid_member&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />├─sdc1 promise_fasttrack_raid_member&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />└─sdc2 ntfs&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 2 Tb</p><p>If I mount sdc2 under linux, using ntfs-3g, all works fine.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404370">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404406" class="blockpost roweven"> <h2><span><span class="conr">#1556</span> <a href="viewtopic.php?pid=1404406#p1404406">2014-04-14 20:19:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81197">scoobydog</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-14</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81197">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Torello wrote:</cite><blockquote><div><p>Now there is only one problem left - how to pass my 2tb gpt disk to qemu?<br />If I use that command:<br />-drive file=/dev/sdc2,id=diske,format=raw -device ide-hd,bus=ide.2,drive=diske<br />I got 5 or 6 partitions in windows disk manager( but actually there is only one partition ).<br />That&#039;s how I see my disk using lsblk -f</p><p>sdc&#160; &#160; promise_fasttrack_raid_member&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />├─sdc1 promise_fasttrack_raid_member&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; <br />└─sdc2 ntfs&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 2 Tb</p><p>If I mount sdc2 under linux, using ntfs-3g, all works fine.</p></div></blockquote></div><p>The sdc2 is a patition, in your gast PC it&#039;s a HDD with Partition Table, the best way is to use LVM oder Image Files, not single Partions.</p><p>User -- qemu-img crate -f raw fileneme.img sizeG -- to create a new file in the filesystem, but keep in mind, ntfs mountet to Linux is very slow.</p><p>ScoobyDog</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404406">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404449" class="blockpost rowodd"> <h2><span><span class="conr">#1557</span> <a href="viewtopic.php?pid=1404449#p1404449">2014-04-14 22:13:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=17456">FruitieX</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2008-07-03</span></dd> <dd><span>Posts: 18</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=17456">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><p><a href="https://bugzilla.kernel.org/show_bug.cgi?id=73721" rel="nofollow">https://bugzilla.kernel.org/show_bug.cgi?id=73721</a><br />Still waiting for an answer.</p></div></blockquote></div><p>Okay I managed to restore VM performance to what it was on 3.13. As a temporary fix to get rid of the dmesg spam, here&#039;s a very ugly hack (the warning is probably there for a reason):</p><p>Just comment out the line that generates these warnings, in the kernel source file arch/x86/kvm/x86.c, line 1120:</p><p>Change:</p><div class="codebox"><pre><code> WARN_ON(preemptible());</code></pre></div><p>into:</p><div class="codebox"><pre><code> //WARN_ON(preemptible());</code></pre></div><p>and recompile your kernel.</p><p>Now the dmesg spam is gone, but I found performance is still terrible especially in the VM, but I noticed it&#039;s not as good as it used to be in the host OS either. Turns out that for some reason, even though I used the default &quot;powersave&quot; governor in both kernels, in 3.14 the governor would actually *do* something and thus my CPU frequencies were crazy low all the time. (in 3.13 the CPU frequency was maxed out all the time)</p><p>To fix this I set the default governor to &quot;performance&quot; in /etc/default/cpupower, and enabled the cpupower systemd service. (install the cpupower package first!) Now my VM performance is as good as on 3.13!</p><p>Hope this helps!<br />FruitieX</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404449">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1404491" class="blockpost roweven"> <h2><span><span class="conr">#1558</span> <a href="viewtopic.php?pid=1404491#p1404491">2014-04-15 00:02:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80933">Cubex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-06</span></dd> <dd><span>Posts: 24</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:cubexed@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Those who have problems with keyboard missing key press/releases and similiar, try:</p><p> -usbdevice mouse -usbdevice keyboard</p><p>This worked as good as passing usb device, with the advantage that I can release/grab anytime</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1404491">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405046" class="blockpost rowodd"> <h2><span><span class="conr">#1559</span> <a href="viewtopic.php?pid=1405046#p1405046">2014-04-16 03:06:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Can this work with the current stable arch kernel (3.14.0-5-ARCH) without recompiling it?</p><p>Those are it&#039;s default settings</p><div class="codebox"><pre><code>$ zcat /proc/config.gz | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y $ zcat /proc/config.gz | grep STUB CONFIG_EFI_STUB=y CONFIG_PCI_STUB=m</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405046">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405063" class="blockpost roweven"> <h2><span><span class="conr">#1560</span> <a href="viewtopic.php?pid=1405063#p1405063">2014-04-16 03:57:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>Can this work with the current stable arch kernel (3.14.0-5-ARCH) without recompiling it?</p><p>Those are it&#039;s default settings</p><div class="codebox"><pre><code>$ zcat /proc/config.gz | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y $ zcat /proc/config.gz | grep STUB CONFIG_EFI_STUB=y CONFIG_PCI_STUB=m</code></pre></div></div></blockquote></div><p>Depends on your hardware, if you&#039;re planning on using the intel IGP then no</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405063">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405092" class="blockpost rowodd"> <h2><span><span class="conr">#1561</span> <a href="viewtopic.php?pid=1405092#p1405092">2014-04-16 06:58:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405092">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405233" class="blockpost roweven"> <h2><span><span class="conr">#1562</span> <a href="viewtopic.php?pid=1405233#p1405233">2014-04-16 14:46:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80990">Eb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-08</span></dd> <dd><span>Posts: 11</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=80990">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Have you tried swapping card to check if you get the same result? Have you tried to passthrough only the gpu without the audio device?</p></div></blockquote></div><p>I&#039;ve removed the audio device, and it works! Been playing around with it for a few hours and no issues! Thanks a bunch.</p><p>I really appreciate all the help everyone has given me, keep being cool guys. =]</p> <p class="postedit"><em>Last edited by Eb (2014-04-16 14:46:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405233">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405316" class="blockpost rowodd"> <h2><span><span class="conr">#1563</span> <a href="viewtopic.php?pid=1405316#p1405316">2014-04-16 17:27:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p></div></blockquote></div><p>Yeah that will work, though you&#039;ll need to patch the nvidia drivers</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405316">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405331" class="blockpost roweven"> <h2><span><span class="conr">#1564</span> <a href="viewtopic.php?pid=1405331#p1405331">2014-04-16 17:46:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p></div></blockquote></div><p>Yeah that will work, though you&#039;ll need to patch the nvidia drivers</p></div></blockquote></div><p>Or use that other unsupported method, if you can. Yes, I&#039;m talking about UEFI boot/efifb.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405331">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405659" class="blockpost rowodd"> <h2><span><span class="conr">#1565</span> <a href="viewtopic.php?pid=1405659#p1405659">2014-04-17 15:32:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80088">pereczes</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-08</span></dd> <dd><span>Posts: 14</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p></div></blockquote></div><p>Yeah that will work, though you&#039;ll need to patch the nvidia drivers</p></div></blockquote></div><p>Or use that other unsupported method, if you can. Yes, I&#039;m talking about UEFI boot/efifb.</p></div></blockquote></div><br /><p>donno if helps, as stated before for me GTX 750 works on guest (windows + original nvidia driver) and with GeForce 7900 on host (nouveau)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1405986" class="blockpost roweven"> <h2><span><span class="conr">#1566</span> <a href="viewtopic.php?pid=1405986#p1405986">2014-04-18 11:24:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi All,</p><p>I&#039;m using Vanilla packages and found I can always start a VM with a Geforce 620 in VFIO pass through but never restart it, the VM looks to have restarted on the host but no display appears. Libvirt gave stability while running the VM but did not help with the restart problem. Any ideas or do I have to run a custom kernel / packages? </p><p>Hardware:<br />Opteron 4256EE<br />Asus KCMR-D12</p><p>Software:<br />Kernel 3.14.0-4-ARCH<br />Qemu V1.7.0</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1405986">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406109" class="blockpost rowodd"> <h2><span><span class="conr">#1567</span> <a href="viewtopic.php?pid=1406109#p1406109">2014-04-18 16:45:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Krobar wrote:</cite><blockquote><div><p>Hi All,</p><p>I&#039;m using Vanilla packages and found I can always start a VM with a Geforce 620 in VFIO pass through but never restart it, the VM looks to have restarted on the host but no display appears. Libvirt gave stability while running the VM but did not help with the restart problem. Any ideas or do I have to run a custom kernel / packages? </p><p>Hardware:<br />Opteron 4256EE<br />Asus KCMR-D12</p><p>Software:<br />Kernel 3.14.0-4-ARCH<br />Qemu V1.7.0</p></div></blockquote></div><p>You need qemu =&gt;2.0 or qemu-git</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406109">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406143" class="blockpost roweven"> <h2><span><span class="conr">#1568</span> <a href="viewtopic.php?pid=1406143#p1406143">2014-04-18 18:39:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72341">spam</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve been trying adding acs to my config but still had no luck my guest works only as a basic video card, I get a code 43 in windows. I am gonna try a linux guest to get traces. When I try to load a vbios with the romfile option my guest has no outputs at all. Is someone has an idea of what else could I try ? My gtx 660 is not UEFI compatible and I start my computer in UEFI mode, could it be a problem ?</p> <p class="postedit"><em>Last edited by spam (2014-04-18 18:40:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406143">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406379" class="blockpost rowodd"> <h2><span><span class="conr">#1569</span> <a href="viewtopic.php?pid=1406379#p1406379">2014-04-19 11:40:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Krobar wrote:</cite><blockquote><div><p>Hi All,</p><p>I&#039;m using Vanilla packages and found I can always start a VM with a Geforce 620 in VFIO pass through but never restart it, the VM looks to have restarted on the host but no display appears. Libvirt gave stability while running the VM but did not help with the restart problem. Any ideas or do I have to run a custom kernel / packages? </p><p>Hardware:<br />Opteron 4256EE<br />Asus KCMR-D12</p><p>Software:<br />Kernel 3.14.0-4-ARCH<br />Qemu V1.7.0</p></div></blockquote></div><p>You need qemu =&gt;2.0 or qemu-git</p></div></blockquote></div><p>Thanks for the reply. I enabled the testing repo and now have this QEMU version:</p><p>pacman -Q qemu<br />qemu 2.0.0-2<br />qemu-x86_64 -version<br />qemu-x86_64 version 2.0.0, Copyright (c) 2003-2008 Fabrice Bellard</p><p>I&#039;m still having the same problem though. VM destroy and create again or reboot of the VM means no display. Its strange because otherwise it works well, XBMC Gotham is running with HD video decode and HDMI audio passthrough.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406379">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406610" class="blockpost roweven"> <h2><span><span class="conr">#1570</span> <a href="viewtopic.php?pid=1406610#p1406610">2014-04-19 19:18:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p></div></blockquote></div><p>Yeah that will work, though you&#039;ll need to patch the nvidia drivers</p></div></blockquote></div><p>Cool! patching the drivers is a lot less of a pain than patching the kernel i think, since I would need to reconfigure the kernel every time i update it but with nvidia drivers i can always just patch them again. I may want to start by trying what pereczes said and just use noveau on the linux host at first. I guess this means I&#039;ll give this whole thing a third attempt pretty soon <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Did anyone try asking around on the <a href="https://forums.geforce.com/default/board/33/geforce-drivers/" rel="nofollow">nvidia forums</a> yet?</p> <p class="postedit"><em>Last edited by rabcor (2014-04-19 19:25:34)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406610">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406614" class="blockpost rowodd"> <h2><span><span class="conr">#1571</span> <a href="viewtopic.php?pid=1406614#p1406614">2014-04-19 19:28:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>What about Nvidia GTX-670(VM) and Nvidia GTX-550-Ti(Host)?</p></div></blockquote></div><p>Yeah that will work, though you&#039;ll need to patch the nvidia drivers</p></div></blockquote></div><p>Cool! patching the drivers is a lot less of a pain than patching the kernel i think, since I would need to reconfigure the kernel every time i update it but with nvidia drivers i can always just patch them again. I may want to start by trying what pereczes said and just use noveau on the linux host at first. I guess this means I&#039;ll give this whole thing a third attempt pretty soon <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>Did anyone try asking around on the <a href="https://forums.geforce.com/default/board/33/geforce-drivers/" rel="nofollow">nvidia forums</a> yet?</p></div></blockquote></div><p>There&#039;s a thread on there asking about the inclusion of the patch: <a href="https://devtalk.nvidia.com/default/topic/545560/linux/vfio-vga-arbitration-lock/" rel="nofollow">https://devtalk.nvidia.com/default/topi … tion-lock/</a></p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406614">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406628" class="blockpost roweven"> <h2><span><span class="conr">#1572</span> <a href="viewtopic.php?pid=1406628#p1406628">2014-04-19 20:13:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78033">dismuter</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-27</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I&#039;m trying to get VGA passthrough working on the following setup:<br />- Asus Q87 motherboard<br />- Intel Core i7 4771<br />- For host: Intel HD <br />- For guest: AMD Radeon 7770 OR NVIDIA GeForce GTX 660 (not both, whichever I can get to work first)</p><p>IOMMU is enabled through kernel switch.<br />I disabled all the modules which would interfere with guest graphics cards (radeon, nouveau, nvidia)<br />I did the vfio-bind.</p><p>Here&#039;s my command line:</p><div class="codebox"><pre><code>qemu-kvm \ -machine pc-q35-2.0 -enable-kvm -cpu host -m 4096 \ -smp 2,sockets=1,cores=2,threads=2 \ -bios /usr/share/qemu/bios.bin -vga none -display none \ -usb -usbdevice host:046d:c52b \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device virtio-scsi-pci,id=scsi0,bus=pcie.0,addr=0x3 \ -drive file=/var/lib/libvirt/images/vm.img,if=none,id=drive-scsi0-0-0-0,format=raw,discard=unmap,aio=threads \ -device scsi-hd,bus=scsi0.0,channel=0,scsi-id=0,lun=0,drive=drive-scsi0-0-0-0,id=scsi0-0-0-0 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1</code></pre></div><p>(-display none is because there is no X server; otherwise I get &quot;Gtk-WARNING **: cannot open display&quot;)</p><p>Results:<br />- Radeon on guest guests monitor out of standby, displays fine until guest drivers are loaded under Windows<br /><span class="bbs">- GeForce throttles fan, but monitor stays in standby, nothing gets displayed</span> (see edit)</p><p>On the software side, I&#039;m running Fedora 20 with kernel 3.15-rc1 (from rawhide) and qemu 2.0.<br />The kernel was compiled with the following config:</p><div class="codebox"><pre><code>CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y</code></pre></div><br /><p>I read that those versions contained sufficient logic for getting this to work. But is that really the case, do they require any patch, must I go through recompiling them?<br />Does using the integrated graphics for the host have any influence?<br />What am I missing?</p><p>Thanks for any help</p><br /><p><span style="color: #FF0000"><strong>EDIT:</strong></span> I got the NVIDIA card working completely apparently by blacklisting i915.<br />I can even use libvirt by adding this:</p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on&#039;/&gt; &lt;qemu:arg value=&#039;-device&#039;/&gt; &lt;qemu:arg value=&#039;vfio-pci,host=01:00.1,bus=root.1,addr=00.1&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>Replace &quot;01:00.x&quot; with your output from lspci:</p><div class="quotebox"><blockquote><div><p><strong>01:00.0</strong> VGA compatible controller: NVIDIA Corporation GK106 [GeForce GTX 660] (rev a1)<br /><strong>01:00.1</strong> Audio device: NVIDIA Corporation GK106 HDMI Audio Controller (rev a1)</p></div></blockquote></div><p>(for those interested, don&#039;t forget to add the namespace at the beginning of the domain xml: &lt;domain type=&#039;kvm&#039; <strong>xmlns:qemu=&#039;http://libvirt.org/schemas/domain/qemu/1.0&#039;</strong>&gt;)<br />I did also face this error:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64: -device vfio-pci,host=01:00.0,bus=pcie.0,addr=07.0,multifunction=on,x-vga=on: vfio: error opening /dev/vfio/1: Operation not permitted</p></div></blockquote></div><p>and fixed it by adding /dev/vfio/1 to cgroup_device_acl in /etc/libvirt/qemu.conf, setting both user and group to &quot;root&quot; and clear_emulator_capabilities to 0</p><p><span style="color: #FF0000"><strong>EDIT 2:</strong></span> Well, thanks to <a href="https://bbs.archlinux.org/viewtopic.php?pid=1370238#p1370238" rel="nofollow">this post from MacCoaster</a>, who had a similar configuration (Intel Haswell + Asus MB + R7770), I added the following to the kernel command line:</p><div class="quotebox"><blockquote><div><p>vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 nohz=off</p></div></blockquote></div><p>I don&#039;t know which of these got it working with the Radeon HD 7770, but it seems quite stable, I can even run the latest 3D Mark smoothly (BSOD with the NVIDIA, but I should try with the new kernel command line).</p> <p class="postedit"><em>Last edited by dismuter (2014-04-20 01:01:58)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406628">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406701" class="blockpost rowodd"> <h2><span><span class="conr">#1573</span> <a href="viewtopic.php?pid=1406701#p1406701">2014-04-20 01:09:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dismuter, does your VM reboot OK? I had to disable an Intel HDMI Audio driver to get my GF620 to passthrough, might be related to I915.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406701">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1406704" class="blockpost roweven"> <h2><span><span class="conr">#1574</span> <a href="viewtopic.php?pid=1406704#p1406704">2014-04-20 01:27:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78033">dismuter</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-27</span></dd> <dd><span>Posts: 4</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78033">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Krobar wrote:</cite><blockquote><div><p>Dismuter, does your VM reboot OK? I had to disable an Intel HDMI Audio driver to get my GF620 to passthrough, might be related to I915.</p></div></blockquote></div><p>Both with the Radeon and the GeForce, it reboots without any problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1406704">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407116" class="blockpost rowodd"> <h2><span><span class="conr">#1575</span> <a href="viewtopic.php?pid=1407116#p1407116">2014-04-21 08:58:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Anyone know if VFIO can be used with SR-IOV/VNICs? Have an Intel 1000ET dual card and it looks like Intel Virtual Function NICs might be easier to setup in Arch than a bridge.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407116">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=62">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=61">61</a> <a href="viewtopic.php?id=162768&amp;p=62">62</a> <strong>63</strong> <a href="viewtopic.php?id=162768&amp;p=64">64</a> <a href="viewtopic.php?id=162768&amp;p=65">65</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=64">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
