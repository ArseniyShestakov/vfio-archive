<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 64) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=64" title="Page 64" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=63" title="Page 63" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=65" title="Page 65" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=63">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=62">62</a> <a href="viewtopic.php?id=162768&amp;p=63">63</a> <strong>64</strong> <a href="viewtopic.php?id=162768&amp;p=65">65</a> <a href="viewtopic.php?id=162768&amp;p=66">66</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=65">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1407128" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1576</span> <a href="viewtopic.php?pid=1407128#p1407128">2014-04-21 10:16:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81417">PunisherHD</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-21</span></dd> <dd><span>Posts: 1</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,<br />I&#039;m trying to passthrough my Nvidia GTX 760 card to Windows 7 KVM guest.<br />I got through all steps in the first post and now I have Windows 7 booting and displaying on my monitor, but nvidia driver says &quot;error code 43&quot;.<br />Everything else works fine (USB, Sata drives ...), only the Nvidia driver has problem.</p><p>I&#039;m using ArchLinux, kernel 3.14 from OP, Qemu 2.0.0 from &quot;testing&quot; repository.</p><p>HW setup:<br />ASUS H81I-Plus<br />Core i5 4670<br />Geforce GTX 760</p><p>Qemu command line:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 \<br />&#160; -enable-kvm \<br />&#160; -M q35 \<br />&#160; -m 4096 \<br />&#160; -cpu host \<br />&#160; -smp 2,sockets=1,cores=2,threads=1 \<br />&#160; -bios /usr/share/qemu/bios.bin \<br />&#160; -vga none \<br />&#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />&#160; -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />&#160; -device ahci,bus=pcie.0,id=ahci \<br />&#160; -drive file=/dev/sda,id=disk1,format=raw -device ide-hd,bus=ahci.0,drive=disk1 \<br />&#160; -drive file=/dev/sdc,id=disk2,format=raw -device ide-hd,bus=ahci.1,drive=disk2 \<br />&#160; -device vfio-pci,host=00:14.0,bus=pcie.0 \<br />&#160; -device vfio-pci,host=00:1a.0,bus=pcie.0</p></div></blockquote></div><p>I tried to rebuild Qemu 2.0.0 adding this patch: <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a> but no luck, still code 43.</p><p>Any hint to solve this mysterious code 43 ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407128">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407132" class="blockpost roweven"> <h2><span><span class="conr">#1577</span> <a href="viewtopic.php?pid=1407132#p1407132">2014-04-21 10:35:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81112">Krobar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-12</span></dd> <dd><span>Posts: 17</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:rob@ledeng.demon.co.uk">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PunisherHD wrote:</cite><blockquote><div><p>Hello,<br />I&#039;m trying to passthrough my Nvidia GTX 760 card to Windows 7 KVM guest.<br />I got through all steps in the first post and now I have Windows 7 booting and displaying on my monitor, but nvidia driver says &quot;error code 43&quot;.<br />Everything else works fine (USB, Sata drives ...), only the Nvidia driver has problem.</p><p>I&#039;m using ArchLinux, kernel 3.14 from OP, Qemu 2.0.0 from &quot;testing&quot; repository.</p><p>HW setup:<br />ASUS H81I-Plus<br />Core i5 4670<br />Geforce GTX 760</p><p>Qemu command line:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 \<br />&#160; -enable-kvm \<br />&#160; -M q35 \<br />&#160; -m 4096 \<br />&#160; -cpu host \<br />&#160; -smp 2,sockets=1,cores=2,threads=1 \<br />&#160; -bios /usr/share/qemu/bios.bin \<br />&#160; -vga none \<br />&#160; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />&#160; -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />&#160; -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />&#160; -device ahci,bus=pcie.0,id=ahci \<br />&#160; -drive file=/dev/sda,id=disk1,format=raw -device ide-hd,bus=ahci.0,drive=disk1 \<br />&#160; -drive file=/dev/sdc,id=disk2,format=raw -device ide-hd,bus=ahci.1,drive=disk2 \<br />&#160; -device vfio-pci,host=00:14.0,bus=pcie.0 \<br />&#160; -device vfio-pci,host=00:1a.0,bus=pcie.0</p></div></blockquote></div><p>I tried to rebuild Qemu 2.0.0 adding this patch: <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a> but no luck, still code 43.</p><p>Any hint to solve this mysterious code 43 ?</p></div></blockquote></div><br /><p>Have you tried these tweaks?</p><div class="quotebox"><blockquote><div><p>EDIT 2: Well, thanks to this post from MacCoaster, who had a similar configuration (Intel Haswell + Asus MB + R7770), I added the following to the kernel command line:</p><br /><br /><br /><p>vfio_iommu_type1.allow_unsafe_interrupts=1 kvm_intel.emulate_invalid_guest_state=0 nohz=off</p><p>I don&#039;t know which of these got it working with the Radeon HD 7770, but it seems quite stable, I can even run the latest 3D Mark smoothly (BSOD with the NVIDIA, but I should try with the new kernel command line).</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407132">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407135" class="blockpost rowodd"> <h2><span><span class="conr">#1578</span> <a href="viewtopic.php?pid=1407135#p1407135">2014-04-21 10:51:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72341">spam</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I have been abble to make some tries, with an Ubuntu host I had hda-codec errors but gfx was working both with nouveau and nvidia default configuration. I tried to disable i915 module and any sound module yet I still got code 43 under windows. Do you believe I&#039;ll had better luck with an AMD card ?&#160; Is there a way to do pci-assign with kvm and a GTX 660 ? </p><p>Btw, i did not test nohz=off.</p><p>My last attempt was with</p><div class="codebox"><pre><code>$ cat /etc/modprobe.d/alsa-base.conf /etc/modprobe.d/blacklist-ath_pci.conf /etc/modprobe.d/blacklist.conf /etc/modprobe.d/blacklist-firewire.conf /etc/modprobe.d/blacklist-framebuffer.conf /etc/modprobe.d/blacklist-gpu.conf /etc/modprobe.d/blacklist-modem.conf /etc/modprobe.d/blacklist-oss.conf /etc/modprobe.d/blacklist-rare-network.conf /etc/modprobe.d/blacklist-watchdog.conf /etc/modprobe.d/dkms.conf /etc/modprobe.d/fbdev-blacklist.conf /etc/modprobe.d/iwlwifi.conf /etc/modprobe.d/mlx4.conf /etc/modprobe.d/modprobe.conf /etc/modprobe.d/pci-stub.conf /etc/modprobe.d/qemu-system-x86.conf /etc/modprobe.d/vfio_iommu_type1.conf /etc/modprobe.d/vmwgfx-fbdev.conf blacklist nouveau blacklist nvidia blacklist i915 blacklist snd blacklist snd_hda_intel blacklist snd_hda_codec_realtek blacklist snd_hda_codec_generic blacklist snd_hda_intel blacklist snd_hda_codec blacklist snd_hwdep blacklist snd_pcm blacklist snd_timer blacklist snd blacklist soundcore #options kvm ignore_msrs=1 options kvm_intel emulate_invalid_guest_state=0 options pci-stub ids=10de:11c0,10de:0e0b options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><div class="codebox"><pre><code>$ cat /proc/cmdline BOOT_IMAGE=/boot/vmlinuz-linux-mainline root=UUID=0f8e3d34-5e38-4276-969f-c64aaf7f3245 rw quiet intel_iommu=on pci-stub.ids=10de:11c0,10de:0e0b</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407135">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407198" class="blockpost roweven"> <h2><span><span class="conr">#1579</span> <a href="viewtopic.php?pid=1407198#p1407198">2014-04-21 14:23:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Krobar wrote:</cite><blockquote><div><p>Anyone know if VFIO can be used with SR-IOV/VNICs? Have an Intel 1000ET dual card and it looks like Intel Virtual Function NICs might be easier to setup in Arch than a bridge.</p></div></blockquote></div><p>Yes</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407198">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407429" class="blockpost rowodd"> <h2><span><span class="conr">#1580</span> <a href="viewtopic.php?pid=1407429#p1407429">2014-04-22 05:45:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78023">doubledr</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-26</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, is there any kernel option to active ACS patch v2? Right now I applied the patch but it is not activated. My PCH ports are still stucked in a big group...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407429">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407464" class="blockpost roweven"> <h2><span><span class="conr">#1581</span> <a href="viewtopic.php?pid=1407464#p1407464">2014-04-22 08:27:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80234">shweng</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-13</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:shweng@163.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello nbhs and all,<br />I have tried serval days to pass-through my Nvidia GT640 and AMD HD7750 GPU to Windows7 KVM guest but with no succeed.<br />I followed all steps in the first post and now I could pass-through GPU device to Windows 7 VM but still has the follow issues.<br />1.VM with AMD HD7750 GPU, win7 start up BSOD with 0x00000116 on atikmpag.sys<br />&#160; &#160; same as ilya80 post at <a href="https://bbs.archlinux.org/viewtopic.php?pid=1351243,but" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?pid=1351243,but</a> the solution of change &quot;clear_emulator_capabilities = 0&quot; on qemu.conf take no effect.<br />2.VM with Nvidia GT640 GPU, both vm and host hangup when vm OS booting to the twinkling mircorsoft windows logo. <br />3.there is no display on Qemu&#039;s Window,need to connect pass-throughed GPU&#039;s DVI port to display VM desktop.<br />for issue 1 and 2,enter VM on &quot;Safe Mode&quot; will be OK, but without graphics driver thus no hardware acceleration.<br />could you please help me to check my issue.<br />Hardware:<br />CPU:Intel Core i5-3470<br />MB:Gigabyte Z77P-D3, BIOS F7 08/24/2012 (VT-d enabled in BIOS)<br />RAM:4GB<br />Host:Intel HD IGP<br />Guest nVidia GeForce GT 640 or AMD RADEON HD7750<br />&#160; <br />On the software side, I&#039;m running Fedora 20 with kernel 3.14.1 which apply the patchset of linux-mainline.tar.gz except kernel-38-gcc48-2.patch <br />fix_reading_of_DR6.patch and debug_registers.patch<br />The kernel was compiled with the following config:&#160; <br />CONFIG_VFIO_IOMMU_TYPE1=y<br />CONFIG_VFIO=y<br />CONFIG_VFIO_PCI=y<br />CONFIG_VFIO_PCI_VGA=y</p><p>IOMMU is enabled through kernel switch.<br />disabled all the modules which would interfere with guest graphics cards (radeon, nouveau, nvidia,fglrx)<br />latest qemu:qemu-2.0.0-1(also tried NoSnoop patch from <a href="http://lists.nongnu.org/archive/html/qemu-devel/2013-10/msg00597.html" rel="nofollow">http://lists.nongnu.org/archive/html/qe … 00597.html</a> but no effect)<br />latest seabios:seabios-1.7.4-5</p><p>GPU<br />[root@localhost home]# lspci |grep VGA<br />00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v2/3rd Gen Core processor Graphics Controller (rev 09)<br />01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cape Verde PRO [Radeon HD 7750]<br />06:00.0 VGA compatible controller: NVIDIA Corporation GK107 [GeForce GT 640] (rev a1)</p><p>kernel param<br />[root@localhost home]# cat /proc/cmdline<br />BOOT_IMAGE=/vmlinuz-3.14.1 root=/dev/mapper/fedora-root ro rd.lvm.lv=fedora/swap vconsole.font=latarcyrheb-sun16 rd.lvm.lv=fedora/root rhgb quiet intel_iommu=on pcie_acs_override=downstream vfio_iommu_type1.allow_unsafe_interrupts=1 LANG=en_US.UTF-8</p><p>update initramfs<br />/etc/modprobe.d/<br />[root@localhost modprobe.d]# cat blacklist.conf<br />blacklist radeon<br />blacklist redeonhd<br />blacklist nvidia<br />blacklist nouveau<br />blacklist fglrx<br />[root@localhost modprobe.d]# cat vfio_iommu_type1.conf<br />options vfio_iommu_type1 allow_unsafe_interrupts=1</p><p>[root@localhost modprobe.d]#dracut -f -v /boot/initramfs-$(uname -r).img $(uname -r) </p><p>qemu command:<br />qemu-system-x86_64 -enable-kvm -M q35 -m 1024 -cpu host \<br />-smp 1,sockets=1,cores=1,threads=1 \<br />-bios /usr/share/qemu/bios.bin \<br />-vga none \<br />-drive file=/home/images/nv.qcow2,id=disk,format=qcow2 -device ide-hd,bus=ide.0,drive=disk \<br />-drive file=/ISO/win7.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd -boot order=cd,menu=on \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; \<br />-device vfio-pci,host=06:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=06:00.1,bus=root.1,addr=00.1 \<br />-usbdevice tablet<br />(host=01:00.0 for AMD gpu).<br />(host=06:00.0 for Nvidia gpu).</p><p>dmesg:<br />[root@localhost modprobe.d]# dmesg |grep IOMMU<br />[&#160; &#160; 0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA<br />[&#160; &#160; 0.000000] Intel-IOMMU: enabled<br />[&#160; &#160; 0.018151] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a<br />[&#160; &#160; 0.018155] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a<br />[&#160; &#160; 0.018226] IOAPIC id 2 under DRHD base&#160; 0xfed91000 IOMMU 1<br />[&#160; &#160; 0.783685] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 0.783686] IOMMU 1 0xfed91000: using Queued invalidation<br />[&#160; &#160; 0.783688] IOMMU: Setting RMRR:<br />[&#160; &#160; 0.783696] IOMMU: Setting identity map for device 0000:00:02.0 [0x9f800000 - 0xaf9fffff]<br />[&#160; &#160; 0.784850] IOMMU: Setting identity map for device 0000:00:1d.0 [0x9d5c9000 - 0x9d5f3fff]<br />[&#160; &#160; 0.784865] IOMMU: Setting identity map for device 0000:00:1a.0 [0x9d5c9000 - 0x9d5f3fff]<br />[&#160; &#160; 0.784878] IOMMU: Setting identity map for device 0000:00:14.0 [0x9d5c9000 - 0x9d5f3fff]<br />[&#160; &#160; 0.784887] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 0.784892] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</p><p>[root@localhost modprobe.d]# dmesg |grep DMAR<br />[&#160; &#160; 0.000000] ACPI: DMAR 000000009d775558 0000B8 (v01 INTEL&#160; &#160; &#160; SNB&#160; 00000001 INTL 00000001)<br />[&#160; &#160; 0.783661] DMAR: No ATSR found<br />[&#160; &#160;24.261510] [drm] DMAR active, disabling use of stolen memory</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407464">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407618" class="blockpost rowodd"> <h2><span><span class="conr">#1582</span> <a href="viewtopic.php?pid=1407618#p1407618">2014-04-22 17:10:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@shweng<br />Don&#039;t know about the NVIDIA problem, you might want to try the qemu/seabios from git posted on page 1</p><p>However for the AMD problem</p><div class="quotebox"><blockquote><div><p>.VM with AMD HD7750 GPU, win7 start up BSOD with 0x00000116 on atikmpag.sys<br />&#160; &#160; same as ilya80 post at <a href="https://bbs.archlinux.org/viewtopic.php?pid=1351243,but" rel="nofollow">https://bbs.archlinux.org/viewtopic.php?pid=1351243,but</a> the solution of change &quot;clear_emulator_capabilities = 0&quot; on qemu.conf take no effect.</p></div></blockquote></div><p> I would recommend (1) don&#039;t pass the audio part 1:00.1, (2) in safe mode uninstall the AMD drivers; then after that presumably you can boot windows with the generic VGA driver (and you won&#039;t have the atimpag.sys error because there won&#039;t be an ati driver).&#160; (3) then reinstall only the graphics driver, not the CCC. When you install the drivers, there is an option to do that. You will still have accelerated graphics, just not the tuning available with the CCC.&#160; Anyway, that worked for me with my HD7970.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407618">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407888" class="blockpost roweven"> <h2><span><span class="conr">#1583</span> <a href="viewtopic.php?pid=1407888#p1407888">2014-04-23 07:35:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80944">ohetfi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><strong>Hi, nbhs and all!</strong></p><p>I would like to share my configuration of my sort of wannabe &quot;All-in-One&quot; KVM VFIO on Arch Linux. Using all nbhs&#039; ingredients (kernel 3.14), I have successfully passed through my GeForce GTX 770 and IBM M1015 to my KVM guests. Using this configuration I can also natively boot to both Linux Mint Debian Edition (for whole disk backup of Arch Linux disk) and to Windows 7 when I need the true bare metal performance (Metro: Last Light +/-4 FPS increase on Windows 7 native).</p><p><strong>3DMark Results</strong><br />Bare Metal: <a href="http://www.3dmark.com/fs/1945959" rel="nofollow">http://www.3dmark.com/fs/1945959</a><br />KVM Guest: <a href="http://www.3dmark.com/fs/2040597" rel="nofollow">http://www.3dmark.com/fs/2040597</a><br />Any idea on how to make my CPU recognized by 3DMark when on KVM Guest? <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p><strong>Hardware Specification</strong><br />CPU: Intel Core i7-4770<br />Memory: 4 x 8 GB Patriot Signature Line Kit<br />Motherboard: ASRock Z87 Extreme6<br />GPU: <br />&#160; &#160; - Intel HD Graphics 4600 (host)<br />&#160; &#160; - Gigabyte GeForce GTX 770 Windforce (guest1)<br />&#160; &#160; - Cirrus (guest2)<br />Disks:<br />&#160; &#160; - SanDisk FDD 32 GB -&gt; Arch Linux (host)<br />&#160; &#160; - Hitachi HDD 500 GB -&gt; Windows 7 (guest1)<br />&#160; &#160; - Seagate HDD 160 GB -&gt; Linux Mint Debian Edition (guest2)<br />&#160; &#160; - 4 x Hitachi HDD 2 TB -&gt; ZFS (guest2)<br />HBA: IBM M1015 RAID Card flashed with IT-mode (guest2)</p><p><strong>Boot Parameters (/proc/cmdline)</strong></p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=d6205fde-e945-4ded-b4e1-fe3bd98b1f84 rw quiet intel_iommu=on pcie_acs_override=downstream</code></pre></div><p>I need to add the pcie_acs_override parameter to force PCIe devices to be on separate IOMMU groups, and of cource intel_iommu parameter to make all this magic come true. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><strong>Kernel Module Parameters (/etc/modprobe.d/*.conf)</strong></p><div class="codebox"><pre><code># Blacklist Gigabyte GeForce GTX 770 Windforce blacklist nouveau blacklist nvidia # Bonding Modes: balance-rr, active-backup, balance-xor, broadcast, 802.3ad, balance-tlb, balance-alb options bonding mode=balance-alb miimon=100 updelay=200 # Needed to avoid crashing KVM guest when running Passmark Performance Test and SiSoftware Sandra options kvm ignore_msrs=1 # 01:00.0 10de:1184 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1) # 01:00.1 10de:0e0a Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) # 02:00.0 1000:0072 Serial Attached SCSI controller: LSI Logic / Symbios Logic SAS2008 PCI-Express Fusion-MPT SAS-2 [Falcon] (rev 03) options pci-stub ids=10de:1184,10de:0e0a,1000:0072 # Enable interrupt remapping options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>I bond 2 of my NICs and then setup a bridge device for all my guests.</p><p><strong>VFIO Bind Configuration (/etc/vfio.cfg)</strong></p><div class="codebox"><pre><code># 01:00.0 10de:1184 VGA compatible controller: NVIDIA Corporation GK104 [GeForce GTX 770] (rev a1) # 01:00.1 10de:0e0a Audio device: NVIDIA Corporation GK104 HDMI Audio Controller (rev a1) # 02:00.0 1000:0072 Serial Attached SCSI controller: LSI Logic / Symbios Logic SAS2008 PCI-Express Fusion-MPT SAS-2 [Falcon] (rev 03) DEVICES=&quot;0000:01:00.0 0000:01:00.1 0000:02:00.0&quot;</code></pre></div><p><strong>Hugepages Parameter (/etc/sysctl.d/40-vm.conf)</strong></p><div class="codebox"><pre><code># Allocate 26 GB of RAM for Hugepages vm.nr_hugepages = 13312</code></pre></div><p>The host memory is 32 GB, I allocated around 26 GB for all my KVM guests. 6 GB for the host.</p><p><strong>Windows 7 Guest Parameters (kvm-windows7.sh)</strong></p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash # Use PulseAudio as the audio driver QEMU_PA_SAMPLES=128 export QEMU_AUDIO_DRV=pa # Startup Windows 7 guest sudo qemu-system-x86_64 \ -name Windows-7 \ -cpu host \ -smp 8,sockets=1,cores=4,threads=2 \ -enable-kvm \ -m 8G \ -mem-path /dev/hugepages \ -mem-prealloc \ -balloon none \ -rtc clock=host \ -vga none \ -serial null \ -parallel null \ -monitor none \ -display none \ -daemonize \ -soundhw hda \ -k en-us \ -machine type=q35,accel=kvm \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -boot order=c \ -drive if=none,id=drive0,cache=none,aio=native,format=raw,file=/dev/disk/by-id/ata-Hitachi_HDS721050CLA660_JP1570FR1ZWP7K \ -device virtio-blk,drive=drive0,scsi=off,config-wce=off,x-data-plane=on \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -net nic,model=virtio,macaddr=52:54:00:6b:03:05 -net bridge,br=br0 \ -usb \ -device ich9-usb-uhci3,id=uhci \ -device usb-ehci,id=ehci \ -usbdevice host:093a:2510 \ -usbdevice host:04d9:1603 \ -usbdevice host:046d:c21e \ -usbdevice host:0bc2:2300</code></pre></div><p>I use host clock (UTC), since I sometimes accidentally boot the Windows 7 natively and wanted to avoid my hardware clock confusion. So far no need to eject or no issues on rebooting the guest, thank God. <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p><strong>Linux Mint Debian Edition Guest Parameters (kvm-lmde.sh)</strong></p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash # Use PulseAudio as the audio driver export QEMU_PA_SAMPLES=128 export QEMU_AUDIO_DRV=pa # Starts up Linux Mint Debian Edition guest sudo qemu-system-x86_64 \ -name LMDE \ -cpu host \ -smp 8,sockets=1,cores=4,threads=2 \ -enable-kvm \ -m 8G \ -mem-path /dev/hugepages \ -mem-prealloc \ -balloon none \ -rtc clock=host \ -vga std \ -vnc localhost:1 \ -daemonize \ -soundhw hda \ -k en-us \ -machine type=q35,accel=kvm \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -boot order=c \ -drive if=none,id=drive0,cache=none,aio=native,format=raw,file=/dev/disk/by-id/ata-ST3160815AS_5RA7CPYR \ -device virtio-blk,drive=drive0,scsi=off,config-wce=off,x-data-plane=on \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,romfile=/opt/sas2008/x64sas2.rom \ -net nic,model=virtio,macaddr=52:54:00:3b:cf:09 -net bridge,br=br0 \ -usb \ -device ich9-usb-uhci3,id=uhci \ -device usb-ehci,id=ehci</code></pre></div><p>My ZFS storage server. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>THANKS A LOT, Guys!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407888">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407896" class="blockpost rowodd"> <h2><span><span class="conr">#1584</span> <a href="viewtopic.php?pid=1407896#p1407896">2014-04-23 07:59:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78355">anickname</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-07</span></dd> <dd><span>Posts: 23</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ohetfi wrote:</cite><blockquote><div><p><strong>Hi, nbhs and all!</strong></p><p>I would like to share my configuration of my sort of wannabe &quot;All-in-One&quot; KVM VFIO on Arch Linux. Using all nbhs&#039; ingredients (kernel 3.14), I have successfully passed through my GeForce GTX 770 and IBM M1015 to my KVM guests. Using this configuration I can also natively boot to both Linux Mint Debian Edition (for whole disk backup of Arch Linux disk) and to Windows 7 when I need the true bare metal performance (Metro: Last Light +/-4 FPS increase on Windows 7 native).</p><p>THANKS A LOT, Guys!</p></div></blockquote></div><p>You will also get some network speed improvement using vhost=on.</p><p>Eg.:</p><p>-netdev tap,vhost=on,ifname=$VM,script=$KVM_ROOT/scripts/vm_ifup_brlan,id=brlan -device virtio-net-pci,mac=52:54:00:00:00:21,netdev=brlan \</p><p>where vm_ifup_brlan is :</p><div class="codebox"><pre><code>#!/bin/sh BRIDGE=brlan echo &quot;Executing $0&quot; echo &quot;Bringing up $1 for bridged mode...&quot; ip link set $1 up promisc on echo &quot;Disabling STP for bridge $BRIDGE&quot; brctl stp $BRIDGE off echo &quot;Adding $1 to $BRIDGE ...&quot; brctl addif $BRIDGE $1 sleep 2</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407896">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1407900" class="blockpost roweven"> <h2><span><span class="conr">#1585</span> <a href="viewtopic.php?pid=1407900#p1407900">2014-04-23 08:26:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80944">ohetfi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><div class="quotebox"><cite>ohetfi wrote:</cite><blockquote><div><p><strong>Hi, nbhs and all!</strong></p><p>I would like to share my configuration of my sort of wannabe &quot;All-in-One&quot; KVM VFIO on Arch Linux. Using all nbhs&#039; ingredients (kernel 3.14), I have successfully passed through my GeForce GTX 770 and IBM M1015 to my KVM guests. Using this configuration I can also natively boot to both Linux Mint Debian Edition (for whole disk backup of Arch Linux disk) and to Windows 7 when I need the true bare metal performance (Metro: Last Light +/-4 FPS increase on Windows 7 native).</p><p>THANKS A LOT, Guys!</p></div></blockquote></div><p>You will also get some network speed improvement using vhost=on.</p><p>Eg.:</p><p>-netdev tap,vhost=on,ifname=$VM,script=$KVM_ROOT/scripts/vm_ifup_brlan,id=brlan -device virtio-net-pci,mac=52:54:00:00:00:21,netdev=brlan \</p><p>where vm_ifup_brlan is :</p><div class="codebox"><pre><code>#!/bin/sh BRIDGE=brlan echo &quot;Executing $0&quot; echo &quot;Bringing up $1 for bridged mode...&quot; ip link set $1 up promisc on echo &quot;Disabling STP for bridge $BRIDGE&quot; brctl stp $BRIDGE off echo &quot;Adding $1 to $BRIDGE ...&quot; brctl addif $BRIDGE $1 sleep 2</code></pre></div></div></blockquote></div><p>Hi, anickname!</p><p>Thanks for pointing that, I was having difficulties on applying the new QEMU network parameters thus ended up using the ones that I have mentioned in my post. Will definitely try that. In my case, my bridge device is called br0, so I assume your brlan is my br0?</p><p>I also found this slide <a href="http://www.linux-kvm.org/wiki/images/c/c7/KvmForum2008$kdf2008_11.pdf" rel="nofollow">http://www.linux-kvm.org/wiki/images/c/ … 008_11.pdf</a>, probably will try to enable/disable the kvm_intel module parameters and see if it would increase my benchmarks: vpid, flexpriority, and ept.</p><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1407900">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1408751" class="blockpost rowodd"> <h2><span><span class="conr">#1586</span> <a href="viewtopic.php?pid=1408751#p1408751">2014-04-25 11:28:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Dear All,</p><p>I am trying to follow guide <a href="http://fds-team.de/cms/articles/2013-12/use-a-real-windows-7-partition-in-virtualbox-kvm-vmware-player-u.html" rel="nofollow">http://fds-team.de/cms/articles/2013-12 … yer-u.html</a> , but faced with issue:</p><div class="codebox"><pre><code>A disk read error occurred Press Ctrl+Alt+Del to restart</code></pre></div><p>I think is due to different types of booting: I use UEFI (and GPT) during real booting, but VM uses seabios. Could you please point me to right direction: what should I do to boot windows in VM?<br />BTW, I have installed Windows on one partition (recovery is also placed on the C drive, I have no 200MB hide partition)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1408751">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1408937" class="blockpost roweven"> <h2><span><span class="conr">#1587</span> <a href="viewtopic.php?pid=1408937#p1408937">2014-04-26 00:00:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81541">belliash</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-25</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:belliash@asiotec.eu.org">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone successfully passed through a discrete GPU on notebook with nvidia optimus technology? I have already spent a whole day on this, but all the time Windows reports code 10 (Device cannot start) in Device Manager.</p><p>I use vanilla kernel 3.14.1, qemu 2.0 and seabios 1.7.3.2. Do you have any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1408937">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1408938" class="blockpost rowodd"> <h2><span><span class="conr">#1588</span> <a href="viewtopic.php?pid=1408938#p1408938">2014-04-26 00:00:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="codebox"><pre><code>A disk read error occurred</code></pre></div><p>The message has been fixed, but I faced another:</p><div class="codebox"><pre><code>missing operating system</code></pre></div><p>Even if I run Windows installation from VM - installation process can not perform first reboot</p><p>Original drive:</p><div class="codebox"><pre><code>Disk /dev/sdb: 2.7 TiB, 3000592982016 bytes, 5860533168 sectors Units: sectors of 1 1.sh topic_10.html topic_11.html topic_12.html topic_13.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_6.html topic_7.html topic_8.html topic_9.html 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 4096 bytes / 4096 bytes Disklabel type: gpt Disk identifier: E0A01D64-268D-4491-88AB-B4498B9F4600 Device Start End Size Type /dev/sdb1 8192 1952571391 931.1G Microsoft basic data /dev/sdb2 1952571392 3905134591 931.1G Microsoft basic data /dev/sdb3 3905134592 5857697791 931.1G Microsoft basic data /dev/sdb4 5857697792 5860532223 1.4G Microsoft basic data</code></pre></div><p>sdb2 - windows partition</p><p>Creation procedures:</p><div class="codebox"><pre><code>dd if=/dev/zero of=boot.mbr count=0 seek=1952571392 sudo losetup /dev/loop0 boot.mgr sudo mdadm --build /dev/md0 --level=linear --raid-devices=2 /dev/loop0 /dev/sdb2</code></pre></div><div class="codebox"><pre><code>fdisk -l /dev/md0 Disk /dev/md0: 1.8 TiB, 1999428911104 bytes, 3905134592 sectors Units: sectors of 1 1.sh topic_10.html topic_11.html topic_12.html topic_13.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_6.html topic_7.html topic_8.html topic_9.html 512 = 512 bytes Sector size (logical/physical): 512 bytes / 4096 bytes I/O size (minimum/optimal): 4096 bytes / 4096 bytes Disklabel type: dos Disk identifier: 0xf057e88f Device Boot Start End Blocks Id System /dev/md0p1 1.sh topic_10.html topic_11.html topic_12.html topic_13.html topic_14.html topic_15.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_6.html topic_7.html topic_8.html topic_9.html 1952571392 3905134591 976281600 7 HPFS/NTFS/exFAT</code></pre></div><p>Could you please help me to fix this issue.<br />Thanks in advance!</p> <p class="postedit"><em>Last edited by myweb (2014-04-26 00:03:01)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1408938">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409102" class="blockpost roweven"> <h2><span><span class="conr">#1589</span> <a href="viewtopic.php?pid=1409102#p1409102">2014-04-26 13:43:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81541">belliash</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-25</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:belliash@asiotec.eu.org">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>belliash wrote:</cite><blockquote><div><p>Has anyone successfully passed through a discrete GPU on notebook with nvidia optimus technology? I have already spent a whole day on this, but all the time Windows reports code 10 (Device cannot start) in Device Manager.</p><p>I use vanilla kernel 3.14.1, qemu 2.0 and seabios 1.7.3.2. Do you have any ideas?</p></div></blockquote></div><br /><p>Now i got Error 43, like others using nvidia cards. Is there any way to fix this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409102">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409178" class="blockpost rowodd"> <h2><span><span class="conr">#1590</span> <a href="viewtopic.php?pid=1409178#p1409178">2014-04-26 16:57:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I was able to get it work on Fedora rawhide(with qemu 2.0).<br />It works without patches but with corrupted host graphics.</p><p>There are first time it works I think because of new fedora rawhide(qemu 2.0 may be)</p><p>The guest windows show black screen with while lines and host crashed before(qemu 1.6).</p><p>My config <br />MB: MSI h67ma-e45 <br />CPU Intel i5-2400<br />host GPU HD2000<br />guest GPU HD7750 (sapphire 1gb ddr5)</p> <p class="postedit"><em>Last edited by zzz3000 (2014-04-27 13:00:05)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409178">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409408" class="blockpost roweven"> <h2><span><span class="conr">#1591</span> <a href="viewtopic.php?pid=1409408#p1409408">2014-04-27 11:10:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@zzz3000<br />Can you tell, what you mean with corrupted graphics?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409408">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409437" class="blockpost rowodd"> <h2><span><span class="conr">#1592</span> <a href="viewtopic.php?pid=1409437#p1409437">2014-04-27 13:03:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>@zzz3000<br />Can you tell, what you mean with corrupted graphics?</p></div></blockquote></div><p>Host image become spoiled(I was able to solve this host problem with i915 patch before but guest did not work)<br />Now with qemu 2.0 quest works fine I think&#160; kernel patching will solve host image problem</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409502" class="blockpost roweven"> <h2><span><span class="conr">#1593</span> <a href="viewtopic.php?pid=1409502#p1409502">2014-04-27 16:40:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>zzz3000 wrote:</cite><blockquote><div><div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>@zzz3000<br />Can you tell, what you mean with corrupted graphics?</p></div></blockquote></div><p>Host image become spoiled(I was able to solve this host problem with i915 patch before but guest did not work)<br />Now with qemu 2.0 quest works fine I think&#160; kernel patching will solve host image problem</p></div></blockquote></div><p>Ok Thanks. So that means, I still need the i915 patch, despite using intel exclusively on the host and nvidia exclusively in the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409502">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409704" class="blockpost rowodd"> <h2><span><span class="conr">#1594</span> <a href="viewtopic.php?pid=1409704#p1409704">2014-04-28 07:48:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><p>Ok Thanks. So that means, I still need the i915 patch, despite using intel exclusively on the host and nvidia exclusively in the VM.</p></div></blockquote></div><p>It is true in my case with fedora rawhide (kernel 3.15 qemu 2.0)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409704">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409715" class="blockpost roweven"> <h2><span><span class="conr">#1595</span> <a href="viewtopic.php?pid=1409715#p1409715">2014-04-28 08:24:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80944">ohetfi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-07</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anickname wrote:</cite><blockquote><div><p>...</p><p>You will also get some network speed improvement using vhost=on.</p><p>Eg.:</p><p>-netdev tap,vhost=on,ifname=$VM,script=$KVM_ROOT/scripts/vm_ifup_brlan,id=brlan -device virtio-net-pci,mac=52:54:00:00:00:21,netdev=brlan \</p><p>...</p></div></blockquote></div><p>Hi, anickname! Your suggestion worked. When I ps -ef | grep vhost, I can see the vhost processes on my host Arch Linux. Don&#039;t know if it&#039;s only my feeling or not, but I can now download Steam games at my full Internet bandwidth speed and very much stable just like when I passthrough one of my Intel NIC to a VM. Before using vhost, I experienced the bandwidth speed were very fluctuate and almost never full speed. Thanks!</p><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>...<br />The message has been fixed, but I faced another:<br />...<br />Could you please help me to fix this issue.<br />Thanks in advance!</p></div></blockquote></div><p>Don&#039;t know if my experience will help you in any way, but I have different disk for each VM. My Arch Linux host resides in a 32 GB flash disk, which is very sufficient because I want my Arch Linux lean and simple, in addition I will be periodically do full offline disk backup, so 32 GB is enough for me. The flash disk is GPT, and I use EFI since my motherboard supports it and Arch Linux Beginner&#039;s Guide recommend it to use EFI/GPT for new installation if possible.</p><p>My Windows VM resides in a separate dedicated 500 GB hard disk, which I supply by giving a direct access to /dev/sdb (for instance). So the Windows VM have full access to the whole disk, but still via Arch Linux host drivers. I then install the Windows VM from Seabios and follow the installation as usual. After installing drivers etc inside the VM, I tried rebooting to the 500 GB disk (native reboot not VM reboot). And to my surprise, the Windows installation still runs, although needs to reinstall drivers for most part of the hardware. I didn&#039;t setup the grub to probe for the Windows partition, I switch manually to different boot drive via EFI/BIOS. So I think if you have spare disk, it would be easier to setup. Hope it helps.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409763" class="blockpost rowodd"> <h2><span><span class="conr">#1596</span> <a href="viewtopic.php?pid=1409763#p1409763">2014-04-28 10:25:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m trying this once again. I&#039;m using the nouveau drivers with a GTX 550-Ti this time around and then I plan to passthrough a GTX 670.</p><p>So far, I installed qemu-git from AUR. I added pci-stub to the module section of mkinitcpio.conf and then ran the mkinitcpio command, now here&#039;s where I get stuck.</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Now add this to your grub cfg file:</p><div class="codebox"><pre><code>pci-stub.ids=1002:6719,1002:aa80</code></pre></div></div></blockquote></div><p>those instructions aren&#039;t specific enough for me; which grub cfg file? the one in /etc/default/ or the one in /boot/grub? and more importantly, <strong>where</strong> in that file?</p><p>Then there&#039;s this step that&#039;s confusing me as well</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>If your board doesn&#039;t enable interrupt remapping, you need to add this to your grub cfg:</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>Or if vfio-pci was built as a module ( default on arch )</p><div class="codebox"><pre><code>echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/vfio_iommu_type1.conf</code></pre></div></div></blockquote></div><p>I&#039;ve got a board that supports interrupt remapping I think, but i&#039;m also using the default arch kernel so vfio-pci is built as a module, the part that&#039;s confusing me here is that in the former example we have:</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>but in the latter we have:</p><div class="codebox"><pre><code>options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>The part that&#039;s confusing me is that one has a period between &quot;type1&quot; and &quot;allow&quot; and the other has a space, shouldn&#039;t both have a period? I.e. shouldn&#039;t it be:</p><div class="codebox"><pre><code>options vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>Sorry for being a noob <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p> <p class="postedit"><em>Last edited by rabcor (2014-04-28 10:30:01)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409763">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409832" class="blockpost roweven"> <h2><span><span class="conr">#1597</span> <a href="viewtopic.php?pid=1409832#p1409832">2014-04-28 14:09:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p>I&#039;m trying this once again. I&#039;m using the nouveau drivers with a GTX 550-Ti this time around and then I plan to passthrough a GTX 670.</p><p>So far, I installed qemu-git from AUR. I added pci-stub to the module section of mkinitcpio.conf and then ran the mkinitcpio command, now here&#039;s where I get stuck.</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Now add this to your grub cfg file:</p><div class="codebox"><pre><code>pci-stub.ids=1002:6719,1002:aa80</code></pre></div></div></blockquote></div><p>those instructions aren&#039;t specific enough for me; which grub cfg file? the one in /etc/default/ or the one in /boot/grub? and more importantly, <strong>where</strong> in that file?</p><p>Then there&#039;s this step that&#039;s confusing me as well</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>If your board doesn&#039;t enable interrupt remapping, you need to add this to your grub cfg:</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>Or if vfio-pci was built as a module ( default on arch )</p><div class="codebox"><pre><code>echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/vfio_iommu_type1.conf</code></pre></div></div></blockquote></div><p>I&#039;ve got a board that supports interrupt remapping I think, but i&#039;m also using the default arch kernel so vfio-pci is built as a module, the part that&#039;s confusing me here is that in the former example we have:</p><div class="codebox"><pre><code>vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>but in the latter we have:</p><div class="codebox"><pre><code>options vfio_iommu_type1 allow_unsafe_interrupts=1</code></pre></div><p>The part that&#039;s confusing me is that one has a period between &quot;type1&quot; and &quot;allow&quot; and the other has a space, shouldn&#039;t both have a period? I.e. shouldn&#039;t it be:</p><div class="codebox"><pre><code>options vfio_iommu_type1.allow_unsafe_interrupts=1</code></pre></div><p>Sorry for being a noob <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" /></p></div></blockquote></div><p>The one with period is kernel parameter in grub.cfg (or /etc/default/grub), the other one put inside the file (with .conf extension) in /etc/modprobe.d/. Then add modconf hook to HOOKS in mkinicpio.conf. For best result choose latter method</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409832">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409941" class="blockpost rowodd"> <h2><span><span class="conr">#1598</span> <a href="viewtopic.php?pid=1409941#p1409941">2014-04-28 19:15:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81045">tswindell</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-10</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, when passing through the HD Audio and Video card of my nVidia 680GTX, under windows Audio works great, 3D is a bit buggy. But when using Ubuntu as the guest, with both audio and video passed through, the 3D accel works great, better than under Windows, but Audio doesn&#039;t work at all <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> Get a weird feedback loop of some kind.</p><p>Has anyone managed to get an nVidia card&#039;s audio parts to work using VFIO passthrough to a Linux guest?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409941">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409962" class="blockpost roweven"> <h2><span><span class="conr">#1599</span> <a href="viewtopic.php?pid=1409962#p1409962">2014-04-28 20:32:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>tswindell wrote:</cite><blockquote><div><p>So, when passing through the HD Audio and Video card of my nVidia 680GTX, under windows Audio works great, 3D is a bit buggy. But when using Ubuntu as the guest, with both audio and video passed through, the 3D accel works great, better than under Windows, but Audio doesn&#039;t work at all <img src="https://bbs.archlinux.org/img/smilies/hmm.png" width="15" height="15" alt="hmm" /> Get a weird feedback loop of some kind.</p><p>Has anyone managed to get an nVidia card&#039;s audio parts to work using VFIO passthrough to a Linux guest?</p></div></blockquote></div><p>You might try enabling MSI on the snd_hda_intel driver.&#160; You can do this on the kernel command line with snd_hda_intel.enable_msi=1 or via modprobe.d with &quot;options snd_hda_intel enable_msi=1&quot;.&#160; Nvidia apparently has a poor track record with MSI on the audio card as there&#039;s code specifically to disable it on Nvidia devices, but they also have a poor track record of making device that properly re-assert INTx if we mask it using the PCI 2.3 spec defined disable bit.&#160; MSI is more efficient in a virt environment anyway, so it it works, it&#039;s better to use it.&#160; I haven&#039;t had any trouble with audio on a GTX660, but on a Quadro K4000 (which uses the same device ID for the audio function), it&#039;s a complete fail.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409962">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1409974" class="blockpost rowodd"> <h2><span><span class="conr">#1600</span> <a href="viewtopic.php?pid=1409974#p1409974">2014-04-28 21:13:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=68201">rabcor</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-02-09</span></dd> <dd><span>Posts: 457</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=68201">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks @dwe11er!</p><div class="codebox"><pre><code>dmesg | grep pci-stub [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=298f5fd5-65b3-4f84-9de7-046660a66597 rw quiet pci-stub.ids=10de:1189,10de:0e0a [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux root=UUID=298f5fd5-65b3-4f84-9de7-046660a66597 rw quiet pci-stub.ids=10de:1189,10de:0e0a [ 0.625505] pci-stub: add 10DE:1189 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.625513] pci-stub 0000:02:00.0: claimed by stub [ 0.625518] pci-stub: add 10DE:0E0A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.625522] pci-stub 0000:02:00.1: claimed by stub</code></pre></div><p>Now I&#039;ve reached the qemu testing stage.</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host \ -smp 6,sockets=1,cores=4,threads=2 \ -bios /usr/share/qemu/bios.bin -vga none \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1</code></pre></div><p>Results in</p><div class="codebox"><pre><code>WARNING: failed to find q35-acpi-dsdt.aml qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>What did I do wrong? I googled around and <a href="https://bbs.archlinux.org/viewtopic.php?pid=1367574#p1367574" rel="nofollow">found this</a>. That suggests I should copy the file to /usr/share/qemu/ but copy it from where?</p><p>Edit: I found the file <a href="https://github.com/qemu/qemu/blob/master/pc-bios/q35-acpi-dsdt.aml" rel="nofollow">here</a>.</p><p>but I still get </p><div class="codebox"><pre><code>qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: vfio: error no iommu_group for device qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>how do I fix that? <img src="https://bbs.archlinux.org/img/smilies/yikes.png" width="15" height="15" alt="yikes" /></p><p>Digging deeper:</p><div class="codebox"><pre><code>$journalctl -b | grep vfio systemd[1]: Starting Binds devices to vfio-pci... apr 28 21:38:20 Necembel kernel: vfio-pci: probe of 0000:02:00.0 failed with error -22 apr 28 21:38:20 Necembel kernel: vfio-pci: probe of 0000:02:00.0 failed with error -22 apr 28 21:38:20 Necembel kernel: vfio-pci: probe of 0000:02:00.1 failed with error -22</code></pre></div><p>&quot;ls /sys/bus/pci/devices/0000\:02\:00.0/&quot; also lists no &quot;iommu_group&quot; link.</p> <p class="postedit"><em>Last edited by rabcor (2014-04-28 21:51:33)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1421825" rel="nofollow">Making Logitech G510 Work on Linux!</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1409974">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=63">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=62">62</a> <a href="viewtopic.php?id=162768&amp;p=63">63</a> <strong>64</strong> <a href="viewtopic.php?id=162768&amp;p=65">65</a> <a href="viewtopic.php?id=162768&amp;p=66">66</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=65">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
