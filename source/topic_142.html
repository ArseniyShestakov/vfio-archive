<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 142) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=142" title="Page 142" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=141" title="Page 141" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=143" title="Page 143" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=141">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=140">140</a> <a href="viewtopic.php?id=162768&amp;p=141">141</a> <strong>142</strong> <a href="viewtopic.php?id=162768&amp;p=143">143</a> <a href="viewtopic.php?id=162768&amp;p=144">144</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=143">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1482205" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3526</span> <a href="viewtopic.php?pid=1482205#p1482205">2014-12-07 07:43:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>i tried running aw&#039;s rom parser but it would output a 0 byte file even on a fresh restart. does that mean my card doesnt support efi?</p></div></blockquote></div><p>romparser software needs a file to check. But you&#039;re not passing romfile=SOMEFILE.rom option to your device, so you don&#039;t need to check, and also you have a very fresh radeon card, which 95% supports UEFI.</p><br /><p>Also, try installing windowns(or whatever you need) using the qemu&#039;s graphics(like qxl or something), and then plugging in the card as a secondary.<br />By the way, you shouldn&#039;t need x-vga=on while using OVMF. Appending multifunction=on is needed when there is HDMI-audio device present as a function of the GPU itself, so you should always leave it on.</p><p>And you appear to be giving us only partial command-lines, and running qemu without sudo(you might have fixes for that, but usually they are needed).</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482205">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482207" class="blockpost roweven"> <h2><span><span class="conr">#3527</span> <a href="viewtopic.php?pid=1482207#p1482207">2014-12-07 07:50:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Duelist, dozens of pages ago you posted a message on successfully installing windows 7 using ovmf</p><p>could you please specify all related details (qemu/libvirt configuration, win 7 iso &quot;type&quot;, steps taken, etc)?</p><p>already had 4 &quot;try sessions&quot; with no result</p> <p class="postedit"><em>Last edited by sinny (2014-12-07 07:52:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482207">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482209" class="blockpost rowodd"> <h2><span><span class="conr">#3528</span> <a href="viewtopic.php?pid=1482209#p1482209">2014-12-07 07:51:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>yea i&#039;ve removed all drives currently i&#039;m just trying to get it to output to my graphics card&#039;s monitor. i&#039;ll reattatch drives once i get that working.</p><p>and yea i&#039;m running that as a script that i&#039;m executing using sudo.</p><p>i had windows up and running perfectly using my old card and bios, but i can&#039;t figure out what is missing to get it to output using ovmf and my new card.</p><p>would i not see some sort of output on the screen from the uefi/ovmf running like i would in seabios?</p> <p class="postedit"><em>Last edited by risho (2014-12-07 07:55:13)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482209">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482224" class="blockpost roweven"> <h2><span><span class="conr">#3529</span> <a href="viewtopic.php?pid=1482224#p1482224">2014-12-07 09:36:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64462">mastersplinter777</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-10-09</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64462">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>winie wrote:</cite><blockquote><div><div class="quotebox"><cite>mastersplinter777 wrote:</cite><blockquote><div><p>Finally succeeded to passthrough my Zotac GT630 to OSX 10.9.5 with working 3D<br /><a href="https://imagizer.imageshack.us/v2/1152x648q90/538/u1Qwht.png" rel="nofollow">https://imagizer.imageshack.us/v2/1152x … u1Qwht.png</a></p></div></blockquote></div><p>I didn&#039;t get os x 10.9.5 working in qemu. I get a fast bootloop from seabios. <br />Can you post your command line?</p></div></blockquote></div><p>This is my launch script:</p><div class="codebox"><pre class="vscroll"><code>#/bin/sh #sleep 10 export QEMU_AUDIO_DRV=alsa #export QEMU_AUDIO_TIMER_PERIOD=100 export QEMU_AUDIO_DAC_FIXED_SETTINGS=1 export QEMU_AUDIO_DAC_FIXED_FREQ=48000 #export QEMU_AUDIO_DAC_FIXED_FMT=S16 #export QEMU_AUDIO_DAC_FIXED_CHANNELS=2 #export QEMU_AUDIO_DAC_VOICES=1 #export QEMU_AUDIO_DAC_TRY_POLL=0 export QEMU_AUDIO_ADC_FIXED_SETTINGS=1 export QEMU_AUDIO_ACD_FIXED_FREQ=48000 #export QEMU_AUDIO_ADC_FIXED_FMT=S16 #export QEMU_AUDIO_ADC_FIXED_CHANNELS=1 #export QEMU_AUDIO_ADC_VOICES=1 #export QEMU_AUDIO_ADC_TRY_POLL=0 export QEMU_ALSA_DAC_PERIOD_SIZE=170 export QEMU_ALSA_DAC_BUFFER_SIZE=512 #export QEMU_PA_SAMPLES=480 #&lt;qemu:env name=&quot;QEMU_AUDIO_DRV&quot; value=&quot;pa&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_TIMER_PERIOD&quot; value=&quot;100&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_SETTINGS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_FREQ&quot; value=&quot;48000&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_FMT&quot; value=&quot;S16&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_CHANNELS&quot; value=&quot;2&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_VOICES&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_TRY_POLL&quot; value=&quot;0&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_SETTINGS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ACD_FIXED_FREQ&quot; value=&quot;48000&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_FMT&quot; value=&quot;S16&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_CHANNELS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_VOICES&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_TRY_POLL&quot; value=&quot;0&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_PA_SAMPLES&quot; value=&quot;480&quot;&gt;&lt;/qemu:env&gt; #export QEMU_AUDIO_DRV=pa #export QEMU_PA_SAMPLES=128 #export QEMU_AUDIO_DRV=alsa #export QEMU_ALSA_DAC_PERIOD_SIZE=170 #export QEMU_ALSA_DAC_BUFFER_SIZE=512 spicec --host 127.0.0.1 --port 5902 --title=&quot;OSX&quot; --hotkeys release-cursor=ctrl+alt &amp; #spicy --host 127.0.0.1 --port 5902 --title=&quot;OSX&quot; &amp; sudo qemu-system-x86_64 \ -enable-kvm \ -smp 2,sockets=1,cores=2,threads=1 \ -chardev spicevmc,id=vdagent,name=vdagent \ -spice port=5902,disable-ticketing,seamless-migration=on \ -M q35 \ -m 4096 \ -cpu core2duo \ -rtc base=localtime \ -vga none \ -device i82801b11-bridge,id=pci.1,bus=pcie.0,addr=0x12 \ -device pci-bridge,chassis_nr=2,id=pci.2,bus=pci.1,addr=0x1 \ -device virtio-serial,addr=0x8 \ -device virtserialport,chardev=vdagent,name=com.redhat.spice.0 \ -device virtio-balloon-pci,id=balloon0,bus=pci.2,addr=0x9 \ -device ich9-usb-ehci1,id=usb,bus=pci.2,addr=0x1.0x7 \ -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.2,multifunction=on,addr=0x1 \ -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.2,addr=0x1.0x1 \ -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.2,addr=0x1.0x2 \ -chardev spicevmc,name=usbredir,id=usbredirchardev1 \ -device usb-redir,chardev=usbredirchardev1,id=usbredirdev1 \ -chardev spicevmc,name=usbredir,id=usbredirchardev2 \ -device usb-redir,chardev=usbredirchardev2,id=usbredirdev2 \ -chardev spicevmc,name=usbredir,id=usbredirchardev3 \ -device usb-redir,chardev=usbredirchardev3,id=usbredirdev3 \ -chardev spicevmc,name=usbredir,id=usbredirchardev4 \ -device usb-redir,chardev=usbredirchardev4,id=usbredirdev4 \ -net nic,macaddr=00:00:00:FF:FF:02,model=virtio,id=netkvm,addr=0x7 \ -usbdevice host:046d:c52e \ -net bridge \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=&#039;/vm/QEMU/OSX/osx.img&#039;,if=none,media=disk,id=drive-sata0-0-2,format=raw -device ide-hd,bus=ide.1,drive=drive-sata0-0-2,id=sata0-0-2</code></pre></div><p>This is my boot options:</p><div class="codebox"><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt; &lt;plist version=&quot;1.0&quot;&gt; &lt;dict&gt; &lt;key&gt;EthernetBuiltIn&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;GUI&lt;/key&gt; &lt;string&gt;No&lt;/string&gt; &lt;key&gt;Graphics Mode&lt;/key&gt; &lt;string&gt;1280x800x32&lt;/string&gt; &lt;key&gt;HDAEnabler&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;Legacy Logo&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;Timeout&lt;/key&gt; &lt;string&gt;5&lt;/string&gt; &lt;key&gt;USBBusFix&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;UseKernelCache&lt;/key&gt; &lt;string&gt;No&lt;/string&gt;&lt;/dict&gt; &lt;/plist&gt;</code></pre></div><p>smbios profile: MacPro3,1</p><p>Qemu version: 2.1.2<br />Kernel: 3.17.4-99-libre with applied patches from this topic<br />HW: ASRock Z87 Pro4 with latest bios, 16 Gb RAM, Intel Core i5 4440, 1GPU: Intel HD 4600 (host), 2GPU: NVIDIA GT630 1Gb (Zotac) (osx), 3GPU: AMD 5450 (ASUS) (win8.1)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482224">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482230" class="blockpost rowodd"> <h2><span><span class="conr">#3530</span> <a href="viewtopic.php?pid=1482230#p1482230">2014-12-07 10:50:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=64462">mastersplinter777</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-10-09</span></dd> <dd><span>Posts: 8</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=64462">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mastersplinter777 wrote:</cite><blockquote><div><div class="quotebox"><cite>winie wrote:</cite><blockquote><div><div class="quotebox"><cite>mastersplinter777 wrote:</cite><blockquote><div><p>Finally succeeded to passthrough my Zotac GT630 to OSX 10.9.5 with working 3D<br /><a href="https://imagizer.imageshack.us/v2/1152x648q90/538/u1Qwht.png" rel="nofollow">https://imagizer.imageshack.us/v2/1152x … u1Qwht.png</a></p></div></blockquote></div><p>I didn&#039;t get os x 10.9.5 working in qemu. I get a fast bootloop from seabios. <br />Can you post your command line?</p></div></blockquote></div><p>This is my launch script:</p><div class="codebox"><pre class="vscroll"><code>#/bin/sh #sleep 10 export QEMU_AUDIO_DRV=alsa #export QEMU_AUDIO_TIMER_PERIOD=100 export QEMU_AUDIO_DAC_FIXED_SETTINGS=1 export QEMU_AUDIO_DAC_FIXED_FREQ=48000 #export QEMU_AUDIO_DAC_FIXED_FMT=S16 #export QEMU_AUDIO_DAC_FIXED_CHANNELS=2 #export QEMU_AUDIO_DAC_VOICES=1 #export QEMU_AUDIO_DAC_TRY_POLL=0 export QEMU_AUDIO_ADC_FIXED_SETTINGS=1 export QEMU_AUDIO_ACD_FIXED_FREQ=48000 #export QEMU_AUDIO_ADC_FIXED_FMT=S16 #export QEMU_AUDIO_ADC_FIXED_CHANNELS=1 #export QEMU_AUDIO_ADC_VOICES=1 #export QEMU_AUDIO_ADC_TRY_POLL=0 export QEMU_ALSA_DAC_PERIOD_SIZE=170 export QEMU_ALSA_DAC_BUFFER_SIZE=512 #export QEMU_PA_SAMPLES=480 #&lt;qemu:env name=&quot;QEMU_AUDIO_DRV&quot; value=&quot;pa&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_TIMER_PERIOD&quot; value=&quot;100&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_SETTINGS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_FREQ&quot; value=&quot;48000&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_FMT&quot; value=&quot;S16&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_FIXED_CHANNELS&quot; value=&quot;2&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_VOICES&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_DAC_TRY_POLL&quot; value=&quot;0&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_SETTINGS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ACD_FIXED_FREQ&quot; value=&quot;48000&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_FMT&quot; value=&quot;S16&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_FIXED_CHANNELS&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_VOICES&quot; value=&quot;1&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_AUDIO_ADC_TRY_POLL&quot; value=&quot;0&quot;&gt;&lt;/qemu:env&gt; #&lt;qemu:env name=&quot;QEMU_PA_SAMPLES&quot; value=&quot;480&quot;&gt;&lt;/qemu:env&gt; #export QEMU_AUDIO_DRV=pa #export QEMU_PA_SAMPLES=128 #export QEMU_AUDIO_DRV=alsa #export QEMU_ALSA_DAC_PERIOD_SIZE=170 #export QEMU_ALSA_DAC_BUFFER_SIZE=512 spicec --host 127.0.0.1 --port 5902 --title=&quot;OSX&quot; --hotkeys release-cursor=ctrl+alt &amp; #spicy --host 127.0.0.1 --port 5902 --title=&quot;OSX&quot; &amp; sudo qemu-system-x86_64 \ -enable-kvm \ -smp 2,sockets=1,cores=2,threads=1 \ -chardev spicevmc,id=vdagent,name=vdagent \ -spice port=5902,disable-ticketing,seamless-migration=on \ -M q35 \ -m 4096 \ -cpu core2duo \ -rtc base=localtime \ -vga none \ -device i82801b11-bridge,id=pci.1,bus=pcie.0,addr=0x12 \ -device pci-bridge,chassis_nr=2,id=pci.2,bus=pci.1,addr=0x1 \ -device virtio-serial,addr=0x8 \ -device virtserialport,chardev=vdagent,name=com.redhat.spice.0 \ -device virtio-balloon-pci,id=balloon0,bus=pci.2,addr=0x9 \ -device ich9-usb-ehci1,id=usb,bus=pci.2,addr=0x1.0x7 \ -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.2,multifunction=on,addr=0x1 \ -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.2,addr=0x1.0x1 \ -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.2,addr=0x1.0x2 \ -chardev spicevmc,name=usbredir,id=usbredirchardev1 \ -device usb-redir,chardev=usbredirchardev1,id=usbredirdev1 \ -chardev spicevmc,name=usbredir,id=usbredirchardev2 \ -device usb-redir,chardev=usbredirchardev2,id=usbredirdev2 \ -chardev spicevmc,name=usbredir,id=usbredirchardev3 \ -device usb-redir,chardev=usbredirchardev3,id=usbredirdev3 \ -chardev spicevmc,name=usbredir,id=usbredirchardev4 \ -device usb-redir,chardev=usbredirchardev4,id=usbredirdev4 \ -net nic,macaddr=00:00:00:FF:FF:02,model=virtio,id=netkvm,addr=0x7 \ -usbdevice host:046d:c52e \ -net bridge \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=&#039;/vm/QEMU/OSX/osx.img&#039;,if=none,media=disk,id=drive-sata0-0-2,format=raw -device ide-hd,bus=ide.1,drive=drive-sata0-0-2,id=sata0-0-2</code></pre></div><p>This is my boot options:</p><div class="codebox"><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt; &lt;plist version=&quot;1.0&quot;&gt; &lt;dict&gt; &lt;key&gt;EthernetBuiltIn&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;GUI&lt;/key&gt; &lt;string&gt;No&lt;/string&gt; &lt;key&gt;Graphics Mode&lt;/key&gt; &lt;string&gt;1280x800x32&lt;/string&gt; &lt;key&gt;HDAEnabler&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;Legacy Logo&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;Timeout&lt;/key&gt; &lt;string&gt;5&lt;/string&gt; &lt;key&gt;USBBusFix&lt;/key&gt; &lt;string&gt;Yes&lt;/string&gt; &lt;key&gt;UseKernelCache&lt;/key&gt; &lt;string&gt;No&lt;/string&gt;&lt;/dict&gt; &lt;/plist&gt;</code></pre></div><p>smbios profile: MacPro3,1</p><p>Qemu version: 2.1.2<br />Kernel: 3.17.4-99-libre with applied patches from this topic<br />HW: ASRock Z87 Pro4 with latest bios, 16 Gb RAM, Intel Core i5 4440, 1GPU: Intel HD 4600 (host), 2GPU: NVIDIA GT630 1Gb (Zotac) (osx), 3GPU: AMD 5450 (ASUS) (win8.1)</p></div></blockquote></div><p>UPDATE:<br />change:<br />-net nic,macaddr=00:00:00:FF:FF:02,model=virtio,id=netkvm,addr=0x7 \<br />-net bridge \</p><p>to:<br />-netdev bridge,id=br0 \<br />-device e1000-82545em,netdev=br0,id=vnet0,bus=pcie.0,addr=15 \</p><p>as it solves os freeze problems while copying large files</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482230">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482286" class="blockpost roweven"> <h2><span><span class="conr">#3531</span> <a href="viewtopic.php?pid=1482286#p1482286">2014-12-07 14:00:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>Duelist, dozens of pages ago you posted a message on successfully installing windows 7 using ovmf</p><p>could you please specify all related details (qemu/libvirt configuration, win 7 iso &quot;type&quot;, steps taken, etc)?</p><p>already had 4 &quot;try sessions&quot; with no result</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1480029#p1480029" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1480029</a></p><p>Since i&#039;ve got strange problems with passing the bios via romfile option to my GPU(the UEFI freezes!), i reverted to BIOS and i dropped any thoughts about running OVMF with VFIO, so i&#039;ve done setting it up just with qemu&#039;s emulated graphics.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482286">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482334" class="blockpost rowodd"> <h2><span><span class="conr">#3532</span> <a href="viewtopic.php?pid=1482334#p1482334">2014-12-07 16:17:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p><a href="http://www.extremetech.com/gaming/156467-xbox-one-hardware-and-software-specs-detailed-and-analyzed" rel="nofollow">http://www.extremetech.com/gaming/15646 … d-analyzed</a></p><div class="quotebox"><blockquote><div><p>According to Microsoft, the Xbox One runs three different operating systems. There’s a core operating system that’s based on Microsoft’s Hyper-V hypervisor technology, which boots up when you turn the console on. This hypervisor then boots up two further operating systems: Xbox OS, which runs the games, and an OS that’s based on Windows 8, which runs the apps (Skype, TV, etc.)</p><p>The Xbox OS and Windows-based OS run side-by-side, on hardware that’s virtualized by the hypervisor. Both OSes are permanently switched on and constantly rendering their video output, to enable instant switching/snapping between games and apps/TV. The Xbox OS is rebooted whenever you load a game, but the Windows-based OS is persistent until you turn the console off. It isn’t clear how the hardware resources are split between the two virtualized OSes, but hopefully the Xbox OS (games) gets most of the RAM and GPU time.</p></div></blockquote></div><p>WUT.<br />So it seems like hyper-v can do not only the GPU-passthrough, but divide it&#039;s performance! Isn&#039;t that VERY MUCH alike intel gvt-g but on AMD SoC?<br />Surprising fact. Now i can boast that my machine runs very alike to how xbox one runs - three OS at the same time.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482334">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482346" class="blockpost roweven"> <h2><span><span class="conr">#3533</span> <a href="viewtopic.php?pid=1482346#p1482346">2014-12-07 16:51:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>i tried running aw&#039;s rom parser but it would output a 0 byte file even on a fresh restart. does that mean my card doesnt support efi?</p></div></blockquote></div><p>romparser software needs a file to check. But you&#039;re not passing romfile=SOMEFILE.rom option to your device, so you don&#039;t need to check, and also you have a very fresh radeon card, which 95% supports UEFI.</p></div></blockquote></div><p>Some Radeon cards have been reported to have a switch which enables an EFI capable ROM.&#160; Failure to dump the ROM from sysfs can sometimes be attributed to the card being the primary host graphics.&#160; Is vfio able to get the ROM or do you get an invalid ROM message in dmesg on guest startup?&#160; You may want to check the techpowerup database for an alternate ROM.</p><div class="quotebox"><blockquote><div><p>Also, try installing windowns(or whatever you need) using the qemu&#039;s graphics(like qxl or something), and then plugging in the card as a secondary.<br />By the way, you shouldn&#039;t need x-vga=on while using OVMF. Appending multifunction=on is needed when there is HDMI-audio device present as a function of the GPU itself, so you should always leave it on.</p></div></blockquote></div><p><em>multifunction=on</em> changes how the device is exposed to the guest, it has nothing to do with the physical device.&#160; In fact, you can combine functions from multiple physical and emulated devices into a single franken-multifunction-device if you want, though I wouldn&#039;t recommend it.&#160; If you&#039;re not creating multiple functions on the slot, as exposed to the guest, there&#039;s no point in using multifunction=on, but doing so gratuitously is generally harmless.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482346">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482377" class="blockpost rowodd"> <h2><span><span class="conr">#3534</span> <a href="viewtopic.php?pid=1482377#p1482377">2014-12-07 18:53:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>i tried running aw&#039;s rom parser but it would output a 0 byte file even on a fresh restart. does that mean my card doesnt support efi?</p></div></blockquote></div><p>romparser software needs a file to check. But you&#039;re not passing romfile=SOMEFILE.rom option to your device, so you don&#039;t need to check, and also you have a very fresh radeon card, which 95% supports UEFI.</p></div></blockquote></div><p>Some Radeon cards have been reported to have a switch which enables an EFI capable ROM.&#160; Failure to dump the ROM from sysfs can sometimes be attributed to the card being the primary host graphics.&#160; Is vfio able to get the ROM or do you get an invalid ROM message in dmesg on guest startup?&#160; You may want to check the techpowerup database for an alternate ROM.</p><div class="quotebox"><blockquote><div><p>Also, try installing windowns(or whatever you need) using the qemu&#039;s graphics(like qxl or something), and then plugging in the card as a secondary.<br />By the way, you shouldn&#039;t need x-vga=on while using OVMF. Appending multifunction=on is needed when there is HDMI-audio device present as a function of the GPU itself, so you should always leave it on.</p></div></blockquote></div><p><em>multifunction=on</em> changes how the device is exposed to the guest, it has nothing to do with the physical device.&#160; In fact, you can combine functions from multiple physical and emulated devices into a single franken-multifunction-device if you want, though I wouldn&#039;t recommend it.&#160; If you&#039;re not creating multiple functions on the slot, as exposed to the guest, there&#039;s no point in using multifunction=on, but doing so gratuitously is generally harmless.</p></div></blockquote></div><p>First - he has a problem, not me. We don&#039;t know what he used as an input to romparser. Is it possible to feed that sysfs image of rom into romparser without catting it to some file first?<br />Also, i haven&#039;t been able to get the rom out of my secondary card, not the primary one, but that&#039;s me. He has a single GPU(r9 290x is single, right? r9 295x2 is the dual one, right?).</p><p>Second - i think if the HDMI audio device is exposed to the guest as an independent device, the driver installer software MIGHT go nuts.<br />I&#039;ve noted that multifunction option just in case he thinks that changing it would do anything closely related to OVMF or UEFI, which isn&#039;t true.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482377">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482411" class="blockpost roweven"> <h2><span><span class="conr">#3535</span> <a href="viewtopic.php?pid=1482411#p1482411">2014-12-07 21:33:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>it&#039;s a sapphire tri x oc 290x. i checked newegg, the exact one i bought and it said it has uefi support, and then i checked sapphire&#039;s website and it also said it supports uefi, so i&#039;m assuming it&#039;s fine.</p><p>i have it pci stubbed in my bootloader.</p><div class="codebox"><pre><code>[anonymous@arch kvm]$ dmesg | grep stub [ 0.000000] Command line: BOOT_IMAGE=../vmlinuz-linux-mainline root=/dev/sdb1 rootflags=subvol=__active/rootvol intel_iommu=on i915.enable_hd_vgaarb=1 pcie_acs_override=downstream pci-stub.ids=1002:67b0,1002:aac8 modeset.nouveau=0 modeset.radeon=0 rw initrd=../initramfs-linux-mainline.img [ 0.000000] Kernel command line: BOOT_IMAGE=../vmlinuz-linux-mainline root=/dev/sdb1 rootflags=subvol=__active/rootvol intel_iommu=on i915.enable_hd_vgaarb=1 pcie_acs_override=downstream pci-stub.ids=1002:67b0,1002:aac8 modeset.nouveau=0 modeset.radeon=0 rw initrd=../initramfs-linux-mainline.img [ 0.606900] pci-stub: add 1002:67B0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.606905] pci-stub 0000:01:00.0: claimed by stub [ 0.606908] pci-stub: add 1002:AAC8 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.606920] pci-stub 0000:01:00.1: claimed by stub</code></pre></div><p> i&#039;m running the kernel + patches from page 1. i&#039;m running the script with sudo and it gives me this inside the shell with no information being pushed through to the monitor plugged into the card</p><div class="codebox"><pre><code>UEFI Interactive Shell v2.1 EDK II UEFI v2.40 (EDK II, 0x00010000) Mapping table BLK2: Alias(s): PciRoot(0x0)/Pci(0x1,0x1)/Ata(0x0) BLK0: Alias(s): PciRoot(0x0)/Pci(0x1,0x0)/Floppy(0x0) BLK1: Alias(s): PciRoot(0x0)/Pci(0x1,0x0)/Floppy(0x1) Press ESC in 1 seconds to skip startup.nsh or any other key to continue. Shell&gt; </code></pre></div><p>this is the script</p><div class="codebox"><pre class="vscroll"><code>test3.sh sudo vfio-bind 0000:01:00.0 0000:01:00.1 #0000:00:03.0 #qemu-system-x86_64 -enable-kvm -m 1024 -cpu host \ #-smp 6,sockets=1,cores=2,threads=1 \ #-bios /usr/share/qemu/bios.bin -vga none \ #-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ ##-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ #-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64 -enable-kvm -m 8196 -cpu host,kvm=off \ -smp 6,sockets=1,cores=3,threads=2 \ -boot menu=on \ -drive if=pflash,format=raw,readonly,file=/home/anonymous/kvm/OVMF_CODE.fd \ -drive if=pflash,format=raw,file=/home/anonymous/kvm/OVMF_VARS.fd \ -device vfio-pci,host=01:00.0,multifunction=on,x-vga=on -nographic -vga none \ -device vfio-pci,host=01:00.1 \ # -drive file=/home/anonymous/windows.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ # -drive file=/dev/sda,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ # -usb -usbdevice host:046d:c52e -usbdevice host:041e:30e0 -usbdevice host:045e:0719 \ # -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ # -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 # -device vfio-pci,host=07:00.0,bus=pcie.0 \ # -device vfio-pci,host=08:04.0,bus=pcie.0 # -device vfio-pci,host=0c:00.0,bus=pcie.0 # -drive file=/dev/sda,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \ # -boot menu=on \ # -rtc base=localtime \</code></pre></div><p>a lot of comments from my trial and error. i&#039;ve removed all drives and everything that isn&#039;t absolutely necessary. I&#039;m just trying to get a respone out of my monitor to show that it is working before i go through and try to set up drives and installing the os.</p><p>by the way i was able to get it to output when i was running it wish seabios and vga i just want to get it working with uefi since i can&#039;t update windows since restarts cause the guest to crash and also have a very high chance of hanging the host.</p><p>when i run the the script dmesg outputs</p><div class="codebox"><pre><code>[ 64.293733] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 64.293841] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x270 [ 64.293845] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1b@0x2d0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482411">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482454" class="blockpost rowodd"> <h2><span><span class="conr">#3536</span> <a href="viewtopic.php?pid=1482454#p1482454">2014-12-08 00:26:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>when i run the the script dmesg outputs</p><div class="codebox"><pre><code>[ 64.293733] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 64.293841] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x270 [ 64.293845] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1b@0x2d0</code></pre></div></div></blockquote></div><p>That is perfectly normal, no need to be worried by these messages.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482454">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482551" class="blockpost roweven"> <h2><span><span class="conr">#3537</span> <a href="viewtopic.php?pid=1482551#p1482551">2014-12-08 08:21:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>do you know any way for me to troubleshoot why i&#039;m not getting any output on my monitor?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482551">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482567" class="blockpost rowodd"> <h2><span><span class="conr">#3538</span> <a href="viewtopic.php?pid=1482567#p1482567">2014-12-08 09:53:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>do you know any way for me to troubleshoot why i&#039;m not getting any output on my monitor?</p></div></blockquote></div><p>First i&#039;d try to boot windows installation iso from the serial-console of the OVMF menu(hint: type exit to get into somewhat menu-based UI)</p><p>Also, i&#039;d install windowns with emulated graphics first, and then tried to attach the GPU. It would be working like secondary, but then, if all goes well, i&#039;d remove the emulated graphics.</p><p>Something hints me that you shouldn&#039;t even have the output from OVMF in the first place since there is no VGA. But on the other hand, there is graphics-output-protocol or something, i don&#039;t know much about it. And i&#039;ve got output on my emulated graphics when i booted the windows ISO.</p><p>But remember, i&#039;m dumb and somewhat crazy.</p><p>Also, if you had it working with conventional VGA BIOS, why not just leave it working so?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482567">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482569" class="blockpost roweven"> <h2><span><span class="conr">#3539</span> <a href="viewtopic.php?pid=1482569#p1482569">2014-12-08 09:58:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>do you know any way for me to troubleshoot why i&#039;m not getting any output on my monitor?</p></div></blockquote></div><p>It might be OVMF itself (for me it worked with older releases, stopped for few weeks and now its working again; it was only during early bootup, Windows&#039;s working fine when driver kicks it). Which version are you using?</p> <p class="postedit"><em>Last edited by dwe11er (2014-12-08 10:15:31)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482569">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482673" class="blockpost rowodd"> <h2><span><span class="conr">#3540</span> <a href="viewtopic.php?pid=1482673#p1482673">2014-12-08 15:59:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>do you know any way for me to troubleshoot why i&#039;m not getting any output on my monitor?</p></div></blockquote></div><p>First i&#039;d try to boot windows installation iso from the serial-console of the OVMF menu(hint: type exit to get into somewhat menu-based UI)</p><p>Also, i&#039;d install windowns with emulated graphics first, and then tried to attach the GPU. It would be working like secondary, but then, if all goes well, i&#039;d remove the emulated graphics.</p><p>Something hints me that you shouldn&#039;t even have the output from OVMF in the first place since there is no VGA. But on the other hand, there is graphics-output-protocol or something, i don&#039;t know much about it. And i&#039;ve got output on my emulated graphics when i booted the windows ISO.</p><p>But remember, i&#039;m dumb and somewhat crazy.</p><p>Also, if you had it working with conventional VGA BIOS, why not just leave it working so?</p></div></blockquote></div><br /><p>you are a genius. i installed it via spice, downloaded the drivers and then booted with the graphics card and it&#039;s up and running.</p><p>the reason I stopped using vga bios is because i literally could not update the guest because shutting down/rebooting the system wouldn&#039;t happen correctly. it would just hang, most of the time actually causing the host to hang in the process.&#160; i also am hoping to be able to stop using this specialized kernel. i can do it and all, but being able to just have the distro maintain the kernel for me is just way better. i don&#039;t want to have to update it manually every single time to avoid vulnerabilities etc.</p><p>edit: I just rebooted. I&#039;m running an unpatched default arch kernel and it booted. this is absolutely amazing.</p> <p class="postedit"><em>Last edited by risho (2014-12-08 16:02:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482673">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482827" class="blockpost roweven"> <h2><span><span class="conr">#3541</span> <a href="viewtopic.php?pid=1482827#p1482827">2014-12-09 05:07:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482827">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482831" class="blockpost rowodd"> <h2><span><span class="conr">#3542</span> <a href="viewtopic.php?pid=1482831#p1482831">2014-12-09 05:32:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84813">jyni</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-01</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:jyrki.n@telia.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p></div></blockquote></div><p>The technique to do this is to add another dummy disk in your configuration with virtio enabled. When you manage to get dummy disk working with virtio drivers you can shutdown and change to virtio for your system disk too.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482831">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482832" class="blockpost roweven"> <h2><span><span class="conr">#3543</span> <a href="viewtopic.php?pid=1482832#p1482832">2014-12-09 05:37:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>Duelist, dozens of pages ago you posted a message on successfully installing windows 7 using ovmf</p><p>could you please specify all related details (qemu/libvirt configuration, win 7 iso &quot;type&quot;, steps taken, etc)?</p><p>already had 4 &quot;try sessions&quot; with no result</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1480029#p1480029" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 9#p1480029</a></p><p>Since i&#039;ve got strange problems with passing the bios via romfile option to my GPU(the UEFI freezes!), i reverted to BIOS and i dropped any thoughts about running OVMF with VFIO, so i&#039;ve done setting it up just with qemu&#039;s emulated graphics.</p></div></blockquote></div><p>oh, thanks. i somehow missed that post meaning, even though read it before.</p><p>well, seems like i&#039;m in for a pain train (ovmf+uefi win7 install).<br />one lost day and i got to the point where setup begs me for any drivers - seems like it does not see any disks to install to... which is pretty weird since diskpart in setup&#039;s recovery command prompt lists the disk image i&#039;m supposed to install to (tried all available hdd modes in virt-manager, including virtio)</p><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p></div></blockquote></div><p>google or search maybe? (googling &quot;switch windows to virtio&quot; or finding <a href="https://bbs.archlinux.org/viewtopic.php?pid=1478049#p1478049" rel="nofollow">this post</a> for example)</p> <p class="postedit"><em>Last edited by sinny (2014-12-09 05:49:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482832">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482917" class="blockpost rowodd"> <h2><span><span class="conr">#3544</span> <a href="viewtopic.php?pid=1482917#p1482917">2014-12-09 14:30:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87159">anthonym52</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-07</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87159">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>jyni wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p></div></blockquote></div><p>The technique to do this is to add another dummy disk in your configuration with virtio enabled. When you manage to get dummy disk working with virtio drivers you can shutdown and change to virtio for your system disk too.</p></div></blockquote></div><p>Haha, I was just thinking this would work too. (and it did!)</p><p>One more question, is everyone still using vfio-bind or is there a better way to do this now? </p><p>Here is my script, please help me optimize my settings.</p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash -x # # Notes: Survives reboots, works where others have failed # inspired by kidchunks &amp; aw on bbs.archlinux.org configfile=/etc/vfio-pci.cfg vfiobind() { dev=&quot;$1&quot; vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id } modprobe vfio-pci cat $configfile | while read line;do echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue vfiobind $line done GPU=$(lspci -D | grep VGA | grep -i gm107 | awk &#039;{print $1}&#039;) AUDIO=$(lspci -D |grep -i gm107 -A1|awk &#039;END{print $1}&#039;) MEM=8192 HUGE=&quot;-mem-path /dev/hugepages&quot; DISK=/media/ntfs/windows8.raw QEMU=/usr/local/bin/qemu-system-x86_64 NEED=$(( $MEM / 2 )) TOTAL=$(grep HugePages_Total /proc/meminfo | awk &#039;{print $NF}&#039;) WANT=$(( $TOTAL + $NEED )) echo $WANT &gt; /proc/sys/vm/nr_hugepages AVAIL=$(grep HugePages_Free /proc/meminfo | awk &#039;{print $NF}&#039;) if [ $AVAIL -lt $NEED ]; then echo $TOTAL &gt; /proc/sys/vm/nr_hugepages HUGE= fi QEMU_PA_SAMPLES=8192 QEMU_AUDIO_DRV=pa \ $QEMU \ -enable-kvm -cpu host,kvm=off \ -m $MEM $HUGE -smp 8,sockets=1,cores=4,threads=4 \ -bios /home/anthony/git/seabios/out/bios.bin -vga none \ -device intel-hda -device hda-output \ -device vfio-pci,host=$GPU,addr=03.0,multifunction=on,x-vga=on \ -device vfio-pci,host=$AUDIO,addr=03.1 \ -netdev tap,id=br0,vhost=on \ -device virtio-net-pci,mac=02:12:34:56:78:91,netdev=br0 \ -drive file=$DISK,cache=none,if=none,id=drive0,aio=threads \ -device virtio-blk-pci,drive=drive0,ioeventfd=on,bootindex=1 \ -vnc :0 -k en-us TOTAL=$(grep HugePages_Total /proc/meminfo | awk &#039;{print $NF}&#039;) RELEASE=$(( $TOTAL - $NEED )) echo $RELEASE &gt; /proc/sys/vm/nr_hugepages</code></pre></div><p>Other notes:<br />Kernel: 3.13.0-40-generic #69-Ubuntu SMP <br />Guest GPU: Nvidia 750TI with latest drivers<br />Grub boot opts: GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 hugepages=1&quot;<br />qemu version = 2.1.0, which seems to get a lot of &quot;KVM internal error. Suberror: 1&quot; crashes<br />Also, check out my setup running on my LG 34UM95-P with PBP: <a href="http://youtu.be/EFkLbEtj9cg" rel="nofollow">http://youtu.be/EFkLbEtj9cg</a></p> <p class="postedit"><em>Last edited by anthonym52 (2014-12-09 15:36:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482917">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482919" class="blockpost roweven"> <h2><span><span class="conr">#3545</span> <a href="viewtopic.php?pid=1482919#p1482919">2014-12-09 14:37:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>well, seems like i&#039;m in for a pain train (ovmf+uefi win7 install).<br />one lost day and i got to the point where setup begs me for any drivers - seems like it does not see any disks to install to... which is pretty weird since diskpart in setup&#039;s recovery command prompt lists the disk image i&#039;m supposed to install to (tried all available hdd modes in virt-manager, including virtio)</p></div></blockquote></div><p>Well, that seems strange. I&#039;ll try to dig it later. The main point is - windows 7 can be installed on bare metal hardware with UEFI and using GPT. If it lacks the drivers for disk controllers or OVMF is doing something strange - that&#039;s not windows&#039; problem. Hint: try booting something like livecd based on windows 7.</p><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p></div></blockquote></div><p>google or search maybe? (googling &quot;switch windows to virtio&quot; or finding <a href="https://bbs.archlinux.org/viewtopic.php?pid=1478049#p1478049" rel="nofollow">this post</a> for example)</p></div></blockquote></div><p>Ah, come on there, don&#039;t blame people for asking, you do stuff like that too;)</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482919">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1482978" class="blockpost rowodd"> <h2><span><span class="conr">#3546</span> <a href="viewtopic.php?pid=1482978#p1482978">2014-12-09 17:42:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>well, seems like i&#039;m in for a pain train (ovmf+uefi win7 install).<br />one lost day and i got to the point where setup begs me for any drivers - seems like it does not see any disks to install to... which is pretty weird since diskpart in setup&#039;s recovery command prompt lists the disk image i&#039;m supposed to install to (tried all available hdd modes in virt-manager, including virtio)</p></div></blockquote></div><p>Well, that seems strange. I&#039;ll try to dig it later. The main point is - windows 7 can be installed on bare metal hardware with UEFI and using GPT. If it lacks the drivers for disk controllers or OVMF is doing something strange - that&#039;s not windows&#039; problem. Hint: try booting something like livecd based on windows 7.</p></div></blockquote></div><p>i tried using i440fx - either setup is going mad about something different or microsoft completely dropped some old hardware drivers in win7-x64 (some doubt here)<br />or maybe problem is i am trying to install from self-made usb image attached as usb drive (iso that was converted to this usb image somehow refuses to be recognized by ovmf)</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>Does anyone know how to enable the virtio drivers after you&#039;ve already installed WIndows 8? Whenever I change my disk interface to virtio Windows explodes on boot.</p></div></blockquote></div><p>google or search maybe? (googling &quot;switch windows to virtio&quot; or finding <a href="https://bbs.archlinux.org/viewtopic.php?pid=1478049#p1478049" rel="nofollow">this post</a> for example)</p></div></blockquote></div><p>Ah, come on there, don&#039;t blame people for asking, you do stuff like that too;)</p></div></blockquote></div><p>well, i&#039;m pretty sure i mostly ask either on-topic things or not-that-easy-to-find-answer-to (or at least i want to think i do)</p> <p class="postedit"><em>Last edited by sinny (2014-12-09 17:44:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1482978">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1483189" class="blockpost roweven"> <h2><span><span class="conr">#3547</span> <a href="viewtopic.php?pid=1483189#p1483189">2014-12-10 09:18:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>well, seems like i&#039;m in for a pain train (ovmf+uefi win7 install).<br />one lost day and i got to the point where setup begs me for any drivers - seems like it does not see any disks to install to... which is pretty weird since diskpart in setup&#039;s recovery command prompt lists the disk image i&#039;m supposed to install to (tried all available hdd modes in virt-manager, including virtio)</p></div></blockquote></div><p>Well, that seems strange. I&#039;ll try to dig it later. The main point is - windows 7 can be installed on bare metal hardware with UEFI and using GPT. If it lacks the drivers for disk controllers or OVMF is doing something strange - that&#039;s not windows&#039; problem. Hint: try booting something like livecd based on windows 7.</p></div></blockquote></div><p>i tried using i440fx - either setup is going mad about something different or microsoft completely dropped some old hardware drivers in win7-x64 (some doubt here)<br />or maybe problem is i am trying to install from self-made usb image attached as usb drive (iso that was converted to this usb image somehow refuses to be recognized by ovmf)</p><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><br /><p>google or search maybe? (googling &quot;switch windows to virtio&quot; or finding <a href="https://bbs.archlinux.org/viewtopic.php?pid=1478049#p1478049" rel="nofollow">this post</a> for example)</p></div></blockquote></div><p>Ah, come on there, don&#039;t blame people for asking, you do stuff like that too;)</p></div></blockquote></div><p>well, i&#039;m pretty sure i mostly ask either on-topic things or not-that-easy-to-find-answer-to (or at least i want to think i do)</p></div></blockquote></div><p>I tried installing windows 7 using ovmf but i could never get it to work, i believe it needs the csm present, so i gave up and installed windows 8 with a patched ovmf to allow it to boot directly from the amd sata controller.<br /><a href="https://drive.google.com/open?id=0Bxp_MsrVrNnENVdsMGtVbTNDYkk&amp;authuser=0" rel="nofollow">OVMF-sata.tar.gz</a></p><p>Also, once you&#039;re done installing windows 8 <a href="http://winaero.com/blog/how-to-disable-or-enable-fast-startup-in-windows-8-1/" rel="nofollow">disable fast boot</a></p> <p class="postedit"><em>Last edited by nbhs (2014-12-10 10:13:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1483189">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1483247" class="blockpost rowodd"> <h2><span><span class="conr">#3548</span> <a href="viewtopic.php?pid=1483247#p1483247">2014-12-10 14:44:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87064">kidchunks</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-03</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87064">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>anthonym52 wrote:</cite><blockquote><div><p>One more question, is everyone still using vfio-bind or is there a better way to do this now?</p></div></blockquote></div><p>I&#039;ve done testing using pc/pci-assign and while it worked, I needed a virtual vga attached.</p><p>Example:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M pc -m 4096 -cpu host \ -smp 8,sockets=1,cores=4,threads=4 \ -bios /usr/share/seabios/bios.bin -vga cirrus \ -device pci-assign,host=85:00.0,addr=08.0,multifunction=on,prefer_msi=off \ -device pci-assign,host=85:00.1,addr=08.1 \ -drive file=/root/qemu/win8.img,cache=none,if=virtio \ -drive file=/root/qemu/win812.iso,index=0,media=cdrom \ -drive file=/root/qemu/virtio-win-0.1-81.iso,index=1,media=cdrom \ -usb -usbdevice host:046d:c068 \ -vnc :1 \ -usbdevice tablet \ -daemonize</code></pre></div><p>Stick with vfio-bind <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1483247">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1483466" class="blockpost roweven"> <h2><span><span class="conr">#3549</span> <a href="viewtopic.php?pid=1483466#p1483466">2014-12-11 06:06:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>...</p></div></blockquote></div><p>I tried installing windows 7 using ovmf but i could never get it to work, i believe it needs the csm present, so i gave up and installed windows 8 with a patched ovmf to allow it to boot directly from the amd sata controller.<br /><a href="https://drive.google.com/open?id=0Bxp_MsrVrNnENVdsMGtVbTNDYkk&amp;authuser=0" rel="nofollow">OVMF-sata.tar.gz</a></p><p>Also, once you&#039;re done installing windows 8 <a href="http://winaero.com/blog/how-to-disable-or-enable-fast-startup-in-windows-8-1/" rel="nofollow">disable fast boot</a></p></div></blockquote></div><p>i got working win 8 install - the problem is i want win 7 uefi vm (win 8 is a bit... inconvenient? not sure about the exact word).</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>... i believe it needs the csm present ...</p></div></blockquote></div><p>win 7 64 in uefi mode seems to support only installations to gpt, so i am not so sure csm (mbr compatibility fallback, as far as i understand it) will really do the trick</p><p>UPD:<br />ok, seems like i am wrong afterall and csm may really be a requirement (<a href="http://forums.lenovo.com/t5/T400-T500-and-newer-T-series/T440s-amp-Windows-7-in-UEFI-mode/td-p/1363325" rel="nofollow">source0</a>, <a href="https://forums.lenovo.com/t5/T400-T500-and-newer-T-series/Unable-to-Install-Windows-7-without-CSM-support-enabled-in-BIOS/ta-p/1038089" rel="nofollow">source1</a>)</p><p>will try using OVMF_{CODE,VARS}-with-csm.fd instead of OVMF_{CODE,VARS}-pure-efi.fd when i get some time to play with my setup</p> <p class="postedit"><em>Last edited by sinny (2014-12-11 06:44:52)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1483466">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1483475" class="blockpost rowodd"> <h2><span><span class="conr">#3550</span> <a href="viewtopic.php?pid=1483475#p1483475">2014-12-11 07:28:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>UPD:<br />ok, seems like i am wrong afterall and csm may really be a requirement (<a href="http://forums.lenovo.com/t5/T400-T500-and-newer-T-series/T440s-amp-Windows-7-in-UEFI-mode/td-p/1363325" rel="nofollow">source0</a>, <a href="https://forums.lenovo.com/t5/T400-T500-and-newer-T-series/Unable-to-Install-Windows-7-without-CSM-support-enabled-in-BIOS/ta-p/1038089" rel="nofollow">source1</a>)</p><p>will try using OVMF_{CODE,VARS}-with-csm.fd instead of OVMF_{CODE,VARS}-pure-efi.fd when i get some time to play with my setup</p></div></blockquote></div><p>Source1 in particular, speaks about &quot;legacy OEM video drivers&quot; - i guess that is related to VGA. Source0 - the writer says the same, he doesn&#039;t have &quot;high-res UEFI setup&quot; anymore, so that is VGA too.</p><p>Alright, today i have a free day dedicated to testing. But i&#039;m a little bit afraid of the fact that i&#039;ve got windows 7 installed on real UEFI hardware some time ago. I&#039;m not 100% sure if there was any compatibility issues, but i doubt that CSM was enabled on that system. Also, it wasn&#039;t a notebook, so no OEM unupdateable hardware.</p><p>As far as i understand it - the CSM actually provides VGA, aw told us a while ago about the fact that we explicitly do not want it.</p> <p class="postedit"><em>Last edited by Duelist (2014-12-11 07:29:46)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1483475">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=141">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=140">140</a> <a href="viewtopic.php?id=162768&amp;p=141">141</a> <strong>142</strong> <a href="viewtopic.php?id=162768&amp;p=143">143</a> <a href="viewtopic.php?id=162768&amp;p=144">144</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=143">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
