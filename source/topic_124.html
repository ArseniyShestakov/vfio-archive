<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 124) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=124" title="Page 124" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=123" title="Page 123" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=125" title="Page 125" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=123">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <strong>124</strong> <a href="viewtopic.php?id=162768&amp;p=125">125</a> <a href="viewtopic.php?id=162768&amp;p=126">126</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=125">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1470289" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3076</span> <a href="viewtopic.php?pid=1470289#p1470289">2014-10-28 09:49:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Casperian wrote:</cite><blockquote><div><p>Also thinking about trying pci-assign to see if it works.</p></div></blockquote></div><p>It won&#039;t. It&#039;s kinda deprecated.</p><p>Device code 12, afair, is &quot;not enough resources for a device to run&quot;. Since qemu says &quot;BAR 3 MMAP unsupported&quot; - it is not able to mmap BAR 3 - some(BAR 3 that is) region of memory is in use. Check lspci (with numerous -v and -n options) output for memory ranges, then check /proc/iomem and /proc/mtrr. Maybe you&#039;ll notice that your GPU is in use by something like vesa or nouveau, maybe you&#039;ll need to enable MTRR cleanup via kernel parameters. And what host GPU do you have?</p><p>Also you may be running into nvidia driver related problems - ensure that is not the case by disabling hyper-v extensions(or whatever it was) and hide kvm signature.</p><p>...aand you might not be needing that -bios line at all.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-28 09:50:16)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470289">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470298" class="blockpost roweven"> <h2><span><span class="conr">#3077</span> <a href="viewtopic.php?pid=1470298#p1470298">2014-10-28 10:39:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85506">gyrfalco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-30</span></dd> <dd><span>Posts: 10</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>My success story:</p><ul><li><p>ASRock FM2A88M Extreme4+ [UEFI BIOS 2.40]</p></li><li><p>AMD A10-6700 with Radeon HD 8670D</p></li><li><p>AMD Radeon HD 7870 [Gigabyte GV-R787OC-2GD - UEFI BIOS F11]</p></li><li><p>gentoo-sources-3.17.1 kernel without any patches for VGA-Passthrough</p></li><li><p>qemu-2.1.50</p></li><li><p>OVMF 16056-1 from <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a></p></li><li><p>Windows 8.1 with Catalyst driver v.14.9</p></li></ul><p>host: HD 8670D<br />guest: HD 7870</p><p>vfio-assign did not work for me (crash during radeon driver installation. with CCC or not, through setup.exe or Device Manager, seabios or UEFI-ovfm, with romfile or without), so I use good old <strong>pci-assign</strong> which works perfectly.</p><p>pci-stub in kernel cmdline with fix for ASRock FM2A88M Extreme4+ :</p><div class="codebox"><pre><code>iommu=pt ivrs_ioapic[5]=00:14.0 pci-stub.ids=1002:6818,1002:aab0</code></pre></div><p>Install:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 4096 -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -vga qxl -rtc base=localtime -pflash ovmf_x64.bin \ -device pci-assign,host=01:00.0 -device pci-assign,host=01:00.1 \ -device virtio-scsi-pci,id=scsi -drive file=windows8.img,if=virtio,id=disk_primary,format=raw \ -drive file=windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install \ -cdrom virtio-win-0.1-81.iso</code></pre></div><p>Run:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 4096 \ -cpu host,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 -smp 4,sockets=1,cores=4,threads=1 \ -vga none -rtc base=localtime -pflash ovmf_x64.bin \ -device pci-assign,host=01:00.0 \ -device virtio-scsi-pci,id=scsi -drive file=windows8.img,if=virtio,id=disk_primary,format=raw</code></pre></div><p>LuxMark (OpenCL) benchmark results: LuxBall HDR - Only selected devices (GPU Pitcairn):</p><p>Win8.1 native: 10730<br />Linux qemu-kvm vga-passthrough: 9208</p><p>Difference: <strong>14%</strong></p><p>Not bad? Or what?</p> <p class="postedit"><em>Last edited by gyrfalco (2014-10-28 10:40:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470298">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470335" class="blockpost rowodd"> <h2><span><span class="conr">#3078</span> <a href="viewtopic.php?pid=1470335#p1470335">2014-10-28 14:51:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>gyrfalco wrote:</cite><blockquote><div><p>My success story:</p><ul><li><p>ASRock FM2A88M Extreme4+ [UEFI BIOS 2.40]</p></li><li><p>AMD A10-6700 with Radeon HD 8670D</p></li><li><p>AMD Radeon HD 7870 [Gigabyte GV-R787OC-2GD - UEFI BIOS F11]</p></li><li><p>gentoo-sources-3.17.1 kernel without any patches for VGA-Passthrough</p></li><li><p>qemu-2.1.50</p></li><li><p>OVMF 16056-1 from <a href="https://aur.archlinux.org/packages/ovmf-svn" rel="nofollow">ovmf-svn</a></p></li><li><p>Windows 8.1 with Catalyst driver v.14.9</p></li></ul><p>host: HD 8670D<br />guest: HD 7870</p><p>vfio-assign did not work for me (crash during radeon driver installation. with CCC or not, through setup.exe or Device Manager, seabios or UEFI-ovfm, with romfile or without), so I use good old <strong>pci-assign</strong> which works perfectly.</p><p>pci-stub in kernel cmdline with fix for ASRock FM2A88M Extreme4+ :</p><div class="codebox"><pre><code>iommu=pt ivrs_ioapic[5]=00:14.0 pci-stub.ids=1002:6818,1002:aab0</code></pre></div><p>Install:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 4096 -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -vga qxl -rtc base=localtime -pflash ovmf_x64.bin \ -device pci-assign,host=01:00.0 -device pci-assign,host=01:00.1 \ -device virtio-scsi-pci,id=scsi -drive file=windows8.img,if=virtio,id=disk_primary,format=raw \ -drive file=windows8.iso,id=iso_install,if=none -device scsi-cd,drive=iso_install \ -cdrom virtio-win-0.1-81.iso</code></pre></div><p>Run:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -m 4096 \ -cpu host,hv_relaxed,hv_vapic,hv_spinlocks=0x1000 -smp 4,sockets=1,cores=4,threads=1 \ -vga none -rtc base=localtime -pflash ovmf_x64.bin \ -device pci-assign,host=01:00.0 \ -device virtio-scsi-pci,id=scsi -drive file=windows8.img,if=virtio,id=disk_primary,format=raw</code></pre></div><p>LuxMark (OpenCL) benchmark results: LuxBall HDR - Only selected devices (GPU Pitcairn):</p><p>Win8.1 native: 10730<br />Linux qemu-kvm vga-passthrough: 9208</p><p>Difference: <strong>14%</strong></p><p>Not bad? Or what?</p></div></blockquote></div><p>Surprising! But you&#039;ve used OVMF anyway. I think AW will tell us some difference. I thought that pci-assign was deprecated..</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470335">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470338" class="blockpost roweven"> <h2><span><span class="conr">#3079</span> <a href="viewtopic.php?pid=1470338#p1470338">2014-10-28 14:59:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>Surprising! But you&#039;ve used OVMF anyway. I think AW will tell us some difference. I thought that pci-assign was deprecated..</p></div></blockquote></div><p>Not really surprising with OVMF, Radeon cards don&#039;t require any quirks when running with EFI.&#160; Legacy KVM device assignment is deprecated though, so it will eventually be removed.&#160; I&#039;d certainly rather fix vfio if it&#039;s somehow getting in the way than endorse a solution using pci-assign.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470338">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470550" class="blockpost rowodd"> <h2><span><span class="conr">#3080</span> <a href="viewtopic.php?pid=1470550#p1470550">2014-10-29 08:09:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Sadly I&#039;m still having problems with the passthrough. I found an issue where vesafb was caused the bar 3 error (my fault. messed up with card was primary in the bios). Thank Duelist for the suggestions, helped a lot. </p><p>I updated to qemu 2.1.2&#160; and now my script looks like</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host,kvm=off \ -smp 4,sockets=1,cores=4,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,bus=root.1,addr=00.1 \ -usb -usbdevice host:046d:c52b \ -drive file=/home/server/windowstry.img,id=disk,format=raw -device ide-hd,bus=ide.0,drive=disk \ -drive file=/home/server/Downloads/Win.iso,id=isocd -device ide-cd,bus=ide.1,drive=isocd \ -boot menu=on</code></pre></div><p>I am still having a code 12 error as far as I can tell and the GPU is refusing to output anything out the back of it. My image got stuck in a repair loop so I&#039;ll see if the error has changed afterward.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470550">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470553" class="blockpost roweven"> <h2><span><span class="conr">#3081</span> <a href="viewtopic.php?pid=1470553#p1470553">2014-10-29 08:36:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am not sure with OVMF, but maybe add -vga none, to get rid of error code 12?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470553">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470581" class="blockpost rowodd"> <h2><span><span class="conr">#3082</span> <a href="viewtopic.php?pid=1470581#p1470581">2014-10-29 10:24:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Well, looks like I didn&#039;t save my edit...<br />Anyway with vga none, I am getting no output from the 750 and after ~ 30 seconds I get a kvm internal error.<br />Can&#039;t post the full message as I am using my phone but the cs of the message seemed to correspond to the cards memory listed in cat /proc/iomem<br />My mate passed a quadro through at the same time using similar hardware and following my steps. (the update was to solve his code 43 error). Do I need to get the cards rom and specify it?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470590" class="blockpost roweven"> <h2><span><span class="conr">#3083</span> <a href="viewtopic.php?pid=1470590#p1470590">2014-10-29 11:07:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>You need to check aw&#039;s vfio blog, about uefi rom, maybe you need rom file or/and your gpu doesn&#039;t have uefi rom?<br />Again not sure, my gigabyte gtx680 4gb works either way (without rom file option), I&#039;m using old vga way with patches, since I have 0 problems with it.</p> <p class="postedit"><em>Last edited by slis (2014-10-29 11:09:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470590">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470598" class="blockpost rowodd"> <h2><span><span class="conr">#3084</span> <a href="viewtopic.php?pid=1470598#p1470598">2014-10-29 11:42:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>What patches are you running? I am running none (although a lot of fixes) cause I don&#039;t have an igpu to worry about. I&#039;m still trying the vga way for now, just started looking at ovmf recently but am considering just putting the old way aside for now and trying it.</p> <p class="postedit"><em>Last edited by Casperian (2014-10-29 11:53:24)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470598">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470612" class="blockpost roweven"> <h2><span><span class="conr">#3085</span> <a href="viewtopic.php?pid=1470612#p1470612">2014-10-29 12:28:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>I am not sure with OVMF, but maybe add -vga none, to get rid of error code 12?</p></div></blockquote></div><p>Are you sure he is using OVMF? His commandline &quot;script&quot; doesn&#039;t do anything related. Some time ago there was even explicitly qemu&#039;s bios via -bios option.<br />If he&#039;s fine without OVMF - let it be. Because UEFI is tricky.</p><p>The UEFI trickiness:<br />1.My GPUs still have old VGA bios inside. I have a new, hybrid VGA-UEFI bios, but i&#039;m unable to flash it hardware-wise and it appear to cause hangups on my qemu machine when using -romfile option. YMMV, but better be safe.<br />2.Windows. &quot;We explicitly do not want CSM&quot;. I am not sure if you don&#039;t need to reinstall windows in order to get it working under UEFI if there was BIOS during the installation process. I guess there may be some details related to the bootloader.</p><p>When using vfio x-vga=on, you HAVE TO -vga none. Only that way you&#039;re getting output of you GPU.<br />When you are debugging something, like, uninstalling drivers, you can -vga std/qxl BUT YOU HAVE TO x-vga=off.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-29 12:38:58)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470612">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470614" class="blockpost rowodd"> <h2><span><span class="conr">#3086</span> <a href="viewtopic.php?pid=1470614#p1470614">2014-10-29 12:34:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I use acs_override and i915 patch with 3.15 kernel.</p><p>edit:<br />yeah i just saw that he isn&#039;t using omvf...</p><p>unrelated (my question):</p><p>when u specify&#160; &lt;qemu:arg value=&#039;if=pflash,format=raw,readonly,file=/root/OVMF-pure-efi.fd&#039;/&gt; in xml.</p><p>Does that mean that i am 100% using efi, or?</p> <p class="postedit"><em>Last edited by slis (2014-10-29 12:44:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470614">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470649" class="blockpost roweven"> <h2><span><span class="conr">#3087</span> <a href="viewtopic.php?pid=1470649#p1470649">2014-10-29 14:37:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>unrelated (my question):</p><p>when u specify&#160; &lt;qemu:arg value=&#039;if=pflash,format=raw,readonly,file=/root/OVMF-pure-efi.fd&#039;/&gt; in xml.</p><p>Does that mean that i am 100% using efi, or?</p></div></blockquote></div><p>You will also have to connect OVMF-VARS.<br />Check<br /><a href="http://awilliam.github.io/presentations/KVM-Forum-2014/#/4/2" rel="nofollow">http://awilliam.github.io/presentations … 2014/#/4/2</a><br />this slide from alex&#039;s presentation for exact example of using OVMF split image with libvirt.</p> <p class="postedit"><em>Last edited by Duelist (2014-10-29 14:38:11)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470649">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470650" class="blockpost rowodd"> <h2><span><span class="conr">#3088</span> <a href="viewtopic.php?pid=1470650#p1470650">2014-10-29 14:38:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>I am not sure with OVMF, but maybe add -vga none, to get rid of error code 12?</p></div></blockquote></div><p>Are you sure he is using OVMF? His commandline &quot;script&quot; doesn&#039;t do anything related. Some time ago there was even explicitly qemu&#039;s bios via -bios option.<br />If he&#039;s fine without OVMF - let it be. Because UEFI is tricky.</p><p>The UEFI trickiness:<br />1.My GPUs still have old VGA bios inside. I have a new, hybrid VGA-UEFI bios, but i&#039;m unable to flash it hardware-wise and it appear to cause hangups on my qemu machine when using -romfile option. YMMV, but better be safe.<br />2.Windows. &quot;We explicitly do not want CSM&quot;. I am not sure if you don&#039;t need to reinstall windows in order to get it working under UEFI if there was BIOS during the installation process. I guess there may be some details related to the bootloader.</p><p>When using vfio x-vga=on, you HAVE TO -vga none. Only that way you&#039;re getting output of you GPU.<br />When you are debugging something, like, uninstalling drivers, you can -vga std/qxl BUT YOU HAVE TO x-vga=off.</p></div></blockquote></div><p>I would certainly NOT expect that you can move a BIOS guest image to EFI without doing a re-install.&#160; These are fundamentally different boot interfaces for the guest.</p><p>Casperian, why are you using Q35?&#160; Try 440FX.&#160; EDIT: and if you get no VGA output, VGA arbitration is probably an issue.&#160; Check the FAQ in the link below.</p> <p class="postedit"><em>Last edited by aw (2014-10-29 14:42:35)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470650">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470704" class="blockpost roweven"> <h2><span><span class="conr">#3089</span> <a href="viewtopic.php?pid=1470704#p1470704">2014-10-29 17:26:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The video for my talk is up: <a href="https://www.youtube.com/watch?v=NhZ9eIpg2nM" rel="nofollow">https://www.youtube.com/watch?v=NhZ9eIpg2nM</a></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470704">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470750" class="blockpost rowodd"> <h2><span><span class="conr">#3090</span> <a href="viewtopic.php?pid=1470750#p1470750">2014-10-29 19:30:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83182">kristopher004</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-30</span></dd> <dd><span>Posts: 31</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83182">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>For 3.18 what options do you guys select in kernel config to get virtual networks to work in libvirt?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470750">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470768" class="blockpost roweven"> <h2><span><span class="conr">#3091</span> <a href="viewtopic.php?pid=1470768#p1470768">2014-10-29 20:19:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hi there! this thread is much appreciated. I am trying to passthrough my MSI GTX 980 Gaming to Windows 8.1. I followed this guide, but I get a Code 43 error. Then I found this: <a href="http://vfio.blogspot.de/2014/08/vfiovga-faq.html" rel="nofollow">http://vfio.blogspot.de/2014/08/vfiovga-faq.html</a></p><p>In there this is stated:</p><div class="quotebox"><blockquote><div><p><strong>Question 10:</strong></p><p>I&#039;m assigning an Nvidia card to a Windows guest and get a Code 43 error in device manager.</p><p>Answer:</p><p>The Nvidia driver, starting with 337.88 identifies the hypervisor and disables the driver when KVM is found.&#160; Nvidia claims this is an unintentional bug, but has no plans to fix it.&#160; To work around the problem, we can hide the hypervisor by adding kvm=off to the list of cpu options provided (QEMU 2.1+ required).&#160; libvirt support for this option is currently upstream.</p><p> Note that -cpu kvm=off is not a valid incantation of the cpu parameter, a CPU model such as host, or SandyBridge must also be provided, ex: -cpu host,kvm=off.</p><p>Update: The above workaround is sufficient for drivers 337.88 and 340.52.&#160; With 344.11 and presumably later, the Hyper-V CPUID extensions supported by KVM also trigger the Code 43 error.&#160; Disabling these extensions appears to be sufficient to allow the 344.11 driver to work.&#160; <strong>This includes all of the hv_* options to -cpu.&#160; In libvirt, this includes:</strong></p><p>&#160; &#160; &#160;&lt;hyperv&gt;<br />&#160; &#160; &#160; &lt;relaxed state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;vapic state=&#039;on&#039;/&gt;<br />&#160; &#160; &#160; &lt;spinlocks state=&#039;on&#039; retries=&#039;8191&#039;/&gt;</p><p>&#160; &#160; &lt;/hyperv&gt;</p><p>and</p><p>&#160; &lt;clock offset=&#039;localtime&#039;&gt;</p><p>&#160; &#160; &lt;timer name=&#039;hypervclock&#039; present=&#039;yes&#039;/&gt;</p><p>&#160; &lt;/clock&gt;</p><p>Unfortunately removing these options will impose a performance penalty as these paravirtual interfaces are designed to improve the efficiency of virtual machines.</p></div></blockquote></div><br /><p>Now: I don&#039;t even have libvirt installed. Do I need it for Nvidia passthrough? Thanks a lot for any help! I am really excited about this project.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470768">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470773" class="blockpost rowodd"> <h2><span><span class="conr">#3092</span> <a href="viewtopic.php?pid=1470773#p1470773">2014-10-29 20:37:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Now: I don&#039;t even have libvirt installed. Do I need it for Nvidia passthrough? Thanks a lot for any help! I am really excited about this project.</p></div></blockquote></div><p>No, libvirt is not required, it&#039;s provided as an example, but don&#039;t forget to notice the comment about removing all the hv_* options from the -cpu parameter.&#160; Try with just &quot;-cpu host,kvm=off&quot; (and make sure you&#039;re running a new enough QEMU to support the kvm=off option, QEMU 2.1 or newer).&#160; If you&#039;re using OVMF then you need to be using qemu.git to have the Nvidia quirk turned on without x-vga=on (it will be in QEMU 2.2)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470773">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470779" class="blockpost roweven"> <h2><span><span class="conr">#3093</span> <a href="viewtopic.php?pid=1470779#p1470779">2014-10-29 21:03:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thank you very much Alex! I am using <strong>qemu-git-2.2.r35796.gff0d487-1</strong> I hope that&#039;s the right one. On my test Setup, I have no LVM, no GPT and no UEFI and I also use &quot;-cpu-host,kvm=off&quot;, but I still have that error. This is how I start Windows 8.1:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -M q35 -m 8G -cpu host,kvm=off \<br />-smp 6,sockets=1,cores=6,threads=1 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-drive file=/root/windows.img,id=disk,format=raw \<br />-cdrom /root/windows.iso \<br />-usb -usbdevice host:046d:c312</p></div></blockquote></div><p>is there an obvious mistake?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470779">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470780" class="blockpost rowodd"> <h2><span><span class="conr">#3094</span> <a href="viewtopic.php?pid=1470780#p1470780">2014-10-29 21:05:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I am using Q35 because my end goal is to have a linux based VM with access to cuda enabled GPU. Just doing it with windows for now though.</p><p>Been looking into VGA arbitration and yeah... seems like that is my problems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470780">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470781" class="blockpost roweven"> <h2><span><span class="conr">#3095</span> <a href="viewtopic.php?pid=1470781#p1470781">2014-10-29 21:06:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86261">Casperian</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-10-28</span></dd> <dd><span>Posts: 6</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>thank you very much Alex! I am using <strong>qemu-git-2.2.r35796.gff0d487-1</strong> I hope that&#039;s the right one. On my test Setup, I have no LVM, no GPT and no UEFI and I also use &quot;-cpu-host,kvm=off&quot;, but I still have that error. This is how I start Windows 8.1:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -M q35 -m 8G -cpu host,kvm=off \<br />-smp 6,sockets=1,cores=6,threads=1 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-drive file=/root/windows.img,id=disk,format=raw \<br />-cdrom /root/windows.iso \<br />-usb -usbdevice host:046d:c312</p></div></blockquote></div><p>is there an obvious mistake?</p></div></blockquote></div><p>You don&#039;t seem to have -vga none, unless I am blind which is possible</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470781">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470782" class="blockpost rowodd"> <h2><span><span class="conr">#3096</span> <a href="viewtopic.php?pid=1470782#p1470782">2014-10-29 21:07:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>thank you very much Alex! I am using <strong>qemu-git-2.2.r35796.gff0d487-1</strong> I hope that&#039;s the right one. On my test Setup, I have no LVM, no GPT and no UEFI and I also use &quot;-cpu-host,kvm=off&quot;, but I still have that error. This is how I start Windows 8.1:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64 -enable-kvm -M q35 -m 8G -cpu host,kvm=off \<br />-smp 6,sockets=1,cores=6,threads=1 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \<br />-drive file=/root/windows.img,id=disk,format=raw \<br />-cdrom /root/windows.iso \<br />-usb -usbdevice host:046d:c312</p></div></blockquote></div><p>is there an obvious mistake?</p></div></blockquote></div><p>If you&#039;re using VGA then you may need host kernel patches for the VGA arbiter to work correctly.&#160; You&#039;re also missing &quot;-vga none&quot;.&#160; (And I keep dis-recommending Q35, it&#039;s not needed for Windows guests)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470782">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470890" class="blockpost roweven"> <h2><span><span class="conr">#3097</span> <a href="viewtopic.php?pid=1470890#p1470890">2014-10-30 06:45:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>unrelated (my question):</p><p>when u specify&#160; &lt;qemu:arg value=&#039;if=pflash,format=raw,readonly,file=/root/OVMF-pure-efi.fd&#039;/&gt; in xml.</p><p>Does that mean that i am 100% using efi, or?</p></div></blockquote></div><p>You will also have to connect OVMF-VARS.<br />Check<br /><a href="http://awilliam.github.io/presentations/KVM-Forum-2014/#/4/2" rel="nofollow">http://awilliam.github.io/presentations … 2014/#/4/2</a><br />this slide from alex&#039;s presentation for exact example of using OVMF split image with libvirt.</p></div></blockquote></div><p>I just checked my win8 vm, i just added OVMF-pure-efi.fd, then selected boot device from &quot;bios&quot;/installed win8, and windows says that it&#039;s using UEFI, are OVMF-VARS needed/built? Or they are generated?</p><p>thx</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470890">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470958" class="blockpost rowodd"> <h2><span><span class="conr">#3098</span> <a href="viewtopic.php?pid=1470958#p1470958">2014-10-30 13:06:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>I just checked my win8 vm, i just added OVMF-pure-efi.fd, then selected boot device from &quot;bios&quot;/installed win8, and windows says that it&#039;s using UEFI, are OVMF-VARS needed/built? Or they are generated?</p></div></blockquote></div><p>If your OVMF-pure-efi.fd is exactly 2MB, then it&#039;s a unified image that contains the code alongside the variable storage in the same image.&#160; In this case each VM should have a writable copy of the image.&#160; This works, but makes it difficult to upgrade the UEFI image and retain the variables.&#160; Fortunately you likely don&#039;t care about the variables and the win8 bootloader seems to automatically regenerate them on every boot.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470958">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1470961" class="blockpost roweven"> <h2><span><span class="conr">#3099</span> <a href="viewtopic.php?pid=1470961#p1470961">2014-10-30 13:16:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Got it, thx for explanation.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1470961">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1471006" class="blockpost rowodd"> <h2><span><span class="conr">#3100</span> <a href="viewtopic.php?pid=1471006#p1471006">2014-10-30 14:42:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>And I keep dis-recommending Q35, it&#039;s not needed for Windows guests</p></div></blockquote></div><p>Can you write a somewhat detailed answer about the reason why Q35 is bad? Or is it covered in your speech(which i haven&#039;t watched yet)?<br />EDIT:Now i&#039;ve watched your speech, and it doesn&#039;t solves the puzzle for me.<br />Okay, 440FX is just older, and it&#039;s more bug-free and stable. Is that the only reason to favor it over Q35?</p> <p class="postedit"><em>Last edited by Duelist (2014-10-30 15:09:51)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1471006">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=123">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=122">122</a> <a href="viewtopic.php?id=162768&amp;p=123">123</a> <strong>124</strong> <a href="viewtopic.php?id=162768&amp;p=125">125</a> <a href="viewtopic.php?id=162768&amp;p=126">126</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=125">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
