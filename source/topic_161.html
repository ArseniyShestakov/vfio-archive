<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 161) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=161" title="Page 161" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=160" title="Page 160" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=162" title="Page 162" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=160">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=159">159</a> <a href="viewtopic.php?id=162768&amp;p=160">160</a> <strong>161</strong> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=162">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1498216" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4001</span> <a href="viewtopic.php?pid=1498216#p1498216">2015-01-30 23:52:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>There are really very, very few reasons that anyone here should be using &lt;qemu:arg&gt; options any longer.&#160; If you are, you&#039;re probably doing something wrong.</p></div></blockquote></div><p>Correct me if I&#039;m wrong, but Win 7 guests and below who use libvirt will still use qemu:arg since apparently OVMF + EFI + Win 7 seems pretty fragile, at least from what I&#039;ve read here.&#160; So you&#039;re referring to Win 8+</p></div></blockquote></div><p>No, you should be using a wrapper script around the qemu binary to add the x-vga=on option so that libvirt can manage the vfio device itself.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498216">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498218" class="blockpost roweven"> <h2><span><span class="conr">#4002</span> <a href="viewtopic.php?pid=1498218#p1498218">2015-01-31 00:01:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hmm obviously I missed that somewhere, could you give a link to the page number? EDIT: never mind, found it post 3262... whoops too late thanks though</p> <p class="postedit"><em>Last edited by mostlyharmless (2015-01-31 00:05:32)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498218">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498220" class="blockpost rowodd"> <h2><span><span class="conr">#4003</span> <a href="viewtopic.php?pid=1498220#p1498220">2015-01-31 00:04:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mostlyharmless wrote:</cite><blockquote><div><p>Hmm obviously I missed that somewhere, could you give a link to the page number?</p></div></blockquote></div><p><a href="https://bbs.archlinux.org/viewtopic.php?pid=1475541#p1475541" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 1#p1475541</a></p><p>EDIT: PS, letting libvirt manage the device is how you avoid needing to elevate permissions for the VM or run it as root.&#160; You should not need to touch anything in /etc/libvirt/qemu.conf</p> <p class="postedit"><em>Last edited by aw (2015-01-31 01:32:41)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498220">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498238" class="blockpost roweven"> <h2><span><span class="conr">#4004</span> <a href="viewtopic.php?pid=1498238#p1498238">2015-01-31 03:25:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88373">dhiru1602</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-28</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88373">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Guys, <a href="http://vfio.blogspot.in/2014/09/vfio-interrupts-and-how-to-coax-windows.html" rel="nofollow">GIVE THIS A READ</a>.</p><p>Checking the Device Manager in my Windows guest, I have noticed that my GPU was not using MSI. I have followed the guide linked to Alex&#039;s blog post and I had made the registry changes in Windows and I was able to get around 10% improvement in benchmarks and the overall performance has definitely improved. I will link the benchmark results later.</p><p>Thanks &quot;aw&quot; for your hardwork!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498238">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498305" class="blockpost rowodd"> <h2><span><span class="conr">#4005</span> <a href="viewtopic.php?pid=1498305#p1498305">2015-01-31 11:27:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71440">cdrjameson</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/71440.png?m=1392914202" width="80" height="73" alt="" /></dd> <dd><span>Registered: 2013-05-19</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=71440">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> ...you&#039;re probably doing something wrong.</p></div></blockquote></div><p> You&#039;re absolutely right!</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>I&#039;d try the latter set, but you&#039;re missing an update to those instructions here:<br /><a href="http://vfio.blogspot.com/2014/09/libvir" rel="nofollow">http://vfio.blogspot.com/2014/09/libvir</a> … -ovmf.html<br />My slides from KVM Forum include a further updated setup (hit space a couple times):<br /><a href="http://awilliam.github.io/presentations" rel="nofollow">http://awilliam.github.io/presentations</a> … 2014/#/4/2</p></div></blockquote></div><p>Thanks for this direction Alex, I thought I had read most things but my comprehension of what it all means is somewhat lacking. <br />I have set up the VM using virt-manager and am trying to edit the domain xml. I have installed the ovmf-svn package from the AUR but I am confused to what I should edit these lines to: </p><div class="codebox"><pre><code>&lt;domain type=&#039;kvm&#039;&gt; ... &lt;os&gt; &lt;loader readonly=&#039;yes&#039; type=&#039;pflash&#039;&gt;/usr/share/edk2.git/ovmf-x64/OVMF_CODE-pure-efi.fd&lt;/loader&gt; &lt;nvram template=&#039;/usr/share/edk2.git/ovmf-x64/OVMF_VARS-pure-efi.fd&#039;/&gt; ... &lt;/os&gt; &lt;/domain&gt;</code></pre></div><p>I am confused because under /usr/share I do not have an edk2.git directory and: </p><div class="codebox"><pre><code> # find / -name edk2* </code></pre></div><p> returns nothing.</p><p>*Edit* </p><div class="codebox"><pre><code>$ pacman -Ql ovmf-svn ovmf-svn /usr/ ovmf-svn /usr/share/ ovmf-svn /usr/share/ovmf/ ovmf-svn /usr/share/ovmf/ia32/ ovmf-svn /usr/share/ovmf/ia32/ovmf_code_ia32.bin ovmf-svn /usr/share/ovmf/ia32/ovmf_ia32.bin ovmf-svn /usr/share/ovmf/ia32/ovmf_vars_ia32.bin ovmf-svn /usr/share/ovmf/x64/ ovmf-svn /usr/share/ovmf/x64/ovmf_code_x64.bin ovmf-svn /usr/share/ovmf/x64/ovmf_vars_x64.bin ovmf-svn /usr/share/ovmf/x64/ovmf_x64.bin</code></pre></div><p>Which of these, if any, do I need to point to in the domain xml list?</p> <p class="postedit"><em>Last edited by cdrjameson (2015-01-31 11:44:16)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498305">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498347" class="blockpost roweven"> <h2><span><span class="conr">#4006</span> <a href="viewtopic.php?pid=1498347#p1498347">2015-01-31 14:40:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>cdrjameson wrote:</cite><blockquote><div><div class="codebox"><pre><code>$ pacman -Ql ovmf-svn ovmf-svn /usr/ ovmf-svn /usr/share/ ovmf-svn /usr/share/ovmf/ ovmf-svn /usr/share/ovmf/ia32/ ovmf-svn /usr/share/ovmf/ia32/ovmf_code_ia32.bin ovmf-svn /usr/share/ovmf/ia32/ovmf_ia32.bin ovmf-svn /usr/share/ovmf/ia32/ovmf_vars_ia32.bin ovmf-svn /usr/share/ovmf/x64/ ovmf-svn /usr/share/ovmf/x64/ovmf_code_x64.bin &lt;--- CODE ovmf-svn /usr/share/ovmf/x64/ovmf_vars_x64.bin &lt;--- VARS ovmf-svn /usr/share/ovmf/x64/ovmf_x64.bin</code></pre></div></div></blockquote></div> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498347">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498425" class="blockpost rowodd"> <h2><span><span class="conr">#4007</span> <a href="viewtopic.php?pid=1498425#p1498425">2015-01-31 20:46:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Ok so I&#039;ve finally setup serial console and my host is finally headless. I was able to capture this when restarting virtual machine, which is Windows 7 (no EFI). This happens when VM is started after guest reboot </p><div class="codebox"><pre><code>[ 250.730914] kernel BUG at drivers/pci/ats.c:138!</code></pre></div><p>My kernel is 3.17.8 , I&#039;m planning upgrade to 3.18 &quot;any moment now&quot; but due to zfs used as a root filesystem this requires little work. This only happens if I restart virtual machine which is using FirePro W7100 - restart of the other virtual machine using FirePro V4900 does not trigger this bug. After hitting this bug it is not possible to gracefully shutdown qemu.</p></div></blockquote></div><p>That&#039;s saying that the device had ATS (Address Translation Services) enabled before reset, but when we went to restore the state of it after reset, we couldn&#039;t even find the capability.&#160; Maybe the device never really recovers from reset?</p></div></blockquote></div><p>Got it. I suppose I should complain to AMD support ...</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498425">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498516" class="blockpost roweven"> <h2><span><span class="conr">#4008</span> <a href="viewtopic.php?pid=1498516#p1498516">2015-02-01 03:13:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=55900">spijet</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-01-10</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=55900">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Good morning everyone! First of all, thank you <strong>nbhs</strong> for your awesome KVM guide and giving me a hope of using my GPU with KVM! <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p>However, I&#039;m having a little problem here with my setup.</p><p>I&#039;ve managed to &#039;unbind&#039; the GPU from the host and do the vfio-bind stuff and it seems that QEMU picks it up and tries to use it, but I don&#039;t see anything on the screen: it&#039;s either &quot;no signal&quot; warning and then powersave mode, or just the black screen&#160; (the monitor, however, acts as if there is something, no powersave).<br />When I tried to boot archiso in guest, it detected the GPU properly (when nouveau module had started). Everything else gives me a black screen: qemu-bios, OVMF, Windows, etc.<br />When I was playing with qemu options, I&#039;ve got Windows to display its bootloader (but no bios) on the screen, but then it gave me a BSOD. <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /> After that, nothing again.</p><p>The only thing I think I&#039;m doing wrong is that I&#039;m trying to build a system with totally headless host - 1 GPU for guest only (I&#039;m doing everything from my laptop over SSH).</p><p>Here&#039;s my config:</p><div class="codebox"><pre><code>Motherboard: ASUS M5A97 (with fixed IVRS table -- see boot options) CPU: AMD FX-4100 RAM: 8GB DDR3, trying to pass 4-6GB to the VM GPU: Gigabyte NV-65TOC1GI (nVidia GeForce GTX 650Ti 1GB), VBIOS F21 Arch Linux x86_64, linux 3.18.4-1-ARCH Boot cmdline: dolvm root=/dev/mapper/roccatbase-baseroot rw ivrs_ioapic[5]=00:14.0 ivrs_ioapic[6]=00:00.1 pci-stub.ids=10de:11c6,10de:0e0b video=efifb:off lspci: 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK106 [GeForce GTX 650 Ti] [10de:11c6] (rev a1) 01:00.1 Audio device [0403]: NVIDIA Corporation GK106 HDMI Audio Controller [10de:0e0b] (rev a1) cat /etc/vfio-pci.cfg DEVICES=&quot;0000:01:00.0 0000:01:00.1&quot; I use QEMU-git 2.2.r36653.ga46b3aa-1.</code></pre></div><p><a href="https://bpaste.net/show/45826476d48f" rel="nofollow">Here</a> are some qemu scripts that I&#039;m trying to boot.</p><br /><p>Is there anything else I can do to make it work, or should I give up the idea of using only one GPU?</p><br /><p>ADD: I&#039;ve just boot Fedora 21 x86_64 live iso with my testvm5.sh script and it works flawlessly! I&#039;ve added my USB keyboard and mouse to the script and now I can use it pretty much like if it was bare-metal installation. But still, I didn&#039;t see OVMF bios on my screen, instead it showed up in text console I was running testvm5.sh from. O_o</p><p>ADD2:I replaced 2 usb device entries in my script with one USB controller, which I&#039;m passing through via VFIO-PCI. Now I can see the (possible?) cause of my problem.<br />In system logs, when the devices are initialised, I can see some vfio-pci messages about reserving IRQs for PCI devices. When I used Fedora ISO, I got this:</p><div class="codebox"><pre><code>Feb 01 12:43:12 roccatbase kernel: vfio-pci 0000:03:00.0: enabling device (0400 -&gt; 0402) Feb 01 12:43:15 roccatbase kernel: kvm: zapping shadow pages for mmio generation wraparound Feb 01 12:43:24 roccatbase kernel: kvm [807]: vcpu0 ignored rdmsr: 0xc0010112 Feb 01 12:43:24 roccatbase kernel: kvm [807]: vcpu0 unimplemented perfctr wrmsr: 0xc0010004 data 0xffff Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 33 for MSI/MSI-X Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 33 for MSI/MSI-X Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 34 for MSI/MSI-X Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 33 for MSI/MSI-X Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 34 for MSI/MSI-X Feb 01 12:43:25 roccatbase kernel: vfio-pci 0000:03:00.0: irq 35 for MSI/MSI-X Feb 01 12:43:26 roccatbase kernel: vfio-pci 0000:01:00.0: irq 36 for MSI/MSI-X</code></pre></div><p>01:00.0 is the pci-id of my GPU and 03:00.0 is my USB controller. The GPU starts up shortly after I get the last message.</p><p>But when trying to boot Windows, I get:</p><div class="codebox"><pre><code>Feb 01 13:22:39 roccatbase kernel: kvm: zapping shadow pages for mmio generation wraparound Feb 01 13:23:17 roccatbase kernel: vfio-pci 0000:03:00.0: irq 33 for MSI/MSI-X ... Feb 01 13:23:17 roccatbase kernel: vfio-pci 0000:03:00.0: irq 39 for MSI/MSI-X Feb 01 13:23:17 roccatbase kernel: vfio-pci 0000:03:00.0: irq 40 for MSI/MSI-X</code></pre></div><p>And there&#039;s no pci-id of the GPU. The only thing I&#039;ve changed was the cdrom entry.</p> <p class="postedit"><em>Last edited by spijet (2015-02-01 05:30:10)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498541" class="blockpost rowodd"> <h2><span><span class="conr">#4009</span> <a href="viewtopic.php?pid=1498541#p1498541">2015-02-01 09:24:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88205">nythrix</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-22</span></dd> <dd><span>Posts: 4</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>3. Dude, check this out! A whole table with stats and graphics and stuff!<br /><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a></p></div></blockquote></div><p>What the...? I am speechless! Why isn&#039;t this awesome list on the first page??? I spent months shopping for compatible hardware and never ever saw this! Damn you, gianormous thread! <img src="https://bbs.archlinux.org/img/smilies/big_smile.png" width="15" height="15" alt="big_smile" /></p><p>On a side note: I fixed my audio cracking/popping issues by forcing the same format (16bit x 44100Hz) in both the guest and the host. Hooray!</p> <p class="postedit"><em>Last edited by nythrix (2015-02-01 09:27:25)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498541">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498605" class="blockpost roweven"> <h2><span><span class="conr">#4010</span> <a href="viewtopic.php?pid=1498605#p1498605">2015-02-01 14:35:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I fixed my &quot;boot entries problem for OVMF&quot; now the next problem is &quot;ACS&quot;.... QEMU nonUEFI worked flawlessly for me but I had to compile kernel because of ACS patch thats why I&#039;m trying OVMF. Now the problem is that OVMF is not working without ACS patch.</p><p>Am I missing something here? Wasnt OVMF fixing the ACS problem in the first place? Are there any commands/options/settings that I&#039;m missing here? </p><p>Please help!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498605">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498607" class="blockpost rowodd"> <h2><span><span class="conr">#4011</span> <a href="viewtopic.php?pid=1498607#p1498607">2015-02-01 14:36:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I fixed my &quot;boot entries problem for OVMF&quot; now the next problem is &quot;ACS&quot;.... QEMU nonUEFI worked flawlessly for me but I had to compile kernel because of ACS patch thats why I&#039;m trying OVMF. Now the problem is that OVMF is not working without ACS patch.</p><p>Am I missing something here? Wasnt OVMF fixing the ACS problem in the first place? Are there any commands/options/settings that I&#039;m missing here?</p></div></blockquote></div><p>OVMF does not change anything about ACS.&#160; ACS is a hardware isolation issue.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498607">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498608" class="blockpost roweven"> <h2><span><span class="conr">#4012</span> <a href="viewtopic.php?pid=1498608#p1498608">2015-02-01 14:37:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I fixed my &quot;boot entries problem for OVMF&quot; now the next problem is &quot;ACS&quot;.... QEMU nonUEFI worked flawlessly for me but I had to compile kernel because of ACS patch thats why I&#039;m trying OVMF. Now the problem is that OVMF is not working without ACS patch.</p><p>Am I missing something here? Wasnt OVMF fixing the ACS problem in the first place? Are there any commands/options/settings that I&#039;m missing here?</p></div></blockquote></div><p>OVMF does not change anything about ACS.&#160; ACS is a hardware isolation issue.</p></div></blockquote></div><p>I understand, but im 100% positive that I saw numerous times that with OVMF one does not need ACS override patch?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498608">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498609" class="blockpost rowodd"> <h2><span><span class="conr">#4013</span> <a href="viewtopic.php?pid=1498609#p1498609">2015-02-01 14:38:42</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>I fixed my &quot;boot entries problem for OVMF&quot; now the next problem is &quot;ACS&quot;.... QEMU nonUEFI worked flawlessly for me but I had to compile kernel because of ACS patch thats why I&#039;m trying OVMF. Now the problem is that OVMF is not working without ACS patch.</p><p>Am I missing something here? Wasnt OVMF fixing the ACS problem in the first place? Are there any commands/options/settings that I&#039;m missing here?</p></div></blockquote></div><p>OVMF does not change anything about ACS.&#160; ACS is a hardware isolation issue.</p></div></blockquote></div><p>I understand, but im 100% positive that I saw numerous times that with OVMF one does not need ACS override patch?</p></div></blockquote></div><p>You are 100% wrong.&#160; With OVMF you don&#039;t need the i915 VGA arbitration patch.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498609">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498611" class="blockpost roweven"> <h2><span><span class="conr">#4014</span> <a href="viewtopic.php?pid=1498611#p1498611">2015-02-01 14:44:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>OVMF does not change anything about ACS.&#160; ACS is a hardware isolation issue.</p></div></blockquote></div><p>I understand, but im 100% positive that I saw numerous times that with OVMF one does not need ACS override patch?</p></div></blockquote></div><p>You are 100% wrong.&#160; With OVMF you don&#039;t need the i915 VGA arbitration patch.</p></div></blockquote></div><p>So your saying to passthrough bus 2 GPU and bus 3 GPU to 2 different VMs - it does not matter whether OVMF or legacy ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498611">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498627" class="blockpost rowodd"> <h2><span><span class="conr">#4015</span> <a href="viewtopic.php?pid=1498627#p1498627">2015-02-01 16:04:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88471">BlackDwarf</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-01</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is possible to create vfio on Asrock Z68 Pro3, i5 3570 and G650TI?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498629" class="blockpost roweven"> <h2><span><span class="conr">#4016</span> <a href="viewtopic.php?pid=1498629#p1498629">2015-02-01 16:08:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>BlackDwarf wrote:</cite><blockquote><div><p>Is possible to create vfio on Asrock Z68 Pro3, i5 3570 and G650TI?</p></div></blockquote></div><p>Does your motherboard and CPU support IOMMU and VT-D?</p><p><a href="http://ark.intel.com/products/65702/Intel-Core-i5-3570-Processor-6M-Cache-up-to-3_80-GHz" rel="nofollow">http://ark.intel.com/products/65702/Int … o-3_80-GHz</a></p><p>It looks like your CPU does. Explore your BIOS to see if there is an option to enable VT-D for it.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498629">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498637" class="blockpost rowodd"> <h2><span><span class="conr">#4017</span> <a href="viewtopic.php?pid=1498637#p1498637">2015-02-01 16:20:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88471">BlackDwarf</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-01</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Now I have 2500k and will buy 3570.<br />Last bios and there is option VT-d Capability Unsupported. I think that&#039;s because my cpu (i5 2500k) is not supported.</p><p>Is possible to have problems?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498637">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498639" class="blockpost roweven"> <h2><span><span class="conr">#4018</span> <a href="viewtopic.php?pid=1498639#p1498639">2015-02-01 16:48:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Ok, i&#039;ve run into an issue. The ultimate goal of my system is to combine both my Gaming and FreeNAS systems into one. Over the last two days, with help from others here and a bunch of googling, i&#039;ve been able to get the Gaming portion of my system to run. I have been able to successfully passthrough my USB Controller/Createive SB Z/Ethernet Controller and my&#160; GTX 760 with no code 43. When I went to pass my&#160; LSI RAID Card through, it complained about that my Ethertnet Adapter as already assigned. This makes sense as my Ethernet Adaoter,SBZ, and the LSI RAID Card are in the same IOMMU Group. I was hoping that multiple devices in a single IOMMU Group could be shared out to different VMs, but this doesn&#039;t appear to be the case - correct?</p><p>My system has3&#160; IOMMU Groups which I can assign devices from. Group 1 is PCIe Slot 1 which contains an old single slot Quadro NVS graphics card for console access. Group 2 is PCIe Slot 2 which has my GTX760. As I don&#039;t need console access once I get everything setup, I figured I could free up Group 1 and place my LSI Card in instead - pulling it out of the group with my USB Contooler/Creative SBZ/Ethernet. Now with my console is being supplied by my GTX 760. I am able to boot my FreeNAS VM and have it see my LSI RAID Card. However, when I boot my Gaming VM, the &#039;virsh start gamingvm&#039; will return my prompt, the monitor attached to my GTX 760 goes blank, then shortly after the system will hard lock. Is there a setting i&#039;m missing to enable my host to run headless? </p><div class="codebox"><pre><code>03:00.0 SCSI storage controller [0100]: LSI Logic / Symbios Logic SAS1064ET PCI-Express Fusion-MPT SAS [1000:0056] (rev 02) 04:00.0 VGA compatible controller [0300]: NVIDIA Corporation GK104 [GeForce GTX 760] [10de:1187] (rev a1) 04:00.1 Audio device [0403]: NVIDIA Corporation GK104 HDMI Audio Controller [10de:0e0a] (rev a1)</code></pre></div><p>I defined my GTX 760 device-id in: /etc/default/grub</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;intel_iommu=on vfio_iommu_type1.allow_unsafe_interrupts=1 pci-stub.ids=8086:3a37,8086:3a38,8086:3a39,8086:3a3c,10de:1187,10de:0e0a,1033:0194,8086:3a40,8086:3a42,8086:3a44,8086:3a48,8086:3a4a,11ab:4364,1102:12:00,11ab:4364,1000:0056 quiet&quot;</code></pre></div><p>As well as listed the slot which it resides in: /etc/vfio-pci.cfg</p><div class="codebox"><pre><code>DEVICES=&quot;0000:00:1a.0 0000:00:1a.1 0000:00:1a.2 0000:00:1a.7 0000:04:00.0 0000:04:00.1 0000:02:00.0 0000:00:1c.0 0000:00:1c.1 0000:00:1c.2 0000:00:1c.4 0000:00:1c.5 0000:05:00.0 0000:06:00.0 0000:07:00.0 0000:03:00.0&quot;</code></pre></div><p>NOUVEAU is blacklisted:</p><div class="codebox"><pre><code>[user@xenhost1 ~]$ cat /etc/modprobe.d/blacklist.conf blacklist nouveau</code></pre></div><p>My GTX 760 does support EFI:</p><div class="codebox"><pre><code>[user@xenhost1 ~]$ rom-parser/rom-parser GTX760EV.ROM Valid ROM signature found @600h, PCIR offset 190h PCIR: type 0, vendor: 10de, device: 1187, class: 030000 PCIR: revision 0, vendor revision: 1 Valid ROM signature found @fc00h, PCIR offset 1ch PCIR: type 3, vendor: 10de, device: 1187, class: 030000 PCIR: revision 3, vendor revision: 0 EFI: Signature Valid Last image</code></pre></div><p>I&#039;m at a loss as to how to get around this, if even possible...</p> <p class="postedit"><em>Last edited by The_Moves (2015-02-01 16:49:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498639">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498642" class="blockpost rowodd"> <h2><span><span class="conr">#4019</span> <a href="viewtopic.php?pid=1498642#p1498642">2015-02-01 16:55:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Do <strong>not</strong> attach PCIe root ports to pci-stub or bind them to vfio-pci.&#160; Leave them alone</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498642">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498769" class="blockpost roweven"> <h2><span><span class="conr">#4020</span> <a href="viewtopic.php?pid=1498769#p1498769">2015-02-01 23:21:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Does there exist ACS override patch for kernel 3.18.3 (Fedora 21) ? Trying the patch from OP fails...</p><p>EDIT:<br />Patch16000: override_for_missing_acs_capabilities.patch<br />+ case &quot;$patch&quot; in<br />+ patch -p1 -F1 -s<br />2 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej<br />napaka: Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p><br /><p>RPM build errors:<br />&#160; &#160; Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p> <p class="postedit"><em>Last edited by devianceluka (2015-02-01 23:24:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498769">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498811" class="blockpost rowodd"> <h2><span><span class="conr">#4021</span> <a href="viewtopic.php?pid=1498811#p1498811">2015-02-02 02:35:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Does there exist ACS override patch for kernel 3.18.3 (Fedora 21) ? Trying the patch from OP fails...</p><p>EDIT:<br />Patch16000: override_for_missing_acs_capabilities.patch<br />+ case &quot;$patch&quot; in<br />+ patch -p1 -F1 -s<br />2 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej<br />napaka: Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p><br /><p>RPM build errors:<br />&#160; &#160; Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p></div></blockquote></div><p>It applies just fine to stock 3.18.5, so you probably have to patch it hand</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498811">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498814" class="blockpost roweven"> <h2><span><span class="conr">#4022</span> <a href="viewtopic.php?pid=1498814#p1498814">2015-02-02 03:07:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>Does there exist ACS override patch for kernel 3.18.3 (Fedora 21) ? Trying the patch from OP fails...</p><p>EDIT:<br />Patch16000: override_for_missing_acs_capabilities.patch<br />+ case &quot;$patch&quot; in<br />+ patch -p1 -F1 -s<br />2 out of 3 hunks FAILED -- saving rejects to file drivers/pci/quirks.c.rej<br />napaka: Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p><br /><p>RPM build errors:<br />&#160; &#160; Bad exit status from /var/tmp/rpm-tmp.sCnxM8 (%prep)</p></div></blockquote></div><p>It applies just fine to stock 3.18.5, so you probably have to patch it hand</p></div></blockquote></div><p>I&#039;m doing the exact same thing as on Fedora 20 (~3.17) where it was compiling flawlessly for months. Patch it by hand?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498814">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498816" class="blockpost rowodd"> <h2><span><span class="conr">#4023</span> <a href="viewtopic.php?pid=1498816#p1498816">2015-02-02 03:38:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Do <strong>not</strong> attach PCIe root ports to pci-stub or bind them to vfio-pci.&#160; Leave them alone</p></div></blockquote></div><p>I went through an made sure my XML made sense after reading the below thread in which your a part of, as well as looked at a number of other XMLs:</p><p><a href="https://www.redhat.com/archives/libvir-list/2013-April/msg00881.html" rel="nofollow">https://www.redhat.com/archives/libvir- … 00881.html</a></p><p>But are you talking actual physical PCIe Root Ports? What is considered a root port? I apologize as I am still learning here.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498816">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498821" class="blockpost roweven"> <h2><span><span class="conr">#4024</span> <a href="viewtopic.php?pid=1498821#p1498821">2015-02-02 03:57:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Do <strong>not</strong> attach PCIe root ports to pci-stub or bind them to vfio-pci.&#160; Leave them alone</p></div></blockquote></div><p>I went through an made sure my XML made sense after reading the below thread in which your a part of, as well as looked at a number of other XMLs:</p><p><a href="https://www.redhat.com/archives/libvir-list/2013-April/msg00881.html" rel="nofollow">https://www.redhat.com/archives/libvir- … 00881.html</a></p></div></blockquote></div><p>Way off track, that&#039;s guest configuration, vfio-pci and pci-stub are host drivers.</p><div class="quotebox"><blockquote><div><p>But are you talking actual physical PCIe Root Ports? What is considered a root port? I apologize as I am still learning here.</p></div></blockquote></div><p>Those things that say Root Port when you run <em>lspci | grep -i &quot;root port&quot;</em>.&#160; You list some of them in both your kernel command line and your DEVICES.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498821">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1498828" class="blockpost rowodd"> <h2><span><span class="conr">#4025</span> <a href="viewtopic.php?pid=1498828#p1498828">2015-02-02 04:48:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Do <strong>not</strong> attach PCIe root ports to pci-stub or bind them to vfio-pci.&#160; Leave them alone</p></div></blockquote></div><p>I went through an made sure my XML made sense after reading the below thread in which your a part of, as well as looked at a number of other XMLs:</p><p><a href="https://www.redhat.com/archives/libvir-list/2013-April/msg00881.html" rel="nofollow">https://www.redhat.com/archives/libvir- … 00881.html</a></p></div></blockquote></div><p>Way off track, that&#039;s guest configuration, vfio-pci and pci-stub are host drivers.</p><div class="quotebox"><blockquote><div><p>But are you talking actual physical PCIe Root Ports? What is considered a root port? I apologize as I am still learning here.</p></div></blockquote></div><p>Those things that say Root Port when you run <em>lspci | grep -i &quot;root port&quot;</em>.&#160; You list some of them in both your kernel command line and your DEVICES.</p></div></blockquote></div><p>Wow, thank you do much! I can&#039;t believe I did that. i thought those were my other set of USB devices, no wonder why they weren&#039;t working as expected. I also had a typo for my Sound Card &quot;1102:12:00&quot;. I&#039;m surprised I was able to get it passed through and working.</p><p>What happens when I have the root ports assigned? Freezes? Panics?</p> <p class="postedit"><em>Last edited by The_Moves (2015-02-02 04:53:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1498828">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=160">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=159">159</a> <a href="viewtopic.php?id=162768&amp;p=160">160</a> <strong>161</strong> <a href="viewtopic.php?id=162768&amp;p=162">162</a> <a href="viewtopic.php?id=162768&amp;p=163">163</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=162">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
