<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 49) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=49" title="Page 49" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=48" title="Page 48" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=50" title="Page 50" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=48">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <a href="viewtopic.php?id=162768&amp;p=48">48</a> <strong>49</strong> <a href="viewtopic.php?id=162768&amp;p=50">50</a> <a href="viewtopic.php?id=162768&amp;p=51">51</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=50">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1383627" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1201</span> <a href="viewtopic.php?pid=1383627#p1383627">2014-02-20 12:06:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>zzz3000 wrote:</cite><blockquote><div><p>Video passthrought had worked for me with reboot problem when I used pci-stub metod and started VM via virt-manager.</p><p>Reboot&#160; problem dissapeared&#160; for me when I used vfio method and started via console, but host intel graphics becomes spoiled.</p><p>After I had installed Radeon Driver it stopped working at all, and host begun to crash.</p></div></blockquote></div><p>You&#039;ll probably need to use the i915 patch</p></div></blockquote></div><p>Thanks for reply.</p><p>i915 patch could resolv intel spoiled graphics or&#160; full crash with radeon driver installed on Windows?</p><p>Where&#160; can I get this patch? Is&#160; it a kernel patch or what?</p><p>Also I don&#039;t see bios booting in guest&#039;s video card.</p><p>I am using Fedora 20.</p> <p class="postedit"><em>Last edited by zzz3000 (2014-02-21 06:38:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1383627">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1384509" class="blockpost roweven"> <h2><span><span class="conr">#1202</span> <a href="viewtopic.php?pid=1384509#p1384509">2014-02-22 16:39:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78620">mostlyharmless</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-16</span></dd> <dd><span>Posts: 50</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78620">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, I tried switching my NVIDIA K2000 and AMD HD 7970 in my ASUS RIVE with 4930K .&#160; Previously, everything worked without problems with the NVIDIA as guest and the AMD as host, but of course I couldn&#039;t run the AMD drivers on the host, and the radeon drivers don&#039;t support 3D acceleration. So now I have the NVIDIA on the host with the HD7970 as guest.&#160; I ave been running the same kernel/qemu/seabios; ie 3.13.2/qemu-git and seabios git downloaded 12-5-13.&#160; &#160;I&#039;ve patched the kernel with <a href="https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/iommu/intel-iommu.c?id=08336fd218e087cc4fcc458e6b6dcafe8702b098" rel="nofollow">https://git.kernel.org/cgit/linux/kerne … fe8702b098</a> . My kernel line has vga=normal on it, but of course I still get this warning in dmesg:</p><div class="codebox"><pre><code>fb0: EFI VGA frame buffer device [ 18.026908] hda-intel 0000:01:00.1: Handle VGA-switcheroo audio client [ 49.298091] NVRM: Your system is not currently configured to drive a VGA console [ 49.298094] NVRM: on the primary VGA device. The NVIDIA Linux graphics driver [ 49.298095] NVRM: requires the use of a text-mode VGA console. Use of other console</code></pre></div><p>because I boot in efi mode.&#160; I&#039;m not sure this a way to boot in any other mode on this motherboard. I&#039;ve tried this <a href="https://devtalk.nvidia.com/default/topic/548475/vga-console-warning-/" rel="nofollow">https://devtalk.nvidia.com/default/topi … -warning-/</a><br />but there is no framebuffer other than efifb, so i get a black screen if I add the video=efifb:off.&#160; All that might be irrelevent.</p><p>I uninstalled the NVIDIA drivers from the guest prior to swapping.&#160; I patched the NVIDIA driver for the VGA arbitration. Using 319.76 (or for that matter 334.16) on the host seems to work fine with functioning OpenGL.&#160; </p><p>I removed the 03:00.1 audio passthrough on my qemu line and installed the AMD driver without CCC.&#160; Windows boots, and seems to work OK with no errors seen in Device Manager.&#160; However, while I can shutdown the guest, I cannot restart the guest, and in fact the host temporarily freezes up.&#160; I tried ejecting the AMD driver prior to shutdown, didn&#039;t help and now I have a black screen on the guest too.&#160; Here&#039;s dmesg after the crash/freeze. Seems to be a memory leak or something</p><div class="codebox"><pre class="vscroll"><code>[ 186.932077] vfio-pci 0000:03:00.0: enabling device (0000 -&gt; 0003) [ 186.953915] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x19@0x270 [ 186.953920] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x1b@0x2d0 [ 187.081805] vfio_cap_init: 0000:00:1d.0 hiding cap 0xa [ 189.849067] dmar: DRHD: handling fault status reg 2 [ 189.849073] dmar: DMAR:[DMA Read] Request device [00:1d.0] fault addr ee000 [ 189.849073] DMAR:[fault reason 06] PTE Read access is not set [ 201.195616] vfio-pci 0000:03:00.0: irq 103 for MSI/MSI-X [ 297.885563] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x19@0x270 [ 297.885568] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x1b@0x2d0 [ 298.006473] vfio_cap_init: 0000:00:1d.0 hiding cap 0xa [ 410.323923] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x19@0x270 [ 410.323930] vfio_ecap_init: 0000:03:00.0 hiding ecap 0x1b@0x2d0 [ 410.452817] vfio_cap_init: 0000:00:1d.0 hiding cap 0xa [ 412.892137] kvm: zapping shadow pages for mmio generation wraparound [ 774.404347] kwin invoked oom-killer: gfp_mask=0x201da, order=0, oom_score_adj=0 [ 774.404351] kwin cpuset=/ mems_allowed=0 [ 774.404354] CPU: 5 PID: 1539 Comm: kwin Tainted: P O 3.13.2 #2 [ 774.404355] Hardware name: System manufacturer System Product Name/RAMPAGE IV EXTREME, BIOS 9502 11/07/2013 [ 774.404356] ffff880829b4db90 ffff880816fafa60 ffffffff816338cd ffff880829b4d640 [ 774.404358] ffff880816fafac0 ffffffff81631535 0000000001320122 ffff880816fafa88 [ 774.404360] ffffffff8114daee 0000000000000286 ffffffff81c3b820 ffff8805b227e4a0 [ 774.404363] Call Trace: [ 774.404369] [&lt;ffffffff816338cd&gt;] dump_stack+0x45/0x56 [ 774.404372] [&lt;ffffffff81631535&gt;] dump_header.isra.12+0x76/0x1a7 [ 774.404376] [&lt;ffffffff8114daee&gt;] ? __delayacct_freepages_end+0x2e/0x30 [ 774.404379] [&lt;ffffffff81183d2d&gt;] oom_kill_process+0x1dd/0x340 [ 774.404382] [&lt;ffffffff812a3835&gt;] ? security_capable_noaudit+0x15/0x20 [ 774.404384] [&lt;ffffffff811842a4&gt;] out_of_memory+0x254/0x280 [ 774.404387] [&lt;ffffffff811890c3&gt;] __alloc_pages_nodemask+0x8b3/0x930 [ 774.404389] [&lt;ffffffff81182450&gt;] filemap_fault+0x1b0/0x3d0 [ 774.404393] [&lt;ffffffff811a4449&gt;] __do_fault+0x69/0x4e0 [ 774.404394] [&lt;ffffffff811821cf&gt;] ? wait_on_page_bit_killable+0x7f/0x90 [ 774.404396] [&lt;ffffffff811a870a&gt;] handle_mm_fault+0x30a/0xc70 [ 774.404399] [&lt;ffffffff81095fe0&gt;] __do_page_fault+0x170/0x500 [ 774.404403] [&lt;ffffffff811e31fc&gt;] ? poll_select_copy_remaining+0xdc/0x130 [ 774.404405] [&lt;ffffffff810963ae&gt;] do_page_fault+0xe/0x10 [ 774.404408] [&lt;ffffffff8163c608&gt;] page_fault+0x28/0x30 [ 774.404409] Mem-Info: [ 774.404410] DMA per-cpu: [ 774.404411] CPU 0: hi: 0, btch: 1 usd: 0 [ 774.404412] CPU 1: hi: 0, btch: 1 usd: 0 [ 774.404413] CPU 2: hi: 0, btch: 1 usd: 0 [ 774.404414] CPU 3: hi: 0, btch: 1 usd: 0 [ 774.404415] CPU 4: hi: 0, btch: 1 usd: 0 [ 774.404416] CPU 5: hi: 0, btch: 1 usd: 0 [ 774.404417] CPU 6: hi: 0, btch: 1 usd: 0 [ 774.404418] CPU 7: hi: 0, btch: 1 usd: 0 [ 774.404419] CPU 8: hi: 0, btch: 1 usd: 0 [ 774.404419] CPU 9: hi: 0, btch: 1 usd: 0 [ 774.404420] CPU 10: hi: 0, btch: 1 usd: 0 [ 774.404421] CPU 11: hi: 0, btch: 1 usd: 0 [ 774.404422] DMA32 per-cpu: [ 774.404423] CPU 0: hi: 186, btch: 31 usd: 0 [ 774.404424] CPU 1: hi: 186, btch: 31 usd: 0 [ 774.404425] CPU 2: hi: 186, btch: 31 usd: 0 [ 774.404426] CPU 3: hi: 186, btch: 31 usd: 0 [ 774.404427] CPU 4: hi: 186, btch: 31 usd: 0 [ 774.404428] CPU 5: hi: 186, btch: 31 usd: 0 [ 774.404429] CPU 6: hi: 186, btch: 31 usd: 0 [ 774.404430] CPU 7: hi: 186, btch: 31 usd: 0 [ 774.404430] CPU 8: hi: 186, btch: 31 usd: 0 [ 774.404431] CPU 9: hi: 186, btch: 31 usd: 0 [ 774.404432] CPU 10: hi: 186, btch: 31 usd: 0 [ 774.404433] CPU 11: hi: 186, btch: 31 usd: 0 [ 774.404434] Normal per-cpu: [ 774.404435] CPU 0: hi: 186, btch: 31 usd: 0 [ 774.404436] CPU 1: hi: 186, btch: 31 usd: 0 [ 774.404436] CPU 2: hi: 186, btch: 31 usd: 0 [ 774.404437] CPU 3: hi: 186, btch: 31 usd: 0 [ 774.404438] CPU 4: hi: 186, btch: 31 usd: 0 [ 774.404439] CPU 5: hi: 186, btch: 31 usd: 0 [ 774.404440] CPU 6: hi: 186, btch: 31 usd: 0 [ 774.404441] CPU 7: hi: 186, btch: 31 usd: 0 [ 774.404442] CPU 8: hi: 186, btch: 31 usd: 0 [ 774.404442] CPU 9: hi: 186, btch: 31 usd: 0 [ 774.404443] CPU 10: hi: 186, btch: 31 usd: 0 [ 774.404444] CPU 11: hi: 186, btch: 31 usd: 0 [ 774.404447] active_anon:7519336 inactive_anon:582210 isolated_anon:320 [ 774.404447] active_file:15 inactive_file:83 isolated_file:0 [ 774.404447] unevictable:0 dirty:0 writeback:0 unstable:0 [ 774.404447] free:67089 slab_reclaimable:7419 slab_unreclaimable:11764 [ 774.404447] mapped:6157 shmem:2 pagetables:9275 bounce:0 [ 774.404447] free_cma:0 [ 774.404452] DMA free:15864kB min:64kB low:80kB high:96kB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:15996kB managed:15896kB mlocked:0kB dirty:0kB writeback:0kB mapped:0kB shmem:0kB slab_reclaimable:0kB slab_unreclaimable:32kB kernel_stack:0kB pagetables:0kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:0 all_unreclaimable? yes [ 774.404453] lowmem_reserve[]: 0 2723 32114 32114 [ 774.404457] DMA32 free:128936kB min:11456kB low:14320kB high:17184kB active_anon:2072576kB inactive_anon:576816kB active_file:60kB inactive_file:52kB unevictable:0kB isolated(anon):0kB isolated(file):0kB present:2804552kB managed:2794080kB mlocked:0kB dirty:0kB writeback:0kB mapped:700kB shmem:0kB slab_reclaimable:3512kB slab_unreclaimable:2280kB kernel_stack:128kB pagetables:2548kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:3988935 all_unreclaimable? yes [ 774.404458] lowmem_reserve[]: 0 0 29390 29390 [ 774.404463] Normal free:123556kB min:123640kB low:154548kB high:185460kB active_anon:28004768kB inactive_anon:1752024kB active_file:0kB inactive_file:280kB unevictable:0kB isolated(anon):1280kB isolated(file):0kB present:30670848kB managed:30095696kB mlocked:0kB dirty:0kB writeback:0kB mapped:23928kB shmem:8kB slab_reclaimable:26164kB slab_unreclaimable:44744kB kernel_stack:3392kB pagetables:34552kB unstable:0kB bounce:0kB free_cma:0kB writeback_tmp:0kB pages_scanned:45224968 all_unreclaimable? yes [ 774.404463] lowmem_reserve[]: 0 0 0 0 [ 774.404465] DMA: 0*4kB 1*8kB (U) 1*16kB (U) 1*32kB (U) 3*64kB (U) 2*128kB (U) 0*256kB 0*512kB 1*1024kB (U) 1*2048kB (U) 3*4096kB (MR) = 15864kB [ 774.404473] DMA32: 270*4kB (UEM) 180*8kB (UEM) 215*16kB (UEM) 333*32kB (UEM) 221*64kB (UEM) 145*128kB (UEM) 95*256kB (UEM) 42*512kB (UEM) 33*1024kB (UEM) 0*2048kB 0*4096kB = 128936kB [ 774.404481] Normal: 509*4kB (UEM) 389*8kB (UEM) 224*16kB (UEM) 242*32kB (UEM) 129*64kB (UEM) 103*128kB (UEM) 109*256kB (UEM) 73*512kB (UEM) 20*1024kB (UEM) 0*2048kB 0*4096kB = 123676kB [ 774.404488] 575775 total pagecache pages [ 774.404490] 575675 pages in swap cache [ 774.404491] Swap cache stats: add 1679802, delete 1104127, find 30940/40375 [ 774.404492] Free swap = 30715568kB [ 774.404493] Total swap = 33554428kB [ 774.404493] 8372849 pages RAM [ 774.404494] 0 pages HighMem/MovableOnly [ 774.404495] 143788 pages reserved [ 774.404496] [ pid ] uid tgid total_vm rss nr_ptes swapents oom_score_adj name [ 774.404499] [ 467] 0 467 7610 15 21 298 -1000 udevd [ 774.404501] [ 710] 0 710 1617 0 8 44 0 syslogd [ 774.404502] [ 714] 0 714 1090 0 8 23 0 klogd [ 774.404504] [ 923] 0 923 2184 0 10 67 0 dhcpcd [ 774.404505] [ 993] 1 993 1630 0 8 29 0 rpc.portmap [ 774.404507] [ 997] 32 997 3206 1 12 41 0 rpc.statd [ 774.404508] [ 1015] 0 1015 1612 0 9 26 0 inetd [ 774.404509] [ 1018] 0 1018 6994 0 17 108 -1000 sshd [ 774.404511] [ 1029] 0 1029 94565 0 27 105 0 automount [ 774.404512] [ 1043] 0 1043 1093 0 8 42 0 acpid [ 774.404514] [ 1056] 81 1056 5096 111 13 130 0 dbus-daemon [ 774.404515] [ 1059] 0 1059 1063594 0 91 391 0 console-kit-dae [ 774.404517] [ 1128] 0 1128 53403 0 43 1121 0 polkitd [ 774.404518] [ 1157] 0 1157 13311 32 31 186 0 cupsd [ 774.404519] [ 1159] 0 1159 3198 0 12 37 0 crond [ 774.404521] [ 1161] 0 1161 3196 0 11 35 0 atd [ 774.404522] [ 1165] 0 1165 68585 13 131 409 0 smbd [ 774.404523] [ 1167] 0 1167 49046 39 92 272 0 nmbd [ 774.404524] [ 1169] 0 1169 1878 4 9 23 0 gpm [ 774.404526] [ 1179] 0 1179 68585 27 130 395 0 smbd [ 774.404527] [ 1193] 0 1193 75778 39 86 779 0 libvirtd [ 774.404528] [ 1212] 0 1212 1657 14 8 19 0 vde_switch [ 774.404530] [ 1306] 1000 1306 5143 1 16 178 0 bash [ 774.404531] [ 1307] 0 1307 3199 1 12 35 0 agetty [ 774.404533] [ 1308] 0 1308 3199 1 12 36 0 agetty [ 774.404534] [ 1309] 0 1309 3199 1 12 38 0 agetty [ 774.404536] [ 1310] 0 1310 3199 1 12 39 0 agetty [ 774.404537] [ 1311] 0 1311 3199 1 12 39 0 agetty [ 774.404538] [ 1365] 1000 1365 5153 1 16 188 0 bash [ 774.404540] [ 1381] 1000 1381 4002 0 13 50 0 xinit [ 774.404541] [ 1382] 1000 1382 44593 1696 89 9035 0 X [ 774.404543] [ 1385] 0 1385 7609 61 21 256 -1000 udevd [ 774.404544] [ 1388] 0 1388 7609 0 21 315 -1000 udevd [ 774.404545] [ 1399] 1000 1399 2971 0 11 102 0 sh [ 774.404547] [ 1400] 1000 1400 9189 0 24 70 0 ck-launch-sessi [ 774.404548] [ 1409] 1000 1409 2978 1 11 108 0 startkde [ 774.404550] [ 1443] 1000 1443 7720 0 20 82 0 dbus-launch [ 774.404551] [ 1444] 1000 1444 5268 35 14 252 0 dbus-daemon [ 774.404552] [ 1451] 1000 1451 1050 0 6 21 -300 start_kdeinit [ 774.404554] [ 1452] 1000 1452 87774 4 151 3670 -300 kdeinit4 [ 774.404555] [ 1453] 1000 1453 90179 2 132 4257 0 klauncher [ 774.404557] [ 1455] 1000 1455 431428 378 279 5744 0 kded4 [ 774.404558] [ 1457] 1000 1457 5117 1 17 103 0 gam_server [ 774.404560] [ 1461] 1000 1461 111316 13 171 4401 0 kglobalaccel [ 774.404561] [ 1475] 1000 1475 114168 4 175 4488 0 kwalletd [ 774.404562] [ 1480] 0 1480 49158 0 31 765 0 upowerd [ 774.404564] [ 1508] 0 1508 47874 120 31 655 0 udisks-daemon [ 774.404565] [ 1512] 0 1512 10848 0 25 74 0 udisks-daemon [ 774.404567] [ 1533] 1000 1533 1084 0 8 22 0 kwrapper4 [ 774.404568] [ 1534] 1000 1534 133118 0 180 4075 0 ksmserver [ 774.404569] [ 1536] 1000 1536 177296 0 156 1912 0 kactivitymanage [ 774.404571] [ 1539] 1000 1539 728405 7237 273 9453 0 kwin [ 774.404572] [ 1553] 1000 1553 249972 92 213 4052 0 knotify4 [ 774.404573] [ 1555] 1000 1555 846145 1662 334 23202 0 plasma-desktop [ 774.404575] [ 1561] 1000 1561 3036 0 11 151 0 ksysguardd [ 774.404576] [ 1564] 1000 1564 73196 0 129 1048 0 kuiserver [ 774.404578] [ 1567] 1000 1567 38367 38 38 163 0 akonadi_control [ 774.404579] [ 1586] 1000 1586 109022 0 131 4044 0 nepomukserver [ 774.404581] [ 1590] 1000 1590 203101 8 185 2631 0 nepomukservices [ 774.404582] [ 1591] 1000 1591 212223 167 261 5854 0 krunner [ 774.404584] [ 1593] 1000 1593 76019 13 130 988 0 nepomukcontroll [ 774.404585] [ 1595] 1000 1595 158076 113 191 5208 0 kmix [ 774.404587] [ 1600] 1000 1600 103051 3267 55 8842 0 virtuoso-t [ 774.404588] [ 1601] 1000 1601 670612 14 202 8803 0 kwrite [ 774.404589] [ 1604] 1000 1604 155527 0 160 1830 0 synergy [ 774.404591] [ 1606] 1000 1606 138834 608 190 4618 0 konsole [ 774.404592] [ 1612] 1000 1612 138974 350 191 4823 0 konsole [ 774.404593] [ 1616] 1000 1616 5134 0 16 169 0 bash [ 774.404595] [ 1619] 1000 1619 5134 0 15 169 0 bash [ 774.404596] [ 1625] 1000 1625 91018 0 136 4467 0 blueman-applet [ 774.404598] [ 1626] 1000 1626 123644 4 224 5510 0 python [ 774.404599] [ 1629] 1000 1629 97769 3 147 1089 0 polkit-kde-auth [ 774.404600] [ 1632] 1000 1632 39380 144 78 3083 0 python [ 774.404602] [ 1633] 1000 1633 32376 40 64 3163 0 python [ 774.404603] [ 1634] 1000 1634 98085 112 178 1200 0 korgac [ 774.404604] [ 1638] 1000 1638 183525 10028 240 14937 0 firefox [ 774.404606] [ 1641] 1000 1641 113540 122 176 4395 0 klipper [ 774.404607] [ 1649] 1000 1649 46340 0 27 131 0 gvfsd [ 774.404609] [ 1653] 1000 1653 70911 0 40 777 0 gvfsd-fuse [ 774.404610] [ 1661] 1000 1661 12515 5 30 136 0 gconfd-2 [ 774.404611] [ 1679] 1000 1679 47423 0 86 390 0 obex-data-serve [ 774.404613] [ 1720] 1000 1720 115420 151 148 1604 0 nepomukservices [ 774.404614] [ 1721] 1000 1721 97736 144 150 1348 0 nepomukservices [ 774.404615] [ 1729] 0 1729 5137 35 16 139 0 bash [ 774.404617] [ 1845] 0 1845 5137 44 15 131 0 bash [ 774.404618] [ 1851] 1000 1851 33696 56 34 166 0 synergys [ 774.404620] [ 2132] 0 2132 2976 7 11 93 0 sh [ 774.404622] [ 2133] 0 2133 2290625 488926 2188 567641 0 qemu-system-x86 [ 774.404623] [ 2146] 0 2146 49046 49 91 262 0 nmbd</code></pre></div><p>My current qemu line is </p><div class="codebox"><pre><code>QEMU_SDL_SAMPLES=2048 \ qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none\ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -drive file=/dev/mapper/cryptvg2-win7,id=disk,if=virtio \ -device piix4-ide,bus=pcie.0 \ -drive file=/dev/sr0,id=cddisk -device ide-cd,bus=ide.1,drive=cddisk \ -net vde,sock=/var/run/kvm0.ctl,vlan=0 -net nic,vlan=0,model=virtio \ -device vfio-pci,host=00:1d.0,bus=pcie.0 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -drive file=virtio-win-0.1-74.iso,id=isocd -device ide-cd,bus=ide.2,drive=isocd \ -rtc base=localtime</code></pre></div><p>The DMAR error regarding device [00:1d.0] has always been there (prior to the VGA swap) and refers to a passed through USB controller for a mouse for the guest, so I doubt it is relevent.</p><p>[EDIT] Hmm, one more reboot out of many seems to have made the problem go away. Still, if anyone knows what the crash means, let me know <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by mostlyharmless (2014-02-22 17:27:54)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1384509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1384588" class="blockpost rowodd"> <h2><span><span class="conr">#1203</span> <a href="viewtopic.php?pid=1384588#p1384588">2014-02-22 20:08:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The nvidia guys seem to have a problem with their setup: <a href="https://devtalk.nvidia.com/default/topic/545560/linux/vfio-vga-arbitration-lock/post/4131164/#4131164" rel="nofollow">https://devtalk.nvidia.com/default/topi … 4/#4131164</a></p><p>We have a number on their internal bugtracker, so maybe we should try helping them with their issues, so they can reproduce it and fix it at some point.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1384588">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1384716" class="blockpost roweven"> <h2><span><span class="conr">#1204</span> <a href="viewtopic.php?pid=1384716#p1384716">2014-02-23 06:19:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79534">zzz3000</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-16</span></dd> <dd><span>Posts: 12</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79534">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After I patched&#160; fedora kernel-3.13 with&#160; patches from main page, all&#160; problems have disappeared except one.<br />I get BSOD under Windows7 guest when I am installing&#160; radeon driver for 7750...</p><p>log:</p><p>Feb 23 17:03:42 DeltaS kernel: [&#160; 703.287069] kvm: zapping shadow pages for mmio generation wraparound</p> <p class="postedit"><em>Last edited by zzz3000 (2014-02-23 13:06:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1384716">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385129" class="blockpost rowodd"> <h2><span><span class="conr">#1205</span> <a href="viewtopic.php?pid=1385129#p1385129">2014-02-24 04:51:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78217">DanaGoyette</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-03</span></dd> <dd><span>Posts: 46</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:danagoyette@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve done a good deal more experimenting with my setup (back to one GPU at the moment).&#160; Only one variant seems at all stable.</p><p>q35, EFI: Not an option -- OVMF is hardcoded for i440fx.<br />q35, radeon as primary, x-vga=on, no VGA Arbiter patch: hang (and garbled host graphics) upon trying to run VGA option rom.<br />q35, radeon as primary, x-vga=on, i915 arbiter patches:&#160; Bus IRQ count assertion failure every single time I try to boot the guest (except in Safe Mode).&#160; Also, breaks host OpenGL, which is a showstopper for me.<br />q35, radeon as primary, no x-vga: hang upon trying to run VGA option ROM.<br />q35, radeon as primary, rombar=0: guest boots and can be connected to via VNC... but AMD driver doesn&#039;t load.<br />q35, radeon as secondary: guest boots.&#160; AMD driver won&#039;t load, or loads but doesn&#039;t detect displays or appear as usable in CCC.</p><p>i440fx, EFI guest: Boots reliably and runs reliably... but the bus reset doesn&#039;t work!&#160; Any guest reboot or crash requires me to suspend and resume the host!</p> <p class="postedit"><em>Last edited by DanaGoyette (2014-02-24 06:42:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385129">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385131" class="blockpost roweven"> <h2><span><span class="conr">#1206</span> <a href="viewtopic.php?pid=1385131#p1385131">2014-02-24 05:07:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DanaGoyette wrote:</cite><blockquote><div><p>q35, radeon as primary, x-vga=on, i915 arbiter patches:&#160; Bus IRQ count assertion failure every single time I try to boot the guest (except in Safe Mode).</p></div></blockquote></div><p>A number of other people seem to have this one working and it&#039;s certainly what I would advise for most people.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385131">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385339" class="blockpost rowodd"> <h2><span><span class="conr">#1207</span> <a href="viewtopic.php?pid=1385339#p1385339">2014-02-24 17:05:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79772">C0NPAQ</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-24</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79772">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Suggesting that OP puts 1-2 sentences in his post on what passthrough really does.</p><p>I had to read the whole post to count 1:1 together. I expected some functionality which would let you forward the output of graphics card A to display on graphics card B within spice or something. But all you essentially get is one graphics card plainly assigned to the VM and that is that. Meaning you need another monitor (or one with two inputs one unused), another mouse and keyboard if you don&#039;t do weird tricks and don&#039;t want to steal those from the host OS and switch back and forth. Slightly better than rebooting ... if you happen to have a perfectly redundant graphics card ... but seriously: it sounded way better when you had not thought it through.</p><p>Don&#039;t know if there are any cards that eat DVI and pipe it to an application. Like TV cards... VNC is too slow for games but the same functionality for keyboard/mouse as a VM driver would work out. Then the problem would be solved.</p><p>EDIT: Arrived in the 21th century, there are cards for 100-200 USD, 200 USD with certain linux support. Seem to be made for video recording though, cheap ones even USB, probably latency issues.</p> <p class="postedit"><em>Last edited by C0NPAQ (2014-02-24 17:14:22)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385339">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385358" class="blockpost roweven"> <h2><span><span class="conr">#1208</span> <a href="viewtopic.php?pid=1385358#p1385358">2014-02-24 18:05:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I`ve been using the Passthrough setup for half a year now and it works for me quite well.<br />The only problem I have is that there are some performance issues. Though games run nicely on a HD 7870 + 6x4GHz Cores (AMD) the loading times are extremely high.<br />I also experience some stuttering when a game starts, I think cause some resources are loaded then.<br />I have enabled bigtables, cgroups (I use the script OP posted a while ago) and&#160; disabled nested pagetables (kvm-amd npt=0). Do you know what I could do to verify that allocation is the problem or how to improve the loading times?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385358">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385362" class="blockpost rowodd"> <h2><span><span class="conr">#1209</span> <a href="viewtopic.php?pid=1385362#p1385362">2014-02-24 18:27:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>C0NPAQ wrote:</cite><blockquote><div><p>Suggesting that OP puts 1-2 sentences in his post on what passthrough really does.</p><p>I had to read the whole post to count 1:1 together. I expected some functionality which would let you forward the output of graphics card A to display on graphics card B within spice or something. But all you essentially get is one graphics card plainly assigned to the VM and that is that. Meaning you need another monitor (or one with two inputs one unused), another mouse and keyboard if you don&#039;t do weird tricks and don&#039;t want to steal those from the host OS and switch back and forth. Slightly better than rebooting ... if you happen to have a perfectly redundant graphics card ... but seriously: it sounded way better when you had not thought it through.</p><p>Don&#039;t know if there are any cards that eat DVI and pipe it to an application. Like TV cards... VNC is too slow for games but the same functionality for keyboard/mouse as a VM driver would work out. Then the problem would be solved.</p><p>EDIT: Arrived in the 21th century, there are cards for 100-200 USD, 200 USD with certain linux support. Seem to be made for video recording though, cheap ones even USB, probably latency issues.</p></div></blockquote></div><p>It would certainly be nice if there was some way to extract the framebuffer of the card and expose it on the host, and it may be possible, but typically that&#039;s not how PCI device assignment works.&#160; If you assign a NIC, you don&#039;t somehow expect that it obeys the routing of the host, the NIC is an isolated device with it&#039;s own data path.&#160; That said, I can mention that the guest is just a process to the host and that framebuffer that goes out to the screen likely lives somewhere in the physical memory of the system.&#160; If you can find it and not interfere with the guest, you could theoretically render it into a window on a host display.&#160; I have no tips for how to do that, it&#039;s likely proprietary and requires in-depth knowledge of how the card works, but it may be possible.&#160; Another option is to use a PCoIP card co-assigned to the guest.&#160; These are intended to be used for low-latency, high performance remote displays.&#160; If they have a software client, it could be run on the host.&#160; Another project that may be interesting is the <a href="http://virgil3d.github.io/" rel="nofollow">Virgil 3D GPU project</a>.&#160; This intends to effectively share the host GPU with a guest and allow 3D rendering onto the host display.&#160; If non-Linux gaming is your target, drivers are likely to be an issue with that approach for some time.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385362">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385364" class="blockpost roweven"> <h2><span><span class="conr">#1210</span> <a href="viewtopic.php?pid=1385364#p1385364">2014-02-24 18:33:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>Hi,</p><p>I`ve been using the Passthrough setup for half a year now and it works for me quite well.<br />The only problem I have is that there are some performance issues. Though games run nicely on a HD 7870 + 6x4GHz Cores (AMD) the loading times are extremely high.<br />I also experience some stuttering when a game starts, I think cause some resources are loaded then.<br />I have enabled bigtables, cgroups (I use the script OP posted a while ago) and&#160; disabled nested pagetables (kvm-amd npt=0). Do you know what I could do to verify that allocation is the problem or how to improve the loading times?</p></div></blockquote></div><p>What do you use as a backing store for you OS image?&#160; If you&#039;re not using a raw disk/partition/logical volume with virtio drivers, that&#039;s an obvious place to start.&#160; Beyond that, there are tools like kvm_stat, perf, and trace-cmd that can show where you&#039;re spending time, this is how we were able to determine debug register access is a significant performance bottleneck for games like Borderlands2 (fix coming soon - at least on Intel, no data for AMD yet).</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385364">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385414" class="blockpost rowodd"> <h2><span><span class="conr">#1211</span> <a href="viewtopic.php?pid=1385414#p1385414">2014-02-24 20:49:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78023">doubledr</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-26</span></dd> <dd><span>Posts: 13</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>Hi,</p><p>I`ve been using the Passthrough setup for half a year now and it works for me quite well.<br />The only problem I have is that there are some performance issues. Though games run nicely on a HD 7870 + 6x4GHz Cores (AMD) the loading times are extremely high.<br />I also experience some stuttering when a game starts, I think cause some resources are loaded then.<br />I have enabled bigtables, cgroups (I use the script OP posted a while ago) and&#160; disabled nested pagetables (kvm-amd npt=0). Do you know what I could do to verify that allocation is the problem or how to improve the loading times?</p></div></blockquote></div><p>What do you use as a backing store for you OS image?&#160; If you&#039;re not using a raw disk/partition/logical volume with virtio drivers, that&#039;s an obvious place to start.&#160; Beyond that, there are tools like kvm_stat, perf, and trace-cmd that can show where you&#039;re spending time, this is how we were able to determine debug register access is a significant performance bottleneck for games like Borderlands2 (fix coming soon - at least on Intel, no data for AMD yet).</p></div></blockquote></div><p>Hi, aw</p><p>Is there any tutorial about how to use these tools? I want to help this topic too.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385414">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385443" class="blockpost roweven"> <h2><span><span class="conr">#1212</span> <a href="viewtopic.php?pid=1385443#p1385443">2014-02-24 21:51:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>doubledr wrote:</cite><blockquote><div><p>Hi, aw</p><p>Is there any tutorial about how to use these tools? I want to help this topic too.</p></div></blockquote></div><p>You&#039;ll find kvm_stat in the qemu source tree, here are some instructions:</p><p><a href="https://docs.fedoraproject.org/en-US/Fedora/18/html/Virtualization_Administration_Guide/ch20s02.html" rel="nofollow">https://docs.fedoraproject.org/en-US/Fe … 20s02.html</a></p><p>Tracing is similarly easy, but the report generated is massive and takes some skill to analyze:</p><p><a href="http://www.linux-kvm.org/page/Tracing" rel="nofollow">http://www.linux-kvm.org/page/Tracing</a></p><p>Generally you&#039;ll want to run kvm_stat first to see what the heavy hitters are, then look in the trace output to try to figure out why they&#039;re being called.</p><p>There&#039;s a bit on perf here too:</p><p><a href="http://www.linux-kvm.org/page/Perf_events" rel="nofollow">http://www.linux-kvm.org/page/Perf_events</a></p><p>A simple place to start, especially if you&#039;re compiling your own qemu is to uncomment #define DEBUG_VFIO from hw/misc/vfio.c, recompile and test with that binary.&#160; You will get a ton of initial output but once the OS drivers are running it should slow down considerably.&#160; The output will never cease entirely though, all config space access will go through qemu and any of the quirks.&#160; So long as you don&#039;t see more than around a dozen lines per second, vfio is probably not the bottleneck.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385443">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385454" class="blockpost rowodd"> <h2><span><span class="conr">#1213</span> <a href="viewtopic.php?pid=1385454#p1385454">2014-02-24 22:14:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>Hi,</p><p>I`ve been using the Passthrough setup for half a year now and it works for me quite well.<br />The only problem I have is that there are some performance issues. Though games run nicely on a HD 7870 + 6x4GHz Cores (AMD) the loading times are extremely high.<br />I also experience some stuttering when a game starts, I think cause some resources are loaded then.<br />I have enabled bigtables, cgroups (I use the script OP posted a while ago) and&#160; disabled nested pagetables (kvm-amd npt=0). Do you know what I could do to verify that allocation is the problem or how to improve the loading times?</p></div></blockquote></div><p>What do you use as a backing store for you OS image?&#160; If you&#039;re not using a raw disk/partition/logical volume with virtio drivers, that&#039;s an obvious place to start.&#160; Beyond that, there are tools like kvm_stat, perf, and trace-cmd that can show where you&#039;re spending time, this is how we were able to determine debug register access is a significant performance bottleneck for games like Borderlands2 (fix coming soon - at least on Intel, no data for AMD yet).</p></div></blockquote></div><p>Thanks Ill try those.<br />I use virtio drivers on a raw lvm partition.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385454">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385687" class="blockpost roweven"> <h2><span><span class="conr">#1214</span> <a href="viewtopic.php?pid=1385687#p1385687">2014-02-25 13:51:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>EDIT2: Further analysis (special thanks to Paolo Bonzini) shows two issues that are hurting performance here.&#160; First is a known issue with Windows that it pounds on the time source, whether it&#039;s ACPI PM timer or HPET.&#160; Code just recently went upstream (kernel and qemu) that enables a Hyper-V enlightened timer that can help to reduce this.&#160; To enable it add &quot;hv-time&quot; to your -cpu option, ex. -cpu Haswell,hv-time&#160; This gives me about 20% more FPS and is likely to help performance of any game running in a Windows guest.&#160; The second problem is that we see extensive use of the processor debug registers.&#160; Each move to or from these registers traps into the hypvervisor and they appear to be batched into a context switch function, so we have a burst of them all at once.&#160; I&#039;ve submitted a support ticket to gearbox software to see if they have any suggestions to avoid these registers.</p></div></blockquote></div><p>Hello Andrew,</p><p>thanks for this hint. I tried &quot;-m cpu host,hv-time&quot; - but as soon as &quot;hv-time&quot; is added, the Guest (Win7 64bit) behaves aweful: IF the boot succeeds, half of the Services can&#039;t get startet, but mostly i get a BSOD with STOP 7e.<br />It may be this is because of the current GIT-Version of qemu - not because of &quot;hv-time&quot; - i cant tell exactly because i can test hv-time only with current git of qemu; <br />Guest behaves normal with qemu 1.7.0.<br />Kernel is 3.14-rc4 in both cases.</p><p>Maybe &quot;hv-time&quot; is only possible with a fixed cpu type, not &quot;host&quot; ?</p><p>Greetings!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385687">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385690" class="blockpost rowodd"> <h2><span><span class="conr">#1215</span> <a href="viewtopic.php?pid=1385690#p1385690">2014-02-25 13:56:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kaeptnb wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>EDIT2: Further analysis (special thanks to Paolo Bonzini) shows two issues that are hurting performance here.&#160; First is a known issue with Windows that it pounds on the time source, whether it&#039;s ACPI PM timer or HPET.&#160; Code just recently went upstream (kernel and qemu) that enables a Hyper-V enlightened timer that can help to reduce this.&#160; To enable it add &quot;hv-time&quot; to your -cpu option, ex. -cpu Haswell,hv-time&#160; This gives me about 20% more FPS and is likely to help performance of any game running in a Windows guest.&#160; The second problem is that we see extensive use of the processor debug registers.&#160; Each move to or from these registers traps into the hypvervisor and they appear to be batched into a context switch function, so we have a burst of them all at once.&#160; I&#039;ve submitted a support ticket to gearbox software to see if they have any suggestions to avoid these registers.</p></div></blockquote></div><p>Hello Andrew,</p><p>thanks for this hint. I tried &quot;-m cpu host,hv-time&quot; - but as soon as &quot;hv-time&quot; is added, the Guest (Win7 64bit) behaves aweful: IF the boot succeeds, half of the Services can&#039;t get startet, but mostly i get a BSOD with STOP 7e.<br />It may be this is because of the current GIT-Version of qemu - not because of &quot;hv-time&quot; - i cant tell exactly because i can test hv-time only with current git of qemu; <br />Guest behaves normal with qemu 1.7.0.<br />Kernel is 3.14-rc4 in both cases.</p><p>Maybe &quot;hv-time&quot; is only possible with a fixed cpu type, not &quot;host&quot; ?</p><p>Greetings!</p></div></blockquote></div><p>I used it with -cpu Haswell,hv-time. Use -cpu ? to see available predefined models.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385690">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385799" class="blockpost roweven"> <h2><span><span class="conr">#1216</span> <a href="viewtopic.php?pid=1385799#p1385799">2014-02-25 18:36:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><blockquote><div><p>I used it with -cpu Haswell,hv-time. Use -cpu ? to see available predefined models.</p></div></blockquote></div><br /><p>i tried it with &quot;Nehalem&quot; (only have a i7 920) and the new git-qemu - but no luck. it seems the current GIT snapshot of qemu messes up the whole virtual machine here: passed through GPU is there, but the device manager says the driver cant be loaded <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Running with qemu 1.7.0 works perfect here, even with -cpu Nehalem - so it must be the current state of qemu GIT.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385799">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385816" class="blockpost rowodd"> <h2><span><span class="conr">#1217</span> <a href="viewtopic.php?pid=1385816#p1385816">2014-02-25 19:27:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>kaeptnb wrote:</cite><blockquote><div><div class="quotebox"><blockquote><div><p>I used it with -cpu Haswell,hv-time. Use -cpu ? to see available predefined models.</p></div></blockquote></div><br /><p>i tried it with &quot;Nehalem&quot; (only have a i7 920) and the new git-qemu - but no luck. it seems the current GIT snapshot of qemu messes up the whole virtual machine here: passed through GPU is there, but the device manager says the driver cant be loaded <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Running with qemu 1.7.0 works perfect here, even with -cpu Nehalem - so it must be the current state of qemu GIT.</p></div></blockquote></div><p>I just refreshed my git tree, head is aa0d1f448871314bfc535da97eb003fe7766d4c2, I add this <a href="https://git.kernel.org/cgit/virt/kvm/mst/qemu.git/commit/?id=0217598857eaf0ceae137cdd71445118af2284cf" rel="nofollow">this patch</a> because otherwise multifunction devices are broken and it works fine.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385816">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385829" class="blockpost roweven"> <h2><span><span class="conr">#1218</span> <a href="viewtopic.php?pid=1385829#p1385829">2014-02-25 20:11:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79802">neona</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-25</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79802">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve got things mostly working (windows boots, can play games, performs decently, though I&#039;ll probably tweak it more), though I&#039;m having a few issues.</p><p>First, my commandline and config:</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 8192 -cpu host -vga none \ -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=Gigabyte.GTX550Ti.1024.110308.rom \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 \ -drive file=/dev/sda,if=virtio,format=raw \ -usb -device usb-host,hostbus=3,hostaddr=7 \ -device usb-host,hostbus=6,hostaddr=2 \ -device usb-host,hostbus=6,hostaddr=3 \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 \ -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 \ -device virtio-balloon \ -net nic,model=virtio -net user</code></pre></div><p>using the kernel, qemu, and seabios from OP, along with patched nvidia driver on host. Have all the relevant virtio drivers installed and working on guest, though it seems that the host kernel may need to be rebuilt again for me to actually enable balloon.</p><p>System specs:</p><p>FX-8350<br />GeForce 9500 GT (host)<br />GTX 550 Ti (guest)<br />Windows 8.1 - guest os<br />16gb of memory, currently allocating 8gb to guest<br />ASRock 970 EXTREME3</p><p>Anyway, onward to problems:</p><p>For some reason, qemu only claims to support oss, wav, and spice output, so sound won&#039;t work.&#160; I double checked the PKGBUILD for qemu, and it&#039;s clearly being compiled with pulse and alsa support (or should be, anyway), so I have no clue what&#039;s causing this, and some googling around hasn&#039;t found anything.&#160; I&#039;ve tried various ways of wrapping oss to pulse/alsa, and none of that has worked either.&#160; This is rather inconvienient, but at least if I can get networking to behave then I think it&#039;s possible to have windows output to pulse if nothing else works.&#160; I might also get a usb soundcard, but I&#039;d rather avoid spending money if I can.</p><p>The other major issue i&#039;m having is trouble getting networking working in any configuration other than the default user mode (as it is in my commandline).&#160; All attempts to use tap/tun result in various &quot;device busy&quot; or &quot;device can&#039;t be accessed&quot; messages.&#160; This wouldn&#039;t be a big deal, but it&#039;s clear that tap/tun should provide better performance, and also I need the guest to be able to talk to the host so I can use synergy, so it&#039;s a bit of an issue.&#160; Right now I&#039;m just passing the host input devices to the guest, so I lose control of the host when I have the vm running (with ssh just in case, of course).&#160; It&#039;d also be nice for ICMP to work. Does anyone have experience with tap/tun?&#160; I haven&#039;t been able to find any particularly clear guides, though I&#039;ve tried a variety of things.</p><p>Oh, and does anyone know if use of hugetlbfs is mutually exclusive with proper use of balloon memory? It seems likely.&#160; Also, how much of/what sort of an improvement does hugetlbfs provide, anyway?&#160; Does it just reduce memory/tlb thrashing - can this reduce stutter in games?</p><p>Past that, everything is working great though!&#160; Bit of stuttering in some games, but could be way worse.</p><p>I appreciate all the research you guys have put into getting this working.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385847" class="blockpost rowodd"> <h2><span><span class="conr">#1219</span> <a href="viewtopic.php?pid=1385847#p1385847">2014-02-25 20:36:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Is there any quirk list fpr vfio-vga devices in the the kernel or qemu? I ask because a friend of mine has problems getting his Geforce 750 Ti to work with vga-passthrough, while his old G210 (or 8400GS, don&#039;t remember) worked.<br />The relevant dmesg errors seem to be:</p><div class="codebox"><pre><code>[ 142.835457] vfio_ecap_init: 0000:0a:00.0 hiding ecap 0x1e@0x258 [ 142.835472] vfio_ecap_init: 0000:0a:00.0 hiding ecap 0x19@0x900</code></pre></div><p>Best regards,<br />Flyser</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385847">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385851" class="blockpost roweven"> <h2><span><span class="conr">#1220</span> <a href="viewtopic.php?pid=1385851#p1385851">2014-02-25 20:45:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><p>Is there any quirk list fpr vfio-vga devices in the the kernel or qemu? I ask because a friend of mine has problems getting his Geforce 750 Ti to work with vga-passthrough, while his old G210 (or 8400GS, don&#039;t remember) worked.<br />The relevant dmesg errors seem to be:</p><div class="codebox"><pre><code>[ 142.835457] vfio_ecap_init: 0000:0a:00.0 hiding ecap 0x1e@0x258 [ 142.835472] vfio_ecap_init: 0000:0a:00.0 hiding ecap 0x19@0x900</code></pre></div></div></blockquote></div><p>These probably aren&#039;t relevant.&#160; Extended capability 0x19 is a secondary PCIe capability, 0x1e is L1 PM substates (ie. power management states).&#160; These messages simply mean that we&#039;re hiding the capability from the guest, either because it&#039;s not necessary, it&#039;s inappropriate for a guest, or nobody has added it yet.&#160; It&#039;s very unlikely that these are blocking anything.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385851">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385935" class="blockpost rowodd"> <h2><span><span class="conr">#1221</span> <a href="viewtopic.php?pid=1385935#p1385935">2014-02-26 00:39:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>[I used it with -cpu Haswell,hv-time. Use -cpu ? to see available predefined models.</p></div></blockquote></div><p>Which is the correct one: hv-time or hv_time? libvirt uses hv_time [1]. The long supported hv_relaxed, hv_vapic, hv_spinlocks all use undeline characters [2].</p><p>1. <a href="http://libvirt.org/git/?p=libvirt.git;a=blob;f=tests/qemuxml2argvdata/qemuxml2argv-clock-timer-hyperv-rtc.args;h=1905875d064341c8be6d24b7a6ce9c23c33e8ad0;hb=HEAD" rel="nofollow">http://libvirt.org/git/?p=libvirt.git;a … d0;hb=HEAD</a><br />2. <a href="http://qemu-project.org/ChangeLog/1.1#x86" rel="nofollow">http://qemu-project.org/ChangeLog/1.1#x86</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385935">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385948" class="blockpost roweven"> <h2><span><span class="conr">#1222</span> <a href="viewtopic.php?pid=1385948#p1385948">2014-02-26 01:23:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75968">deniv</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-16</span></dd> <dd><span>Posts: 27</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>neona wrote:</cite><blockquote><div><p>The other major issue i&#039;m having is trouble getting networking working in any configuration other than the default user mode (as it is in my commandline).&#160; All attempts to use tap/tun result in various &quot;device busy&quot; or &quot;device can&#039;t be accessed&quot; messages.&#160; This wouldn&#039;t be a big deal, but it&#039;s clear that tap/tun should provide better performance, and also I need the guest to be able to talk to the host so I can use synergy, so it&#039;s a bit of an issue.&#160; Right now I&#039;m just passing the host input devices to the guest, so I lose control of the host when I have the vm running (with ssh just in case, of course).&#160; It&#039;d also be nice for ICMP to work. Does anyone have experience with tap/tun?&#160; I haven&#039;t been able to find any particularly clear guides, though I&#039;ve tried a variety of things.</p></div></blockquote></div><p>Do you have tun/tap enabled in kernel? CONFIG_TUN that is. The module name &quot;tun.&quot; <br />Command line should look like:</p><div class="codebox"><pre><code>-device virtio-net,netdev=t10,mac=52:54:00:00:00:00 \ -netdev tap,id=t10,vhost=on,ifname=tap10,script=no,downscript=no</code></pre></div><p>I have a tun setup. When I asked people on #kvm they said the fastest setup for inter-vm communication is tun + bridges (macvtap is a tad slower). Basicly it creates just another net interface (e.g. ifname=tap10) like ethernet or wireless. Once you get the new tap interface you have to configure it like any other net interface. Setup a bridge or NAT. For example, right after the qemu command line I have:</p><div class="codebox"><pre><code>ifconfig tap10 up brctl addif br10 tap10</code></pre></div><p>That bridge connects the vm to dhcp/router.</p><div class="quotebox"><cite>neona wrote:</cite><blockquote><div><p>Oh, and does anyone know if use of hugetlbfs is mutually exclusive with proper use of balloon memory? It seems likely.&#160; Also, how much of/what sort of an improvement does hugetlbfs provide, anyway?&#160; Does it just reduce memory/tlb thrashing - can this reduce stutter in games?</p></div></blockquote></div><p>AFAIK, yes. You can&#039;t balloon hugetlbfs backed memory. As for improvement, for me hugetlbfs gives about 2 points in win7 benchmark. From 5.5 to about 7.3-7.4.</p><div class="quotebox"><cite>neona wrote:</cite><blockquote><div><p>Bit of stuttering in some games, but could be way worse.</p></div></blockquote></div><p>You can try adding hv_relaxed,hv_vapic,hv_spinlocks=0x1000 to -cpu options (there is also hv_time, try it if you&#039;re running kernel 3.14, qemu-git). Might give you a couple more percents. All these options enable kvm-supported Hyper-V enlightenments which make windows behave better in virtual environment.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385948">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1385952" class="blockpost rowodd"> <h2><span><span class="conr">#1223</span> <a href="viewtopic.php?pid=1385952#p1385952">2014-02-26 01:44:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>deniv wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>[I used it with -cpu Haswell,hv-time. Use -cpu ? to see available predefined models.</p></div></blockquote></div><p>Which is the correct one: hv-time or hv_time? libvirt uses hv_time [1]. The long supported hv_relaxed, hv_vapic, hv_spinlocks all use undeline characters [2].</p><p>1. <a href="http://libvirt.org/git/?p=libvirt.git;a=blob;f=tests/qemuxml2argvdata/qemuxml2argv-clock-timer-hyperv-rtc.args;h=1905875d064341c8be6d24b7a6ce9c23c33e8ad0;hb=HEAD" rel="nofollow">http://libvirt.org/git/?p=libvirt.git;a … d0;hb=HEAD</a><br />2. <a href="http://qemu-project.org/ChangeLog/1.1#x86" rel="nofollow">http://qemu-project.org/ChangeLog/1.1#x86</a></p></div></blockquote></div><p><a href="http://git.qemu.org/?p=qemu.git;a=commitdiff;h=48a5f3bcbbbe59a3120a39106bfda59fd1933fbc" rel="nofollow">http://git.qemu.org/?p=qemu.git;a=commi … 9fd1933fbc</a></p><p>hv-time, but the others are also &#039;-&#039;, so it&#039;s likely that either is accepted.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1385952">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1386097" class="blockpost roweven"> <h2><span><span class="conr">#1224</span> <a href="viewtopic.php?pid=1386097#p1386097">2014-02-26 12:58:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79825">redger</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-02-26</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79825">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hi All,<br />firstly thanks for all the good information in this guide</p><p>I&#039;ve been working through the instructions (as a new Arch user ie. n00b) and have hit a snag. I have complied the new kernel, qmeu and seabios as supplied by NBHS (thanks <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /> and compiled&#160; pci-stub in and set the VFIO flags.<br />When running the first test of qemu I see this message &quot;<ins>qemu-system-x86_64: hw/pci/pcie.c:240: pcie_cap_slot_hotplug_common: Assertion `((pci_dev-&gt;devfn) &amp; 0x07) == 0&#039; failed.</ins>&quot;</p><p>After a bit of hunting around I think the code responsible can be found in this post <a href="http://lists.gnu.org/archive/html/qemu-devel/2013-12/msg01183.html" rel="nofollow">http://lists.gnu.org/archive/html/qemu- … 01183.html</a> ... which seems to continue some code going back at least to 2010 .... which prevents hotpluging of devices with a non-zero &quot;function&quot; ie. 01:00.0 is ok, but 01:00.1 fails<br />BUT<br />That seems unlikely since the example quoted&#160; includes just such a device and apparently works ok. </p><p>Some other background -<br />Asrock z87 extreme6 motherboard with Intel 4670 CPU and 16GB of RAM<br />2 add-in cards (both PCIe) AMD HD6950 GPU&#160; and Renesas USB3 card<br />Arch installed as of 25-Feb-14 ie. current with sofwtare downloaded from first page on the same day</p><p><strong>Can anybody point me in the right direction ? I&#039;d be grateful for any advice</strong><br />Thanks</p><p>PS this motherboard works fine in Opensuse KVM using virt-manager (easy setup) with GPU card as secondary ... but latency is high and frame rate low, hence trying VFIO. Furthermore the Renesas USB card passes through nicely<br />The motherboard also works with XEN (with XM toolset using Powerhouse&#039;s instructions for Mint) but doesn&#039;t suit me because I can&#039;t get AMD&#039;s Catalyst Control Centre to install to support the triple screen (eyefinity) facility AND there&#039;s a problem with the Renesas USB card not resetting correctly which causes untold grief. The XL toolset allows the VM to start but there&#039;s a Windows device error on the GPU which prevents its use.</p><p>qemu command and error message</p><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 2048 -cpu Haswell,hv-time \ &gt; -smp 2,sockets=1,cores=2,threads=1 \ &gt; -bios /usr/share/qemu/bios.bin -vga none \ &gt; -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ &gt; -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ &gt; -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 qemu-system-x86_64: hw/pci/pcie.c:240: pcie_cap_slot_hotplug_common: Assertion `((pci_dev-&gt;devfn) &amp; 0x07) == 0&#039; failed.</code></pre></div><br /><p>lspci -nn</p><div class="codebox"><pre><code>00:00.0 Host bridge [0600]: Intel Corporation 4th Gen Core Processor DRAM Controller [8086:0c00] (rev 06) 00:01.0 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller [8086:0c01] (rev 06) 00:01.2 PCI bridge [0604]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller [8086:0c09] (rev 06) 00:02.0 VGA compatible controller [0300]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller [8086:0412] (rev 06) 00:03.0 Audio device [0403]: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller [8086:0c0c] (rev 06) 00:14.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI [8086:8c31] (rev 05) 00:16.0 Communication controller [0780]: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 [8086:8c3a] (rev 04) 00:19.0 Ethernet controller [0200]: Intel Corporation Ethernet Connection I217-V [8086:153b] (rev 05) 00:1a.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 [8086:8c2d] (rev 05) 00:1b.0 Audio device [0403]: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller [8086:8c20] (rev 05) 00:1c.0 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 [8086:8c10] (rev d5) 00:1c.2 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 [8086:8c14] (rev d5) 00:1c.3 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 [8086:8c16] (rev d5) 00:1c.4 PCI bridge [0604]: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 [8086:8c18] (rev d5) 00:1d.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 [8086:8c26] (rev 05) 00:1f.0 ISA bridge [0601]: Intel Corporation Z87 Express LPC Controller [8086:8c44] (rev 05) 00:1f.2 SATA controller [0106]: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] [8086:8c02] (rev 05) 00:1f.3 SMBus [0c05]: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller [8086:8c22] (rev 05) 01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Cayman PRO [Radeon HD 6950] [1002:6719] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Cayman/Antilles HDMI Audio [Radeon HD 6900 Series] [1002:aa80] 02:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller [1912:0014] (rev 03) 04:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01) 05:00.0 Ethernet controller [0200]: Intel Corporation I211 Gigabit Network Connection [8086:1539] (rev 03) 06:00.0 SATA controller [0106]: ASMedia Technology Inc. ASM1062 Serial ATA Controller [1b21:0612] (rev 01)</code></pre></div><p>dmesg |grep pci-stub</p><div class="codebox"><pre><code> 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=714ebc3d-5848-4d11-9329-39c5067a8917 rw intel_iommu=on pci-stub.ids=8086:0c01,8086:0c09,1002:6719,1002:aa80,1912:0014,8086:8c10,8086:8c14,8086:8c16,8086:8c18,1b21:0612,8086:1539 quiet [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=UUID=714ebc3d-5848-4d11-9329-39c5067a8917 rw intel_iommu=on pci-stub.ids=8086:0c01,8086:0c09,1002:6719,1002:aa80,1912:0014,8086:8c10,8086:8c14,8086:8c16,8086:8c18,1b21:0612,8086:1539 quiet [ 0.332791] pci-stub: add 8086:0C01 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332794] pci-stub: add 8086:0C09 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332796] pci-stub: add 1002:6719 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332800] pci-stub 0000:01:00.0: claimed by stub [ 0.332801] pci-stub: add 1002:AA80 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332804] pci-stub 0000:01:00.1: claimed by stub [ 0.332806] pci-stub: add 1912:0014 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332809] pci-stub 0000:02:00.0: claimed by stub [ 0.332810] pci-stub: add 8086:8C10 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332813] pci-stub: add 8086:8C14 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332816] pci-stub: add 8086:8C16 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332819] pci-stub: add 8086:8C18 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332822] pci-stub: add 1B21:0612 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332826] pci-stub 0000:04:00.0: claimed by stub [ 0.332828] pci-stub 0000:06:00.0: claimed by stub [ 0.332829] pci-stub: add 8086:1539 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.332833] pci-stub 0000:05:00.0: claimed by stub</code></pre></div><p>dmesg |grep -e IOMMU -e DMAR</p><div class="codebox"><pre><code>[ 0.000000] ACPI: DMAR 00000000bc173bd8 0000B8 (v01 INTEL HSW 00000001 INTL 00000001) [ 0.000000] Intel-IOMMU: enabled [ 0.022553] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a [ 0.022557] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008020660462 ecap f010da [ 0.022623] IOAPIC id 2 under DRHD base 0xfed91000 IOMMU 1 [ 0.319935] DMAR: No ATSR found [ 0.319952] IOMMU 0 0xfed90000: using Queued invalidation [ 0.319952] IOMMU 1 0xfed91000: using Queued invalidation [ 0.319953] IOMMU: Setting RMRR: [ 0.319961] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf800000 - 0xcf9fffff] [ 0.321223] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbc027000 - 0xbc033fff] [ 0.321244] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbc027000 - 0xbc033fff] [ 0.321261] IOMMU: Setting identity map for device 0000:00:14.0 [0xbc027000 - 0xbc033fff] [ 0.321273] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.321279] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]</code></pre></div><p>IOMMU groups</p><div class="codebox"><pre><code>(for i in /sys/kernel/iommu_groups/*;do echo &quot;IOMMU: $i&quot;;for dev in $i/devices/*;do lspci -s &quot;${dev##*/}&quot;; done; echo;done)</code></pre></div><div class="codebox"><pre class="vscroll"><code>IOMMU: /sys/kernel/iommu_groups/0 00:00.0 Host bridge: Intel Corporation 4th Gen Core Processor DRAM Controller (rev 06) IOMMU: /sys/kernel/iommu_groups/1 00:01.0 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x16 Controller (rev 06) 00:01.2 PCI bridge: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor PCI Express x4 Controller (rev 06) 01:00.0 VGA compatible controller: Advanced Micro Devices, Inc. [AMD/ATI] Cayman PRO [Radeon HD 6950] 01:00.1 Audio device: Advanced Micro Devices, Inc. [AMD/ATI] Cayman/Antilles HDMI Audio [Radeon HD 6900 Series] 02:00.0 USB controller: Renesas Technology Corp. uPD720201 USB 3.0 Host Controller (rev 03) IOMMU: /sys/kernel/iommu_groups/10 00:1d.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 (rev 05) IOMMU: /sys/kernel/iommu_groups/11 00:1f.0 ISA bridge: Intel Corporation Z87 Express LPC Controller (rev 05) 00:1f.2 SATA controller: Intel Corporation 8 Series/C220 Series Chipset Family 6-port SATA Controller 1 [AHCI mode] (rev 05) 00:1f.3 SMBus: Intel Corporation 8 Series/C220 Series Chipset Family SMBus Controller (rev 05) IOMMU: /sys/kernel/iommu_groups/2 00:02.0 VGA compatible controller: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor Integrated Graphics Controller (rev 06) IOMMU: /sys/kernel/iommu_groups/3 00:03.0 Audio device: Intel Corporation Xeon E3-1200 v3/4th Gen Core Processor HD Audio Controller (rev 06) IOMMU: /sys/kernel/iommu_groups/4 00:14.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI (rev 05) IOMMU: /sys/kernel/iommu_groups/5 00:16.0 Communication controller: Intel Corporation 8 Series/C220 Series Chipset Family MEI Controller #1 (rev 04) IOMMU: /sys/kernel/iommu_groups/6 00:19.0 Ethernet controller: Intel Corporation Ethernet Connection I217-V (rev 05) IOMMU: /sys/kernel/iommu_groups/7 00:1a.0 USB controller: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 (rev 05) IOMMU: /sys/kernel/iommu_groups/8 00:1b.0 Audio device: Intel Corporation 8 Series/C220 Series Chipset High Definition Audio Controller (rev 05) IOMMU: /sys/kernel/iommu_groups/9 00:1c.0 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #1 (rev d5) 00:1c.2 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #3 (rev d5) 00:1c.3 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #4 (rev d5) 00:1c.4 PCI bridge: Intel Corporation 8 Series/C220 Series Chipset Family PCI Express Root Port #5 (rev d5) 04:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01) 05:00.0 Ethernet controller: Intel Corporation I211 Gigabit Network Connection (rev 03) 06:00.0 SATA controller: ASMedia Technology Inc. ASM1062 Serial ATA Controller (rev 01)</code></pre></div><p>contents of vfio-pci.cfg</p><div class="codebox"><pre><code>DEVICES=&quot;0000:01:00.0 0000:01:00.1 0000:02:00.0 0000:04:00.0 0000:05:00.0 0000:06:00.0&quot;</code></pre></div><p>ie. the GPU, Renesas USB card, Asmedia Sata controllers and 2nd Intel NIC will be passed to the guest (this works nicely on OpenSuse via Virt-Manager ... hopefully even better with VFIO)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1386097">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1386145" class="blockpost rowodd"> <h2><span><span class="conr">#1225</span> <a href="viewtopic.php?pid=1386145#p1386145">2014-02-26 15:26:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=74748">kaeptnb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-04</span></dd> <dd><span>Posts: 30</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=74748">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>redger wrote:</cite><blockquote><div><p><strong>Can anybody point me in the right direction ? I&#039;d be grateful for any advice</strong><br />Thanks</p></div></blockquote></div><p>Try it with qemu-1.7.0 stable. and then without &quot;hv-time&quot; because 1.7.0 doesn&#039;t know about hv-time yet.</p><p>aw posted a patch (Post #1217) which should eliminate your error - it did here; BUT my guest produces BSOD with current qemu git even with this patch - but works fine with qemu 1.7.0...</p> <p class="postedit"><em>Last edited by kaeptnb (2014-02-26 15:26:56)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1386145">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=48">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=47">47</a> <a href="viewtopic.php?id=162768&amp;p=48">48</a> <strong>49</strong> <a href="viewtopic.php?id=162768&amp;p=50">50</a> <a href="viewtopic.php?id=162768&amp;p=51">51</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=50">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
