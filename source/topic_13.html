<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 13) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=13" title="Page 13" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=12" title="Page 12" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=14" title="Page 14" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=12">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=11">11</a> <a href="viewtopic.php?id=162768&amp;p=12">12</a> <strong>13</strong> <a href="viewtopic.php?id=162768&amp;p=14">14</a> <a href="viewtopic.php?id=162768&amp;p=15">15</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=14">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1304792" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#301</span> <a href="viewtopic.php?pid=1304792#p1304792">2013-07-27 16:41:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73558">mukiex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-27</span></dd> <dd><span>Posts: 18</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:mukisign@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I seem to be having the same issue that apoapo and myweb are running through.</p><div class="codebox"><pre><code>- With the Radeon as the primary video device, I get apoapo&#039;s dirty stream of errors :</code></pre></div><p>system-x86_64: vfio_bar_write(,0x13ff50, 0x36703067,4) failed: Device or resource busy</p><p>and this in dmesg:</p><div class="codebox"><pre><code>[ 763.408269] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref] [ 763.408280] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref] [ 763.408291] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref]</code></pre></div><p>With Intel integrated as the primary device, no errors come up, but <strong>the Radeon never initializes</strong>.</p><p>The latter seems like an easier start point. Is there any way to force that card to turn on during the SEABios boot? Any way to log why it&#039;s not doing so?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304792">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304821" class="blockpost roweven"> <h2><span><span class="conr">#302</span> <a href="viewtopic.php?pid=1304821#p1304821">2013-07-27 17:46:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Yes but is it using the ahci or pata driver?, from what im getting enabling iommu switches the marvell controller into ide mode is this correct?, i believe there is a way to switch the controller into ahci using grub using the setpci command, i know some mac users did that when dual booting windows on some intel controller, im not sure how or if this is possible on yours</p></div></blockquote></div><p>I highly doubt that. It&#039;s ~00:30 here and I tested this a few hours ago, so I might be wrong but the driver is matched via tha pci id and that shouldn&#039;t change. Since I blacklisted the driver, I think I remember loading it manually and testing the drive, but I should probably go to bed, soon.</p></div></blockquote></div><div class="codebox"><pre><code>modinfo ahci</code></pre></div><div class="codebox"><pre><code>parm: marvell_enable:Marvell SATA via AHCI (1 = enabled) (int)</code></pre></div><p>So you could try to add&#160; ahci.marvell_enable=1 as a kernel parameter or to /etc/modprobe.d/marvel.conf, i also found <a href="http://forum.mandriva.com/en/viewtopic.php?t=120279" rel="nofollow">http://forum.mandriva.com/en/viewtopic.php?t=120279</a>, so yeah if that doesnt work i dunno</p><p>EDIT: from wikipedia:</p><p>88SE91xx chipsets Linux support</p><p>Linux SATA driver<br />Appears to be supported by the standard AHCI driver, however out of the box is not recognised by the AHCI driver - AHCI driver needs to be taught to be loaded for the relevant PCI vendor and product ID.</p><p>Check lspci -nnk for the PCI vendor and product ID. i.e. in the following instance the relevant part is &quot;1b4b:9192&quot;</p><p>04:00.0 RAID bus controller [0104]: Marvell Technology Group Ltd. Device [1b4b:9192] (re11)</p><p>To associate these IDs with the AHCI driver run</p><p>/bin/echo 1b4b 9192 &gt; /sys/bus/pci/drivers/ahci/new_id</p></div></blockquote></div><p>I read that wikipedia article a while back, but it doesn&#039;t work. With ahci.marvell_enable=1 the driver even gets loaded automatically, but it doesn&#039;t recognize any devices (at least with iommu on, but the pata-marvell driver works decent with iommu off, so why try to force the ahci?). Relevant dmesg (dmesg|egrep -i (ata|ahci|scsi)) </p><div class="codebox"><pre class="vscroll"><code>[ 0.955526] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252) [ 0.990232] SCSI subsystem initialized [ 0.993158] ACPI: bus type ATA registered [ 0.993369] libata version 3.00 loaded. [ 0.994387] pata_acpi 0000:02:00.1: enabling device (0000 -&gt; 0003) [ 1.238497] ahci 0000:00:11.0: version 3.0 [ 1.238729] ahci 0000:00:11.0: AHCI 0001.0200 32 slots 6 ports 6 Gbps 0x3f impl SATA mode [ 1.238734] ahci 0000:00:11.0: flags: 64bit ncq sntf ilck pm led clo pmp pio slum part [ 1.240134] scsi0 : ahci [ 1.240202] scsi1 : ahci [ 1.240277] scsi2 : ahci [ 1.240333] scsi3 : ahci [ 1.240418] scsi4 : ahci [ 1.240470] scsi5 : ahci [ 1.240513] ata1: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b100 irq 19 [ 1.240515] ata2: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b180 irq 19 [ 1.240517] ata3: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b200 irq 19 [ 1.240519] ata4: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b280 irq 19 [ 1.240521] ata5: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b300 irq 19 [ 1.240523] ata6: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b380 irq 19 [ 1.240619] ahci 0000:02:00.0: irq 75 for MSI/MSI-X [ 1.240632] ahci 0000:02:00.0: forcing PORTS_IMPL to 0x1 [ 1.702088] ata6: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.702107] ata5: SATA link up 6.0 Gbps (SStatus 133 SControl 300) [ 1.702123] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.703241] ata6.00: ATA-8: ST31000520AS, CC32, max UDMA/133 [ 1.703243] ata6.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32) [ 1.704090] ata2: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.704561] ata6.00: configured for UDMA/133 [ 1.705090] ata1: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.705109] ata4: SATA link up 6.0 Gbps (SStatus 133 SControl 300) [ 1.705619] ata1.00: ATA-8: WDC WD10EADS-00L5B1, 01.01A01, max UDMA/133 [ 1.705620] ata1.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.706205] ata1.00: configured for UDMA/133 [ 1.706285] scsi 0:0:0:0: Direct-Access ATA WDC WD10EADS-00L 01.0 PQ: 0 ANSI: 5 [ 1.708208] ata3.00: ATA-8: SAMSUNG HD204UI, 1AQ10001, max UDMA/133 [ 1.708210] ata3.00: 3907029168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.710489] ata2.00: ATA-7: SAMSUNG HD103SI, 1AG01118, max UDMA7 [ 1.710491] ata2.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.711470] ata4.00: ATA-8: WDC WD20EARX-00PASB0, 51.0AB51, max UDMA/133 [ 1.711472] ata4.00: 3907029168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.713723] ata5.00: ATA-8: ADATA SP900, 5.0.2a, max UDMA/133 [ 1.713725] ata5.00: 250069680 sectors, multi 16: LBA48 NCQ (depth 31/32), AA [ 1.714324] ata3.00: configured for UDMA/133 [ 1.716961] ata2.00: configured for UDMA/133 [ 1.717032] scsi 1:0:0:0: Direct-Access ATA SAMSUNG HD103SI 1AG0 PQ: 0 ANSI: 5 [ 1.717202] scsi 2:0:0:0: Direct-Access ATA SAMSUNG HD204UI 1AQ1 PQ: 0 ANSI: 5 [ 1.718470] ata4.00: configured for UDMA/133 [ 1.718535] scsi 3:0:0:0: Direct-Access ATA WDC WD20EARX-00P 51.0 PQ: 0 ANSI: 5 [ 1.723710] ata5.00: configured for UDMA/133 [ 1.723771] scsi 4:0:0:0: Direct-Access ATA ADATA SP900 5.0. PQ: 0 ANSI: 5 [ 1.723902] scsi 5:0:0:0: Direct-Access ATA ST31000520AS CC32 PQ: 0 ANSI: 5 [ 2.248026] ahci 0000:02:00.0: controller reset failed (0x80000001) [ 2.248100] ahci 0000:02:00.0: AHCI 0000.0000 1 slots 1 ports ? Gbps 0x1 impl SATA mode [ 2.248102] ahci 0000:02:00.0: flags: [ 2.248239] scsi6 : ahci [ 2.248291] ata7: SATA max UDMA/133 abar m2048@0xfe615000 port 0xfe615100 irq 75 [ 2.557575] ata7: SATA link down (SStatus 0 SControl 300) [ 2.565869] sd 4:0:0:0: [sde] Attached SCSI disk [ 2.579963] sd 5:0:0:0: [sdf] Attached SCSI disk [ 2.585895] sd 1:0:0:0: [sdb] Attached SCSI disk [ 2.589825] sd 2:0:0:0: [sdc] Attached SCSI disk [ 3.039930] sd 3:0:0:0: [sdd] Attached SCSI disk [ 3.083346] sd 0:0:0:0: [sda] Attached SCSI disk [ 3.863782] scsi7 : pata_marvell [ 3.864187] scsi8 : pata_marvell [ 3.864574] ata8: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 3.864577] ata9: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 165.303195] ata9: soft resetting link [ 165.465217] ata9: EH complete [ 179.817277] ata8: soft resetting link [ 179.969106] ata8: EH complete [ 189.161840] ata7: hard resetting link [ 189.467441] ata7: SATA link down (SStatus 0 SControl 300) [ 189.467461] ata7: EH complete [ 315.833140] ata8: soft resetting link [ 315.984546] ata8: EH complete [ 318.974146] ata8: soft resetting link [ 319.125082] ata8: EH complete [ 328.019533] scsi9 : pata_marvell [ 328.019951] scsi10 : pata_marvell [ 328.020417] ata10: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 328.020426] ata11: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 373.887292] ata11: soft resetting link [ 374.048856] ata11: EH complete [ 381.099605] ata10: soft resetting link [ 381.250912] ata10: EH complete [ 409.101457] ahci 0000:02:00.0: irq 75 for MSI/MSI-X [ 409.101485] ahci 0000:02:00.0: forcing PORTS_IMPL to 0x1 [ 410.106469] ahci 0000:02:00.0: controller reset failed (0x80000003) [ 410.106481] ahci 0000:02:00.0: AHCI 0000.0000 1 slots 1 ports ? Gbps 0x1 impl SATA mode [ 410.106483] ahci 0000:02:00.0: flags: [ 410.106655] scsi11 : ahci [ 410.106706] ata12: SATA max UDMA/133 abar m2048@0xfe615000 port 0xfe615100 irq 75 [ 410.412017] ata12: SATA link down (SStatus 0 SControl 300) [ 427.452877] ata12: hard resetting link [ 427.757703] ata12: SATA link down (SStatus 0 SControl 300) [ 427.757721] ata12: EH complete [ 443.326795] scsi12 : pata_marvell [ 443.327090] scsi13 : pata_marvell [ 443.327348] ata13: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 443.327354] ata14: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 455.198604] ata13: soft resetting link [ 455.349916] ata13: EH complete [ 460.648310] ata14: soft resetting link [ 460.809941] ata14: EH complete</code></pre></div><p>As you can see, I played around with the different drivers (pata-marvell loads normally now), but no devices are recognized. Windows VM still BSODs.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304821">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304848" class="blockpost rowodd"> <h2><span><span class="conr">#303</span> <a href="viewtopic.php?pid=1304848#p1304848">2013-07-27 19:06:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GizmoChicken wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Congrats, your problem is you installed windows with virt-manager using the ide controller instead of the &quot;sata&quot; controller (ahci), and windows doesnt like that (it doesnt like that even on bare hardware), see this post on the same problem <a href="https://bbs.archlinux.org/viewtopic.php?pid=1298880#p1298880" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 0#p1298880</a>, also &quot;amd_iommu=on&quot; is not a valid kernel parameter as the kernel automatically enables it on amd boards</p></div></blockquote></div><p>Yep, that probably explains it.&#160; I&#039;ll create fresh VMs (Windows and Ubuntu) using sata/ahci next week and will test whether they too run with the unpatched versions of qemu and seabios along with the stock Ubuntu 3.10 kernel.</p><p>Oh, I tested my Nvidia GT610 as yet another secondary GPU, and it seems to be working great too.&#160; Not quite as fast as my Nvidia GTX550Ti, but plenty&#160; fast for Netflix and Youtube.</p><p>QUESTION:&#160; Although it&#039;s a bit slow, I really like that my GT610 is fanless, and therefore silent.&#160; And so I&#039;m thinking that I might like a matching GT610 for use as a primary card on my host.&#160; But I&#039;m wondering, if my primary and secondary cards are identical (both GT610s), would I be able to use pci-stub to bind selectively my secondary card?&#160; &#160;That is, in the case where the primary and secondary cards (and presumably their identifies) are identical, would there be some means by which pci-stub could distinguish the two cards, such as by pci-slot location?</p></div></blockquote></div><br /><p>If they&#039;re the same vendor yeah you&#039;ll have problems with with pci stub, what you can do is flash one card and modify the vendor id, or buy another one from a different vendor, also dont forget to check out my post on performance report/improvements <a href="https://bbs.archlinux.org/viewtopic.php?pid=1270311#p1270311" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 1#p1270311</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304848">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304849" class="blockpost roweven"> <h2><span><span class="conr">#304</span> <a href="viewtopic.php?pid=1304849#p1304849">2013-07-27 19:07:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Dear All,</p><p> I am still unable get Windows running with ATI HD7750 card:<br /> I could pass first part of windows installation (partitionig and files<br /> copying), but then VM reboots and I get black screen.<br />Alex Williamson proposed to use &quot;vga-current&quot; branch of : <br />git://github.com/awilliam/qemu-vfio.git<br />git://github.com/awilliam/linux-vfio.git</p><p>Could you please check if I created right PKGBUILD files?</p><p>Linux vfio: <a href="http://www.fileswap.com/dl/K7s93euILN/" rel="nofollow">http://www.fileswap.com/dl/K7s93euILN/</a><br />Qemu vfio: <a href="http://www.fileswap.com/dl/Oie83lou8B/" rel="nofollow">http://www.fileswap.com/dl/Oie83lou8B/</a></p></div></blockquote></div><p>So it does work at some point but after doing a reboot it doesnt work anymore?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304849">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304854" class="blockpost rowodd"> <h2><span><span class="conr">#305</span> <a href="viewtopic.php?pid=1304854#p1304854">2013-07-27 19:34:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mukiex wrote:</cite><blockquote><div><p>I seem to be having the same issue that apoapo and myweb are running through.</p><div class="codebox"><pre><code>- With the Radeon as the primary video device, I get apoapo&#039;s dirty stream of errors :</code></pre></div><p>system-x86_64: vfio_bar_write(,0x13ff50, 0x36703067,4) failed: Device or resource busy</p><p>and this in dmesg:</p><div class="codebox"><pre><code>[ 763.408269] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref] [ 763.408280] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref] [ 763.408291] vfio-pci 0000:01:00.0: BAR 0: can&#039;t reserve [mem 0xe0000000-0xefffffff 64bit pref]</code></pre></div><p>With Intel integrated as the primary device, no errors come up, but <strong>the Radeon never initializes</strong>.</p><p>The latter seems like an easier start point. Is there any way to force that card to turn on during the SEABios boot? Any way to log why it&#039;s not doing so?</p></div></blockquote></div><p>Well assuming you have 2 cards (the IGP and the radeon) the IGP should always be the primary one since you cant pass it through and passing through your primary card isnt supported, are you using my builds i posted on the main guide(kernel, qemu and seabios)?</p> <p class="postedit"><em>Last edited by nbhs (2013-07-27 19:35:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304854">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304858" class="blockpost roweven"> <h2><span><span class="conr">#306</span> <a href="viewtopic.php?pid=1304858#p1304858">2013-07-27 19:47:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>I highly doubt that. It&#039;s ~00:30 here and I tested this a few hours ago, so I might be wrong but the driver is matched via tha pci id and that shouldn&#039;t change. Since I blacklisted the driver, I think I remember loading it manually and testing the drive, but I should probably go to bed, soon.</p></div></blockquote></div><div class="codebox"><pre><code>modinfo ahci</code></pre></div><div class="codebox"><pre><code>parm: marvell_enable:Marvell SATA via AHCI (1 = enabled) (int)</code></pre></div><p>So you could try to add&#160; ahci.marvell_enable=1 as a kernel parameter or to /etc/modprobe.d/marvel.conf, i also found <a href="http://forum.mandriva.com/en/viewtopic.php?t=120279" rel="nofollow">http://forum.mandriva.com/en/viewtopic.php?t=120279</a>, so yeah if that doesnt work i dunno</p><p>EDIT: from wikipedia:</p><p>88SE91xx chipsets Linux support</p><p>Linux SATA driver<br />Appears to be supported by the standard AHCI driver, however out of the box is not recognised by the AHCI driver - AHCI driver needs to be taught to be loaded for the relevant PCI vendor and product ID.</p><p>Check lspci -nnk for the PCI vendor and product ID. i.e. in the following instance the relevant part is &quot;1b4b:9192&quot;</p><p>04:00.0 RAID bus controller [0104]: Marvell Technology Group Ltd. Device [1b4b:9192] (re11)</p><p>To associate these IDs with the AHCI driver run</p><p>/bin/echo 1b4b 9192 &gt; /sys/bus/pci/drivers/ahci/new_id</p></div></blockquote></div><p>I read that wikipedia article a while back, but it doesn&#039;t work. With ahci.marvell_enable=1 the driver even gets loaded automatically, but it doesn&#039;t recognize any devices (at least with iommu on, but the pata-marvell driver works decent with iommu off, so why try to force the ahci?). Relevant dmesg (dmesg|egrep -i (ata|ahci|scsi)) </p><div class="codebox"><pre class="vscroll"><code>[ 0.955526] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 252) [ 0.990232] SCSI subsystem initialized [ 0.993158] ACPI: bus type ATA registered [ 0.993369] libata version 3.00 loaded. [ 0.994387] pata_acpi 0000:02:00.1: enabling device (0000 -&gt; 0003) [ 1.238497] ahci 0000:00:11.0: version 3.0 [ 1.238729] ahci 0000:00:11.0: AHCI 0001.0200 32 slots 6 ports 6 Gbps 0x3f impl SATA mode [ 1.238734] ahci 0000:00:11.0: flags: 64bit ncq sntf ilck pm led clo pmp pio slum part [ 1.240134] scsi0 : ahci [ 1.240202] scsi1 : ahci [ 1.240277] scsi2 : ahci [ 1.240333] scsi3 : ahci [ 1.240418] scsi4 : ahci [ 1.240470] scsi5 : ahci [ 1.240513] ata1: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b100 irq 19 [ 1.240515] ata2: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b180 irq 19 [ 1.240517] ata3: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b200 irq 19 [ 1.240519] ata4: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b280 irq 19 [ 1.240521] ata5: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b300 irq 19 [ 1.240523] ata6: SATA max UDMA/133 abar m1024@0xfe70b000 port 0xfe70b380 irq 19 [ 1.240619] ahci 0000:02:00.0: irq 75 for MSI/MSI-X [ 1.240632] ahci 0000:02:00.0: forcing PORTS_IMPL to 0x1 [ 1.702088] ata6: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.702107] ata5: SATA link up 6.0 Gbps (SStatus 133 SControl 300) [ 1.702123] ata3: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.703241] ata6.00: ATA-8: ST31000520AS, CC32, max UDMA/133 [ 1.703243] ata6.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32) [ 1.704090] ata2: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.704561] ata6.00: configured for UDMA/133 [ 1.705090] ata1: SATA link up 3.0 Gbps (SStatus 123 SControl 300) [ 1.705109] ata4: SATA link up 6.0 Gbps (SStatus 133 SControl 300) [ 1.705619] ata1.00: ATA-8: WDC WD10EADS-00L5B1, 01.01A01, max UDMA/133 [ 1.705620] ata1.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.706205] ata1.00: configured for UDMA/133 [ 1.706285] scsi 0:0:0:0: Direct-Access ATA WDC WD10EADS-00L 01.0 PQ: 0 ANSI: 5 [ 1.708208] ata3.00: ATA-8: SAMSUNG HD204UI, 1AQ10001, max UDMA/133 [ 1.708210] ata3.00: 3907029168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.710489] ata2.00: ATA-7: SAMSUNG HD103SI, 1AG01118, max UDMA7 [ 1.710491] ata2.00: 1953525168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.711470] ata4.00: ATA-8: WDC WD20EARX-00PASB0, 51.0AB51, max UDMA/133 [ 1.711472] ata4.00: 3907029168 sectors, multi 0: LBA48 NCQ (depth 31/32), AA [ 1.713723] ata5.00: ATA-8: ADATA SP900, 5.0.2a, max UDMA/133 [ 1.713725] ata5.00: 250069680 sectors, multi 16: LBA48 NCQ (depth 31/32), AA [ 1.714324] ata3.00: configured for UDMA/133 [ 1.716961] ata2.00: configured for UDMA/133 [ 1.717032] scsi 1:0:0:0: Direct-Access ATA SAMSUNG HD103SI 1AG0 PQ: 0 ANSI: 5 [ 1.717202] scsi 2:0:0:0: Direct-Access ATA SAMSUNG HD204UI 1AQ1 PQ: 0 ANSI: 5 [ 1.718470] ata4.00: configured for UDMA/133 [ 1.718535] scsi 3:0:0:0: Direct-Access ATA WDC WD20EARX-00P 51.0 PQ: 0 ANSI: 5 [ 1.723710] ata5.00: configured for UDMA/133 [ 1.723771] scsi 4:0:0:0: Direct-Access ATA ADATA SP900 5.0. PQ: 0 ANSI: 5 [ 1.723902] scsi 5:0:0:0: Direct-Access ATA ST31000520AS CC32 PQ: 0 ANSI: 5 [ 2.248026] ahci 0000:02:00.0: controller reset failed (0x80000001) [ 2.248100] ahci 0000:02:00.0: AHCI 0000.0000 1 slots 1 ports ? Gbps 0x1 impl SATA mode [ 2.248102] ahci 0000:02:00.0: flags: [ 2.248239] scsi6 : ahci [ 2.248291] ata7: SATA max UDMA/133 abar m2048@0xfe615000 port 0xfe615100 irq 75 [ 2.557575] ata7: SATA link down (SStatus 0 SControl 300) [ 2.565869] sd 4:0:0:0: [sde] Attached SCSI disk [ 2.579963] sd 5:0:0:0: [sdf] Attached SCSI disk [ 2.585895] sd 1:0:0:0: [sdb] Attached SCSI disk [ 2.589825] sd 2:0:0:0: [sdc] Attached SCSI disk [ 3.039930] sd 3:0:0:0: [sdd] Attached SCSI disk [ 3.083346] sd 0:0:0:0: [sda] Attached SCSI disk [ 3.863782] scsi7 : pata_marvell [ 3.864187] scsi8 : pata_marvell [ 3.864574] ata8: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 3.864577] ata9: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 165.303195] ata9: soft resetting link [ 165.465217] ata9: EH complete [ 179.817277] ata8: soft resetting link [ 179.969106] ata8: EH complete [ 189.161840] ata7: hard resetting link [ 189.467441] ata7: SATA link down (SStatus 0 SControl 300) [ 189.467461] ata7: EH complete [ 315.833140] ata8: soft resetting link [ 315.984546] ata8: EH complete [ 318.974146] ata8: soft resetting link [ 319.125082] ata8: EH complete [ 328.019533] scsi9 : pata_marvell [ 328.019951] scsi10 : pata_marvell [ 328.020417] ata10: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 328.020426] ata11: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 373.887292] ata11: soft resetting link [ 374.048856] ata11: EH complete [ 381.099605] ata10: soft resetting link [ 381.250912] ata10: EH complete [ 409.101457] ahci 0000:02:00.0: irq 75 for MSI/MSI-X [ 409.101485] ahci 0000:02:00.0: forcing PORTS_IMPL to 0x1 [ 410.106469] ahci 0000:02:00.0: controller reset failed (0x80000003) [ 410.106481] ahci 0000:02:00.0: AHCI 0000.0000 1 slots 1 ports ? Gbps 0x1 impl SATA mode [ 410.106483] ahci 0000:02:00.0: flags: [ 410.106655] scsi11 : ahci [ 410.106706] ata12: SATA max UDMA/133 abar m2048@0xfe615000 port 0xfe615100 irq 75 [ 410.412017] ata12: SATA link down (SStatus 0 SControl 300) [ 427.452877] ata12: hard resetting link [ 427.757703] ata12: SATA link down (SStatus 0 SControl 300) [ 427.757721] ata12: EH complete [ 443.326795] scsi12 : pata_marvell [ 443.327090] scsi13 : pata_marvell [ 443.327348] ata13: PATA max UDMA/100 cmd 0xd040 ctl 0xd030 bmdma 0xd000 irq 45 [ 443.327354] ata14: PATA max UDMA/133 cmd 0xd020 ctl 0xd010 bmdma 0xd008 irq 45 [ 455.198604] ata13: soft resetting link [ 455.349916] ata13: EH complete [ 460.648310] ata14: soft resetting link [ 460.809941] ata14: EH complete</code></pre></div><p>As you can see, I played around with the different drivers (pata-marvell loads normally now), but no devices are recognized. Windows VM still BSODs.</p></div></blockquote></div><p>I&#039;m unsure what your goal is meanwhile. If your goal is to get it passed through to the VM, I&#039;ll summarize what I did to get it working in Win7 without issues. If your goal is to get it working in Linux while IOMMU is enabled in the BIOS, I can&#039;t help.</p><p>My goal was to get it passed through to the VM, in AHCI mode of course, as the controller is completely useless in the host anyway due to, let&#039;s call it &quot;the missing workaround&quot; in the amd-iommu driver.<br />I didn&#039;t test the controller in IDE mode, because IDE emulation is worthless (I&#039;d rather pass through a disk attached to my internal 5-port JMB393 controller than one in IDE emulation mode on the Marvell SATA3 controller) - I do not even have the pata-marvell driver enabled in my kernel config for that reason. So I</p><p>* set the controller to AHCI mode in UEFI/BIOS (actually no UEFI here, the Gigabyte has a legacy BIOS mode)<br />* added its vendor:id to pci-stub.ids boot parameter (as said, it&#039;s completely useless for the host anyways, so make the AHCI driver ignore it completely)<br />* passed it through to the qemu VM using &quot;-device vfio-pci,host=${SATA_DEVICE},bus=pcie.0&quot; (actually it shows up with two entries in lscpi, one of wich seems to be for the E-SATA ports (they also do not work in the Linux host, same issues))<br />* Win7 automatically installed some ATA drivers for it (I didn&#039;t download anything anywhere)<br />* it works, without issues</p><p>Why is it that you refuse to bind it to pci-stub and instead mess around with blacklisting drivers in different modes? I don&#039;t get it, please excuse me if I just missed your point or got something wrong from your posts.</p> <p class="postedit"><em>Last edited by teekay (2013-07-27 20:00:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304858">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304866" class="blockpost rowodd"> <h2><span><span class="conr">#307</span> <a href="viewtopic.php?pid=1304866#p1304866">2013-07-27 20:18:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>teekay wrote:</cite><blockquote><div><p>I&#039;m unsure what your goal is meanwhile. If your goal is to get it passed through to the VM, I&#039;ll summarize what I did to get it working in Win7 without issues. If your goal is to get it working in Linux while IOMMU is enabled in the BIOS, I can&#039;t help.</p><p>My goal was to get it passed through to the VM, in AHCI mode of course, as the controller is completely useless in the host anyway due to, let&#039;s call it &quot;the missing workaround&quot; in the amd-iommu driver.<br />I didn&#039;t test the controller in IDE mode, because IDE emulation is worthless (I&#039;d rather pass through a disk attached to my internal 5-port JMB393 controller than one in IDE emulation mode). I do not even have the pata-marvell driver enabled in my kernel config for that reason. To sum it up, the marvell controller is completely useless for the host OS here. So I</p><p>* set the controller to AHCI mode in UEFI/BIOS (actually no UEFI here, the Gigabyte has a legacy BIOS mode)<br />* added its vendor:id to pci-stub.ids boot parameter (as said, it&#039;s completely useless for the host anyways, so make the AHCI driver ignore it completely)<br />* passed it through to the qemu VM using &quot;-device vfio-pci,host=${SATA_DEVICE},bus=pcie.0&quot; (actually it shows up with two entries in lscpi, one of wich seems to be for the E-SATA ports (they also do not work in the Linux host, same issues))<br />* Win7 automatically installed some ATA drivers for it (I didn&#039;t download anything anywhere)<br />* it works, without issues</p><p>Why is it that you refuse to bind it to pci-stub and instead mess around with blacklisting drivers in different modes? I don&#039;t get it, please excuse my ignorance.</p></div></blockquote></div><p>My goal is to get it passed through to the VM, but IOMMU has to be enabled in order to to that. I play around with the controller on the host, because I can&#039;t imagine, that the controller will work in a guest, bot not work on the host, while it works perfectly fine on the host with IOMMU disabled, but refuses to work with IOMMU enabled. So why should it work in the guest?<br />Also, where&#039;s the difference between loading no driver at all and binding to pci-stub? While pata-marvell was blacklisted and I hadn&#039;t added ahci.marvell_enable=1 to my kernel parameters no driver got loaded (see lspci -vvvnn earlier…).<br />I&#039;ll try pci-stub later, but we don&#039;t have the exact same controller (both are buggy, but maybe in different ways) and boards from a different manufacturer, so different things might work or not.<br />Also, the Windows installer doesn&#039;t even find drives on mine without loading a special driver from the mainboard dvd, was that the same for yours? My intention is to boot with this controller from a SSD, because trim and stuff might be strange through virtio.</p><p>Note about the E-SATA ports: I think they are handled by the same controller, arent they?</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304866">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304868" class="blockpost roweven"> <h2><span><span class="conr">#308</span> <a href="viewtopic.php?pid=1304868#p1304868">2013-07-27 20:22:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73506">GizmoChicken</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-25</span></dd> <dd><span>Posts: 15</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73506">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>GizmoChicken wrote:</cite><blockquote><div><p>QUESTION:&#160; Although it&#039;s a bit slow, I really like that my GT610 is fanless, and therefore silent.&#160; And so I&#039;m thinking that I might like a matching GT610 for use as a primary card on my host.&#160; But I&#039;m wondering, if my primary and secondary cards are identical (both GT610s), would I be able to use pci-stub to bind selectively my secondary card?&#160; &#160;That is, in the case where the primary and secondary cards (and presumably their identifies) are identical, would there be some means by which pci-stub could distinguish the two cards, such as by pci-slot location?</p></div></blockquote></div><p>If they&#039;re the same vendor yeah you&#039;ll have problems with with pci stub, what you can do is flash one card and modify the vendor id, or buy another one from a different vendor.</p></div></blockquote></div><p>I was afraid of that.&#160; Don&#039;t know if my borderline obsessive-compulsive disorder would permit me to use different venders. :-)&#160; That, and as much as I am loathe to compliment Asus, their version probably has among best cooling fins for the price.&#160; I&#039;ll look into the possibility of flashing one card with a modified vendor ID.</p><p>It&#039;s a shame that we can&#039;t use pciback, in place of pci-stub, to grab the GPU before a driver binds it.&#160; I found an outdated <a href="http://wiki.xen.org/wiki/Bind_lib.bash_:_A_script_that_makes_pciback_with_modules_easier_to_use" rel="nofollow">Xen wiki</a> entry discussing how pciback could be loaded (presumably in a Xen environment) as module if not recompiled in the kernel.</p><p>I don&#039;t suppose you&#039;ve heard of anyone getting the pciback module (or a derivative thereof) to load outside the Xen environment?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304868">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304873" class="blockpost rowodd"> <h2><span><span class="conr">#309</span> <a href="viewtopic.php?pid=1304873#p1304873">2013-07-27 20:38:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>GizmoChicken wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>GizmoChicken wrote:</cite><blockquote><div><p>QUESTION:&#160; Although it&#039;s a bit slow, I really like that my GT610 is fanless, and therefore silent.&#160; And so I&#039;m thinking that I might like a matching GT610 for use as a primary card on my host.&#160; But I&#039;m wondering, if my primary and secondary cards are identical (both GT610s), would I be able to use pci-stub to bind selectively my secondary card?&#160; &#160;That is, in the case where the primary and secondary cards (and presumably their identifies) are identical, would there be some means by which pci-stub could distinguish the two cards, such as by pci-slot location?</p></div></blockquote></div><p>If they&#039;re the same vendor yeah you&#039;ll have problems with with pci stub, what you can do is flash one card and modify the vendor id, or buy another one from a different vendor.</p></div></blockquote></div><p>I was afraid of that.&#160; Don&#039;t know if my borderline obsessive-compulsive disorder would permit me to use different venders. :-)&#160; That, and as much as I am loathe to compliment Asus, their version probably has among best cooling fins for the price.&#160; I&#039;ll look into the possibility of flashing one card with a modified vendor ID.</p><p>It&#039;s a shame that we can&#039;t use pciback, in place of pci-stub, to grab the GPU before a driver binds it.&#160; I found an outdated <a href="http://wiki.xen.org/wiki/Bind_lib.bash_:_A_script_that_makes_pciback_with_modules_easier_to_use" rel="nofollow">Xen wiki</a> entry discussing how pciback could be loaded (presumably in a Xen environment) as module if not recompiled in the kernel.</p><p>I don&#039;t suppose you&#039;ve heard of anyone getting the pciback module (or a derivative thereof) to load outside the Xen environment?</p></div></blockquote></div><p>Well now that i think about it it might work if you bind it manually to the pci-stub module but to avoid problems just flash the bios</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304873">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304885" class="blockpost roweven"> <h2><span><span class="conr">#310</span> <a href="viewtopic.php?pid=1304885#p1304885">2013-07-27 21:25:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53621">teekay</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-10-26</span></dd> <dd><span>Posts: 267</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53621">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>My goal is to get it passed through to the VM, but IOMMU has to be enabled in order to to that. I play around with the controller on the host, because I can&#039;t imagine, that the controller will work in a guest, bot not work on the host, while it works perfectly fine on the host with IOMMU disabled, but refuses to work with IOMMU enabled. So why should it work in the guest?</p></div></blockquote></div><p>Well, my only explanation is: it&#039;s the driver that fails. My board has some Etron USB3 controller. It works perfectly fine in Linux, but the driver for Windows 7 caused BSOD gallore, no matter if it&#039;s in a VM or a &quot;real&quot; install. So that&#039;s a counter example for that Marvell controller which, if IOMMU is enabled, totally fails in Linux, but works fine in Windows. You did find the bug report and the post about the intel-iommu driver having a workaround, but not the amd-iommu one. (I found the same posts when I was looking for the problem)</p><div class="quotebox"><blockquote><div><p>Also, where&#039;s the difference between loading no driver at all and binding to pci-stub? While pata-marvell was blacklisted and I hadn&#039;t added ahci.marvell_enable=1 to my kernel parameters no driver got loaded (see lspci -vvvnn earlier…).</p></div></blockquote></div><p>I have no idea, but my thinking was: if it (currently) doesn&#039;t work anyway in the host and just causes page fault and what not, and there is a way to make the host ignore it before any driver even tries to act on it (disabling AHCI driver is no option), I&#039;ll use it, Yay for pci-stub.</p><div class="quotebox"><blockquote><div><p>I&#039;ll try pci-stub later, but we don&#039;t have the exact same controller (both are buggy, but maybe in different ways) and boards from a different manufacturer, so different things might work or not.</p></div></blockquote></div><p>I realized that from your lscpi output, yes. But as they seem to act almost the same in the Linux, it&#039;s worth a try for you.</p><div class="quotebox"><blockquote><div><p>Also, the Windows installer doesn&#039;t even find drives on mine without loading a special driver from the mainboard dvd, was that the same for yours? My intention is to boot with this controller from a SSD, because trim and stuff might be strange through virtio.</p></div></blockquote></div><p>I haven&#039;t tried that. My Windows VM install is actually a converted VirtualBox image, with vbox tools uninstalled, virtio drivers added, and the install itself now resides on a qcow image. The Marvell SATA only provides a data disk inside the VM. After I added it in Qemu, Windows automatically installed drivers for it, and it &quot;just worked&quot;™</p><div class="quotebox"><blockquote><div><p>Note about the E-SATA ports: I think they are handled by the same controller, arent they?</p></div></blockquote></div><p>The same driver, yes (ahci if running in AHCI mode), but on my board the marvell exhibits itself as 2 separate controllers in lspci, and I _believe_ one of them is for the e-sata ports, I haven&#039;t verified that though (I replaced my external RAID bay with a larger case and an internal port multiplier, that external IcyDock thing was way too noisy). I pci-stub&#039;ed both (as the have same vendor and id), but maybe I just passed through the right one by pure luck.</p> <p class="postedit"><em>Last edited by teekay (2013-07-27 21:34:40)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304885">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1304887" class="blockpost rowodd"> <h2><span><span class="conr">#311</span> <a href="viewtopic.php?pid=1304887#p1304887">2013-07-27 21:39:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hm,</p><p>I have builded new kernel, but can&#039;t execute qemu:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p></div></blockquote></div><p>Try these, it will fetch and build Alex&#039;s qemu and linux trees, branch &#039;vga-current&#039;</p><p><a href="http://www.fileswap.com/dl/gfGobu92n7/" rel="nofollow">linux-vga-current.tar.gz</a><br /><a href="http://www.fileswap.com/dl/9wsT5WTH1e" rel="nofollow">qemu-vga-current.tar.gz</a></p><p>they build just fine, i havent tried anything else though, you&#039;ll also need dtc-git: <a href="https://aur.archlinux.org/packages/dtc-git/" rel="nofollow">https://aur.archlinux.org/packages/dtc-git/</a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1304887">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305020" class="blockpost roweven"> <h2><span><span class="conr">#312</span> <a href="viewtopic.php?pid=1305020#p1305020">2013-07-28 11:03:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73575">pcworld</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: Germany</span></dd> <dd><span>Registered: 2013-07-28</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:0188801@gmail.com">Email</a></span> <span class="website"><a href="https://twitter.com/pcworldsoftware" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>I&#039;m now in windows, but I still can&#039;t boot with &quot;-vga none&quot;, so I have two graphics cards and Windows picks the wrong one.</p></div></blockquote></div><p>Does that mean VGA passthrough worked for the GTX 650 (as the guest)?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Kamek wrote:</cite><blockquote><div><p>Is there a way to share a single GPU between the host and the guest ? I only have one GTX 670 in my rig, but I&#039;m sick and tired of rebooting every time I want to play a game.</p></div></blockquote></div><p>Not using this method, if you had a radeon card you could use kvm pci-assign and pass it as secondary but on NV cards this is the only reliable method (unless you&#039;re willing to try xen, and its counteless unreliable hacks)</p></div></blockquote></div><p>Is there any other method that works with only one Nvidia card and KVM? It seems Xen works with only one graphics card, when you boot the VM your graphics card is passed through to the guest system. (If Xen worked properly with Nvidia cards, that is.)<br />The host system could still be controlled via VNC/X Forwarding or similarly, and when I shut down the guest system I&#039;d like the graphics card to be reassigned to my host system.</p><p>I&#039;m considering buying a GTX 650 Ti Boost, since many (fanboys?) say Nvidia&#039;s proprietary Linux drivers were much better than fglrx (I don&#039;t know if it&#039;s true).<br />On the CPU side, the AMD FX-8350 and Intel i7-2600 are on my list, though I&#039;m rather leaning towards the AMD one since it&#039;s cheaper and officially supports overclocking. Advantage of the i7 would be its integrated GPU, but apparently it&#039;s not too reliable if it&#039;s your primary GPU and you want to forward/VGA-passthrough the other one.</p><p>Edit: Of course, great thanks for your tutorial! I&#039;ve come across many VGA-passthrough threads (mostly concering Xen), and this one seems to be one of very few that are not dead (yet).</p> <p class="postedit"><em>Last edited by pcworld (2013-07-28 11:09:37)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305020">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305055" class="blockpost rowodd"> <h2><span><span class="conr">#313</span> <a href="viewtopic.php?pid=1305055#p1305055">2013-07-28 13:41:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73558">mukiex</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-27</span></dd> <dd><span>Posts: 18</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:mukisign@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Well assuming you have 2 cards (the IGP and the radeon) the IGP should always be the primary one since you cant pass it through and passing through your primary card isnt supported, are you using my builds i posted on the main guide(kernel, qemu and seabios)?</p></div></blockquote></div><p>- I have the SeaBIOS 1.7.2 w/ patches (extension dirty? is that the right one?)<br />- Is there a patch for Kernel 3.9? I can&#039;t update to 3.10 as it breaks DKMS, and ZFS-DKMS runs my primary storage<br />- Do I need a patch Qemu or is the latest git version already updated for VFIO-reset? If not, which version do I clone to patch?</p><p>I apologize for putting my noobishness on front row here, but if anyone has a command set for pulling down and patching the kernel/qemu, I&#039;d much appreciate it.</p> <p class="postedit"><em>Last edited by mukiex (2013-07-28 14:22:42)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305068" class="blockpost roweven"> <h2><span><span class="conr">#314</span> <a href="viewtopic.php?pid=1305068#p1305068">2013-07-28 14:34:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hm,</p><p>I have builded new kernel, but can&#039;t execute qemu:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p></div></blockquote></div><p>Try these, it will fetch and build Alex&#039;s qemu and linux trees, branch &#039;vga-current&#039;</p><p><a href="http://www.fileswap.com/dl/gfGobu92n7/" rel="nofollow">linux-vga-current.tar.gz</a><br /><a href="http://www.fileswap.com/dl/9wsT5WTH1e" rel="nofollow">qemu-vga-current.tar.gz</a></p><p>they build just fine, i havent tried anything else though, you&#039;ll also need dtc-git: <a href="https://aur.archlinux.org/packages/dtc-git/" rel="nofollow">https://aur.archlinux.org/packages/dtc-git/</a></p></div></blockquote></div><p>Thank you, I have builded and installed the files, but still get:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p><p>I have tried &quot;modprobe kvm&quot;, but it does not help</p><p>modprobe kvm-intel solved the issue, but loading windows installation is failed with BSOD (your PC run into problem and need to reboot)</p> <p class="postedit"><em>Last edited by myweb (2013-07-28 14:38:48)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305068">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305199" class="blockpost rowodd"> <h2><span><span class="conr">#315</span> <a href="viewtopic.php?pid=1305199#p1305199">2013-07-28 19:06:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Hm,</p><p>I have builded new kernel, but can&#039;t execute qemu:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p></div></blockquote></div><p>Try these, it will fetch and build Alex&#039;s qemu and linux trees, branch &#039;vga-current&#039;</p><p><a href="http://www.fileswap.com/dl/gfGobu92n7/" rel="nofollow">linux-vga-current.tar.gz</a><br /><a href="http://www.fileswap.com/dl/9wsT5WTH1e" rel="nofollow">qemu-vga-current.tar.gz</a></p><p>they build just fine, i havent tried anything else though, you&#039;ll also need dtc-git: <a href="https://aur.archlinux.org/packages/dtc-git/" rel="nofollow">https://aur.archlinux.org/packages/dtc-git/</a></p></div></blockquote></div><p>Thank you, I have builded and installed the files, but still get:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p><p>I have tried &quot;modprobe kvm&quot;, but it does not help</p><p>modprobe kvm-intel solved the issue, but loading windows installation is failed with BSOD (your PC run into problem and need to reboot)</p></div></blockquote></div><p>But do you see any output on your passthrough&#039;d card? what seabios version are you using? can you get more info about the BSOD?</p> <p class="postedit"><em>Last edited by nbhs (2013-07-28 19:16:06)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305199">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305200" class="blockpost roweven"> <h2><span><span class="conr">#316</span> <a href="viewtopic.php?pid=1305200#p1305200">2013-07-28 19:08:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mukiex wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Well assuming you have 2 cards (the IGP and the radeon) the IGP should always be the primary one since you cant pass it through and passing through your primary card isnt supported, are you using my builds i posted on the main guide(kernel, qemu and seabios)?</p></div></blockquote></div><p>- I have the SeaBIOS 1.7.2 w/ patches (extension dirty? is that the right one?)<br />- Is there a patch for Kernel 3.9? I can&#039;t update to 3.10 as it breaks DKMS, and ZFS-DKMS runs my primary storage<br />- Do I need a patch Qemu or is the latest git version already updated for VFIO-reset? If not, which version do I clone to patch?</p><p>I apologize for putting my noobishness on front row here, but if anyone has a command set for pulling down and patching the kernel/qemu, I&#039;d much appreciate it.</p></div></blockquote></div><p>Right now you&#039;ll need a patched seabios, patched kernel, and patched qemu until they get merged upstream, using archlinux you can use my builds, you can fetch the kernel and qemu from alex williamson&#039;s trees <a href="https://github.com/awilliam/qemu-vfio" rel="nofollow">https://github.com/awilliam/qemu-vfio</a> and <a href="https://github.com/awilliam/linux-vfio" rel="nofollow">https://github.com/awilliam/linux-vfio</a> branch vga-current</p> <p class="postedit"><em>Last edited by nbhs (2013-07-28 19:13:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305200">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305201" class="blockpost rowodd"> <h2><span><span class="conr">#317</span> <a href="viewtopic.php?pid=1305201#p1305201">2013-07-28 19:09:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>pcworld wrote:</cite><blockquote><div><div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><p>I&#039;m now in windows, but I still can&#039;t boot with &quot;-vga none&quot;, so I have two graphics cards and Windows picks the wrong one.</p></div></blockquote></div><p>Does that mean VGA passthrough worked for the GTX 650 (as the guest)?</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>Kamek wrote:</cite><blockquote><div><p>Is there a way to share a single GPU between the host and the guest ? I only have one GTX 670 in my rig, but I&#039;m sick and tired of rebooting every time I want to play a game.</p></div></blockquote></div><p>Not using this method, if you had a radeon card you could use kvm pci-assign and pass it as secondary but on NV cards this is the only reliable method (unless you&#039;re willing to try xen, and its counteless unreliable hacks)</p></div></blockquote></div><p>Is there any other method that works with only one Nvidia card and KVM? It seems Xen works with only one graphics card, when you boot the VM your graphics card is passed through to the guest system. (If Xen worked properly with Nvidia cards, that is.)<br />The host system could still be controlled via VNC/X Forwarding or similarly, and when I shut down the guest system I&#039;d like the graphics card to be reassigned to my host system.</p><p>I&#039;m considering buying a GTX 650 Ti Boost, since many (fanboys?) say Nvidia&#039;s proprietary Linux drivers were much better than fglrx (I don&#039;t know if it&#039;s true).<br />On the CPU side, the AMD FX-8350 and Intel i7-2600 are on my list, though I&#039;m rather leaning towards the AMD one since it&#039;s cheaper and officially supports overclocking. Advantage of the i7 would be its integrated GPU, but apparently it&#039;s not too reliable if it&#039;s your primary GPU and you want to forward/VGA-passthrough the other one.</p><p>Edit: Of course, great thanks for your tutorial! I&#039;ve come across many VGA-passthrough threads (mostly concering Xen), and this one seems to be one of very few that are not dead (yet).</p></div></blockquote></div><p>You&#039;ll need 2 cards one for the host, and one for the vm, right now amd cpus seems more successful at getting it working</p> <p class="postedit"><em>Last edited by nbhs (2013-07-28 19:16:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305201">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305263" class="blockpost roweven"> <h2><span><span class="conr">#318</span> <a href="viewtopic.php?pid=1305263#p1305263">2013-07-28 21:01:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Try these, it will fetch and build Alex&#039;s qemu and linux trees, branch &#039;vga-current&#039;</p><p><a href="http://www.fileswap.com/dl/gfGobu92n7/" rel="nofollow">linux-vga-current.tar.gz</a><br /><a href="http://www.fileswap.com/dl/9wsT5WTH1e" rel="nofollow">qemu-vga-current.tar.gz</a></p><p>they build just fine, i havent tried anything else though, you&#039;ll also need dtc-git: <a href="https://aur.archlinux.org/packages/dtc-git/" rel="nofollow">https://aur.archlinux.org/packages/dtc-git/</a></p></div></blockquote></div><p>Thank you, I have builded and installed the files, but still get:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p><p>I have tried &quot;modprobe kvm&quot;, but it does not help</p><p>modprobe kvm-intel solved the issue, but loading windows installation is failed with BSOD (your PC run into problem and need to reboot)</p></div></blockquote></div><p>But do you see any output on your passthrough&#039;d card? what seabios version are you using? can you get more info about the BSOD?</p></div></blockquote></div><p>I see windows installation loading logo on passthrough&#039;d card and then BSOD on passthrough&#039;d card. BSOD: ACPI_BIOS_ERROR<br />SeaBIOS compiled from git: 1.7.3-18-g7093aa5</p><p>Also I see the following message in console when starting QEMU:<br />Attempt to reset PCI bus for VGA support failed (Device or resource busy).&#160; VGA may not work.</p> <p class="postedit"><em>Last edited by myweb (2013-07-28 21:03:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305263">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305272" class="blockpost rowodd"> <h2><span><span class="conr">#319</span> <a href="viewtopic.php?pid=1305272#p1305272">2013-07-28 21:26:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Thank you, I have builded and installed the files, but still get:<br />Could not access KVM kernel module: No such file or directory<br />failed to initialize KVM: No such file or directory</p><p>I have tried &quot;modprobe kvm&quot;, but it does not help</p><p>modprobe kvm-intel solved the issue, but loading windows installation is failed with BSOD (your PC run into problem and need to reboot)</p></div></blockquote></div><p>But do you see any output on your passthrough&#039;d card? what seabios version are you using? can you get more info about the BSOD?</p></div></blockquote></div><p>I see windows installation loading logo on passthrough&#039;d card and then BSOD on passthrough&#039;d card. BSOD: ACPI_BIOS_ERROR<br />SeaBIOS compiled from git: 1.7.3-18-g7093aa5</p><p>Also I see the following message in console when starting QEMU:<br />Attempt to reset PCI bus for VGA support failed (Device or resource busy).&#160; VGA may not work.</p></div></blockquote></div><p>The acpi bios thing its because of seabios, use my package (1.7.2 patched), the other message is likely because you&#039;re using the wrong kernel without pcie bus reset support</p> <p class="postedit"><em>Last edited by nbhs (2013-07-28 21:27:07)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305272">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305275" class="blockpost roweven"> <h2><span><span class="conr">#320</span> <a href="viewtopic.php?pid=1305275#p1305275">2013-07-28 21:33:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73593">BulliteShot</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-28</span></dd> <dd><span>Posts: 26</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:josh@servebyte.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve been trying to get this working for days now.. works on Xen but it&#039;s not usable due to all the crashing and poor performance.</p><p>I&#039;ve had enough of my intel board. Looking to buy a AM3+ gigabyte board... anyone have any suggestions that works with this?</p><p>EDIT: Also, I would like the integrated AMD graphics to work on the host.</p> <p class="postedit"><em>Last edited by BulliteShot (2013-07-28 21:34:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305275">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305279" class="blockpost rowodd"> <h2><span><span class="conr">#321</span> <a href="viewtopic.php?pid=1305279#p1305279">2013-07-28 21:37:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>BulliteShot wrote:</cite><blockquote><div><p>I&#039;ve been trying to get this working for days now.. works on Xen but it&#039;s not usable due to all the crashing and poor performance.</p><p>I&#039;ve had enough of my intel board. Looking to buy a AM3+ gigabyte board... anyone have any suggestions that works with this?</p><p>EDIT: Also, I would like the integrated AMD graphics to work on the host.</p></div></blockquote></div><p>Have you tried this guide on your intel build?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305282" class="blockpost roweven"> <h2><span><span class="conr">#322</span> <a href="viewtopic.php?pid=1305282#p1305282">2013-07-28 21:45:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73593">BulliteShot</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-28</span></dd> <dd><span>Posts: 26</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:josh@servebyte.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes, I&#039;m getting the same problem as a guy a few pages back... &quot;This device can not find enough free resources that it can use. (Code 12)&quot;... apparently something to do with using the intel integrated graphics. I read the post that was linked but it seems like a dead end?</p><p>- I can&#039;t get the graphics card to show the BIOS.<br />- If I boot the ArchLinux ISO in the VM then it shows it&#039;s loading screen on the graphics card.<br />- Windows shows the device in task manager and AMD installs the catalyst drivers.</p><div class="codebox"><pre class="vscroll"><code>[root@localhost ~]# dmesg | grep IOMMU [ 0.000000] Intel-IOMMU: enabled [ 0.021443] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a [ 0.021447] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a [ 0.021516] IOAPIC id 2 under DRHD base 0xfed91000 IOMMU 1 [ 0.297980] IOMMU 0 0xfed90000: using Queued invalidation [ 0.297981] IOMMU 1 0xfed91000: using Queued invalidation [ 0.436381] IOMMU: software identity mapping for device 0000:00:00.0 [ 0.436382] IOMMU: software identity mapping for device 0000:00:01.0 [ 0.436383] IOMMU: software identity mapping for device 0000:00:14.0 [ 0.436384] IOMMU: software identity mapping for device 0000:00:16.0 [ 0.436385] IOMMU: software identity mapping for device 0000:00:1a.0 [ 0.436386] IOMMU: software identity mapping for device 0000:00:1b.0 [ 0.436387] IOMMU: software identity mapping for device 0000:00:1c.0 [ 0.436388] IOMMU: software identity mapping for device 0000:00:1c.2 [ 0.436389] IOMMU: software identity mapping for device 0000:00:1d.0 [ 0.436390] IOMMU: software identity mapping for device 0000:00:1f.0 [ 0.436391] IOMMU: software identity mapping for device 0000:00:1f.2 [ 0.436392] IOMMU: software identity mapping for device 0000:00:1f.3 [ 0.436396] IOMMU: software identity mapping for device 0000:01:00.0 [ 0.436397] IOMMU: software identity mapping for device 0000:01:00.1 [ 0.436401] IOMMU: software identity mapping for device 0000:02:00.0 [ 0.436402] IOMMU: Setting RMRR: [ 0.436410] IOMMU: Setting identity map for device 0000:00:02.0 [0xcb800000 - 0xcf9fffff] [ 0.436696] IOMMU: Setting identity map for device 0000:00:1d.0 [0xc9d82000 - 0xc9d8efff] [ 0.436701] IOMMU: Setting identity map for device 0000:00:1a.0 [0xc9d82000 - 0xc9d8efff] [ 0.436702] IOMMU: Setting identity map for device 0000:00:14.0 [0xc9d82000 - 0xc9d8efff] [ 0.436704] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.436705] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [root@localhost ~]# </code></pre></div><div class="codebox"><pre><code>[root@localhost ~]# dmesg | grep pci-stub [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=/dev/md1 ro quiet pci-stub.ids=1002:679a,1002:aaa0 intel_iommu=on,igfx_on iommu=pt [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=/dev/md1 ro quiet pci-stub.ids=1002:679a,1002:aaa0 intel_iommu=on,igfx_on iommu=pt [ 0.705428] pci-stub: add 1002:679A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.705438] pci-stub 0000:01:00.0: claimed by stub [ 0.705442] pci-stub: add 1002:AAA0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.705448] pci-stub 0000:01:00.1: claimed by stub [root@localhost ~]# </code></pre></div><div class="codebox"><pre><code>[ 60.412232] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 60.438127] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x270 [ 60.438134] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1b@0x2d0</code></pre></div><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \ -smp 2 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -device virtio-scsi-pci,id=scsi \ -drive if=none,format=raw,file=/root/win_os.raw,id=disk \ -device scsi-hd,drive=disk \ -net nic,model=virtio \ -net tap,ifname=vm-win,script=no,downscript=no</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305282">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305285" class="blockpost rowodd"> <h2><span><span class="conr">#323</span> <a href="viewtopic.php?pid=1305285#p1305285">2013-07-28 21:50:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>BulliteShot wrote:</cite><blockquote><div><p>Yes, I&#039;m getting the same problem as a guy a few pages back... &quot;This device can not find enough free resources that it can use. (Code 12)&quot;... apparently something to do with using the intel integrated graphics. I read the post that was linked but it seems like a dead end?</p><p>- I can&#039;t get the graphics card to show the BIOS.<br />- If I boot the ArchLinux ISO in the VM then it shows it&#039;s loading screen on the graphics card.<br />- Windows shows the device in task manager and AMD installs the catalyst drivers.</p><div class="codebox"><pre class="vscroll"><code>[root@localhost ~]# dmesg | grep IOMMU [ 0.000000] Intel-IOMMU: enabled [ 0.021443] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020e60262 ecap f0101a [ 0.021447] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap c9008020660262 ecap f0105a [ 0.021516] IOAPIC id 2 under DRHD base 0xfed91000 IOMMU 1 [ 0.297980] IOMMU 0 0xfed90000: using Queued invalidation [ 0.297981] IOMMU 1 0xfed91000: using Queued invalidation [ 0.436381] IOMMU: software identity mapping for device 0000:00:00.0 [ 0.436382] IOMMU: software identity mapping for device 0000:00:01.0 [ 0.436383] IOMMU: software identity mapping for device 0000:00:14.0 [ 0.436384] IOMMU: software identity mapping for device 0000:00:16.0 [ 0.436385] IOMMU: software identity mapping for device 0000:00:1a.0 [ 0.436386] IOMMU: software identity mapping for device 0000:00:1b.0 [ 0.436387] IOMMU: software identity mapping for device 0000:00:1c.0 [ 0.436388] IOMMU: software identity mapping for device 0000:00:1c.2 [ 0.436389] IOMMU: software identity mapping for device 0000:00:1d.0 [ 0.436390] IOMMU: software identity mapping for device 0000:00:1f.0 [ 0.436391] IOMMU: software identity mapping for device 0000:00:1f.2 [ 0.436392] IOMMU: software identity mapping for device 0000:00:1f.3 [ 0.436396] IOMMU: software identity mapping for device 0000:01:00.0 [ 0.436397] IOMMU: software identity mapping for device 0000:01:00.1 [ 0.436401] IOMMU: software identity mapping for device 0000:02:00.0 [ 0.436402] IOMMU: Setting RMRR: [ 0.436410] IOMMU: Setting identity map for device 0000:00:02.0 [0xcb800000 - 0xcf9fffff] [ 0.436696] IOMMU: Setting identity map for device 0000:00:1d.0 [0xc9d82000 - 0xc9d8efff] [ 0.436701] IOMMU: Setting identity map for device 0000:00:1a.0 [0xc9d82000 - 0xc9d8efff] [ 0.436702] IOMMU: Setting identity map for device 0000:00:14.0 [0xc9d82000 - 0xc9d8efff] [ 0.436704] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 0.436705] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [root@localhost ~]# </code></pre></div><div class="codebox"><pre><code>[root@localhost ~]# dmesg | grep pci-stub [ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=/dev/md1 ro quiet pci-stub.ids=1002:679a,1002:aaa0 intel_iommu=on,igfx_on iommu=pt [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-linux-mainline root=/dev/md1 ro quiet pci-stub.ids=1002:679a,1002:aaa0 intel_iommu=on,igfx_on iommu=pt [ 0.705428] pci-stub: add 1002:679A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.705438] pci-stub 0000:01:00.0: claimed by stub [ 0.705442] pci-stub: add 1002:AAA0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 0.705448] pci-stub 0000:01:00.1: claimed by stub [root@localhost ~]# </code></pre></div><div class="codebox"><pre><code>[ 60.412232] vfio-pci 0000:01:00.0: enabling device (0000 -&gt; 0003) [ 60.438127] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x270 [ 60.438134] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x1b@0x2d0</code></pre></div><div class="codebox"><pre><code>qemu-system-x86_64 -enable-kvm -M q35 -m 4096 -cpu host \ -smp 2 \ -bios /usr/share/qemu/bios.bin \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 \ -device virtio-scsi-pci,id=scsi \ -drive if=none,format=raw,file=/root/win_os.raw,id=disk \ -device scsi-hd,drive=disk \ -net nic,model=virtio \ -net tap,ifname=vm-win,script=no,downscript=no</code></pre></div></div></blockquote></div><p>Are you using the lastest builds i posted?&#160; iommu=pt is an amd thing only (i think for intel is intel_iommu=pt) and i have no idea what igfx_on does, it seems myweb has partially got it to work on his intel board (except the bsod which im sure its a seabios thing), perhaps he knows more since i dont have an intel board to test</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305285">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305287" class="blockpost roweven"> <h2><span><span class="conr">#324</span> <a href="viewtopic.php?pid=1305287#p1305287">2013-07-28 21:55:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>The acpi bios thing its because of seabios, use my package (1.7.2 patched), the other message is likely because you&#039;re using the wrong kernel without pcie bus reset support</p></div></blockquote></div><p>Yes, You are right - I have no BSOD with 1.7.2 but I could not apply kernel-vfio-vga-reset.patch to Linux kernel from vga-current branch: I get</p><div class="codebox"><pre class="vscroll"><code>Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file drivers/pci/hotplug/pciehp.h.rej patching file drivers/pci/hotplug/pciehp_core.c Reversed (or previously applied) patch detected! Skipping patch. 3 out of 3 hunks ignored -- saving rejects to file drivers/pci/hotplug/pciehp_core.c.rej patching file drivers/pci/hotplug/pciehp_hpc.c Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file drivers/pci/hotplug/pciehp_hpc.c.rej patching file drivers/pci/pci.c Reversed (or previously applied) patch detected! Skipping patch. 5 out of 5 hunks ignored -- saving rejects to file drivers/pci/pci.c.rej patching file drivers/vfio/pci/vfio_pci.c Reversed (or previously applied) patch detected! Skipping patch. 2 out of 2 hunks ignored -- saving rejects to file drivers/vfio/pci/vfio_pci.c.rej patching file drivers/vfio/vfio.c Reversed (or previously applied) patch detected! Skipping patch. 2 out of 2 hunks ignored -- saving rejects to file drivers/vfio/vfio.c.rej patching file include/linux/pci.h Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file include/linux/pci.h.rej patching file include/linux/pci_hotplug.h Reversed (or previously applied) patch detected! Skipping patch. 3 out of 3 hunks ignored -- saving rejects to file include/linux/pci_hotplug.h.rej patching file include/linux/vfio.h Reversed (or previously applied) patch detected! Skipping patch. 1 out of 1 hunk ignored -- saving rejects to file include/linux/vfio.h.rej patching file include/uapi/linux/vfio.h Reversed (or previously applied) patch detected! Skipping patch. 2 out of 2 hunks ignored -- saving rejects to file include/uapi/linux/vfio.h.rej ==&gt; ERROR: A failure occurred in prepare(). Aborting...</code></pre></div> <p class="postedit"><em>Last edited by myweb (2013-07-28 21:58:34)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305287">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1305293" class="blockpost rowodd"> <h2><span><span class="conr">#325</span> <a href="viewtopic.php?pid=1305293#p1305293">2013-07-28 22:09:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=73162">myweb</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-13</span></dd> <dd><span>Posts: 68</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=73162">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><div class="quotebox"><cite>myweb wrote:</cite><blockquote><div><p>Dear All,</p><p> I am still unable get Windows running with ATI HD7750 card:<br /> I could pass first part of windows installation (partitionig and files<br /> copying), but then VM reboots and I get black screen.<br />Alex Williamson proposed to use &quot;vga-current&quot; branch of : <br />git://github.com/awilliam/qemu-vfio.git<br />git://github.com/awilliam/linux-vfio.git</p><p>Could you please check if I created right PKGBUILD files?</p><p>Linux vfio: <a href="http://www.fileswap.com/dl/K7s93euILN/" rel="nofollow">http://www.fileswap.com/dl/K7s93euILN/</a><br />Qemu vfio: <a href="http://www.fileswap.com/dl/Oie83lou8B/" rel="nofollow">http://www.fileswap.com/dl/Oie83lou8B/</a></p></div></blockquote></div><p>So it does work at some point but after doing a reboot it doesnt work anymore?</p></div></blockquote></div><p>Yes, You are right but it does not work anymore until VM is not restarted (qemu).<br />But when I restart Qemu and boot to windows, windows says that installation was unexpectedly interrupted and asks to reinstall.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1305293">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=12">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=11">11</a> <a href="viewtopic.php?id=162768&amp;p=12">12</a> <strong>13</strong> <a href="viewtopic.php?id=162768&amp;p=14">14</a> <a href="viewtopic.php?id=162768&amp;p=15">15</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=14">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
