<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 149) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=149" title="Page 149" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=148" title="Page 148" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=150" title="Page 150" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=148">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <a href="viewtopic.php?id=162768&amp;p=148">148</a> <strong>149</strong> <a href="viewtopic.php?id=162768&amp;p=150">150</a> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=150">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1488409" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3701</span> <a href="viewtopic.php?pid=1488409#p1488409">2014-12-29 09:32:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=84759">Ansa89</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-08-30</span></dd> <dd><span>Posts: 20</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>I&#039;m using a dedicated physical disk through lvm (I created a virtual disk using the whole physical disk and passed it to qemu).</p></div></blockquote></div><p>Maybe it&#039;s a collision of the host and guest LVM since you&#039;re using a whole disk and it will be visible to both.&#160; Is the guest volume group active in the host?</p></div></blockquote></div><p>1) LVM is used only on the host to create a virtual disk for the guest (while the guest doesn&#039;t use LVM and sees the virtual disk as a normal one).<br />2) The physical disk is visible only on the host; the virtual disk is visible to both host and guest (again: the guest sees it as a normal disk).<br />3) The LVM virtual disk is used only by the guest (and by qemu on the host).</p><br /><p>PS: what are the benefits of using virtio-blk instead of virtio-scsi?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488409">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488434" class="blockpost roweven"> <h2><span><span class="conr">#3702</span> <a href="viewtopic.php?pid=1488434#p1488434">2014-12-29 11:59:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83627">JohnyPea</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-17</span></dd> <dd><span>Posts: 17</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>pkim wrote:</cite><blockquote><div><p>2. I can&#039;t figure out how to pipe only the sound through spice. Work-around: use Xen for video card type.</p></div></blockquote></div><p>It works when you have the VM client open and connected (virt-manager, spicy). This requires virtual graphics, which can be disabled in quest, but I think a better solution is to use pulseaudio server directly. I have found information on this somewhere earlier in this thread:</p><div class="codebox"><pre><code>/etc/pulse/default.pa: .. load-module module-native-protocol-unix auth-anonymous=1 ..</code></pre></div><p>and with added configuration in VM xml:</p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DAC_FIXED_FREQ&#039; value=&#039;48000&#039;/&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_ADC_FIXED_FREQ&#039; value=&#039;48000&#039;/&gt; &lt;qemu:env name=&#039;QEMU_PA_SAMPLES&#039; value=&#039;1024&#039;/&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DRV&#039; value=&#039;pa&#039;/&gt; &lt;qemu:env name=&#039;QEMU_PA_SERVER&#039; value=&#039;/run/user/1000/pulse/native&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>In guest, you are then using virtual sound card configured in xml the standard way.<br />It doesnt work if you are running qemu as root (or not dropping capabilities through libvirt..?), but thanks to aws qemu wrapper script it works for me perfectly (permissions problems without it). You have to have logged in session on host, too.<br />I didn&#039;t dive into security of pulseaudio server after this, there could be some problems.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488434">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488437" class="blockpost rowodd"> <h2><span><span class="conr">#3703</span> <a href="viewtopic.php?pid=1488437#p1488437">2014-12-29 12:09:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83627">JohnyPea</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-17</span></dd> <dd><span>Posts: 17</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Ansa89 wrote:</cite><blockquote><div><p>PS: what are the benefits of using virtio-blk instead of virtio-scsi?</p></div></blockquote></div><p>With virtio-blk you can use x-data-plane=on, which increases IOPS in guest and lowers overhead in host. In windows guest I wasn&#039;t able to pass trim operations through virtio-blk as opposed to virtio-scsi. Later I found a workaround to this by using detect-zeroes=on with discard=&#039;unmap&#039; and writing zeros to desired sectors (zero out unused disk space inside guest).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488437">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488583" class="blockpost roweven"> <h2><span><span class="conr">#3704</span> <a href="viewtopic.php?pid=1488583#p1488583">2014-12-29 20:28:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I have a weird issue. I haven&#039;t been able to solve this. When I start Windows 8.1 a message pops up in Arch. It says:</p><div class="quotebox"><blockquote><div><p>vcpu 2 ignored rdmsr kvm<br />vcpu 4 ignored rdmsr kvm<br />vcpu 6 ignored rdmsr kvm</p></div></blockquote></div><p>This repeats itself for as long as I am running the VM.</p><p>I have a i7-4790k and here is some more info about it:</p><p><strong>lscpu:</strong></p><div class="quotebox"><blockquote><div><p>Architecture:&#160; &#160; &#160; &#160; &#160; x86_64<br />CPU op-mode(s):&#160; &#160; &#160; &#160; &#160; &#160; &#160;32-bit, 64-bit<br />Byte Order:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Little Endian<br />CPU(s):&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 8<br />On-line CPU(s) list:&#160; &#160;0-7<br />Thread(s) per core:&#160; &#160; 2<br />Core(s) per socket:&#160; &#160; 4<br />Socket(s):&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 1<br />NUMA node(s):&#160; &#160; &#160; &#160; &#160; 1<br />Vendor ID:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;GenuineIntel<br />CPU family:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;6<br />Model:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;60<br />Model name:&#160; &#160; &#160; &#160; &#160; &#160; Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz<br />Stepping:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 3<br />CPU MHz:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 4392.031<br />CPU max MHz:&#160; &#160; &#160; &#160; 4400.0000<br />CPU min MHz:&#160; &#160; &#160; &#160; &#160;800.0000<br />BogoMIPS:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;8000.34<br />Virtualization:&#160; &#160; &#160; &#160; &#160; &#160; VT-x<br />L1d cache:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 32K<br />L1i cache:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;32K<br />L2 cache:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 256K<br />L3 cache:&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; 8192K<br />NUMA node0 CPU(s):&#160; &#160; &#160;0-7</p></div></blockquote></div><p><strong>virsh capabilities</strong> shows this</p><div class="quotebox"><blockquote><div><p>&lt;topology&gt;<br />&#160; &#160; &#160; &lt;cells num=&#039;1&#039;&gt;<br />&#160; &#160; &#160; &#160; &lt;cell id=&#039;0&#039;&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;memory unit=&#039;KiB&#039;&gt;12061780&lt;/memory&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;pages unit=&#039;KiB&#039; size=&#039;4&#039;&gt;3015445&lt;/pages&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;pages unit=&#039;KiB&#039; size=&#039;2048&#039;&gt;0&lt;/pages&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;distances&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;sibling id=&#039;0&#039; value=&#039;10&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;/distances&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;cpus num=&#039;8&#039;&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;0&#039; socket_id=&#039;0&#039; core_id=&#039;0&#039; siblings=&#039;0,4&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;1&#039; socket_id=&#039;0&#039; core_id=&#039;1&#039; siblings=&#039;1,5&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;2&#039; socket_id=&#039;0&#039; core_id=&#039;2&#039; siblings=&#039;2,6&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;3&#039; socket_id=&#039;0&#039; core_id=&#039;3&#039; siblings=&#039;3,7&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;4&#039; socket_id=&#039;0&#039; core_id=&#039;0&#039; siblings=&#039;0,4&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;5&#039; socket_id=&#039;0&#039; core_id=&#039;1&#039; siblings=&#039;1,5&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;6&#039; socket_id=&#039;0&#039; core_id=&#039;2&#039; siblings=&#039;2,6&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &#160; &lt;cpu id=&#039;7&#039; socket_id=&#039;0&#039; core_id=&#039;3&#039; siblings=&#039;3,7&#039;/&gt;<br />&#160; &#160; &#160; &#160; &#160; &lt;/cpus&gt;<br />&#160; &#160; &#160; &#160; &lt;/cell&gt;<br />&#160; &#160; &#160; &lt;/cells&gt;<br />&#160; &#160; &lt;/topology&gt;</p></div></blockquote></div><br /><p>this is what my XML file looks like.&#160; </p><br /><div class="quotebox"><blockquote><div><p>&lt;vcpu current=&quot;7&quot; placement=&quot;static&quot;&gt;8&lt;/vcpu&gt;<br />-&lt;cputune&gt;<br />&lt;vcpupin cpuset=&quot;0&quot; vcpu=&quot;0&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;1&quot; vcpu=&quot;1&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;2&quot; vcpu=&quot;2&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;3&quot; vcpu=&quot;3&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;4&quot; vcpu=&quot;4&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;5&quot; vcpu=&quot;5&quot;/&gt;<br />&lt;vcpupin cpuset=&quot;6&quot; vcpu=&quot;6&quot;/&gt;<br />&lt;/cputune&gt;</p></div></blockquote></div><p>I also tried different settings like only this:</p><div class="quotebox"><blockquote><div><p>&lt;vcpu placement=&#039;static&#039;&gt;7&lt;/vcpu&gt;</p></div></blockquote></div><p>or like this:</p><div class="quotebox"><blockquote><div><p>&lt;vcpu placement=&#039;static&#039; current=&#039;4&#039;&gt;8&lt;/vcpu&gt;<br />&#160; &lt;cputune&gt;<br />&#160; &#160; &lt;vcpupin vcpu=&#039;0&#039; cpuset=&#039;0,4&#039;/&gt;<br />&#160; &#160; &lt;vcpupin vcpu=&#039;1&#039; cpuset=&#039;1,5&#039;/&gt;<br />&#160; &#160; &lt;vcpupin vcpu=&#039;2&#039; cpuset=&#039;2,6&#039;/&gt;<br />&#160; &#160; &lt;vcpupin vcpu=&#039;3&#039; cpuset=&#039;3,7&#039;/&gt;<br />&#160; &lt;/cputune&gt;</p></div></blockquote></div><p>I have to say - and maybe you guys can even tell from my post, I am not even sure what&#039;s relevant here and what not. So if you need any more info just tell me what you need. <br />I am really grateful for your help.</p> <p class="postedit"><em>Last edited by 4kGamer (2014-12-29 20:51:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488583">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488598" class="blockpost rowodd"> <h2><span><span class="conr">#3705</span> <a href="viewtopic.php?pid=1488598#p1488598">2014-12-29 21:48:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi, I have a weird issue. I haven&#039;t been able to solve this. When I start Windows 8.1 a message pops up in Arch. It says:</p><div class="quotebox"><blockquote><div><p>vcpu 2 ignored rdmsr kvm<br />vcpu 4 ignored rdmsr kvm<br />vcpu 6 ignored rdmsr kvm</p></div></blockquote></div></div></blockquote></div><p>It says that virtual CPU number X didn&#039;t reply to command &quot;read MSR(model specific register) KVM&quot;. Do you passthrough an nvidia card? If so, i suppose, you have kvm=off somewhere, hiding KVM? Something hints me that it is related to your errors. BTW, that seems like just a warning, so you can safely ignore it.</p><p>And a thing to test:</p><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Some applications like Passmark Performance Test and SiSoftware Sandra crash the VM without this:</p><div class="codebox"><pre><code>echo &quot;options kvm ignore_msrs=1&quot; &gt;&gt; /etc/modprobe.d/kvm.conf</code></pre></div></div></blockquote></div><p>That may help too.</p><p>When i&#039;ve launched some software like CPU-Z, i&#039;d get some of these messages, but generally they&#039;re harmless.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488598">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488617" class="blockpost roweven"> <h2><span><span class="conr">#3706</span> <a href="viewtopic.php?pid=1488617#p1488617">2014-12-29 22:43:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Yes, I do have an Nvidia Card. The MSI 980 GTX.</p><p>I&#039;m relieved, if that error message is harmless.</p><br /><p>I do have the option kvm ignore_msrs=1. I also have other options (like vfio_iommu_type1 disable_hugepages=1), but they are all under one file: <strong>/etc/modprobe.d/modprobe.conf</strong> </p><p>Does it matter what name the .conf file in /etc/modprobe.d/ has?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488617">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488742" class="blockpost rowodd"> <h2><span><span class="conr">#3707</span> <a href="viewtopic.php?pid=1488742#p1488742">2014-12-30 10:10:05</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Whaaaa !<br />Incredible..</p><p>I&#039;m stuck since 1 year on this no-reboot issue, and with this driver, it works (I&#039;m not passing audio for the moment) !!</p><div class="quotebox"><cite>kidchunks wrote:</cite><blockquote><div><p>I was able to install the drivers but upon reboot, got stuck in a boot loop.</p><p>Figured it could be driver related so I tried the latest catalyst beta drivers (14.11.2) and it worked! Audio and video are passing through with no problems. <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p><p><strong>The above also fixed an issue I had with video card freezing (stuck image) on reboot/shutdown so no need for no-reboot.</strong></p><p>The only problem I have now is that I can&#039;t see the bios(seabios) screen but that&#039;s minor given it still boots into whatever drive is first. Strangely enough, OVMF(UEFI) works fine. Maybe something with the card.</p><p>In any case, glad to get it working after a week! </p><p>Thanks AW and others for the help.</p><p>To those running an r9 290x...use the 14.11.2 drivers!</p></div></blockquote></div><p>Just a little resumé of my configuration :<br />MB : ASUS H87M-PLUS<br />GPU : Radeon R7 260X<br />RAM : 8Gb (4Gb passed to guest)<br />CPU : i5 4570 <br />Kernel : 3.15.1 compiled locally for pci passthrough<br />Guest : Windows 7 Home Prem. x64<br />CCC : 14.11.2 beta drivers&#160; (17/11/2014)</p><p>And I have to notice that the last 14.12 drivers (they say &quot;14.501.1003&quot; Display Driver ver. - 9/12/2014) don&#039;t work (still the no-reboot problems)!!!!</p><p>So, I would advice to everyone having (reboot) issue to passthrough R7 &amp; R9 to try these drivers.</p><p>Furthermore, the Windows Benchmark gives some good results I guess : <br />CPU : 5.9<br />Memory : 7.3<br />Graphic : 7.7<br />Gaming graphic : 7.7<br />HD : 7.9</p><p>Remaing issue for the moment :</p><p>- sometimes (can&#039;t reproduce), I have a blue screen &quot;MEMORY MANAGEMENT&quot;<br />- tried to launch DOTA 2, but CPU get to 100% and the screen of the game stay black (I can come back to the desktop &amp; kill the dota 2 process)</p><p>Here is my config, I saw it is quite different than kidchunks one (<a href="https://bbs.archlinux.org/viewtopic.php?pid=1481075#p1481075" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 5#p1481075</a>)&#160; :<br />If you have any advice :</p><div class="quotebox"><blockquote><div><p>/usr/bin/vfio-bind 0000:01:00.0 0000:01:00.1 # Radeon R7<br />/usr/bin/vfio-bind 0000:00:1d.0 # USB on back side<br />qemu-system-x86_64 \<br /> -M q35 -enable-kvm -balloon none -rtc clock=host -cpu host \<br /> -m 4G -smp 1,sockets=1,cores=1,threads=1 \<br /> -bios /usr/share/qemu/bios.bin \<br /> -acpitable file=/sys/firmware/acpi/tables/SLIC \<br /> -serial null -parallel null \<br /> -net nic,model=virtio,macaddr=xx:xx:xx:xx:xx:xx \<br /> -net nic -net tap,ifname=tap2,script=no,downscript=no \<br /> -monitor none -display none \<br /> -vga none \<br /> -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br /> -device virtio-scsi-pci,id=scsi \<br /> -drive file=VM/win7.img,id=disk0,format=raw -device scsi-hd,drive=disk0 \<br /> -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br /> -device vfio-pci,host=00:1d.0,bus=pcie.0 \<br /> -drive file=iso/Win7HomePrem64.X15-65739.iso,id=isocd -device scsi-cd,drive=isocd \<br /> -drive file=iso/virtio-win-0.1-94.iso,id=virtiocd -device ide-cd,bus=ide.1,drive=virtiocd</p></div></blockquote></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488742">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488751" class="blockpost roweven"> <h2><span><span class="conr">#3708</span> <a href="viewtopic.php?pid=1488751#p1488751">2014-12-30 11:00:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87525">Silar</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-24</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87525">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Dump the ROM or get it from techpowerup database and use the romfile= option to provide the ROM to the guest.</p></div></blockquote></div><p>I tried both, dumping die ROM and get it from techpowerup. Now i get no more error messages and qemu starts but i get no video signal from the guests graphic card. In addition the host freeze after a few seconds. And i don&#039;t know what happens and how to fix this problem.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488751">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488755" class="blockpost rowodd"> <h2><span><span class="conr">#3709</span> <a href="viewtopic.php?pid=1488755#p1488755">2014-12-30 11:30:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Silar wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Dump the ROM or get it from techpowerup database and use the romfile= option to provide the ROM to the guest.</p></div></blockquote></div><p>I tried both, dumping die ROM and get it from techpowerup. Now i get no more error messages and qemu starts but i get no video signal from the guests graphic card. In addition the host freeze after a few seconds. And i don&#039;t know what happens and how to fix this problem.</p></div></blockquote></div><p>I had a similar problem with my GTX470, the first run worked great, but after a guest reboot i had the same problem as you do.</p><p>What i did was, reboot the host, start the guest up with the GTX470 as primary, dump the rom with gpu-z, copy it back to your host, shut down the guest, then load the gpu rom it like this:</p><div class="codebox"><pre><code>-device vfio-pci,host=07:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/path/to/your/gpu/bios.bin</code></pre></div><p>I found out that in my case, if i ran the guest for a second time WITHOUT the romfile, i wouldnt be able to start it again even if i actually loaded the romfile.</p> <p class="postedit"><em>Last edited by nbhs (2014-12-30 11:32:17)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488755">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488792" class="blockpost roweven"> <h2><span><span class="conr">#3710</span> <a href="viewtopic.php?pid=1488792#p1488792">2014-12-30 14:12:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I need a bit of help here. My system is Supermicro X9DA7 with two Xeon E5-2630v2 . Kernel version 3.18.1 mainline with no patches, qemu version 2.2.0 (with no patches either), seabios 1.7.5-2</p><p>Relevant dmesg excerpt: </p><div class="codebox"><pre class="vscroll"><code>[bronek@gdansk ~]$ dmesg | grep -iE &quot;iommu|stub&quot; [ 0.000000] Command line: BOOT_IMAGE=../vmlinuz-linux zfs=zroot rw quiet edac_core.edac_mc_panic_on_ue=1 elevator=noop pci-stub.ids=1002:6749,1002:aa90,1002:67b0,1002:aac8 intel_iommu=on spl.spl_hostid=0xbb51d4d8 initrd=../initramfs-linux.img [ 0.000000] Kernel command line: BOOT_IMAGE=../vmlinuz-linux zfs=zroot rw quiet edac_core.edac_mc_panic_on_ue=1 elevator=noop pci-stub.ids=1002:6749,1002:aa90,1002:67b0,1002:aac8 intel_iommu=on spl.spl_hostid=0xbb51d4d8 initrd=../initramfs-linux.img [ 0.000000] Intel-IOMMU: enabled [ 0.086314] dmar: IOMMU 0: reg_base_addr fbffe000 ver 1:0 cap d2078c106f0466 ecap f020de [ 0.086320] dmar: IOMMU 1: reg_base_addr bfffc000 ver 1:0 cap d2078c106f0466 ecap f020de [ 0.086451] IOAPIC id 3 under DRHD base 0xfbffe000 IOMMU 0 [ 0.086453] IOAPIC id 0 under DRHD base 0xbfffc000 IOMMU 1 [ 0.086454] IOAPIC id 2 under DRHD base 0xbfffc000 IOMMU 1 [ 1.135393] IOMMU 0 0xfbffe000: using Queued invalidation [ 1.135394] IOMMU 1 0xbfffc000: using Queued invalidation [ 1.135400] IOMMU: Setting RMRR: [ 1.135423] IOMMU: Setting identity map for device 0000:00:1a.0 [0x7f23d000 - 0x7f24bfff] [ 1.135470] IOMMU: Setting identity map for device 0000:00:1d.0 [0x7f23d000 - 0x7f24bfff] [ 1.135507] IOMMU: Setting identity map for device 0000:07:00.0 [0x7f23d000 - 0x7f24bfff] [ 1.135555] IOMMU: Setting identity map for device 0000:08:00.0 [0x7f23d000 - 0x7f24bfff] [ 1.135608] IOMMU: Setting identity map for device 0000:83:00.0 [0x7f23d000 - 0x7f24bfff] [ 1.135686] IOMMU: Setting identity map for device 0000:84:00.0 [0x7f23d000 - 0x7f24bfff] [ 1.135742] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 1.135760] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 1.151027] pci-stub: add 1002:6749 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.151034] pci-stub 0000:03:00.0: claimed by stub [ 1.151042] pci-stub: add 1002:AA90 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.151059] pci-stub 0000:03:00.1: claimed by stub [ 1.151067] pci-stub: add 1002:67B0 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.151090] pci-stub 0000:82:00.0: claimed by stub [ 1.151107] pci-stub: add 1002:AAC8 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 1.151137] pci-stub 0000:82:00.1: claimed by stub</code></pre></div><p>As you can see, I have two GPU cards from AMD, both claimed by pci-stub</p><div class="codebox"><pre><code>[bronek@gdansk ~]$ lspci -nn | grep 1002 03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Turks GL [FirePro V4900] [1002:6749] 03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Turks/Whistler HDMI Audio [Radeon HD 6000 Series] [1002:aa90] 82:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Hawaii XT [Radeon R9 290X] [1002:67b0] 82:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:aac8]</code></pre></div><p>Also both cards are passed successfully to vfio-pci by script presented in the first post on this thread: </p><div class="codebox"><pre><code>[bronek@gdansk ~]$ ls -al /sys/bus/pci/devices/0000:03:00.1/driver lrwxrwxrwx 1 root root 0 Dec 30 12:59 /sys/bus/pci/devices/0000:03:00.1/driver -&gt; ../../../../bus/pci/drivers/vfio-pci [bronek@gdansk ~]$ ls -al /sys/bus/pci/devices/0000:03:00.0/driver lrwxrwxrwx 1 root root 0 Dec 30 12:59 /sys/bus/pci/devices/0000:03:00.0/driver -&gt; ../../../../bus/pci/drivers/vfio-pci [bronek@gdansk ~]$ ls -al /sys/bus/pci/devices/0000:82:00.1/driver lrwxrwxrwx 1 root root 0 Dec 30 12:59 /sys/bus/pci/devices/0000:82:00.1/driver -&gt; ../../../../bus/pci/drivers/vfio-pci [bronek@gdansk ~]$ ls -al /sys/bus/pci/devices/0000:82:00.0/driver lrwxrwxrwx 1 root root 0 Dec 30 12:59 /sys/bus/pci/devices/0000:82:00.0/driver -&gt; ../../../../bus/pci/drivers/vfio-pci</code></pre></div><p>When trying VGA passthrough I get the following:</p><div class="codebox"><pre><code>[root@gdansk bronek]# cat trypc.sh #!/bin/bash qemu-system-x86_64 -enable-kvm -M pc -m 1024 -cpu host -smp 6 \ -bios /usr/share/qemu/bios.bin \ -nographic -vga none \ -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,addr=08.1 [root@gdansk bronek]# ./trypc.sh qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: No available IOMMU models qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 18 qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: failed to get group 18 qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div><p>I receive the same error for both cards and also when using -M q35 (with ioh3420). In case that matters, this machine is intended as headless VDI server and has no X windows installed. Radeon driver is blacklisted. I do not have ACS patch as it does not seem necessary in this case:</p><div class="codebox"><pre><code>[bronek@gdansk ~]$ ls /sys/bus/pci/devices/0000:03:00.0/iommu_group/devices 0000:03:00.0 0000:03:00.1</code></pre></div><p>Also, I am not using IGP thus no arb patch and also no option allow_unsafe_interrupts=1, as it seems not necessary for my motherboard. I did try it though, with no effect.</p><p>I was following this thread from start (yes, started last year!) and I did try this feature previously using older kernel and older qemu version, with little more success (was able to install Linux guest, but not Windows). This time I&#039;m stuck at the very beginning. Perhaps if I downgraded qemu or kernel it might help a little ?</p> <p class="postedit"><em>Last edited by Bronek (2014-12-30 14:14:54)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488792">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488795" class="blockpost rowodd"> <h2><span><span class="conr">#3711</span> <a href="viewtopic.php?pid=1488795#p1488795">2014-12-30 14:19:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><div class="codebox"><pre><code>[root@gdansk bronek]# cat trypc.sh #!/bin/bash qemu-system-x86_64 -enable-kvm -M pc -m 1024 -cpu host -smp 6 \ -bios /usr/share/qemu/bios.bin \ -nographic -vga none \ -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on \ -device vfio-pci,host=03:00.1,addr=08.1 [root@gdansk bronek]# ./trypc.sh qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: No available IOMMU models qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: failed to setup container for group 18 qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: vfio: failed to get group 18 qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: Device initialization failed. qemu-system-x86_64: -device vfio-pci,host=03:00.0,addr=08.0,multifunction=on,x-vga=on: Device &#039;vfio-pci&#039; could not be initialized</code></pre></div></div></blockquote></div><p>What does &#039;grep VFIO /boot/config-`uname -r`&#039; show?&#160; lsmod | grep vfio?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488795">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488799" class="blockpost roweven"> <h2><span><span class="conr">#3712</span> <a href="viewtopic.php?pid=1488799#p1488799">2014-12-30 14:30:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi Alex thanks for prompt reply. I think ArchLinux does not save a config copy to /boot , but I have this:</p><div class="codebox"><pre><code>[bronek@gdansk ~]$ zcat /proc/config.gz | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y [bronek@gdansk ~]$ lsmod | grep vfio vfio_pci 31566 0 vfio 18519 1 vfio_pci</code></pre></div> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488799">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488807" class="blockpost rowodd"> <h2><span><span class="conr">#3713</span> <a href="viewtopic.php?pid=1488807#p1488807">2014-12-30 14:42:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>Hi Alex thanks for prompt reply. I think ArchLinux does not save a config copy to /boot , but I have this:</p><div class="codebox"><pre><code>[bronek@gdansk ~]$ zcat /proc/config.gz | grep VFIO CONFIG_VFIO_IOMMU_TYPE1=m CONFIG_VFIO=m CONFIG_VFIO_PCI=m CONFIG_VFIO_PCI_VGA=y CONFIG_KVM_VFIO=y [bronek@gdansk ~]$ lsmod | grep vfio vfio_pci 31566 0 vfio 18519 1 vfio_pci</code></pre></div></div></blockquote></div><p>So somehow vfio_iommu_type1 is not getting auto-loaded.&#160; The way it&#039;s supposed to work is that vfio-pci depends on vfio, so loading vfio-pci always brings in vfio.&#160; vfio then does a module request for any available iommu drivers to load those.&#160; This is where vfio_iommu_type1 is supposed to get loaded.&#160; Maybe something has broken in your userspace that the module request is not being serviced?&#160; Anyway, you should be able to manually `modprobe vfio_iommu_type1`</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488807">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488814" class="blockpost roweven"> <h2><span><span class="conr">#3714</span> <a href="viewtopic.php?pid=1488814#p1488814">2014-12-30 14:55:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>This is where vfio_iommu_type1 is supposed to get loaded.&#160; Maybe something has broken in your userspace that the module request is not being serviced?&#160; Anyway, you should be able to manually `modprobe vfio_iommu_type1`</p></div></blockquote></div><p>Thank you, this has helped!</p><div class="codebox"><pre><code>[root@gdansk bronek]# modprobe vfio_iommu_type1 [root@gdansk bronek]# lsmod | grep vfio vfio_iommu_type1 17163 0 vfio_pci 31566 0 vfio 18519 2 vfio_iommu_type1,vfio_pci</code></pre></div><p>I will add this module to /etc/mkinitcpio.conf to ensure it is always automatically loaded.</p><p><span class="bbs">Also,&#160; I suppose I need your other arb patch to which you refer in your&#160; blog <a href="http://vfio.blogspot.co.uk/2014/08/vfiovga-faq.html" rel="nofollow">http://vfio.blogspot.co.uk/2014/08/vfiovga-faq.html</a> <strong>question 4</strong>&#160; - since after closing qemu (SIGTERM from other session) I got a bit of mess on my VGA screen.</span></p><p><strong>EDIT</strong> Never mind, I see your patch is already applied in my kernel version (3.18.1) ! I guess the mess I&#039;ve got is simply result of qemu being cautions on handling SIGTERM</p> <p class="postedit"><em>Last edited by Bronek (2014-12-30 15:32:29)</em></p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488814">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488829" class="blockpost rowodd"> <h2><span><span class="conr">#3715</span> <a href="viewtopic.php?pid=1488829#p1488829">2014-12-30 15:27:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=81619">adejour</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-04-29</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=81619">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello,</p><p>About my last post (vga passthrough working with beta ATI drivers 14.11.2) <a href="https://bbs.archlinux.org/viewtopic.php?pid=1488792#p1488792" rel="nofollow">https://bbs.archlinux.org/viewtopic.php … 2#p1488792</a></p><p>I succeed to make audio working adding&#160; -device vfio-pci,host=01:00.1,bus=pcie.0 to the command line.<br />Now, all games are working well (tested dota 2 and bioshock infinite).</p><p>thank you all !</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488829">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488933" class="blockpost roweven"> <h2><span><span class="conr">#3716</span> <a href="viewtopic.php?pid=1488933#p1488933">2014-12-30 23:06:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87584">pkim</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-27</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87584">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>JohnyPea wrote:</cite><blockquote><div><div class="quotebox"><cite>pkim wrote:</cite><blockquote><div><p>2. I can&#039;t figure out how to pipe only the sound through spice. Work-around: use Xen for video card type.</p></div></blockquote></div><p>It works when you have the VM client open and connected (virt-manager, spicy). This requires virtual graphics, which can be disabled in quest, but I think a better solution is to use pulseaudio server directly. I have found information on this somewhere earlier in this thread:</p><div class="codebox"><pre><code>/etc/pulse/default.pa: .. load-module module-native-protocol-unix auth-anonymous=1 ..</code></pre></div><p>and with added configuration in VM xml:</p><div class="codebox"><pre><code> &lt;qemu:commandline&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DAC_FIXED_FREQ&#039; value=&#039;48000&#039;/&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_ADC_FIXED_FREQ&#039; value=&#039;48000&#039;/&gt; &lt;qemu:env name=&#039;QEMU_PA_SAMPLES&#039; value=&#039;1024&#039;/&gt; &lt;qemu:env name=&#039;QEMU_AUDIO_DRV&#039; value=&#039;pa&#039;/&gt; &lt;qemu:env name=&#039;QEMU_PA_SERVER&#039; value=&#039;/run/user/1000/pulse/native&#039;/&gt; &lt;/qemu:commandline&gt;</code></pre></div><p>In guest, you are then using virtual sound card configured in xml the standard way.<br />It doesnt work if you are running qemu as root (or not dropping capabilities through libvirt..?), but thanks to aws qemu wrapper script it works for me perfectly (permissions problems without it). You have to have logged in session on host, too.<br />I didn&#039;t dive into security of pulseaudio server after this, there could be some problems.</p></div></blockquote></div><p>OK, I tried doing what you suggested, but I couldn&#039;t get any sound once I deleted the graphics and video section in the xml file.</p><p>On the other hand, I did figure out the glitch/stutter/click issues on the sound. It turns out others are having the same issue with ICH6 and ICH9 - <a href="http://lists.freedesktop.org/archives/spice-devel/2014-November/017995.html" rel="nofollow"> here</a>.</p><p>I set up the audio for AC&#039;97 in virt-manager and installed the AC&#039;97 driver in Windows 7 - worked without any glitch! :-)</p><p>The only &quot;real&quot; issue now is the PCIe reset - can&#039;t reboot without suspending/resuming the host.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488933">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1488951" class="blockpost rowodd"> <h2><span><span class="conr">#3717</span> <a href="viewtopic.php?pid=1488951#p1488951">2014-12-31 01:05:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p>I&#039;m feeling like my GPU&#039;s vendor dumped me.<br />Some months ago i&#039;ve tried to update my card&#039;s VBIOS on UEFI, it downloaded the image but failed to apply it due to lack of drivers or some other stuff - it wasn&#039;t my pc, so i didn&#039;t want to mess with owner&#039;s windows system like installing drivers.</p><p>But i got the ROM. For one card only, but that&#039;s fine.<br />Tried passing it wth romfile and OVMF just hanged, aw suggested to test it on real hardware to see if it&#039;s just poorly written and broken. So i gave up for some time.</p><p>Now, i&#039;ve installed windows system on a bare metal system using UEFI+GPT and even secureboot was working. But ASUS UEFI Update tools now says that... my GPU doesn&#039;t support UEFI. Considering the fact i have the actual ROM... It seems strange.</p><p>So, it&#039;s time to begin my journey on writing messages to their support team.</p></div></blockquote></div><p>I&#039;ve got some news i&#039;ve decided to share with you, folks.</p><p>I wrote to the support team, but they&#039;re being all &quot;jelly-brained&quot; and stuff. I think that is related to holidays.<br />Anyway, they&#039;ve requested a screenshot of main GPU-Z window and provided a VBIOS image that was lacking serial number information but was the same as original. It hints that this information is left for decoration purposes only(or maybe some other non-essential stuff), the main meat-and-bones of ROM will work without it.</p><p>That yet remains open my two questions - why the hell their tool won&#039;t work anymore, and is it right to flash the bios or it&#039;s considered buggy. The journey shall continue.</p><br /><p>But i definitely can tell one important thing:<br />If any of you are trying to use OVMF with a card that &quot;may be updated to support UEFI&quot; - think twice before doing that, updating it may not be so easy.</p> <p class="postedit"><em>Last edited by Duelist (2014-12-31 01:06:03)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1488951">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489499" class="blockpost roweven"> <h2><span><span class="conr">#3718</span> <a href="viewtopic.php?pid=1489499#p1489499">2015-01-02 13:35:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87670">Hoeze</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-12-30</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,<br />how can I disable/re-enable my GPU after stopping a guest?<br />I&#039;d like to disable my GPU until it&#039;s needed to save power...</p> <p class="postedit"><em>Last edited by Hoeze (2015-01-02 13:45:26)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489499">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489680" class="blockpost rowodd"> <h2><span><span class="conr">#3719</span> <a href="viewtopic.php?pid=1489680#p1489680">2015-01-03 02:01:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>I&#039;ve got a couple questions regarding performance optimizations:</p><p>1) Neste Page Tables: I found suggestions to disable NPT (also in this thread). Now why would I want to do this? NPT should speed up memory access. Or is there some interaction between NPT and PCI passthrough that makes it less performant?<br />2) VCPU pinning: Again, I found suggestions to pin each QEMU thread to a single CPU core. I guess it might in fact help to pin each VCPU thread to a core. But QEMU uses more threads than VCPUS (I guess for IO and additional worker threads). So a naive approach might pin multiple VCPU threads to a single core. Is this suggestion then plane wrong, or am I missing something here? Can I determine which threads are VCPU threads? (I&#039;m talking SMP here, not NUMA, so the effect might be negligible anyway).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489680">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489685" class="blockpost roweven"> <h2><span><span class="conr">#3720</span> <a href="viewtopic.php?pid=1489685#p1489685">2015-01-03 02:28:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>rawuza wrote:</cite><blockquote><div><p>Hi,</p><p>I&#039;ve got a couple questions regarding performance optimizations:</p><p>1) Neste Page Tables: I found suggestions to disable NPT (also in this thread). Now why would I want to do this? NPT should speed up memory access. Or is there some interaction between NPT and PCI passthrough that makes it less performant?</p></div></blockquote></div><p>The suggestions has been do disable <strong>nesting</strong> support, ie. the ability to run a hypervisor within the guest, not to disable three dimensional paging.&#160; I haven&#039;t seen actual benchmarks from doing this, so I&#039;m not sure how worthwhile it is.</p><div class="quotebox"><blockquote><div><p>2) VCPU pinning: Again, I found suggestions to pin each QEMU thread to a single CPU core. I guess it might in fact help to pin each VCPU thread to a core. But QEMU uses more threads than VCPUS (I guess for IO and additional worker threads). So a naive approach might pin multiple VCPU threads to a single core. Is this suggestion then plane wrong, or am I missing something here? Can I determine which threads are VCPU threads? (I&#039;m talking SMP here, not NUMA, so the effect might be negligible anyway).</p></div></blockquote></div><p>Pinning all vCPUs to the same single core would be the worst optimization ever.&#160; The suggestion is to pin each vCPU to a separate pCPU, which gives you cache locality and makes the host scheduler&#039;s job easier.&#160; <em>info cpus</em> lists the vCPU threads.&#160; libvirt also has the ability to do vCPU pinning.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489685">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489688" class="blockpost rowodd"> <h2><span><span class="conr">#3721</span> <a href="viewtopic.php?pid=1489688#p1489688">2015-01-03 02:31:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Hoeze wrote:</cite><blockquote><div><p>Hi,<br />how can I disable/re-enable my GPU after stopping a guest?<br />I&#039;d like to disable my GPU until it&#039;s needed to save power...</p></div></blockquote></div><p>Unless you have power controllable slots, the best suggestion might be to leave the guest running.&#160; The guest driver can probably put the card in a fairly low power state when it&#039;s idle.&#160; I don&#039;t expect to see a lot of power savings from D3 in the host, which is about the best we can offer without device specific drivers.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489688">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489693" class="blockpost roweven"> <h2><span><span class="conr">#3722</span> <a href="viewtopic.php?pid=1489693#p1489693">2015-01-03 02:56:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77904">rawuza</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-22</span></dd> <dd><span>Posts: 7</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The suggestions has been do disable <strong>nesting</strong> support, ie. the ability to run a hypervisor within the guest, not to disable three dimensional paging.</p></div></blockquote></div><p>So that would be the &quot;nested&quot; parameter of kvm_amd. That makes more sense. The comments I found suggested to set &quot;npt&quot; to 0. </p><div class="quotebox"><blockquote><div><p>Pinning all vCPUs to the same single core would be the worst optimization ever.</p></div></blockquote></div><p>Well, yes, I meant pinning each vCPU to a separate core.</p><div class="quotebox"><blockquote><div><p><em>info cpus</em> lists the vCPU threads.</p></div></blockquote></div><p>That&#039;s exactly what I need. Thanks a lot.</p><p>PS: I previously had trouble with my old GPU. I&#039;ve got a new one and it finally works. Quite impressive, I must say.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489693">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489917" class="blockpost rowodd"> <h2><span><span class="conr">#3723</span> <a href="viewtopic.php?pid=1489917#p1489917">2015-01-03 21:04:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi, I&#039;d like to ask Alex and others here about something I discovered. I ran <strong> Open Hardware Monitor</strong> and under section &quot;Clocks&quot; I get <strong>no value</strong> for CPU Core #1 till #4.</p><p>It&#039;s not only for benchmarking, but my case has a screen where I can follow stuff like that constantly. And it&#039;s annoying that it says 4x0 Mhz.</p><p>Is this expected behaviour or is something wrong?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489917">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489922" class="blockpost roweven"> <h2><span><span class="conr">#3724</span> <a href="viewtopic.php?pid=1489922#p1489922">2015-01-03 21:08:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>Hi, I&#039;d like to ask Alex and others here about something I discovered. I ran <strong> Open Hardware Monitor</strong> and under section &quot;Clocks&quot; I get <strong>no value</strong> for CPU Core #1 till #4.</p><p>It&#039;s not only for benchmarking, but my case has a screen where I can follow stuff like that constantly. And it&#039;s annoying that it says 4x0 Mhz.</p><p>Is this expected behaviour or is something wrong?</p></div></blockquote></div><p>Personally I wouldn&#039;t necessarily expect a <strong>hardware</strong> monitor to work in a virtual machine.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489922">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1489925" class="blockpost rowodd"> <h2><span><span class="conr">#3725</span> <a href="viewtopic.php?pid=1489925#p1489925">2015-01-03 21:14:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>it works pretty well. It&#039;s just the CPU Clock. So something is preventing it from showing the right value.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1489925">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=148">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=147">147</a> <a href="viewtopic.php?id=162768&amp;p=148">148</a> <strong>149</strong> <a href="viewtopic.php?id=162768&amp;p=150">150</a> <a href="viewtopic.php?id=162768&amp;p=151">151</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=150">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
