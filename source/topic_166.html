<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 166) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=166" title="Page 166" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=165" title="Page 165" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=167" title="Page 167" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=165">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <strong>166</strong> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <a href="viewtopic.php?id=162768&amp;p=168">168</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=167">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1501241" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4126</span> <a href="viewtopic.php?pid=1501241#p1501241">2015-02-09 11:42:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>NVIDIA GRID K2 passthrough successful, but with code 43 after install nvidia driver.</p><p>driver info: 347.25-quadro-grid-desktop-notebook-win8-win7-64bit-international-whql</p><p>here is my qemu commandline:</p><p>#!/bin/sh</p><p>qemu-system-x86_64 -cpu host,kvm=off -smp 4,sockets=2,cores=2,threads=1 \<br />-m 8192 -M q35 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/var/lib/libvirt/images/LENOVO-TC-90-MSFT-2.1.BIN \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/var/lib/libvirt/images/win7_nvidia_k2_clean.img,cache=writeback,\<br />if=none,format=qcow2,aio=native,id=virtio-scsi-disk0 \<br />-device scsi-hd,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=52:54:00:1a:2b:3c \<br />-net tap,ifname=tap0,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown \<br />-vga none -nographic \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-monitor stdio</p></div></blockquote></div><p>According to this thread, no solution yet for drivers &gt; 340.52. I&#039;m stuck at that version too.(gtx 560Ti on Windows 7 machine)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501241">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501245" class="blockpost roweven"> <h2><span><span class="conr">#4127</span> <a href="viewtopic.php?pid=1501245#p1501245">2015-02-09 11:57:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>You need bios from GT 630 and use it with romfile= option, for working reboot.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501245">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501256" class="blockpost rowodd"> <h2><span><span class="conr">#4128</span> <a href="viewtopic.php?pid=1501256#p1501256">2015-02-09 12:41:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>You need bios from GT 630 and use it with romfile= option, for working reboot.</p></div></blockquote></div><p>is it a problem only with gt630?</p><p>I&#039;m doing a openelec vm with a gt610...</p><p>My vm windows 7 with gtx 560 TI doesn&#039;t suffer this problem...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501256">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501258" class="blockpost roweven"> <h2><span><span class="conr">#4129</span> <a href="viewtopic.php?pid=1501258#p1501258">2015-02-09 12:42:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>hmm, for me it was must with geforce fermi</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501258">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501261" class="blockpost rowodd"> <h2><span><span class="conr">#4130</span> <a href="viewtopic.php?pid=1501261#p1501261">2015-02-09 12:50:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85175">evilsephiroth</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-16</span></dd> <dd><span>Posts: 14</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:evilsephiroth@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>edit double post</p> <p class="postedit"><em>Last edited by evilsephiroth (2015-02-09 12:50:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501261">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501262" class="blockpost roweven"> <h2><span><span class="conr">#4131</span> <a href="viewtopic.php?pid=1501262#p1501262">2015-02-09 12:50:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>from that link</p><p>4 The GeForce GT 620 (OEM) card is a rebranded GeForce GT 520.<br />5 The GeForce GT 620 card is a rebranded GeForce GT 530.<br />6 This revision of GeForce GT 630 (DDR3) card is a rebranded GeForce GT 440 (DDR3).</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501262">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501276" class="blockpost rowodd"> <h2><span><span class="conr">#4132</span> <a href="viewtopic.php?pid=1501276#p1501276">2015-02-09 13:39:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>You need bios from GT 630 and use it with romfile= option, for working reboot.</p></div></blockquote></div><p>is it a problem only with gt630?</p><p>I&#039;m doing a openelec vm with a gt610...</p><p>My vm windows 7 with gtx 560 TI doesn&#039;t suffer this problem...</p></div></blockquote></div><p>I&#039;m already using the romfile option but seems like my bios is corrupt or something because I could boot and use the card, except shutdown and reboot, with seabios but if try ovmf I get a lot of artifacts.<br />Do you have the bios for ZOTAC GeForce GT 630 Synergy Edition 2GB? I haven&#039;t found any.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501276">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501277" class="blockpost roweven"> <h2><span><span class="conr">#4133</span> <a href="viewtopic.php?pid=1501277#p1501277">2015-02-09 13:41:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>NVIDIA GRID K2 passthrough successful, but with code 43 after install nvidia driver.</p><p>driver info: 347.25-quadro-grid-desktop-notebook-win8-win7-64bit-international-whql</p></div></blockquote></div><p>Nvidia K-series GRID, Tesla, and Quadro (2000+) are <strong>supported</strong> by Nvidia in non-vga passthrough mode.&#160; Configure the device as secondary graphics for the VM and do not use the x-vga option.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501277">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501279" class="blockpost rowodd"> <h2><span><span class="conr">#4134</span> <a href="viewtopic.php?pid=1501279#p1501279">2015-02-09 13:43:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>According to this thread, no solution yet for drivers &gt; 340.52. I&#039;m stuck at that version too.(gtx 560Ti on Windows 7 machine)</p></div></blockquote></div><p>What are you talking about?!&#160; I&#039;m running 347.25 here with GTX750.&#160; KVM and Hyper-V extensions need to be hidden/disabled to avoid Code 43 on GeForce cards.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501279">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501281" class="blockpost roweven"> <h2><span><span class="conr">#4135</span> <a href="viewtopic.php?pid=1501281#p1501281">2015-02-09 13:56:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82709">flack</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82709">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><div class="quotebox"><cite>slis wrote:</cite><blockquote><div><p>You need bios from GT 630 and use it with romfile= option, for working reboot.</p></div></blockquote></div><p>is it a problem only with gt630?</p><p>I&#039;m doing a openelec vm with a gt610...</p><p>My vm windows 7 with gtx 560 TI doesn&#039;t suffer this problem...</p></div></blockquote></div><p>I&#039;m already using the romfile option but seems like my bios is corrupt or something because I could boot and use the card, except shutdown and reboot, with seabios but if try ovmf I get a lot of artifacts.<br />Do you have the bios for ZOTAC GeForce GT 630 Synergy Edition 2GB? I haven&#039;t found any.</p></div></blockquote></div><br /><p>Are you try this one? <a href="http://www.techpowerup.com/vgabios/index.php?architecture=NVIDIA&amp;manufacturer=Zotac&amp;model=GT+630&amp;interface=&amp;memType=&amp;memSize=" rel="nofollow">At techpowerup site </a></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501281">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501282" class="blockpost rowodd"> <h2><span><span class="conr">#4136</span> <a href="viewtopic.php?pid=1501282#p1501282">2015-02-09 14:03:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86812">bpbastos</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-21</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>flack wrote:</cite><blockquote><div><div class="quotebox"><cite>bpbastos wrote:</cite><blockquote><div><div class="quotebox"><cite>evilsephiroth wrote:</cite><blockquote><div><p>is it a problem only with gt630?</p><p>I&#039;m doing a openelec vm with a gt610...</p><p>My vm windows 7 with gtx 560 TI doesn&#039;t suffer this problem...</p></div></blockquote></div><p>I&#039;m already using the romfile option but seems like my bios is corrupt or something because I could boot and use the card, except shutdown and reboot, with seabios but if try ovmf I get a lot of artifacts.<br />Do you have the bios for ZOTAC GeForce GT 630 Synergy Edition 2GB? I haven&#039;t found any.</p></div></blockquote></div><br /><p>Are you try this one? <a href="http://www.techpowerup.com/vgabios/index.php?architecture=NVIDIA&amp;manufacturer=Zotac&amp;model=GT+630&amp;interface=&amp;memType=&amp;memSize=" rel="nofollow">At techpowerup site </a></p></div></blockquote></div><p>Thank you @flack.</p><p>EDIT: <br />The bios from techpowerup doesn&#039;t support EFI.</p><div class="codebox"><pre><code>[root@home-server rom-parser]# ./rom-parser Zotac.GT630.2048.120511.rom Valid ROM signature found @0h, PCIR offset 188h PCIR: type 0, vendor: 10de, device: 0f00, class: 030000 PCIR: revision 0, vendor revision: 1 Last image</code></pre></div> <p class="postedit"><em>Last edited by bpbastos (2015-02-09 14:11:08)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501282">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501295" class="blockpost roweven"> <h2><span><span class="conr">#4137</span> <a href="viewtopic.php?pid=1501295#p1501295">2015-02-09 14:56:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88564">hotfunction</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-05</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>hotfunction wrote:</cite><blockquote><div><p>Hi everyone, i&#039;ve been reading a lot of posts here, and i wanted to try the passthrough by myself, but seemed that i got some error here, and firstly according to the steps of the guide, i have been doing step by steps, and here&#039;s my build :</p><p>Processor : Xeon E3-1200 (VT-d Enabled in BIOS)<br />ubuntu display GPU : Radeon HD4870<br />Passthrough GPU : GeForce GTX 560 Ti Hawx</p><p>So steps i&#039;ve been done so far :<br />1. Ubuntu Server 12.04, then do-release-upgrade to 14.04<br />2. Downloaded Kernel 3.18-5 from Linux homepage<br />3. Downloaded 3.18-5 linux-mainline from nhbs&#039;s first post<br />4. Patched ACS and i915_317 patch from linux-mainline from nbhs&#039;s post<br />5. Qemu 2.2.0, also Seabios standard and no patches<br />6. lspci | grep NVIDIA :<br />&#160; </p><div class="quotebox"><blockquote><div><p>05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1)<br />05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1)</p></div></blockquote></div><p>7. edited /etc/default/grub : <br />&#160; </p><div class="quotebox"><blockquote><div><p>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c&quot;</p></div></blockquote></div><p>&#160; &#160; and our /proc/cmdline :<br />&#160; </p><div class="quotebox"><blockquote><div><p>BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7</p></div></blockquote></div><p>8. also blacklisted radeon on /etc/modprobe.d/blacklist.conf<br />9. dmesg pci-stub : </p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7<br />[&#160; &#160; 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7<br />[&#160; &#160; 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787587] pci-stub 0000:05:00.0: claimed by stub<br />[&#160; &#160; 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787597] pci-stub 0000:05:00.1: claimed by stub</p></div></blockquote></div><p>10. i checked lspci -vnn for the graphics cards in the device :</p><div class="quotebox"><blockquote><div><p>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441] (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:0284]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at d0000000 (64-bit, prefetchable) [size=256M]<br />&#160; &#160; &#160; &#160; Memory at f6220000 (64-bit, non-prefetchable) [size=64K]<br />&#160; &#160; &#160; &#160; I/O ports at b000 [size=256]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6200000 [disabled] [size=128K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;</p><p>03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] [1002:aa30]<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:aa30]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 36<br />&#160; &#160; &#160; &#160; Memory at f6230000 (64-bit, non-prefetchable) [size=16K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Kernel driver in use: snd_hda_intel</p><p>04:00.0 Display controller [0380]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441]<br />&#160; &#160; &#160; &#160; Subsystem: ASUSTeK Computer Inc. Device [1043:0284]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at c0000000 (64-bit, prefetchable) [size=256M]<br />&#160; &#160; &#160; &#160; Memory at f6120000 (64-bit, non-prefetchable) [size=64K]<br />&#160; &#160; &#160; &#160; I/O ports at a000 [size=256]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6100000 [disabled] [size=128K]<br />&#160; &#160; &#160; &#160; Capabilities: [50] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [58] Express Legacy Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt;</p><p>05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1) (prog-if 00 [VGA controller])<br />&#160; &#160; &#160; &#160; Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601]<br />&#160; &#160; &#160; &#160; Flags: fast devsel, IRQ 11<br />&#160; &#160; &#160; &#160; Memory at f4000000 (32-bit, non-prefetchable) [disabled] [size=32M]<br />&#160; &#160; &#160; &#160; Memory at e0000000 (64-bit, prefetchable) [disabled] [size=128M]<br />&#160; &#160; &#160; &#160; Memory at e8000000 (64-bit, prefetchable) [disabled] [size=64M]<br />&#160; &#160; &#160; &#160; I/O ports at e000 [disabled] [size=128]<br />&#160; &#160; &#160; &#160; Expansion ROM at f6000000 [disabled] [size=512K]<br />&#160; &#160; &#160; &#160; Capabilities: [60] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [78] Express Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Capabilities: [100] Virtual Channel<br />&#160; &#160; &#160; &#160; Capabilities: [128] Power Budgeting &lt;?&gt;<br />&#160; &#160; &#160; &#160; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt;<br />&#160; &#160; &#160; &#160; Kernel driver in use: pci-stub</p><p>05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1)<br />&#160; &#160; &#160; &#160; Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601]<br />&#160; &#160; &#160; &#160; Flags: bus master, fast devsel, latency 0, IRQ 10<br />&#160; &#160; &#160; &#160; Memory at f6080000 (32-bit, non-prefetchable) [size=16K]<br />&#160; &#160; &#160; &#160; Capabilities: [60] Power Management version 3<br />&#160; &#160; &#160; &#160; Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+<br />&#160; &#160; &#160; &#160; Capabilities: [78] Express Endpoint, MSI 00<br />&#160; &#160; &#160; &#160; Kernel driver in use: pci-stub</p></div></blockquote></div><p>11. after all went good, i create vfio-pci1.cfg in /etc/vfio-pci1.cfg :</p><div class="quotebox"><blockquote><div><p>0000:05:00.0<br />0000:05:00.1</p></div></blockquote></div><p>12. Booting VM&#039;s Script : </p><div class="quotebox"><blockquote><div><p>#!/bin/bash</p><p>configfile=/etc/vfio-pci1.cfg</p><p>vfiobind() {<br />&#160; &#160; dev=&quot;$1&quot;<br />&#160; &#160; &#160; &#160; vendor=$(cat /sys/bus/pci/devices/$dev/vendor)<br />&#160; &#160; &#160; &#160; device=$(cat /sys/bus/pci/devices/$dev/device)<br />&#160; &#160; &#160; &#160; if [ -e /sys/bus/pci/devices/$dev/driver ]; then<br />&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind<br />&#160; &#160; &#160; &#160; fi<br />&#160; &#160; &#160; &#160; echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id</p><p>}</p><p>modprobe vfio-pci</p><p>cat $configfile | while read line;do<br />&#160; &#160; echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue<br />&#160; &#160; &#160; &#160; vfiobind $line<br />done</p><p>sudo qemu-system-x86_64 -vga none -M q35 -hda /home/sslab719/VMimages/VM.img -enable-kvm -m 2048 -cpu host,kvm=off \<br />-smp 2,sockets=1,cores=2,threads=1 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-drive file=/home/sslab719/VMimages/VM.img,id=disk,format=qcow2 \<br />-device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/sslab719/MSI.GTX560Ti.1024.110825.rom \<br />-device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \<br />-net user,hostfwd=tcp::10022-:22 -net nic<br />#-boot menu=on</p><p>exit 0</p></div></blockquote></div><p>Here at this point, i am always having black QEMU Monitor with &quot;compat_monitor0 console&quot;<br />Qemu 2.2.0 monitor - type help for more information -- when i&#039;m using -vga none right over here.</p><p>If i remove -vga none there, i can boot to the VMs normally, and i can see the lspci went in correctly, but it does seem like it doesn&#039;t have the real GPU power... the passthrough went there and it shows up in lspci but i am guessing that theres no GPU clock, shader, and memory power.. I tried to install heaven engine benchmark in linux, and i tried to run it on, and it fails, and here i am guessing that perhaps the problem might be the GPU doesn&#039;t really passthrough successfully, but instead its just a name showup on the VMs, and i can still see 00:01.0 VGA compatible Controller: Device 1234:1111, and the others are our passthrough&#039;d GPU 01:00.0..</p><p>Here by reading i know that we should add -vga none in order to passthrough it normally, but it seemed that -vga none didn&#039;t bring a help for me, and instead its just gave me a weird black qemu monitor which i can type some commands of qemu itself.</p><p>i tried -vga std and others, but those didn&#039;t worked too..</p><p>so i checked my dmesg when turning my VM to see whether vfio works correctly, here are some important points at my dmesg:</p><div class="quotebox"><blockquote><div><p>[&#160; &#160; 0.210689] vgaarb: setting as boot device: PCI:0000:03:00.0<br />[&#160; &#160; 0.210691] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=io+mem,locks=none<br />[&#160; &#160; 0.210695] vgaarb: device added: PCI:0000:05:00.0,decodes=io+mem,owns=none,locks=none<br />[&#160; &#160; 0.210696] vgaarb: loaded<br />[&#160; &#160; 0.210697] vgaarb: bridge control possible 0000:05:00.0<br />[&#160; &#160; 0.210697] vgaarb: bridge control possible 0000:03:00.0<br />[&#160; &#160; 0.210846] SCSI subsystem initialized<br />[&#160; &#160; 0.210873] libata version 3.00 loaded.<br />[&#160; &#160; 0.210889] ACPI: bus type USB registered<br />[&#160; &#160; 0.210902] usbcore: registered new interface driver usbfs<br />[&#160; &#160; 0.210908] usbcore: registered new interface driver hub<br />[&#160; &#160; 0.210919] usbcore: registered new device driver usb<br />[&#160; &#160; 0.211004] PCI: Using ACPI for IRQ routing<br />[&#160; &#160; 0.212320] PCI: pci_cache_line_size set to 64 bytes<br />[&#160; &#160; 0.212378] e820: reserve RAM buffer [mem 0x0009ec00-0x0009ffff]<br />[&#160; &#160; 0.212380] e820: reserve RAM buffer [mem 0xbdf9c000-0xbfffffff]<br />[&#160; &#160; 0.212381] e820: reserve RAM buffer [mem 0xbdfa3000-0xbfffffff]<br />[&#160; &#160; 0.212382] e820: reserve RAM buffer [mem 0xbec81000-0xbfffffff]<br />[&#160; &#160; 0.212383] e820: reserve RAM buffer [mem 0xbf000000-0xbfffffff]<br />[&#160; &#160; 0.212384] e820: reserve RAM buffer [mem 0x83e000000-0x83fffffff]<br />[&#160; &#160; 0.266687] pci 0000:03:00.0: Video device with shadowed ROM<br />[&#160; &#160; 0.266730] PCI: CLS 64 bytes, default 64<br />[&#160; &#160; 0.266768] Trying to unpack rootfs image as initramfs...<br />[&#160; &#160; 2.132383] Freeing initrd memory: 156660K (ffff880024df6000 - ffff88002e6f3000)<br />[&#160; &#160; 2.132421] DMAR: No ATSR found<br />[&#160; &#160; 2.132438] IOMMU 0 0xfed90000: using Queued invalidation<br />[&#160; &#160; 2.132439] IOMMU: Setting RMRR:<br />[&#160; &#160; 2.132450] IOMMU: Setting identity map for device 0000:00:14.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132468] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132481] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbe51f000 - 0xbe53bfff]<br />[&#160; &#160; 2.132489] IOMMU: Prepare 0-16MiB unity mapping for LPC<br />[&#160; &#160; 2.132494] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]<br />[&#160; &#160; 2.132571] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O<br />[&#160; &#160; 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787587] pci-stub 0000:05:00.0: claimed by stub<br />[&#160; &#160; 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000<br />[&#160; &#160; 2.787597] pci-stub 0000:05:00.1: claimed by stub<br />[&#160; &#160; 3.495732] VFIO - User Level meta-driver version: 0.3<br />[&#160; &#160; 3.529871] FS-Cache: Loaded<br />[&#160; &#160; 3.692679] RPC: Registered named UNIX socket transport module.<br />[&#160; &#160; 3.692682] RPC: Registered udp transport module.<br />[&#160; &#160; 3.692683] RPC: Registered tcp transport module.<br />[&#160; &#160; 3.692684] RPC: Registered tcp NFSv4.1 backchannel transport module.<br />[&#160; &#160; 3.722255] ppdev: user-space parallel port driver<br />[&#160; &#160; 3.731469] parport_pc 00:05: reported by Plug and Play ACPI<br />[&#160; &#160; 3.731516] parport0: PC-style at 0x378, irq 5 [PCSPP]<br />[&#160; &#160; 3.816825] lp0: using parport0 (interrupt-driven).<br />[&#160; &#160; 3.821640] wmi: Mapper loaded<br />[&#160; &#160; 3.866631] init: avahi-cups-reload main process (565) terminated with status 1<br />[&#160; &#160; 3.878995] ACPI Warning: SystemIO range 0x0000000000000428-0x000000000000042f conflicts with OpRegion 0x0000000000000400-0x000000000000047f (\PMIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879000] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879003] ACPI Warning: SystemIO range 0x0000000000000540-0x000000000000054f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879005] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879006] ACPI Warning: SystemIO range 0x0000000000000530-0x000000000000053f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879007] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879008] ACPI Warning: SystemIO range 0x0000000000000500-0x000000000000052f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258)<br />[&#160; &#160; 3.879010] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver<br />[&#160; &#160; 3.879010] lpc_ich: Resource conflict(s) found affecting gpio_ich<br />[&#160; &#160; 3.962690] device-mapper: multipath: version 1.7.0 loaded<br />[&#160; &#160; 3.962999] mei_me 0000:00:16.0: irq 34 for MSI/MSI-X<br />[&#160; &#160; 3.977288] AVX version of gcm_enc/dec engaged.<br />[&#160; &#160; 3.977290] AES CTR mode by8 optimization enabled<br />[&#160; &#160; 4.182963] snd_hda_intel 0000:00:1b.0: irq 35 for MSI/MSI-X<br />[&#160; &#160; 4.183050] snd_hda_intel 0000:03:00.1: Handle VGA-switcheroo audio client<br />[&#160; &#160; 4.183071] snd_hda_intel 0000:03:00.1: irq 36 for MSI/MSI-X<br />[&#160; &#160; 4.202764] input: HDA ATI HDMI HDMI/DP,pcm=3 as /devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:04.0/0000:03:00.1/sound/card1/input5<br />[&#160; &#160; 4.221910] sound hdaudioC0D0: autoconfig: line_outs=1 (0x14/0x0/0x0/0x0/0x0) type:line<br />[&#160; &#160; 4.221914] sound hdaudioC0D0:&#160; &#160; speaker_outs=0 (0x0/0x0/0x0/0x0/0x0)<br />[&#160; &#160; 4.221915] sound hdaudioC0D0:&#160; &#160; hp_outs=1 (0x1b/0x0/0x0/0x0/0x0)<br />[&#160; &#160; 4.221916] sound hdaudioC0D0:&#160; &#160; mono: mono_out=0x0<br />[&#160; &#160; 4.221917] sound hdaudioC0D0:&#160; &#160; dig-out=0x11/0x0<br />[&#160; &#160; 4.221918] sound hdaudioC0D0:&#160; &#160; inputs:<br />[&#160; &#160; 4.221919] sound hdaudioC0D0:&#160; &#160; &#160; Front Mic=0x19<br />[&#160; &#160; 4.221921] sound hdaudioC0D0:&#160; &#160; &#160; Rear Mic=0x18<br />[&#160; &#160; 4.221922] sound hdaudioC0D0:&#160; &#160; &#160; Line=0x1a<br />[&#160; &#160; 4.234307] input: HDA Intel PCH Front Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input6<br />[&#160; &#160; 4.234879] input: HDA Intel PCH Rear Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input7<br />[&#160; &#160; 4.234930] input: HDA Intel PCH Line as /devices/pci0000:00/0000:00:1b.0/sound/card0/input8<br />[&#160; &#160; 4.235658] input: HDA Intel PCH Line Out as /devices/pci0000:00/0000:00:1b.0/sound/card0/input9<br />[&#160; &#160; 4.236186] input: HDA Intel PCH Front Headphone as /devices/pci0000:00/0000:00:1b.0/sound/card0/input10<br />[&#160; &#160; 4.237295] Installing knfsd (copyright (C) 1996 okir@monad.swb.de).<br />[&#160; &#160; 4.258359] init: Failed to obtain startpar-bridge instance: Unknown parameter: INSTANCE<br />[&#160; &#160; 4.291101] r8169 0000:06:00.0 eth0: link down<br />[&#160; &#160; 4.291120] r8169 0000:06:00.0 eth0: link down<br />[&#160; &#160; 4.291144] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready<br />[&#160; &#160; 6.646476] r8169 0000:06:00.0 eth0: link up<br />[&#160; &#160; 6.646484] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready<br />[&#160; &#160; 9.469643] init: failsafe main process (690) killed by TERM signal<br />[&#160; &#160; 9.511040] audit_printk_skb: 21 callbacks suppressed<br />[&#160; &#160;10.109377] init: plymouth-upstart-bridge main process ended, respawning<br />[&#160; &#160;10.278910] cgroup: systemd-logind (574) created nested cgroup for controller &quot;memory&quot; which has incomplete hierarchy support. Nested cgroups may change behavior in the future.<br />[&#160; &#160;10.278913] cgroup: &quot;memory&quot; requires setting use_hierarchy to 1 on the root<br />[&#160; &#160;10.676638] random: nonblocking pool is initialized<br />[&#160; 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003)<br />[&#160; 166.777854] kvm: zapping shadow pages for mmio generation wraparound</p></div></blockquote></div><p>i saw some kvm zapping shadow pages here, and these dmesg show up when its on -vga none..</p><p>and when i removed -vga none, and i can enter the VM heres the dmesg :</p><div class="quotebox"><blockquote><div><p>[&#160; 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003)<br />[&#160; 166.777854] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; 262.768505] kvm: zapping shadow pages for mmio generation wraparound<br />[&#160; 269.342192] kvm [2329]: vcpu0 ignored rdmsr: 0x345<br />[&#160; 269.342216] kvm [2329]: vcpu0 ignored wrmsr: 0x680 data 0<br />[&#160; 269.342218] kvm [2329]: vcpu0 ignored wrmsr: 0x681 data 0<br />[&#160; 269.342219] kvm [2329]: vcpu0 ignored wrmsr: 0x682 data 0<br />[&#160; 269.342220] kvm [2329]: vcpu0 ignored wrmsr: 0x683 data 0<br />[&#160; 269.342222] kvm [2329]: vcpu0 ignored wrmsr: 0x684 data 0<br />[&#160; 269.342223] kvm [2329]: vcpu0 ignored wrmsr: 0x685 data 0<br />[&#160; 269.342224] kvm [2329]: vcpu0 ignored wrmsr: 0x686 data 0<br />[&#160; 269.342225] kvm [2329]: vcpu0 ignored wrmsr: 0x687 data 0<br />[&#160; 269.342227] kvm [2329]: vcpu0 ignored wrmsr: 0x688 data 0<br />[&#160; 269.342228] kvm [2329]: vcpu0 ignored wrmsr: 0x689 data 0</p></div></blockquote></div><p>Right over here i am stuck in order to try a GPU passthrough.. did i miss anything? or did my dmesg shows any incorrect steps that i&#039;ve been through? And also, why would the -vga none goes black instead of going to the VMs directly.. </p><p>So would someone help about this case? i&#039;ve been stuck for two weeks and nothing came up with any good.. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Thanks before !</p></div></blockquote></div><p>Can someone help me on this please...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501295">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501310" class="blockpost rowodd"> <h2><span><span class="conr">#4138</span> <a href="viewtopic.php?pid=1501310#p1501310">2015-02-09 15:37:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>hotfunction wrote:</cite><blockquote><div><p>Hi everyone, i&#039;ve been reading a lot of posts here, and i wanted to try the passthrough by myself, but seemed that i got some error here, and firstly according to the steps of the guide, i have been doing step by steps, and here&#039;s my build :</p><p>Processor : Xeon E3-1200 (VT-d Enabled in BIOS)<br />ubuntu display GPU : Radeon HD4870<br />Passthrough GPU : GeForce GTX 560 Ti Hawx</p></div></blockquote></div><p>Step 1, please learn how to use <strong>code</strong> boxes rather than <strong>quote</strong> boxes on the list.</p><div class="quotebox"><blockquote><div><p>So steps i&#039;ve been done so far :<br />1. Ubuntu Server 12.04, then do-release-upgrade to 14.04<br />2. Downloaded Kernel 3.18-5 from Linux homepage<br />3. Downloaded 3.18-5 linux-mainline from nhbs&#039;s first post<br />4. Patched ACS and i915_317 patch from linux-mainline from nbhs&#039;s post<br />5. Qemu 2.2.0, also Seabios standard and no patches<br />6. lspci | grep NVIDIA :<br />&#160; </p><div class="quotebox"><blockquote><div><p>05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1)<br />05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1)</p></div></blockquote></div><p>7. edited /etc/default/grub : <br />&#160; </p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c&quot;</code></pre></div><p>&#160; &#160; and our /proc/cmdline :<br />&#160; </p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7</code></pre></div></div></blockquote></div><p>If you don&#039;t have Intel integrated graphics, you don&#039;t need the i915 patch.&#160; You&#039;re not even using the ACS override patch, so you may be able to use a stock kernel.</p><div class="quotebox"><blockquote><div><p>8. also blacklisted radeon on /etc/modprobe.d/blacklist.conf</p></div></blockquote></div><p>Why?&#160; Radeon is your host device.&#160; How are you going to have host graphics without it?</p><div class="quotebox"><blockquote><div><p>9. dmesg pci-stub : </p><div class="codebox"><pre><code>[ 0.000000] Command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7 [ 0.000000] Kernel command line: BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash intel_iommu=on i915.enable_hd_vgaarb=1 pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7 [ 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.787587] pci-stub 0000:05:00.0: claimed by stub [ 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.787597] pci-stub 0000:05:00.1: claimed by stub</code></pre></div><p>10. i checked lspci -vnn for the graphics cards in the device :</p><div class="codebox"><pre class="vscroll"><code>03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441] (prog-if 00 [VGA controller]) Subsystem: ASUSTeK Computer Inc. Device [1043:0284] Flags: bus master, fast devsel, latency 0, IRQ 11 Memory at d0000000 (64-bit, prefetchable) [size=256M] Memory at f6220000 (64-bit, non-prefetchable) [size=64K] I/O ports at b000 [size=256] Expansion ROM at f6200000 [disabled] [size=128K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; 03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] RV770 HDMI Audio [Radeon HD 4850/4870] [1002:aa30] Subsystem: ASUSTeK Computer Inc. Device [1043:aa30] Flags: bus master, fast devsel, latency 0, IRQ 36 Memory at f6230000 (64-bit, non-prefetchable) [size=16K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable+ Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; Kernel driver in use: snd_hda_intel 04:00.0 Display controller [0380]: Advanced Micro Devices, Inc. [AMD/ATI] R700 [Radeon HD 4870 X2] [1002:9441] Subsystem: ASUSTeK Computer Inc. Device [1043:0284] Flags: bus master, fast devsel, latency 0, IRQ 11 Memory at c0000000 (64-bit, prefetchable) [size=256M] Memory at f6120000 (64-bit, non-prefetchable) [size=64K] I/O ports at a000 [size=256] Expansion ROM at f6100000 [disabled] [size=128K] Capabilities: [50] Power Management version 3 Capabilities: [58] Express Legacy Endpoint, MSI 00 Capabilities: [a0] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [100] Vendor Specific Information: ID=0001 Rev=1 Len=010 &lt;?&gt; 05:00.0 VGA compatible controller [0300]: NVIDIA Corporation GF114 [GeForce GTX 560 Ti] [10de:1200] (rev a1) (prog-if 00 [VGA controller]) Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601] Flags: fast devsel, IRQ 11 Memory at f4000000 (32-bit, non-prefetchable) [disabled] [size=32M] Memory at e0000000 (64-bit, prefetchable) [disabled] [size=128M] Memory at e8000000 (64-bit, prefetchable) [disabled] [size=64M] I/O ports at e000 [disabled] [size=128] Expansion ROM at f6000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100] Virtual Channel Capabilities: [128] Power Budgeting &lt;?&gt; Capabilities: [600] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: pci-stub 05:00.1 Audio device [0403]: NVIDIA Corporation GF114 HDMI Audio Controller [10de:0e0c] (rev a1) Subsystem: Micro-Star International Co., Ltd. [MSI] Device [1462:2601] Flags: bus master, fast devsel, latency 0, IRQ 10 Memory at f6080000 (32-bit, non-prefetchable) [size=16K] Capabilities: [60] Power Management version 3 Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Capabilities: [78] Express Endpoint, MSI 00 Kernel driver in use: pci-stub</code></pre></div></div></blockquote></div><p>See how much nicer that is in a code box?</p><div class="quotebox"><blockquote><div><p>11. after all went good, i create vfio-pci1.cfg in /etc/vfio-pci1.cfg :</p><div class="quotebox"><blockquote><div><p>0000:05:00.0<br />0000:05:00.1</p></div></blockquote></div><p>12. Booting VM&#039;s Script : </p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash configfile=/etc/vfio-pci1.cfg vfiobind() { dev=&quot;$1&quot; vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id } modprobe vfio-pci cat $configfile | while read line;do echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue vfiobind $line done sudo qemu-system-x86_64 -vga none -M q35 -hda /home/sslab719/VMimages/VM.img -enable-kvm -m 2048 -cpu host,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -drive file=/home/sslab719/VMimages/VM.img,id=disk,format=qcow2 \ -device vfio-pci,host=05:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/home/sslab719/MSI.GTX560Ti.1024.110825.rom \ -device vfio-pci,host=05:00.1,bus=root.1,addr=00.1 \ -net user,hostfwd=tcp::10022-:22 -net nic #-boot menu=on exit 0</code></pre></div><p>Here at this point, i am always having black QEMU Monitor with &quot;compat_monitor0 console&quot;<br />Qemu 2.2.0 monitor - type help for more information -- when i&#039;m using -vga none right over here.</p><p>If i remove -vga none there, i can boot to the VMs normally, and i can see the lspci went in correctly, but it does seem like it doesn&#039;t have the real GPU power... the passthrough went there and it shows up in lspci but i am guessing that theres no GPU clock, shader, and memory power.. I tried to install heaven engine benchmark in linux, and i tried to run it on, and it fails, and here i am guessing that perhaps the problem might be the GPU doesn&#039;t really passthrough successfully, but instead its just a name showup on the VMs, and i can still see 00:01.0 VGA compatible Controller: Device 1234:1111, and the others are our passthrough&#039;d GPU 01:00.0..</p><p>Here by reading i know that we should add -vga none in order to passthrough it normally, but it seemed that -vga none didn&#039;t bring a help for me, and instead its just gave me a weird black qemu monitor which i can type some commands of qemu itself.</p><p>i tried -vga std and others, but those didn&#039;t worked too..</p></div></blockquote></div><p>That black window is the sdl graphics head for the VM which appears because you haven&#039;t used the <em>-nographic</em> option.&#160; The GPU output should be on a monitor connected to the assigned GPU.&#160; I&#039;d also recommend, like I almost always do, using 440fx rather than q35 for the VM.&#160; It looks like you&#039;re using a Linux guest, but afaik, the nvidia driver does not have an issue with PCIe topology in Linux (until you get to lots of GPUs and that may already be fixed too).</p><div class="quotebox"><blockquote><div><p>so i checked my dmesg when turning my VM to see whether vfio works correctly, here are some important points at my dmesg:</p><div class="codebox"><pre class="vscroll"><code>[ 0.210689] vgaarb: setting as boot device: PCI:0000:03:00.0 [ 0.210691] vgaarb: device added: PCI:0000:03:00.0,decodes=io+mem,owns=io+mem,locks=none [ 0.210695] vgaarb: device added: PCI:0000:05:00.0,decodes=io+mem,owns=none,locks=none [ 0.210696] vgaarb: loaded [ 0.210697] vgaarb: bridge control possible 0000:05:00.0 [ 0.210697] vgaarb: bridge control possible 0000:03:00.0 [ 0.210846] SCSI subsystem initialized [ 0.210873] libata version 3.00 loaded. [ 0.210889] ACPI: bus type USB registered [ 0.210902] usbcore: registered new interface driver usbfs [ 0.210908] usbcore: registered new interface driver hub [ 0.210919] usbcore: registered new device driver usb [ 0.211004] PCI: Using ACPI for IRQ routing [ 0.212320] PCI: pci_cache_line_size set to 64 bytes [ 0.212378] e820: reserve RAM buffer [mem 0x0009ec00-0x0009ffff] [ 0.212380] e820: reserve RAM buffer [mem 0xbdf9c000-0xbfffffff] [ 0.212381] e820: reserve RAM buffer [mem 0xbdfa3000-0xbfffffff] [ 0.212382] e820: reserve RAM buffer [mem 0xbec81000-0xbfffffff] [ 0.212383] e820: reserve RAM buffer [mem 0xbf000000-0xbfffffff] [ 0.212384] e820: reserve RAM buffer [mem 0x83e000000-0x83fffffff] [ 0.266687] pci 0000:03:00.0: Video device with shadowed ROM [ 0.266730] PCI: CLS 64 bytes, default 64 [ 0.266768] Trying to unpack rootfs image as initramfs... [ 2.132383] Freeing initrd memory: 156660K (ffff880024df6000 - ffff88002e6f3000) [ 2.132421] DMAR: No ATSR found [ 2.132438] IOMMU 0 0xfed90000: using Queued invalidation [ 2.132439] IOMMU: Setting RMRR: [ 2.132450] IOMMU: Setting identity map for device 0000:00:14.0 [0xbe51f000 - 0xbe53bfff] [ 2.132468] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbe51f000 - 0xbe53bfff] [ 2.132481] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbe51f000 - 0xbe53bfff] [ 2.132489] IOMMU: Prepare 0-16MiB unity mapping for LPC [ 2.132494] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff] [ 2.132571] PCI-DMA: Intel(R) Virtualization Technology for Directed I/O [ 2.787575] pci-stub: add 10DE:1200 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.787587] pci-stub 0000:05:00.0: claimed by stub [ 2.787593] pci-stub: add 10DE:0E0C sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 2.787597] pci-stub 0000:05:00.1: claimed by stub [ 3.495732] VFIO - User Level meta-driver version: 0.3 [ 3.529871] FS-Cache: Loaded [ 3.692679] RPC: Registered named UNIX socket transport module. [ 3.692682] RPC: Registered udp transport module. [ 3.692683] RPC: Registered tcp transport module. [ 3.692684] RPC: Registered tcp NFSv4.1 backchannel transport module. [ 3.722255] ppdev: user-space parallel port driver [ 3.731469] parport_pc 00:05: reported by Plug and Play ACPI [ 3.731516] parport0: PC-style at 0x378, irq 5 [PCSPP] [ 3.816825] lp0: using parport0 (interrupt-driven). [ 3.821640] wmi: Mapper loaded [ 3.866631] init: avahi-cups-reload main process (565) terminated with status 1 [ 3.878995] ACPI Warning: SystemIO range 0x0000000000000428-0x000000000000042f conflicts with OpRegion 0x0000000000000400-0x000000000000047f (\PMIO) (20140926/utaddress-258) [ 3.879000] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver [ 3.879003] ACPI Warning: SystemIO range 0x0000000000000540-0x000000000000054f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258) [ 3.879005] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver [ 3.879006] ACPI Warning: SystemIO range 0x0000000000000530-0x000000000000053f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258) [ 3.879007] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver [ 3.879008] ACPI Warning: SystemIO range 0x0000000000000500-0x000000000000052f conflicts with OpRegion 0x0000000000000500-0x0000000000000563 (\GPIO) (20140926/utaddress-258) [ 3.879010] ACPI: If an ACPI driver is available for this device, you should use it instead of the native driver [ 3.879010] lpc_ich: Resource conflict(s) found affecting gpio_ich [ 3.962690] device-mapper: multipath: version 1.7.0 loaded [ 3.962999] mei_me 0000:00:16.0: irq 34 for MSI/MSI-X [ 3.977288] AVX version of gcm_enc/dec engaged. [ 3.977290] AES CTR mode by8 optimization enabled [ 4.182963] snd_hda_intel 0000:00:1b.0: irq 35 for MSI/MSI-X [ 4.183050] snd_hda_intel 0000:03:00.1: Handle VGA-switcheroo audio client [ 4.183071] snd_hda_intel 0000:03:00.1: irq 36 for MSI/MSI-X [ 4.202764] input: HDA ATI HDMI HDMI/DP,pcm=3 as /devices/pci0000:00/0000:00:01.0/0000:01:00.0/0000:02:04.0/0000:03:00.1/sound/card1/input5 [ 4.221910] sound hdaudioC0D0: autoconfig: line_outs=1 (0x14/0x0/0x0/0x0/0x0) type:line [ 4.221914] sound hdaudioC0D0: speaker_outs=0 (0x0/0x0/0x0/0x0/0x0) [ 4.221915] sound hdaudioC0D0: hp_outs=1 (0x1b/0x0/0x0/0x0/0x0) [ 4.221916] sound hdaudioC0D0: mono: mono_out=0x0 [ 4.221917] sound hdaudioC0D0: dig-out=0x11/0x0 [ 4.221918] sound hdaudioC0D0: inputs: [ 4.221919] sound hdaudioC0D0: Front Mic=0x19 [ 4.221921] sound hdaudioC0D0: Rear Mic=0x18 [ 4.221922] sound hdaudioC0D0: Line=0x1a [ 4.234307] input: HDA Intel PCH Front Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input6 [ 4.234879] input: HDA Intel PCH Rear Mic as /devices/pci0000:00/0000:00:1b.0/sound/card0/input7 [ 4.234930] input: HDA Intel PCH Line as /devices/pci0000:00/0000:00:1b.0/sound/card0/input8 [ 4.235658] input: HDA Intel PCH Line Out as /devices/pci0000:00/0000:00:1b.0/sound/card0/input9 [ 4.236186] input: HDA Intel PCH Front Headphone as /devices/pci0000:00/0000:00:1b.0/sound/card0/input10 [ 4.237295] Installing knfsd (copyright (C) 1996 okir@monad.swb.de). [ 4.258359] init: Failed to obtain startpar-bridge instance: Unknown parameter: INSTANCE [ 4.291101] r8169 0000:06:00.0 eth0: link down [ 4.291120] r8169 0000:06:00.0 eth0: link down [ 4.291144] IPv6: ADDRCONF(NETDEV_UP): eth0: link is not ready [ 6.646476] r8169 0000:06:00.0 eth0: link up [ 6.646484] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready [ 9.469643] init: failsafe main process (690) killed by TERM signal [ 9.511040] audit_printk_skb: 21 callbacks suppressed [ 10.109377] init: plymouth-upstart-bridge main process ended, respawning [ 10.278910] cgroup: systemd-logind (574) created nested cgroup for controller &quot;memory&quot; which has incomplete hierarchy support. Nested cgroups may change behavior in the future. [ 10.278913] cgroup: &quot;memory&quot; requires setting use_hierarchy to 1 on the root [ 10.676638] random: nonblocking pool is initialized [ 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) [ 166.777854] kvm: zapping shadow pages for mmio generation wraparound</code></pre></div><p>i saw some kvm zapping shadow pages here, and these dmesg show up when its on -vga none..</p><p>and when i removed -vga none, and i can enter the VM heres the dmesg :</p><div class="codebox"><pre><code>[ 162.674652] vfio-pci 0000:05:00.0: enabling device (0000 -&gt; 0003) [ 166.777854] kvm: zapping shadow pages for mmio generation wraparound [ 262.768505] kvm: zapping shadow pages for mmio generation wraparound [ 269.342192] kvm [2329]: vcpu0 ignored rdmsr: 0x345 [ 269.342216] kvm [2329]: vcpu0 ignored wrmsr: 0x680 data 0 [ 269.342218] kvm [2329]: vcpu0 ignored wrmsr: 0x681 data 0 [ 269.342219] kvm [2329]: vcpu0 ignored wrmsr: 0x682 data 0 [ 269.342220] kvm [2329]: vcpu0 ignored wrmsr: 0x683 data 0 [ 269.342222] kvm [2329]: vcpu0 ignored wrmsr: 0x684 data 0 [ 269.342223] kvm [2329]: vcpu0 ignored wrmsr: 0x685 data 0 [ 269.342224] kvm [2329]: vcpu0 ignored wrmsr: 0x686 data 0 [ 269.342225] kvm [2329]: vcpu0 ignored wrmsr: 0x687 data 0 [ 269.342227] kvm [2329]: vcpu0 ignored wrmsr: 0x688 data 0 [ 269.342228] kvm [2329]: vcpu0 ignored wrmsr: 0x689 data 0</code></pre></div></div></blockquote></div><p>Nope, nothing particularly important in either of those</p><div class="quotebox"><blockquote><div><p>Right over here i am stuck in order to try a GPU passthrough.. did i miss anything? or did my dmesg shows any incorrect steps that i&#039;ve been through? And also, why would the -vga none goes black instead of going to the VMs directly.. </p><p>So would someone help about this case? i&#039;ve been stuck for two weeks and nothing came up with any good.. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p><p>Thanks before !</p></div></blockquote></div><p>If 440fx and -nographic don&#039;t help and you&#039;re looking at the right output from the GPU, I&#039;d next be suspicious of the ROM file.&#160; It looks like one from techpowerup.&#160; Does it actually match your card?&#160; Can you dump the ROM from your card instead?&#160; Do you even need a dump of the ROM?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501310">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501317" class="blockpost roweven"> <h2><span><span class="conr">#4139</span> <a href="viewtopic.php?pid=1501317#p1501317">2015-02-09 16:02:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=87826">The_Moves</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-01-06</span></dd> <dd><span>Posts: 58</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=87826">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> If 440fx and -nographic don&#039;t help and you&#039;re looking at the right output from the GPU, I&#039;d next be suspicious of the ROM file.&#160; It looks like one from techpowerup.&#160; Does it actually match your card?&#160; Can you dump the ROM from your card instead?&#160; Do you even need a dump of the ROM?</p></div></blockquote></div><p>What is the benefit of adding the &quot;romfile/rom&quot; attribute? Under what conditions should it be provided?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501317">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501324" class="blockpost rowodd"> <h2><span><span class="conr">#4140</span> <a href="viewtopic.php?pid=1501324#p1501324">2015-02-09 16:16:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>The_Moves wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p> If 440fx and -nographic don&#039;t help and you&#039;re looking at the right output from the GPU, I&#039;d next be suspicious of the ROM file.&#160; It looks like one from techpowerup.&#160; Does it actually match your card?&#160; Can you dump the ROM from your card instead?&#160; Do you even need a dump of the ROM?</p></div></blockquote></div><p>What is the benefit of adding the &quot;romfile/rom&quot; attribute? Under what conditions should it be provided?</p></div></blockquote></div><p>The romfile= option makes QEMU read the ROM from a file rather than the device itself.&#160; It should only be used if you have trouble reading the ROM, such as seeing the invalid ROM contents message in dmesg, or if you&#039;re replacing the ROM with one that has features the on-device ROM does not, ex. you&#039;ve hacked on it yourself or you&#039;re providing an updated ROM, maybe with UEFI support.&#160; The ROM is read from the device once and cached in QEMU, so there shouldn&#039;t be any issues with re-reading the physical ROM at VM reset.&#160; Also, I feel like I shouldn&#039;t need to say this, but if you attempt to update any assigned device ROM from inside the VM, you do so at your own risk.</p><p>The rombar= option is used to hide the device ROM if you don&#039;t want to use it, for instance if you assign a NIC with a PXE ROM but you don&#039;t want to boot from the device.</p><p>We&#039;ve seen some instance of people here using rombar=0,romfile=$FILE.&#160; Unless you know exactly what you&#039;re doing, this is almost certainly wrong.&#160; This says to hide the device ROM BAR, but still provide a ROM, which gets pushed into the legacy ROMs address space, disassociating it from the device.&#160; Don&#039;t do this.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501324">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501328" class="blockpost roweven"> <h2><span><span class="conr">#4141</span> <a href="viewtopic.php?pid=1501328#p1501328">2015-02-09 16:26:10</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The romfile= option makes QEMU read the ROM from a file rather than the device itself.</p></div></blockquote></div><p>..a quick distraction..<br />Is it 100% &quot;accurate&quot;? So if i&#039;ll actually flash that ROM on the device, nothing will change for the VM?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501328">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501336" class="blockpost rowodd"> <h2><span><span class="conr">#4142</span> <a href="viewtopic.php?pid=1501336#p1501336">2015-02-09 16:32:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The romfile= option makes QEMU read the ROM from a file rather than the device itself.</p></div></blockquote></div><p>..a quick distraction..<br />Is it 100% &quot;accurate&quot;? So if i&#039;ll actually flash that ROM on the device, nothing will change for the VM?</p></div></blockquote></div><p>So long as we can read the ROM from the device, that should be true.&#160; QEMU also takes a lazy approach to reading the ROM, not attempting to do so until the guest tries to read it.&#160; Theoretically this makes sure that the device has been reset and is in a proper state to access the ROM.&#160; I rely on the on-card ROM for most of my devices.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501336">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501393" class="blockpost roweven"> <h2><span><span class="conr">#4143</span> <a href="viewtopic.php?pid=1501393#p1501393">2015-02-09 19:50:23</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80701">apex8</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-29</span></dd> <dd><span>Posts: 47</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>apex8 wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Nothing has changed here, the user always needs to be able to lock enough pages for the VM.&#160; You&#039;re not going to get very far with a locked memory limit of 40MB.&#160; If you use libvirt (and do not hide the vfio device in &lt;qemu:arg&gt;!) this happens automatically.&#160; If you run qemu by hand, the easiest solution is to run as root or use sudo.</p></div></blockquote></div><p>Ah I remember that. I think I adjusted this via </p><div class="codebox"><pre><code>cat /etc/security/limits.conf | grep @users @users soft memlock 4301000 @users hard memlock 4301000</code></pre></div><p>This was fine to run qemu as non root until now..</p></div></blockquote></div><p>OK I found and fixed the issue...</p><div class="codebox"><pre><code>cat /etc/security/limits.conf @users soft memlock 4301000 @users hard memlock 4301000 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html - rtprio 0 1.sh topic_100.html topic_101.html topic_102.html topic_103.html topic_104.html topic_105.html topic_106.html topic_107.html topic_108.html topic_109.html topic_10.html topic_110.html topic_111.html topic_112.html topic_113.html topic_114.html topic_115.html topic_116.html topic_117.html topic_118.html topic_119.html topic_11.html topic_120.html topic_121.html topic_122.html topic_123.html topic_124.html topic_125.html topic_126.html topic_127.html topic_128.html topic_129.html topic_12.html topic_130.html topic_131.html topic_132.html topic_133.html topic_134.html topic_135.html topic_136.html topic_137.html topic_138.html topic_139.html topic_13.html topic_140.html topic_141.html topic_142.html topic_143.html topic_144.html topic_145.html topic_146.html topic_147.html topic_148.html topic_149.html topic_14.html topic_150.html topic_151.html topic_152.html topic_153.html topic_154.html topic_155.html topic_156.html topic_157.html topic_158.html topic_159.html topic_15.html topic_160.html topic_161.html topic_162.html topic_163.html topic_164.html topic_165.html topic_16.html topic_17.html topic_18.html topic_19.html topic_1.html topic_20.html topic_21.html topic_22.html topic_23.html topic_24.html topic_25.html topic_26.html topic_27.html topic_28.html topic_29.html topic_2.html topic_30.html topic_31.html topic_32.html topic_33.html topic_34.html topic_35.html topic_36.html topic_37.html topic_38.html topic_39.html topic_3.html topic_40.html topic_41.html topic_42.html topic_43.html topic_44.html topic_45.html topic_46.html topic_47.html topic_48.html topic_49.html topic_4.html topic_50.html topic_51.html topic_52.html topic_53.html topic_54.html topic_55.html topic_56.html topic_57.html topic_58.html topic_59.html topic_5.html topic_60.html topic_61.html topic_62.html topic_63.html topic_64.html topic_65.html topic_66.html topic_67.html topic_68.html topic_69.html topic_6.html topic_70.html topic_71.html topic_72.html topic_73.html topic_74.html topic_75.html topic_76.html topic_77.html topic_78.html topic_79.html topic_7.html topic_80.html topic_81.html topic_82.html topic_83.html topic_84.html topic_85.html topic_86.html topic_87.html topic_88.html topic_89.html topic_8.html topic_90.html topic_91.html topic_92.html topic_93.html topic_94.html topic_95.html topic_96.html topic_97.html topic_98.html topic_99.html topic_9.html - nice 0 @audio - rtprio 65 @audio - nice -10 @audio - memlock 4301000</code></pre></div><p>The memlock for @audio was set to 40MB. I haven&#039;t touched this file for month and obviously the last value which was set was taken into account. Still wondering why this broke suddenly...<br />Thanks for the hints!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501393">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501399" class="blockpost rowodd"> <h2><span><span class="conr">#4144</span> <a href="viewtopic.php?pid=1501399#p1501399">2015-02-09 20:02:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=71051">DelusionalLogic</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-05-07</span></dd> <dd><span>Posts: 40</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:delusionallogic@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;ve gotten it to work, but for some reason Visual studio wont install. Have anyone had any success installing it? It&#039;s some error about wpfgfx.dll, which makes me afraid it has something to do with the graphics card.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501399">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501402" class="blockpost roweven"> <h2><span><span class="conr">#4145</span> <a href="viewtopic.php?pid=1501402#p1501402">2015-02-09 20:06:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=80387">dwe11er</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-03-18</span></dd> <dd><span>Posts: 73</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>DelusionalLogic wrote:</cite><blockquote><div><p>I&#039;ve gotten it to work, but for some reason Visual studio wont install. Have anyone had any success installing it? It&#039;s some error about wpfgfx.dll, which makes me afraid it has something to do with the graphics card.</p></div></blockquote></div><p>Works for me.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501402">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501455" class="blockpost rowodd"> <h2><span><span class="conr">#4146</span> <a href="viewtopic.php?pid=1501455#p1501455">2015-02-09 22:18:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88701">valnare</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-09</span></dd> <dd><span>Posts: 3</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I managed to get my AMD Radeon 290X to work with VGA passtrough. TRIM also works on the virtual disk controller for the SSD after changing the controller type to IDE and AHCI. I wanted to pass a real disk to the VM, so I don&#039;t loose the ability to natively boot into Windows.</p><p>For playback I am using the HDMI output of my GPU. Unfortunately the audio there stutters while playing sound. The same happens when I try to use the virtualized AC97 output. Did someone else also had problems with the HDMI sound output? Everything else is working perfectly as far as I can tell. Thank you for the great Guide!</p><p>Here is the script I am using to start the VM:</p><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=1024 export QEMU_PA_SERVER=&quot;127.0.0.1&quot; export QEMU_AUDIO_DRV=pa export VMPATH=&quot;/home/felix&quot; export DISK=&quot;/dev/disk/by-id/ata-SanDisk_SDSSDHII960G_144340400518&quot; qemu-system-x86_64 -enable-kvm -m 8192 -cpu Haswell -smp 4,sockets=1,cores=4,threads=1 -vga none \ -mem-path /dev/hugepages -monitor stdio \ -device vfio-pci,host=01:00.0,x-vga=on \ -device vfio-pci,host=01:00.1 \ -net nic -net bridge,br=br0 \ -usb -usbdevice host:045e:0719 -usbdevice host:046d:c07d -usbdevice host:04d9:2013 -usbdevice host:1852:50d0 \ -soundhw ac97 \ -drive id=disk,file=$DISK,if=none,discard=on,detect-zeroes=on -device ahci,id=ahci -device ide-drive,drive=disk,bus=ahci.0 </code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501455">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501489" class="blockpost roweven"> <h2><span><span class="conr">#4147</span> <a href="viewtopic.php?pid=1501489#p1501489">2015-02-10 03:00:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>thanks a lot.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>NVIDIA GRID K2 passthrough successful, but with code 43 after install nvidia driver.</p><p>driver info: 347.25-quadro-grid-desktop-notebook-win8-win7-64bit-international-whql</p></div></blockquote></div><p>Nvidia K-series GRID, Tesla, and Quadro (2000+) are <strong>supported</strong> by Nvidia in non-vga passthrough mode.&#160; Configure the device as secondary graphics for the VM and do not use the x-vga option.</p></div></blockquote></div><p>when I configure the device as secondary graphics for the VM and do not use the x-vga option, the driver report code 12.<br />like &quot;This device cannot find enough free resources that it can use. If you want to use this device, you will need to disable one of the other devices on this system. (Code 12)&quot;</p><p>but if I disable the first device, and reboot it reported code 12 too.</p><p>here is my qemu commandline:</p><p>#!/bin/sh</p><p>qemu-system-x86_64 -cpu host,kvm=off -smp 1,sockets=1,cores=1,threads=1 \<br />-m 8192 -M q35 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/var/lib/libvirt/images/LENOVO-TC-90-MSFT-2.1.BIN \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/var/lib/libvirt/images/win7_nvidia_k2_clean.img,cache=writeback,\<br />if=none,format=qcow2,aio=native,id=virtio-scsi-disk0 \<br />-device scsi-hd,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=52:54:00:1a:2b:3c \<br />-net tap,ifname=tap0,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown \<br />-vga std -vnc :3 \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on \<br />-usb -device usb-tablet \<br />-monitor stdio</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501489">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501490" class="blockpost rowodd"> <h2><span><span class="conr">#4148</span> <a href="viewtopic.php?pid=1501490#p1501490">2015-02-10 03:01:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>thanks a lot.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>NVIDIA GRID K2 passthrough successful, but with code 43 after install nvidia driver.</p><p>driver info: 347.25-quadro-grid-desktop-notebook-win8-win7-64bit-international-whql</p></div></blockquote></div><p>Nvidia K-series GRID, Tesla, and Quadro (2000+) are <strong>supported</strong> by Nvidia in non-vga passthrough mode.&#160; Configure the device as secondary graphics for the VM and do not use the x-vga option.</p></div></blockquote></div><p>when I configure the device as secondary graphics for the VM and do not use the x-vga option, the driver report code 12.</p></div></blockquote></div><p>Use 440fx, not q35</p><p>EDIT: You might just be able to move the GPU to the root complex, but behind a root port is known to cause the problem right now.</p> <p class="postedit"><em>Last edited by aw (2015-02-10 03:12:46)</em></p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501490">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501500" class="blockpost roweven"> <h2><span><span class="conr">#4149</span> <a href="viewtopic.php?pid=1501500#p1501500">2015-02-10 05:22:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=88564">hotfunction</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-05</span></dd> <dd><span>Posts: 10</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=88564">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi and thank you for your reply sir aw !</p><div class="quotebox"><blockquote><div><p>If you don&#039;t have Intel integrated graphics, you don&#039;t need the i915 patch.&#160; You&#039;re not even using the ACS override patch, so you may be able to use a stock kernel.</p></div></blockquote></div><p>yes, i checked on my lspci and i think that my graphics card doesn&#039;t have IGP on it, so i changed the boot parameter and in cmdline changes into this :</p><div class="codebox"><pre><code>BOOT_IMAGE=/vmlinuz-3.18.5 root=/dev/mapper/SSLABVFIO--vg-root ro quiet splash pcie_acs_override=downstream intel_iommu=on pci-stub.ids=10de:1200,10de:0e0c vt.handoff=7</code></pre></div><p>next, i also cleared the blacklisted radeon on /etc/modprobe.d/blacklist.conf, and i added nvidia, for passthrough instead.</p><div class="quotebox"><blockquote><div><p>That black window is the sdl graphics head for the VM which appears because you haven&#039;t used the -nographic option.&#160; The GPU output should be on a monitor connected to the assigned GPU.&#160; I&#039;d also recommend, like I almost always do, using 440fx rather than q35 for the VM.</p></div></blockquote></div><p>i tried adding -nographic and putting back -vga none on the script, but the session is stuck there, and sometimes it made the whole machine stuck until i had to hard-reboot it.&#160; i also tried adding -nographic without -vga none, and gives the same result too.. so i checked using top while having other stuck&#039;d session, and qemu shows up that they own 99.8% of CPU usage.. so i tried to kill the process, and that stucked session went back, so that means actually that -nographic option still boots up the VM, but i can&#039;t see any output.. any idea on this?</p><p>also as for the 440fx version, i configured my script, and it shows no good, still only black monitor, and if i add -vga none, same black_compat0 monitor still show up like before.. here is my script : </p><div class="codebox"><pre class="vscroll"><code>#!/bin/bash configfile=/etc/vfio-pci1.cfg vfiobind() { dev=&quot;$1&quot; vendor=$(cat /sys/bus/pci/devices/$dev/vendor) device=$(cat /sys/bus/pci/devices/$dev/device) if [ -e /sys/bus/pci/devices/$dev/driver ]; then echo $dev &gt; /sys/bus/pci/devices/$dev/driver/unbind fi echo $vendor $device &gt; /sys/bus/pci/drivers/vfio-pci/new_id } modprobe vfio-pci cat $configfile | while read line;do echo $line | grep ^# &gt;/dev/null 2&gt;&amp;1 &amp;&amp; continue vfiobind $line done sudo qemu-system-x86_64 -vga none -hda /home/sslab719/VMimages/VM.img -enable-kvm -m 2048 -cpu host,kvm=off \ -smp 2,sockets=1,cores=2,threads=1 \ -device vfio-pci,host=05:00.0,x-vga=on,romfile=/home/sslab719/MSI.GTX560Ti.1024.110825.rom \ -device vfio-pci,host=05:00.1 \ -net user,hostfwd=tcp::10022-:22 -net nic #-boot menu=on exit 0</code></pre></div><div class="quotebox"><blockquote><div><p>I&#039;d next be suspicious of the ROM file.&#160; It looks like one from techpowerup.&#160; Does it actually match your card?&#160; Can you dump the ROM from your card instead?&#160; Do you even need a dump of the ROM?</p></div></blockquote></div><p>yes i am downloading ones from the techpowerup.. i am not sure whether its going to match perfectly, since 560 ti has a lot of variants, im using MSI GTX560 Ti twin frozr 2 version, and i am searching for better accurate rom for the graphics card.<br />so is that possible that because of the ROM that it brokes the whole process? i dont know why but when the nographic and -vga none added it will crash the pc instead..</p><p>Additional :<br />i tried to keep using q35 version of my script, and i tried to download some benchmark, so i downloaded GpuTest, and once i open it, the whole PC crashes and i had to hard reboot it, is it because of CPU usage that made the PC overloads until it had crash, or is it a stuck because of GPU operation fails?</p> <p class="postedit"><em>Last edited by hotfunction (2015-02-10 15:41:13)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501500">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1501505" class="blockpost rowodd"> <h2><span><span class="conr">#4150</span> <a href="viewtopic.php?pid=1501505#p1501505">2015-02-10 07:13:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83411">erganzi</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-09</span></dd> <dd><span>Posts: 19</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=83411">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>erganzi wrote:</cite><blockquote><div><p>thanks a lot.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Nvidia K-series GRID, Tesla, and Quadro (2000+) are <strong>supported</strong> by Nvidia in non-vga passthrough mode.&#160; Configure the device as secondary graphics for the VM and do not use the x-vga option.</p></div></blockquote></div><p>when I configure the device as secondary graphics for the VM and do not use the x-vga option, the driver report code 12.</p></div></blockquote></div><p>Use 440fx, not q35</p><p>EDIT: You might just be able to move the GPU to the root complex, but behind a root port is known to cause the problem right now.</p></div></blockquote></div><br /><p>when I changed to i440fx, the driver report code 43. </p><p>my qemu commandline:</p><p>qemu-system-x86_64 -cpu SandyBridge,kvm=off -smp 1,sockets=1,cores=1,threads=1 \<br />-m 8192 -enable-kvm \<br />-rtc base=localtime,clock=host \<br />-acpitable file=/var/lib/libvirt/images/LENOVO-TC-90-MSFT-2.1.BIN \<br />-device virtio-scsi-pci,id=scsi \<br />-drive file=/var/lib/libvirt/images/win7_nvidia_k2_clean.img,cache=writeback,\<br />if=none,format=qcow2,aio=native,id=virtio-scsi-disk0 \<br />-device scsi-hd,drive=virtio-scsi-disk0 \<br />-net nic,model=virtio,macaddr=52:54:00:1a:2b:3c \<br />-net tap,ifname=tap0,script=/etc/qemu-ifup,downscript=/etc/qemu-ifdown \<br />-vga std -vnc :3 \<br />-device vfio-pci,host=04:00.0,addr=05.0,multifunction=on \<br />-usb -device usb-tablet \<br />-monitor stdio</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1501505">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=165">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=164">164</a> <a href="viewtopic.php?id=162768&amp;p=165">165</a> <strong>166</strong> <a href="viewtopic.php?id=162768&amp;p=167">167</a> <a href="viewtopic.php?id=162768&amp;p=168">168</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=167">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
