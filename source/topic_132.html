<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 132) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=132" title="Page 132" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=131" title="Page 131" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=133" title="Page 133" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=131">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=130">130</a> <a href="viewtopic.php?id=162768&amp;p=131">131</a> <strong>132</strong> <a href="viewtopic.php?id=162768&amp;p=133">133</a> <a href="viewtopic.php?id=162768&amp;p=134">134</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=133">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1476147" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#3276</span> <a href="viewtopic.php?pid=1476147#p1476147">2014-11-16 20:42:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86701">orcephrye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-15</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinyy wrote:</cite><blockquote><div><p>so, basically you did NO basic tuning</p></div></blockquote></div><p>Actually... I troubleshooted the sound bit quite a lot. First I removed all sound devices to see if it would have an effect. That became my control environment for sound. I found that the FPS in two different games increase by roughly 2 or 3... *sarcastic woo*...&#160; I figured I continue to mess around. I had a sound card. I passed that PCI device through and it worked awesomely. Except no improvements. In the end I found that the default sound emulation will work mostly fine. Except for the aforementioned problem. I asked about it because I do not want to have to use separate speakers (or some funky mixer) and if other people don&#039;t have to perhaps there is something I can due to tweak it.&#160; I also switched between pulse audio and direct with ALSA. In fact I did a lot of s*** but I didn&#039;t explain in detail my whole troubleshooting history. Thats not how you open a conversation for help. I stated what the environment is and what i am currently doing as a starting place.</p><p>What about hugetlbfs... well did that too. No effect. What about compiling the kernel with the voluntary... did that too.. no effect. </p><p>One thing I didn&#039;t due was CPU pinning. I left that alone because I saw other people didn&#039;t have there settings adjusted. And I figured that it likely not improve performance much. I done stuff like that before&#160; with little effect. </p><p>It is true that I haven&#039;t read all 131 pages of this forum. But it is also true that I never expected the performance to be 100% like bare metal. (nor did I type that) In fact I deal with that on a daily basis because I work on OpenStack for customers who always complain about this or that performance wise. My question was how much of a performance drop *should* I expect. Should it be ~30 % or 10 or what? And from what I am hearing it probably shouldn&#039;t be this low. </p><br /><p>And Duelist... what hardware is that? AMD or Intel biased?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476147">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476155" class="blockpost roweven"> <h2><span><span class="conr">#3277</span> <a href="viewtopic.php?pid=1476155#p1476155">2014-11-16 21:09:14</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>And Duelist... what hardware is that? AMD or Intel biased?</p></div></blockquote></div><p>FM2-socket based AMD.<br />Asus F2A55+Athlon X4 750K Trinity(there is a richland-based version).</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476155">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476161" class="blockpost rowodd"> <h2><span><span class="conr">#3278</span> <a href="viewtopic.php?pid=1476161#p1476161">2014-11-16 21:28:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86701">orcephrye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-15</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>And Duelist... what hardware is that? AMD or Intel biased?</p></div></blockquote></div><p>FM2-socket based AMD.<br />Asus F2A55+Athlon X4 750K Trinity(there is a richland-based version).</p></div></blockquote></div><p>*sigh* So an AMD based. Wait.. sorry to ask more but is the card Radeon or Nvidia? </p><p>I got an old Radeon 5770. I am thinking of benchmarking it bare metal and then replacing my 670 to see how it fairs in the KVM and also in Xen. I hope that I only get about 10 or 15% reduction. That seams to align with what I have seen online. If that works out then I will probably by a Radeon 290x and sell my Nvidia 670 for a 100 bucks or something. :-)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476161">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476171" class="blockpost roweven"> <h2><span><span class="conr">#3279</span> <a href="viewtopic.php?pid=1476171#p1476171">2014-11-16 21:50:01</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Trying OVMF, compiled it from github and I can&#039;t get Windows 8.1 to install. Once I got it till end of the first phase but when It started to &quot;copy files 1 out of 5?&quot; it said it cant continue. Compiled again OVMF and now I cannot for gods sake get the DVD to boot properly. &quot;press anything to boot&quot; &gt; I press &gt; windows logo shows with spinning &gt; reboot instantly and Im in a never ending loop. Whats the problem?</p><p>Also from Gerd&#039;s repo edk2.git-ovmf-x64 is not available anymore??</p> <p class="postedit"><em>Last edited by devianceluka (2014-11-16 21:51:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476171">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476173" class="blockpost rowodd"> <h2><span><span class="conr">#3280</span> <a href="viewtopic.php?pid=1476173#p1476173">2014-11-16 21:56:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>you can use ovmf-svn <a href="https://aur.archlinux.org/packages/ovmf-svn/" rel="nofollow">https://aur.archlinux.org/packages/ovmf-svn/</a></p><p>nbhs also built it from git. You can get it on Page 126, here in the thread.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476173">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476176" class="blockpost roweven"> <h2><span><span class="conr">#3281</span> <a href="viewtopic.php?pid=1476176#p1476176">2014-11-16 21:58:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>And Duelist... what hardware is that? AMD or Intel biased?</p></div></blockquote></div><p>FM2-socket based AMD.<br />Asus F2A55+Athlon X4 750K Trinity(there is a richland-based version).</p></div></blockquote></div><p>*sigh* So an AMD based. Wait.. sorry to ask more but is the card Radeon or Nvidia? </p><p>I got an old Radeon 5770. I am thinking of benchmarking it bare metal and then replacing my 670 to see how it fairs in the KVM and also in Xen. I hope that I only get about 10 or 15% reduction. That seams to align with what I have seen online. If that works out then I will probably by a Radeon 290x and sell my Nvidia 670 for a 100 bucks or something. :-)</p></div></blockquote></div><p>1. IOMMU(or something else, i haven&#039;t figured out what exactly yet) is buggy as hell. I have to mlock the memory or i&#039;m getting IO_PAGE_FAULT. I have to do something magical or i&#039;m getting IO_PAGE_FAULT. I have to disable hugepages or i&#039;m getting IO_PAGE_FAULT. Beware of that - there may be bad combos.<br />2. Host GT610, guest 2xHD7750.<br />3. Dude, check this out! A whole table with stats and graphics and stuff!<br /><a href="https://docs.google.com/spreadsheet/ccc?key=0Aryg5nO-kBebdFozaW9tUWdVd2VHM0lvck95TUlpMlE&amp;usp=drive_web#gid=0" rel="nofollow">https://docs.google.com/spreadsheet/ccc … _web#gid=0</a><br />4. AW has GTX750(afair), paired with intel(afair) and, you know, it works.</p><p>If possible, you should continue digging, there may be something wrong, especially when using nvidia drivers with hyper-v extensions.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476176">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476177" class="blockpost rowodd"> <h2><span><span class="conr">#3282</span> <a href="viewtopic.php?pid=1476177#p1476177">2014-11-16 21:58:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>you can use ovmf-svn <a href="https://aur.archlinux.org/packages/ovmf-svn/" rel="nofollow">https://aur.archlinux.org/packages/ovmf-svn/</a></p><p>nbhs also built it from git. You can get it on Page 126, here in the thread.</p></div></blockquote></div><p>sorry for a silly question, been playing with this whole day, cant google anymore. How to fetch from that AUR?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476177">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476178" class="blockpost roweven"> <h2><span><span class="conr">#3283</span> <a href="viewtopic.php?pid=1476178#p1476178">2014-11-16 22:02:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>there are several ways, but for me the easiest is just to 1. download the tarball 2. extract it and 3. run makepkg</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476178">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476179" class="blockpost rowodd"> <h2><span><span class="conr">#3284</span> <a href="viewtopic.php?pid=1476179#p1476179">2014-11-16 22:03:17</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>oreephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>so, basically you did NO basic tuning</p></div></blockquote></div><p>Actually... I troubleshooted the sound bit quite a lot. First I removed all sound devices to see if it would have an effect. That became my control environment for sound. I found that the FPS in two different games increase by roughly 2 or 3... *sarcastic woo*...&#160; I figured I continue to mess around. I had a sound card. I passed that PCI device through and it worked awesomely. Except no improvements. In the end I found that the default sound emulation will work mostly fine. Except for the aforementioned problem. I asked about it because I do not want to have to use separate speakers (or some funky mixer) and if other people don&#039;t have to perhaps there is something I can due to tweak it.&#160; I also switched between pulse audio and direct with ALSA. In fact I did a lot of s*** but I didn&#039;t explain in detail my whole troubleshooting history. Thats not how you open a conversation for help. I stated what the environment is and what i am currently doing as a starting place.</p><p>What about hugetlbfs... well did that too. No effect. What about compiling the kernel with the voluntary... did that too.. no effect. </p><p>One thing I didn&#039;t due was CPU pinning. I left that alone because I saw other people didn&#039;t have there settings adjusted. And I figured that it likely not improve performance much. I done stuff like that before&#160; with little effect. </p><p>It is true that I haven&#039;t read all 131 pages of this forum. But it is also true that I never expected the performance to be 100% like bare metal. (nor did I type that) In fact I deal with that on a daily basis because I work on OpenStack for customers who always complain about this or that performance wise. My question was how much of a performance drop *should* I expect. Should it be ~30 % or 10 or what? And from what I am hearing it probably shouldn&#039;t be this low.</p></div></blockquote></div><p>well, i have my reasons to write the stuff i write as well, in fact.<br />hugetlbfs as well as cpu pinning (+splitting cores intended for host from the ones used for guest(-s)) did noticeable improvement in my case.<br />increasing pa sample amount mostly fixed sound quality issues (stutterring, etc)<br />switching to separate pci audio card being passed through to guest (while connecting its&#039; line-out to host&#039;s line-in) did HUGE performance improvement.</p><p>in the end, i got from 15-25 fps to 300+ in the same game. but that may be just my case</p><p>p.s. btw, talking about performance increases or drops (or comparing hw setups) while not specifying the task used to &quot;measure&quot; performance may be very wrong</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476179">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476183" class="blockpost roweven"> <h2><span><span class="conr">#3285</span> <a href="viewtopic.php?pid=1476183#p1476183">2014-11-16 22:05:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>there are several ways, but for me the easiest is just to 1. download the tarball 2. extract it and 3. run makepkg</p></div></blockquote></div><p>-bash: makepkg: command not found</p><p>which dependancy installs this? Im on Fedora...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476183">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476184" class="blockpost rowodd"> <h2><span><span class="conr">#3286</span> <a href="viewtopic.php?pid=1476184#p1476184">2014-11-16 22:08:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>increasing pa sample amount mostly fixed sound quality issues (stutterring, etc)</p></div></blockquote></div><p>Hmm, i seem to be misunderstanding what you did there. Can you drop an example or something? That should be quick.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476184">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476185" class="blockpost roweven"> <h2><span><span class="conr">#3287</span> <a href="viewtopic.php?pid=1476185#p1476185">2014-11-16 22:08:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86302">4kGamer</a></strong></dt> <dd class="usertitle"><strong>Banned</strong></dd> <dd><span>Registered: 2014-10-29</span></dd> <dd><span>Posts: 82</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:oktayaslantas@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>ahh, I&#039;m sorry, I use arch, I am not familiar with fedora.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476185">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476187" class="blockpost rowodd"> <h2><span><span class="conr">#3288</span> <a href="viewtopic.php?pid=1476187#p1476187">2014-11-16 22:11:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>there are several ways, but for me the easiest is just to 1. download the tarball 2. extract it and 3. run makepkg</p></div></blockquote></div><p>-bash: makepkg: command not found</p><p>which dependancy installs this? Im on Fedora...</p></div></blockquote></div><p>That is an arch tool that generates an arch package, afair.<br />To do this on fedora - you&#039;ll have to build an rpm.. I&#039;m not going to tell you how to do that, i am unable to.</p><p>We could use checkinstall... ...but it is unavailable on fedora.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476187">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476188" class="blockpost roweven"> <h2><span><span class="conr">#3289</span> <a href="viewtopic.php?pid=1476188#p1476188">2014-11-16 22:14:32</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><div class="quotebox"><cite>4kGamer wrote:</cite><blockquote><div><p>there are several ways, but for me the easiest is just to 1. download the tarball 2. extract it and 3. run makepkg</p></div></blockquote></div><p>-bash: makepkg: command not found</p><p>which dependancy installs this? Im on Fedora...</p></div></blockquote></div><p>That is an arch tool that generates an arch package, afair.<br />To do this on fedora - you&#039;ll have to build an rpm.. I&#039;m not going to tell you how to do that, i am unable to.</p><p>We could use checkinstall... ...but it is unavailable on fedora.</p></div></blockquote></div><p>?:/<br />Can you atleast help me with why Windows DVD wont boot?</p> <p class="postedit"><em>Last edited by devianceluka (2014-11-16 22:16:02)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476188">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476215" class="blockpost rowodd"> <h2><span><span class="conr">#3290</span> <a href="viewtopic.php?pid=1476215#p1476215">2014-11-16 23:38:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>?:/<br />Can you atleast help me with why Windows DVD wont boot?</p></div></blockquote></div><p>Well i&#039;ve had some problems with windows install dvd boot, but i can&#039;t recall what was the problem.<br />I remember it was related to OVMF. Something like i haven&#039;t had the video output.</p><p>Something hints me that you have a peculiar disk system used in VM. Can you supply us a launching script/xml config from libvirt again?</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476215">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476239" class="blockpost roweven"> <h2><span><span class="conr">#3291</span> <a href="viewtopic.php?pid=1476239#p1476239">2014-11-17 01:13:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82117">devianceluka</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-19</span></dd> <dd><span>Posts: 43</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>devianceluka wrote:</cite><blockquote><div><p>?:/<br />Can you atleast help me with why Windows DVD wont boot?</p></div></blockquote></div><p>Well i&#039;ve had some problems with windows install dvd boot, but i can&#039;t recall what was the problem.<br />I remember it was related to OVMF. Something like i haven&#039;t had the video output.</p><p>Something hints me that you have a peculiar disk system used in VM. Can you supply us a launching script/xml config from libvirt again?</p></div></blockquote></div><p>qemu is from github v2.1.2, kernel 3.17.2:</p><div class="codebox"><pre><code>vfio-bind 0000:02:00.0 0000:02:00.1 /xxx/qemu-system-x86_64 \ -enable-kvm -m 1024 -cpu host -smp 4,sockets=1,cores=4,threads=1 -vga none -nographic -balloon none \ -net nic,model=virtio,macaddr=xxx,model=virtio \ -net bridge,br=br0,helper=/xxx/qemu-bridge-helper \ -device vfio-pci,host=02:00.0,multifunction=on,romfile=/xxx/club3dr9290.rom \ -device vfio-pci,host=02:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/xxx/test.qcow2,id=disk,format=qcow2,cache=none,aio=native \ -drive if=pflash,format=raw,readonly,file=/root/OVMF/OVMF.fd \ -drive if=pflash,format=raw,file=/root/OVMF/OVMF_VARS.fd \ -cdrom /xxx/virtio.iso \ #-usb -usbdevice host:046d:c315 #-drive file=/xxx/ubuntu.iso,id=iso_install,if=none \ #-device scsi-cd,drive=iso_install \</code></pre></div><p>With this latest build/compile of OVMF from ubuntu wiki I can&#039;t even grub-install EFI bootloader into EFI shell (always have to load by file)...</p><p>compiled like this:</p><div class="codebox"><pre><code>git clone git://github.com/tianocore/edk2.git cd edk2 make -C BaseTools . edksetup.sh nano Conf/target.txt &quot; ACTIVE_PLATFORM = OvmfPkg/OvmfPkgX64.dsc TOOL_CHAIN_TAG = GCC48 TARGET_ARCH = X64 &quot; build</code></pre></div><p>and copy it out:</p><div class="codebox"><pre><code>cp /root/OVMF/edk2/Build/OvmfX64/DEBUG_GCC48/FV/OVMF_CODE.fd /root/OVMF/OVMF_CODE.fd cp /root/OVMF/edk2/Build/OvmfX64/DEBUG_GCC48/FV/OVMF_VARS.fd /root/OVMF/OVMF_VARS.fd</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476239">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476270" class="blockpost rowodd"> <h2><span><span class="conr">#3292</span> <a href="viewtopic.php?pid=1476270#p1476270">2014-11-17 05:20:56</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>increasing pa sample amount mostly fixed sound quality issues (stutterring, etc)</p></div></blockquote></div><p>Hmm, i seem to be misunderstanding what you did there. Can you drop an example or something? That should be quick.</p></div></blockquote></div><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=8192</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476270">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476415" class="blockpost roweven"> <h2><span><span class="conr">#3293</span> <a href="viewtopic.php?pid=1476415#p1476415">2014-11-17 16:48:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86701">orcephrye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-15</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=8192</code></pre></div></div></blockquote></div><p>Well that is much higher then I tried it out. I did 512. :-P Should be more bold! Although I did do a line out to line in kinda setup and that seams to be working ok. </p><p>I attempted a few more tweaks. I added &#039;hv-time&#039; and removed kvm=off. Then installed the older nvidia drivers that do not freak out. All of this didn&#039;t help a whole log. Everything seams to just give tiny little performance boosts or tiny performance decreases. I would like to try out CPU pinning. But the only articles showing how to do that is doing it with the XML file created by virt-install. I tried converting my command line arguments over but the VM wont load. Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?&#160; There is cgroups... perhaps I should do that instead?</p><p>On another note thinking maybe I will download 3.17.3. I compiled 3.16.7. I also running Qemu 2.1 perhaps 2.2. </p><p>Either case I am still stuck with crappy performance. Namely the FPS in games is ok... just ever now and again it drops to almost zero.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476415">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476420" class="blockpost rowodd"> <h2><span><span class="conr">#3294</span> <a href="viewtopic.php?pid=1476420#p1476420">2014-11-17 16:52:00</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?</p></div></blockquote></div><p><em>info cpus</em> from the QEMU monitor will give the thread ID for each vCPU, use taskset to pin them to separate physical CPUs.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476420">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476461" class="blockpost roweven"> <h2><span><span class="conr">#3295</span> <a href="viewtopic.php?pid=1476461#p1476461">2014-11-17 18:36:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><p>increasing pa sample amount mostly fixed sound quality issues (stutterring, etc)</p></div></blockquote></div><p>Hmm, i seem to be misunderstanding what you did there. Can you drop an example or something? That should be quick.</p></div></blockquote></div><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=8192</code></pre></div></div></blockquote></div><p>Oh. Thanks. I forgot i&#039;ve had that variable set up in the beggining of the script. Thanks for the hint again.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476461">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476466" class="blockpost rowodd"> <h2><span><span class="conr">#3296</span> <a href="viewtopic.php?pid=1476466#p1476466">2014-11-17 18:54:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86701">orcephrye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-15</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?</p></div></blockquote></div><p><em>info cpus</em> from the QEMU monitor will give the thread ID for each vCPU, use taskset to pin them to separate physical CPUs.</p></div></blockquote></div><p>... This is why we pay you the big bucks aw.</p><p>Who &#039;we&#039; is and how much is &#039;big&#039; are probably interesting questions.</p><p>I used taskset before... dont know why I didn&#039;t think of it. I can combo it with isolcpus! That will keep that pesky scheduler out of my cores.&#160; Once I get home I will play around with that.. see if it works. Not sure if I would need to get the thread_id though. I mean wouldn&#039;t something like:</p><div class="codebox"><pre><code># taskset -c 2,3,4,5,6,7 qemu-system-x86_64 (etc...) </code></pre></div><p>Would that get all spawned threads/subprocesses and assign them to cpus 3-8? I ask that question even though I am gonna go home and try that out.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476466">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476470" class="blockpost roweven"> <h2><span><span class="conr">#3297</span> <a href="viewtopic.php?pid=1476470#p1476470">2014-11-17 19:00:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82238">sinny</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-05-24</span></dd> <dd><span>Posts: 75</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=82238">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=8192</code></pre></div></div></blockquote></div><p>Well that is much higher then I tried it out. I did 512. :-P Should be more bold! Although I did do a line out to line in kinda setup and that seams to be working ok. </p><p>I attempted a few more tweaks. I added &#039;hv-time&#039; and removed kvm=off. Then installed the older nvidia drivers that do not freak out. All of this didn&#039;t help a whole log. Everything seams to just give tiny little performance boosts or tiny performance decreases. I would like to try out CPU pinning. But the only articles showing how to do that is doing it with the XML file created by virt-install. I tried converting my command line arguments over but the VM wont load. Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?&#160; There is cgroups... perhaps I should do that instead?</p><p>On another note thinking maybe I will download 3.17.3. I compiled 3.16.7. I also running Qemu 2.1 perhaps 2.2. </p><p>Either case I am still stuck with crappy performance. Namely the FPS in games is ok... just ever now and again it drops to almost zero.</p></div></blockquote></div><p>the poor man&#039;s choice is (i have been using it - it was the most i could think of):<br />1) prevent host from using cpus intended for guest(-s) - &quot;isolcpus&quot; kernel parameter; 1 2-threaded core is more then enough in my case, taskset allows to lift this restriction when necessary<br />2) restrict cpus available for every qemu process - use taskset; something like &quot;sudo -E taskset --cpu-list 1,2,5,6 qemu-system-x86_64 ...&quot;</p><p>it&#039;s not cpu pinning, but at least it allowed to perform basic manual host cpu resource separation</p><p>later i switched to libvirt, which seems to successfully manage cpu pinning by itself - only isolcpus remains from old setup</p> <p class="postedit"><em>Last edited by sinny (2014-11-17 19:02:13)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476470">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476472" class="blockpost rowodd"> <h2><span><span class="conr">#3298</span> <a href="viewtopic.php?pid=1476472#p1476472">2014-11-17 19:05:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><p>Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?</p></div></blockquote></div><p><em>info cpus</em> from the QEMU monitor will give the thread ID for each vCPU, use taskset to pin them to separate physical CPUs.</p></div></blockquote></div><p>... This is why we pay you the big bucks aw.</p><p>Who &#039;we&#039; is and how much is &#039;big&#039; are probably interesting questions.</p><p>I used taskset before... dont know why I didn&#039;t think of it. I can combo it with isolcpus! That will keep that pesky scheduler out of my cores.&#160; Once I get home I will play around with that.. see if it works. Not sure if I would need to get the thread_id though. I mean wouldn&#039;t something like:</p><div class="codebox"><pre><code># taskset -c 2,3,4,5,6,7 qemu-system-x86_64 (etc...) </code></pre></div><p>Would that get all spawned threads/subprocesses and assign them to cpus 3-8? I ask that question even though I am gonna go home and try that out.</p></div></blockquote></div><p>Sure, but that&#039;s not what you want.&#160; You want to pin a single vCPU to a single pCPU such that the scheduler has zero migration to do and the caches are hot.&#160; If you&#039;re benchmarking a VM, it&#039;s probably also best to set the performance governor in the host since ondemand can add latency to the guest&#039;s ability to react to load.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476472">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476486" class="blockpost roweven"> <h2><span><span class="conr">#3299</span> <a href="viewtopic.php?pid=1476486#p1476486">2014-11-17 20:02:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=86701">orcephrye</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-11-15</span></dd> <dd><span>Posts: 9</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=86701">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>sinny wrote:</cite><blockquote><div><div class="codebox"><pre><code>export QEMU_PA_SAMPLES=8192</code></pre></div></div></blockquote></div><p>Well that is much higher then I tried it out. I did 512. :-P Should be more bold! Although I did do a line out to line in kinda setup and that seams to be working ok. </p><p>I attempted a few more tweaks. I added &#039;hv-time&#039; and removed kvm=off. Then installed the older nvidia drivers that do not freak out. All of this didn&#039;t help a whole log. Everything seams to just give tiny little performance boosts or tiny performance decreases. I would like to try out CPU pinning. But the only articles showing how to do that is doing it with the XML file created by virt-install. I tried converting my command line arguments over but the VM wont load. Is there a way to do cpu pinning via the &quot;qemu-system-x86_64&quot; cmd?&#160; There is cgroups... perhaps I should do that instead?</p><p>On another note thinking maybe I will download 3.17.3. I compiled 3.16.7. I also running Qemu 2.1 perhaps 2.2. </p><p>Either case I am still stuck with crappy performance. Namely the FPS in games is ok... just ever now and again it drops to almost zero.</p></div></blockquote></div><p>the poor man&#039;s choice is (i have been using it - it was the most i could think of):<br />1) prevent host from using cpus intended for guest(-s) - &quot;isolcpus&quot; kernel parameter; 1 2-threaded core is more then enough in my case, taskset allows to lift this restriction when necessary<br />2) restrict cpus available for every qemu process - use taskset; something like &quot;sudo -E taskset --cpu-list 1,2,5,6 qemu-system-x86_64 ...&quot;</p><p>it&#039;s not cpu pinning, but at least it allowed to perform basic manual host cpu resource separation</p><p>later i switched to libvirt, which seems to successfully manage cpu pinning by itself - only isolcpus remains from old setup</p></div></blockquote></div><p>I just realized that my idea will not take every thread and place it on one CPU... but I am not sure if that&#039;s actually necessary:</p><p>... just refreshed and.. derp:</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sure, but that&#039;s not what you want.&#160; You want to pin a single vCPU to a single pCPU such that the scheduler has zero migration to do and the caches are hot.&#160; If you&#039;re benchmarking a VM, it&#039;s probably also best to set the performance governor in the host since ondemand can add latency to the guest&#039;s ability to react to load.</p></div></blockquote></div><p>So... perhaps a script like this:</p><div class="codebox"><pre><code>VAR=2 &amp;&amp; QEMUPID=`pidof /usr/bin/qemu-system-x86_64` &amp;&amp; THREADLIST=`ps -o lwp --no-headers -p $QEMUPID -L | grep -v $QEMUPID` &amp;&amp; for i in $THREADLIST ; do taskset -cp $VAR $i ; VAR=$((VAR+1)) ; done</code></pre></div> <p class="postedit"><em>Last edited by orcephrye (2014-11-17 20:03:23)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476486">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1476509" class="blockpost rowodd"> <h2><span><span class="conr">#3300</span> <a href="viewtopic.php?pid=1476509#p1476509">2014-11-17 20:54:52</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>orcephrye wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Sure, but that&#039;s not what you want.&#160; You want to pin a single vCPU to a single pCPU such that the scheduler has zero migration to do and the caches are hot.&#160; If you&#039;re benchmarking a VM, it&#039;s probably also best to set the performance governor in the host since ondemand can add latency to the guest&#039;s ability to react to load.</p></div></blockquote></div><p>So... perhaps a script like this:</p><div class="codebox"><pre><code>VAR=2 &amp;&amp; QEMUPID=`pidof /usr/bin/qemu-system-x86_64` &amp;&amp; THREADLIST=`ps -o lwp --no-headers -p $QEMUPID -L | grep -v $QEMUPID` &amp;&amp; for i in $THREADLIST ; do taskset -cp $VAR $i ; VAR=$((VAR+1)) ; done</code></pre></div></div></blockquote></div><p>Seems like it might work, the vCPUs should be the first N threads spawned by the main QEMU pid.&#160; BTW, you seem to be starting at physical CPU2, but you were originally using <em>-smp cpus=8,sockets=1,cores=8,threads=1</em> on an 8-core processor.&#160; Are you also scaling back to a 6-core guest?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1476509">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=131">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=130">130</a> <a href="viewtopic.php?id=162768&amp;p=131">131</a> <strong>132</strong> <a href="viewtopic.php?id=162768&amp;p=133">133</a> <a href="viewtopic.php?id=162768&amp;p=134">134</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=133">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
