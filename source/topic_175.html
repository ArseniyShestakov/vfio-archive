<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 175) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=175" title="Page 175" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=174" title="Page 174" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=176" title="Page 176" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=174">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=173">173</a> <a href="viewtopic.php?id=162768&amp;p=174">174</a> <strong>175</strong> <a href="viewtopic.php?id=162768&amp;p=176">176</a> <a href="viewtopic.php?id=162768&amp;p=177">177</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=176">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1507298" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#4351</span> <a href="viewtopic.php?pid=1507298#p1507298">2015-03-01 11:37:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Hey guys, I finally managed to passthrough my GPU. I&#039;ve tried before and had lots of errors and eventually gave up. Later on I found my motherboard just didn&#039;t support IOMMU -.-<br />Anyways i&#039;ve bought a new motherboard that does support IOMMU so now I have the following setup:<br />MOBO: Asrock Extreme 6/ac<br />CPU: i7 4790k @ 4Ghz<br />GPU Host: GTX 980<br />GPU Guest: GTX 770 (I can&#039;t turn these around sadly, it will not give any video output otherwise)<br />Linux Mainline 3.18.5 kernel with ACS patch enabled (from the first post).</p><p>Using the following commandline I managed to set up a Windows 8 VM running on my SSD&#039;s, and having the GTX 770 as passthrough:</p><div class="codebox"><pre><code>QEMU_PA_SAMPLES=128 QEMU_AUDIO_DRV=pa qemu-system-x86_64 -enable-kvm -M q35 -m 8096 -cpu host -soundhw hda \ -smp 6,sockets=1,cores=6,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=02:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device vfio-pci,host=02:00.1,bus=root.1,addr=00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/sdb,id=ssddisk,format=raw,if=none -device scsi-hd,drive=ssddisk \ -drive file=/dev/sdd,id=hdddisk,format=raw,if=none -device scsi-hd,drive=hdddisk</code></pre></div><p><strong>Problem 1:</strong><br />Everything appeared to be succesful, Windows runs without problems (just the mouse is a bit itchy), and the NVIDIA driver installer was able to detect the GPU and install the driver.<br />Rebooted VM, installed GPU-Z and it shows my GTX 770 (with 347.52 driver). However it also shows the GPU Clock is 0 Mhz, just as memory and default clock.<br />I also can&#039;t open the NVIDIA settings screen, first it gave me some runtime errors, now it just doesn&#039;t show up at all.<br />Whenever I run Geforce Experience it seems to not find any installed driver, as it automatically starts downloading the driver I already have installed.</p><p><strong>Problem 2:</strong><br />Sound laggs badly. I can hear it, but if it would be measured in frames per second, it would&#039;ve been around 3. As you can see in my commandline I try to use PulseAudio.<br />What am I doing wrong here?</p></div></blockquote></div><br /><p>Well..</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>...<br />Missing -vga none<br />Don&#039;t use q35</p></div></blockquote></div><p>For the sound you could try using alsa, and/or playing with the parameters:</p><div class="codebox"><pre><code>qemu-system-x86_64 -audio-help</code></pre></div><p>to see all available drivers and params, also i experienced some crackling and lag until i started pinning the vcpus</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507298">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507306" class="blockpost roweven"> <h2><span><span class="conr">#4352</span> <a href="viewtopic.php?pid=1507306#p1507306">2015-03-01 12:36:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>Well..</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>...<br />Missing -vga none<br />Don&#039;t use q35</p></div></blockquote></div></div></blockquote></div><p>Well -vga none explains something. However if I change my command line to use -vga none, it only gives me a qemu command line:</p><div class="codebox"><pre><code>compat_monitor0 console QEMU 2.2.0 monitor - type &#039;help&#039; for more information (qemu)</code></pre></div><p>This happens with both Q35 and i440fx.</p><br /><div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>For the sound you could try using alsa, and/or playing with the parameters:</p><div class="codebox"><pre><code>qemu-system-x86_64 -audio-help</code></pre></div><p>to see all available drivers and params, also i experienced some crackling and lag until i started pinning the vcpus</p></div></blockquote></div><p>I&#039;ll try some things and report back.</p> <p class="postedit"><em>Last edited by PureTryOut (2015-03-01 12:39:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507306">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507310" class="blockpost rowodd"> <h2><span><span class="conr">#4353</span> <a href="viewtopic.php?pid=1507310#p1507310">2015-03-01 12:43:57</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Well -vga none explains something. However if I change my command line to use -vga none, it only gives me a qemu command line:</p><div class="codebox"><pre><code>compat_monitor0 console QEMU 2.2.0 monitor - type &#039;help&#039; for more information (qemu)</code></pre></div></div></blockquote></div><p>Yeah that&#039;s whats supposed to happen you&#039;ll get output on your gpu</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507310">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507323" class="blockpost roweven"> <h2><span><span class="conr">#4354</span> <a href="viewtopic.php?pid=1507323#p1507323">2015-03-01 13:03:47</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Sorry I didn&#039;t make myself clear I guess.</p><p>Without -vga none it boots up Windows, although with non working GPU.<br />With -vga none it only shows that. It doesn&#039;t boot up the VM.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507323">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507344" class="blockpost rowodd"> <h2><span><span class="conr">#4355</span> <a href="viewtopic.php?pid=1507344#p1507344">2015-03-01 14:14:20</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Sorry I didn&#039;t make myself clear I guess.</p><p>Without -vga none it boots up Windows, although with non working GPU.<br />With -vga none it only shows that. It doesn&#039;t boot up the VM.</p></div></blockquote></div><p>You also need:</p><p>-cpu host,kvm=off</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507344">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507364" class="blockpost roweven"> <h2><span><span class="conr">#4356</span> <a href="viewtopic.php?pid=1507364#p1507364">2015-03-01 15:00:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>PureTryOut wrote:</cite><blockquote><div><p>Sorry I didn&#039;t make myself clear I guess.</p><p>Without -vga none it boots up Windows, although with non working GPU.<br />With -vga none it only shows that. It doesn&#039;t boot up the VM.</p></div></blockquote></div><p>Then either VGA arbitration is not working or QEMU can&#039;t read the ROM on the GPU.&#160; VGA arbitration not working was a problem we used to see using the proprietary nvidia driver in the host (driver would lock and never release the VGA arbitration lock).&#160; Nvidia might have fixed this, dunno.&#160; The latter ROM issue would produce an invalid ROM contents message in dmesg.&#160; GeForce cards do not work as secondary GPUs in the guest.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507364">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507378" class="blockpost rowodd"> <h2><span><span class="conr">#4357</span> <a href="viewtopic.php?pid=1507378#p1507378">2015-03-01 15:38:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85328">PureTryOut</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-23</span></dd> <dd><span>Posts: 63</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>You also need:</p><p>-cpu host,kvm=off</p></div></blockquote></div><p>Sadly that did not work either. Still showing the console...<br />Current commandline:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -m 8096 -cpu host,kvm=off \ -smp 6,sockets=1,cores=6,threads=1 \ -vga none -device vfio-pci,host=02:00.0,x-vga=on -device vfio-pci,host=02:00.1 \ -device virtio-scsi-pci,id=scsi \ -drive file=/dev/sdb,id=ssddisk,format=raw,if=none -device scsi-hd,drive=ssddisk \ -drive file=/dev/sdd,id=hdddisk,format=raw,if=none -device scsi-hd,drive=hdddisk</code></pre></div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Then either VGA arbitration is not working or QEMU can&#039;t read the ROM on the GPU.&#160; VGA arbitration not working was a problem we used to see using the proprietary nvidia driver in the host (driver would lock and never release the VGA arbitration lock).&#160; Nvidia might have fixed this, dunno.&#160; The latter ROM issue would produce an invalid ROM contents message in dmesg.&#160; GeForce cards do not work as secondary GPUs in the guest.</p></div></blockquote></div><p>So is there any workaround or any way I can fix this?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507378">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507430" class="blockpost roweven"> <h2><span><span class="conr">#4358</span> <a href="viewtopic.php?pid=1507430#p1507430">2015-03-01 18:52:07</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83627">JohnyPea</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-17</span></dd> <dd><span>Posts: 17</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Jodaco wrote:</cite><blockquote><div><p>Has anyone else with an amd system done this with nbhs&#039; suggested option of disabling npt?&#160; I found that with it disabled it did improve my benchmark scores, doubled in some cases, and games hit higher framerates, but its not consistent.&#160; With npt=0 set cpu load is all over the damn place and framerates in games vary anywhere from 5 fps to 150fps.</p><p>I have an AMD 8320, Asus M5A99X EVO PRO r2.0 with the latest bios, 32 GB of ram, Geforce 660 ti for host, and a Geforce 970 on the guest.</p></div></blockquote></div><p> I am using npt=0. Have used npt=1&#160; for an extended period and performance was worse. The effect was that in some games the framerate was lower, but GPU and CPU loads were lower too and a bit more kernel time on host. npt=0 is generally much better. In both cases the machines are stable.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507430">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507444" class="blockpost rowodd"> <h2><span><span class="conr">#4359</span> <a href="viewtopic.php?pid=1507444#p1507444">2015-03-01 19:35:29</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89165">terusus</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-27</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89165">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Is CONFIG_VFIO_PCI_VGA also set?</p><p>hv_time is incompatible with nvidia</p><p>Missing -vga none</p><p>Don&#039;t use q35</p></div></blockquote></div><p>Thanks for the fast replay.</p><p>1. CONFIG_VFIO_PCI_VGA=y is set by default. I double checked with my /boot/config-...<br />2. Removed hv_time.<br />3. Changed q35 to pc (as I understand this is the default).<br />4. I had to remove &quot;bus=pcie.0&quot; from ioh3420 line because of an error.<br />5. I had to use &quot;rombar=0&quot; or &quot;romfile=...&quot; when assigning my VGA.</p><p>So, my QEMU start line became:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 \ -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/media/.../GF114.rom \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi \ -drive file=/storage/vm/win7.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/media/.../win7.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/media/.../virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -vga none</code></pre></div><p>The results were the same for rombar/romfile:<br />1) VGA appears dead WITHOUT &quot;-vga none&quot;.<br />2) No output on the nVidia DVI ports WITH &quot;-vga none&quot;</p><p><strong>PS:</strong> Tried a few restarts. Also reinstalled the win7 vm.</p> <p class="postedit"><em>Last edited by terusus (2015-03-01 21:20:30)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507444">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507478" class="blockpost roweven"> <h2><span><span class="conr">#4360</span> <a href="viewtopic.php?pid=1507478#p1507478">2015-03-01 21:08:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>JohnyPea wrote:</cite><blockquote><div><div class="quotebox"><cite>Jodaco wrote:</cite><blockquote><div><p>Has anyone else with an amd system done this with nbhs&#039; suggested option of disabling npt?&#160; I found that with it disabled it did improve my benchmark scores, doubled in some cases, and games hit higher framerates, but its not consistent.&#160; With npt=0 set cpu load is all over the damn place and framerates in games vary anywhere from 5 fps to 150fps.</p><p>I have an AMD 8320, Asus M5A99X EVO PRO r2.0 with the latest bios, 32 GB of ram, Geforce 660 ti for host, and a Geforce 970 on the guest.</p></div></blockquote></div><p> I am using npt=0. Have used npt=1&#160; for an extended period and performance was worse. The effect was that in some games the framerate was lower, but GPU and CPU loads were lower too and a bit more kernel time on host. npt=0 is generally much better. In both cases the machines are stable.</p></div></blockquote></div><p><a href="http://magazine.redhat.com/2007/11/20/red-hat-enterprise-linux-51-utilizes-nested-paging-on-amd-barcelona-processor-to-improve-performance-of-virtualized-guests/" rel="nofollow">http://magazine.redhat.com/2007/11/20/r … ed-guests/</a><br />That&#039;s ridiculous. Simply crazy. I don&#039;t get it.<br />How BROKEN NPT should be that it slows down the VM? And I&#039;ve been worrying about too big errata list on my CPU family.</p><p>EDIT:<br /><a href="http://www.cse.iitd.ernet.in/~sbansal/csl862-virt/2010/readings/NPT-WP-1%201-final-TM.pdf" rel="nofollow">http://www.cse.iitd.ernet.in/~sbansal/c … nal-TM.pdf</a><br />Oooh, nice document to read. I&#039;ll try reading this somewhere in future time.</p> <p class="postedit"><em>Last edited by Duelist (2015-03-01 21:24:13)</em></p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507478">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507487" class="blockpost rowodd"> <h2><span><span class="conr">#4361</span> <a href="viewtopic.php?pid=1507487#p1507487">2015-03-01 21:30:03</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=66472">hurenkam</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-12-10</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=66472">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>It&#039;s generally recommended that the graphics card for assignment is a secondary device on the host because it&#039;s often difficult to detach all the host drivers from the primary display.&#160; Even if you use pci-stub.ids to prevent PCI drivers from attaching, the low level VGA/VESA drivers can still make use of it.&#160; It&#039;s not necessarily impossible, but it&#039;s not a heavily used or documented path.</p></div></blockquote></div><p>Passing a secondary device (from host perspective) is indeed easier.<br />However, after some fiddling, i managed to passthrough the primary card on my system, but it does involve some extra work.<br />Apart from the usual driver blacklisting (radeon in my case) i had to do the following as well:<br />- Switch grub to text-only mode by adding &quot;GRUB_GFXPAYLOAD_LINUX=text&quot; to /etc/defaults/grub<br />- Switch linux boot to text-only mode by adding &quot;nomodeset nofb&quot; to GRUB_CMDLINE_LINUX_DEFAULT=... in /etc/defaults/grub</p><p>After adding these parameters, I was able to passthrough the host primary graphics to qemu guest in the same way as i passthrough my secondary graphics.</p><p>Note that you will completely lose your host console when you do this, so make sure you can ssh in, and perhaps have a serial terminal ready as well.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507487">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507498" class="blockpost roweven"> <h2><span><span class="conr">#4362</span> <a href="viewtopic.php?pid=1507498#p1507498">2015-03-01 22:01:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=85314">Duelist</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-09-22</span></dd> <dd><span>Posts: 358</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>hurenkam wrote:</cite><blockquote><div><p>Note that you will completely lose your host console when you do this, so make sure you can ssh in, and perhaps have a serial terminal ready as well.</p></div></blockquote></div><p>You&#039;ve got a headless host?.. So you&#039;re doing GPU passthrough with only one GPU? Cool.</p> </div> <div class="postsignature postmsg"><hr /><p><span class="bbs">The forum rules prohibit requesting support for distributions other than arch.</span><br /><a href="https://bbs.archlinux.org/viewtopic.php?pid=1551460#p1551460" rel="nofollow">I gave up.</a><a href="https://bbs.archlinux.org/viewtopic.php?id=162768" rel="nofollow"> It was too late.</a><br /><a href="http://pastebin.com/B3fL84bq" rel="nofollow">What I was trying to do</a>.<br /><a href="http://vfio.blogspot.com/" rel="nofollow">The reference about VFIO and KVM VGA passthrough.</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507498">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507516" class="blockpost rowodd"> <h2><span><span class="conr">#4363</span> <a href="viewtopic.php?pid=1507516#p1507516">2015-03-01 22:48:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=66472">hurenkam</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-12-10</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=66472">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>hurenkam wrote:</cite><blockquote><div><p>Note that you will completely lose your host console when you do this, so make sure you can ssh in, and perhaps have a serial terminal ready as well.</p></div></blockquote></div><p>You&#039;ve got a headless host?.. So you&#039;re doing GPU passthrough with only one GPU? Cool.</p></div></blockquote></div><p>Actually, I&#039;m doing GPU passthrough with 3 GPU&#039;s, but indeed leaving the host headless:<br />- GPU1: Radeon HD6450; Passthrough to Windows 8 Guest<br />- GPU2: Radeon HD4350; Passthrough to OSX Mavericks Guest<br />- GPU3: Radeon HD4350; Passthrough to Arch Linux Guest</p><p>All this is on rather dated hardware (but since all is working fine, why bother to upgrade?):<br />- ASUS P7P55D EVO Mainboard<br />- Intel i7 860 CPU</p><p>This machine has been running Xen for several years, I&#039;ve only recently switched to qemu because i wanted to see how stable it runs with pci &amp; vga passthrough.<br />So far I have no regrets.</p> <p class="postedit"><em>Last edited by hurenkam (2015-03-01 23:05:57)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507516">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507530" class="blockpost roweven"> <h2><span><span class="conr">#4364</span> <a href="viewtopic.php?pid=1507530#p1507530">2015-03-02 00:04:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83959">Jodaco</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-30</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><div class="quotebox"><cite>JohnyPea wrote:</cite><blockquote><div><div class="quotebox"><cite>Jodaco wrote:</cite><blockquote><div><p>Has anyone else with an amd system done this with nbhs&#039; suggested option of disabling npt?&#160; I found that with it disabled it did improve my benchmark scores, doubled in some cases, and games hit higher framerates, but its not consistent.&#160; With npt=0 set cpu load is all over the damn place and framerates in games vary anywhere from 5 fps to 150fps.</p><p>I have an AMD 8320, Asus M5A99X EVO PRO r2.0 with the latest bios, 32 GB of ram, Geforce 660 ti for host, and a Geforce 970 on the guest.</p></div></blockquote></div><p> I am using npt=0. Have used npt=1&#160; for an extended period and performance was worse. The effect was that in some games the framerate was lower, but GPU and CPU loads were lower too and a bit more kernel time on host. npt=0 is generally much better. In both cases the machines are stable.</p></div></blockquote></div><p><a href="http://magazine.redhat.com/2007/11/20/red-hat-enterprise-linux-51-utilizes-nested-paging-on-amd-barcelona-processor-to-improve-performance-of-virtualized-guests/" rel="nofollow">http://magazine.redhat.com/2007/11/20/r … ed-guests/</a><br />That&#039;s ridiculous. Simply crazy. I don&#039;t get it.<br />How BROKEN NPT should be that it slows down the VM? And I&#039;ve been worrying about too big errata list on my CPU family.</p><p>EDIT:<br /><a href="http://www.cse.iitd.ernet.in/~sbansal/csl862-virt/2010/readings/NPT-WP-1%201-final-TM.pdf" rel="nofollow">http://www.cse.iitd.ernet.in/~sbansal/c … nal-TM.pdf</a><br />Oooh, nice document to read. I&#039;ll try reading this somewhere in future time.</p></div></blockquote></div><p>I gave up and I built a new intel machine, pretty costly decision but in the end it is well worth it. I have not installed a bare-metal version of windows on it to test, but performance in my games seems to work atleast as well as the AMD 8320 did on bare metal.&#160; I had an issue with this stock intel cooler running a little warm with Turbo Boost turned on in the UEFI and it started throttling the cpu back which destroyed vm performance.&#160; Once I turned that option off everything seems to run great. Using synergy to switch mouse and keyboard between host and guest and it works really well, I have played several hours of Battlefield 4.</p><p>Cpu: Core i7-4790k<br />Mobo: Gigabyte Z97X-U3H<br />Memory: Corsair Vengeance 32gb DDR3-1600<br />GPU: EVGA Geforce 970 and using intel graphics for host</p><p>Booting on Arch Linux in an uefi setup and also using ovmf from the extra repository in arch and it worked perfectly out of the box, just using qemu and passing command line options.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507530">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507595" class="blockpost rowodd"> <h2><span><span class="conr">#4365</span> <a href="viewtopic.php?pid=1507595#p1507595">2015-03-02 06:24:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=82442">slis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-06-02</span></dd> <dd><span>Posts: 125</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:xslisx@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 \</code></pre></div></div></blockquote></div><br /><p>PC is not 440fx... in my xml i got &quot;pc-i440fx-2.1&quot;, not sure if it&#039;s same for qemu command line, but pretty sure it&#039;s not PC.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507595">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507605" class="blockpost roweven"> <h2><span><span class="conr">#4366</span> <a href="viewtopic.php?pid=1507605#p1507605">2015-03-02 07:35:35</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>slis wrote:</cite><blockquote><div><div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 \</code></pre></div></div></blockquote></div><br /><p>PC is not 440fx... in my xml i got &quot;pc-i440fx-2.1&quot;, not sure if it&#039;s same for qemu command line, but pretty sure it&#039;s not PC.</p></div></blockquote></div><p>Pc is i440fx</p><div class="codebox"><pre class="vscroll"><code>[nbhs@virtbox ~]$ qemu-system-x86_64 -M ? Supported machines are: pc Standard PC (i440FX + PIIX, 1996) (alias of pc-i440fx-2.2) pc-i440fx-2.2 Standard PC (i440FX + PIIX, 1996) (default) pc-i440fx-2.1 Standard PC (i440FX + PIIX, 1996) pc-i440fx-2.0 Standard PC (i440FX + PIIX, 1996) pc-i440fx-1.7 Standard PC (i440FX + PIIX, 1996) pc-i440fx-1.6 Standard PC (i440FX + PIIX, 1996) pc-i440fx-1.5 Standard PC (i440FX + PIIX, 1996) pc-i440fx-1.4 Standard PC (i440FX + PIIX, 1996) pc-1.3 Standard PC (i440FX + PIIX, 1996) pc-1.2 Standard PC (i440FX + PIIX, 1996) pc-1.1 Standard PC (i440FX + PIIX, 1996) pc-1.0 Standard PC (i440FX + PIIX, 1996) pc-0.15 Standard PC (i440FX + PIIX, 1996) pc-0.14 Standard PC (i440FX + PIIX, 1996) pc-0.13 Standard PC (i440FX + PIIX, 1996) pc-0.12 Standard PC (i440FX + PIIX, 1996) pc-0.11 Standard PC (i440FX + PIIX, 1996) pc-0.10 Standard PC (i440FX + PIIX, 1996) q35 Standard PC (Q35 + ICH9, 2009) (alias of pc-q35-2.2) pc-q35-2.2 Standard PC (Q35 + ICH9, 2009) pc-q35-2.1 Standard PC (Q35 + ICH9, 2009) pc-q35-2.0 Standard PC (Q35 + ICH9, 2009) pc-q35-1.7 Standard PC (Q35 + ICH9, 2009) pc-q35-1.6 Standard PC (Q35 + ICH9, 2009) pc-q35-1.5 Standard PC (Q35 + ICH9, 2009) pc-q35-1.4 Standard PC (Q35 + ICH9, 2009) isapc ISA-only PC none empty machine</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507605">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507606" class="blockpost rowodd"> <h2><span><span class="conr">#4367</span> <a href="viewtopic.php?pid=1507606#p1507606">2015-03-02 07:39:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Is CONFIG_VFIO_PCI_VGA also set?</p><p>hv_time is incompatible with nvidia</p><p>Missing -vga none</p><p>Don&#039;t use q35</p></div></blockquote></div><p>Thanks for the fast replay.</p><p>1. CONFIG_VFIO_PCI_VGA=y is set by default. I double checked with my /boot/config-...<br />2. Removed hv_time.<br />3. Changed q35 to pc (as I understand this is the default).<br />4. I had to remove &quot;bus=pcie.0&quot; from ioh3420 line because of an error.<br />5. I had to use &quot;rombar=0&quot; or &quot;romfile=...&quot; when assigning my VGA.</p><p>So, my QEMU start line became:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 \ -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/media/.../GF114.rom \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi \ -drive file=/storage/vm/win7.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/media/.../win7.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/media/.../virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -vga none</code></pre></div><p>The results were the same for rombar/romfile:<br />1) VGA appears dead WITHOUT &quot;-vga none&quot;.<br />2) No output on the nVidia DVI ports WITH &quot;-vga none&quot;</p><p><strong>PS:</strong> Tried a few restarts. Also reinstalled the win7 vm.</p></div></blockquote></div><p>Why are you using -device ioh3420 with -M pc???</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507606">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507620" class="blockpost roweven"> <h2><span><span class="conr">#4368</span> <a href="viewtopic.php?pid=1507620#p1507620">2015-03-02 08:58:48</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Is CONFIG_VFIO_PCI_VGA also set?</p><p>hv_time is incompatible with nvidia</p><p>Missing -vga none</p><p>Don&#039;t use q35</p></div></blockquote></div><p>Thanks for the fast replay.</p><p>1. CONFIG_VFIO_PCI_VGA=y is set by default. I double checked with my /boot/config-...<br />2. Removed hv_time.<br />3. Changed q35 to pc (as I understand this is the default).<br />4. I had to remove &quot;bus=pcie.0&quot; from ioh3420 line because of an error.<br />5. I had to use &quot;rombar=0&quot; or &quot;romfile=...&quot; when assigning my VGA.</p><p>So, my QEMU start line became:</p><div class="codebox"><pre><code>sudo qemu-system-x86_64 -enable-kvm -M pc -m 4096 \ -cpu host,kvm=off -smp 2,sockets=1,cores=2,threads=1 \ -device ioh3420,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on,romfile=/media/.../GF114.rom \ -device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 -device virtio-scsi-pci,id=scsi \ -drive file=/storage/vm/win7.img,id=disk,format=raw,if=none -device scsi-hd,drive=disk \ -drive file=/media/.../win7.iso,id=isocd,if=none -device scsi-cd,drive=isocd \ -drive file=/media/.../virtio.iso,id=virtiocd,if=none -device ide-cd,bus=ide.1,drive=virtiocd \ -vga none</code></pre></div><p>The results were the same for rombar/romfile:<br />1) VGA appears dead WITHOUT &quot;-vga none&quot;.<br />2) No output on the nVidia DVI ports WITH &quot;-vga none&quot;</p><p><strong>PS:</strong> Tried a few restarts. Also reinstalled the win7 vm.</p></div></blockquote></div><br /><p>You are <strong>supposed</strong> to use &quot;-vga none&quot;, it&#039;s in the first post. That&#039;s the whole point of this thread, so you can use real GPU hardware as <strong>primary</strong> (and quite possibly, the only) VGA output in the guest VM. Also, if you do not use OVMF then you need to use x-vga=on parameter, so vfio knows to passthorugh VGA correctly. This &quot;x-vga=on&quot; is not needed if you do use OVMF because this standard (only possible for UEFI guests) has discarded the whole notion of &quot;primary VGA output&quot;. But in any case you do need &quot;-vga none&quot;.</p><p>If you start qemu <strong>without</strong> &quot;-vga none&quot; then emulated Cirrus becomes your primary VGA in guest and hardware GPU becomes secondary VGA, which you could do a long time ago in Xen and which is <strong>not</strong> what this thread is about.</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507620">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507622" class="blockpost rowodd"> <h2><span><span class="conr">#4369</span> <a href="viewtopic.php?pid=1507622#p1507622">2015-03-02 09:09:24</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><div class="quotebox"><cite>Tyrewt wrote:</cite><blockquote><div><p>Trying to do some USB passthough in my config with:</p><br /><br /><p>The camera (host:2672:000d) is seen by both the Host (Linux) and Guest (Windows7) when plugged in. Also, Windows fails to load a &quot;MTP Device Driver&quot;. I believe it has something to do with USB passthough, usb-mtp.&#160; Can&#039;t find much information on a fix. Please advise?</p></div></blockquote></div><p>I found that the best way for USB passthrough is to pass whole USB controller. You can do it also for USB controllers integrated into the south-bridge since they are attached to PCIe root like normal extension cards. This is useful for all types of USB devices because it basically removes USB root complex from host OS and also removes latency of USB serialisation through qemu. Also perfect for attaching things like USB-DAC for great quality sound.</p></div></blockquote></div><br /><br /><br /><p>So I followed your advice with no luck, maybe I should focus efforts on USB Device Pass-through as it seems get further with Ubuntu.</p><p>For the record, the three USB controllers were:</p><div class="quotebox"><blockquote><div><p>00:14.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB xHCI [8086:8c31] (rev 04)<br />00:1a.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #2 [8086:8c2d] (rev 04)<br />00:1d.0 USB controller [0c03]: Intel Corporation 8 Series/C220 Series Chipset Family USB EHCI #1 [8086:8c26] (rev 04)</p></div></blockquote></div><p>Added them to my /etc/vfio-pci.cfg</p><div class="quotebox"><blockquote><div><p>0000:00:14.0<br />0000:00:1a.0<br />0000:00:1d.0</p></div></blockquote></div><p>Then added the following lines to my qemu config</p><div class="quotebox"><blockquote><div><p>-usb \<br />-device vfio-pci,host=00:14.0 \<br />-device vfio-pci,host=00:1a.0 \<br />-device vfio-pci,host=00:1d.0 \</p></div></blockquote></div><br /><p>Starting the Virtual Machine fails at the first controller with the following error.</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64: -device vfio-pci,host=00:14.0: vfio: error opening /dev/vfio/4: No such file or directory<br />qemu-system-x86_64: -device vfio-pci,host=00:14.0: vfio: failed to get group 4<br />qemu-system-x86_64: -device vfio-pci,host=00:14.0: Device initialization failed.<br />qemu-system-x86_64: -device vfio-pci,host=00:14.0: Device &#039;vfio-pci&#039; could not be initialized</p></div></blockquote></div><p>Any suggestions?</p></div></blockquote></div><p>ok so you are trying to add three USB controller devices (1x USB 3.0 at 00:14.0 and 2x USD 2.0 at 00:1a.0,00:1d.0) . Apparently adding USB 3.0 controller fails, although we do not see anything about the other two USB 2.0 controllers. Did you ensure you are passing whole IOMMU group? Did you remember to add vendorid:deviceid to pci-stub.ids=... in kernel command line? Did you try passing only USB 2.0 devices? I assume your host was restarted to allow for vfio to claim these USB controllers?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507622">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507644" class="blockpost roweven"> <h2><span><span class="conr">#4370</span> <a href="viewtopic.php?pid=1507644#p1507644">2015-03-02 10:53:37</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89229">nalare</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-03-02</span></dd> <dd><span>Posts: 2</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>this topic has been one of the guides I&#039;ve followed to build my new rigg:</p><p>core i7 4790<br />asrock z97 extreme 4<br />32 gb ddr3 RAM 1600 kingston hyper x savage<br />crucial mx 256gb SSD<br />NIC Intel Gigabit CT Desktop Adapter PCI-e (EXPI9301CT 1000)<br />PSU corsair gold CS650M</p><p>+ 4tb iSCSI target -&gt;ZFS raid Z1 storage in a nas4free dedicated box (which I dont know if I should virtualize)</p><p>I&#039;ve also got an old asus geforce GTS250 and an older ati radeon x1500. I will use one of them for the host if I choose the XEN or KVM option.<br />I&#039;m also looking for a cheap hba SATA card for storage passthrough<br />and, of course, a new GPU. I will choose the gpu (probably an nvidia GPU, I don&#039;t like amd GPUs) when I decide which hypervisor is the best for my needs.</p><p>I&#039;m still trying to decide between vmware sphere, xen or KVM</p><p>My idea is to use a hypervisor for something like a Multi-headed Gaming Setup, plus a few more VMs:</p><p>-linux &quot;main&quot; VM -&gt; (office, video, websurfing, development...)<br />-windows server 2012 R2 VM -&gt; active directory, (perhaps vCenter Server if I choose the vmware way)<br />-windows 8.1 gaming VM<br />-NAS4free file server (a BSD distro used for file sharing)-&gt; I already use it as iSCSI target for VMware (or other hypervisor) in a dedicated old box, I&#039;d like to implement it as a VM as well in the same rigg<br />-windows 7 VM (for websurfing, software testing...).</p><p>obviously not all of them will be used at the same time, only the host, windows server 2012 r2, and the bsd NAS appliance (if I decide to virtualize my NAS dedicated box) will be plugged 24/7<br />Only the windows 8.1 gaming VM (one GPU) and perhaps the NAS appliance, if I decide to use it, will need PCI passthrough.</p><p>I&#039;ve read that the performance of them three is, nowadays, quite good in VGA passthrough, but I still don&#039;t know which of them (vmware sphere, xen or KVM) will fit my need, or is the best for my hardware/network.</p><p>I&#039;ve got a GBE network at home (controlled by an asus DSL-N16U modem-router), but many VMs will be used through wifi n300 or even n150. The most demanding VMs will be used through wired gigabite network (the main linux VM and the windows 8.1 gaming VM).</p><br /><p>KVM pros: I can use geforce cards for VGA passthrough, I can use a linux local host as my main as and as the hypervisor, all in one<br />KVM contras: I&#039;ve read it has the worst VGA passthrough support of the 3 hypervisors. It seems the most dificult to admin (no good GUIs). Constant changes of kernel, drivers, configs...</p><p>XEN pros: it seems it has a good performance in VGA passthrough, I can use a linux local host as my main as and as the hypervisor, all in one<br />XEN contras: no VGA passthrough support for geforce cards, it seems easier to config &amp; admin than KVM (but more difficult than vmware sphere for me)</p><p>VMware Sphere pros: people report it has a very good performance in VGA passthrough, and it&#039;s the hypervisor I&#039;ve used the most.<br />VMware Sphere contras: no support for geforce GPUs on passthough, only AMD or nvidia quadro cards (or modified geforces). And all the operating systems act as VMs, no &quot;usable&quot; local host like KVM or ZEN (dom0), -&gt; so one more VM that needs to be used through the home network from another computer.</p><br /><p>Any suggestion about which hypervisor should I use?</p><p>Any suggestion about a good+cheap nvidia GPU for passthrough?<br />or, if I choose vmware sphere or XEN, I will not spend my money in a multiOS quadro card, so perhaps I will choose an AMD gpu ..any suggestion? should be a cheap one, passthrogh capable, and not powerhungry (my PSU is &quot;only&quot; 650w, and if I have to choose an amd card for the windows 8.1 gaming VM, that card will have to be in the same motherboard with my power-hungry old asus nvidia geforce GTS250 used by the linux host).</p><p>Any suggestion for a good+cheap RAID sata card (i don&#039;t need SAS, and I don&#039;t need more than 4 SATA3 ports) passthrough capable to use it with a BSD based NAS distro?</p><p>thanks for any help</p><p>PD: sorry for my poor english</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507644">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507653" class="blockpost rowodd"> <h2><span><span class="conr">#4371</span> <a href="viewtopic.php?pid=1507653#p1507653">2015-03-02 11:31:22</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=83627">JohnyPea</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-07-17</span></dd> <dd><span>Posts: 17</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Duelist wrote:</cite><blockquote><div><p><a href="http://magazine.redhat.com/2007/11/20/red-hat-enterprise-linux-51-utilizes-nested-paging-on-amd-barcelona-processor-to-improve-performance-of-virtualized-guests/" rel="nofollow">http://magazine.redhat.com/2007/11/20/r … ed-guests/</a><br />That&#039;s ridiculous. Simply crazy. I don&#039;t get it.<br />How BROKEN NPT should be that it slows down the VM? And I&#039;ve been worrying about too big errata list on my CPU family.</p><p>EDIT:<br /><a href="http://www.cse.iitd.ernet.in/~sbansal/csl862-virt/2010/readings/NPT-WP-1%201-final-TM.pdf" rel="nofollow">http://www.cse.iitd.ernet.in/~sbansal/c … nal-TM.pdf</a><br />Oooh, nice document to read. I&#039;ll try reading this somewhere in future time.</p></div></blockquote></div><p>At first I thought that it should lower host virtualization overhead, therefore I tried using it. Something isn&#039;t probably working as expected? Thanks for the document, will take a look later.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507653">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507697" class="blockpost roweven"> <h2><span><span class="conr">#4372</span> <a href="viewtopic.php?pid=1507697#p1507697">2015-03-02 14:47:31</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89165">terusus</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-27</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89165">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Bronek wrote:</cite><blockquote><div><p>You are <strong>supposed</strong> to use &quot;-vga none&quot;, it&#039;s in the first post. That&#039;s the whole point of this thread, so you can use real GPU hardware as <strong>primary</strong> (and quite possibly, the only) VGA output in the guest VM. Also, if you do not use OVMF then you need to use x-vga=on parameter, so vfio knows to passthorugh VGA correctly. This &quot;x-vga=on&quot; is not needed if you do use OVMF because this standard (only possible for UEFI guests) has discarded the whole notion of &quot;primary VGA output&quot;. But in any case you do need &quot;-vga none&quot;.</p><p>If you start qemu <strong>without</strong> &quot;-vga none&quot; then emulated Cirrus becomes your primary VGA in guest and hardware GPU becomes secondary VGA, which you could do a long time ago in Xen and which is <strong>not</strong> what this thread is about.</p></div></blockquote></div><p>I understood that. But, the fact is that I do not get any graphical output from the VM with &quot;-vga none&quot;. Nothing on the DVI ports or when connecting with VNC.</p><p>(I am not using OVMF - I&#039;m testing with a win7 machine. I did run an OVMF win8 machine and did have &quot;x-vga=on&quot; + &quot;-vga none&quot; but the results were the same.)</p><p>And this is the strange thing for me:<br /> - I get no errors when starting the VM.<br /> - With standard VGA (without -vga none) I see my nVidia card in the VM. I even see the option to unplug the hardware from windows. Standard drivers run their checks and get installed successfully. And still nothing.</p><p>And obviously I got something wrong. However, I am really determined to get this working and I really appreciate your input. So, as I understand, if everything worked well I should have video output from the VM on nVidia DVI port and a monitor connected there should work normally? Do see any obvious mistakes that I have made?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507697">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507715" class="blockpost rowodd"> <h2><span><span class="conr">#4373</span> <a href="viewtopic.php?pid=1507715#p1507715">2015-03-02 15:57:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=79471">Bronek</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: London</span></dd> <dd><span>Registered: 2014-02-14</span></dd> <dd><span>Posts: 90</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=79471">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><p>I understood that. But, the fact is that I do not get any graphical output from the VM with &quot;-vga none&quot;. Nothing on the DVI ports or when connecting with VNC.</p><p>(I am not using OVMF - I&#039;m testing with a win7 machine. I did run an OVMF win8 machine and did have &quot;x-vga=on&quot; + &quot;-vga none&quot; but the results were the same.)</p><p>And this is the strange thing for me:<br /> - I get no errors when starting the VM.<br /> - With standard VGA (without -vga none) I see my nVidia card in the VM. I even see the option to unplug the hardware from windows. Standard drivers run their checks and get installed successfully. And still nothing.</p><p>And obviously I got something wrong. However, I am really determined to get this working and I really appreciate your input. So, as I understand, if everything worked well I should have video output from the VM on nVidia DVI port and a monitor connected there should work normally? Do see any obvious mistakes that I have made?</p></div></blockquote></div><p>are you able to verify that this card works at all, for bare metal configuration, when placed in the slot you try to use it in?</p> </div> <div class="postsignature postmsg"><hr /><p>Sorry about&#160; &quot;KVM VGA-Passthrough ...&quot; thread <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /> Anyone interested in continuing this discussion elsewhere, please contact me privately. I might be able to find it a new home.</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507715">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507720" class="blockpost roweven"> <h2><span><span class="conr">#4374</span> <a href="viewtopic.php?pid=1507720#p1507720">2015-03-02 16:13:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=89165">terusus</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2015-02-27</span></dd> <dd><span>Posts: 6</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=89165">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>@Bronek</p><p>Yes. When I installed Ubuntu I was using my nVidia card as a primary VGA. It was working with nouveau and with the proprietary nVidia drivers.</p><p>It worked fine on win7 too.</p><p>PS: I had to set the Intel IGP as a primary VGA in the bios in order to blacklist nouveau.</p> <p class="postedit"><em>Last edited by terusus (2015-03-02 16:14:41)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507720">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1507778" class="blockpost rowodd"> <h2><span><span class="conr">#4375</span> <a href="viewtopic.php?pid=1507778#p1507778">2015-03-02 19:43:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>terusus wrote:</cite><blockquote><div><div class="codebox"><pre class="vscroll"><code>[ 2.529105] vboxdrv: module verification failed: signature and/or required key missing - tainting kernel [ 2.531134] vboxdrv: Found 4 processor cores. [ 2.531464] vboxdrv: fAsync=0 offMin=0x1df offMax=0xe1d [ 2.531510] vboxdrv: TSC mode is &#039;synchronous&#039;, kernel timer mode is &#039;normal&#039;. [ 2.531511] vboxdrv: Successfully loaded version 4.3.18_Ubuntu (interface 0x001a0008). [ 2.539538] vboxpci: IOMMU found [ 2.692404] ------------[ cut here ]------------ [ 2.692446] WARNING: CPU: 3 PID: 599 at /home/terusus/ubuntu-vivid/source/drivers/gpu/drm/i915/intel_display.c:9705 intel_check_page_flip+0xa2/0xf0 [i915]() [ 2.692447] WARN_ON(!in_irq()) [ 2.692448] Modules linked in: [ 2.692449] pci_stub vboxpci(OE) vboxnetadp(OE) vboxnetflt(OE) vboxdrv(OE) hid_generic snd_hda_codec_realtek snd_hda_codec_generic snd_hda_codec_hdmi snd_usb_audio(+) snd_usbmidi_lib uvcvideo dm_multipath videobuf2_vmalloc scsi_dh intel_rapl videobuf2_memops videobuf2_core v4l2_common iosf_mbi videodev x86_pkg_temp_thermal media usbhid intel_powerclamp snd_hda_intel kvm_intel snd_hda_controller hid snd_hda_codec snd_hwdep kvm snd_pcm crct10dif_pclmul crc32_pclmul snd_seq_midi ghash_clmulni_intel snd_seq_midi_event aesni_intel snd_rawmidi aes_x86_64 lrw gf128mul glue_helper snd_seq ablk_helper cryptd snd_seq_device snd_timer serio_raw i915 snd drm_kms_helper drm lpc_ich mei_me shpchp soundcore mei i2c_algo_bit 8250_fintek nuvoton_cir rc_core bnep rfcomm video soc_button_array mac_hid bluetooth binfmt_misc [ 2.692469] parport_pc ppdev lp parport nct6775 hwmon_vid coretemp btrfs xor raid6_pq e1000e ahci psmouse ptp libahci pps_core [ 2.692476] CPU: 3 PID: 599 Comm: irq/31-i915 Tainted: G OE 3.19.0-6-kvm #6 [ 2.692476] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./H87 Pro4, BIOS P2.10 07/09/2014 [ 2.692477] ffffffffc07661b8 ffff880419b93c98 ffffffff817c6613 0000000000000007 [ 2.692479] ffff880419b93ce8 ffff880419b93cd8 ffffffff8107732a ffff880419b93cd8 [ 2.692480] ffff8804186e3000 ffff880419b88800 ffff880419b88800 0000000000000000 [ 2.692481] Call Trace: [ 2.692496] [&lt;ffffffff817c6613&gt;] dump_stack+0x4c/0x6e [ 2.692499] [&lt;ffffffff8107732a&gt;] warn_slowpath_common+0x8a/0xc0 [ 2.692501] [&lt;ffffffff810773a6&gt;] warn_slowpath_fmt+0x46/0x50 [ 2.692510] [&lt;ffffffffc07111a2&gt;] intel_check_page_flip+0xa2/0xf0 [i915] [ 2.692518] [&lt;ffffffffc06de277&gt;] ironlake_irq_handler+0x417/0x1000 [i915] [ 2.692521] [&lt;ffffffff8109bc4d&gt;] ? finish_task_switch+0x5d/0x100 [ 2.692523] [&lt;ffffffff810d0340&gt;] ? irq_thread_fn+0x50/0x50 [ 2.692525] [&lt;ffffffff810d036d&gt;] irq_forced_thread_fn+0x2d/0x70 [ 2.692526] [&lt;ffffffff810d08b7&gt;] irq_thread+0x137/0x160 [ 2.692527] [&lt;ffffffff810d03e0&gt;] ? wake_threads_waitq+0x30/0x30 [ 2.692529] [&lt;ffffffff810d0780&gt;] ? irq_thread_check_affinity+0x90/0x90 [ 2.692531] [&lt;ffffffff810961eb&gt;] kthread+0xdb/0x100 [ 2.692541] [&lt;ffffffff81096110&gt;] ? kthread_create_on_node+0x1c0/0x1c0 [ 2.692543] [&lt;ffffffff817cd5bc&gt;] ret_from_fork+0x7c/0xb0 [ 2.692545] [&lt;ffffffff81096110&gt;] ? kthread_create_on_node+0x1c0/0x1c0 [ 2.692546] ---[ end trace 3bc57ae31fe4d29b ]---</code></pre></div></div></blockquote></div><p>This doesn&#039;t look very healthy.&#160; Get rid of those vbox drivers, we have no idea what they&#039;re doing and competing hypervisors often don&#039;t get along so well with each other.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1507778">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=174">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=173">173</a> <a href="viewtopic.php?id=162768&amp;p=174">174</a> <strong>175</strong> <a href="viewtopic.php?id=162768&amp;p=176">176</a> <a href="viewtopic.php?id=162768&amp;p=177">177</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=176">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
