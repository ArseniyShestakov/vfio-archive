<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 23) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=23" title="Page 23" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=22" title="Page 22" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=24" title="Page 24" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=22">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <strong>23</strong> <a href="viewtopic.php?id=162768&amp;p=24">24</a> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=24">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1335650" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#551</span> <a href="viewtopic.php?pid=1335650#p1335650">2013-10-10 13:37:44</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>I now got an Windows installation running but cant install the driver for the 6450 on the guest. When I use the installer I get a BSOD and if i try to use Windows` driver update functionality it detects the GPU but says &quot;Failed to read from device&quot;...</p></div></blockquote></div><p>I moved my 7850 to a different system the other day and hit a BSOD about failing to reset the adapter.&#160; I had to revert to Catalyst 13.4 to get it working.&#160; Catalyst 13.9 was the broken version.&#160; Maybe someone could find 13.5,.6,.7,.8 and figure out which one introduced the break.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335650">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335653" class="blockpost roweven"> <h2><span><span class="conr">#552</span> <a href="viewtopic.php?pid=1335653#p1335653">2013-10-10 13:46:40</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>nbhs wrote:</cite><blockquote><div><p>I&#039;ve uploaded new builds for kernel 3.12-rc4, qemu-git + alex patches, and the lastest seabios, all working fine on my pc, ive also cleaned up the guide a bit to reflect the lastest changes</p></div></blockquote></div><p>It hasn&#039;t landed yet, but we&#039;re about to experience a regression in VGA arbiter support for i915.&#160; Apparently making i915 work correctly with the arbiter results in too much of a performance hit for X.&#160; Once 81b5c7bc8de3e6f63419139c2fc91bf81dea8a7d is reverted, IGD will claim all VGA accesses when i915 is loaded on the host.&#160; So, sorry folks, if you have IGD you&#039;ll soon need to patch your kernel again.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335653">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335663" class="blockpost rowodd"> <h2><span><span class="conr">#553</span> <a href="viewtopic.php?pid=1335663#p1335663">2013-10-10 14:16:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>I now got an Windows installation running but cant install the driver for the 6450 on the guest. When I use the installer I get a BSOD and if i try to use Windows` driver update functionality it detects the GPU but says &quot;Failed to read from device&quot;...</p></div></blockquote></div><p>I moved my 7850 to a different system the other day and hit a BSOD about failing to reset the adapter.&#160; I had to revert to Catalyst 13.4 to get it working.&#160; Catalyst 13.9 was the broken version.&#160; Maybe someone could find 13.5,.6,.7,.8 and figure out which one introduced the break.</p></div></blockquote></div><p>Maybe those were internal releases, 13.4 and 13.9 seems to be the best granularity we have from AMD.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335663">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335743" class="blockpost roweven"> <h2><span><span class="conr">#554</span> <a href="viewtopic.php?pid=1335743#p1335743">2013-10-10 17:49:33</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><div class="quotebox"><cite>SpacePirate wrote:</cite><blockquote><div><p>I now got an Windows installation running but cant install the driver for the 6450 on the guest. When I use the installer I get a BSOD and if i try to use Windows` driver update functionality it detects the GPU but says &quot;Failed to read from device&quot;...</p></div></blockquote></div><p>I moved my 7850 to a different system the other day and hit a BSOD about failing to reset the adapter.&#160; I had to revert to Catalyst 13.4 to get it working.&#160; Catalyst 13.9 was the broken version.&#160; Maybe someone could find 13.5,.6,.7,.8 and figure out which one introduced the break.</p></div></blockquote></div><p>That didnt work for me. I`ve tried to use Catalyst 13.4, still a BSOD when installing the driver and the &quot;Failed to read from device&quot; error.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335743">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1335946" class="blockpost rowodd"> <h2><span><span class="conr">#555</span> <a href="viewtopic.php?pid=1335946#p1335946">2013-10-11 03:56:08</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75627">tarcisioe</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-06</span></dd> <dd><span>Posts: 5</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75627">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>You should have a lot more output than that, for example:</p><p>(...)</p></div></blockquote></div><p>Now that seems bad. Wonder if I am missing some software configuration, something in my kernel, or am just stuck with a motherboard that just claims to be VT-d compatible.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1335946">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1336581" class="blockpost roweven"> <h2><span><span class="conr">#556</span> <a href="viewtopic.php?pid=1336581#p1336581">2013-10-12 19:47:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72338">empie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: The Netherlands</span></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi,</p><p>First post here.<br />I&#039;ve been following this great topic for a while now and finally had the time to set up a system to play with GPU passthrough again (tried it with Xen before, with mixed results). <br />I do run into some issues though. When using the vfio-bind script a Call Trace is displayed on screen and in dmesg. This doesn&#039;t look good to me, but don&#039;t know if I can ignore it. Also, when ignoring the call trace and starting qemu to start installing Windows 7 Home Premium SP1 64 bit, a BSOD appeared. </p><p>Compiled kernel 3.12-rc4 with necessary config items, checked dmesg and iommu_groups, blacklisted device drivers, checked BDFs and device id&#039;s, set up kernel parameter with pci-stub, compiled Alex&#039; qemu-vfio with the NoSnoop patch, compiled latest seabios. Kernel, qemu-vfio and seabios were compiled from source. The .config for the kernel is based on the one from Debian (3.2.0-4-amd64).<br />As far as I can tell I did all the necessary steps described here, but might have missed or misunderstood something. If more information is required, please ask. Have logged nearly everything I did. Hope someone can help me out.</p><br /><p>System specs:<br />Motherboard: ASRock Z77 WS , BIOS v1.20 , VT-d enabled in BIOS<br />CPU: Intel i7 3770<br />Memory: 16 GB<br />GPU1: Sapphire AMD/ATI HD6870 1GB<br />GPU2: Asus GTX460 1GB</p><p>Intel GPU is set as primary graphics adapter.</p><p>The OS is Debian 7, minimal net-install without a GUI, only SSH and basic system tools options selected. Some extra packages installed for compiling etc.<br />I manage this system with SSH from another system (Win7/putty). </p><p>Kernel line in grub.cfg:</p><div class="quotebox"><blockquote><div><p>linux&#160; &#160;/boot/vmlinuz-3.12.0-rc4-kvm-vfio-gpu01 root=/dev/mapper/vg00-root ro pci-stub.ids=1002:6738,1002:aa88,10de:0e22,10de:0beb,8086:1e2d</p></div></blockquote></div><p>The id&#039;s are for the HD6870 + audio, GTX460 + audio and an USB 2.0 controller; in that order.</p><p>When starting the vfio-bind script (from this topic, without &quot;modprobe vfio-pci&quot; since it is compiled in the kernel), I get a Call Trace on my console and in dmesg when running:<br /># vfio-bind 0000:04:00.0 0000:04:00.1 0000:00:1a.0</p><div class="quotebox"><blockquote><div><p>[13211.267950] pcie_pme 0000:00:01.0:pcie01: unloading service driver pcie_pme<br />[13211.268146] ------------[ cut here ]------------<br />[13211.268165] WARNING: CPU: 0 PID: 19356 at drivers/pci/pci.c:1430 pci_disable_device+0x4d/0x74()<br />[13211.268183] Device pcieport<br />[13211.268183] disabling already-disabled device<br />[13211.268195] Modules linked in: autofs4 hid_generic usbhid hid nfsd auth_rpcgss oid_registry nfs_acl nfs lockd fscache sunrpc loop x86_pkg_temp_thermal coretemp iTCO_wdt iTCO_vendor_support crc32c_intel ghash_clmulni_intel aesni_intel aes_x86_64 ablk_helper cryptd lrw gf128mul glue_helper mxm_wmi evdev snd_pcm snd_page_alloc snd_timer snd psmouse soundcore microcode serio_raw pcspkr i2c_i801 i2c_core lpc_ich mfd_core ehci_pci ehci_hcd wmi video acpi_cpufreq button processor thermal_sys ext4 crc16 jbd2 mbcache dm_mod sg sd_mod sr_mod crc_t10dif cdrom crct10dif_common ahci tg3 libahci libata ptp pps_core libphy scsi_mod xhci_hcd usbcore usb_common<br />[13211.268387] CPU: 0 PID: 19356 Comm: vfio-bind Not tainted 3.12.0-rc4-kvm-vfio-gpu01 #1<br />[13211.268404] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./Z77 WS, BIOS P1.20 08/13/2012<br />[13211.268422]&#160; 0000000000000000 0000000000000009 ffffffff813b19a1 ffff8800ace7dda8<br />[13211.268455]&#160; ffffffff810693c7 ffff88042bc4c6c0 ffffffff81217da3 ffffffff81664bf8<br />[13211.268498]&#160; ffff88042eb96000 ffffffff81664b90 ffff88042eb96000 ffffffff81664bf8<br />[13211.268541] Call Trace:<br />[13211.268564]&#160; [&lt;ffffffff813b19a1&gt;] ? dump_stack+0x41/0x51<br />[13211.268590]&#160; [&lt;ffffffff810693c7&gt;] ? warn_slowpath_common+0x78/0x90<br />[13211.268616]&#160; [&lt;ffffffff81217da3&gt;] ? pci_disable_device+0x4d/0x74<br />[13211.268642]&#160; [&lt;ffffffff81069477&gt;] ? warn_slowpath_fmt+0x45/0x4a<br />[13211.268668]&#160; [&lt;ffffffff81217d50&gt;] ? do_pci_disable_device+0x41/0x47<br />[13211.268694]&#160; [&lt;ffffffff81217da3&gt;] ? pci_disable_device+0x4d/0x74<br />[13211.268722]&#160; [&lt;ffffffff8121a44e&gt;] ? pci_device_remove+0x38/0x83<br />[13211.268750]&#160; [&lt;ffffffff812a879f&gt;] ? __device_release_driver+0x82/0xdb<br />[13211.268778]&#160; [&lt;ffffffff812a8a3f&gt;] ? device_release_driver+0x1a/0x25<br />[13211.268805]&#160; [&lt;ffffffff812a7eb0&gt;] ? unbind_store+0x59/0x89<br />[13211.268832]&#160; [&lt;ffffffff8118e435&gt;] ? sysfs_write_file+0xd3/0x109<br />[13211.268859]&#160; [&lt;ffffffff811395f6&gt;] ? vfs_write+0x9e/0x104<br />[13211.268883]&#160; [&lt;ffffffff811398ed&gt;] ? SyS_write+0x51/0x85<br />[13211.268910]&#160; [&lt;ffffffff813ba8e2&gt;] ? system_call_fastpath+0x16/0x1b<br />[13211.268935] ---[ end trace 1209721fe0f238ac ]---</p></div></blockquote></div><p>0000:04:00.0 and 0000:04:00.1 is a GTX460 as second GPU + audio<br />0000:00:1a.0 is the USB 2.0 controller<br />When using the script with the HD6870 after a reboot, it results in the same Call Trace.<br />When executing the script a second time after the Call Trace, it doesn&#039;t give the Call Trace again.</p><br /><p>Ignoring the Call Trace and trying to execute qemu results in Windows booting up but gives a BSOD when the animated Windows logo appears:<br />1. &quot;Windows is loading files&quot; appears<br />2. &quot;Windows is starting&quot;, where the animated Windows logo should appear and then,<br />3. BSOD with PAGE_FAULT_IN_NONPAGED_AREA and STOP error 0x00000050</p><p>Qemu command line:</p><div class="quotebox"><blockquote><div><p>/usr/local/bin/qemu-system-x86_64 -enable-kvm -M q35 -m 2048 -cpu host -nographic \<br />-smp 2,sockets=1,cores=2,threads=1 -bios /usr/local/bin/bios.bin -vga none \<br />-device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \<br />-device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \<br />-device vfio-pci,host=04:00.1,bus=root.1,addr=00.1 \<br />-device vfio-pci,host=00:1a.0,bus=pcie.0 \<br />-device ahci,bus=pcie.0,id=ahci \<br />-drive file=/dev/vg00/win7gtx460.1,cache=none,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk \<br />-drive file=/data/win7hp-sp1-x64.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd \<br />-boot dc</p></div></blockquote></div><p>Also disabled Intel GPU in BIOS, but that didn&#039;t help.</p><p>Thanks in advance.</p><br /><p>----</p><p>Other things I noticed: <br />1. With the NoSnoop patch I <strong>don&#039;t</strong> get the following message anymore on my Nvidia GPU:</p><div class="quotebox"><blockquote><div><p>qemu-system-x86_64: -device vfio-pci,host=04:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on: Warning, device 0000:04:00.0 does not support reset<br />qemu-system-x86_64: -device vfio-pci,host=04:00.1,bus=root.1,addr=00.1: Warning, device 0000:04:00.1 does not support reset</p></div></blockquote></div><p>2. When compiling Alex&#039; qemu-vfio I got an error:<br />ERROR: DTC not present<br />After installing libfdt-dev that error went away and I was able to compile.</p><p>3. When starting qemu without disks (like the command line above, but without the last three lines), it stays in the seabios screen because it has nothing to boot from. This looks logical to me.<br />But when a logical volume is mounted (as I did), it displays a message on the seabios screen:<br />[ 1033.718172] EXT4-fs (dm-2): mounted filesystem with ordered data mode. Opts: (null)<br />I was under the assumption the VM &#039;owns&#039; the display and that no OS messages should be displayed there. Maybe it&#039;s because &quot;quiet&quot; was removed from the kernel line in grub.cfg .<br />This could also been seen in the BSOD screen, but in that case, the screen went up one line and nothing was printed. Didn&#039;t look any further into it.</p> <p class="postedit"><em>Last edited by empie (2013-10-12 22:11:44)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1336581">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1336585" class="blockpost rowodd"> <h2><span><span class="conr">#557</span> <a href="viewtopic.php?pid=1336585#p1336585">2013-10-12 20:03:59</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I&#039;m too lazy to try to quote the above, so...</p><p>The vfio-bind script in this thread is broken, it should not be unbinding devices bound to pcieport.&#160; I can imagine a number of people could be having problems just due to this.&#160; The report above shows a backtrace from pci_disable_device() from this.&#160; We absolutely do not want root ports to be disabled.&#160; Leave them bound to pcieport.&#160; vfio-pci will let you do this.</p><p>BSOD - I&#039;m noticing this too and it seems to be something broken in latest qemu/kvm when using &quot;-cpu host&quot;.&#160; Try dropping this parameter and just use the QEMU CPU type.</p><p>If you get host console messages out to the assigned graphics device, it&#039;s because the console driver you&#039;re using on the host doesn&#039;t make use of the VGA arbiter.&#160; vgacon for example is this way.&#160; It writes to VGA no matter where it&#039;s routed.&#160; The device specific drivers generally do make use of the VGA arbiter, but it can be hit or miss there too.&#160; With an i7 I assume your host VGA is IGD, so you should be using the i915 drivers, which as of v3.12-rc4 still uses the VGA arbiter correctly, but see a bit back in the thread about how that&#039;s soon to change.</p><p>The &quot;does not support reset&quot; messages are gone.&#160; This is part of the new bus reset interface in v3.12.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1336585">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1336595" class="blockpost roweven"> <h2><span><span class="conr">#558</span> <a href="viewtopic.php?pid=1336595#p1336595">2013-10-12 20:25:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72338">empie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: The Netherlands</span></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hi Alex,<br />Will look into the vfio-bind script and qemu cpu type tomorrow. VGA arbiter is new to me, will take a look at that also.<br />I did blacklist the i915 driver. Will &#039;whitelist&#039; i915 again.<br />Will post my progress here.<br />Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1336595">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1336997" class="blockpost rowodd"> <h2><span><span class="conr">#559</span> <a href="viewtopic.php?pid=1336997#p1336997">2013-10-13 19:57:16</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75819">alphahere</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75819">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Never could get xen working. Thanks to everyone that got this working and the excellent instructions. I spent about two weeks trying this new method for pass through with no luck but with the latest patches recently posted vfio vga-passthrough works perfectly. After reading all the horror stories about ASUS motherboards I thought that I may have a motherboard with a broken bios but apparently ASUS Z87 Pro has a working vt-d option with lastest bios. </p><p>ASUS Z87 Pro MotherBoard Bios Version 1405<br />Intel iGPU primary display<br />ASUS Radeon HD 6450 --&gt; vga passthrough on VM. Also a nice bonus is<br />the HDMI audio on the HD 6450 is working great also.</p><p>HD 6450 works perfectly with AMD Catalyst 13.11 beta 10/08/2013 release.</p><p>Only problem is USB and this is off topic, I don&#039;t understand the new USB syntax for qemu. Could someone kindly update the examples for using USB in the first post because those examples don&#039;t work with qemu-git version? I have tried passing the usb devices to the VM but this does not work. I had to passthrough the whole USB device but still can&#039;t get USB hotplugging to work. Anyone have some updated examples using USB and USB hotplugging?</p><p>Lastly what about the iGPU patch for intel iGPU, when should be apply it and what will happen if it is not applied after the patch discussed previously is reverted?</p><p>Thanks ;-)</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1336997">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337012" class="blockpost roweven"> <h2><span><span class="conr">#560</span> <a href="viewtopic.php?pid=1337012#p1337012">2013-10-13 20:15:09</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alphahere wrote:</cite><blockquote><div><p>Never could get xen working. Thanks to everyone that got this working and the excellent instructions. I spent about two weeks trying this new method for pass through with no luck but with the latest patches recently posted vfio vga-passthrough works perfectly. After reading all the horror stories about ASUS motherboards I thought that I may have a motherboard with a broken bios but apparently ASUS Z87 Pro has a working vt-d option with lastest bios. </p><p>ASUS Z87 Pro MotherBoard Bios Version 1405<br />Intel iGPU primary display<br />ASUS Radeon HD 6450 --&gt; vga passthrough on VM. Also a nice bonus is<br />the HDMI audio on the HD 6450 is working great also.</p><p>HD 6450 works perfectly with AMD Catalyst 13.11 beta 10/08/2013 release.</p></div></blockquote></div><p>Awesome, great to have success reports!</p><div class="quotebox"><cite>alphahere wrote:</cite><blockquote><div><p>Only problem is USB and this is off topic, I don&#039;t understand the new USB syntax for qemu. Could someone kindly update the examples for using USB in the first post because those examples don&#039;t work with qemu-git version? I have tried passing the usb devices to the VM but this does not work. I had to passthrough the whole USB device but still can&#039;t get USB hotplugging to work. Anyone have some updated examples using USB and USB hotplugging?</p></div></blockquote></div><p>I usually just pass through specific devices using something like:</p><p>-device usb-host,hostbus=3,hostaddr=3</p><p>This does not support hotplug.&#160; If you use vfio-pci to attach the USB devices, hotplug should work.&#160; I&#039;d recommend assigning the whole devices, ie. one full set of OHCI/UHCI functions and EHCI functions, mirroring the function layout of the host system.</p><div class="quotebox"><cite>alphahere wrote:</cite><blockquote><div><p>Lastly what about the iGPU patch for intel iGPU, when should be apply it and what will happen if it is not applied after the patch discussed previously is reverted?</p><p>Thanks ;-)</p></div></blockquote></div><p>The revert will be in v3.12-rc5, it went in on Friday.&#160; To restore behavior reapply 81b5c7bc8de3e6f63419139c2fc91bf81dea8a7d and 6e1b4fdad5157bb9e88777d525704aba24389bee.&#160; Something like &#039;git show 81b5c7bc | patch -p1&#039; should do it.</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337012">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337037" class="blockpost rowodd"> <h2><span><span class="conr">#561</span> <a href="viewtopic.php?pid=1337037#p1337037">2013-10-13 20:44:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72338">empie</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>From: The Netherlands</span></dd> <dd><span>Registered: 2013-06-15</span></dd> <dd><span>Posts: 9</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Got i915 out of the blacklist and got no more OS messages in seabios and BSOD screen.<br />Took a look into vfio-bind script. Looks like it wants to unbind/bind all the other ID&#039;s in /sys/bus/pci/devices/0000\:04\:00.0/iommu_group/devices/. Now using only echo statements for the specific ID&#039;s. No more Call Trace.<br />Replacing -cpu host with -cpu SandyBridge got the VM started.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337037">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337055" class="blockpost roweven"> <h2><span><span class="conr">#562</span> <a href="viewtopic.php?pid=1337055#p1337055">2013-10-13 21:12:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Has anyone experienced this behaviour?</p><p>I tried to add the devices now manually to the vfio-pci driver, as shown in the vfio documentation.<br />I dont get the vfio-pci warning anymore, but this in dmesg:</p><div class="codebox"><pre><code>[ 1344.776333] pcieport 0000:00:15.0: driver skip pci_set_master, fix it! [ 1344.776340] vfio-pci 0000:06:00.0: enabling device (0000 -&gt; 0003) [ 1344.846595] vfio-pci 0000:06:00.1: enabling device (0000 -&gt; 0002)</code></pre></div><p>When i turn on the VM my screen goes black, when switching to tty2 and back again everything works fine again. except that i dont get any output on the screen attached to the passed-through GPU.<br />I cant seem to get any progress on that, any ideas?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337055">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337065" class="blockpost rowodd"> <h2><span><span class="conr">#563</span> <a href="viewtopic.php?pid=1337065#p1337065">2013-10-13 21:29:26</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alphahere wrote:</cite><blockquote><div><p>Only problem is USB and this is off topic, I don&#039;t understand the new USB syntax for qemu. Could someone kindly update the examples for using USB in the first post because those examples don&#039;t work with qemu-git version? I have tried passing the usb devices to the VM but this does not work. I had to passthrough the whole USB device but still can&#039;t get USB hotplugging to work. Anyone have some updated examples using USB and USB hotplugging?</p></div></blockquote></div><p>Works for me using qemu-git.</p><p>This is how i do it:</p><p>lsusb</p><div class="codebox"><pre><code>Bus 007 Device 002: ID 1532:0039 Razer USA, Ltd </code></pre></div><p>then i add this line to qemu</p><div class="codebox"><pre><code>-usb -usbdevice host:1532:0039</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337065">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337071" class="blockpost roweven"> <h2><span><span class="conr">#564</span> <a href="viewtopic.php?pid=1337071#p1337071">2013-10-13 21:40:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=70922">nbhs</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd class="postavatar"><img src="https://bbs.archlinux.org/img/avatars/70922.jpg?m=1367773811" width="80" height="80" alt="" /></dd> <dd><span>From: Montevideo, Uruguay</span></dd> <dd><span>Registered: 2013-05-02</span></dd> <dd><span>Posts: 402</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>The vfio-bind script in this thread is broken, it should not be unbinding devices bound to pcieport.</p></div></blockquote></div><div class="quotebox"><cite>empie wrote:</cite><blockquote><div><p>Got i915 out of the blacklist and got no more OS messages in seabios and BSOD screen.<br />Took a look into vfio-bind script. Looks like it wants to unbind/bind all the other ID&#039;s in /sys/bus/pci/devices/0000\:04\:00.0/iommu_group/devices/. Now using only echo statements for the specific ID&#039;s. No more Call Trace.</p></div></blockquote></div><p>I fixed this on the first post, thanks</p> <p class="postedit"><em>Last edited by nbhs (2013-10-13 21:50:27)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337071">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337135" class="blockpost rowodd"> <h2><span><span class="conr">#565</span> <a href="viewtopic.php?pid=1337135#p1337135">2013-10-14 00:18:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75819">alphahere</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75819">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Oops!!</p><p>USB problem was my fault. Sorry about that post. I went back and started checking everything again. </p><p>Forgot to compile USB support in qemu.&#160; I setup a test&#160; system to try this out and forgot to install libusb. Stupid mistake. Whatever. </p><p>ERROR: User requested feature libusb<br />&#160; &#160; &#160; &#160;configure was not able to find it</p><p>Thanks!</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337135">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337187" class="blockpost roweven"> <h2><span><span class="conr">#566</span> <a href="viewtopic.php?pid=1337187#p1337187">2013-10-14 02:56:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75819">alphahere</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-12</span></dd> <dd><span>Posts: 7</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75819">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After the compiling USB support in qemu. I started getting BSOD in windows. I decided to go back and double check everything. I tested the following changes three times to verify the causes of the BSOD. </p><p>After compiling USB support in qemu immediately had BSOD with &quot;-cpu host&quot; and changing this option to &quot;-cpu qemu64&quot; stopped the BSOD.</p><p>Another BSOD was caused by the following line to enable hdmi audio on the radeon video card. <br />-device vfio-pci,host=01:00.1,bus=root.1,addr=00.1 </p><p>Changed to the following and sound is working great again without BSOD. <br />-device vfio-pci,host=01:00.1,bus=pcie.0 </p><p>Hope this helps someone.</p> <p class="postedit"><em>Last edited by alphahere (2013-10-14 04:42:49)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337187">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337620" class="blockpost rowodd"> <h2><span><span class="conr">#567</span> <a href="viewtopic.php?pid=1337620#p1337620">2013-10-15 06:50:36</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>So, I&#039;m wanting to get this set up on my rig, but I have an unlocked ivy bridge i5 which doesn&#039;t support vt-d, and I have an asus motherboard which isn&#039;t supported by linux at all, so I&#039;m going to have to get a new mobo and a new cpu. So first off my question is, should I be looking to go for haswell, or should I stick with ivy bridge or even go for a sandy bridge? which is best supported? Also I need the most powerful cpu that I can get because I also play ps2 games and gc/wii games in an emulator (which is why i got the unlocked cpu to begin with).</p><p>So I&#039;m thinking I&#039;ll go for an i7 haswell or an i7 ivy bridge basic.</p><br /><p>Anyways I have a few other questions aswell. Do you need to have a seperate keyboard for the vm or can you just seemlessly run through the 2 vm&#039;s using the same keyboard/mouse?</p><br /><p>And I only have 1 screen as of right now. Is it possible to have the vm output video through the dom0&#039;s graphics card but use the domu card for the processing? Or is there a practical way to vnc or something of the like so that you can have a single monitor setup?</p><p>For my graphics cards I&#039;m going to be using an nvidia gtx580 and a fairly new radeon graphics card. the nvidia card is the better card so I would prefer to have that running in the domu and the radeon running in the dom0, but would it be better to have it running the other way around? sorry for the scrub questions, but I just want to get some answers before i start sinking cash into this.</p><p>also what z77 mobo&#039;s do you guys recommend? and how much power should my psu be able to put out to support this system?</p><p>edit: also can you control the audio of the vm via pulse audio volume control? Currently I&#039;m controling the volume of all my software using that.</p> <p class="postedit"><em>Last edited by risho (2013-10-15 08:48:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337620">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337653" class="blockpost roweven"> <h2><span><span class="conr">#568</span> <a href="viewtopic.php?pid=1337653#p1337653">2013-10-15 09:15:30</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>So, I&#039;m wanting to get this set up on my rig, but I have an unlocked ivy bridge i5 which doesn&#039;t support vt-d, and I have an asus motherboard which isn&#039;t supported by linux at all, so I&#039;m going to have to get a new mobo and a new cpu. So first off my question is, should I be looking to go for haswell, or should I stick with ivy bridge or even go for a sandy bridge? which is best supported? Also I need the most powerful cpu that I can get because I also play ps2 games and gc/wii games in an emulator (which is why i got the unlocked cpu to begin with).</p><p>So I&#039;m thinking I&#039;ll go for an i7 haswell or an i7 ivy bridge basic.</p><br /><p>Anyways I have a few other questions aswell. Do you need to have a seperate keyboard for the vm or can you just seemlessly run through the 2 vm&#039;s using the same keyboard/mouse?</p><br /><p>And I only have 1 screen as of right now. Is it possible to have the vm output video through the dom0&#039;s graphics card but use the domu card for the processing? Or is there a practical way to vnc or something of the like so that you can have a single monitor setup?</p><p>For my graphics cards I&#039;m going to be using an nvidia gtx580 and a fairly new radeon graphics card. the nvidia card is the better card so I would prefer to have that running in the domu and the radeon running in the dom0, but would it be better to have it running the other way around? sorry for the scrub questions, but I just want to get some answers before i start sinking cash into this.</p><p>also what z77 mobo&#039;s do you guys recommend? and how much power should my psu be able to put out to support this system?</p><p>edit: also can you control the audio of the vm via pulse audio volume control? Currently I&#039;m controling the volume of all my software using that.</p></div></blockquote></div><br /><p>Afaik you cannot pass the Output of one GPU through the other. I guess it would be possible to achieve that by streaming the Image over IP to the Host, but i guess that isnt a good idea for gaming.</p><p>For the input question you can pass the Controller which controlls the Mouse/Keyboard to the VM or use <a href="http://synergy-foss.org" rel="nofollow">Synergy</a>, which nbhs mentioned a few pages earlier in this topic.</p><p>I dont think there is any difference in hardware support for VT-d for the different Core-i generations.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337653">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337659" class="blockpost rowodd"> <h2><span><span class="conr">#569</span> <a href="viewtopic.php?pid=1337659#p1337659">2013-10-15 09:32:53</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>is there any preference between intel and amd?</p><p>I&#039;m actually considering getting an AMD FX-8350, since it looks like it can be oc&#039;ed and still supports hardware passthrough.</p><p>another question I have is if I&#039;m going to be using 2 dedicated graphics cards do i need to make sure that i get a motherboard that supports running 2 pci express slots at x16 concurantly?</p><p>can you guys recommend a good amd mobo and a good intel mobo that will support 2 powerful graphics cards running simultaneously?</p><p>edit:</p><p>I&#039;ve done some reading and it really seems like amd pales in comparison for what I&#039;m trying to do. Are there any unlocked intel cpu&#039;s that support vt-d?</p><p>edit2:</p><p>It looks like the ivy bridge e editions support vt-d including the unlocked versions.</p><p>can anyone confirm or deny this?</p><br /><p><a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16819116939" rel="nofollow">http://www.newegg.com/Product/Product.a … 6819116939</a> does this support vt-d?</p> <p class="postedit"><em>Last edited by risho (2013-10-15 10:24:04)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337659">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337690" class="blockpost roweven"> <h2><span><span class="conr">#570</span> <a href="viewtopic.php?pid=1337690#p1337690">2013-10-15 11:17:25</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>The CPU you linked supports VT-d, but it costs three times the price of a FX-8350 <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" /></p> <p class="postedit"><em>Last edited by SpacePirate (2013-10-15 11:17:39)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337690">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1337696" class="blockpost rowodd"> <h2><span><span class="conr">#571</span> <a href="viewtopic.php?pid=1337696#p1337696">2013-10-15 11:31:18</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75076">SpacePirate</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-09-16</span></dd> <dd><span>Posts: 55</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:hiduei@gmx.de">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>I just tried to pass through something else than my GPU (USB3.0 Controller) - that works perfectly fine. So I the vfio works, with script, iommu etc. Yet I cannot produce any output from the passed through GPU.</p><p>EDIT: Some progress! When i start the VM using the test-command from the first post, the screen on the passed-through GPU actually turns on and the fans of the graphicscard! Unfortunatly it doesnt go any further than that. Also <a href="http://pastebin.com/ki13dqEd" rel="nofollow">this</a> output on dmesg on the host (it should start to get interesting from line 1050 on). When i dont shut down the qemu process, this crashes my host, it goes on with these statements:</p><div class="codebox"><pre><code>AMD-Vi: Completion-Wait loop timed out</code></pre></div><p> and</p><div class="codebox"><pre><code>AMD-Vi: Event logged [IOTLB_INV_TIMEOUT device=06:00.0 address=0x0000000438544b90]</code></pre></div><p>and the input devices start to lag behind, and at some point the screen starts only showing dmesg output....</p> <p class="postedit"><em>Last edited by SpacePirate (2013-10-15 22:02:09)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1337696">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338021" class="blockpost roweven"> <h2><span><span class="conr">#572</span> <a href="viewtopic.php?pid=1338021#p1338021">2013-10-16 07:16:51</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61115">1Samildanach</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-18</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>And I only have 1 screen as of right now. Is it possible to have the vm output video through the dom0&#039;s graphics card but use the domu card for the processing? Or is there a practical way to vnc or something of the like so that you can have a single monitor setup?</p></div></blockquote></div><p>One option is to use a <a href="https://en.wikipedia.org/wiki/KVM_switch" rel="nofollow">KVM switch</a>. The short version is that you plug it into the appropriate places, then press a button to switch your keyboard, monitor, and mouse between the two. I have been using, and satisfied with, an <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16817802144&amp;Tpk=CS682" rel="nofollow">Aten CS682</a>, but there are other models and brands out there which may better suite your individual needs.</p><div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>edit: also can you control the audio of the vm via pulse audio volume control? Currently I&#039;m controling the volume of all my software using that.</p></div></blockquote></div><p>Personally, I&#039;ve opted for getting a dedicated sound card and passing the onboard through to the VM, and having audio hooked into the KVM switch along with all the rest.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338021">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338035" class="blockpost rowodd"> <h2><span><span class="conr">#573</span> <a href="viewtopic.php?pid=1338035#p1338035">2013-10-16 08:02:58</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>1Samildanach wrote:</cite><blockquote><div><p>One option is to use a <a href="https://en.wikipedia.org/wiki/KVM_switch" rel="nofollow">KVM switch</a>. The short version is that you plug it into the appropriate places, then press a button to switch your keyboard, monitor, and mouse between the two. I have been using, and satisfied with, an <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16817802144&amp;Tpk=CS682" rel="nofollow">Aten CS682</a>, but there are other models and brands out there which may better suite your individual needs.</p></div></blockquote></div><p>i always wondered about something like that. nice to know that&#039;s what it&#039;s called. i&#039;ll definately consider that thanks!</p><div class="quotebox"><blockquote><div><p>Personally, I&#039;ve opted for getting a dedicated sound card and passing the onboard through to the VM, and having audio hooked into the KVM switch along with all the rest.</p></div></blockquote></div><br /><p>well i use a headset so and i want to be able to seemlessly switch between vm and host while using the same audio. like having a game using sound in the vm and talking on skype on the host simultaneously.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338035">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338048" class="blockpost roweven"> <h2><span><span class="conr">#574</span> <a href="viewtopic.php?pid=1338048#p1338048">2013-10-16 08:52:21</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=61115">1Samildanach</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2012-06-18</span></dd> <dd><span>Posts: 11</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>i always wondered about something like that. nice to know that&#039;s what it&#039;s called. i&#039;ll definately consider that thanks!</p></div></blockquote></div><p>No worries <img src="https://bbs.archlinux.org/img/smilies/smile.png" width="15" height="15" alt="smile" />. It does make for a mess of cables, but that&#039;s a minor quibble, and the advantages (no mess of software, for one thing) far outweighs it.</p><div class="quotebox"><cite>risho wrote:</cite><blockquote><div><p>well i use a headset so and i want to be able to seemlessly switch between vm and host while using the same audio. like having a game using sound in the vm and talking on skype on the host simultaneously.</p></div></blockquote></div><p>Ach, that does complicate matters. My switch allows one to switch just KVM or audio focus (so have audio coming from one machine while doing stuff to the other), but that still doesn&#039;t do you any good if want sound from both at once. However, it can certainly be done with software; all you need is something that can stream your audio output from Windows over the (virtual) network to Arch. I just decided it was more complication than I could be bothered with when I already had a switch <img src="https://bbs.archlinux.org/img/smilies/tongue.png" width="15" height="15" alt="tongue" />.</p><p>The obvious &#039;simple&#039; solution for Skype is to use the Windows client, but I imagine you have other examples in mind as well.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338048">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1338056" class="blockpost rowodd"> <h2><span><span class="conr">#575</span> <a href="viewtopic.php?pid=1338056#p1338056">2013-10-16 09:30:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=52029">risho</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-09-06</span></dd> <dd><span>Posts: 44</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=52029">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>so, i&#039;ve decided I would really like to get an intel 4930k, and I even found a motherboard that I was looking at getting. it&#039;s <a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16813188131" rel="nofollow"> EVGA X79 Dark</a>. I wasn&#039;t sure if it would support vt-d and linux so I contacted their customer service and asked them directly. they emailed me back:</p><div class="quotebox"><blockquote><div><p>Hi ****,</p><p>The motherboard will support Intel Visualization Technology. Unfortunately we do not support or have any drivers for Linux and only have drivers and support for Windows.</p><p>Regards,<br />EVGA</p></div></blockquote></div><p>I asked them SPECIFICALLY if it supported vt-d, and that seems to say that it does, but it doesn&#039;t have drivers to support linux. does that mean it won&#039;t work or does that just mean it doesn&#039;t support it actively and that the kernel would have to support it itself?</p><p>anyone have any idea, and if it won&#039;t work does anyone know a 2011 slot mobo that will work and supports ivy bridge e(not just sandy bridge)?</p><br /><br /><br /><br /><br /><div class="quotebox"><blockquote><div><p>No worries smile. It does make for a mess of cables, but that&#039;s a minor quibble, and the advantages (no mess of software, for one thing) far outweighs it.</p></div></blockquote></div><p>i&#039;m sure all of us are intimately firmillial with a mess of cables hahaha. my cable set it would probably scare some people away.</p> <p class="postedit"><em>Last edited by risho (2013-10-16 09:32:12)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1338056">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=22">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=21">21</a> <a href="viewtopic.php?id=162768&amp;p=22">22</a> <strong>23</strong> <a href="viewtopic.php?id=162768&amp;p=24">24</a> <a href="viewtopic.php?id=162768&amp;p=25">25</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=24">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
