<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> <title>KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9 (Page 42) / Topics Going Nowhere / Arch Linux Forums</title> <link rel="stylesheet" type="text/css" href="style/ArchLinux.css" /> <link rel="canonical" href="viewtopic.php?id=162768&amp;p=42" title="Page 42" /> <link rel="prev" href="viewtopic.php?id=162768&amp;p=41" title="Page 41" /> <link rel="next" href="viewtopic.php?id=162768&amp;p=43" title="Page 43" /> <link rel="alternate" type="application/atom+xml" href="extern.php?action=feed&amp;tid=162768&amp;type=atom" title="Atom topic feed" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/arch.css?v=3" /> <link rel="stylesheet" media="screen" href="style/ArchLinux/archnavbar.css?v=2" /> <link rel="shortcut icon" href="style/ArchLinux/favicon.ico" /> </head> <body> <div id="archnavbar" class="anb-forum"> <div id="archnavbarlogo"><h1><a href="http://www.archlinux.org/">Arch Linux</a></h1></div> <div id="archnavbarmenu"> <ul id="archnavbarlist"> <li id="anb-home"><a href="http://www.archlinux.org/">Home</a></li><li id="anb-packages"><a href="http://www.archlinux.org/packages/">Packages</a></li><li id="anb-forums" class="anb-selected"><a href="https://bbs.archlinux.org/">Forums</a></li><li id="anb-wiki"><a href="https://wiki.archlinux.org/">Wiki</a></li><li id="anb-bugs"><a href="https://bugs.archlinux.org/">Bugs</a></li><li id="anb-aur"><a href="https://aur.archlinux.org/">AUR</a></li><li id="anb-download"><a href="http://www.archlinux.org/download/">Download</a></li> </ul> </div> </div> <div id="punviewtopic" class="pun"> <div class="top-box"></div> <div class="punwrap"> <div id="brdheader" class="block"> <div class="box"> <div id="brdmenu" class="inbox"> <ul> <li id="navindex" class="isactive"><a href="index.php">Index</a></li> <li id="navuserlist"><a href="userlist.php">User list</a></li> <li id="navsearch"><a href="search.php">Search</a></li> <li id="navprofile"><a href="profile.php?id=80749">Profile</a></li> <li id="navlogout"><a href="login.php?action=out&amp;id=80749&amp;csrf_token=5c20501ec397bb45ef8ee8c84db232c8d8e421c6">Logout</a></li> </ul> </div> <div id="brdwelcome" class="inbox"> <ul class="conl"> <li><span>Logged in as <strong>SXX</strong></span></li> <li><span>Last visit: 2015-08-16 12:20:09</span></li> </ul> <ul class="conr"> <li><span>Topics: <a href="search.php?action=show_replies" title="Find topics you have posted to.">Posted</a> | <a href="search.php?action=show_new" title="Find topics with new posts since your last visit.">New</a> | <a href="search.php?action=show_recent" title="Find topics with recent posts.">Active</a> | <a href="search.php?action=show_unanswered" title="Find topics with no replies.">Unanswered</a></span></li> </ul> <div class="clearer"></div> </div> </div> </div> <div id="brdmain"> <div class="linkst"> <div class="inbox crumbsplus"> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=41">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=40">40</a> <a href="viewtopic.php?id=162768&amp;p=41">41</a> <strong>42</strong> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <a href="viewtopic.php?id=162768&amp;p=44">44</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=43">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <div class="clearer"></div> </div> </div> <div id="p1372691" class="blockpost rowodd blockpost1"> <h2><span><span class="conr">#1026</span> <a href="viewtopic.php?pid=1372691#p1372691">2014-01-19 18:19:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76793">ironicbadger</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-12</span></dd> <dd><span>Posts: 16</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76793">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Lauri wrote:</cite><blockquote><div><p>Thanks for this great thread. With all the information here I was able to get VGA passthrough working.</p><p>My setup is:<br />Debian testing host<br />Kernel 3.12.8 with i915 and acs override patches<br />QEMU-git with nosnoop patch<br />Windows 7 guest</p><p>Motherboard: Asus Z87-K<br />CPU: Intel i7-4770<br />GPU host: Intel HD4600<br />GPU guest: GeForce GTX560</p><p>I&#039;ve only used this for gaming and so far every game I&#039;ve tried has worked. Only problem I have with this is if I shutdown the VM I have to reboot the host to get VGA passthrough working again.</p></div></blockquote></div><p>Does ejecting your GPU before reboot from the guest resolve this issue? Also I had problems with Win7 and found Win8 much more &#039;friendly&#039; in this regard. I used Xen up until recently (and havn&#039;t tried this under KVM yet but I automated the process using devmanview and a tiny script I wrote. I wrote about it in my blog post <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a>. (Sorry if linking isn&#039;t allowed I&#039;ll remove it, just PM me).</p><br /><p>I have just purchased a Supermicro X10SAT board and using the information found in the thread thought I&#039;d give KVM a try, having used Xen for months it would be nice to use something without having to install a package. Anyway, my issue is this. I have vt-d / passthrough of my RAID controller working great, except for one thing. It stops HDMI audio working as soon as I add intel_iommu=on to my grub_default bit. Here is the relevant part of my grub:</p><div class="codebox"><pre><code>GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet ipv6.disable=1 intel_iommu=on vfio_iommu_type&quot;</code></pre></div><p>Here is my mkinitcpio.conf</p><div class="codebox"><pre><code>MODULES=&quot;i915 kvm kvm_intel pci-stub&quot;</code></pre></div><p>If iommu isn&#039;t present in the default line audio via HDMI works great, as soon as I switch it on and redo grub and reboot (regardless of whether the host is actually running a guest of not) it doesn&#039;t play audio. So weird. </p><p>Is this likely to be a motherboard issue? I&#039;m thinking so as I have an identical software setup on another machine (in my sig) and that works flawlessly.</p> </div> <div class="postsignature postmsg"><hr /><p>Hardware - Asus P8H77-V LE, BIOS 0237 | Intel i5 3470 3.2ghz | 8GB RAM | TX750W Corsair PSU | 60GB OCZ SSD | 500GB data drive<br />ArchX (dom0) - Arch Linux | Xen 4.3 | XBMC 12.2 output to TV<br />unRAID Server Pro v5.0(domU) - passed through Supermicro SAS-AOC-SASLP-MV8 - 16.3TB of protected storage.<br />Windows 8(domU) - with VGA passthrough // Arch Linux(domU) - development VM</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372691">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372942" class="blockpost roweven"> <h2><span><span class="conr">#1027</span> <a href="viewtopic.php?pid=1372942#p1372942">2014-01-20 09:06:50</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>andy123 wrote:</cite><blockquote><div><div class="quotebox"><cite>rabcor wrote:</cite><blockquote><div><p> […]<br />Finally, how do i apply the patch for using the nvidia proprietary drivers on the host? i can see a patch, but i ahve no idea what file to patch or how to get my hands on it (i thought they were closed source these drivers...(</p></div></blockquote></div><p>Since mbirkis also had a problem with this, <a href="https://gist.github.com/ajs124/8491428" rel="nofollow">here</a> is my modified PKGBUILD for current nvidia-dkms.</p></div></blockquote></div><p>Thanks alot for the PKGBUILD, i was able to build the driver using that one. One slight problem is it does not work using the linux-mainline kernel (works fine with stock arch).<br />Errors could have something to do with this:</p><div class="codebox"><pre><code>% uname -r 3.13.0-2-mainline</code></pre></div><div class="codebox"><pre><code>% dmesg | grep nvidia [ 2.642180] nvidia: module license &#039;NVIDIA&#039; taints kernel. [ 2.652591] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 2.653150] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.475852] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.586826] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.683180] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.706485] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.815154] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 3.922719] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0) [ 4.037577] nvidia: Unknown symbol acpi_os_wait_events_complete (err 0)</code></pre></div><div class="codebox"><pre><code>% systemctl status gdm.service gdm.service - GNOME Display Manager Loaded: loaded (/usr/lib/systemd/system/gdm.service; enabled) Active: active (running) since Mon 2014-01-20 09:33:58 CET; 1h 14min ago Main PID: 325 (gdm) CGroup: /system.slice/gdm.service 325 /usr/bin/gdm Jan 20 09:33:59 archxen gdm[325]: GdmDisplay: display lasted 0,107528 seconds Jan 20 09:33:59 archxen gdm[325]: Child process 678 was already dead. Jan 20 09:33:59 archxen gdm[325]: GLib-GObject: g_object_ref: assertion &#039;object-&gt;ref_count &gt; 0&#039; failed Jan 20 09:33:59 archxen gdm[325]: GLib-GObject: g_object_unref: assertion &#039;object-&gt;ref_count &gt; 0&#039; failed Jan 20 09:33:59 archxen gdm[325]: GdmDisplay: display lasted 0,106267 seconds Jan 20 09:33:59 archxen gdm[325]: Child process 690 was already dead. Jan 20 09:33:59 archxen gdm[325]: GLib-GObject: g_object_ref: assertion &#039;object-&gt;ref_count &gt; 0&#039; failed Jan 20 09:33:59 archxen gdm[325]: GLib-GObject: g_object_unref: assertion &#039;object-&gt;ref_count &gt; 0&#039; failed Jan 20 09:33:59 archxen gdm[325]: GdmDisplay: display lasted 0,114289 seconds Jan 20 09:33:59 archxen gdm[325]: GdmLocalDisplayFactory: maximum number of X display failures reached: ch...rrors Hint: Some lines were ellipsized, use -l to show in full.</code></pre></div><p>Edit: Found similar issue here: <a href="https://devtalk.nvidia.com/default/topic/644906/331-20-on-3-13-rc1-kernel/" rel="nofollow">https://devtalk.nvidia.com/default/topi … c1-kernel/</a> testing that patch now.</p><p>Edit2: The patch worked, i now have working nvidia driver on the host.</p> <p class="postedit"><em>Last edited by mbirkis (2014-01-20 10:16:51)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372942">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372972" class="blockpost rowodd"> <h2><span><span class="conr">#1028</span> <a href="viewtopic.php?pid=1372972#p1372972">2014-01-20 10:09:04</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Oops, yeah. That makes sense. I forgot to tell you that I use this with 3.12.x not 3.13, sorry for the confusion.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372972">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1372982" class="blockpost roweven"> <h2><span><span class="conr">#1029</span> <a href="viewtopic.php?pid=1372982#p1372982">2014-01-20 11:55:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>How would one get 2x of the same GPU working with this? I have to pass 1002:6738 into pci-stub, but that matches *both* of my video cards.</p><p>Edit: Here&#039;s my graphics adapters in lspci -nn.</p><div class="codebox"><pre><code>01:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts XT [Radeon HD 6870] [1002:6738] 01:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] [1002:aa88] 03:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Barts XT [Radeon HD 6870] [1002:6738] 03:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Barts HDMI Audio [Radeon HD 6800 Series] [1002:aa88]</code></pre></div><p>I am using the open source radeon driver on the host, so the issue mentioned in OP shouldn&#039;t effect me?</p><p>Edit: nevermind, looks like it isn&#039;t an issue at all. I just put the above IDs into pci-stub in bootloader, started it, ran the steps for vfio-pci and it&#039;s working fine. However, now I&#039;m getting stuck in the windows 7 installation. the first step, &quot;copying windows files&quot;, goes fine, but the next step (expanding windows files) has been sitting at 0% for 20 minutes now. pretty sure it&#039;s stalled and not actually working, as monitoring disk IO on the host shows there is practically no IO coming from qemu. Looking at CPU usage, qemu is using 10% of one core.</p><p>I know I should expect it to be kinda slow, because I&#039;m using a file as raw disk image, but this seems wrong.</p><div class="codebox"><pre><code>-device ahci,bus=pcie.0,id=ahci -drive file=/mnt/oldarch/windows.img,id=disk,format=raw -device ide-hd,bus=ahci.0,drive=disk -drive file=/mnt/2tb/win7/Windows7Ultimate.iso,id=isocd -device ide-cd,bus=ahci.1,drive=isocd</code></pre></div> <p class="postedit"><em>Last edited by alexis_evo (2014-01-20 16:04:46)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1372982">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373165" class="blockpost rowodd"> <h2><span><span class="conr">#1030</span> <a href="viewtopic.php?pid=1373165#p1373165">2014-01-20 20:18:27</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>However, now I&#039;m getting stuck in the windows 7 installation. the first step, &quot;copying windows files&quot;, goes fine, but the next step (expanding windows files) has been sitting at 0% for 20 minutes now. pretty sure it&#039;s stalled and not actually working, as monitoring disk IO on the host shows there is practically no IO coming from qemu. Looking at CPU usage, qemu is using 10% of one core.</p><p>I know I should expect it to be kinda slow, because I&#039;m using a file as raw disk image, but this seems wrong.</p></div></blockquote></div><p>QEMU AHCI is barely functional, wait it out and switch to virtio once installed (or maybe you can do it during install with a virtual driver disk)</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373165">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373194" class="blockpost roweven"> <h2><span><span class="conr">#1031</span> <a href="viewtopic.php?pid=1373194#p1373194">2014-01-20 22:28:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>For your testing pleasure (Intel root port ACS):</p><p><a href="https://lkml.org/lkml/2014/1/20/453" rel="nofollow">https://lkml.org/lkml/2014/1/20/453</a></p><p>Also, why so many reports of needing to reboot the host system to make the guest work a 2nd time?&#160; This should be solved by the secondary bus reset support.&#160; Could someone experiencing this problem report exactly what kernel and qemu you&#039;re using and provide lspci -vvv of the bus with the assigned video card?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373194">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373293" class="blockpost rowodd"> <h2><span><span class="conr">#1032</span> <a href="viewtopic.php?pid=1373293#p1373293">2014-01-21 05:16:12</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78672">Lauri</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-18</span></dd> <dd><span>Posts: 2</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=78672">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>ironicbadger wrote:</cite><blockquote><div><p>Does ejecting your GPU before reboot from the guest resolve this issue? Also I had problems with Win7 and found Win8 much more &#039;friendly&#039; in this regard. I used Xen up until recently (and havn&#039;t tried this under KVM yet but I automated the process using devmanview and a tiny script I wrote. I wrote about it in my blog post <a href="http://blog.ktz.me/?p=219" rel="nofollow">http://blog.ktz.me/?p=219</a>. (Sorry if linking isn&#039;t allowed I&#039;ll remove it, just PM me).</p></div></blockquote></div><p>Ejecting the GPU from the guest doesn&#039;t help. If I eject the GPU from the guest and shut down and try start it again the host freezes.</p><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Also, why so many reports of needing to reboot the host system to make the guest work a 2nd time?&#160; This should be solved by the secondary bus reset support.&#160; Could someone experiencing this problem report exactly what kernel and qemu you&#039;re using and provide lspci -vvv of the bus with the assigned video card?</p></div></blockquote></div><p>I&#039;m using kernel 3.12.8 with i915 and acs override patches, latest development version of QEMU with nosnoop patch. I also tried it with kernel 3.13.0 and QEMU without nosnoop patch but trying to start the guest for a 2nd time make the host completely freeze. Can&#039;t even ssh to it or use sysrq key combinations to reboot.</p><div class="codebox"><pre class="vscroll"><code>01:00.0 VGA compatible controller: NVIDIA Corporation GF114 [GeForce GTX 560] (rev a1) (prog-if 00 [VGA controller]) Subsystem: ASUSTeK Computer Inc. Device 83b5 Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR+ FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Interrupt: pin A routed to IRQ 16 Region 0: Memory at f4000000 (32-bit, non-prefetchable) [size=32M] Region 1: Memory at e0000000 (64-bit, prefetchable) [size=128M] Region 3: Memory at e8000000 (64-bit, prefetchable) [size=64M] Region 5: I/O ports at e000 [size=128] Expansion ROM at f6000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Address: 0000000000000000 Data: 0000 Capabilities: [78] Express (v2) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 &lt;64us ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd+ ExtTag+ PhantFunc- AuxPwr- NoSnoop- MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #0, Speed 2.5GT/s, Width x16, ASPM L0s L1, Exit Latency L0s &lt;512ns, L1 &lt;4us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 128 bytes Disabled- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 5GT/s, Width x16, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Not Supported, TimeoutDis+, LTR-, OBFF Not Supported DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled LnkCtl2: Target Link Speed: 2.5GT/s, EnterCompliance- SpeedDis- Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS- Compliance De-emphasis: -6dB LnkSta2: Current De-emphasis Level: -3.5dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100 v1] Virtual Channel Caps: LPEVC=0 RefClk=100ns PATEntryBits=1 Arb: Fixed- WRR32- WRR64- WRR128- Ctrl: ArbSelect=Fixed Status: InProgress- VC0: Caps: PATOffset=00 MaxTimeSlots=1 RejSnoopTrans- Arb: Fixed- WRR32- WRR64- WRR128- TWRR128- WRR256- Ctrl: Enable+ ID=0 ArbSelect=Fixed TC/VC=ff Status: NegoPending- InProgress- Capabilities: [128 v1] Power Budgeting &lt;?&gt; Capabilities: [600 v1] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: vfio-pci</code></pre></div> <p class="postedit"><em>Last edited by Lauri (2014-01-21 05:43:19)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373293">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373322" class="blockpost roweven"> <h2><span><span class="conr">#1033</span> <a href="viewtopic.php?pid=1373322#p1373322">2014-01-21 08:18:41</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>After letting it sit for like 3 hours it finally installed. Got virtio up and working. Games run, but I get random stalling. Lowering graphics settings seems to help but I can manage 60 FPS with highest settings in some games so it shouldn&#039;t be necessary. </p><p>Trying to run Mirror&#039;s Edge, get a solid framerate, highest settings on everything but 2xAA. Runs fine for about 5 minutes, will then stall for 5-10 seconds. Sometimes it recovers and lets me play a bit further. Sometimes it corrupts the display and I have to forcibly close qemu. In one situation after a stall, I got some weird screen tearing that persisted even after exiting the game. <a href="http://i.imgur.com/fuD5HkB.jpg" rel="nofollow">http://i.imgur.com/fuD5HkB.jpg</a></p><p>ASUS M5A99FX PRO R2.0, latest BIOS<br />AMD FX-8350<br />8GB of RAM (4GB given to the VM)<br />HD 6870 on both host and guest. Open source radeon driver on host, latest stable catalyst driver on guest.<br />Guest is Win7 64bit.</p><p>qemu incantation:</p><div class="codebox"><pre><code>qemu-system-x86_64 \ -enable-kvm -M q35 -m 4096 -cpu host -smp 6,sockets=1,cores=6,threads=1 \ -bios /usr/share/qemu/bios.bin -vga none -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=03:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device ahci,bus=pcie.0,id=ahci -drive file=/mnt/oldarch/windows.img,id=disk,format=raw -device virtio-blk-pci,drive=disk \ -usb -usbdevice host:04d9:0167 -usbdevice host:0461:4d0f -boot menu=on \ -device ich9-intel-hda,bus=pcie.0,addr=1b.0,id=sound0 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0</code></pre></div> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373322">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373325" class="blockpost rowodd"> <h2><span><span class="conr">#1034</span> <a href="viewtopic.php?pid=1373325#p1373325">2014-01-21 08:31:39</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>Games run, but I get random stalling.</p></div></blockquote></div><p>this happens for me as well, but only when the host is swapping (heavily?). I will upgrade to 16GB RAM in the next weeks.</p> <p class="postedit"><em>Last edited by Flyser (2014-01-21 08:34:20)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373325">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373328" class="blockpost roweven"> <h2><span><span class="conr">#1035</span> <a href="viewtopic.php?pid=1373328#p1373328">2014-01-21 08:40:34</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78432">manu.lima</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-10</span></dd> <dd><span>Posts: 1</span></dd> <dd class="usercontacts"><span class="email"><a href="mailto:manu080797@gmail.com">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Thanks for your post. It helped me to succesfully passthrough my vga on a windows 7 x86 guest. My hardware specs are:</p><p>AMD FX8320<br />GIGABYTE GA970-D3 (No issues at all, IOMMU works out of the box)<br />8 GB RAM<br />ATI RADEON HD 5570 (on primary pcie slot x16) &gt; attached to windows guest<br />NVIDIA 7300LE (on secondary pcie x4) &gt; on host using propietary nvidia drivers<br />TWO SATA DRIVES (One for the host and the other for the guest)</p><p>On the software side I&#039;m running stock arch kernel, stock qemu, stock nvidia-304xx drivers, and pulseaudio server (very important, you&#039;ll see later). </p><p>I managed to setup my vm using virt-manager which uses the old pc-i440fx and pci-assign to passthrough the vga. The only modifications I did, is to add the vga&#039;s id to pci-stub on kernel parameters, enable the vfio-pci systemd service (which I think it is not really necessary) and disabled nested page tables. I can restart the VM as many times as I like without having any performance issue. The windows guest evens boots after forcedly killing qemu.</p><p>I&#039;m using the VIRTIO drivers on windows which greatly improve performance and set disk cache to &quot;none&quot; on virt-manager.</p><p>Now here comes the biggest trouble I had while setting up this vm. The audio was terribly bad. Even after disabling nested pages tables, trying the preempt_voluntary=y and hz=1000 options in the kernel, trying the BFQ schuelder&#160; on linux-ck, setting qemu&#039;s priority to realtime and trying both &quot;alsa&quot; and &quot;pa&quot; audio variables.</p><p>My solution was to use the PULSEAUDIO SERVER and use this audio variables &quot;QEMU_ALSA_DAC_BUFFER_SIZE=512 QEMU_ALSA_DAC_PERIOD_SIZE=170 QEMU_AUDIO_DRV=alsa&quot;. Now the audio works flawlessly.</p><p>Thank you for reading my story and hope this helps you solve your audio problems.</p><p>PD: Sorry for my english. I&#039;m from Argentina.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373328">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373352" class="blockpost rowodd"> <h2><span><span class="conr">#1036</span> <a href="viewtopic.php?pid=1373352#p1373352">2014-01-21 10:17:45</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Fixed the stalling problems, at least mostly. Noticed a couple, but that may be because of slow disk IO.</p><p>Added to modprobe.d confs: options kvm-amd npt=0<br />Added to bootloader line: iommu=pt iommu=1</p><p>Enabled hugepages (I think this is what did it) (the number is amount of RAM given to VM divided by 2 plus a bit extra):<br />echo 2700 &gt; /proc/sys/vm/nr_hugepages<br />add &quot;-mem-path /dev/hugepages&quot; to qemu parameters</p><p>However... after 20 minutes of playing, I get the same tearing issue I did before. A random amount of the side of the screen is moved to the opposite side of the screen. I had it randomly be fixed once in the past 3-4 hours of playing. A menu popped up in the game telling me what to do next and it snapped back into place. Have not been able to reproduce it, even after playing with the screen torn for an hour.</p><p>Would really, really appreciate any help in fixing this problem. The game is running pretty smooth on max settings, really impressive after so many years of barely getting games to run on lowest settings in wine, but... this issue makes games unplayable. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373352">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373385" class="blockpost roweven"> <h2><span><span class="conr">#1037</span> <a href="viewtopic.php?pid=1373385#p1373385">2014-01-21 12:52:43</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>Would really, really appreciate any help in fixing this problem. The game is running pretty smooth on max settings, really impressive after so many years of barely getting games to run on lowest settings in wine, but... this issue makes games unplayable. <img src="https://bbs.archlinux.org/img/smilies/sad.png" width="15" height="15" alt="sad" /></p></div></blockquote></div><p>You could try to change the screen resolution (ingame or in the operating system).</p> <p class="postedit"><em>Last edited by Flyser (2014-01-21 12:54:00)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373385">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373419" class="blockpost rowodd"> <h2><span><span class="conr">#1038</span> <a href="viewtopic.php?pid=1373419#p1373419">2014-01-21 14:29:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Also, why so many reports of needing to reboot the host system to make the guest work a 2nd time?&#160; This should be solved by the secondary bus reset support.&#160; Could someone experiencing this problem report exactly what kernel and qemu you&#039;re using and provide lspci -vvv of the bus with the assigned video card?</p></div></blockquote></div><p>Here is some info on my setup. I have it working but i need to reboot the host to make the guest boot a 2nd time. Let me know if i can get you more info and i will sort it.</p><p>OP kernel pkgbuild</p><div class="codebox"><pre><code> % uname -r 3.13.0-2-mainline</code></pre></div><p>Using the qemu from OP along with seabios from OP</p><div class="codebox"><pre><code> % pacman -Q qemu-git qemu-git 2.0.r30022.gf976b09-1</code></pre></div><p>My vfio bind devices, the 0000:00:14.2 is onboard sound and works good.</p><div class="codebox"><pre><code>cat /etc/vfio-pci.cfg DEVICES=&quot;0000:02:00.0 0000:02:00.1 0000:00:14.2&quot;</code></pre></div><p>The 01:00.0 is used on the host, with nvidia proprietary driver and is working. Pci-stub grabs the 01:00.1 because it has the same pci-stub parameter as the 02:00.1 but it is no issue for me as i dont use it for anything.</p><div class="codebox"><pre class="vscroll"><code> % lspci -vv 01:00.0 VGA compatible controller: NVIDIA Corporation GF110 [GeForce GTX 570 Rev. 2] (rev a1) (prog-if 00 [VGA controller]) Subsystem: eVga.com. Corp. Device 1571 Control: I/O+ Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0 Interrupt: pin A routed to IRQ 76 Region 0: Memory at f6000000 (32-bit, non-prefetchable) [size=16M] Region 1: Memory at d0000000 (64-bit, prefetchable) [size=128M] Region 3: Memory at d8000000 (64-bit, prefetchable) [size=32M] Region 5: I/O ports at e000 [size=128] [virtual] Expansion ROM at f7000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [68] MSI: Enable+ Count=1/1 Maskable- 64bit+ Address: 00000000fee00000 Data: 0000 Capabilities: [78] Express (v2) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s unlimited, L1 &lt;64us ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd+ ExtTag+ PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #0, Speed 2.5GT/s, Width x16, ASPM L0s L1, Latency L0 &lt;256ns, L1 &lt;4us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 64 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM+ AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Not Supported, TimeoutDis+, LTR-, OBFF Not Supported DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled LnkCtl2: Target Link Speed: 2.5GT/s, EnterCompliance- SpeedDis- Transmit Margin: Normal Operating Range, EnterModifiedCompliance- ComplianceSOS- Compliance De-emphasis: -6dB LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100 v1] Virtual Channel Caps: LPEVC=0 RefClk=100ns PATEntryBits=1 Arb: Fixed- WRR32- WRR64- WRR128- Ctrl: ArbSelect=Fixed Status: InProgress- VC0: Caps: PATOffset=00 MaxTimeSlots=1 RejSnoopTrans- Arb: Fixed- WRR32- WRR64- WRR128- TWRR128- WRR256- Ctrl: Enable+ ID=0 ArbSelect=Fixed TC/VC=01 Status: NegoPending- InProgress- Capabilities: [128 v1] Power Budgeting &lt;?&gt; Capabilities: [600 v1] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: nvidia Kernel modules: nouveau, nvidia 01:00.1 Audio device: NVIDIA Corporation GF110 High Definition Audio Controller (rev a1) Subsystem: eVga.com. Corp. Device 1571 Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Interrupt: pin B routed to IRQ 7 Region 0: Memory at f7080000 (32-bit, non-prefetchable) [size=16K] Capabilities: [60] Power Management version 3 Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Address: 0000000000000000 Data: 0000 Capabilities: [78] Express (v2) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 &lt;64us ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #0, Speed 2.5GT/s, Width x16, ASPM L0s L1, Latency L0 &lt;256ns, L1 &lt;4us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM L0s L1 Enabled; RCB 128 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM+ AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- DevCap2: Completion Timeout: Not Supported, TimeoutDis+, LTR-, OBFF Not Supported DevCtl2: Completion Timeout: 50us to 50ms, TimeoutDis-, LTR-, OBFF Disabled LnkSta2: Current De-emphasis Level: -6dB, EqualizationComplete-, EqualizationPhase1- EqualizationPhase2-, EqualizationPhase3-, LinkEqualizationRequest- Kernel driver in use: pci-stub Kernel modules: snd_hda_intel 02:00.0 VGA compatible controller: NVIDIA Corporation GF110 [GeForce GTX 580] (rev a1) (prog-if 00 [VGA controller]) Subsystem: Micro-Star International Co., Ltd. Device 2563 Control: I/O+ Mem+ BusMaster- SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Interrupt: pin A routed to IRQ 28 Region 0: Memory at f4000000 (32-bit, non-prefetchable) [size=16M] Region 1: Memory at c0000000 (64-bit, prefetchable) [size=128M] Region 3: Memory at c8000000 (64-bit, prefetchable) [size=32M] Region 5: I/O ports at d000 [size=128] Expansion ROM at f5000000 [disabled] [size=512K] Capabilities: [60] Power Management version 3 Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Address: 0000000000000000 Data: 0000 Capabilities: [78] Express (v1) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 &lt;64us ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #1, Speed 2.5GT/s, Width x16, ASPM L0s L1, Latency L0 &lt;256ns, L1 &lt;4us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 128 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- Capabilities: [b4] Vendor Specific Information: Len=14 &lt;?&gt; Capabilities: [100 v1] Virtual Channel Caps: LPEVC=0 RefClk=100ns PATEntryBits=1 Arb: Fixed- WRR32- WRR64- WRR128- Ctrl: ArbSelect=Fixed Status: InProgress- VC0: Caps: PATOffset=00 MaxTimeSlots=1 RejSnoopTrans- Arb: Fixed- WRR32- WRR64- WRR128- TWRR128- WRR256- Ctrl: Enable+ ID=0 ArbSelect=Fixed TC/VC=01 Status: NegoPending- InProgress- Capabilities: [128 v1] Power Budgeting &lt;?&gt; Capabilities: [600 v1] Vendor Specific Information: ID=0001 Rev=1 Len=024 &lt;?&gt; Kernel driver in use: vfio-pci Kernel modules: nouveau, nvidia 02:00.1 Audio device: NVIDIA Corporation GF110 High Definition Audio Controller (rev a1) Subsystem: Micro-Star International Co., Ltd. Device 2563 Control: I/O- Mem+ BusMaster+ SpecCycle- MemWINV- VGASnoop- ParErr- Stepping- SERR- FastB2B- DisINTx- Status: Cap+ 66MHz- UDF- FastB2B- ParErr- DEVSEL=fast &gt;TAbort- &lt;TAbort- &lt;MAbort- &gt;SERR- &lt;PERR- INTx- Latency: 0, Cache Line Size: 64 bytes Interrupt: pin B routed to IRQ 11 Region 0: Memory at f5080000 (32-bit, non-prefetchable) [size=16K] Capabilities: [60] Power Management version 3 Flags: PMEClk- DSI- D1- D2- AuxCurrent=0mA PME(D0-,D1-,D2-,D3hot-,D3cold-) Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME- Capabilities: [68] MSI: Enable- Count=1/1 Maskable- 64bit+ Address: 0000000000000000 Data: 0000 Capabilities: [78] Express (v1) Endpoint, MSI 00 DevCap: MaxPayload 128 bytes, PhantFunc 0, Latency L0s &lt;4us, L1 &lt;64us ExtTag+ AttnBtn- AttnInd- PwrInd- RBE+ FLReset- DevCtl: Report errors: Correctable- Non-Fatal- Fatal- Unsupported- RlxdOrd- ExtTag- PhantFunc- AuxPwr- NoSnoop+ MaxPayload 128 bytes, MaxReadReq 512 bytes DevSta: CorrErr- UncorrErr- FatalErr- UnsuppReq- AuxPwr- TransPend- LnkCap: Port #1, Speed 2.5GT/s, Width x16, ASPM L0s L1, Latency L0 &lt;256ns, L1 &lt;4us ClockPM+ Surprise- LLActRep- BwNot- LnkCtl: ASPM Disabled; RCB 128 bytes Disabled- Retrain- CommClk+ ExtSynch- ClockPM- AutWidDis- BWInt- AutBWInt- LnkSta: Speed 2.5GT/s, Width x8, TrErr- Train- SlotClk+ DLActive- BWMgmt- ABWMgmt- Kernel driver in use: vfio-pci Kernel modules: snd_hda_intel</code></pre></div><p>Edit: did lspci -vv as root to get more info.</p> <p class="postedit"><em>Last edited by mbirkis (2014-01-21 14:57:28)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373419">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373423" class="blockpost roweven"> <h2><span><span class="conr">#1039</span> <a href="viewtopic.php?pid=1373423#p1373423">2014-01-21 14:48:46</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78789">iamtakingiteasy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-21</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Hello, i am trying to passthrough a GTX 780 Nvidia card. I had my success with Radeon HD 7870 in same setup, but it is way too much overheating, making me worry that it will flood my computer with melting soldering iron :)</p><p>(problematic setup)<br />CPU: Core i7 3770<br />Motherboard: Asus P8Z77-V LX-2<br />Guest GPU: Asus GTX 780 in primary (upper, one that closer to CPU) PCI-E slot.<br />Kernel: 3.13.0-ARCH with SRC and patches from archive in first post, built with supplied x86_64 config (with few changes to support my initrd&#039;s lvm-related setup (built-in scsi and sata drivers)).<br />Kernel params: pci-stub.ids=10de:1004,10de:0e1a intel_iommu=on pcie_acs_override=downstream vfio_iommu_type1.allow_unsafe_interrupts=1<br />qemu: commit 1cf892ca2689c84960b4ce4d2723b6bee453711c from git://git.qemu.org/qemu.git (last available from master branch, also i&#039;ve failed to see any specific patches or check-outs in qemu-git from the first post, so i am guessing it is untouched upstream) <br />seabios: commit 19f789bdfd58eba2ed8fe604bbabf8df0fcc0771 from git://git.seabios.org/seabios.git (last available from master branch, built with build function sourced from PKGBUILD with minor change (not to cd to source directory, as i am already standing in there and also setting srcdir=.))</p><p>Host is currently operating without own GPU (everything is done over SSH), though i have plans in using either embedded Intel GPU or HD 7870 in secondary PCI-E slot.</p><p>I am using this script to launch my Win7 guest:</p><div class="codebox"><pre class="vscroll"><code>#!/bin/sh # some helper function move_device () { BDF=$1; shift DRV=$1; shift BND=$1; shift # Unbind a PCI function from its driver as necessary [ -e /sys/bus/pci/devices/$BDF/driver/unbind ] &amp;&amp; \ echo -n $BDF &gt; /sys/bus/pci/devices/$BDF/driver/unbind # Add a new slot to the PCI Backend&#039;s list vendor=$(sed &#039;s/^0x//&#039; /sys/bus/pci/devices/$BDF/vendor) device=$(sed &#039;s/^0x//&#039; /sys/bus/pci/devices/$BDF/device); echo -n $vendor $device &gt; /sys/bus/pci/drivers/$DRV/new_id 2&gt;/dev/null # Now that the backend is watching for the slot, bind to it [ &quot;x$BND&quot; = &quot;xtrue&quot; ] &amp;&amp; \ echo -n $BDF &gt; /sys/bus/pci/drivers/$DRV/bind } dmesg -C modprobe kvm_intel modprobe pci-stub modprobe vfio-pci # primary videocard -- 780 GTX move_device &quot;0000:01:00.0&quot; &quot;vfio-pci&quot; # hdmi audio card move_device &quot;0000:01:00.1&quot; &quot;vfio-pci&quot; # some crap in the same iommu group as my primary GPU move_device &quot;0000:00:01.0&quot; &quot;vfio-pci&quot; qemu-system-x86_64 \ -enable-kvm -machine type=pc,accel=kvm -enable-kvm -m 8192 -M q35 \ -cpu host -smp 4,sockets=1,cores=4,threads=1 \ -device ioh3420,bus=pcie.0,addr=1c.0,multifunction=on,port=1,chassis=1,id=root.1 \ -device vfio-pci,host=01:00.0,bus=root.1,addr=00.0,multifunction=on,x-vga=on \ -device piix4-ide,bus=pcie.0,id=ahci \ -device ide-hd,bus=ahci.0,drive=disk \ -bios /usr/share/qemu/bios.bin \ -vnc :1 \ -drive file=/dev/virt/win7,id=disk,format=raw \ -net nic,model=rtl8139,macaddr=52:54:00:08:d9:75 \ -net tap,script=/home/user/bin/asset/qemu-ifup \ -boot menu=on -vga none</code></pre></div><p>But upon launch this script, screen is just going blank and nothing happens (but win7 is actually booting, when it finished, i could login via RDP and see 43 error on GPU)</p><p>I am getting the following output in my dmesg log:</p><div class="codebox"><pre><code>[ 35.886341] pci-stub: add 10DE:1004 sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 35.886353] pci-stub 0000:01:00.0: claimed by stub [ 35.886360] pci-stub: add 10DE:0E1A sub=FFFFFFFF:FFFFFFFF cls=00000000/00000000 [ 35.907811] VFIO - User Level meta-driver version: 0.3 [ 36.091437] tun: Universal TUN/TAP device driver, 1.6 [ 36.091440] tun: (C) 1999-2004 Max Krasnyansky &lt;maxk@qualcomm.com&gt; [ 36.127293] device tap0 entered promiscuous mode [ 36.127986] br0: port 1(tap0) entered forwarding state [ 36.127998] br0: port 1(tap0) entered forwarding state [ 39.077328] vfio_ecap_init: 0000:01:00.0 hiding ecap 0x19@0x900 [ 40.044509] type=1006 audit(1390315308.533:5): pid=2076 uid=0 old auid=4294967295 new auid=0 old ses=4294967295 new ses=4 res=1 [ 41.497683] vfio-pci 0000:01:00.0: Invalid ROM contents [ 41.497799] vfio-pci 0000:01:00.0: Invalid ROM contents</code></pre></div><p>Interesting thing: when i simply replace nvidia with radeon in primary PCI-E slot, everything is launching up just fine without a single change, so i guess it is nvidia-specific problem.</p><p>Any hints why it might not work with nvidia and how to possibly fix this?</p><p>Thanks.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373423">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373463" class="blockpost rowodd"> <h2><span><span class="conr">#1040</span> <a href="viewtopic.php?pid=1373463#p1373463">2014-01-21 16:28:49</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>Would really, really appreciate any help in fixing this problem. The game is running pretty smooth on max settings, really impressive after so many years of barely getting games to run on lowest settings in wine, but... this issue makes games unplayable. :(</p></div></blockquote></div><p>You could try to change the screen resolution (ingame or in the operating system).</p></div></blockquote></div><p>Nope... doesn&#039;t work. Maybe relevant, though: when capturing desktop video via OBS (Open Broadcast Software), it doesn&#039;t include the tearing. Tried changing resolution, switching monitors, switching HDMI cables, nothing will fix it short of restarting the VM.</p><p>Also, the GPU fails to &#039;eject&#039; whenever I try to do so to &#039;safely&#039; shut down the VM. I hear the windows eject sound, and then the entire VM locks up with very corrupted video output.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373463">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373467" class="blockpost roweven"> <h2><span><span class="conr">#1041</span> <a href="viewtopic.php?pid=1373467#p1373467">2014-01-21 16:42:11</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>Lauri, mbirkis, what exactly doesn&#039;t work that requires you to reboot the host?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373467">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373478" class="blockpost rowodd"> <h2><span><span class="conr">#1042</span> <a href="viewtopic.php?pid=1373478#p1373478">2014-01-21 17:15:06</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=72881">alexis_evo</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-07-04</span></dd> <dd><span>Posts: 33</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=72881">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>New problem since restarting after the last screen tear... now the monitor will randomly blank for 2-3 seconds. Seems like the GPU is trying to adjust something on the display, since the On Screen Menu on my monitor will not work/disappears whenever the screen blanks. It happens very often, every 5-10 seconds. After waiting 10-15 minutes, it occasionally stops doing it for 20 minutes, then starts again. Only occurs when a 3D game is at the forefront. Alt tabbing out of the game to the desktop causes it to immediately stop, and it resumes when I tab back in.</p><p>Really don&#039;t know what could be causing this...</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373478">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373485" class="blockpost roweven"> <h2><span><span class="conr">#1043</span> <a href="viewtopic.php?pid=1373485#p1373485">2014-01-21 17:33:54</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=53953">andy123</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2011-11-04</span></dd> <dd><span>Posts: 169</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=53953">Email</a></span> <span class="website"><a href="http://ajs124.de" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>alexis_evo wrote:</cite><blockquote><div><p>New problem since restarting after the last screen tear... now the monitor will randomly blank for 2-3 seconds. Seems like the GPU is trying to adjust something on the display, since the On Screen Menu on my monitor will not work/disappears whenever the screen blanks. It happens very often, every 5-10 seconds. After waiting 10-15 minutes, it occasionally stops doing it for 20 minutes, then starts again. Only occurs when a 3D game is at the forefront. Alt tabbing out of the game to the desktop causes it to immediately stop, and it resumes when I tab back in.</p><p>Really don&#039;t know what could be causing this...</p></div></blockquote></div><p>I had a kinda similar issue, but I don&#039;t think it was reproducible. <br />My primary screen (1920x1080 hdmi) &quot;blanked&quot; like you described it and said something about &quot;wrong input/resolution&quot; with Civ5 up, but worked fine when on the desktop. The second screen (1280x1024 vga) still worked on the desktop at the same time.<br />I think I fixed the issue by messing with the settings and restarting the game. Something like, starting with 1600x900 and setting to 1920x1080 ingame…<br />In general, I had far less issues in Windows 8(.1) with resolution changes, multiple monitors and so on.</p> </div> <div class="postsignature postmsg"><hr /><p>i&#039;m sorry for my poor english wirting skills…</p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373485">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373540" class="blockpost rowodd"> <h2><span><span class="conr">#1044</span> <a href="viewtopic.php?pid=1373540#p1373540">2014-01-21 19:28:15</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Lauri, mbirkis, what exactly doesn&#039;t work that requires you to reboot the host?</p></div></blockquote></div><p>If i shutdown the guest, and try to start it back up i cant get the display to work.</p><p>here is some relevant dmesg from the failed guest boot:</p><div class="codebox"><pre><code>[41945.924908] vfio-pci 0000:00:14.2: enabling device (0000 -&gt; 0002) [41949.495172] vfio-pci 0000:02:00.0: Invalid ROM contents</code></pre></div><p>Edit: I actually read the error message, and loaded the rom file as described in the OP. Guest reboot now works for me.</p> <p class="postedit"><em>Last edited by mbirkis (2014-01-21 19:38:21)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373540">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373541" class="blockpost roweven"> <h2><span><span class="conr">#1045</span> <a href="viewtopic.php?pid=1373541#p1373541">2014-01-21 19:30:19</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=75590">aw</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-10-04</span></dd> <dd><span>Posts: 921</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=75590">Email</a></span> <span class="website"><a href="http://vfio.blogspot.com/" rel="nofollow">Website</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>mbirkis wrote:</cite><blockquote><div><div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>Lauri, mbirkis, what exactly doesn&#039;t work that requires you to reboot the host?</p></div></blockquote></div><p>If i shutdown the guest, and try to start it back up i cant get the display to work.</p><p>here is some relevant dmesg from the failed guest boot:</p><div class="codebox"><pre><code>[41945.924908] vfio-pci 0000:00:14.2: enabling device (0000 -&gt; 0002) [41949.495172] vfio-pci 0000:02:00.0: Invalid ROM contents</code></pre></div></div></blockquote></div><p>So it&#039;s not actually a guest reboot, it&#039;s a guest shutdown and restart?&#160; Why don&#039;t you just save off the ROM to a file and use the romfile=option to the vfio-pci device?</p> </div> <div class="postsignature postmsg"><hr /><p><a href="http://vfio.blogspot.com" rel="nofollow">http://vfio.blogspot.com</a><br />Looking for a more open forum to discuss vfio related uses?&#160; Try <a href="https://www.redhat.com/mailman/listinfo/vfio-users" rel="nofollow">https://www.redhat.com/mailman/listinfo/vfio-users</a></p></div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373541">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373545" class="blockpost rowodd"> <h2><span><span class="conr">#1046</span> <a href="viewtopic.php?pid=1373545#p1373545">2014-01-21 19:43:02</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77628">mbirkis</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-12</span></dd> <dd><span>Posts: 13</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=77628">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <p>You are absolutely right, just as i posted the reply i thought about the romfile thing. It workes flawlesly now. Sorry about that, Guess i needed to post forum replys to get my head working.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373545">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373546" class="blockpost roweven"> <h2><span><span class="conr">#1047</span> <a href="viewtopic.php?pid=1373546#p1373546">2014-01-21 19:52:38</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>iamtakingiteasy wrote:</cite><blockquote><div><p>Host is currently operating without own GPU (everything is done over SSH), though i have plans in using either embedded Intel GPU or HD 7870 in secondary PCI-E slot.</p></div></blockquote></div><p>How do you prevent the GPU from becoming the primary GPU of the host (meaning: showing bios, bootloader and linux boot output)? Because if you don&#039;t, that&#039;s likely the reason for error 43.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373546">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373554" class="blockpost rowodd"> <h2><span><span class="conr">#1048</span> <a href="viewtopic.php?pid=1373554#p1373554">2014-01-21 20:14:13</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=78789">iamtakingiteasy</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2014-01-21</span></dd> <dd><span>Posts: 3</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>Flyser wrote:</cite><blockquote><div><div class="quotebox"><cite>iamtakingiteasy wrote:</cite><blockquote><div><p>Host is currently operating without own GPU (everything is done over SSH), though i have plans in using either embedded Intel GPU or HD 7870 in secondary PCI-E slot.</p></div></blockquote></div><p>How do you prevent the GPU from becoming the primary GPU of the host (meaning: showing bios, bootloader and linux boot output)? Because if you don&#039;t, that&#039;s likely the reason for error 43.</p></div></blockquote></div><p>Shouldn&#039;t binding to pci-stub/vfio-pci (notice kernel argument line and beginning of the script) deal with it? Besides, Radeon card passes through fine in same setup.</p> <p class="postedit"><em>Last edited by iamtakingiteasy (2014-01-21 20:16:11)</em></p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373554">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373557" class="blockpost roweven"> <h2><span><span class="conr">#1049</span> <a href="viewtopic.php?pid=1373557#p1373557">2014-01-21 20:17:55</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=77842">Flyser</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-12-19</span></dd> <dd><span>Posts: 29</span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>iamtakingiteasy wrote:</cite><blockquote><div><p>Shouldn&#039;t binding to pci-stub/vfio-pci (notice kernel argument line and beginning of the script) deal with it? Besides, Radeon card passes through fine in same setup.</p></div></blockquote></div><p>As far as I know, no. It definitely wouldn&#039;t work on my system.</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373557">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div id="p1373621" class="blockpost rowodd"> <h2><span><span class="conr">#1050</span> <a href="viewtopic.php?pid=1373621#p1373621">2014-01-21 23:50:28</a></span></h2> <div class="box"> <div class="inbox"> <div class="postbody"> <div class="postleft"> <dl> <dt><strong><a href="profile.php?id=76834">Val532</a></strong></dt> <dd class="usertitle"><strong>Member</strong></dd> <dd><span>Registered: 2013-11-13</span></dd> <dd><span>Posts: 35</span></dd> <dd class="usercontacts"><span class="email"><a href="misc.php?email=76834">Email</a></span></dd> </dl> </div> <div class="postright"> <h3>Re: KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</h3> <div class="postmsg"> <div class="quotebox"><cite>aw wrote:</cite><blockquote><div><p>For your testing pleasure (Intel root port ACS):</p><p><a href="https://lkml.org/lkml/2014/1/20/453" rel="nofollow">https://lkml.org/lkml/2014/1/20/453</a></p><p>Also, why so many reports of needing to reboot the host system to make the guest work a 2nd time?&#160; This should be solved by the secondary bus reset support.&#160; Could someone experiencing this problem report exactly what kernel and qemu you&#039;re using and provide lspci -vvv of the bus with the assigned video card?</p></div></blockquote></div><p>Yeah a new acs patch !!!</p><p>But why no x58 or x79 for the moment ?</p> </div> </div> </div> </div> <div class="inbox"> <div class="postfoot clearb"> <div class="postfootleft"><p><span>Offline</span></p></div> <div class="postfootright"> <ul> <li class="postreport"><span><a href="misc.php?report=1373621">Report</a></span></li> </ul> </div> </div> </div> </div> </div> <div class="postlinksb"> <div class="inbox crumbsplus"> <div class="pagepost"> <p class="pagelink conl"><span class="pages-label">Pages: </span><a rel="prev" class="item1" href="viewtopic.php?id=162768&amp;p=41">Previous</a> <a href="viewtopic.php?id=162768">1</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=40">40</a> <a href="viewtopic.php?id=162768&amp;p=41">41</a> <strong>42</strong> <a href="viewtopic.php?id=162768&amp;p=43">43</a> <a href="viewtopic.php?id=162768&amp;p=44">44</a> <span class="spacer">…</span> <a href="viewtopic.php?id=162768&amp;p=234">234</a> <a rel="next" href="viewtopic.php?id=162768&amp;p=43">Next</a></p> <p class="postlink conr">Topic closed</p> </div> <ul class="crumbs"> <li><a href="index.php">Index</a></li> <li><span>»&#160;</span><a href="viewforum.php?id=48">Topics Going Nowhere</a></li> <li><span>»&#160;</span><strong><a href="viewtopic.php?id=162768">KVM VGA-Passthrough using the new vfio-vga support in kernel =&gt;3.9</a></strong></li> </ul> <p class="subscribelink clearb"><a href="misc.php?action=subscribe&amp;tid=162768">Subscribe to this topic</a></p> <div class="clearer"></div> </div> </div> </div> <div id="brdfooter" class="block"> <h2><span>Board footer</span></h2> <div class="box"> <div id="brdfooternav" class="inbox"> <div class="conl"> <form id="qjump" method="get" action="viewforum.php"> <div><label><span>Jump to<br /></span> <select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)"> <optgroup label="Technical Issues and Assistance"> <option value="23">Newbie Corner</option> <option value="17">Installation</option> <option value="22">Kernel &amp; Hardware</option> <option value="18">Applications &amp; Desktop Environments</option> <option value="31">Laptop Issues</option> <option value="8">Networking, Server, and Protection</option> <option value="32">Multimedia and Games</option> <option value="50">System Administration</option> <option value="35">Other Architectures</option> </optgroup> <optgroup label="Arch-centric"> <option value="24">Announcements, Package &amp; Security Advisories</option> <option value="1">Arch Discussion</option> <option value="13">Forum &amp; Wiki discussion</option> </optgroup> <optgroup label="Pacman Upgrades, Packaging &amp; AUR"> <option value="44">Pacman &amp; Package Upgrade Issues</option> <option value="49">[testing] Repo Forum</option> <option value="4">Creating &amp; Modifying Packages</option> <option value="38">AUR Issues, Discussion &amp; PKGBUILD Requests</option> </optgroup> <optgroup label="Contributions &amp; Discussion"> <option value="20">GNU/Linux Discussion</option> <option value="27">Community Contributions</option> <option value="33">Programming &amp; Scripting</option> <option value="30">Other Languages</option> <option value="47">Artwork and Screenshots</option> <option value="42">Try This</option> </optgroup> <optgroup label="/dev/null"> <option value="29">Off-Topic</option> <option value="48" selected="selected">Topics Going Nowhere</option> <option value="36">Dustbin</option> </optgroup> </select></label> <input type="submit" value=" Go " accesskey="g" /> </div> </form> </div> <div class="conr"> <p id="feedlinks"><span class="atom"><a href="extern.php?action=feed&amp;tid=162768&amp;type=atom">Atom topic feed</a></span></p> <p id="poweredby">Powered by <a href="http://fluxbb.org/">FluxBB</a></p> </div> <div class="clearer"></div> </div> </div> </div> </div> <div class="end-box"></div> </div> </body> </html>
